import{b as qn,u as $r,r as h,j as e,I as te,R as K,d as Un,e as Ot,B as u,G as qr,T as g,f as B,L as ps,h as fs,i as ms,k as bt,l as Ys,m as Bn,D as wt,A as ce,M as Ie,n as Ee,o as Ge,p as _s,q as Is,s as Es,F as ne,t as ee,S as ie,v as z,w as q,x as Ds,y as We,z as Q,C as Gt,E as Kt,H as se,J as De,K as ke,N as Ur,O as Br,P as Wr,Q as ot,U as lt,V as Ye,W as Wn,X as Hn,Y as Vn,Z as Jn,_ as Gn,$ as er,a0 as Kn,a1 as Zn,a2 as Qn,a3 as tr,a4 as gs,a5 as Xn,a6 as Hr,a7 as Yn,a8 as eo,a9 as to,aa as sr,ab as rr,ac as nr,ad as or}from"./mui-core-BVMuDfY9.js";import{D as Vr,L as so,H as ro,a as As,S as Os,b as Jr,G as Ts,c as Gr,A as Kr,Q as Zr,d as Ft,P as vt,e as no,K as oo,f as at,g as ue,h as ge,F as zs,i as $t,j as ir,k as io,I as lr,E as ct,l as lo,m as Qr,n as Xr,o as ao,C as co,M as uo,p as ho,q as xo,r as Ls,s as Yr,t as ar,u as po,v as fo,B as mo,w as go,x as jo,y as bo,z as yo,J as wo,N as So,O as cr,R as vo,U as en,T as ko,V as Co,W as Po,X as Ro,Y as _o}from"./mui-icons-BL5aAONm.js";import{c as Io}from"./supabase-CQnIwFJt.js";import{N as qt,u as Ns,a as Ms,R as Fs,b as Se,B as Eo}from"./router-D89MQL-m.js";import{f as os}from"./utils-CSQe5d3I.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=r(o);fetch(o.href,l)}})();var _t={},dr;function Do(){if(dr)return _t;dr=1;var s=qn();return _t.createRoot=s.createRoot,_t.hydrateRoot=s.hydrateRoot,_t}var Ao=Do();function Oo(s){const{onClick:t,sx:r,...n}=s,{mode:o,setMode:l}=$r(),[i,a]=h.useState(!1);return h.useEffect(()=>{a(!0)},[]),i?e.jsxs(te,{"data-screenshot":"toggle-mode",size:"sm",variant:"outlined",color:"neutral",...n,onClick:c=>{l(o==="light"?"dark":"light"),t?.(c)},sx:[o==="dark"?{"& > *:first-of-type":{display:"none"}}:{"& > *:first-of-type":{display:"initial"}},o==="light"?{"& > *:last-of-type":{display:"none"}}:{"& > *:last-of-type":{display:"initial"}},...Array.isArray(r)?r:[r]],children:[e.jsx(Vr,{}),e.jsx(so,{})]}):e.jsx(te,{size:"sm",variant:"outlined",color:"neutral",...n,sx:r,disabled:!0})}const tn="https://tfzvtzqybgbzxcxozdes.supabase.co",js="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRmenZ0enF5YmdienhjeG96ZGVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NTc2MDIsImV4cCI6MjA2MzQzMzYwMn0.hD2WdkvI8LY9N0IHP7HDQliyicQA0c-mspKjCJf0_Fc";console.log("[Supabase] URL:",tn);console.log("[Supabase] Anon Key:",js.slice(0,6)+"..."+js.slice(-6));const L=Io(tn,js);L.auth.onAuthStateChange((s,t)=>{console.log("[Auth State Change]",s,t),s==="SIGNED_IN"?console.log("User signed in:",t?.user):s==="SIGNED_OUT"&&console.log("User signed out")});let is=!1;L.auth.onAuthStateChange((s,t)=>{is||(is=!0,console.log("[Auth State Change]",s,t),s==="SIGNED_IN"?console.log("User signed in:",t?.user):s==="SIGNED_OUT"&&(console.log("User signed out"),window.location.pathname!=="/login"&&(window.location.href="/login")),is=!1)});const $s=s=>t=>{const[r,n]=K.useState(null),[o,l]=K.useState(!0);return K.useEffect(()=>{async function i(){const{data:a}=await L.auth.getSession();n(a?.session||null),l(!1)}i()},[]),o?e.jsx("div",{children:"Loading..."}):r?e.jsx(s,{...t}):e.jsx(qt,{to:"/login",replace:!0})},To=[{label:"Home",icon:K.createElement(ro),value:"home",route:"/",showInMobile:!0},{label:"Dashboard",icon:K.createElement(As),value:"dashboard",route:"/dashboard",showInMobile:!0},{label:"Orders",icon:K.createElement(Os),value:"orders",route:"/orders",showInMobile:!0},{label:"Products",icon:K.createElement(Jr),value:"products",route:"/products",showInMobile:!0},{label:"Users",icon:K.createElement(Ts),value:"users",route:"/users",showInMobile:!0},{label:"Suppliers",icon:K.createElement(Gr),value:"suppliers",route:"/suppliers",showInMobile:!0},{label:"Purchase Orders",icon:K.createElement(Kr),value:"purchaseorders",route:"/purchase-orders",showInMobile:!0},{label:"Tickets",icon:K.createElement(Zr),value:"tickets",route:"/tickets",showInMobile:!0},{label:"SMS Campaigns",icon:K.createElement(Ft),value:"smscampaigns",route:"/sms-campaigns",showInMobile:!0},{label:"Movements",icon:K.createElement(Ft),value:"movements",route:"/movements",showInMobile:!0},{label:"My Profile",icon:K.createElement(vt),value:"profile",route:"/settings",showInMobile:!0}],Tt={Sales:[{label:"Dashboard",icon:K.createElement(As),value:"dashboard",route:"/dashboard",showInMobile:!0},{label:"Orders",icon:K.createElement(Os),value:"orders",route:"/orders",showInMobile:!0},{label:"Products",icon:K.createElement(Jr),value:"products",route:"/products",showInMobile:!0}],Support:[{label:"Tickets",icon:K.createElement(Zr),value:"tickets",route:"/tickets",showInMobile:!0},{label:"Users",icon:K.createElement(Ts),value:"users",route:"/users",showInMobile:!0},{label:"My Profile",icon:K.createElement(vt),value:"profile",route:"/settings",showInMobile:!0}],Marketing:[{label:"SMS Campaigns",icon:K.createElement(Ft),value:"smscampaigns",route:"/sms-campaigns",showInMobile:!0}],Operations:[{label:"Suppliers",icon:K.createElement(Gr),value:"suppliers",route:"/suppliers",showInMobile:!0},{label:"Purchase Orders",icon:K.createElement(Kr),value:"purchaseorders",route:"/purchase-orders",showInMobile:!0},{label:"Movements",icon:K.createElement(Ft),value:"movements",route:"/movements",showInMobile:!0}]};function Ce(){const s=Un(),t=Ot("(max-width:600px)"),r=Ot("(min-width:601px) and (max-width:1024px)"),n=Ot("(min-width:1025px)");return{isMobile:t,isTablet:r,isDesktop:n,isSmallScreen:t,isMediumScreen:r,isLargeScreen:n,breakpoints:{mobile:"600px",tablet:"1024px",desktop:"1025px"},theme:s}}function sn(){const{isMobile:s,isTablet:t}=Ce();return{containerPadding:s?1:t?2:3,sectionPadding:s?2:t?3:4,itemPadding:s?1:2,smallGap:s?1:2,mediumGap:s?2:3,largeGap:s?3:4,sectionMargin:s?2:3,itemMargin:s?1:2}}function zo(){const{isMobile:s}=Ce();return{getModalSize:(r="medium")=>s?{width:"95vw",height:r==="fullscreen"?"95vh":"auto",maxHeight:"90vh",margin:1}:{small:{width:400,maxWidth:"90vw"},medium:{width:600,maxWidth:"90vw"},large:{width:800,maxWidth:"90vw"},fullscreen:{width:"90vw",height:"90vh"}}[r]}}function Lo({setView:s,view:t}){const r=Ns(),n=Ms(),{isMobile:o,isTablet:l,isDesktop:i}=Ce(),[a,c]=h.useState(!1),[d,p]=h.useState([]),[f,w]=h.useState(null),[v,x]=h.useState(null);h.useEffect(()=>{async function m(){const{data:N,error:P}=await L.from("users").select("*");!P&&N&&p(N)}m();async function C(N){if(w(N),N){let{data:P}=await L.from("users").select("*").eq("id",N.id).single();P||(await L.from("users").upsert({id:N.id,email:N.email,name:N.user_metadata?.full_name||null,avatar_url:N.user_metadata?.avatar_url||null,role:"employee"}),P={...N,role:"employee"}),x(P)}else x(null)}L.auth.getUser().then(({data:N})=>C(N.user));const{data:T}=L.auth.onAuthStateChange((N,P)=>{C(P?.user??null)});return()=>{T?.subscription.unsubscribe()}},[]),h.useEffect(()=>{l&&c(!0)},[l,i]);const j=m=>{r(m.route),s(m.value),l&&c(!0)},b=()=>{c(!a)},D=(m,C)=>{j({value:C,route:m})},k=m=>n.pathname===m;return e.jsxs(u,{className:"Sidebar",sx:{display:o?"none":"flex",position:{xs:"fixed",md:"sticky"},transform:{xs:"translateX(calc(100% * (var(--SideNavigation-slideIn, 0) - 1)))",md:"none"},transition:"transform 0.4s, width 0.4s",zIndex:1e4,height:"100vh",maxHeight:"100vh",width:"var(--Sidebar-width)",top:0,p:2,flexShrink:0,flexDirection:"column",gap:2,borderRight:"1px solid",borderColor:"divider",background:"var(--joy-palette-background-surface, #fff)",overflow:"hidden"},children:[e.jsx(qr,{styles:m=>({":root":{"--Sidebar-width":a?"60px":"220px",[m.breakpoints.up("lg")]:{"--Sidebar-width":a?"60px":"240px"}}})}),e.jsx(u,{className:"Sidebar-overlay",sx:{position:"fixed",zIndex:9998,top:0,left:0,width:"100vw",height:"100vh",opacity:"var(--SideNavigation-slideIn)",backgroundColor:"var(--joy-palette-background-backdrop)",transition:"opacity 0.4s",transform:{xs:"translateX(calc(100% * (var(--SideNavigation-slideIn, 0) - 1) + var(--SideNavigation-slideIn, 0) * var(--Sidebar-width, 0px)))",lg:"translateX(-100%)"}}}),e.jsxs(u,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(te,{size:"sm",variant:"plain",onClick:b,sx:{p:.5,borderRadius:1,"&:hover":{bgcolor:"neutral.100"}},children:e.jsx("img",{src:"/favicon.svg",alt:"Logo",style:{width:28,height:28,borderRadius:6}})}),!a&&e.jsxs(e.Fragment,{children:[e.jsx(g,{level:"title-lg",children:"Smartbuy"}),e.jsx(Oo,{sx:{ml:"auto"}})]})]}),!a&&e.jsx(B,{size:"sm",startDecorator:e.jsx(no,{}),placeholder:"Search"}),e.jsx(u,{sx:{minHeight:0,overflowY:"auto",overflowX:"hidden",flex:1,display:"flex",flexDirection:"column",[`& .${Bn.root}`]:{gap:1.5}},children:e.jsx(ps,{size:"sm",sx:{gap:1,"--List-nestedInsetStart":"30px","--ListItem-radius":m=>m.vars.radius.sm},children:["Sales","Support","Operations","Marketing"].map(m=>e.jsx(fs,{nested:!0,children:e.jsx(No,{defaultExpanded:!a,renderToggle:({open:C,setOpen:T})=>a?e.jsx(ms,{title:m,placement:"right",arrow:!0,children:e.jsx(bt,{onClick:()=>T(!C),children:Tt[m][0]?.icon})}):e.jsxs(bt,{onClick:()=>T(!C),children:[Tt[m][0]?.icon,e.jsx(Ys,{children:e.jsx(g,{level:"title-sm",children:m})}),e.jsx(oo,{sx:[C?{transform:"rotate(180deg)"}:{transform:"none"}]})]}),children:e.jsx(ps,{sx:{gap:.5},children:Tt[m].map(C=>e.jsx(fs,{children:a?e.jsx(ms,{title:C.label,placement:"right",arrow:!0,children:e.jsx(bt,{selected:k(C.route),onClick:()=>D(C.route,C.value),sx:{justifyContent:"center",px:1,width:"100%"},children:C.icon})}):e.jsxs(bt,{selected:k(C.route),onClick:()=>D(C.route,C.value),sx:{justifyContent:"flex-start",px:2,width:"100%"},children:[C.icon,e.jsx(Ys,{children:e.jsx(g,{level:"body-sm",children:C.label})})]})},C.value))})})},m))})}),e.jsx(u,{sx:{flexShrink:0}}),e.jsx(wt,{}),e.jsxs(u,{sx:{display:"flex",gap:1,alignItems:"center",minHeight:48,cursor:"pointer",borderRadius:"sm","&:hover":{bgcolor:"neutral.50"}},onClick:()=>D("/settings","settings"),children:[e.jsx(ce,{variant:"outlined",size:"sm",src:v?.avatar_url||f?.user_metadata?.avatar_url||void 0}),!a&&e.jsxs(u,{sx:{minWidth:0,flex:1},children:[e.jsx(g,{level:"title-sm",children:v?.name||f?.user_metadata?.full_name||f?.email||"Not signed in"}),e.jsx(g,{level:"body-xs",children:v?.email||f?.email||""})]})]})]})}function No({defaultExpanded:s=!1,renderToggle:t,children:r}){const[n,o]=h.useState(s);return e.jsxs(h.Fragment,{children:[t({open:n,setOpen:o}),e.jsx(u,{sx:{display:"grid",transition:"0.2s ease","& > *":{overflow:"hidden"},gridTemplateRows:n?"1fr":"0fr"},children:r})]})}const Mo=$s(Lo);function je({children:s,variant:t="page",padding:r="medium",fullHeight:n=!1,className:o}){const{isMobile:l}=Ce(),i=sn(),a=()=>r==="none"?0:{small:i.itemPadding,medium:i.containerPadding,large:i.sectionPadding}[r]||i.containerPadding,c=()=>{const d={p:a(),boxSizing:"border-box"};switch(t){case"page":return{...d,height:n?"100%":"auto",overflow:"auto",width:"100%"};case"dialog":return{...d,height:"auto",overflow:"visible"};case"form":return{...d,display:"flex",flexDirection:"column",gap:i.mediumGap};case"card":return{...d,borderRadius:1,bgcolor:"background.surface"};case"table-page":return{width:"100%",overflow:"visible",pt:l?1:2,pl:l?1:2,pr:l?1:2,pb:l?1:2,boxSizing:"border-box"};default:return d}};return e.jsx(u,{sx:c(),className:o,children:s})}function Ut({open:s,onClose:t,children:r,title:n,size:o="medium",showCloseButton:l=!0,actions:i}){const{getModalSize:a}=zo();return e.jsx(Ie,{open:s,onClose:t,children:e.jsxs(Ee,{sx:a(o),children:[l&&e.jsx(Ge,{}),n&&e.jsx(_s,{children:n}),e.jsx(Is,{children:r}),i&&e.jsx(Es,{children:i})]})})}const $e=({children:s})=>e.jsx(u,{sx:{display:"flex",flexDirection:"column",width:"100%",flex:1,bgcolor:"background.body"},children:s}),Fo=({open:s,creating:t,newOrder:r,setNewOrder:n,onClose:o,onCreate:l})=>{const[i,a]=h.useState([]),[c,d]=h.useState([{id:crypto.randomUUID(),product:null,quantity:1,unitprice:0,discount:0}]),[p,f]=h.useState(!1),[w,v]=h.useState(null),[x,j]=h.useState(null),[b,D]=h.useState(0),[k,m]=h.useState(!1),[C,T]=h.useState(null),[N,P]=h.useState(!1);h.useEffect(()=>{s&&(d([{id:crypto.randomUUID(),product:null,quantity:1,unitprice:0,discount:0}]),v(null),n(U=>({...U,date:U.date||new Date().toISOString().slice(0,10)})))},[s]),h.useEffect(()=>{s&&(f(!0),j(null),L.from("Products").select("*").then(({data:U,error:S})=>{!S&&U?(U.length===0&&j("No products available. Please add products first."),a(U.map(_=>({id:_.uuid||_.id,ProductName:_.ProductName,SalesPrice:_.SalesPrice??0})))):j("Failed to load products. Please try again later."),f(!1)}))},[s]);const W=()=>{d(U=>[...U,{id:crypto.randomUUID(),product:null,quantity:1,unitprice:0,discount:b}])},A=U=>{d(S=>S.filter((_,E)=>E!==U))},M=(U,S,_)=>{d(E=>E.map(($,re)=>{if(re!==U)return $;if(S==="product"&&_){const he=i.find(de=>de.id===_.id);return{...$,product:_,unitprice:he?.SalesPrice??0}}return S==="product"&&!_?{...$,product:null,unitprice:0}:{...$,[S]:_}}))},F=U=>{U.preventDefault();const S=c.filter(_=>_.product&&_.product.id&&_.quantity>0).map(_=>({product_uuid:_.product.id,quantity:_.quantity,unitprice:_.unitprice,discount:_.discount}));if(S.length===0){v("Please add at least one valid order item.");return}v(null),l(S,b)};return e.jsx(Ie,{open:s,onClose:o,"aria-labelledby":"create-order-modal",children:e.jsxs(Ee,{"aria-labelledby":"create-order-modal",sx:{maxWidth:600,width:"100%",minWidth:{xs:300,sm:400}},children:[e.jsx(Ge,{}),e.jsx(g,{id:"create-order-modal",level:"h4",sx:{mb:2},children:"Create Order"}),e.jsxs("form",{onSubmit:F,children:[e.jsxs(ne,{sx:{mb:2},required:!0,children:[e.jsx(ee,{children:"Date"}),e.jsx(B,{type:"date",value:r.date,onChange:U=>n(S=>({...S,date:U.target.value})),required:!0})]}),e.jsxs(ne,{sx:{mb:2},required:!0,children:[e.jsx(ee,{children:"Status"}),e.jsxs(ie,{value:r.status,onChange:(U,S)=>n(_=>({..._,status:S||"Paid"})),children:[e.jsx(z,{value:"Paid",children:"Paid"}),e.jsx(z,{value:"Refunded",children:"Refunded"}),e.jsx(z,{value:"Cancelled",children:"Cancelled"})]})]}),e.jsxs(ne,{sx:{mb:2},required:!0,children:[e.jsx(ee,{children:"Customer Name"}),e.jsx(B,{value:r.customer_name,onChange:U=>n(S=>({...S,customer_name:U.target.value})),required:!0})]}),e.jsxs(ne,{sx:{mb:2},required:!0,children:[e.jsx(ee,{children:"Customer Email"}),e.jsx(B,{type:"email",value:r.customer_email,onChange:U=>n(S=>({...S,customer_email:U.target.value})),required:!0})]}),e.jsxs(ne,{sx:{mb:2},required:!0,children:[e.jsx(ee,{children:"Order Discount (%)"}),e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(B,{type:"number",value:b,disabled:c.length>0&&!(c.length===1&&!c[0].product),onChange:U=>{const S=Math.max(0,Math.min(100,Math.floor(Number(U.target.value))));D(S),d(_=>_.map(E=>({...E,discount:S})))},slotProps:{input:{min:0,max:100,step:1}},required:!0,placeholder:"Order Discount %",sx:{flex:1}}),(c.length>1||c.length===1&&c[0].product)&&e.jsx(q,{size:"sm",variant:"outlined",onClick:()=>m(!0),children:"Edit"})]})]}),w&&e.jsx(g,{color:"danger",sx:{mb:1},children:w}),e.jsx(wt,{sx:{my:2}}),e.jsx(u,{sx:{mb:1,fontWeight:"lg",fontSize:"lg"},children:"Order Items"}),x&&e.jsx(g,{color:"danger",sx:{mb:1},children:x}),c.map((U,S)=>e.jsxs(u,{sx:{display:"flex",gap:1,alignItems:"center",mb:1},children:[e.jsx(Ds,{options:i,getOptionLabel:_=>_.ProductName,isOptionEqualToValue:(_,E)=>_.id===E.id,value:U.product,onChange:(_,E)=>M(S,"product",E),loading:p,placeholder:p?"Loading...":"Search product",sx:{minWidth:220},disabled:i.length===0,required:!0,renderOption:(_,E)=>e.jsx("li",{..._,children:E.ProductName})}),e.jsx(B,{type:"number",value:U.quantity,onChange:_=>M(S,"quantity",Math.max(1,Number(_.target.value))),sx:{width:80},required:!0,slotProps:{input:{min:1}}}),e.jsx(B,{type:"number",value:U.unitprice,onChange:_=>M(S,"unitprice",Math.max(0,Number(_.target.value))),sx:{width:100},required:!0,slotProps:{input:{min:0,step:.01}},placeholder:"Unit Price"}),e.jsx(B,{type:"number",value:U.discount,onChange:_=>M(S,"discount",Math.max(0,Math.min(100,Math.floor(Number(_.target.value))))),sx:{width:80},required:!0,slotProps:{input:{min:0,max:100,step:1}},placeholder:"Discount %"}),e.jsx(te,{size:"sm",color:"danger",onClick:()=>A(S),disabled:c.length===1,children:e.jsx(at,{})})]},U.id)),e.jsx(q,{startDecorator:e.jsx(ue,{}),variant:"soft",size:"sm",onClick:W,sx:{mb:2},disabled:!!x,children:"Add Item"}),e.jsx(Ie,{open:k,onClose:()=>m(!1),children:e.jsxs(Ee,{sx:{minWidth:350},children:[e.jsx(g,{level:"title-md",sx:{mb:1},children:"Change Order Discount"}),e.jsxs(ne,{sx:{mb:2},required:!0,children:[e.jsx(ee,{children:"Change discount to (%)"}),e.jsx(B,{type:"number",value:C??b,onChange:U=>T(Math.max(0,Math.min(100,Math.floor(Number(U.target.value))))),slotProps:{input:{min:0,max:100,step:1}},required:!0,autoFocus:!0})]}),e.jsx(g,{sx:{mb:2},children:"How do you want to apply the new order discount?"}),e.jsxs(u,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[e.jsx(q,{onClick:()=>{D(C),d(U=>U.map(S=>({...S,discount:C}))),m(!1),T(null)},children:"Overwrite all"}),e.jsx(q,{onClick:()=>{D(C),d(U=>U.map(S=>S.discount<C?{...S,discount:C}:S)),m(!1),T(null)},children:"Set discount on lower"}),e.jsx(q,{variant:"plain",onClick:()=>{m(!1),T(null)},children:"Cancel"})]})]})}),e.jsxs(u,{sx:{display:"flex",gap:2,mt:2},children:[e.jsx(q,{type:"submit",loading:t,color:"primary",disabled:!!x,children:"Create"}),e.jsx(q,{variant:"plain",onClick:o,disabled:t,children:"Cancel"})]})]})]})})},_e={currency:"DKK",locale:"da-DK",symbol:"kr"};function it(s){return s==null||isNaN(s)?"0,00 kr":new Intl.NumberFormat(_e.locale,{style:"currency",currency:_e.currency,minimumFractionDigits:2,maximumFractionDigits:2}).format(s)}function dt(s,t=!0){if(s==null||isNaN(s))return t?"0,00 kr":"kr 0,00";const r=new Intl.NumberFormat(_e.locale,{minimumFractionDigits:2,maximumFractionDigits:2}).format(s);return t?`${r} kr`:`kr ${r}`}function ur(s){return{...s,salesprice_currency:_e.currency,salesprice_exchrate:1,costprice_currency:_e.currency,costprice_exchrate:1}}function $o(s){return{...s,order_total_currency:_e.currency,order_total_exchrate:1}}function qo(s){return{...s,unitprice_currency:_e.currency,unitprice_exchrate:1,price_currency:_e.currency,price_exchrate:1}}function Uo(s){return{...s,unit_price_currency:_e.currency,unit_price_exchrate:1}}function Bo({open:s,onClose:t,selectedOrder:r,fetchOrderItems:n}){const[o,l]=h.useState([]),[i,a]=h.useState(!1);return h.useEffect(()=>{async function c(){if(r){a(!0);const d=await n(r.uuid);l(d),a(!1)}else l([])}s&&r?c():l([])},[s,r,n]),e.jsx(Ie,{open:s,onClose:t,"aria-labelledby":"order-details-modal",children:e.jsxs(Ee,{"aria-labelledby":"order-details-modal",sx:{maxWidth:600,width:"100%"},children:[e.jsx(Ge,{}),e.jsx(g,{id:"order-details-modal",level:"title-md",fontWeight:"lg",sx:{mb:2},children:"Order Details"}),r&&e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(g,{level:"body-sm",sx:{color:"text.secondary"},children:["Order ID: ",r.uuid]}),e.jsxs(g,{level:"body-sm",sx:{color:"text.secondary"},children:["Date: ",new Date(r.date).toLocaleString()]}),e.jsxs(g,{level:"body-sm",sx:{color:"text.secondary"},children:["Status: ",r.status]})]}),e.jsx(wt,{}),e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(g,{level:"body-sm",fontWeight:"md",children:"Customer Information"}),e.jsxs(g,{level:"body-sm",sx:{color:"text.secondary"},children:["Name: ",r.customer.name]}),e.jsxs(g,{level:"body-sm",sx:{color:"text.secondary"},children:["Email: ",r.customer.email]})]}),e.jsx(wt,{}),e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(g,{level:"body-sm",fontWeight:"md",children:"Ordered Items"}),i?e.jsx(g,{level:"body-sm",sx:{color:"text.secondary"},children:"Loading items..."}):e.jsxs(We,{size:"sm",sx:{minWidth:500},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{style:{textAlign:"right"},children:"Quantity"}),e.jsx("th",{style:{textAlign:"right"},children:"Unit Price"}),e.jsx("th",{style:{textAlign:"right"},children:"Discount (%)"}),e.jsx("th",{style:{textAlign:"right"},children:"Total Price"})]})}),e.jsx("tbody",{children:o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{textAlign:"center",padding:"16px"},children:e.jsx(g,{level:"body-sm",sx:{color:"text.secondary"},children:"No items found for this order."})})}):o.map(function(c){return e.jsxs("tr",{children:[e.jsx("td",{children:c.name||c.product_uuid}),e.jsx("td",{style:{textAlign:"right"},children:c.quantity??"-"}),e.jsx("td",{style:{textAlign:"right"},children:c.unitprice!=null?dt(c.unitprice):"-"}),e.jsx("td",{style:{textAlign:"right"},children:c.discount!=null?`${Number(c.discount).toFixed(2)}%`:"-"}),e.jsx("td",{style:{textAlign:"right"},children:c.price!=null?dt(c.price):"-"})]},c.uuid)})})]})]})]})]})})}const Y={sizes:{small:"0.875rem",xlarge:"1.5rem"}},we={fontSize:Y.sizes.small},Wo=()=>{const{isMobile:s}=Ce(),[t,r]=h.useState([]),[n,o]=h.useState(!1),[l,i]=h.useState(""),[a,c]=h.useState(""),[d,p]=h.useState(""),[f,w]=h.useState(""),[v,x]=h.useState(!1),[j,b]=h.useState(!1),[D,k]=h.useState(!1),[m,C]=h.useState(null),[T,N]=h.useState(!1),[P,W]=h.useState({date:new Date().toISOString().split("T")[0],status:"Paid",customer_name:"",customer_email:""}),[A,M]=h.useState(!1),[F,U]=h.useState(""),[S,_]=h.useState("success"),E=(I,R="success")=>{U(I),_(R),M(!0)},$=I=>{switch(I){case"Paid":return"success";case"Refunded":return"warning";case"Cancelled":return"danger";default:return"neutral"}},re=I=>{switch(I){case"Paid":return e.jsx(ir,{});case"Refunded":return e.jsx(ir,{});case"Cancelled":return e.jsx($t,{});default:return e.jsx($t,{})}},he=async()=>{o(!0);try{const{data:I,error:R}=await L.from("Orders").select("*");if(R){console.error("Error fetching orders:",R),E("Failed to fetch orders","danger");return}if(I){const H=I.map(J=>({uuid:J.uuid,date:J.date||J.created_at||J["Created at"]||"",status:J.status||"Paid",customer:J.customer||{initial:J.customer_initial||(J.customer_name?J.customer_name[0]:"?"),name:J.customer_name||"Unknown",email:J.customer_email||""},order_number_display:J.order_number_display,order_total:typeof J.order_total=="number"?J.order_total:0,created_by:J.created_by||"",created_by_name:J.created_by_name||"",created_by_email:J.created_by_email||"",category:J.category||"purchase"})).sort((J,be)=>{const ye=new Date(J.date||0);return new Date(be.date||0).getTime()-ye.getTime()});r(H)}}catch(I){console.error("Error fetching orders:",I),E("Failed to fetch orders","danger")}finally{o(!1)}},de=async I=>{try{const{data:R,error:H}=await L.from("OrderItems").select("*, Products:product_uuid(ProductName)").eq("order_uuid",I);return H?(console.error("Error fetching order items:",H),[]):R?.map(J=>({...J,product_name:J.Products?.ProductName||J.product_uuid}))||[]}catch(R){return console.error("Error fetching order items:",R),[]}};h.useEffect(()=>{he()},[]);const ae=t.filter(I=>{const R=!l||I.order_number_display?.toString().toLowerCase().includes(l.toLowerCase())||I.customer.name.toLowerCase().includes(l.toLowerCase())||I.customer.email.toLowerCase().includes(l.toLowerCase()),H=!a||I.status===a,J=!d||I.category===d,be=!f||I.customer.name===f;return R&&H&&J&&be}),ze=Array.from(new Set(t.map(I=>I.status))),He=Array.from(new Set(t.map(I=>I.category||"purchase"))),xt=Array.from(new Set(t.map(I=>I.customer.name))),Le=I=>{const R=t.find(H=>H.uuid===I||H.order_number_display===I);R&&(C(R),k(!0))},Ae=()=>{b(!0)},pt=async(I,R)=>{N(!0);try{const H=I.reduce((Oe,oe)=>Oe+oe.quantity*oe.unitprice*(1-oe.discount/100),0)-R,J=$o({date:P.date,status:P.status,customer_name:P.customer_name,customer_email:P.customer_email,order_total:H}),{data:be,error:ye}=await L.from("Orders").insert(J).select().single();if(ye){console.error("Error creating order:",ye),E("Failed to create order","danger");return}if(I.length>0){const Oe=I.map(Rt=>qo({order_uuid:be.uuid,product_uuid:Rt.product_uuid,quantity:Rt.quantity,unitprice:Rt.unitprice,discount_percent:Rt.discount})),{error:oe}=await L.from("OrderItems").insert(Oe);oe&&(console.error("Error creating order items:",oe),E("Order created but failed to add items","warning"))}E("Order created successfully","success"),b(!1),W({date:new Date().toISOString().split("T")[0],status:"Paid",customer_name:"",customer_email:""}),he()}catch(H){console.error("Error creating order:",H),E("Failed to create order","danger")}finally{N(!1)}},Ke=()=>{x(!1)},O=()=>{c(""),p(""),w("")},G=()=>e.jsxs(u,{sx:{pb:2},children:[e.jsxs(je,{variant:"page",padding:"medium",children:[e.jsxs(u,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(B,{placeholder:"Search orders...",value:l,onChange:I=>i(I.target.value),startDecorator:e.jsx(ge,{}),sx:{flex:1,fontSize:"16px"}}),e.jsx(te,{variant:"soft",onClick:()=>x(!0),sx:{flexShrink:0},children:e.jsx(zs,{})})]}),(a||d||f)&&e.jsxs(u,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:[a&&e.jsxs(se,{size:"sm",variant:"soft",color:"primary",children:["Status: ",a]}),d&&e.jsxs(se,{size:"sm",variant:"soft",color:"primary",children:["Category: ",d]}),f&&e.jsxs(se,{size:"sm",variant:"soft",color:"primary",children:["Customer: ",f]})]}),n&&e.jsx(De,{sx:{mb:2}})]}),e.jsx(u,{children:ae.length===0?e.jsx(u,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:n?"Loading orders...":"No orders found"})}):ae.map(I=>e.jsx(u,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider",cursor:"pointer","&:hover":{bgcolor:"background.level1"}},onClick:()=>Le(I.uuid),children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(u,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${$(I.status)}.100`,color:`${$(I.status)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",flexShrink:0},children:re(I.status)}),e.jsxs(u,{sx:{flex:1,minWidth:0},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsxs(g,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:["Order #",I.order_number_display||I.uuid.substring(0,8)]}),e.jsx(se,{size:"sm",color:$(I.status),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content"},children:I.status})]}),e.jsxs(g,{level:"body-xs",color:"neutral",sx:{mb:.5},children:[I.customer.name," • ",new Date(I.date).toLocaleDateString()]}),I.order_total&&e.jsx(g,{level:"body-xs",sx:{fontWeight:"bold",color:"primary.600"},children:it(I.order_total)})]})]})},I.uuid))}),e.jsx(te,{color:"primary",variant:"soft",size:"sm",sx:{position:"fixed",bottom:80,right:16,zIndex:1e3,borderRadius:"8px",width:40,height:40,boxShadow:"sm",bgcolor:"primary.100","&:hover":{bgcolor:"primary.200",boxShadow:"md"}},onClick:Ae,children:e.jsx(ue,{fontSize:"small"})})]}),xe=()=>e.jsxs(je,{variant:"table-page",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:Y.sizes.xlarge},children:"Orders"}),e.jsxs(u,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(B,{placeholder:"Search orders...",sx:{flex:1,fontSize:Y.sizes.small},value:l,onChange:I=>i(I.target.value),startDecorator:e.jsx(ge,{})}),e.jsxs(ie,{placeholder:"Filter status",value:a,onChange:(I,R)=>c(R||""),sx:{minWidth:160,fontSize:Y.sizes.small},children:[e.jsx(z,{value:"",children:"All Statuses"}),ze.map(I=>e.jsx(z,{value:I,children:I},I))]}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(ue,{}),onClick:Ae,sx:{fontSize:Y.sizes.small},children:"Create Order"})]}),e.jsxs(ke,{sx:{overflow:"visible"},children:[n&&e.jsx(De,{}),e.jsxs(We,{"aria-label":"Orders",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:we,children:"Order #"}),e.jsx("th",{style:we,children:"Date"}),e.jsx("th",{style:we,children:"Customer"}),e.jsx("th",{style:we,children:"Status"}),e.jsx("th",{style:we,children:"Total"}),e.jsx("th",{style:we,children:"Actions"})]})}),e.jsxs("tbody",{children:[ae.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{textAlign:"center",color:"#888",...we},children:n?"Loading orders...":"No orders found."})}),ae.map(I=>e.jsxs("tr",{style:{cursor:"pointer"},children:[e.jsx("td",{style:we,children:I.order_number_display||I.uuid.substring(0,8)}),e.jsx("td",{style:we,children:new Date(I.date).toLocaleDateString()}),e.jsx("td",{style:we,children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(u,{sx:{width:24,height:24,borderRadius:"50%",bgcolor:"primary.100",color:"primary.600",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold"},children:I.customer.initial}),e.jsxs(u,{children:[e.jsx(g,{level:"body-sm",sx:{fontWeight:"bold"},children:I.customer.name}),e.jsx(g,{level:"body-xs",color:"neutral",children:I.customer.email})]})]})}),e.jsx("td",{style:we,children:e.jsx(se,{size:"sm",variant:"soft",color:$(I.status),children:I.status})}),e.jsx("td",{style:we,children:e.jsx(g,{level:"body-sm",sx:{fontWeight:"bold"},children:I.order_total?it(I.order_total):"N/A"})}),e.jsx("td",{style:we,children:e.jsx(q,{size:"sm",variant:"soft",onClick:()=>Le(I.uuid),children:"View"})})]},I.uuid))]})]})]})]});return e.jsxs($e,{children:[s?e.jsx(G,{}):e.jsx(xe,{}),e.jsx(Fo,{open:j,creating:T,newOrder:P,setNewOrder:W,onClose:()=>b(!1),onCreate:pt}),e.jsx(Bo,{open:D,onClose:()=>k(!1),selectedOrder:m,fetchOrderItems:de}),s&&e.jsx(Ut,{open:v,onClose:Ke,title:"Filter Orders",size:"medium",actions:e.jsxs(u,{sx:{display:"flex",gap:2},children:[e.jsx(q,{variant:"plain",onClick:O,sx:we,children:"Clear All"}),e.jsx(q,{variant:"solid",onClick:Ke,sx:we,children:"Apply"})]}),children:e.jsxs(Q,{spacing:2,children:[e.jsxs(ne,{children:[e.jsx(ee,{children:"Status"}),e.jsxs(ie,{placeholder:"All statuses",value:a,onChange:(I,R)=>c(R||""),children:[e.jsx(z,{value:"",children:"All Statuses"}),ze.map(I=>e.jsx(z,{value:I,children:I},I))]})]}),e.jsxs(ne,{children:[e.jsx(ee,{children:"Category"}),e.jsxs(ie,{placeholder:"All categories",value:d,onChange:(I,R)=>p(R||""),children:[e.jsx(z,{value:"",children:"All Categories"}),He.map(I=>e.jsx(z,{value:I,children:I},I))]})]}),e.jsxs(ne,{children:[e.jsx(ee,{children:"Customer"}),e.jsxs(ie,{placeholder:"All customers",value:f,onChange:(I,R)=>w(R||""),children:[e.jsx(z,{value:"",children:"All Customers"}),xt.map(I=>e.jsx(z,{value:I,children:I},I))]})]})]})}),e.jsx(Gt,{open:A,onClose:()=>M(!1),autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{top:16,zIndex:2e3},children:e.jsx(Kt,{color:S,variant:"solid",sx:{width:"100%"},children:F})})]})};function Ho({open:s,onClose:t,product:r,onSave:n}){const[o,l]=h.useState({ProductName:r?.ProductName||"",SalesPrice:r?.SalesPrice?.toString()||"",CostPrice:r?.CostPrice?.toString()||"",ImageUrl:r?.ImageUrl||""}),[i,a]=h.useState(!1),[c,d]=h.useState(!1),p=h.useRef(null);h.useEffect(()=>{l({ProductName:r?.ProductName||"",SalesPrice:r?.SalesPrice?.toString()||"",CostPrice:r?.CostPrice?.toString()||"",ImageUrl:r?.ImageUrl||""})},[r]);const f=async x=>{const j=x.target.files?.[0];if(j){if(!j.type.startsWith("image/")){alert("Please select a valid image file");return}if(j.size>5*1024*1024){alert("Image size must be less than 5MB");return}try{d(!0);const b=j.name.split(".").pop(),k=`products/${`product-${Date.now()}.${b}`}`,{data:m,error:C}=await L.storage.from("product-images").upload(k,j,{cacheControl:"3600",upsert:!0});if(C)throw new Error(`Upload failed: ${C.message}`);const{data:{publicUrl:T}}=L.storage.from("product-images").getPublicUrl(k);l(N=>({...N,ImageUrl:T}))}catch(b){console.error("Image upload failed:",b),alert("Failed to upload image. Please try again.")}finally{d(!1),x.target&&(x.target.value="")}}},w=()=>{l(x=>({...x,ImageUrl:""}))},v=async()=>{a(!0),await n(o),a(!1)};return e.jsx(Ie,{open:s,onClose:t,"aria-labelledby":"product-table-form-title",children:e.jsxs(Ee,{sx:{minWidth:{xs:"90vw",sm:500}},children:[e.jsx(_s,{id:"product-table-form-title",children:r?"Edit Product":"Add Product"}),e.jsx(Is,{children:e.jsxs(Q,{spacing:2,children:[e.jsxs(u,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:1},children:[e.jsx(g,{level:"body-sm",sx:{alignSelf:"flex-start"},children:"Product Image"}),o.ImageUrl?e.jsxs(u,{sx:{position:"relative"},children:[e.jsx(ce,{src:o.ImageUrl,alt:"Product",variant:"soft",sx:{width:120,height:120,borderRadius:2,border:"2px solid",borderColor:"neutral.300"}}),e.jsx(te,{size:"sm",variant:"solid",color:"danger",onClick:w,sx:{position:"absolute",top:-8,right:-8,minHeight:24,minWidth:24},children:e.jsx(at,{fontSize:"small"})})]}):e.jsx(u,{sx:{width:120,height:120,borderRadius:2,border:"2px dashed",borderColor:"neutral.300",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer","&:hover":{borderColor:"primary.500",backgroundColor:"primary.50"}},onClick:()=>p.current?.click(),children:e.jsx(io,{sx:{fontSize:32,color:"neutral.400"}})}),e.jsx("input",{ref:p,type:"file",accept:"image/*",onChange:f,style:{display:"none"}}),e.jsxs(Q,{direction:"row",spacing:1,children:[e.jsx(q,{size:"sm",variant:"outlined",onClick:()=>p.current?.click(),loading:c,disabled:c,children:o.ImageUrl?"Change Image":"Upload Image"}),o.ImageUrl&&e.jsx(q,{size:"sm",variant:"plain",color:"danger",onClick:w,children:"Remove"})]})]}),e.jsx(B,{name:"ProductName",value:o.ProductName,onChange:x=>l({...o,ProductName:x.target.value}),placeholder:"Product Name"}),e.jsx(B,{name:"SalesPrice",value:o.SalesPrice,onChange:x=>l({...o,SalesPrice:x.target.value}),placeholder:"Sales Price",type:"number"}),e.jsx(B,{name:"CostPrice",value:o.CostPrice,onChange:x=>l({...o,CostPrice:x.target.value}),placeholder:"Cost Price",type:"number"})]})}),e.jsxs(Es,{children:[e.jsx(q,{onClick:t,variant:"plain",disabled:i||c,children:"Cancel"}),e.jsx(q,{onClick:v,variant:"solid",loading:i,disabled:i||c,children:"Save"})]})]})})}const hr=$s(Ho),pe={fontSize:Y.sizes.small},Vo=()=>{const{isMobile:s}=Ce(),[t,r]=h.useState([]),[n,o]=h.useState({}),[l,i]=h.useState(!1),[a,c]=h.useState(!1),[d,p]=h.useState(!1),[f,w]=h.useState(""),[v,x]=h.useState(""),[j,b]=h.useState(!1),[D,k]=h.useState(!1),[m,C]=h.useState(!1),[T,N]=h.useState(null),[P,W]=h.useState(!1),[A,M]=h.useState(""),[F,U]=h.useState("success"),S=(O,G="success")=>{M(O),U(G),W(!0)},_=O=>O<=0?{status:"Out of Stock",color:"danger"}:O<=10?{status:"Low Stock",color:"warning"}:{status:"In Stock",color:"success"},E=O=>{const G=_(O);return e.jsx(u,{sx:{width:20,height:20,borderRadius:"50%",bgcolor:`${G.color}.100`,color:`${G.color}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold"},children:e.jsx(lo,{sx:{fontSize:"12px"}})})},$=async()=>{i(!0);try{const{data:O,error:G}=await L.from("Products").select("*").order("CreatedAt",{ascending:!1});if(G){console.error("Error fetching products:",G),S("Failed to fetch products","danger");return}O&&(r(O),await re(O))}catch(O){console.error("Error fetching products:",O),S("Failed to fetch products","danger")}finally{i(!1)}},re=async O=>{c(!0);try{const{data:G,error:xe}=await L.from("stock_movements").select("product_id, movement_type, quantity");if(xe){console.error("Error fetching stock data:",xe);return}if(G){const I={};O.forEach(R=>{const J=G.filter(be=>be.product_id===R.uuid).reduce((be,ye)=>{switch(ye.movement_type){case"incoming":case"adjustment":return be+(ye.quantity||0);case"outgoing":return be-(ye.quantity||0);default:return be}},0);I[R.uuid]=J}),o(I)}}catch(G){console.error("Error fetching stock levels:",G)}finally{c(!1)}};h.useEffect(()=>{$()},[]);const he=t.filter(O=>{const G=!f||O.ProductName.toLowerCase().includes(f.toLowerCase())||O.ProductID?.toLowerCase().includes(f.toLowerCase()),xe=n[O.uuid]||0,I=!v||v==="in-stock"&&xe>10||v==="low-stock"&&xe>0&&xe<=10||v==="out-of-stock"&&xe<=0;return G&&I}),de=()=>{k(!0)},ae=O=>{N(O),C(!0)},ze=async O=>{if(confirm("Are you sure you want to delete this product?")){p(!0);try{const{error:G}=await L.from("Products").delete().eq("uuid",O);if(G){console.error("Error deleting product:",G),S("Failed to delete product","danger");return}r(t.filter(xe=>xe.uuid!==O)),S("Product deleted successfully","success")}catch(G){console.error("Error deleting product:",G),S("Failed to delete product","danger")}finally{p(!1)}}},He=async O=>{p(!0);try{const G=ur({ProductName:O.ProductName,SalesPrice:parseFloat(O.SalesPrice),CostPrice:parseFloat(O.CostPrice),CreatedAt:new Date().toISOString()}),{data:xe,error:I}=await L.from("Products").insert([G]).select().single();if(I){console.error("Error adding product:",I),S("Failed to add product","danger");return}S("Product added successfully","success"),k(!1),$()}catch(G){console.error("Error adding product:",G),S("Failed to add product","danger")}finally{p(!1)}},xt=async O=>{if(T){p(!0);try{const G=ur({ProductName:O.ProductName,SalesPrice:parseFloat(O.SalesPrice),CostPrice:parseFloat(O.CostPrice),ImageUrl:O.ImageUrl||null}),{error:xe}=await L.from("Products").update(G).eq("uuid",T.uuid);if(xe){console.error("Error updating product:",xe),S("Failed to update product","danger");return}S("Product updated successfully","success"),C(!1),N(null),$()}catch(G){console.error("Error updating product:",G),S("Failed to update product","danger")}finally{p(!1)}}},Le=()=>{b(!1)},Ae=()=>{x("")},pt=()=>e.jsxs(u,{sx:{pb:2},children:[e.jsxs(je,{variant:"page",padding:"medium",children:[e.jsxs(u,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(B,{placeholder:"Search products...",value:f,onChange:O=>w(O.target.value),startDecorator:e.jsx(ge,{}),sx:{flex:1,fontSize:"16px"}}),e.jsx(te,{variant:"soft",onClick:()=>b(!0),sx:{flexShrink:0},children:e.jsx(zs,{})})]}),v&&e.jsx(u,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:e.jsxs(se,{size:"sm",variant:"soft",color:"primary",children:["Stock: ",v.replace("-"," ")]})}),l&&e.jsx(De,{sx:{mb:2}})]}),e.jsx(u,{children:he.length===0?e.jsx(u,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:l?"Loading products...":"No products found"})}):he.map(O=>e.jsx(u,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(u,{sx:{flexShrink:0},children:O.ImageUrl?e.jsx(ce,{src:O.ImageUrl,sx:{width:48,height:48},alt:O.ProductName}):e.jsx(ce,{sx:{width:48,height:48,bgcolor:"neutral.100"},children:e.jsx(lr,{})})}),e.jsxs(u,{sx:{flex:1,minWidth:0},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:O.ProductName}),e.jsx(u,{sx:{display:"flex",alignItems:"center",gap:1},children:a?e.jsx(g,{level:"body-xs",color:"neutral",children:"..."}):e.jsxs(e.Fragment,{children:[E(n[O.uuid]||0),e.jsx(se,{size:"sm",color:_(n[O.uuid]||0).color,variant:"soft",sx:{fontSize:"10px",minWidth:"fit-content"},children:n[O.uuid]||0})]})})]}),e.jsxs(g,{level:"body-xs",color:"neutral",sx:{mb:.5},children:["ID: ",O.ProductID||"N/A"," • ",new Date(O.CreatedAt).toLocaleDateString()]}),e.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(u,{children:[e.jsxs(g,{level:"body-xs",sx:{fontWeight:"bold",color:"success.600"},children:["Sale: ",it(O.SalesPrice)]}),e.jsxs(g,{level:"body-xs",color:"neutral",children:["Cost: ",it(O.CostPrice)]})]}),e.jsxs(u,{sx:{display:"flex",gap:.5},children:[e.jsx(te,{size:"sm",variant:"soft",color:"primary",onClick:()=>ae(O),children:e.jsx(ct,{})}),e.jsx(te,{size:"sm",variant:"soft",color:"danger",onClick:()=>ze(O.uuid),disabled:d,children:e.jsx(at,{})})]})]})]})]})},O.uuid))}),e.jsx(te,{color:"primary",variant:"soft",size:"sm",sx:{position:"fixed",bottom:80,right:16,zIndex:1e3,borderRadius:"8px",width:40,height:40,boxShadow:"sm",bgcolor:"primary.100","&:hover":{bgcolor:"primary.200",boxShadow:"md"}},onClick:de,children:e.jsx(ue,{fontSize:"small"})})]}),Ke=()=>e.jsxs(je,{variant:"table-page",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:Y.sizes.xlarge},children:"Products"}),e.jsxs(u,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(B,{placeholder:"Search products...",sx:{flex:1,fontSize:Y.sizes.small},value:f,onChange:O=>w(O.target.value),startDecorator:e.jsx(ge,{})}),e.jsxs(ie,{placeholder:"Filter by stock",value:v,onChange:(O,G)=>x(G||""),sx:{minWidth:160,fontSize:Y.sizes.small},children:[e.jsx(z,{value:"",children:"All Stock Levels"}),e.jsx(z,{value:"in-stock",children:"In Stock"}),e.jsx(z,{value:"low-stock",children:"Low Stock"}),e.jsx(z,{value:"out-of-stock",children:"Out of Stock"})]}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(ue,{}),onClick:de,sx:{fontSize:Y.sizes.small},children:"Add Product"})]}),e.jsxs(ke,{sx:{overflow:"visible"},children:[l&&e.jsx(De,{}),e.jsxs(We,{"aria-label":"Products",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:pe,children:"Image"}),e.jsx("th",{style:pe,children:"Name"}),e.jsx("th",{style:pe,children:"Stock"}),e.jsx("th",{style:pe,children:"Sales Price"}),e.jsx("th",{style:pe,children:"Cost Price"}),e.jsx("th",{style:pe,children:"Created"}),e.jsx("th",{style:pe,children:"Actions"})]})}),e.jsxs("tbody",{children:[he.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...pe},children:l?"Loading products...":"No products found."})}),he.map(O=>e.jsxs("tr",{children:[e.jsx("td",{style:pe,children:O.ImageUrl?e.jsx(ce,{src:O.ImageUrl,sx:{width:32,height:32},alt:O.ProductName}):e.jsx(ce,{sx:{width:32,height:32,bgcolor:"neutral.100"},children:e.jsx(lr,{sx:{fontSize:"16px"}})})}),e.jsx("td",{style:pe,children:e.jsxs(u,{children:[e.jsx(g,{level:"body-sm",sx:{fontWeight:"bold"},children:O.ProductName}),e.jsxs(g,{level:"body-xs",color:"neutral",children:["ID: ",O.ProductID||"N/A"]})]})}),e.jsx("td",{style:pe,children:a?e.jsx(g,{level:"body-sm",sx:{color:"neutral.500"},children:"Loading..."}):e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(se,{size:"sm",variant:"soft",color:_(n[O.uuid]||0).color,children:_(n[O.uuid]||0).status}),e.jsx(ms,{title:`Current stock level: ${n[O.uuid]||0} units`,arrow:!0,children:e.jsx(g,{level:"body-sm",sx:{fontWeight:"bold",color:_(n[O.uuid]||0).color==="danger"?"danger.500":_(n[O.uuid]||0).color==="warning"?"warning.600":"success.600"},children:n[O.uuid]||0})}),e.jsx(u,{sx:{width:40,height:4,bgcolor:"neutral.200",borderRadius:2,overflow:"hidden"},children:e.jsx(u,{sx:{width:`${Math.min(100,Math.max(0,(n[O.uuid]||0)/50*100))}%`,height:"100%",bgcolor:_(n[O.uuid]||0).color==="danger"?"danger.400":_(n[O.uuid]||0).color==="warning"?"warning.400":"success.400",borderRadius:2}})})]})}),e.jsx("td",{style:pe,children:e.jsx(g,{level:"body-sm",sx:{fontWeight:"bold",color:"success.600"},children:it(O.SalesPrice)})}),e.jsx("td",{style:pe,children:e.jsx(g,{level:"body-sm",color:"neutral",children:it(O.CostPrice)})}),e.jsx("td",{style:pe,children:new Date(O.CreatedAt).toLocaleDateString()}),e.jsx("td",{style:pe,children:e.jsxs(u,{sx:{display:"flex",gap:.5},children:[e.jsx(te,{size:"sm",variant:"soft",color:"primary",onClick:()=>ae(O),children:e.jsx(ct,{})}),e.jsx(te,{size:"sm",variant:"soft",color:"danger",onClick:()=>ze(O.uuid),disabled:d,children:e.jsx(at,{})})]})})]},O.uuid))]})]})]})]});return e.jsxs($e,{children:[s?e.jsx(pt,{}):e.jsx(Ke,{}),e.jsx(hr,{open:D,onClose:()=>k(!1),product:null,onSave:He}),e.jsx(hr,{open:m,onClose:()=>{C(!1),N(null)},product:T,onSave:xt}),s&&e.jsx(Ut,{open:j,onClose:Le,title:"Filter Products",size:"medium",actions:e.jsxs(u,{sx:{display:"flex",gap:2},children:[e.jsx(q,{variant:"plain",onClick:Ae,sx:pe,children:"Clear All"}),e.jsx(q,{variant:"solid",onClick:Le,sx:pe,children:"Apply"})]}),children:e.jsx(Q,{spacing:2,children:e.jsxs(ne,{children:[e.jsx(ee,{children:"Stock Level"}),e.jsxs(ie,{placeholder:"All stock levels",value:v,onChange:(O,G)=>x(G||""),children:[e.jsx(z,{value:"",children:"All Stock Levels"}),e.jsx(z,{value:"in-stock",children:"In Stock"}),e.jsx(z,{value:"low-stock",children:"Low Stock"}),e.jsx(z,{value:"out-of-stock",children:"Out of Stock"})]})]})})}),e.jsx(Gt,{open:P,onClose:()=>W(!1),autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{top:16,zIndex:2e3},children:e.jsx(Kt,{color:F,variant:"solid",sx:{width:"100%"},children:A})})]})},Ve={fontSize:Y.sizes.small},Ze={...Ve,fontWeight:600,borderBottom:"1.5px solid #e0e0e0",background:"inherit"},xr=s=>{switch(s?.toLowerCase()){case"admin":return"danger";case"manager":return"warning";case"user":return"primary";case"staff":return"success";default:return"neutral"}},pr=(s,t)=>{const r=s||t;let n=0;for(let l=0;l<r.length;l++)n=r.charCodeAt(l)+((n<<5)-n);const o=["primary","success","warning","danger","neutral"];return o[Math.abs(n)%o.length]},fr=(s,t)=>{if(s){const r=s.split(" ");return r.length>=2?(r[0][0]+r[1][0]).toUpperCase():s.substring(0,2).toUpperCase()}return t.substring(0,2).toUpperCase()};function Jo(){return e.jsxs(Ur,{children:[e.jsx(Br,{slots:{root:te},slotProps:{root:{variant:"plain",color:"neutral",size:"sm"}},children:e.jsx(uo,{})}),e.jsxs(Wr,{size:"sm",sx:{minWidth:140},children:[e.jsx(ot,{children:"Edit"}),e.jsx(ot,{children:"Reset Password"}),e.jsx(ot,{children:"Disable"}),e.jsx(ot,{color:"danger",children:"Delete"})]})]})}const Go=()=>{const{isMobile:s}=Ce(),[t,r]=h.useState([]),[n,o]=h.useState(!1),[l,i]=h.useState(null),[a,c]=h.useState(""),[d,p]=h.useState("all"),[f,w]=h.useState(!1),v=async()=>{o(!0),i(null);try{const{data:m,error:C}=await L.from("users").select("*");if(C)throw C;if(m){const T=m.map(N=>({id:N.id,name:N.name||null,email:N.email,role:N.role||null,created_at:N.created_at||null,last_login:N.last_login||null,phone:N.phone||null}));r(T)}}catch(m){console.error("Error fetching users:",m),i(m.message||"Failed to fetch users")}finally{o(!1)}},x=Array.from(new Set(t.map(m=>m.role).filter(Boolean))),b=[...t.filter(m=>{const C=m.name?.toLowerCase().includes(a.toLowerCase())||m.email.toLowerCase().includes(a.toLowerCase()),T=d==="all"||m.role===d;return C&&T})].sort((m,C)=>{const T=m.name||m.email,N=C.name||C.email;return T.localeCompare(N)});h.useEffect(()=>{v()},[]);const D=()=>e.jsxs(u,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(je,{padding:"medium",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:Y.sizes.xlarge},children:"Users"}),e.jsxs(u,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(B,{placeholder:"Search users...",value:a,onChange:m=>c(m.target.value),startDecorator:e.jsx(ge,{}),sx:{flex:1}}),e.jsxs(ie,{placeholder:"Role",value:d,onChange:(m,C)=>p(C??"all"),sx:{minWidth:120},children:[e.jsx(z,{value:"all",children:"All"}),x.map(m=>e.jsx(z,{value:m,children:m},m))]})]}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(ue,{}),onClick:()=>w(!0),sx:{width:"100%",mb:2},children:"Create User"})]}),n&&e.jsx(De,{}),l&&e.jsx(u,{sx:{p:2},children:e.jsxs(g,{color:"danger",children:["Error: ",l]})}),e.jsx(u,{children:b.length===0?e.jsx(u,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:"No users found"})}):b.map(m=>e.jsx(u,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ce,{size:"md",color:pr(m.name,m.email),sx:{flexShrink:0},children:fr(m.name,m.email)}),e.jsxs(u,{sx:{flex:1,minWidth:0},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:m.name||"Unnamed User"}),m.role&&e.jsx(se,{size:"sm",color:xr(m.role),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content",textTransform:"capitalize"},children:m.role})]}),e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(Qr,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsx(g,{level:"body-xs",color:"neutral",children:m.email})]}),e.jsxs(u,{sx:{display:"flex",gap:2,mb:.5},children:[m.phone&&e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Xr,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsx(g,{level:"body-xs",color:"neutral",children:m.phone})]}),m.last_login&&e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(ao,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsx(g,{level:"body-xs",color:"neutral",children:new Date(m.last_login).toLocaleDateString()})]})]}),m.created_at&&e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(co,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsxs(g,{level:"body-xs",color:"neutral",children:["Joined ",new Date(m.created_at).toLocaleDateString()]})]})]})]})},m.id))})]}),k=()=>e.jsxs(je,{variant:"table-page",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:Y.sizes.xlarge},children:"Users"}),e.jsxs(u,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(B,{placeholder:"Search users...",sx:{flex:1},value:a,onChange:m=>c(m.target.value),startDecorator:e.jsx(ge,{})}),e.jsxs(ie,{placeholder:"Filter role",value:d,onChange:(m,C)=>p(C??"all"),sx:{minWidth:160},children:[e.jsx(z,{value:"all",children:"All Roles"}),x.map(m=>e.jsx(z,{value:m,children:m},m))]}),e.jsx(q,{onClick:()=>w(!0),variant:"solid",startDecorator:e.jsx(ue,{}),children:"Create User"})]}),e.jsxs(ke,{sx:{overflow:"visible"},children:[n&&e.jsx(De,{}),l&&e.jsxs(g,{color:"danger",children:["Error: ",l]}),e.jsxs(We,{"aria-label":"Users",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:Ze,children:"Name"}),e.jsx("th",{style:Ze,children:"Email"}),e.jsx("th",{style:Ze,children:"Role"}),e.jsx("th",{style:Ze,children:"Created At"}),e.jsx("th",{style:Ze,children:"Last Login"}),e.jsx("th",{style:Ze,children:"Phone"}),e.jsx("th",{style:{width:120,...Ze},children:"Actions"})]})}),e.jsxs("tbody",{children:[b.length===0&&!n&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...Ve},children:"No users found."})}),b.map(m=>e.jsxs("tr",{style:{cursor:"pointer",height:48},children:[e.jsx("td",{style:Ve,children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ce,{size:"sm",color:pr(m.name,m.email),children:fr(m.name,m.email)}),e.jsx(g,{level:"body-sm",fontWeight:"md",children:m.name||"Unnamed User"})]})}),e.jsx("td",{style:Ve,children:m.email}),e.jsx("td",{style:Ve,children:m.role?e.jsx(se,{size:"sm",color:xr(m.role),variant:"soft",sx:{textTransform:"capitalize"},children:m.role}):"-"}),e.jsx("td",{style:Ve,children:m.created_at?new Date(m.created_at).toLocaleDateString():"-"}),e.jsx("td",{style:Ve,children:m.last_login?new Date(m.last_login).toLocaleDateString():"-"}),e.jsx("td",{style:Ve,children:m.phone||"-"}),e.jsx("td",{children:e.jsx(Jo,{})})]},m.id))]})]})]})]});return e.jsxs($e,{children:[s?e.jsx(D,{}):e.jsx(k,{}),e.jsx(Ie,{open:f,onClose:()=>w(!1),"aria-labelledby":"create-user-modal",children:e.jsxs(Ee,{"aria-labelledby":"create-user-modal",sx:{maxWidth:600,width:"100%"},children:[e.jsx(Ge,{}),e.jsx(g,{id:"create-user-modal",level:"title-md",fontWeight:"lg",sx:{mb:2},children:"Create User"}),e.jsx(g,{level:"body-sm",sx:{mb:2},children:"User creation functionality will be implemented here."}),e.jsx(q,{onClick:()=>w(!1),variant:"outlined",children:"Close"})]})})]})};function rn({open:s,onClose:t,onSaved:r,mode:n="add",supplier:o}){const[l,i]=h.useState(o?.name||""),[a,c]=h.useState(o?.contact_name||""),[d,p]=h.useState(o?.email||""),[f,w]=h.useState(o?.phone||""),[v,x]=h.useState(o?.address||""),[j,b]=h.useState(!1),[D,k]=h.useState(null);h.useEffect(()=>{s&&n==="edit"&&o?(i(o.name||""),c(o.contact_name||""),p(o.email||""),w(o.phone||""),x(o.address||"")):s&&n==="add"&&(i(""),c(""),p(""),w(""),x(""))},[s,n,o]);const m=async()=>{b(!0),k(null);const C={name:l,contact_name:a,email:d,phone:f,address:v};let T;if(n==="add"){T=await L.from("Suppliers").insert([C]).select(),b(!1),T.error?k(T.error.message):r(T.data?.[0]?.id);return}else T=await L.from("Suppliers").update(C).eq("id",o?.id);b(!1),T.error?k(T.error.message):r()};return e.jsx(Ie,{open:s,onClose:t,children:e.jsxs(Ee,{sx:{minWidth:400},children:[e.jsx(Ge,{}),e.jsxs(g,{level:"title-md",sx:{mb:2},children:[n==="edit"?"Edit":"Add"," Supplier"]}),e.jsxs("form",{onSubmit:C=>{C.preventDefault(),C.stopPropagation(),m()},children:[e.jsx(B,{placeholder:"Name",value:l,onChange:C=>i(C.target.value),sx:{mb:2},required:!0}),e.jsx(B,{placeholder:"Contact Name",value:a,onChange:C=>c(C.target.value),sx:{mb:2}}),e.jsx(B,{placeholder:"Email",value:d,onChange:C=>p(C.target.value),sx:{mb:2},type:"email",required:!0}),e.jsx(B,{placeholder:"Phone",value:f,onChange:C=>w(C.target.value),sx:{mb:2},type:"tel"}),e.jsx(B,{placeholder:"Address",value:v,onChange:C=>x(C.target.value),sx:{mb:2}}),D&&e.jsx(g,{color:"danger",sx:{mb:1},children:D}),e.jsx(q,{type:"submit",loading:j,disabled:j,variant:"solid",children:"Save"})]})]})})}const mr=s=>{let t=0;for(let n=0;n<s.length;n++)t=s.charCodeAt(n)+((t<<5)-t);const r=["primary","success","warning","danger","neutral"];return r[Math.abs(t)%r.length]},gr=s=>{const t=s.split(" ");return t.length>=2?(t[0][0]+t[1][0]).toUpperCase():s.substring(0,2).toUpperCase()};function Ko({supplier:s,onEdit:t,onDelete:r}){return e.jsxs(Ur,{children:[e.jsx(Br,{slots:{root:te},slotProps:{root:{variant:"plain",color:"neutral",size:"sm"}},children:e.jsx(xo,{})}),e.jsxs(Wr,{size:"sm",sx:{minWidth:120},children:[e.jsxs(ot,{onClick:()=>t(s),children:[e.jsx(ct,{sx:{mr:1},fontSize:"small"}),"Edit"]}),e.jsxs(ot,{color:"danger",onClick:()=>r(s.id),children:[e.jsx(at,{sx:{mr:1},fontSize:"small"}),"Delete"]})]})]})}const Zo=()=>{const{isMobile:s}=Ce(),[t,r]=h.useState([]),[n,o]=h.useState(!1),[l,i]=h.useState(null),[a,c]=h.useState(""),[d,p]=h.useState(!1),[f,w]=h.useState(null),[v,x]=h.useState("view"),j=async()=>{o(!0),i(null);try{const{data:P,error:W}=await L.from("Suppliers").select("*");if(W)throw W;P&&r(P)}catch(P){console.error("Error fetching suppliers:",P),i(P.message||"Failed to fetch suppliers")}finally{o(!1)}},b=P=>{w(P),x("edit"),p(!0)},D=async P=>{if(confirm("Are you sure you want to delete this supplier?"))try{const{error:W}=await L.from("Suppliers").delete().eq("id",P);if(W)throw W;await j()}catch(W){console.error("Error deleting supplier:",W),i(W.message||"Failed to delete supplier")}},k=async()=>{p(!1),await j()},C=[...t.filter(P=>P.name?.toLowerCase().includes(a.toLowerCase())||P.contact_name?.toLowerCase().includes(a.toLowerCase())||P.email?.toLowerCase().includes(a.toLowerCase())||P.phone?.toLowerCase().includes(a.toLowerCase())||P.address?.toLowerCase().includes(a.toLowerCase()))].sort((P,W)=>P.name.localeCompare(W.name));h.useEffect(()=>{j()},[]);const T=()=>e.jsxs(u,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(je,{padding:"medium",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:Y.sizes.xlarge},children:"Suppliers"}),e.jsx(u,{sx:{display:"flex",gap:1,mb:2},children:e.jsx(B,{placeholder:"Search suppliers...",value:a,onChange:P=>c(P.target.value),startDecorator:e.jsx(ge,{}),sx:{flex:1}})}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(ue,{}),onClick:()=>{w(null),x("add"),p(!0)},sx:{width:"100%",mb:2},children:"Add Supplier"})]}),n&&e.jsx(De,{}),l&&e.jsx(u,{sx:{p:2},children:e.jsxs(g,{color:"danger",children:["Error: ",l]})}),e.jsx(u,{sx:{px:2},children:C.length===0?e.jsx(u,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:"No suppliers found"})}):C.map(P=>e.jsx(ke,{variant:"outlined",sx:{mb:2,"&:hover":{boxShadow:"sm"}},children:e.jsx(lt,{sx:{p:2},children:e.jsxs(u,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(ce,{size:"md",color:mr(P.name),sx:{flexShrink:0},children:P.image_url?e.jsx("img",{src:P.image_url,alt:P.name}):gr(P.name)}),e.jsxs(u,{sx:{flex:1,minWidth:0},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",mb:1},children:[e.jsx(g,{level:"title-md",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"calc(100% - 40px)"},children:P.name}),e.jsx(Ko,{supplier:P,onEdit:b,onDelete:D})]}),e.jsxs(Q,{spacing:.5,children:[P.contact_name&&e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(vt,{sx:{fontSize:16,color:"text.tertiary"}}),e.jsx(g,{level:"body-sm",color:"neutral",children:P.contact_name})]}),P.email&&e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Qr,{sx:{fontSize:16,color:"text.tertiary"}}),e.jsx(g,{level:"body-sm",color:"neutral",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:P.email})]}),P.phone&&e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Xr,{sx:{fontSize:16,color:"text.tertiary"}}),e.jsx(g,{level:"body-sm",color:"neutral",children:P.phone})]}),P.address&&e.jsxs(u,{sx:{display:"flex",alignItems:"flex-start",gap:1,mt:.5},children:[e.jsx(ho,{sx:{fontSize:16,color:"text.tertiary",mt:.25}}),e.jsx(g,{level:"body-sm",color:"neutral",sx:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.2},children:P.address})]})]})]})]})})},P.id))})]}),N=()=>e.jsxs(je,{variant:"table-page",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:Y.sizes.xlarge},children:"Suppliers"}),e.jsxs(u,{sx:{display:"flex",gap:2,mb:3,alignItems:"center"},children:[e.jsx(B,{placeholder:"Search suppliers...",value:a,onChange:P=>c(P.target.value),startDecorator:e.jsx(ge,{}),sx:{flex:1}}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(ue,{}),onClick:()=>{w(null),x("add"),p(!0)},sx:{minWidth:140},children:"Add Supplier"})]}),n&&e.jsx(De,{sx:{mb:2}}),l&&e.jsxs(g,{color:"danger",sx:{mb:2},children:["Error: ",l]}),e.jsx(Ye,{container:!0,spacing:2,children:C.length===0?e.jsx(Ye,{xs:12,children:e.jsx(u,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:"No suppliers found"})})}):C.map(P=>e.jsx(Ye,{xs:12,md:6,lg:4,children:e.jsx(ke,{variant:"outlined",sx:{height:"100%"},children:e.jsxs(lt,{children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(ce,{size:"sm",color:mr(P.name),children:P.image_url?e.jsx("img",{src:P.image_url,alt:P.name}):gr(P.name)}),e.jsx(g,{level:"title-md",fontWeight:"bold",children:P.name})]}),e.jsxs(Q,{spacing:1,children:[e.jsxs(g,{level:"body-sm",children:[e.jsx("strong",{children:"Contact:"})," ",P.contact_name||"N/A"]}),e.jsxs(g,{level:"body-sm",children:[e.jsx("strong",{children:"Email:"})," ",P.email||"N/A"]}),e.jsxs(g,{level:"body-sm",children:[e.jsx("strong",{children:"Phone:"})," ",P.phone||"N/A"]}),e.jsxs(g,{level:"body-sm",children:[e.jsx("strong",{children:"Address:"})," ",P.address||"N/A"]})]}),e.jsxs(u,{sx:{display:"flex",gap:1,mt:2},children:[e.jsx(q,{size:"sm",variant:"outlined",startDecorator:e.jsx(ct,{}),onClick:()=>b(P),children:"Edit"}),e.jsx(q,{size:"sm",variant:"outlined",color:"danger",startDecorator:e.jsx(at,{}),onClick:()=>D(P.id),children:"Delete"})]})]})})},P.id))})]});return e.jsxs($e,{children:[s?e.jsx(T,{}):e.jsx(N,{}),e.jsx(rn,{open:d,onClose:()=>p(!1),supplier:f,onSaved:k,mode:v==="edit"||v==="add"?v:void 0})]})};function Qo({orderId:s,editable:t,onItemsChange:r,initialItems:n=[]}){const[o,l]=h.useState(n),[i,a]=h.useState([]),[c,d]=h.useState(!1);h.useEffect(()=>{d(!0),L.from("Products").select("uuid, ProductName").then(({data:v,error:x})=>{x?console.error("Failed to fetch products:",x.message):a(v||[]),d(!1)})},[]);const p=(v,x,j)=>{l(b=>{const D=b.map((k,m)=>m===v?{...k,[x]:j}:k);return r&&r(D),D})},f=()=>{l(v=>{const x=[...v,{product_id:null,quantity_ordered:1,unit_price:0}];return r&&r(x),x})},w=v=>{l(x=>{const j=x.filter((b,D)=>D!==v);return r&&r(j),j})};return e.jsxs(u,{sx:{mt:2},children:[e.jsxs(We,{size:"sm",sx:{minWidth:500},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Quantity"}),e.jsx("th",{children:"Unit Price"}),e.jsx("th",{children:"Total"}),t&&e.jsx("th",{})]})}),e.jsx("tbody",{children:o.map((v,x)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(Ds,{options:i,getOptionLabel:j=>j.ProductName,value:i.find(j=>j.uuid===v.product_id)||null,onChange:(j,b)=>p(x,"product_id",b?b.uuid:null),disabled:!t,sx:{minWidth:180},isOptionEqualToValue:(j,b)=>j.uuid===b.uuid,required:!0})}),e.jsx("td",{children:e.jsx(B,{type:"number",value:v.quantity_ordered??1,onChange:j=>p(x,"quantity_ordered",Math.max(1,Number(j.target.value))),disabled:!t,sx:{width:80},required:!0})}),e.jsx("td",{children:e.jsx(B,{type:"number",value:v.unit_price??0,onChange:j=>p(x,"unit_price",Math.max(0,Number(j.target.value))),disabled:!t,sx:{width:100},required:!0})}),e.jsx("td",{children:dt(v.quantity_ordered*v.unit_price)}),t&&e.jsx("td",{children:e.jsx(q,{size:"sm",color:"danger",onClick:()=>w(x),children:"Remove"})})]},x))})]}),t&&e.jsx(q,{size:"sm",variant:"soft",onClick:f,sx:{mt:1},children:"Add Item"})]})}const It=["Pending","Approved","Received","Cancelled"];function Xo({open:s,onClose:t,onCreated:r,mode:n="add",order:o}){const[l,i]=h.useState(o?.order_number||""),[a,c]=h.useState(o?.order_date||new Date().toISOString().slice(0,10)),[d,p]=h.useState(o?.status||"Pending"),[f,w]=h.useState(o?.total?String(o.total):""),[v,x]=h.useState(o?.notes||""),[j,b]=h.useState(o?.supplier_id||null),[D,k]=h.useState(!1),[m,C]=h.useState(null),[T,N]=h.useState([]),[P,W]=h.useState(""),[A,M]=h.useState(!1),[F,U]=h.useState([{product_id:null,quantity_ordered:1,unit_price:0}]);h.useRef(null),h.useEffect(()=>{s?(console.log("[PurchaseOrderForm] Modal opened"),L.from("Suppliers").select("id, name").then(({data:E})=>{N(E||[])}),n==="edit"&&o?.id?L.from("purchaseorderitems").select("*").eq("purchase_order_id",o.id).then(({data:E})=>{U(E||[])}):n==="add"&&U([{product_id:null,quantity_ordered:1,unit_price:0}])):console.log("[PurchaseOrderForm] Modal closed")},[s,n,o]);const S=async E=>{console.log("[PurchaseOrderForm] handleSupplierAdded called");const{data:$}=await L.from("Suppliers").select("id, name");N($||[]),E&&(b(String(E)),console.log("[PurchaseOrderForm] New supplier set:",E)),M(!1),console.log("[PurchaseOrderForm] SupplierForm closed")},_=async()=>{console.log("[PurchaseOrderForm] handleSave called"),k(!0),C(null);const E={order_date:a,status:d,notes:v,supplier_id:j};n==="edit"&&(E.order_number=l),E.total=f?parseFloat(f):null;let $,re=o?.id;if(n==="add"?($=await L.from("PurchaseOrders").insert([E]).select(),!$.error&&$.data&&$.data[0]&&(re=$.data[0].id)):o&&($=await L.from("PurchaseOrders").update(E).eq("id",o.id)),$&&!$.error&&n==="add"&&re&&F.length>0){const he=F.filter(ae=>ae.product_id).map(ae=>Uo({purchase_order_id:re,product_id:ae.product_id,quantity_ordered:ae.quantity_ordered,unit_price:ae.unit_price,notes:ae.notes||null}));if(he.length===0){C("Please select a product for each item before saving."),k(!1);return}const de=await L.from("purchaseorderitems").insert(he);if(de.error){C("Failed to save items: "+de.error.message),k(!1);return}}k(!1),$?.error?(C($.error.message),console.log("[PurchaseOrderForm] Save error:",$.error.message)):(r(),t(),i(""),c(new Date().toISOString().slice(0,10)),p("Pending"),w(""),x(""),b(null),W(""),console.log("[PurchaseOrderForm] Purchase order saved and modal closed"))};return e.jsx(Ie,{open:s,onClose:t,"aria-labelledby":"purchase-order-form-title",children:e.jsxs(Ee,{sx:{minWidth:400},children:[e.jsx(Ge,{}),e.jsxs(g,{id:"purchase-order-form-title",level:"title-md",sx:{mb:2},children:[n==="edit"?"Edit":"Add"," Purchase Order"]}),e.jsxs("form",{onSubmit:E=>{E.preventDefault(),_()},children:[e.jsx(B,{type:"date",value:a,onChange:E=>c(E.target.value),sx:{mb:2},required:!0}),e.jsx(ie,{value:d,onChange:(E,$)=>p($??"Pending"),sx:{mb:2,display:"none"},required:!0,children:It.map(E=>e.jsx(z,{value:E,children:E},E))}),n==="edit"&&e.jsx(u,{sx:{mb:2},children:e.jsx(se,{variant:"soft",color:d==="Approved"?"success":d==="Received"?"primary":d==="Cancelled"?"danger":"neutral",sx:{textTransform:"capitalize",fontWeight:600,fontSize:"md",px:1.5,py:.5},onClick:()=>{const E=It.indexOf(d);p(It[(E+1)%It.length])},children:d})}),e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Ds,{options:T,getOptionLabel:E=>E.name,value:T.find(E=>E.id===j)||null,onChange:(E,$)=>b($?$.id:null),inputValue:P,onInputChange:(E,$)=>W($),placeholder:"Select supplier",sx:{flex:1,mb:0},isOptionEqualToValue:(E,$)=>E.id===$.id,required:!0}),e.jsx(te,{color:"primary",sx:{ml:1},onClick:()=>M(!0),children:e.jsx(ue,{})})]}),e.jsx(rn,{open:A,onClose:()=>M(!1),onSaved:S,mode:"add"}),n==="edit"&&e.jsxs(e.Fragment,{children:[e.jsx(B,{placeholder:"Order Number",value:l,onChange:E=>i(E.target.value),sx:{mb:2}}),e.jsx(B,{placeholder:"Total",value:f,onChange:E=>w(E.target.value),sx:{mb:2},type:"number",readOnly:!0})]}),e.jsx(B,{placeholder:"Notes",value:v,onChange:E=>x(E.target.value),sx:{mb:2}}),e.jsx(Qo,{orderId:o?.id,editable:n==="add",onItemsChange:U,initialItems:F}),e.jsx(u,{sx:{height:16}}),m&&e.jsx(g,{color:"danger",sx:{mb:1},children:m}),e.jsx(q,{type:"submit",loading:D,disabled:D,variant:"solid",children:"Save"})]})]})})}function nn(s,t){return function(){return s.apply(t,arguments)}}const{toString:Yo}=Object.prototype,{getPrototypeOf:qs}=Object,{iterator:Zt,toStringTag:on}=Symbol,Qt=(s=>t=>{const r=Yo.call(t);return s[r]||(s[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),Te=s=>(s=s.toLowerCase(),t=>Qt(t)===s),Xt=s=>t=>typeof t===s,{isArray:ut}=Array,St=Xt("undefined");function ei(s){return s!==null&&!St(s)&&s.constructor!==null&&!St(s.constructor)&&Pe(s.constructor.isBuffer)&&s.constructor.isBuffer(s)}const ln=Te("ArrayBuffer");function ti(s){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(s):t=s&&s.buffer&&ln(s.buffer),t}const si=Xt("string"),Pe=Xt("function"),an=Xt("number"),Yt=s=>s!==null&&typeof s=="object",ri=s=>s===!0||s===!1,zt=s=>{if(Qt(s)!=="object")return!1;const t=qs(s);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(on in s)&&!(Zt in s)},ni=Te("Date"),oi=Te("File"),ii=Te("Blob"),li=Te("FileList"),ai=s=>Yt(s)&&Pe(s.pipe),ci=s=>{let t;return s&&(typeof FormData=="function"&&s instanceof FormData||Pe(s.append)&&((t=Qt(s))==="formdata"||t==="object"&&Pe(s.toString)&&s.toString()==="[object FormData]"))},di=Te("URLSearchParams"),[ui,hi,xi,pi]=["ReadableStream","Request","Response","Headers"].map(Te),fi=s=>s.trim?s.trim():s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function kt(s,t,{allOwnKeys:r=!1}={}){if(s===null||typeof s>"u")return;let n,o;if(typeof s!="object"&&(s=[s]),ut(s))for(n=0,o=s.length;n<o;n++)t.call(null,s[n],n,s);else{const l=r?Object.getOwnPropertyNames(s):Object.keys(s),i=l.length;let a;for(n=0;n<i;n++)a=l[n],t.call(null,s[a],a,s)}}function cn(s,t){t=t.toLowerCase();const r=Object.keys(s);let n=r.length,o;for(;n-- >0;)if(o=r[n],t===o.toLowerCase())return o;return null}const et=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,dn=s=>!St(s)&&s!==et;function bs(){const{caseless:s}=dn(this)&&this||{},t={},r=(n,o)=>{const l=s&&cn(t,o)||o;zt(t[l])&&zt(n)?t[l]=bs(t[l],n):zt(n)?t[l]=bs({},n):ut(n)?t[l]=n.slice():t[l]=n};for(let n=0,o=arguments.length;n<o;n++)arguments[n]&&kt(arguments[n],r);return t}const mi=(s,t,r,{allOwnKeys:n}={})=>(kt(t,(o,l)=>{r&&Pe(o)?s[l]=nn(o,r):s[l]=o},{allOwnKeys:n}),s),gi=s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),ji=(s,t,r,n)=>{s.prototype=Object.create(t.prototype,n),s.prototype.constructor=s,Object.defineProperty(s,"super",{value:t.prototype}),r&&Object.assign(s.prototype,r)},bi=(s,t,r,n)=>{let o,l,i;const a={};if(t=t||{},s==null)return t;do{for(o=Object.getOwnPropertyNames(s),l=o.length;l-- >0;)i=o[l],(!n||n(i,s,t))&&!a[i]&&(t[i]=s[i],a[i]=!0);s=r!==!1&&qs(s)}while(s&&(!r||r(s,t))&&s!==Object.prototype);return t},yi=(s,t,r)=>{s=String(s),(r===void 0||r>s.length)&&(r=s.length),r-=t.length;const n=s.indexOf(t,r);return n!==-1&&n===r},wi=s=>{if(!s)return null;if(ut(s))return s;let t=s.length;if(!an(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=s[t];return r},Si=(s=>t=>s&&t instanceof s)(typeof Uint8Array<"u"&&qs(Uint8Array)),vi=(s,t)=>{const n=(s&&s[Zt]).call(s);let o;for(;(o=n.next())&&!o.done;){const l=o.value;t.call(s,l[0],l[1])}},ki=(s,t)=>{let r;const n=[];for(;(r=s.exec(t))!==null;)n.push(r);return n},Ci=Te("HTMLFormElement"),Pi=s=>s.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,n,o){return n.toUpperCase()+o}),jr=(({hasOwnProperty:s})=>(t,r)=>s.call(t,r))(Object.prototype),Ri=Te("RegExp"),un=(s,t)=>{const r=Object.getOwnPropertyDescriptors(s),n={};kt(r,(o,l)=>{let i;(i=t(o,l,s))!==!1&&(n[l]=i||o)}),Object.defineProperties(s,n)},_i=s=>{un(s,(t,r)=>{if(Pe(s)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const n=s[r];if(Pe(n)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},Ii=(s,t)=>{const r={},n=o=>{o.forEach(l=>{r[l]=!0})};return ut(s)?n(s):n(String(s).split(t)),r},Ei=()=>{},Di=(s,t)=>s!=null&&Number.isFinite(s=+s)?s:t;function Ai(s){return!!(s&&Pe(s.append)&&s[on]==="FormData"&&s[Zt])}const Oi=s=>{const t=new Array(10),r=(n,o)=>{if(Yt(n)){if(t.indexOf(n)>=0)return;if(!("toJSON"in n)){t[o]=n;const l=ut(n)?[]:{};return kt(n,(i,a)=>{const c=r(i,o+1);!St(c)&&(l[a]=c)}),t[o]=void 0,l}}return n};return r(s,0)},Ti=Te("AsyncFunction"),zi=s=>s&&(Yt(s)||Pe(s))&&Pe(s.then)&&Pe(s.catch),hn=((s,t)=>s?setImmediate:t?((r,n)=>(et.addEventListener("message",({source:o,data:l})=>{o===et&&l===r&&n.length&&n.shift()()},!1),o=>{n.push(o),et.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",Pe(et.postMessage)),Li=typeof queueMicrotask<"u"?queueMicrotask.bind(et):typeof process<"u"&&process.nextTick||hn,Ni=s=>s!=null&&Pe(s[Zt]),y={isArray:ut,isArrayBuffer:ln,isBuffer:ei,isFormData:ci,isArrayBufferView:ti,isString:si,isNumber:an,isBoolean:ri,isObject:Yt,isPlainObject:zt,isReadableStream:ui,isRequest:hi,isResponse:xi,isHeaders:pi,isUndefined:St,isDate:ni,isFile:oi,isBlob:ii,isRegExp:Ri,isFunction:Pe,isStream:ai,isURLSearchParams:di,isTypedArray:Si,isFileList:li,forEach:kt,merge:bs,extend:mi,trim:fi,stripBOM:gi,inherits:ji,toFlatObject:bi,kindOf:Qt,kindOfTest:Te,endsWith:yi,toArray:wi,forEachEntry:vi,matchAll:ki,isHTMLForm:Ci,hasOwnProperty:jr,hasOwnProp:jr,reduceDescriptors:un,freezeMethods:_i,toObjectSet:Ii,toCamelCase:Pi,noop:Ei,toFiniteNumber:Di,findKey:cn,global:et,isContextDefined:dn,isSpecCompliantForm:Ai,toJSONObject:Oi,isAsyncFn:Ti,isThenable:zi,setImmediate:hn,asap:Li,isIterable:Ni};function V(s,t,r,n,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=s,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),o&&(this.response=o,this.status=o.status?o.status:null)}y.inherits(V,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:y.toJSONObject(this.config),code:this.code,status:this.status}}});const xn=V.prototype,pn={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(s=>{pn[s]={value:s}});Object.defineProperties(V,pn);Object.defineProperty(xn,"isAxiosError",{value:!0});V.from=(s,t,r,n,o,l)=>{const i=Object.create(xn);return y.toFlatObject(s,i,function(c){return c!==Error.prototype},a=>a!=="isAxiosError"),V.call(i,s.message,t,r,n,o),i.cause=s,i.name=s.name,l&&Object.assign(i,l),i};const Mi=null;function ys(s){return y.isPlainObject(s)||y.isArray(s)}function fn(s){return y.endsWith(s,"[]")?s.slice(0,-2):s}function br(s,t,r){return s?s.concat(t).map(function(o,l){return o=fn(o),!r&&l?"["+o+"]":o}).join(r?".":""):t}function Fi(s){return y.isArray(s)&&!s.some(ys)}const $i=y.toFlatObject(y,{},null,function(t){return/^is[A-Z]/.test(t)});function es(s,t,r){if(!y.isObject(s))throw new TypeError("target must be an object");t=t||new FormData,r=y.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(j,b){return!y.isUndefined(b[j])});const n=r.metaTokens,o=r.visitor||p,l=r.dots,i=r.indexes,c=(r.Blob||typeof Blob<"u"&&Blob)&&y.isSpecCompliantForm(t);if(!y.isFunction(o))throw new TypeError("visitor must be a function");function d(x){if(x===null)return"";if(y.isDate(x))return x.toISOString();if(y.isBoolean(x))return x.toString();if(!c&&y.isBlob(x))throw new V("Blob is not supported. Use a Buffer instead.");return y.isArrayBuffer(x)||y.isTypedArray(x)?c&&typeof Blob=="function"?new Blob([x]):Buffer.from(x):x}function p(x,j,b){let D=x;if(x&&!b&&typeof x=="object"){if(y.endsWith(j,"{}"))j=n?j:j.slice(0,-2),x=JSON.stringify(x);else if(y.isArray(x)&&Fi(x)||(y.isFileList(x)||y.endsWith(j,"[]"))&&(D=y.toArray(x)))return j=fn(j),D.forEach(function(m,C){!(y.isUndefined(m)||m===null)&&t.append(i===!0?br([j],C,l):i===null?j:j+"[]",d(m))}),!1}return ys(x)?!0:(t.append(br(b,j,l),d(x)),!1)}const f=[],w=Object.assign($i,{defaultVisitor:p,convertValue:d,isVisitable:ys});function v(x,j){if(!y.isUndefined(x)){if(f.indexOf(x)!==-1)throw Error("Circular reference detected in "+j.join("."));f.push(x),y.forEach(x,function(D,k){(!(y.isUndefined(D)||D===null)&&o.call(t,D,y.isString(k)?k.trim():k,j,w))===!0&&v(D,j?j.concat(k):[k])}),f.pop()}}if(!y.isObject(s))throw new TypeError("data must be an object");return v(s),t}function yr(s){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function Us(s,t){this._pairs=[],s&&es(s,this,t)}const mn=Us.prototype;mn.append=function(t,r){this._pairs.push([t,r])};mn.toString=function(t){const r=t?function(n){return t.call(this,n,yr)}:yr;return this._pairs.map(function(o){return r(o[0])+"="+r(o[1])},"").join("&")};function qi(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function gn(s,t,r){if(!t)return s;const n=r&&r.encode||qi;y.isFunction(r)&&(r={serialize:r});const o=r&&r.serialize;let l;if(o?l=o(t,r):l=y.isURLSearchParams(t)?t.toString():new Us(t,r).toString(n),l){const i=s.indexOf("#");i!==-1&&(s=s.slice(0,i)),s+=(s.indexOf("?")===-1?"?":"&")+l}return s}class wr{constructor(){this.handlers=[]}use(t,r,n){return this.handlers.push({fulfilled:t,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){y.forEach(this.handlers,function(n){n!==null&&t(n)})}}const jn={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Ui=typeof URLSearchParams<"u"?URLSearchParams:Us,Bi=typeof FormData<"u"?FormData:null,Wi=typeof Blob<"u"?Blob:null,Hi={isBrowser:!0,classes:{URLSearchParams:Ui,FormData:Bi,Blob:Wi},protocols:["http","https","file","blob","url","data"]},Bs=typeof window<"u"&&typeof document<"u",ws=typeof navigator=="object"&&navigator||void 0,Vi=Bs&&(!ws||["ReactNative","NativeScript","NS"].indexOf(ws.product)<0),Ji=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Gi=Bs&&window.location.href||"http://localhost",Ki=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Bs,hasStandardBrowserEnv:Vi,hasStandardBrowserWebWorkerEnv:Ji,navigator:ws,origin:Gi},Symbol.toStringTag,{value:"Module"})),me={...Ki,...Hi};function Zi(s,t){return es(s,new me.classes.URLSearchParams,Object.assign({visitor:function(r,n,o,l){return me.isNode&&y.isBuffer(r)?(this.append(n,r.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},t))}function Qi(s){return y.matchAll(/\w+|\[(\w*)]/g,s).map(t=>t[0]==="[]"?"":t[1]||t[0])}function Xi(s){const t={},r=Object.keys(s);let n;const o=r.length;let l;for(n=0;n<o;n++)l=r[n],t[l]=s[l];return t}function bn(s){function t(r,n,o,l){let i=r[l++];if(i==="__proto__")return!0;const a=Number.isFinite(+i),c=l>=r.length;return i=!i&&y.isArray(o)?o.length:i,c?(y.hasOwnProp(o,i)?o[i]=[o[i],n]:o[i]=n,!a):((!o[i]||!y.isObject(o[i]))&&(o[i]=[]),t(r,n,o[i],l)&&y.isArray(o[i])&&(o[i]=Xi(o[i])),!a)}if(y.isFormData(s)&&y.isFunction(s.entries)){const r={};return y.forEachEntry(s,(n,o)=>{t(Qi(n),o,r,0)}),r}return null}function Yi(s,t,r){if(y.isString(s))try{return(t||JSON.parse)(s),y.trim(s)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(s)}const Ct={transitional:jn,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const n=r.getContentType()||"",o=n.indexOf("application/json")>-1,l=y.isObject(t);if(l&&y.isHTMLForm(t)&&(t=new FormData(t)),y.isFormData(t))return o?JSON.stringify(bn(t)):t;if(y.isArrayBuffer(t)||y.isBuffer(t)||y.isStream(t)||y.isFile(t)||y.isBlob(t)||y.isReadableStream(t))return t;if(y.isArrayBufferView(t))return t.buffer;if(y.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let a;if(l){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Zi(t,this.formSerializer).toString();if((a=y.isFileList(t))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return es(a?{"files[]":t}:t,c&&new c,this.formSerializer)}}return l||o?(r.setContentType("application/json",!1),Yi(t)):t}],transformResponse:[function(t){const r=this.transitional||Ct.transitional,n=r&&r.forcedJSONParsing,o=this.responseType==="json";if(y.isResponse(t)||y.isReadableStream(t))return t;if(t&&y.isString(t)&&(n&&!this.responseType||o)){const i=!(r&&r.silentJSONParsing)&&o;try{return JSON.parse(t)}catch(a){if(i)throw a.name==="SyntaxError"?V.from(a,V.ERR_BAD_RESPONSE,this,null,this.response):a}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:me.classes.FormData,Blob:me.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};y.forEach(["delete","get","head","post","put","patch"],s=>{Ct.headers[s]={}});const el=y.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),tl=s=>{const t={};let r,n,o;return s&&s.split(`
`).forEach(function(i){o=i.indexOf(":"),r=i.substring(0,o).trim().toLowerCase(),n=i.substring(o+1).trim(),!(!r||t[r]&&el[r])&&(r==="set-cookie"?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t},Sr=Symbol("internals");function ft(s){return s&&String(s).trim().toLowerCase()}function Lt(s){return s===!1||s==null?s:y.isArray(s)?s.map(Lt):String(s)}function sl(s){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(s);)t[n[1]]=n[2];return t}const rl=s=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(s.trim());function ls(s,t,r,n,o){if(y.isFunction(n))return n.call(this,t,r);if(o&&(t=r),!!y.isString(t)){if(y.isString(n))return t.indexOf(n)!==-1;if(y.isRegExp(n))return n.test(t)}}function nl(s){return s.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,n)=>r.toUpperCase()+n)}function ol(s,t){const r=y.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(s,n+r,{value:function(o,l,i){return this[n].call(this,t,o,l,i)},configurable:!0})})}let Re=class{constructor(t){t&&this.set(t)}set(t,r,n){const o=this;function l(a,c,d){const p=ft(c);if(!p)throw new Error("header name must be a non-empty string");const f=y.findKey(o,p);(!f||o[f]===void 0||d===!0||d===void 0&&o[f]!==!1)&&(o[f||c]=Lt(a))}const i=(a,c)=>y.forEach(a,(d,p)=>l(d,p,c));if(y.isPlainObject(t)||t instanceof this.constructor)i(t,r);else if(y.isString(t)&&(t=t.trim())&&!rl(t))i(tl(t),r);else if(y.isObject(t)&&y.isIterable(t)){let a={},c,d;for(const p of t){if(!y.isArray(p))throw TypeError("Object iterator must return a key-value pair");a[d=p[0]]=(c=a[d])?y.isArray(c)?[...c,p[1]]:[c,p[1]]:p[1]}i(a,r)}else t!=null&&l(r,t,n);return this}get(t,r){if(t=ft(t),t){const n=y.findKey(this,t);if(n){const o=this[n];if(!r)return o;if(r===!0)return sl(o);if(y.isFunction(r))return r.call(this,o,n);if(y.isRegExp(r))return r.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=ft(t),t){const n=y.findKey(this,t);return!!(n&&this[n]!==void 0&&(!r||ls(this,this[n],n,r)))}return!1}delete(t,r){const n=this;let o=!1;function l(i){if(i=ft(i),i){const a=y.findKey(n,i);a&&(!r||ls(n,n[a],a,r))&&(delete n[a],o=!0)}}return y.isArray(t)?t.forEach(l):l(t),o}clear(t){const r=Object.keys(this);let n=r.length,o=!1;for(;n--;){const l=r[n];(!t||ls(this,this[l],l,t,!0))&&(delete this[l],o=!0)}return o}normalize(t){const r=this,n={};return y.forEach(this,(o,l)=>{const i=y.findKey(n,l);if(i){r[i]=Lt(o),delete r[l];return}const a=t?nl(l):String(l).trim();a!==l&&delete r[l],r[a]=Lt(o),n[a]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return y.forEach(this,(n,o)=>{n!=null&&n!==!1&&(r[o]=t&&y.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const n=new this(t);return r.forEach(o=>n.set(o)),n}static accessor(t){const n=(this[Sr]=this[Sr]={accessors:{}}).accessors,o=this.prototype;function l(i){const a=ft(i);n[a]||(ol(o,i),n[a]=!0)}return y.isArray(t)?t.forEach(l):l(t),this}};Re.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);y.reduceDescriptors(Re.prototype,({value:s},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>s,set(n){this[r]=n}}});y.freezeMethods(Re);function as(s,t){const r=this||Ct,n=t||r,o=Re.from(n.headers);let l=n.data;return y.forEach(s,function(a){l=a.call(r,l,o.normalize(),t?t.status:void 0)}),o.normalize(),l}function yn(s){return!!(s&&s.__CANCEL__)}function ht(s,t,r){V.call(this,s??"canceled",V.ERR_CANCELED,t,r),this.name="CanceledError"}y.inherits(ht,V,{__CANCEL__:!0});function wn(s,t,r){const n=r.config.validateStatus;!r.status||!n||n(r.status)?s(r):t(new V("Request failed with status code "+r.status,[V.ERR_BAD_REQUEST,V.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function il(s){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return t&&t[1]||""}function ll(s,t){s=s||10;const r=new Array(s),n=new Array(s);let o=0,l=0,i;return t=t!==void 0?t:1e3,function(c){const d=Date.now(),p=n[l];i||(i=d),r[o]=c,n[o]=d;let f=l,w=0;for(;f!==o;)w+=r[f++],f=f%s;if(o=(o+1)%s,o===l&&(l=(l+1)%s),d-i<t)return;const v=p&&d-p;return v?Math.round(w*1e3/v):void 0}}function al(s,t){let r=0,n=1e3/t,o,l;const i=(d,p=Date.now())=>{r=p,o=null,l&&(clearTimeout(l),l=null),s.apply(null,d)};return[(...d)=>{const p=Date.now(),f=p-r;f>=n?i(d,p):(o=d,l||(l=setTimeout(()=>{l=null,i(o)},n-f)))},()=>o&&i(o)]}const Bt=(s,t,r=3)=>{let n=0;const o=ll(50,250);return al(l=>{const i=l.loaded,a=l.lengthComputable?l.total:void 0,c=i-n,d=o(c),p=i<=a;n=i;const f={loaded:i,total:a,progress:a?i/a:void 0,bytes:c,rate:d||void 0,estimated:d&&a&&p?(a-i)/d:void 0,event:l,lengthComputable:a!=null,[t?"download":"upload"]:!0};s(f)},r)},vr=(s,t)=>{const r=s!=null;return[n=>t[0]({lengthComputable:r,total:s,loaded:n}),t[1]]},kr=s=>(...t)=>y.asap(()=>s(...t)),cl=me.hasStandardBrowserEnv?((s,t)=>r=>(r=new URL(r,me.origin),s.protocol===r.protocol&&s.host===r.host&&(t||s.port===r.port)))(new URL(me.origin),me.navigator&&/(msie|trident)/i.test(me.navigator.userAgent)):()=>!0,dl=me.hasStandardBrowserEnv?{write(s,t,r,n,o,l){const i=[s+"="+encodeURIComponent(t)];y.isNumber(r)&&i.push("expires="+new Date(r).toGMTString()),y.isString(n)&&i.push("path="+n),y.isString(o)&&i.push("domain="+o),l===!0&&i.push("secure"),document.cookie=i.join("; ")},read(s){const t=document.cookie.match(new RegExp("(^|;\\s*)("+s+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(s){this.write(s,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function ul(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}function hl(s,t){return t?s.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):s}function Sn(s,t,r){let n=!ul(t);return s&&(n||r==!1)?hl(s,t):t}const Cr=s=>s instanceof Re?{...s}:s;function st(s,t){t=t||{};const r={};function n(d,p,f,w){return y.isPlainObject(d)&&y.isPlainObject(p)?y.merge.call({caseless:w},d,p):y.isPlainObject(p)?y.merge({},p):y.isArray(p)?p.slice():p}function o(d,p,f,w){if(y.isUndefined(p)){if(!y.isUndefined(d))return n(void 0,d,f,w)}else return n(d,p,f,w)}function l(d,p){if(!y.isUndefined(p))return n(void 0,p)}function i(d,p){if(y.isUndefined(p)){if(!y.isUndefined(d))return n(void 0,d)}else return n(void 0,p)}function a(d,p,f){if(f in t)return n(d,p);if(f in s)return n(void 0,d)}const c={url:l,method:l,data:l,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:a,headers:(d,p,f)=>o(Cr(d),Cr(p),f,!0)};return y.forEach(Object.keys(Object.assign({},s,t)),function(p){const f=c[p]||o,w=f(s[p],t[p],p);y.isUndefined(w)&&f!==a||(r[p]=w)}),r}const vn=s=>{const t=st({},s);let{data:r,withXSRFToken:n,xsrfHeaderName:o,xsrfCookieName:l,headers:i,auth:a}=t;t.headers=i=Re.from(i),t.url=gn(Sn(t.baseURL,t.url,t.allowAbsoluteUrls),s.params,s.paramsSerializer),a&&i.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let c;if(y.isFormData(r)){if(me.hasStandardBrowserEnv||me.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if((c=i.getContentType())!==!1){const[d,...p]=c?c.split(";").map(f=>f.trim()).filter(Boolean):[];i.setContentType([d||"multipart/form-data",...p].join("; "))}}if(me.hasStandardBrowserEnv&&(n&&y.isFunction(n)&&(n=n(t)),n||n!==!1&&cl(t.url))){const d=o&&l&&dl.read(l);d&&i.set(o,d)}return t},xl=typeof XMLHttpRequest<"u",pl=xl&&function(s){return new Promise(function(r,n){const o=vn(s);let l=o.data;const i=Re.from(o.headers).normalize();let{responseType:a,onUploadProgress:c,onDownloadProgress:d}=o,p,f,w,v,x;function j(){v&&v(),x&&x(),o.cancelToken&&o.cancelToken.unsubscribe(p),o.signal&&o.signal.removeEventListener("abort",p)}let b=new XMLHttpRequest;b.open(o.method.toUpperCase(),o.url,!0),b.timeout=o.timeout;function D(){if(!b)return;const m=Re.from("getAllResponseHeaders"in b&&b.getAllResponseHeaders()),T={data:!a||a==="text"||a==="json"?b.responseText:b.response,status:b.status,statusText:b.statusText,headers:m,config:s,request:b};wn(function(P){r(P),j()},function(P){n(P),j()},T),b=null}"onloadend"in b?b.onloadend=D:b.onreadystatechange=function(){!b||b.readyState!==4||b.status===0&&!(b.responseURL&&b.responseURL.indexOf("file:")===0)||setTimeout(D)},b.onabort=function(){b&&(n(new V("Request aborted",V.ECONNABORTED,s,b)),b=null)},b.onerror=function(){n(new V("Network Error",V.ERR_NETWORK,s,b)),b=null},b.ontimeout=function(){let C=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const T=o.transitional||jn;o.timeoutErrorMessage&&(C=o.timeoutErrorMessage),n(new V(C,T.clarifyTimeoutError?V.ETIMEDOUT:V.ECONNABORTED,s,b)),b=null},l===void 0&&i.setContentType(null),"setRequestHeader"in b&&y.forEach(i.toJSON(),function(C,T){b.setRequestHeader(T,C)}),y.isUndefined(o.withCredentials)||(b.withCredentials=!!o.withCredentials),a&&a!=="json"&&(b.responseType=o.responseType),d&&([w,x]=Bt(d,!0),b.addEventListener("progress",w)),c&&b.upload&&([f,v]=Bt(c),b.upload.addEventListener("progress",f),b.upload.addEventListener("loadend",v)),(o.cancelToken||o.signal)&&(p=m=>{b&&(n(!m||m.type?new ht(null,s,b):m),b.abort(),b=null)},o.cancelToken&&o.cancelToken.subscribe(p),o.signal&&(o.signal.aborted?p():o.signal.addEventListener("abort",p)));const k=il(o.url);if(k&&me.protocols.indexOf(k)===-1){n(new V("Unsupported protocol "+k+":",V.ERR_BAD_REQUEST,s));return}b.send(l||null)})},fl=(s,t)=>{const{length:r}=s=s?s.filter(Boolean):[];if(t||r){let n=new AbortController,o;const l=function(d){if(!o){o=!0,a();const p=d instanceof Error?d:this.reason;n.abort(p instanceof V?p:new ht(p instanceof Error?p.message:p))}};let i=t&&setTimeout(()=>{i=null,l(new V(`timeout ${t} of ms exceeded`,V.ETIMEDOUT))},t);const a=()=>{s&&(i&&clearTimeout(i),i=null,s.forEach(d=>{d.unsubscribe?d.unsubscribe(l):d.removeEventListener("abort",l)}),s=null)};s.forEach(d=>d.addEventListener("abort",l));const{signal:c}=n;return c.unsubscribe=()=>y.asap(a),c}},ml=function*(s,t){let r=s.byteLength;if(r<t){yield s;return}let n=0,o;for(;n<r;)o=n+t,yield s.slice(n,o),n=o},gl=async function*(s,t){for await(const r of jl(s))yield*ml(r,t)},jl=async function*(s){if(s[Symbol.asyncIterator]){yield*s;return}const t=s.getReader();try{for(;;){const{done:r,value:n}=await t.read();if(r)break;yield n}}finally{await t.cancel()}},Pr=(s,t,r,n)=>{const o=gl(s,t);let l=0,i,a=c=>{i||(i=!0,n&&n(c))};return new ReadableStream({async pull(c){try{const{done:d,value:p}=await o.next();if(d){a(),c.close();return}let f=p.byteLength;if(r){let w=l+=f;r(w)}c.enqueue(new Uint8Array(p))}catch(d){throw a(d),d}},cancel(c){return a(c),o.return()}},{highWaterMark:2})},ts=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",kn=ts&&typeof ReadableStream=="function",bl=ts&&(typeof TextEncoder=="function"?(s=>t=>s.encode(t))(new TextEncoder):async s=>new Uint8Array(await new Response(s).arrayBuffer())),Cn=(s,...t)=>{try{return!!s(...t)}catch{return!1}},yl=kn&&Cn(()=>{let s=!1;const t=new Request(me.origin,{body:new ReadableStream,method:"POST",get duplex(){return s=!0,"half"}}).headers.has("Content-Type");return s&&!t}),Rr=64*1024,Ss=kn&&Cn(()=>y.isReadableStream(new Response("").body)),Wt={stream:Ss&&(s=>s.body)};ts&&(s=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!Wt[t]&&(Wt[t]=y.isFunction(s[t])?r=>r[t]():(r,n)=>{throw new V(`Response type '${t}' is not supported`,V.ERR_NOT_SUPPORT,n)})})})(new Response);const wl=async s=>{if(s==null)return 0;if(y.isBlob(s))return s.size;if(y.isSpecCompliantForm(s))return(await new Request(me.origin,{method:"POST",body:s}).arrayBuffer()).byteLength;if(y.isArrayBufferView(s)||y.isArrayBuffer(s))return s.byteLength;if(y.isURLSearchParams(s)&&(s=s+""),y.isString(s))return(await bl(s)).byteLength},Sl=async(s,t)=>{const r=y.toFiniteNumber(s.getContentLength());return r??wl(t)},vl=ts&&(async s=>{let{url:t,method:r,data:n,signal:o,cancelToken:l,timeout:i,onDownloadProgress:a,onUploadProgress:c,responseType:d,headers:p,withCredentials:f="same-origin",fetchOptions:w}=vn(s);d=d?(d+"").toLowerCase():"text";let v=fl([o,l&&l.toAbortSignal()],i),x;const j=v&&v.unsubscribe&&(()=>{v.unsubscribe()});let b;try{if(c&&yl&&r!=="get"&&r!=="head"&&(b=await Sl(p,n))!==0){let T=new Request(t,{method:"POST",body:n,duplex:"half"}),N;if(y.isFormData(n)&&(N=T.headers.get("content-type"))&&p.setContentType(N),T.body){const[P,W]=vr(b,Bt(kr(c)));n=Pr(T.body,Rr,P,W)}}y.isString(f)||(f=f?"include":"omit");const D="credentials"in Request.prototype;x=new Request(t,{...w,signal:v,method:r.toUpperCase(),headers:p.normalize().toJSON(),body:n,duplex:"half",credentials:D?f:void 0});let k=await fetch(x,w);const m=Ss&&(d==="stream"||d==="response");if(Ss&&(a||m&&j)){const T={};["status","statusText","headers"].forEach(A=>{T[A]=k[A]});const N=y.toFiniteNumber(k.headers.get("content-length")),[P,W]=a&&vr(N,Bt(kr(a),!0))||[];k=new Response(Pr(k.body,Rr,P,()=>{W&&W(),j&&j()}),T)}d=d||"text";let C=await Wt[y.findKey(Wt,d)||"text"](k,s);return!m&&j&&j(),await new Promise((T,N)=>{wn(T,N,{data:C,headers:Re.from(k.headers),status:k.status,statusText:k.statusText,config:s,request:x})})}catch(D){throw j&&j(),D&&D.name==="TypeError"&&/Load failed|fetch/i.test(D.message)?Object.assign(new V("Network Error",V.ERR_NETWORK,s,x),{cause:D.cause||D}):V.from(D,D&&D.code,s,x)}}),vs={http:Mi,xhr:pl,fetch:vl};y.forEach(vs,(s,t)=>{if(s){try{Object.defineProperty(s,"name",{value:t})}catch{}Object.defineProperty(s,"adapterName",{value:t})}});const _r=s=>`- ${s}`,kl=s=>y.isFunction(s)||s===null||s===!1,Pn={getAdapter:s=>{s=y.isArray(s)?s:[s];const{length:t}=s;let r,n;const o={};for(let l=0;l<t;l++){r=s[l];let i;if(n=r,!kl(r)&&(n=vs[(i=String(r)).toLowerCase()],n===void 0))throw new V(`Unknown adapter '${i}'`);if(n)break;o[i||"#"+l]=n}if(!n){const l=Object.entries(o).map(([a,c])=>`adapter ${a} `+(c===!1?"is not supported by the environment":"is not available in the build"));let i=t?l.length>1?`since :
`+l.map(_r).join(`
`):" "+_r(l[0]):"as no adapter specified";throw new V("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return n},adapters:vs};function cs(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new ht(null,s)}function Ir(s){return cs(s),s.headers=Re.from(s.headers),s.data=as.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),Pn.getAdapter(s.adapter||Ct.adapter)(s).then(function(n){return cs(s),n.data=as.call(s,s.transformResponse,n),n.headers=Re.from(n.headers),n},function(n){return yn(n)||(cs(s),n&&n.response&&(n.response.data=as.call(s,s.transformResponse,n.response),n.response.headers=Re.from(n.response.headers))),Promise.reject(n)})}const Rn="1.10.0",ss={};["object","boolean","number","function","string","symbol"].forEach((s,t)=>{ss[s]=function(n){return typeof n===s||"a"+(t<1?"n ":" ")+s}});const Er={};ss.transitional=function(t,r,n){function o(l,i){return"[Axios v"+Rn+"] Transitional option '"+l+"'"+i+(n?". "+n:"")}return(l,i,a)=>{if(t===!1)throw new V(o(i," has been removed"+(r?" in "+r:"")),V.ERR_DEPRECATED);return r&&!Er[i]&&(Er[i]=!0,console.warn(o(i," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(l,i,a):!0}};ss.spelling=function(t){return(r,n)=>(console.warn(`${n} is likely a misspelling of ${t}`),!0)};function Cl(s,t,r){if(typeof s!="object")throw new V("options must be an object",V.ERR_BAD_OPTION_VALUE);const n=Object.keys(s);let o=n.length;for(;o-- >0;){const l=n[o],i=t[l];if(i){const a=s[l],c=a===void 0||i(a,l,s);if(c!==!0)throw new V("option "+l+" must be "+c,V.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new V("Unknown option "+l,V.ERR_BAD_OPTION)}}const Nt={assertOptions:Cl,validators:ss},Ne=Nt.validators;let tt=class{constructor(t){this.defaults=t||{},this.interceptors={request:new wr,response:new wr}}async request(t,r){try{return await this._request(t,r)}catch(n){if(n instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const l=o.stack?o.stack.replace(/^.+\n/,""):"";try{n.stack?l&&!String(n.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+l):n.stack=l}catch{}}throw n}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=st(this.defaults,r);const{transitional:n,paramsSerializer:o,headers:l}=r;n!==void 0&&Nt.assertOptions(n,{silentJSONParsing:Ne.transitional(Ne.boolean),forcedJSONParsing:Ne.transitional(Ne.boolean),clarifyTimeoutError:Ne.transitional(Ne.boolean)},!1),o!=null&&(y.isFunction(o)?r.paramsSerializer={serialize:o}:Nt.assertOptions(o,{encode:Ne.function,serialize:Ne.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),Nt.assertOptions(r,{baseUrl:Ne.spelling("baseURL"),withXsrfToken:Ne.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let i=l&&y.merge(l.common,l[r.method]);l&&y.forEach(["delete","get","head","post","put","patch","common"],x=>{delete l[x]}),r.headers=Re.concat(i,l);const a=[];let c=!0;this.interceptors.request.forEach(function(j){typeof j.runWhen=="function"&&j.runWhen(r)===!1||(c=c&&j.synchronous,a.unshift(j.fulfilled,j.rejected))});const d=[];this.interceptors.response.forEach(function(j){d.push(j.fulfilled,j.rejected)});let p,f=0,w;if(!c){const x=[Ir.bind(this),void 0];for(x.unshift.apply(x,a),x.push.apply(x,d),w=x.length,p=Promise.resolve(r);f<w;)p=p.then(x[f++],x[f++]);return p}w=a.length;let v=r;for(f=0;f<w;){const x=a[f++],j=a[f++];try{v=x(v)}catch(b){j.call(this,b);break}}try{p=Ir.call(this,v)}catch(x){return Promise.reject(x)}for(f=0,w=d.length;f<w;)p=p.then(d[f++],d[f++]);return p}getUri(t){t=st(this.defaults,t);const r=Sn(t.baseURL,t.url,t.allowAbsoluteUrls);return gn(r,t.params,t.paramsSerializer)}};y.forEach(["delete","get","head","options"],function(t){tt.prototype[t]=function(r,n){return this.request(st(n||{},{method:t,url:r,data:(n||{}).data}))}});y.forEach(["post","put","patch"],function(t){function r(n){return function(l,i,a){return this.request(st(a||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:l,data:i}))}}tt.prototype[t]=r(),tt.prototype[t+"Form"]=r(!0)});let Pl=class _n{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(l){r=l});const n=this;this.promise.then(o=>{if(!n._listeners)return;let l=n._listeners.length;for(;l-- >0;)n._listeners[l](o);n._listeners=null}),this.promise.then=o=>{let l;const i=new Promise(a=>{n.subscribe(a),l=a}).then(o);return i.cancel=function(){n.unsubscribe(l)},i},t(function(l,i,a){n.reason||(n.reason=new ht(l,i,a),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=n=>{t.abort(n)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new _n(function(o){t=o}),cancel:t}}};function Rl(s){return function(r){return s.apply(null,r)}}function _l(s){return y.isObject(s)&&s.isAxiosError===!0}const ks={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ks).forEach(([s,t])=>{ks[t]=s});function In(s){const t=new tt(s),r=nn(tt.prototype.request,t);return y.extend(r,tt.prototype,t,{allOwnKeys:!0}),y.extend(r,t,null,{allOwnKeys:!0}),r.create=function(o){return In(st(s,o))},r}const le=In(Ct);le.Axios=tt;le.CanceledError=ht;le.CancelToken=Pl;le.isCancel=yn;le.VERSION=Rn;le.toFormData=es;le.AxiosError=V;le.Cancel=le.CanceledError;le.all=function(t){return Promise.all(t)};le.spread=Rl;le.isAxiosError=_l;le.mergeConfig=st;le.AxiosHeaders=Re;le.formToJSON=s=>bn(y.isHTMLForm(s)?new FormData(s):s);le.getAdapter=Pn.getAdapter;le.HttpStatusCode=ks;le.default=le;const{Axios:$a,AxiosError:qa,CanceledError:Ua,isCancel:Ba,CancelToken:Wa,VERSION:Ha,all:Va,Cancel:Ja,isAxiosError:Ga,spread:Ka,toFormData:Za,AxiosHeaders:Qa,HttpStatusCode:Xa,formToJSON:Ya,getAdapter:ec,mergeConfig:tc}=le;async function Il(s,t){try{console.log("Sending to backend:",{purchaseOrderId:s,items:t});const r=await le.post("/api/receive-purchase-order",{purchaseOrderId:s,items:t});console.log("Purchase order received successfully:",r.data)}catch(r){throw console.error("Error receiving purchase order:",r),new Error("Failed to receive purchase order")}}const El=({open:s,onClose:t,poId:r,orderNumber:n,items:o,onConfirm:l})=>{const[i,a]=h.useState([]),[c,d]=h.useState(!0),[p,f]=h.useState(!1);h.useEffect(()=>{s&&(d(!0),a(o.map(x=>({id:x.id,product_id:x.product_id,ProductName:x.ProductName,quantity_ordered:x.quantity_ordered??0,quantity_received:x.quantity_received??x.quantity_ordered??0}))),d(!1))},[o,s]);const w=(x,j)=>{let b=0;if(j==="")b=0;else if(/^\d+$/.test(j))b=parseInt(j,10);else return;a(D=>D.map(k=>k.id===x?{...k,quantity_received:b}:k))},v=async()=>{try{const x=i.map(({product_id:j,quantity_received:b})=>({product_id:String(j),quantity_received:b}));await Il(String(r),x),f(!0),t()}catch(x){console.error("Error receiving purchase order:",x),alert("Failed to receive purchase order. Please try again.")}};return e.jsxs(e.Fragment,{children:[e.jsx(Ie,{open:s,onClose:t,"aria-labelledby":"receive-po-dialog-title",children:e.jsxs(Ee,{sx:{minWidth:400},children:[e.jsx(Ge,{}),e.jsxs(g,{id:"receive-po-dialog-title",level:"h4",sx:{mb:2},children:["Receive Purchase Order #",n??r]}),c?e.jsx(g,{children:"Loading items..."}):i.length===0?e.jsx(g,{children:"No items found for this purchase order."}):e.jsxs(We,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Ordered"}),e.jsx("th",{children:"Received"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:i.map(x=>e.jsxs("tr",{children:[e.jsx("td",{children:x.ProductName}),e.jsx("td",{children:x.quantity_ordered}),e.jsx("td",{children:e.jsx(B,{type:"number",value:x.quantity_received===0&&i.find(j=>j.id===x.id)?.quantity_received===0?"0":x.quantity_received,onChange:j=>w(x.id,j.target.value),sx:{width:80},slotProps:{input:{min:0,max:x.quantity_ordered}}})}),e.jsx("td",{style:{textAlign:"center"},children:x.quantity_received===x.quantity_ordered?e.jsx(Ls,{sx:{color:"#2e7d32"},titleAccess:"Received in full"}):e.jsx(Yr,{sx:{color:"#d32f2f"},titleAccess:"Not fully received"})})]},x.id))})]}),e.jsxs(u,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:3},children:[e.jsx(q,{variant:"plain",onClick:t,children:"Cancel"}),e.jsx(q,{variant:"solid",onClick:v,children:"Receive"})]})]})}),e.jsx(Gt,{open:p,autoHideDuration:3e3,onClose:()=>f(!1),color:"success",variant:"soft",anchorOrigin:{vertical:"top",horizontal:"center"},children:"Purchase order received successfully!"})]})},Dr={Pending:0,Ordered:1,Approved:2,Received:3,Cancelled:4},Je={fontSize:Y.sizes.small},Qe={...Je,fontWeight:600,borderBottom:"1.5px solid #e0e0e0",background:"inherit"},Et=s=>{switch(s){case"Pending":return"warning";case"Ordered":return"primary";case"Approved":return"primary";case"Received":return"success";case"Cancelled":return"danger";default:return"neutral"}},Dl=s=>{switch(s){case"Pending":return e.jsx(ar,{});case"Ordered":return e.jsx($t,{});case"Approved":return e.jsx($t,{});case"Received":return e.jsx(Ls,{});case"Cancelled":return e.jsx(Yr,{});default:return e.jsx(ar,{})}},Al=()=>{const{isMobile:s}=Ce(),[t,r]=h.useState([]),[n,o]=h.useState(!1),[l,i]=h.useState(null),[a,c]=h.useState(""),[d,p]=h.useState(""),[f,w]=h.useState(!1),[v,x]=h.useState(!1),[j,b]=h.useState(null),[D,k]=h.useState([]),m=async()=>{o(!0),i(null);try{const{data:S,error:_}=await L.from("PurchaseOrders").select("id, order_number, order_date, status, total, notes, Suppliers(name)").order("order_date",{ascending:!1});if(_)throw _;if(S){const E=S.map($=>({...$,supplier_name:$.Suppliers?.[0]?.name||"N/A",Suppliers:void 0}));r(E)}}catch(S){i(S.message||"Failed to fetch purchase orders")}finally{o(!1)}},C=async S=>{try{const{data:_,error:E}=await L.from("purchaseorderitems").select("id, product_id, Products(ProductName), quantity_ordered, quantity_received").eq("purchase_order_id",S);if(E)throw E;if(_){const $=_.map(re=>({...re,ProductName:re.Products?.[0]?.ProductName||"Unknown Product"}));k($)}}catch(_){console.error("Error fetching PO items:",_)}},T=async()=>{await m()},N=async(S,_)=>{try{const{error:E}=await L.from("PurchaseOrders").update({status:_}).eq("id",S);if(E)throw E;await m()}catch(E){i(E.message||"Failed to update order status")}},P=async S=>{b(S),await C(S.id),x(!0)},W=async S=>{try{for(const _ of S)await L.from("purchaseorderitems").update({quantity_received:_.quantity_received}).eq("id",_.id);j?.id&&await L.from("PurchaseOrders").update({status:"Received"}).eq("id",j.id),x(!1),b(null),await m()}catch(_){i(_.message||"Failed to receive order")}},M=[...t.filter(S=>{const _=S.order_number?.toString().toLowerCase().includes(a.toLowerCase())||S.supplier_name?.toLowerCase().includes(a.toLowerCase()),E=d?S.status===d:!0;return _&&E})].sort((S,_)=>{const E=Dr[S.status]??99,$=Dr[_.status]??99;return E!==$?E-$:new Date(_.order_date).getTime()-new Date(S.order_date).getTime()});h.useEffect(()=>{m()},[]);const F=()=>e.jsxs(u,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(je,{padding:"medium",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:Y.sizes.xlarge},children:"Purchase Orders"}),e.jsxs(u,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(B,{placeholder:"Search orders...",value:a,onChange:S=>c(S.target.value),startDecorator:e.jsx(ge,{}),sx:{flex:1}}),e.jsxs(ie,{placeholder:"Status",value:d,onChange:(S,_)=>p(_??""),sx:{minWidth:120},children:[e.jsx(z,{value:"",children:"All"}),e.jsx(z,{value:"Pending",children:"Pending"}),e.jsx(z,{value:"Ordered",children:"Ordered"}),e.jsx(z,{value:"Approved",children:"Approved"}),e.jsx(z,{value:"Received",children:"Received"}),e.jsx(z,{value:"Cancelled",children:"Cancelled"})]})]}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(ue,{}),onClick:()=>w(!0),sx:{width:"100%",mb:2},children:"Add Purchase Order"})]}),n&&e.jsx(De,{}),l&&e.jsx(u,{sx:{p:2},children:e.jsxs(g,{color:"danger",children:["Error: ",l]})}),e.jsx(u,{children:M.length===0?e.jsx(u,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:"No purchase orders found"})}):M.map(S=>e.jsx(u,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(u,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${Et(S.status)}.100`,color:`${Et(S.status)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",flexShrink:0},children:Dl(S.status)}),e.jsxs(u,{sx:{flex:1,minWidth:0},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsxs(g,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:["Order #",S.order_number]}),e.jsx(se,{size:"sm",color:Et(S.status),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content"},children:S.status})]}),e.jsxs(g,{level:"body-xs",color:"neutral",sx:{mb:.5},children:[S.supplier_name," • ",new Date(S.order_date).toLocaleDateString()]}),e.jsxs(g,{level:"body-sm",sx:{fontWeight:"bold",color:"text.primary"},children:["Total: ",dt(S.total||0)]}),e.jsx(u,{sx:{display:"flex",gap:1,mt:1},children:S.status==="Pending"?e.jsx(q,{size:"sm",variant:"outlined",onClick:()=>N(S.id,"Ordered"),children:"Order"}):e.jsx(q,{size:"sm",variant:"outlined",onClick:()=>P(S),disabled:S.status!=="Approved"&&S.status!=="Ordered",children:"Receive"})})]})]})},S.id))})]}),U=()=>e.jsxs(je,{variant:"table-page",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:Y.sizes.xlarge},children:"Purchase Orders"}),e.jsxs(u,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(B,{placeholder:"Search purchase orders...",sx:{flex:1},value:a,onChange:S=>c(S.target.value),startDecorator:e.jsx(ge,{})}),e.jsxs(ie,{placeholder:"Filter status",value:d,onChange:(S,_)=>p(_??""),sx:{minWidth:160},children:[e.jsx(z,{value:"",children:"All Statuses"}),e.jsx(z,{value:"Pending",children:"Pending"}),e.jsx(z,{value:"Ordered",children:"Ordered"}),e.jsx(z,{value:"Approved",children:"Approved"}),e.jsx(z,{value:"Received",children:"Received"}),e.jsx(z,{value:"Cancelled",children:"Cancelled"})]}),e.jsx(q,{onClick:()=>w(!0),variant:"solid",startDecorator:e.jsx(ue,{}),children:"Add Purchase Order"})]}),e.jsxs(ke,{sx:{overflow:"visible"},children:[n&&e.jsx(De,{}),l&&e.jsxs(g,{color:"danger",children:["Error: ",l]}),e.jsxs(We,{"aria-label":"Purchase Orders",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:Qe,children:"Order Number"}),e.jsx("th",{style:Qe,children:"Order Date"}),e.jsx("th",{style:Qe,children:"Status"}),e.jsx("th",{style:Qe,children:"Total"}),e.jsx("th",{style:Qe,children:"Supplier"}),e.jsx("th",{style:Qe,children:"Notes"}),e.jsx("th",{style:{width:120,...Qe},children:"Actions"})]})}),e.jsxs("tbody",{children:[M.length===0&&!n&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...Je},children:"No purchase orders found."})}),M.map(S=>e.jsxs("tr",{style:{cursor:"pointer",height:48},children:[e.jsx("td",{style:Je,children:S.order_number}),e.jsx("td",{style:Je,children:new Date(S.order_date).toLocaleDateString()}),e.jsx("td",{style:Je,children:e.jsx(se,{size:"sm",color:Et(S.status),variant:"soft",children:S.status})}),e.jsx("td",{style:Je,children:dt(S.total||0)}),e.jsx("td",{style:Je,children:S.supplier_name}),e.jsx("td",{style:Je,children:S.notes||"-"}),e.jsx("td",{children:S.status==="Pending"?e.jsx(q,{size:"sm",variant:"outlined",onClick:()=>N(S.id,"Ordered"),children:"Order"}):e.jsx(q,{size:"sm",variant:"outlined",onClick:()=>P(S),disabled:S.status!=="Approved"&&S.status!=="Ordered",children:"Receive"})})]},S.id))]})]})]})]});return e.jsxs($e,{children:[s?e.jsx(F,{}):e.jsx(U,{}),e.jsx(Xo,{open:f,onClose:()=>w(!1),onCreated:T,mode:"add",order:void 0}),e.jsx(El,{open:v&&!!j?.id,onClose:()=>{x(!1),b(null)},poId:j?.id||"",orderNumber:j?.order_number||"",items:D.filter(S=>!!S.id&&!!S.product_id),onConfirm:W})]})};function Ol({value:s,onChange:t,toggleSidebar:r}){const n=Ms(),[o,l]=h.useState(!1),[i,a]=h.useState("Sales");if(n.pathname==="/login")return null;const c=h.useMemo(()=>Wn({components:{MuiTableRow:{styleOverrides:{root:{"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}}}}}}),[]);To.filter(f=>f.showInMobile);const d=i?Tt[i].filter(f=>f.showInMobile):[],p=async f=>{const{data:w}=await L.auth.getSession();if(!w&&["orders","products","users","suppliers","purchaseorders","tickets","smscampaigns","movements"].includes(f)){console.warn("Authentication required for this page"),t("home");return}t(f)};return e.jsxs(Hn,{theme:c,children:[e.jsxs(Vn,{open:o,onClose:()=>l(!1),children:[e.jsx(Jn,{children:"Select Area"}),e.jsx(Gn,{children:["Sales","Support","Marketing","Operations"].map(f=>e.jsx(er,{fullWidth:!0,variant:i===f?"contained":"outlined",onClick:()=>{a(f),l(!1)},sx:{my:1},children:f},f))}),e.jsx(Kn,{children:e.jsx(er,{onClick:()=>l(!1),children:"Close"})})]}),e.jsx(Zn,{sx:{position:"fixed",bottom:0,left:0,right:0,zIndex:9999,backgroundColor:"rgba(0, 0, 255, 0.2)",overflow:"hidden"},children:e.jsx("div",{style:{display:"flex",flexDirection:"row",overflowX:"auto"},children:e.jsxs(Qn,{showLabels:!0,value:s,onChange:(f,w)=>{p(w)},sx:{minWidth:"max-content",flex:1},children:[d.map(f=>e.jsx(tr,{label:f.label,icon:f.icon,value:f.value,onClick:()=>p(f.value)},f.value)),e.jsx(tr,{label:i||"",icon:e.jsx(po,{}),onClick:f=>{f.stopPropagation(),l(!0)}})]})})})]})}function ds({open:s,onClose:t,onCreated:r}){const[n,o]=h.useState(""),[l,i]=h.useState(""),[a,c]=h.useState(!1),[d,p]=h.useState(null),f=async w=>{w.preventDefault(),c(!0),p(null);const v={subject:n,requester_name:l,status:"Open"};console.log("[DialogTicketCreate] Creating ticket with payload:",v);const{error:x,data:j}=await L.from("tickets").insert(v);x&&(p(x.message||JSON.stringify(x)),console.error("[DialogTicketCreate] Error creating ticket:",x)),c(!1),x||(o(""),i(""),t(),r&&r())};return e.jsx(Ie,{open:s,onClose:t,children:e.jsxs(Ee,{sx:{minWidth:400},children:[e.jsx(g,{level:"title-md",sx:{mb:2},children:"Create Ticket"}),e.jsxs("form",{onSubmit:f,children:[e.jsx(B,{placeholder:"Subject",value:n,onChange:w=>o(w.target.value),sx:{mb:2},required:!0}),e.jsx(B,{placeholder:"Requester Name",value:l,onChange:w=>i(w.target.value),sx:{mb:2},required:!0}),d&&e.jsx(g,{color:"danger",sx:{mb:1},children:d}),e.jsx(q,{type:"submit",loading:a,disabled:a||!n||!l,variant:"solid",children:"Create"})]})]})})}const Tl=["Refund issued","Replacement sent","Order cancelled","Technical support provided","Information provided","Awaiting customer response","Other"],zl=({open:s,onClose:t,onSubmit:r})=>{const[n,o]=K.useState(""),[l,i]=K.useState("");return K.useEffect(()=>{s||(o(""),i(""))},[s]),e.jsx(Ie,{open:s,onClose:t,children:e.jsxs(Ee,{children:[e.jsx(_s,{children:"Resolve Ticket"}),e.jsxs(Is,{sx:{display:"flex",flexDirection:"column",gap:2,minWidth:320},children:[e.jsx(ie,{value:n,onChange:(a,c)=>o(c||""),placeholder:"Select resolution",required:!0,children:Tl.map(a=>e.jsx(z,{value:a,children:a},a))}),e.jsx(gs,{minRows:3,placeholder:"Resolution comment to customer...",value:l,onChange:a=>i(a.target.value)})]}),e.jsxs(Es,{children:[e.jsx(q,{variant:"plain",onClick:t,children:"Cancel"}),e.jsx(q,{variant:"solid",color:"primary",disabled:!n,onClick:()=>{try{r(n,l),t()}catch(a){console.error("Error during form submission:",a)}},children:"Submit"})]})]})})},us=$s(zl),Ar=s=>{if(!s)return"";const t=new Date(s),n=Math.floor((new Date().getTime()-t.getTime())/1e3);if(n<60)return"Just now";const o=Math.floor(n/60);if(o<60)return`${o} min ago`;const l=Math.floor(o/60);if(l<24)return`${l} hour${l>1?"s":""} ago`;const i=Math.floor(l/24);if(i<7)return`${i} day${i>1?"s":""} ago`;const a=Math.floor(i/7);if(a<4)return`${a} week${a>1?"s":""} ago`;const c=Math.floor(i/30);return`${c} month${c>1?"s":""} ago`},mt={Open:{color:"success",label:"Open"},Pending:{color:"warning",label:"Pending"},Closed:{color:"neutral",label:"Closed"}};function Ll(){const{isMobile:s}=Ce(),[t,r]=h.useState([]),[n,o]=h.useState(null),[l,i]=h.useState([]),[a,c]=h.useState(""),[d,p]=h.useState(""),[f,w]=h.useState("Open"),[v,x]=h.useState(!1),[j,b]=h.useState(!1),[D,k]=h.useState(!1);h.useEffect(()=>{(async()=>{const{data:M,error:F}=await L.from("tickets").select("*").order("created_at",{ascending:!1});F||r(M||[])})()},[]),h.useEffect(()=>{if(!n){i([]);return}(async()=>{const{data:M,error:F}=await L.from("ticketactivities").select("*").eq("ticket_id",n).order("timestamp",{ascending:!0});F||i(M||[])})()},[n]);const m=async()=>{const{data:A,error:M}=await L.from("tickets").select("*").order("created_at",{ascending:!1});M||r(A||[])},C=async()=>{if(a.trim()&&n){console.log("Sending message:",{ticket_id:n,message:a,activity_type:"chat",sender_name:"You"});const{error:A,data:M}=await L.from("ticketactivities").insert({ticket_id:n,message:a,activity_type:"chat",sender_name:"You"}).select();if(A){console.error("Error sending message:",A),alert("Failed to send message: "+A.message);return}console.log("Message sent successfully:",M),c("");const{data:F,error:U}=await L.from("ticketactivities").select("*").eq("ticket_id",n).order("timestamp",{ascending:!0});U?console.error("Error fetching activities:",U):(console.log("Refreshed activities:",F),i(F||[]))}},T=async(A,M)=>{if(n)try{const{error:F}=await L.from("tickets").update({status:"Closed"}).eq("id",n);if(F){console.error("Error updating ticket status:",F),alert("Failed to resolve ticket: "+F.message);return}const{error:U}=await L.from("ticketactivities").insert({ticket_id:n,message:`Ticket resolved: ${A}${M?` - ${M}`:""}`,activity_type:"chat",sender_name:"You"});U&&console.error("Error adding resolution activity:",U),await m();const{data:S}=await L.from("ticketactivities").select("*").eq("ticket_id",n).order("timestamp",{ascending:!0});i(S||[])}catch(F){console.error("Error resolving ticket:",F),alert("Failed to resolve ticket")}},N=A=>{o(A),k(!0)},P=()=>{k(!1),o(null)},W=t.filter(A=>{if(f!=="All"&&A.status!==f)return!1;if(!d)return!0;const M=d.toLowerCase();return A.subject?.toLowerCase().includes(M)||A.requester_name?.toLowerCase().includes(M)||A.status?.toLowerCase().includes(M)});if(s){const A=t.length>0&&t.every(M=>M.status==="Closed")&&f==="Open";if(D&&n){const M=t.find(F=>F.id===n);return e.jsxs($e,{children:[e.jsxs(u,{sx:{display:"flex",flexDirection:"column",height:"100vh"},children:[e.jsxs(u,{sx:{px:2,py:1.5,borderBottom:"1px solid",borderColor:"divider",display:"flex",alignItems:"center",gap:2,bgcolor:"background.surface"},children:[e.jsx(te,{size:"sm",variant:"plain",onClick:P,children:e.jsx(fo,{})}),e.jsx(ce,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:M?.requester_name?.[0]?.toUpperCase()||"?"}),e.jsxs(u,{sx:{flex:1,minWidth:0},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:600,mb:.5},children:M?.subject||"Untitled"}),e.jsx(g,{level:"body-xs",color:"neutral",children:M?.requester_name})]}),e.jsx(se,{variant:"soft",size:"sm",color:mt[M?.status||"Open"]?.color,sx:{fontWeight:600},children:mt[M?.status||"Open"]?.label}),M?.status!=="Closed"&&e.jsx(q,{variant:"solid",color:"primary",size:"sm",onClick:()=>b(!0),children:"Resolve"})]}),e.jsx(u,{sx:{flex:1,overflowY:"auto",px:2,py:2},children:e.jsx(Q,{spacing:3,children:l.map((F,U)=>{const S=F.sender_name==="You";return e.jsxs(u,{children:[U===0||new Date(F.timestamp||"").toDateString()!==new Date(l[U-1]?.timestamp||"").toDateString()?e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(u,{sx:{flex:1,height:"1px",bgcolor:"divider"}}),e.jsx(g,{level:"body-xs",sx:{mx:2,color:"text.secondary"},children:F.timestamp?new Date(F.timestamp).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}):""}),e.jsx(u,{sx:{flex:1,height:"1px",bgcolor:"divider"}})]}):null,e.jsxs(Q,{direction:"row",spacing:1,sx:{alignItems:"flex-start"},children:[!S&&e.jsx(ce,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:F.sender_name?.[0]?.toUpperCase()||"?"}),e.jsx(u,{sx:{flex:1,display:"flex",flexDirection:S?"row-reverse":"row"},children:e.jsxs(u,{sx:{maxWidth:"85%",bgcolor:S?"primary.500":"neutral.50",color:S?"white":"text.primary",borderRadius:S?"18px 18px 4px 18px":"18px 18px 18px 4px",px:2,py:1.5,position:"relative",boxShadow:"sm"},children:[!S&&e.jsx(g,{level:"body-xs",sx:{fontWeight:600,mb:.5,color:S?"white":"text.primary"},children:F.sender_name}),e.jsx(g,{level:"body-sm",sx:{lineHeight:1.4,color:S?"white":"text.primary"},children:F.message})]})}),S&&e.jsx(ce,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:F.sender_name?.[0]?.toUpperCase()||"?"})]}),e.jsx(u,{sx:{display:"flex",justifyContent:S?"flex-end":"flex-start",mt:.5,ml:S?0:5},children:e.jsx(g,{level:"body-xs",sx:{color:"text.tertiary"},children:F.timestamp?new Date(F.timestamp).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):""})})]},F.id)})})}),e.jsx(u,{sx:{px:2,py:1.5,borderTop:"1px solid",borderColor:"divider",bgcolor:"background.surface"},children:e.jsxs(Q,{direction:"row",spacing:1,alignItems:"flex-end",children:[e.jsx(u,{sx:{flex:1},children:e.jsx(gs,{placeholder:"Type something here...",value:a,onChange:F=>c(F.target.value),minRows:1,maxRows:3,sx:{borderRadius:"20px",border:"1px solid",borderColor:"neutral.300","&:focus-within":{borderColor:"primary.500"},"& textarea":{border:"none",outline:"none",resize:"none",px:2,py:1}},onKeyDown:F=>{F.key==="Enter"&&!F.shiftKey&&(F.preventDefault(),C())}})}),e.jsx(q,{onClick:C,disabled:!a.trim(),variant:"solid",color:"primary",size:"sm",sx:{borderRadius:"20px",minWidth:50,height:36,fontWeight:600},children:"Send"})]})})]}),e.jsx(ds,{open:v,onClose:()=>x(!1),onCreated:m}),e.jsx(us,{open:j,onClose:()=>b(!1),onSubmit:T})]})}return e.jsxs($e,{children:[e.jsxs(u,{sx:{p:2},children:[e.jsx(g,{level:"h2",sx:{mb:3,fontWeight:600},children:"Tickets"}),e.jsxs(Q,{spacing:2,sx:{mb:2},children:[e.jsxs(Q,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(B,{placeholder:"Search tickets...",startDecorator:e.jsx(ge,{}),value:d,onChange:M=>p(M.target.value),size:"sm",sx:{flex:1}}),e.jsx(te,{size:"sm",variant:"soft",color:"primary",onClick:()=>x(!0),children:e.jsx(ue,{})})]}),e.jsxs(ie,{value:f,onChange:(M,F)=>w(F),size:"sm",placeholder:"Filter by status",children:[e.jsx(z,{value:"All",children:"All Tickets"}),e.jsx(z,{value:"Open",children:"Open"}),e.jsx(z,{value:"Pending",children:"Pending"}),e.jsx(z,{value:"Closed",children:"Closed"})]})]}),A?e.jsxs(u,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"60vh",gap:2},children:[e.jsx(mo,{sx:{fontSize:80,color:"primary.500"}}),e.jsx(g,{level:"h3",sx:{fontWeight:700,textAlign:"center"},children:"All done, you can now go to the beach"})]}):e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:0},children:[W.map((M,F)=>e.jsxs(h.Fragment,{children:[e.jsxs(u,{sx:{p:2,display:"flex",alignItems:"flex-start",gap:2,cursor:"pointer",background:"transparent",borderRadius:1,transition:"all 0.2s","&:hover":{bgcolor:"neutral.50"}},onClick:()=>N(M.id),children:[e.jsx(ce,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600,mt:.5},children:M.requester_name?.[0]?.toUpperCase()||"?"}),e.jsxs(u,{sx:{flex:1,minWidth:0},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:600,mb:.5,wordBreak:"break-word"},children:M.subject||"Untitled"}),e.jsx(g,{level:"body-xs",color:"neutral",sx:{mb:.5,wordBreak:"break-word"},children:M.requester_name}),e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(g,{level:"body-xs",color:"neutral",children:Ar(M.updated_at)}),e.jsx(g,{level:"body-xs",color:"neutral",children:"•"}),e.jsxs(g,{level:"body-xs",color:"neutral",sx:{wordBreak:"break-all"},children:[M.id?.slice(0,8),"..."]})]})]}),e.jsx(se,{variant:"soft",size:"sm",color:mt[M.status||"Open"]?.color,sx:{fontWeight:600,px:1.5,py:.5,ml:1},children:mt[M.status||"Open"]?.label})]}),F<W.length-1&&e.jsx(wt,{sx:{my:.5}})]},M.id)),W.length===0&&e.jsx(g,{color:"neutral",sx:{textAlign:"center",mt:4},children:"No tickets found."})]})]}),e.jsx(ds,{open:v,onClose:()=>x(!1),onCreated:m}),e.jsx(us,{open:j,onClose:()=>b(!1),onSubmit:T})]})}return e.jsxs(u,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[e.jsxs(u,{sx:{display:"flex",flex:1},children:[e.jsxs(u,{sx:{width:390,borderRight:"1px solid",borderColor:"divider",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs(u,{sx:{px:2,py:1,borderBottom:"1px solid",borderColor:"divider",flexShrink:0},children:[e.jsxs(Q,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[e.jsxs(Q,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(g,{level:"title-lg",children:"Messages"}),e.jsx(se,{size:"sm",variant:"soft",color:"neutral",children:W.length})]}),e.jsx(te,{size:"sm",variant:"soft",color:"primary",onClick:()=>x(!0),children:e.jsx(ue,{})})]}),e.jsx(B,{placeholder:"Search",startDecorator:e.jsx(ge,{}),value:d,onChange:A=>p(A.target.value),size:"sm",sx:{width:"100%",mb:1}}),e.jsxs(ie,{value:f,onChange:(A,M)=>w(M),size:"sm",sx:{width:"100%"},placeholder:"Filter by status",children:[e.jsx(z,{value:"All",children:"All Tickets"}),e.jsx(z,{value:"Open",children:"Open"}),e.jsx(z,{value:"Pending",children:"Pending"}),e.jsx(z,{value:"Closed",children:"Closed"})]})]}),e.jsx(u,{sx:{flex:1,overflowY:"auto",overflowX:"hidden",pt:1},children:e.jsx(ps,{size:"sm",sx:{gap:0},children:W.map(A=>e.jsxs(h.Fragment,{children:[e.jsx(fs,{sx:{p:0},children:e.jsx(bt,{selected:n===A.id,onClick:()=>o(A.id),sx:{py:1,px:2},children:e.jsxs(Q,{direction:"row",spacing:1.5,alignItems:"flex-start",sx:{width:"100%"},children:[e.jsx(u,{sx:{position:"relative"},children:e.jsx(ce,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:A.requester_name?.[0]?.toUpperCase()||"?"})}),e.jsxs(u,{sx:{flex:1,minWidth:0,pr:1},children:[e.jsxs(Q,{direction:"row",justifyContent:"space-between",alignItems:"flex-start",sx:{mb:.5},children:[e.jsx(g,{level:"body-md",noWrap:!0,sx:{flex:1,pr:1},children:A.subject||"Untitled"}),A.status&&e.jsx(se,{size:"sm",color:mt[A.status]?.color,variant:"soft",sx:{flexShrink:0},children:A.status})]}),e.jsx(g,{level:"body-sm",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",mb:.5},children:A.requester_name||""}),e.jsx(u,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(g,{level:"body-xs",sx:{color:"text.tertiary"},children:Ar(A.updated_at)})})]})]})})}),e.jsx(Xn,{component:"li",sx:{margin:0}})]},A.id))})})]}),e.jsxs(u,{sx:{flex:1,display:"flex",flexDirection:"column"},children:[n&&e.jsx(u,{sx:{px:3,py:2,borderBottom:"1px solid",borderColor:"divider",flexShrink:0},children:e.jsxs(Q,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(ce,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:t.find(A=>A.id===n)?.requester_name?.[0]?.toUpperCase()||"?"}),e.jsxs(u,{sx:{flex:1},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:600},children:t.find(A=>A.id===n)?.requester_name||"Unknown User"}),e.jsx(g,{level:"body-xs",sx:{color:"text.secondary"},children:t.find(A=>A.id===n)?.status||"Unknown Status"})]}),e.jsx(q,{variant:"outlined",size:"sm",sx:{borderRadius:"16px"},children:"View profile"}),t.find(A=>A.id===n)?.status!=="Closed"&&e.jsx(q,{variant:"solid",color:"primary",size:"sm",sx:{borderRadius:"16px"},onClick:()=>b(!0),children:"Resolve"})]})}),e.jsx(u,{sx:{flex:1,overflowY:"auto",px:3,py:2},children:n?e.jsx(Q,{spacing:3,children:l.map((A,M)=>{const F=A.sender_name==="You";return e.jsxs(u,{children:[M===0||new Date(A.timestamp||"").toDateString()!==new Date(l[M-1]?.timestamp||"").toDateString()?e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(u,{sx:{flex:1,height:"1px",bgcolor:"divider"}}),e.jsx(g,{level:"body-xs",sx:{mx:2,color:"text.secondary"},children:A.timestamp?new Date(A.timestamp).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}):""}),e.jsx(u,{sx:{flex:1,height:"1px",bgcolor:"divider"}})]}):null,e.jsxs(Q,{direction:"row",spacing:1,sx:{alignItems:"flex-start"},children:[!F&&e.jsx(ce,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:A.sender_name?.[0]?.toUpperCase()||"?"}),e.jsx(u,{sx:{flex:1,display:"flex",flexDirection:F?"row-reverse":"row"},children:e.jsxs(u,{sx:{maxWidth:"70%",bgcolor:F?"primary.500":"neutral.50",color:F?"white":"text.primary",borderRadius:F?"18px 18px 4px 18px":"18px 18px 18px 4px",px:2,py:1.5,position:"relative",boxShadow:"sm"},children:[!F&&e.jsx(g,{level:"body-xs",sx:{fontWeight:600,mb:.5,color:F?"white":"text.primary"},children:A.sender_name}),e.jsx(g,{level:"body-sm",sx:{lineHeight:1.4,color:F?"white":"text.primary"},children:A.message})]})}),F&&e.jsx(ce,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:A.sender_name?.[0]?.toUpperCase()||"?"})]}),e.jsx(u,{sx:{display:"flex",justifyContent:F?"flex-end":"flex-start",mt:.5,ml:F?0:5},children:e.jsx(g,{level:"body-xs",sx:{color:"text.tertiary"},children:A.timestamp?new Date(A.timestamp).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):""})})]},A.id)})}):e.jsx(u,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx(g,{level:"body-md",sx:{color:"text.secondary"},children:"Select a ticket to view messages"})})}),n&&e.jsx(u,{sx:{px:3,py:2,borderTop:"1px solid",borderColor:"divider",flexShrink:0},children:e.jsxs(Q,{direction:"row",spacing:1,alignItems:"flex-end",children:[e.jsx(u,{sx:{flex:1},children:e.jsx(gs,{placeholder:"Type something here...",value:a,onChange:A=>c(A.target.value),minRows:1,maxRows:4,sx:{borderRadius:"20px",border:"1px solid",borderColor:"neutral.300","&:focus-within":{borderColor:"primary.500"},"& textarea":{border:"none",outline:"none",resize:"none",px:2,py:1}},onKeyDown:A=>{A.key==="Enter"&&!A.shiftKey&&(A.preventDefault(),C())}})}),e.jsx(q,{onClick:C,disabled:!a.trim(),variant:"solid",color:"primary",sx:{borderRadius:"20px",minWidth:60,height:40,fontWeight:600},children:"Send"})]})})]})]}),e.jsx(ds,{open:v,onClose:()=>x(!1),onCreated:m}),e.jsx(us,{open:j,onClose:()=>b(!1),onSubmit:T})]})}const Or={draft:0,scheduled:1,sent:2,failed:3},qe={fontSize:Y.sizes.small},Xe={...qe,fontWeight:600,borderBottom:"1.5px solid #e0e0e0",background:"inherit"},Dt=s=>{switch(s){case"draft":return"neutral";case"scheduled":return"warning";case"sent":return"success";case"failed":return"danger";default:return"neutral"}},Nl=s=>{switch(s){case"draft":return e.jsx(yo,{});case"scheduled":return e.jsx(bo,{});case"sent":return e.jsx(Ls,{});case"failed":return e.jsx(jo,{});default:return e.jsx(go,{})}},Ml=()=>{const{isMobile:s}=Ce(),[t,r]=h.useState([]),[n,o]=h.useState(!1),[l,i]=h.useState(null),[a,c]=h.useState(""),[d,p]=h.useState(""),[f,w]=h.useState(!1),v=async()=>{o(!0),i(null);try{const{data:k,error:m}=await L.from("sms_campaigns").select("*").order("created_at",{ascending:!1});if(m)throw m;k&&r(k)}catch(k){console.error("Error fetching campaigns:",k),i(k.message||"Failed to fetch campaigns")}finally{o(!1)}},j=[...t.filter(k=>{const m=k.name.toLowerCase().includes(a.toLowerCase())||k.CampaignNumber?.toLowerCase().includes(a.toLowerCase()),C=d?k.status===d:!0;return m&&C})].sort((k,m)=>{const C=Or[k.status]??99,T=Or[m.status]??99;return C!==T?C-T:new Date(m.created_at).getTime()-new Date(k.created_at).getTime()});h.useEffect(()=>{v()},[]);const b=()=>e.jsxs(u,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(je,{padding:"medium",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:Y.sizes.xlarge},children:"SMS Campaigns"}),e.jsxs(u,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(B,{placeholder:"Search campaigns...",value:a,onChange:k=>c(k.target.value),startDecorator:e.jsx(ge,{}),sx:{flex:1}}),e.jsxs(ie,{placeholder:"Status",value:d,onChange:(k,m)=>p(m??""),sx:{minWidth:120},children:[e.jsx(z,{value:"",children:"All"}),e.jsx(z,{value:"draft",children:"Draft"}),e.jsx(z,{value:"scheduled",children:"Scheduled"}),e.jsx(z,{value:"sent",children:"Sent"}),e.jsx(z,{value:"failed",children:"Failed"})]})]}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(ue,{}),onClick:()=>w(!0),sx:{width:"100%",mb:2},children:"Create Campaign"})]}),n&&e.jsx(De,{}),l&&e.jsx(u,{sx:{p:2},children:e.jsxs(g,{color:"danger",children:["Error: ",l]})}),e.jsx(u,{children:j.length===0?e.jsx(u,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:"No SMS campaigns found"})}):j.map(k=>e.jsx(u,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(u,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${Dt(k.status)}.100`,color:`${Dt(k.status)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",flexShrink:0},children:Nl(k.status)}),e.jsxs(u,{sx:{flex:1,minWidth:0},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:k.name}),e.jsx(se,{size:"sm",color:Dt(k.status),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content",textTransform:"capitalize"},children:k.status})]}),e.jsxs(g,{level:"body-xs",color:"neutral",sx:{mb:.5},children:["Campaign #",k.CampaignNumber," • ",new Date(k.created_at).toLocaleDateString()]}),e.jsxs(u,{sx:{display:"flex",gap:2,mb:.5},children:[e.jsxs(g,{level:"body-xs",color:"neutral",children:["Recipients: ",k.recipients?.length??0]}),k.scheduled_at&&e.jsxs(g,{level:"body-xs",color:"neutral",children:["Scheduled: ",os(new Date(k.scheduled_at),"MMM dd, HH:mm")]})]}),k.message&&e.jsxs(g,{level:"body-xs",color:"neutral",sx:{fontStyle:"italic",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:['"',k.message,'"']})]})]})},k.id))})]}),D=()=>e.jsxs(je,{variant:"table-page",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:Y.sizes.xlarge},children:"SMS Campaigns"}),e.jsxs(u,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(B,{placeholder:"Search campaigns...",sx:{flex:1},value:a,onChange:k=>c(k.target.value),startDecorator:e.jsx(ge,{})}),e.jsxs(ie,{placeholder:"Filter status",value:d,onChange:(k,m)=>p(m??""),sx:{minWidth:160},children:[e.jsx(z,{value:"",children:"All Statuses"}),e.jsx(z,{value:"draft",children:"Draft"}),e.jsx(z,{value:"scheduled",children:"Scheduled"}),e.jsx(z,{value:"sent",children:"Sent"}),e.jsx(z,{value:"failed",children:"Failed"})]}),e.jsx(q,{onClick:()=>w(!0),variant:"solid",startDecorator:e.jsx(ue,{}),children:"Create Campaign"})]}),e.jsxs(ke,{sx:{overflow:"visible"},children:[n&&e.jsx(De,{}),l&&e.jsxs(g,{color:"danger",children:["Error: ",l]}),e.jsxs(We,{"aria-label":"SMS Campaigns",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:Xe,children:"Campaign #"}),e.jsx("th",{style:Xe,children:"Name"}),e.jsx("th",{style:Xe,children:"Status"}),e.jsx("th",{style:Xe,children:"Scheduled"}),e.jsx("th",{style:Xe,children:"Sent"}),e.jsx("th",{style:Xe,children:"Recipients"}),e.jsx("th",{style:Xe,children:"Message"})]})}),e.jsxs("tbody",{children:[j.length===0&&!n&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...qe},children:"No campaigns found."})}),j.map(k=>e.jsxs("tr",{style:{cursor:"pointer",height:48},children:[e.jsx("td",{style:qe,children:k.CampaignNumber}),e.jsx("td",{style:qe,children:k.name}),e.jsx("td",{style:qe,children:e.jsx(se,{size:"sm",color:Dt(k.status),variant:"soft",sx:{textTransform:"capitalize"},children:k.status})}),e.jsx("td",{style:qe,children:k.scheduled_at?os(new Date(k.scheduled_at),"yyyy-MM-dd HH:mm"):"-"}),e.jsx("td",{style:qe,children:k.sent_at?os(new Date(k.sent_at),"yyyy-MM-dd HH:mm"):"-"}),e.jsx("td",{style:qe,children:k.recipients?.length??0}),e.jsx("td",{style:qe,children:e.jsx(g,{level:"body-sm",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:k.message||"-"})})]},k.id))]})]})]})]});return e.jsxs($e,{children:[s?e.jsx(b,{}):e.jsx(D,{}),e.jsx(Ie,{open:f,onClose:()=>w(!1),children:e.jsxs(Ee,{children:[e.jsx(Ge,{}),e.jsx(g,{level:"h4",children:"Create New Campaign"}),e.jsx(g,{level:"body-sm",sx:{mt:1,mb:2},children:"Campaign creation functionality will be implemented here."}),e.jsx(q,{onClick:()=>w(!1),variant:"outlined",children:"Close"})]})})]})};function hs(s,t){return t===0?s>0?100:0:(s-t)/t*100}function xs(s){return s==null?"—":`${s>0?"+":s<0?"−":""}${Math.abs(Math.round(s))}%`}async function Fl(){const s=new Date,t=s.toISOString().slice(0,10),r=new Date(s.getTime()-30*24*60*60*1e3).toISOString().slice(0,10),n=new Date(s.getTime()-60*24*60*60*1e3).toISOString().slice(0,10),o=new Date(s.getTime()-30*24*60*60*1e3-1).toISOString().slice(0,10),l=await L.from("Orders").select("order_total, customer_email, date",{count:"exact"}).not("order_total","is",null);if(l.error||!l.data)throw new Error("Failed to fetch order stats");const i=l.data,a=i.filter(j=>j.date&&j.date>=r&&j.date<=t),c=i.filter(j=>j.date&&j.date>=n&&j.date<=o),d=a.reduce((j,b)=>j+(typeof b.order_total=="number"?b.order_total:0),0),p=c.reduce((j,b)=>j+(typeof b.order_total=="number"?b.order_total:0),0),f=a.length,w=c.length,v=new Set(a.map(j=>j.customer_email).filter(Boolean)),x=new Set(c.map(j=>j.customer_email).filter(Boolean));return{totalSales:d,orderCount:f,customerCount:v.size,salesChange:hs(d,p),ordersChange:hs(f,w),customersChange:hs(v.size,x.size)}}const $l=()=>{const[s,t]=h.useState(null),[r,n]=h.useState(null),[o,l]=h.useState(null),[i,a]=h.useState(null),[c,d]=h.useState(null),[p,f]=h.useState(null),[w,v]=h.useState(!0),[x,j]=h.useState(null);return Ot("(max-width:600px)"),h.useEffect(()=>{let b=!0,D=!0;async function k(){D&&v(!0),j(null);try{const{totalSales:C,orderCount:T,customerCount:N,salesChange:P,ordersChange:W,customersChange:A}=await Fl();b&&(t(C),n(T),l(N),a(P),d(W),f(A))}catch(C){b&&j(C.message)}finally{D&&v(!1),D=!1}}k();const m=setInterval(k,1e4);return()=>{b=!1,clearInterval(m)}},[]),e.jsxs(u,{sx:{p:{xs:1,md:4},pt:{xs:0,md:4}},children:[e.jsx(g,{level:"h2",sx:{mb:2},children:"Dashboard"}),e.jsxs(Ye,{container:!0,spacing:2,children:[e.jsx(Ye,{xs:12,md:4,children:e.jsxs(ke,{variant:"outlined",children:[e.jsx(g,{level:"h4",children:"Total Sales"}),e.jsx(g,{level:"h2",color:"success",children:w?"Loading...":x?"—":dt(s)}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[w?"":xs(i)," from last 30 days"]})]})}),e.jsx(Ye,{xs:12,md:4,children:e.jsxs(ke,{variant:"outlined",children:[e.jsx(g,{level:"h4",children:"Orders"}),e.jsx(g,{level:"h2",color:"primary",children:w?"Loading...":x?"—":r?.toLocaleString()}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[w?"":xs(c)," from last 30 days"]})]})}),e.jsx(Ye,{xs:12,md:4,children:e.jsxs(ke,{variant:"outlined",children:[e.jsx(g,{level:"h4",children:"Customers"}),e.jsx(g,{level:"h2",color:"warning",children:w?"Loading...":x?"—":o?.toLocaleString()}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[w?"":xs(p)," new last 30 days"]})]})})]})]})},Me=({children:s})=>{const[t,r]=h.useState(null),[n,o]=h.useState(!0);return h.useEffect(()=>{async function l(){const{data:i}=await L.auth.getSession();r(i?.session||null),o(!1)}l()},[]),n?e.jsx("div",{children:"Loading..."}):t?e.jsx(e.Fragment,{children:s}):e.jsx(qt,{to:"/",replace:!0})};function ql(s){const{onClick:t,...r}=s,{mode:n,setMode:o}=$r(),[l,i]=h.useState(!1);return h.useEffect(()=>i(!0),[]),e.jsx(te,{"aria-label":"toggle light/dark mode",size:"sm",variant:"outlined",disabled:!l,onClick:a=>{o(n==="light"?"dark":"light"),t?.(a)},...r,children:n==="light"?e.jsx(Vr,{}):e.jsx(So,{})})}function Ul({onLogin:s}){const t=Ns(),[r,n]=h.useState(""),[o,l]=h.useState(""),[i,a]=h.useState(!1),[c,d]=h.useState(null);h.useEffect(()=>{if(window.location.pathname==="/login"){async function f(){const{data:w}=await L.auth.getSession();w?.session&&t("/dashboard")}f()}},[t]);async function p(f){f.preventDefault(),a(!0),d(null);const{data:w,error:v}=await L.auth.signInWithPassword({email:r,password:o});if(v){console.error("[Login] Auth error:",v),d(v.message),a(!1);return}const x=w.user?.id;if(!x){d("Login failed: No user ID."),a(!1);return}let{data:j,error:b}=await L.from("users").select("*").eq("id",x).single();if(b||!j){console.error("[Login] User fetch error:",b);const{error:D}=await L.from("users").upsert({id:x,email:w.user.email,name:w.user.user_metadata?.full_name||w.user.user_metadata?.name||"",role:"employee"});if(D){console.error("Upsert failed:",D),d("Upsert failed: "+D.message),a(!1);return}let k=3,m,C;for(;k>0;){await new Promise(P=>setTimeout(P,300));const{data:T,error:N}=await L.from("users").select("*").eq("id",x).single();if(m=T,C=N,C&&console.error("[Login] Retry user fetch error:",C),m&&!C){j=m,b=null;break}k--}if(b||!j){d("Access denied: User not found."),await L.auth.signOut(),a(!1);return}}if(j.role!=="employee"){d("Access denied: Only employees can access this app."),await L.auth.signOut(),a(!1);return}a(!1),s(),t("/dashboard")}return e.jsxs(Hr,{disableTransitionOnChange:!0,children:[e.jsx(Yn,{}),e.jsx(qr,{styles:{":root":{"--Form-maxWidth":"800px","--Transition-duration":"0.4s"}}}),e.jsx(u,{sx:f=>({width:{xs:"100%",md:"50vw"},transition:"width var(--Transition-duration)",transitionDelay:"calc(var(--Transition-duration) + 0.1s)",position:"relative",zIndex:1,display:"flex",justifyContent:"flex-end",backdropFilter:"blur(12px)",backgroundColor:"rgba(255 255 255 / 0.2)",[f.getColorSchemeSelector("dark")]:{backgroundColor:"rgba(19 19 24 / 0.4)"}}),children:e.jsxs(u,{sx:{display:"flex",flexDirection:"column",minHeight:"100dvh",width:"100%",px:2},children:[e.jsxs(u,{component:"header",sx:{py:3,display:"flex",justifyContent:"space-between"},children:[e.jsxs(u,{sx:{gap:2,display:"flex",alignItems:"center"},children:[e.jsx(te,{variant:"soft",color:"primary",size:"sm",children:e.jsx(wo,{})}),e.jsx(g,{level:"title-lg",children:"SmartBack"})]}),e.jsx(ql,{})]}),e.jsxs(u,{component:"main",sx:{my:"auto",py:2,pb:5,display:"flex",flexDirection:"column",gap:2,width:400,maxWidth:"100%",mx:"auto",borderRadius:"sm","& form":{display:"flex",flexDirection:"column",gap:2},"& .MuiFormLabel-asterisk":{visibility:"hidden"}},children:[e.jsx(Q,{sx:{gap:4,mb:2},children:e.jsxs(Q,{sx:{gap:1},children:[e.jsx(g,{component:"h1",level:"h3",children:"Sign in"}),e.jsx(g,{level:"body-sm",children:"Welcome back to SmartBack! Please sign in to continue."})]})}),e.jsx(Q,{sx:{gap:4,mt:2},children:e.jsxs("form",{onSubmit:p,children:[e.jsxs(ne,{required:!0,children:[e.jsx(ee,{children:"Email"}),e.jsx(B,{type:"email",name:"email",value:r,onChange:f=>n(f.target.value),placeholder:"your@email.com",disabled:i})]}),e.jsxs(ne,{required:!0,children:[e.jsx(ee,{children:"Password"}),e.jsx(B,{type:"password",name:"password",value:o,onChange:f=>l(f.target.value),placeholder:"••••••",disabled:i})]}),e.jsxs(Q,{sx:{gap:4,mt:2},children:[e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(eo,{size:"sm",label:"Remember me",name:"persistent"}),e.jsx(to,{level:"title-sm",href:"#forgot-password",children:"Forgot your password?"})]}),e.jsx(q,{type:"submit",fullWidth:!0,loading:i,children:"Sign in"})]})]})}),c&&e.jsx(u,{sx:{mt:2},children:e.jsx(g,{level:"body-sm",color:"danger",children:c})})]}),e.jsx(u,{component:"footer",sx:{py:3},children:e.jsxs(g,{level:"body-xs",sx:{textAlign:"center"},children:["© SmartBack ",new Date().getFullYear()]})})]})}),e.jsx(u,{sx:f=>({height:"100%",position:"fixed",right:0,top:0,bottom:0,left:{xs:0,md:"50vw"},transition:"background-image var(--Transition-duration), left var(--Transition-duration) !important",transitionDelay:"calc(var(--Transition-duration) + 0.1s)",backgroundColor:"background.level1",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundImage:"url(https://images.unsplash.com/photo-1527181152855-fc03fc7949c8?auto=format&w=1000&dpr=2)",[f.getColorSchemeSelector("dark")]:{backgroundImage:"url(https://images.unsplash.com/photo-1572072393749-3ca9c8ea0831?auto=format&w=1000&dpr=2)"}})})]})}function Bl(){return e.jsx(Fs,{children:e.jsx(Se,{path:"*",element:e.jsx(Ul,{onLogin:()=>{}})})})}const fe={fontSize:Y.sizes.small},Wl=()=>{const{isMobile:s}=Ce();sn();const[t,r]=h.useState([]),[n,o]=h.useState([]),[l,i]=h.useState(""),[a,c]=h.useState(!1),[d,p]=h.useState(!1),[f,w]=h.useState(""),[v,x]=h.useState(""),[j,b]=h.useState(""),[D,k]=h.useState(""),[m,C]=h.useState(null),[T,N]=h.useState(!1),[P,W]=h.useState(""),[A,M]=h.useState(""),[F,U]=h.useState(!1),[S,_]=h.useState(!1),[E,$]=h.useState(""),[re,he]=h.useState("success"),de=(R,H="success")=>{$(R),he(H),_(!0)},ae=async()=>{try{const{data:R,error:H}=await L.from("stock_movements").select(`
                    *,
                    Products (
                        ProductName,
                        ProductID
                    )
                `).order("date",{ascending:!1});H?(console.error("Error fetching movements:",H),r([]),de("Failed to load movements","danger")):r(R||[])}catch(R){console.error("Unexpected error:",R),r([]),de("An unexpected error occurred","danger")}},ze=async()=>{try{const{data:R,error:H}=await L.from("Products").select("*").order("ProductName");H?(console.error("Error fetching products:",H),o([])):o(R||[])}catch(R){console.error("Unexpected error:",R),o([])}},He=async R=>{if(!R){C(null);return}N(!0);try{const{data:H,error:J}=await L.from("stock_movements").select("movement_type, quantity").eq("product_id",R);if(J)console.error("Error fetching stock movements:",J),C(null);else{const be=(H||[]).reduce((ye,Oe)=>{switch(Oe.movement_type){case"incoming":return ye+Oe.quantity;case"outgoing":return ye-Oe.quantity;case"adjustment":return ye+Oe.quantity;default:return ye}},0);C(be)}}catch(H){console.error("Error calculating stock:",H),C(null)}finally{N(!1)}};h.useEffect(()=>{D?He(D):C(null)},[D]);const xt=async()=>{if(!D||P===""||m===null){de("Please select a product and enter a valid stock level","warning");return}const H=Number(P)-m;if(H===0){de("No adjustment needed - the stock level is already at the specified amount","warning");return}U(!0);try{const{error:J}=await L.from("stock_movements").insert({product_id:D,movement_type:"adjustment",quantity:H,reason:`Manual adjustment: ${A||"Stock level correction"}`,date:new Date().toISOString()});J?(console.error("Error creating adjustment:",J),de("Failed to create adjustment: "+J.message,"danger")):(k(""),W(""),M(""),C(null),c(!1),ae(),de("Stock adjustment created successfully!","success"))}catch(J){console.error("Unexpected error:",J),de("An unexpected error occurred","danger")}finally{U(!1)}};h.useEffect(()=>{ae(),ze()},[]);const Le=t.filter(R=>{const H=l.toLowerCase(),J=l===""||R.id.toLowerCase().includes(H)||R.product_id.toLowerCase().includes(H)||R.movement_type.toLowerCase().includes(H)||(R.reason?.toLowerCase().includes(H)??!1)||(R.Products?.ProductName?.toLowerCase().includes(H)??!1),be=f===""||R.movement_type===f,ye=v===""||R.product_id===v,Oe=j===""||(()=>{const oe=R.reason?.toLowerCase()||"";switch(j){case"manual":return oe.includes("manual")||oe.includes("adjustment")||oe.includes("correction");case"damage":return oe.includes("damage")||oe.includes("broken")||oe.includes("defect");case"loss":return oe.includes("loss")||oe.includes("lost")||oe.includes("missing");case"found":return oe.includes("found")||oe.includes("surplus")||oe.includes("extra");case"po":return oe.includes("po")||oe.includes("purchase")||oe.includes("receipt");default:return!0}})();return J&&be&&ye&&Oe}),Ae=R=>{switch(R.movement_type){case"incoming":return"success";case"outgoing":return"danger";case"adjustment":return R.quantity>=0?"success":"danger";default:return"neutral"}},pt=R=>{switch(R.movement_type){case"incoming":return"↑";case"outgoing":return"↓";case"adjustment":return"⚖";default:return"•"}},Ke=R=>{switch(R.movement_type){case"incoming":return`+${R.quantity}`;case"outgoing":return`-${R.quantity}`;case"adjustment":return R.quantity>=0?`+${R.quantity}`:`${R.quantity}`;default:return R.quantity}},O=()=>{w(""),x(""),b("")},G=f!==""||v!==""||j!=="",xe=()=>e.jsxs(u,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(je,{padding:"medium",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:Y.sizes.xlarge},children:"Stock Movements"}),e.jsxs(u,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(B,{placeholder:"Search movements...",value:l,onChange:R=>i(R.target.value),startDecorator:e.jsx(ge,{}),sx:{flex:1}}),e.jsx(te,{variant:G?"solid":"soft",color:G?"primary":"neutral",size:"sm",onClick:()=>p(!0),children:e.jsx(zs,{})})]}),G&&e.jsxs(u,{sx:{mb:2,display:"flex",gap:1,flexWrap:"wrap"},children:[f&&e.jsxs(se,{size:"sm",variant:"soft",color:"primary",children:["Type: ",f]}),v&&e.jsxs(se,{size:"sm",variant:"soft",color:"primary",children:["Product: ",n.find(R=>R.uuid===v)?.ProductName||"Selected"]}),j&&e.jsxs(se,{size:"sm",variant:"soft",color:"primary",children:["Reason: ",j]})]})]}),e.jsx(u,{children:Le.length===0?e.jsx(u,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:"No stock movements found"})}):Le.map(R=>e.jsx(u,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(u,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${Ae(R)}.100`,color:`${Ae(R)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",flexShrink:0},children:pt(R)}),e.jsxs(u,{sx:{flex:1,minWidth:0},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:R.Products?.ProductName||"Unknown Product"}),e.jsx(se,{size:"sm",color:Ae(R),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content"},children:Ke(R)})]}),e.jsxs(g,{level:"body-xs",color:"neutral",sx:{mb:.5},children:["ID: ",R.Products?.ProductID||"N/A"," • ",new Date(R.date).toLocaleDateString()]}),R.reason&&e.jsx(g,{level:"body-xs",color:"neutral",sx:{fontStyle:"italic",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:R.reason})]})]})},R.id))}),e.jsx(te,{color:"primary",variant:"soft",size:"sm",sx:{position:"fixed",bottom:80,right:16,zIndex:1e3,borderRadius:"8px",width:40,height:40,boxShadow:"sm",bgcolor:"primary.100","&:hover":{bgcolor:"primary.200",boxShadow:"md"}},onClick:()=>c(!0),children:e.jsx(ue,{fontSize:"small"})})]}),I=()=>e.jsxs(je,{variant:"table-page",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:Y.sizes.xlarge},children:"Stock Movements"}),e.jsxs(u,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(B,{placeholder:"Search movements...",sx:{flex:1,fontSize:Y.sizes.small},value:l,onChange:R=>i(R.target.value),startDecorator:e.jsx(ge,{})}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(ue,{}),onClick:()=>c(!0),sx:{fontSize:Y.sizes.small},children:"Adjust"})]}),e.jsx(ke,{sx:{overflow:"visible"},children:e.jsxs(We,{"aria-label":"Stock Movements",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:fe,children:"ID"}),e.jsx("th",{style:fe,children:"Product"}),e.jsx("th",{style:fe,children:"Movement Type"}),e.jsx("th",{style:fe,children:"Quantity"}),e.jsx("th",{style:fe,children:"Reason"}),e.jsx("th",{style:fe,children:"Date"})]})}),e.jsxs("tbody",{children:[Le.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{textAlign:"center",color:"#888",...fe},children:"No stock movements found."})}),Le.map(R=>e.jsxs("tr",{style:{cursor:"pointer"},children:[e.jsxs("td",{style:fe,children:[R.id.substring(0,8),"..."]}),e.jsx("td",{style:fe,children:R.Products?e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:R.Products.ProductName}),e.jsxs("div",{style:{fontSize:"0.8em",color:"#666"},children:["ID: ",R.Products.ProductID]})]}):e.jsx("span",{style:{color:"#999",fontStyle:"italic"},children:"Unknown Product"})}),e.jsx("td",{style:fe,children:e.jsx(se,{size:"sm",variant:"soft",color:Ae(R),children:R.movement_type==="incoming"?"↑ Incoming":R.movement_type==="outgoing"?"↓ Outgoing":"⚖ Adjustment"})}),e.jsx("td",{style:fe,children:e.jsx("span",{style:{fontWeight:"bold",color:Ae(R)==="success"?"#059669":Ae(R)==="danger"?"#dc2626":"#666"},children:Ke(R)})}),e.jsx("td",{style:fe,children:R.reason||"N/A"}),e.jsx("td",{style:fe,children:new Date(R.date).toLocaleString()})]},R.id))]})]})})]});return e.jsxs($e,{children:[s?e.jsx(xe,{}):e.jsx(I,{}),e.jsx(Ut,{open:a,onClose:()=>c(!1),title:"Manual Stock Adjustment",size:"medium",actions:e.jsxs(u,{sx:{display:"flex",gap:2},children:[e.jsx(q,{variant:"plain",onClick:()=>c(!1),sx:fe,children:"Cancel"}),e.jsx(q,{variant:"solid",onClick:xt,loading:F,disabled:!D||P===""||m===null||Number(P)===m,sx:fe,children:"Create Adjustment"})]}),children:e.jsxs(Q,{spacing:2,children:[e.jsxs(ne,{children:[e.jsx(ee,{children:"Product"}),e.jsx(ie,{placeholder:"Select a product...",value:D,onChange:(R,H)=>k(H||""),children:n.map(R=>e.jsxs(z,{value:R.uuid,children:[R.ProductName," (ID: ",R.ProductID,")"]},R.uuid))})]}),D&&e.jsxs(ne,{children:[e.jsx(ee,{children:"Current Stock Level"}),e.jsx(B,{value:T?"Loading...":m!==null?m:"N/A",readOnly:!0,sx:{bgcolor:"neutral.100",color:m!==null&&m<=0?"danger.500":"neutral.600"}}),m!==null&&m<=0&&e.jsx(g,{level:"body-sm",sx:{color:"danger.500",mt:.5},children:"⚠️ Warning: Product is at or below zero stock level"})]}),m!==null&&e.jsxs(ne,{children:[e.jsx(ee,{children:"Actual Stock Level"}),e.jsx(B,{type:"number",placeholder:"Enter the actual stock level...",value:P,onChange:R=>W(R.target.value),sx:{...fe},slotProps:{input:{min:0,max:999999}}}),P!==""&&m!==null&&e.jsx(g,{level:"body-sm",sx:{mt:.5,color:Number(P)>m?"success.600":Number(P)<m?"danger.600":"neutral.600"},children:Number(P)>m?`+${Number(P)-m} (increase)`:Number(P)<m?`${Number(P)-m} (decrease)`:"No change needed"})]}),e.jsxs(ne,{children:[e.jsx(ee,{children:"Reason for Adjustment"}),e.jsx(B,{placeholder:"e.g., damage, loss, found inventory, physical count correction...",value:A,onChange:R=>M(R.target.value),sx:{...fe}})]})]})}),s&&e.jsx(Ut,{open:d,onClose:()=>p(!1),title:"Filter Movements",size:"medium",actions:e.jsxs(u,{sx:{display:"flex",gap:1,justifyContent:"space-between",width:"100%"},children:[e.jsx(q,{variant:"plain",color:"neutral",onClick:O,disabled:!G,children:"Clear All"}),e.jsx(q,{onClick:()=>p(!1),children:"Apply Filters"})]}),children:e.jsxs(Q,{spacing:2,children:[e.jsxs(ne,{children:[e.jsx(ee,{children:"Movement Type"}),e.jsxs(ie,{placeholder:"All types",value:f,onChange:(R,H)=>w(H||""),children:[e.jsx(z,{value:"",children:"All Types"}),e.jsx(z,{value:"incoming",children:"Incoming"}),e.jsx(z,{value:"outgoing",children:"Outgoing"}),e.jsx(z,{value:"adjustment",children:"Adjustment"})]})]}),e.jsxs(ne,{children:[e.jsx(ee,{children:"Product"}),e.jsxs(ie,{placeholder:"All products",value:v,onChange:(R,H)=>x(H||""),children:[e.jsx(z,{value:"",children:"All Products"}),n.map(R=>e.jsx(z,{value:R.uuid,children:R.ProductName},R.uuid))]})]}),e.jsxs(ne,{children:[e.jsx(ee,{children:"Reason Category"}),e.jsxs(ie,{placeholder:"All reasons",value:j,onChange:(R,H)=>b(H||""),children:[e.jsx(z,{value:"",children:"All Reasons"}),e.jsx(z,{value:"manual",children:"Manual Adjustment"}),e.jsx(z,{value:"damage",children:"Damage/Defect"}),e.jsx(z,{value:"loss",children:"Loss/Missing"}),e.jsx(z,{value:"found",children:"Found/Surplus"}),e.jsx(z,{value:"po",children:"Purchase Order"})]})]})]})}),e.jsx(Gt,{open:S,onClose:()=>_(!1),autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{top:16,zIndex:2e3},children:e.jsx(Kt,{color:re,variant:"solid",sx:{width:"100%"},children:E})})]})};function Ws(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var nt=Ws();function En(s){nt=s}var yt={exec:()=>null};function Z(s,t=""){let r=typeof s=="string"?s:s.source,n={replace:(o,l)=>{let i=typeof l=="string"?l:l.source;return i=i.replace(ve.caret,"$1"),r=r.replace(o,i),n},getRegex:()=>new RegExp(r,t)};return n}var ve={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:s=>new RegExp(`^( {0,3}${s})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}#`),htmlBeginRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}<(?:[a-z].*>|!--)`,"i")},Hl=/^(?:[ \t]*(?:\n|$))+/,Vl=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Jl=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Pt=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Gl=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Hs=/(?:[*+-]|\d{1,9}[.)])/,Dn=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,An=Z(Dn).replace(/bull/g,Hs).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Kl=Z(Dn).replace(/bull/g,Hs).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Vs=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Zl=/^[^\n]+/,Js=/(?!\s*\])(?:\\.|[^\[\]\\])+/,Ql=Z(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Js).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Xl=Z(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Hs).getRegex(),rs="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Gs=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Yl=Z("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Gs).replace("tag",rs).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),On=Z(Vs).replace("hr",Pt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",rs).getRegex(),ea=Z(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",On).getRegex(),Ks={blockquote:ea,code:Vl,def:Ql,fences:Jl,heading:Gl,hr:Pt,html:Yl,lheading:An,list:Xl,newline:Hl,paragraph:On,table:yt,text:Zl},Tr=Z("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Pt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",rs).getRegex(),ta={...Ks,lheading:Kl,table:Tr,paragraph:Z(Vs).replace("hr",Pt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Tr).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",rs).getRegex()},sa={...Ks,html:Z(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Gs).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:yt,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Z(Vs).replace("hr",Pt).replace("heading",` *#{1,6} *[^
]`).replace("lheading",An).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},ra=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,na=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Tn=/^( {2,}|\\)\n(?!\s*$)/,oa=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,ns=/[\p{P}\p{S}]/u,Zs=/[\s\p{P}\p{S}]/u,zn=/[^\s\p{P}\p{S}]/u,ia=Z(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Zs).getRegex(),Ln=/(?!~)[\p{P}\p{S}]/u,la=/(?!~)[\s\p{P}\p{S}]/u,aa=/(?:[^\s\p{P}\p{S}]|~)/u,ca=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,Nn=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,da=Z(Nn,"u").replace(/punct/g,ns).getRegex(),ua=Z(Nn,"u").replace(/punct/g,Ln).getRegex(),Mn="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",ha=Z(Mn,"gu").replace(/notPunctSpace/g,zn).replace(/punctSpace/g,Zs).replace(/punct/g,ns).getRegex(),xa=Z(Mn,"gu").replace(/notPunctSpace/g,aa).replace(/punctSpace/g,la).replace(/punct/g,Ln).getRegex(),pa=Z("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,zn).replace(/punctSpace/g,Zs).replace(/punct/g,ns).getRegex(),fa=Z(/\\(punct)/,"gu").replace(/punct/g,ns).getRegex(),ma=Z(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),ga=Z(Gs).replace("(?:-->|$)","-->").getRegex(),ja=Z("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",ga).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Ht=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,ba=Z(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Ht).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Fn=Z(/^!?\[(label)\]\[(ref)\]/).replace("label",Ht).replace("ref",Js).getRegex(),$n=Z(/^!?\[(ref)\](?:\[\])?/).replace("ref",Js).getRegex(),ya=Z("reflink|nolink(?!\\()","g").replace("reflink",Fn).replace("nolink",$n).getRegex(),Qs={_backpedal:yt,anyPunctuation:fa,autolink:ma,blockSkip:ca,br:Tn,code:na,del:yt,emStrongLDelim:da,emStrongRDelimAst:ha,emStrongRDelimUnd:pa,escape:ra,link:ba,nolink:$n,punctuation:ia,reflink:Fn,reflinkSearch:ya,tag:ja,text:oa,url:yt},wa={...Qs,link:Z(/^!?\[(label)\]\((.*?)\)/).replace("label",Ht).getRegex(),reflink:Z(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Ht).getRegex()},Cs={...Qs,emStrongRDelimAst:xa,emStrongLDelim:ua,url:Z(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},Sa={...Cs,br:Z(Tn).replace("{2,}","*").getRegex(),text:Z(Cs.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},At={normal:Ks,gfm:ta,pedantic:sa},gt={normal:Qs,gfm:Cs,breaks:Sa,pedantic:wa},va={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},zr=s=>va[s];function Fe(s,t){if(t){if(ve.escapeTest.test(s))return s.replace(ve.escapeReplace,zr)}else if(ve.escapeTestNoEncode.test(s))return s.replace(ve.escapeReplaceNoEncode,zr);return s}function Lr(s){try{s=encodeURI(s).replace(ve.percentDecode,"%")}catch{return null}return s}function Nr(s,t){let r=s.replace(ve.findPipe,(l,i,a)=>{let c=!1,d=i;for(;--d>=0&&a[d]==="\\";)c=!c;return c?"|":" |"}),n=r.split(ve.splitPipe),o=0;if(n[0].trim()||n.shift(),n.length>0&&!n.at(-1)?.trim()&&n.pop(),t)if(n.length>t)n.splice(t);else for(;n.length<t;)n.push("");for(;o<n.length;o++)n[o]=n[o].trim().replace(ve.slashPipe,"|");return n}function jt(s,t,r){let n=s.length;if(n===0)return"";let o=0;for(;o<n&&s.charAt(n-o-1)===t;)o++;return s.slice(0,n-o)}function ka(s,t){if(s.indexOf(t[1])===-1)return-1;let r=0;for(let n=0;n<s.length;n++)if(s[n]==="\\")n++;else if(s[n]===t[0])r++;else if(s[n]===t[1]&&(r--,r<0))return n;return r>0?-2:-1}function Mr(s,t,r,n,o){let l=t.href,i=t.title||null,a=s[1].replace(o.other.outputLinkReplace,"$1");n.state.inLink=!0;let c={type:s[0].charAt(0)==="!"?"image":"link",raw:r,href:l,title:i,text:a,tokens:n.inlineTokens(a)};return n.state.inLink=!1,c}function Ca(s,t,r){let n=s.match(r.other.indentCodeCompensation);if(n===null)return t;let o=n[1];return t.split(`
`).map(l=>{let i=l.match(r.other.beginningSpace);if(i===null)return l;let[a]=i;return a.length>=o.length?l.slice(o.length):l}).join(`
`)}var Vt=class{options;rules;lexer;constructor(s){this.options=s||nt}space(s){let t=this.rules.block.newline.exec(s);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(s){let t=this.rules.block.code.exec(s);if(t){let r=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?r:jt(r,`
`)}}}fences(s){let t=this.rules.block.fences.exec(s);if(t){let r=t[0],n=Ca(r,t[3]||"",this.rules);return{type:"code",raw:r,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:n}}}heading(s){let t=this.rules.block.heading.exec(s);if(t){let r=t[2].trim();if(this.rules.other.endingHash.test(r)){let n=jt(r,"#");(this.options.pedantic||!n||this.rules.other.endingSpaceChar.test(n))&&(r=n.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:r,tokens:this.lexer.inline(r)}}}hr(s){let t=this.rules.block.hr.exec(s);if(t)return{type:"hr",raw:jt(t[0],`
`)}}blockquote(s){let t=this.rules.block.blockquote.exec(s);if(t){let r=jt(t[0],`
`).split(`
`),n="",o="",l=[];for(;r.length>0;){let i=!1,a=[],c;for(c=0;c<r.length;c++)if(this.rules.other.blockquoteStart.test(r[c]))a.push(r[c]),i=!0;else if(!i)a.push(r[c]);else break;r=r.slice(c);let d=a.join(`
`),p=d.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}
${d}`:d,o=o?`${o}
${p}`:p;let f=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(p,l,!0),this.lexer.state.top=f,r.length===0)break;let w=l.at(-1);if(w?.type==="code")break;if(w?.type==="blockquote"){let v=w,x=v.raw+`
`+r.join(`
`),j=this.blockquote(x);l[l.length-1]=j,n=n.substring(0,n.length-v.raw.length)+j.raw,o=o.substring(0,o.length-v.text.length)+j.text;break}else if(w?.type==="list"){let v=w,x=v.raw+`
`+r.join(`
`),j=this.list(x);l[l.length-1]=j,n=n.substring(0,n.length-w.raw.length)+j.raw,o=o.substring(0,o.length-v.raw.length)+j.raw,r=x.substring(l.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:n,tokens:l,text:o}}}list(s){let t=this.rules.block.list.exec(s);if(t){let r=t[1].trim(),n=r.length>1,o={type:"list",raw:"",ordered:n,start:n?+r.slice(0,-1):"",loose:!1,items:[]};r=n?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=n?r:"[*+-]");let l=this.rules.other.listItemRegex(r),i=!1;for(;s;){let c=!1,d="",p="";if(!(t=l.exec(s))||this.rules.block.hr.test(s))break;d=t[0],s=s.substring(d.length);let f=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,D=>" ".repeat(3*D.length)),w=s.split(`
`,1)[0],v=!f.trim(),x=0;if(this.options.pedantic?(x=2,p=f.trimStart()):v?x=t[1].length+1:(x=t[2].search(this.rules.other.nonSpaceChar),x=x>4?1:x,p=f.slice(x),x+=t[1].length),v&&this.rules.other.blankLine.test(w)&&(d+=w+`
`,s=s.substring(w.length+1),c=!0),!c){let D=this.rules.other.nextBulletRegex(x),k=this.rules.other.hrRegex(x),m=this.rules.other.fencesBeginRegex(x),C=this.rules.other.headingBeginRegex(x),T=this.rules.other.htmlBeginRegex(x);for(;s;){let N=s.split(`
`,1)[0],P;if(w=N,this.options.pedantic?(w=w.replace(this.rules.other.listReplaceNesting,"  "),P=w):P=w.replace(this.rules.other.tabCharGlobal,"    "),m.test(w)||C.test(w)||T.test(w)||D.test(w)||k.test(w))break;if(P.search(this.rules.other.nonSpaceChar)>=x||!w.trim())p+=`
`+P.slice(x);else{if(v||f.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||m.test(f)||C.test(f)||k.test(f))break;p+=`
`+w}!v&&!w.trim()&&(v=!0),d+=N+`
`,s=s.substring(N.length+1),f=P.slice(x)}}o.loose||(i?o.loose=!0:this.rules.other.doubleBlankLine.test(d)&&(i=!0));let j=null,b;this.options.gfm&&(j=this.rules.other.listIsTask.exec(p),j&&(b=j[0]!=="[ ] ",p=p.replace(this.rules.other.listReplaceTask,""))),o.items.push({type:"list_item",raw:d,task:!!j,checked:b,loose:!1,text:p,tokens:[]}),o.raw+=d}let a=o.items.at(-1);if(a)a.raw=a.raw.trimEnd(),a.text=a.text.trimEnd();else return;o.raw=o.raw.trimEnd();for(let c=0;c<o.items.length;c++)if(this.lexer.state.top=!1,o.items[c].tokens=this.lexer.blockTokens(o.items[c].text,[]),!o.loose){let d=o.items[c].tokens.filter(f=>f.type==="space"),p=d.length>0&&d.some(f=>this.rules.other.anyLine.test(f.raw));o.loose=p}if(o.loose)for(let c=0;c<o.items.length;c++)o.items[c].loose=!0;return o}}html(s){let t=this.rules.block.html.exec(s);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(s){let t=this.rules.block.def.exec(s);if(t){let r=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",o=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:r,raw:t[0],href:n,title:o}}}table(s){let t=this.rules.block.table.exec(s);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let r=Nr(t[1]),n=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),o=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],l={type:"table",raw:t[0],header:[],align:[],rows:[]};if(r.length===n.length){for(let i of n)this.rules.other.tableAlignRight.test(i)?l.align.push("right"):this.rules.other.tableAlignCenter.test(i)?l.align.push("center"):this.rules.other.tableAlignLeft.test(i)?l.align.push("left"):l.align.push(null);for(let i=0;i<r.length;i++)l.header.push({text:r[i],tokens:this.lexer.inline(r[i]),header:!0,align:l.align[i]});for(let i of o)l.rows.push(Nr(i,l.header.length).map((a,c)=>({text:a,tokens:this.lexer.inline(a),header:!1,align:l.align[c]})));return l}}lheading(s){let t=this.rules.block.lheading.exec(s);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(s){let t=this.rules.block.paragraph.exec(s);if(t){let r=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:r,tokens:this.lexer.inline(r)}}}text(s){let t=this.rules.block.text.exec(s);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(s){let t=this.rules.inline.escape.exec(s);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(s){let t=this.rules.inline.tag.exec(s);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(s){let t=this.rules.inline.link.exec(s);if(t){let r=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(r)){if(!this.rules.other.endAngleBracket.test(r))return;let l=jt(r.slice(0,-1),"\\");if((r.length-l.length)%2===0)return}else{let l=ka(t[2],"()");if(l===-2)return;if(l>-1){let i=(t[0].indexOf("!")===0?5:4)+t[1].length+l;t[2]=t[2].substring(0,l),t[0]=t[0].substring(0,i).trim(),t[3]=""}}let n=t[2],o="";if(this.options.pedantic){let l=this.rules.other.pedanticHrefTitle.exec(n);l&&(n=l[1],o=l[3])}else o=t[3]?t[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(r)?n=n.slice(1):n=n.slice(1,-1)),Mr(t,{href:n&&n.replace(this.rules.inline.anyPunctuation,"$1"),title:o&&o.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(s,t){let r;if((r=this.rules.inline.reflink.exec(s))||(r=this.rules.inline.nolink.exec(s))){let n=(r[2]||r[1]).replace(this.rules.other.multipleSpaceGlobal," "),o=t[n.toLowerCase()];if(!o){let l=r[0].charAt(0);return{type:"text",raw:l,text:l}}return Mr(r,o,r[0],this.lexer,this.rules)}}emStrong(s,t,r=""){let n=this.rules.inline.emStrongLDelim.exec(s);if(!(!n||n[3]&&r.match(this.rules.other.unicodeAlphaNumeric))&&(!(n[1]||n[2])||!r||this.rules.inline.punctuation.exec(r))){let o=[...n[0]].length-1,l,i,a=o,c=0,d=n[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(d.lastIndex=0,t=t.slice(-1*s.length+o);(n=d.exec(t))!=null;){if(l=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!l)continue;if(i=[...l].length,n[3]||n[4]){a+=i;continue}else if((n[5]||n[6])&&o%3&&!((o+i)%3)){c+=i;continue}if(a-=i,a>0)continue;i=Math.min(i,i+a+c);let p=[...n[0]][0].length,f=s.slice(0,o+n.index+p+i);if(Math.min(o,i)%2){let v=f.slice(1,-1);return{type:"em",raw:f,text:v,tokens:this.lexer.inlineTokens(v)}}let w=f.slice(2,-2);return{type:"strong",raw:f,text:w,tokens:this.lexer.inlineTokens(w)}}}}codespan(s){let t=this.rules.inline.code.exec(s);if(t){let r=t[2].replace(this.rules.other.newLineCharGlobal," "),n=this.rules.other.nonSpaceChar.test(r),o=this.rules.other.startingSpaceChar.test(r)&&this.rules.other.endingSpaceChar.test(r);return n&&o&&(r=r.substring(1,r.length-1)),{type:"codespan",raw:t[0],text:r}}}br(s){let t=this.rules.inline.br.exec(s);if(t)return{type:"br",raw:t[0]}}del(s){let t=this.rules.inline.del.exec(s);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(s){let t=this.rules.inline.autolink.exec(s);if(t){let r,n;return t[2]==="@"?(r=t[1],n="mailto:"+r):(r=t[1],n=r),{type:"link",raw:t[0],text:r,href:n,tokens:[{type:"text",raw:r,text:r}]}}}url(s){let t;if(t=this.rules.inline.url.exec(s)){let r,n;if(t[2]==="@")r=t[0],n="mailto:"+r;else{let o;do o=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??"";while(o!==t[0]);r=t[0],t[1]==="www."?n="http://"+t[0]:n=t[0]}return{type:"link",raw:t[0],text:r,href:n,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(s){let t=this.rules.inline.text.exec(s);if(t){let r=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:r}}}},Ue=class Ps{tokens;options;state;tokenizer;inlineQueue;constructor(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||nt,this.options.tokenizer=this.options.tokenizer||new Vt,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let r={other:ve,block:At.normal,inline:gt.normal};this.options.pedantic?(r.block=At.pedantic,r.inline=gt.pedantic):this.options.gfm&&(r.block=At.gfm,this.options.breaks?r.inline=gt.breaks:r.inline=gt.gfm),this.tokenizer.rules=r}static get rules(){return{block:At,inline:gt}}static lex(t,r){return new Ps(r).lex(t)}static lexInline(t,r){return new Ps(r).inlineTokens(t)}lex(t){t=t.replace(ve.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let r=0;r<this.inlineQueue.length;r++){let n=this.inlineQueue[r];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,r=[],n=!1){for(this.options.pedantic&&(t=t.replace(ve.tabCharGlobal,"    ").replace(ve.spaceLine,""));t;){let o;if(this.options.extensions?.block?.some(i=>(o=i.call({lexer:this},t,r))?(t=t.substring(o.raw.length),r.push(o),!0):!1))continue;if(o=this.tokenizer.space(t)){t=t.substring(o.raw.length);let i=r.at(-1);o.raw.length===1&&i!==void 0?i.raw+=`
`:r.push(o);continue}if(o=this.tokenizer.code(t)){t=t.substring(o.raw.length);let i=r.at(-1);i?.type==="paragraph"||i?.type==="text"?(i.raw+=`
`+o.raw,i.text+=`
`+o.text,this.inlineQueue.at(-1).src=i.text):r.push(o);continue}if(o=this.tokenizer.fences(t)){t=t.substring(o.raw.length),r.push(o);continue}if(o=this.tokenizer.heading(t)){t=t.substring(o.raw.length),r.push(o);continue}if(o=this.tokenizer.hr(t)){t=t.substring(o.raw.length),r.push(o);continue}if(o=this.tokenizer.blockquote(t)){t=t.substring(o.raw.length),r.push(o);continue}if(o=this.tokenizer.list(t)){t=t.substring(o.raw.length),r.push(o);continue}if(o=this.tokenizer.html(t)){t=t.substring(o.raw.length),r.push(o);continue}if(o=this.tokenizer.def(t)){t=t.substring(o.raw.length);let i=r.at(-1);i?.type==="paragraph"||i?.type==="text"?(i.raw+=`
`+o.raw,i.text+=`
`+o.raw,this.inlineQueue.at(-1).src=i.text):this.tokens.links[o.tag]||(this.tokens.links[o.tag]={href:o.href,title:o.title});continue}if(o=this.tokenizer.table(t)){t=t.substring(o.raw.length),r.push(o);continue}if(o=this.tokenizer.lheading(t)){t=t.substring(o.raw.length),r.push(o);continue}let l=t;if(this.options.extensions?.startBlock){let i=1/0,a=t.slice(1),c;this.options.extensions.startBlock.forEach(d=>{c=d.call({lexer:this},a),typeof c=="number"&&c>=0&&(i=Math.min(i,c))}),i<1/0&&i>=0&&(l=t.substring(0,i+1))}if(this.state.top&&(o=this.tokenizer.paragraph(l))){let i=r.at(-1);n&&i?.type==="paragraph"?(i.raw+=`
`+o.raw,i.text+=`
`+o.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=i.text):r.push(o),n=l.length!==t.length,t=t.substring(o.raw.length);continue}if(o=this.tokenizer.text(t)){t=t.substring(o.raw.length);let i=r.at(-1);i?.type==="text"?(i.raw+=`
`+o.raw,i.text+=`
`+o.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=i.text):r.push(o);continue}if(t){let i="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(i);break}else throw new Error(i)}}return this.state.top=!0,r}inline(t,r=[]){return this.inlineQueue.push({src:t,tokens:r}),r}inlineTokens(t,r=[]){let n=t,o=null;if(this.tokens.links){let a=Object.keys(this.tokens.links);if(a.length>0)for(;(o=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)a.includes(o[0].slice(o[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,o.index)+"["+"a".repeat(o[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(o=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,o.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(o=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)n=n.slice(0,o.index)+"["+"a".repeat(o[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let l=!1,i="";for(;t;){l||(i=""),l=!1;let a;if(this.options.extensions?.inline?.some(d=>(a=d.call({lexer:this},t,r))?(t=t.substring(a.raw.length),r.push(a),!0):!1))continue;if(a=this.tokenizer.escape(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.tag(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.link(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(a.raw.length);let d=r.at(-1);a.type==="text"&&d?.type==="text"?(d.raw+=a.raw,d.text+=a.text):r.push(a);continue}if(a=this.tokenizer.emStrong(t,n,i)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.codespan(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.br(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.del(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.autolink(t)){t=t.substring(a.raw.length),r.push(a);continue}if(!this.state.inLink&&(a=this.tokenizer.url(t))){t=t.substring(a.raw.length),r.push(a);continue}let c=t;if(this.options.extensions?.startInline){let d=1/0,p=t.slice(1),f;this.options.extensions.startInline.forEach(w=>{f=w.call({lexer:this},p),typeof f=="number"&&f>=0&&(d=Math.min(d,f))}),d<1/0&&d>=0&&(c=t.substring(0,d+1))}if(a=this.tokenizer.inlineText(c)){t=t.substring(a.raw.length),a.raw.slice(-1)!=="_"&&(i=a.raw.slice(-1)),l=!0;let d=r.at(-1);d?.type==="text"?(d.raw+=a.raw,d.text+=a.text):r.push(a);continue}if(t){let d="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(d);break}else throw new Error(d)}}return r}},Jt=class{options;parser;constructor(s){this.options=s||nt}space(s){return""}code({text:s,lang:t,escaped:r}){let n=(t||"").match(ve.notSpaceStart)?.[0],o=s.replace(ve.endingNewline,"")+`
`;return n?'<pre><code class="language-'+Fe(n)+'">'+(r?o:Fe(o,!0))+`</code></pre>
`:"<pre><code>"+(r?o:Fe(o,!0))+`</code></pre>
`}blockquote({tokens:s}){return`<blockquote>
${this.parser.parse(s)}</blockquote>
`}html({text:s}){return s}heading({tokens:s,depth:t}){return`<h${t}>${this.parser.parseInline(s)}</h${t}>
`}hr(s){return`<hr>
`}list(s){let t=s.ordered,r=s.start,n="";for(let i=0;i<s.items.length;i++){let a=s.items[i];n+=this.listitem(a)}let o=t?"ol":"ul",l=t&&r!==1?' start="'+r+'"':"";return"<"+o+l+`>
`+n+"</"+o+`>
`}listitem(s){let t="";if(s.task){let r=this.checkbox({checked:!!s.checked});s.loose?s.tokens[0]?.type==="paragraph"?(s.tokens[0].text=r+" "+s.tokens[0].text,s.tokens[0].tokens&&s.tokens[0].tokens.length>0&&s.tokens[0].tokens[0].type==="text"&&(s.tokens[0].tokens[0].text=r+" "+Fe(s.tokens[0].tokens[0].text),s.tokens[0].tokens[0].escaped=!0)):s.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):t+=r+" "}return t+=this.parser.parse(s.tokens,!!s.loose),`<li>${t}</li>
`}checkbox({checked:s}){return"<input "+(s?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:s}){return`<p>${this.parser.parseInline(s)}</p>
`}table(s){let t="",r="";for(let o=0;o<s.header.length;o++)r+=this.tablecell(s.header[o]);t+=this.tablerow({text:r});let n="";for(let o=0;o<s.rows.length;o++){let l=s.rows[o];r="";for(let i=0;i<l.length;i++)r+=this.tablecell(l[i]);n+=this.tablerow({text:r})}return n&&(n=`<tbody>${n}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+n+`</table>
`}tablerow({text:s}){return`<tr>
${s}</tr>
`}tablecell(s){let t=this.parser.parseInline(s.tokens),r=s.header?"th":"td";return(s.align?`<${r} align="${s.align}">`:`<${r}>`)+t+`</${r}>
`}strong({tokens:s}){return`<strong>${this.parser.parseInline(s)}</strong>`}em({tokens:s}){return`<em>${this.parser.parseInline(s)}</em>`}codespan({text:s}){return`<code>${Fe(s,!0)}</code>`}br(s){return"<br>"}del({tokens:s}){return`<del>${this.parser.parseInline(s)}</del>`}link({href:s,title:t,tokens:r}){let n=this.parser.parseInline(r),o=Lr(s);if(o===null)return n;s=o;let l='<a href="'+s+'"';return t&&(l+=' title="'+Fe(t)+'"'),l+=">"+n+"</a>",l}image({href:s,title:t,text:r,tokens:n}){n&&(r=this.parser.parseInline(n,this.parser.textRenderer));let o=Lr(s);if(o===null)return Fe(r);s=o;let l=`<img src="${s}" alt="${r}"`;return t&&(l+=` title="${Fe(t)}"`),l+=">",l}text(s){return"tokens"in s&&s.tokens?this.parser.parseInline(s.tokens):"escaped"in s&&s.escaped?s.text:Fe(s.text)}},Xs=class{strong({text:s}){return s}em({text:s}){return s}codespan({text:s}){return s}del({text:s}){return s}html({text:s}){return s}text({text:s}){return s}link({text:s}){return""+s}image({text:s}){return""+s}br(){return""}},Be=class Rs{options;renderer;textRenderer;constructor(t){this.options=t||nt,this.options.renderer=this.options.renderer||new Jt,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Xs}static parse(t,r){return new Rs(r).parse(t)}static parseInline(t,r){return new Rs(r).parseInline(t)}parse(t,r=!0){let n="";for(let o=0;o<t.length;o++){let l=t[o];if(this.options.extensions?.renderers?.[l.type]){let a=l,c=this.options.extensions.renderers[a.type].call({parser:this},a);if(c!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(a.type)){n+=c||"";continue}}let i=l;switch(i.type){case"space":{n+=this.renderer.space(i);continue}case"hr":{n+=this.renderer.hr(i);continue}case"heading":{n+=this.renderer.heading(i);continue}case"code":{n+=this.renderer.code(i);continue}case"table":{n+=this.renderer.table(i);continue}case"blockquote":{n+=this.renderer.blockquote(i);continue}case"list":{n+=this.renderer.list(i);continue}case"html":{n+=this.renderer.html(i);continue}case"paragraph":{n+=this.renderer.paragraph(i);continue}case"text":{let a=i,c=this.renderer.text(a);for(;o+1<t.length&&t[o+1].type==="text";)a=t[++o],c+=`
`+this.renderer.text(a);r?n+=this.renderer.paragraph({type:"paragraph",raw:c,text:c,tokens:[{type:"text",raw:c,text:c,escaped:!0}]}):n+=c;continue}default:{let a='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return n}parseInline(t,r=this.renderer){let n="";for(let o=0;o<t.length;o++){let l=t[o];if(this.options.extensions?.renderers?.[l.type]){let a=this.options.extensions.renderers[l.type].call({parser:this},l);if(a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(l.type)){n+=a||"";continue}}let i=l;switch(i.type){case"escape":{n+=r.text(i);break}case"html":{n+=r.html(i);break}case"link":{n+=r.link(i);break}case"image":{n+=r.image(i);break}case"strong":{n+=r.strong(i);break}case"em":{n+=r.em(i);break}case"codespan":{n+=r.codespan(i);break}case"br":{n+=r.br(i);break}case"del":{n+=r.del(i);break}case"text":{n+=r.text(i);break}default:{let a='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return n}},Mt=class{options;block;constructor(s){this.options=s||nt}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(s){return s}postprocess(s){return s}processAllTokens(s){return s}provideLexer(){return this.block?Ue.lex:Ue.lexInline}provideParser(){return this.block?Be.parse:Be.parseInline}},Pa=class{defaults=Ws();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=Be;Renderer=Jt;TextRenderer=Xs;Lexer=Ue;Tokenizer=Vt;Hooks=Mt;constructor(...s){this.use(...s)}walkTokens(s,t){let r=[];for(let n of s)switch(r=r.concat(t.call(this,n)),n.type){case"table":{let o=n;for(let l of o.header)r=r.concat(this.walkTokens(l.tokens,t));for(let l of o.rows)for(let i of l)r=r.concat(this.walkTokens(i.tokens,t));break}case"list":{let o=n;r=r.concat(this.walkTokens(o.items,t));break}default:{let o=n;this.defaults.extensions?.childTokens?.[o.type]?this.defaults.extensions.childTokens[o.type].forEach(l=>{let i=o[l].flat(1/0);r=r.concat(this.walkTokens(i,t))}):o.tokens&&(r=r.concat(this.walkTokens(o.tokens,t)))}}return r}use(...s){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return s.forEach(r=>{let n={...r};if(n.async=this.defaults.async||n.async||!1,r.extensions&&(r.extensions.forEach(o=>{if(!o.name)throw new Error("extension name required");if("renderer"in o){let l=t.renderers[o.name];l?t.renderers[o.name]=function(...i){let a=o.renderer.apply(this,i);return a===!1&&(a=l.apply(this,i)),a}:t.renderers[o.name]=o.renderer}if("tokenizer"in o){if(!o.level||o.level!=="block"&&o.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let l=t[o.level];l?l.unshift(o.tokenizer):t[o.level]=[o.tokenizer],o.start&&(o.level==="block"?t.startBlock?t.startBlock.push(o.start):t.startBlock=[o.start]:o.level==="inline"&&(t.startInline?t.startInline.push(o.start):t.startInline=[o.start]))}"childTokens"in o&&o.childTokens&&(t.childTokens[o.name]=o.childTokens)}),n.extensions=t),r.renderer){let o=this.defaults.renderer||new Jt(this.defaults);for(let l in r.renderer){if(!(l in o))throw new Error(`renderer '${l}' does not exist`);if(["options","parser"].includes(l))continue;let i=l,a=r.renderer[i],c=o[i];o[i]=(...d)=>{let p=a.apply(o,d);return p===!1&&(p=c.apply(o,d)),p||""}}n.renderer=o}if(r.tokenizer){let o=this.defaults.tokenizer||new Vt(this.defaults);for(let l in r.tokenizer){if(!(l in o))throw new Error(`tokenizer '${l}' does not exist`);if(["options","rules","lexer"].includes(l))continue;let i=l,a=r.tokenizer[i],c=o[i];o[i]=(...d)=>{let p=a.apply(o,d);return p===!1&&(p=c.apply(o,d)),p}}n.tokenizer=o}if(r.hooks){let o=this.defaults.hooks||new Mt;for(let l in r.hooks){if(!(l in o))throw new Error(`hook '${l}' does not exist`);if(["options","block"].includes(l))continue;let i=l,a=r.hooks[i],c=o[i];Mt.passThroughHooks.has(l)?o[i]=d=>{if(this.defaults.async)return Promise.resolve(a.call(o,d)).then(f=>c.call(o,f));let p=a.call(o,d);return c.call(o,p)}:o[i]=(...d)=>{let p=a.apply(o,d);return p===!1&&(p=c.apply(o,d)),p}}n.hooks=o}if(r.walkTokens){let o=this.defaults.walkTokens,l=r.walkTokens;n.walkTokens=function(i){let a=[];return a.push(l.call(this,i)),o&&(a=a.concat(o.call(this,i))),a}}this.defaults={...this.defaults,...n}}),this}setOptions(s){return this.defaults={...this.defaults,...s},this}lexer(s,t){return Ue.lex(s,t??this.defaults)}parser(s,t){return Be.parse(s,t??this.defaults)}parseMarkdown(s){return(t,r)=>{let n={...r},o={...this.defaults,...n},l=this.onError(!!o.silent,!!o.async);if(this.defaults.async===!0&&n.async===!1)return l(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||t===null)return l(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return l(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));o.hooks&&(o.hooks.options=o,o.hooks.block=s);let i=o.hooks?o.hooks.provideLexer():s?Ue.lex:Ue.lexInline,a=o.hooks?o.hooks.provideParser():s?Be.parse:Be.parseInline;if(o.async)return Promise.resolve(o.hooks?o.hooks.preprocess(t):t).then(c=>i(c,o)).then(c=>o.hooks?o.hooks.processAllTokens(c):c).then(c=>o.walkTokens?Promise.all(this.walkTokens(c,o.walkTokens)).then(()=>c):c).then(c=>a(c,o)).then(c=>o.hooks?o.hooks.postprocess(c):c).catch(l);try{o.hooks&&(t=o.hooks.preprocess(t));let c=i(t,o);o.hooks&&(c=o.hooks.processAllTokens(c)),o.walkTokens&&this.walkTokens(c,o.walkTokens);let d=a(c,o);return o.hooks&&(d=o.hooks.postprocess(d)),d}catch(c){return l(c)}}}onError(s,t){return r=>{if(r.message+=`
Please report this to https://github.com/markedjs/marked.`,s){let n="<p>An error occurred:</p><pre>"+Fe(r.message+"",!0)+"</pre>";return t?Promise.resolve(n):n}if(t)return Promise.reject(r);throw r}}},rt=new Pa;function X(s,t){return rt.parse(s,t)}X.options=X.setOptions=function(s){return rt.setOptions(s),X.defaults=rt.defaults,En(X.defaults),X};X.getDefaults=Ws;X.defaults=nt;X.use=function(...s){return rt.use(...s),X.defaults=rt.defaults,En(X.defaults),X};X.walkTokens=function(s,t){return rt.walkTokens(s,t)};X.parseInline=rt.parseInline;X.Parser=Be;X.parser=Be.parse;X.Renderer=Jt;X.TextRenderer=Xs;X.Lexer=Ue;X.lexer=Ue.lex;X.Tokenizer=Vt;X.Hooks=Mt;X.parse=X;X.options;X.setOptions;X.use;X.walkTokens;X.parseInline;Be.parse;Ue.lex;function Ra(){const[s,t]=h.useState(null),[r,n]=h.useState(null),[o,l]=h.useState(!0),[i,a]=h.useState(!1),[c,d]=h.useState(!1),[p,f]=h.useState(!1),[w,v]=h.useState(null),[x,j]=h.useState(""),[b,D]=h.useState(""),[k,m]=h.useState(""),[C,T]=h.useState(""),[N,P]=h.useState(""),[W,A]=h.useState("");h.useEffect(()=>{M()},[]);const M=async()=>{try{l(!0);const{data:_}=await L.auth.getUser(),E=_.user;if(E){t(E),m(E.email||"");const{data:$}=await L.from("users").select("*").eq("id",E.id).single();if($){n($);const re=($.name||"").split(" ");j(re[0]||""),D(re.slice(1).join(" ")||""),T($.role||"UI Developer"),P($.department||""),A($.avatar_url||"")}}}catch(_){console.error("Error loading user data:",_),v({type:"danger",text:"Failed to load user data"})}finally{l(!1)}},F=async()=>{if(s)try{d(!0);const _=`${x} ${b}`.trim(),{error:E}=await L.from("users").update({name:_,role:C,department:N,avatar_url:W||null}).eq("id",s.id);if(E)throw E;await M(),a(!1),v({type:"success",text:"Profile updated successfully"}),setTimeout(()=>v(null),3e3)}catch(_){console.error("Error saving profile:",_),v({type:"danger",text:"Failed to save profile"})}finally{d(!1)}},U=async _=>{const E=_.target.files?.[0];if(!(!E||!s)){if(!E.type.startsWith("image/")){v({type:"danger",text:"Please select a valid image file"});return}if(E.size>5*1024*1024){v({type:"danger",text:"Image size must be less than 5MB"});return}try{f(!0),v(null);const $=E.name.split(".").pop(),he=`${s.id}-${Date.now()}.${$}`,{data:de,error:ae}=await L.storage.from("avatars").upload(he,E,{cacheControl:"3600",upsert:!0});if(ae)throw new Error(`Upload failed: ${ae.message}`);const{data:{publicUrl:ze}}=L.storage.from("avatars").getPublicUrl(he);A(ze);const{error:He}=await L.from("users").update({avatar_url:ze}).eq("id",s.id);if(He)throw new Error(`Database update failed: ${He.message}`);await M(),v({type:"success",text:"Avatar uploaded successfully"}),setTimeout(()=>v(null),3e3)}catch($){let re="Failed to upload avatar";$ instanceof Error&&($.message.includes("not found")?re="Storage bucket not configured. Please contact admin.":$.message.includes("permission")?re="Permission denied. Please contact admin.":re=`Upload failed: ${$.message}`),v({type:"danger",text:re})}finally{f(!1),_.target.value=""}}},S=()=>{const _=(r?.name||"").split(" ");j(_[0]||""),D(_.slice(1).join(" ")||""),T(r?.role||"UI Developer"),P(r?.department||""),A(r?.avatar_url||""),a(!1),v(null)};return o?e.jsx(ke,{children:e.jsx(lt,{children:e.jsx(g,{level:"body-sm",color:"neutral",children:"Loading profile..."})})}):e.jsx(ke,{children:e.jsxs(lt,{children:[e.jsx(g,{level:"h4",sx:{mb:1},children:"Personal info"}),e.jsx(g,{level:"body-sm",color:"neutral",sx:{mb:3},children:"Your profile information."}),w&&e.jsx(Kt,{color:w.type,sx:{mb:2},children:w.text}),e.jsxs(u,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:3,alignItems:{xs:"center",sm:"stretch"},width:"100%",maxWidth:"100%",overflow:"hidden"},children:[e.jsx(u,{sx:{flex:{xs:"none",sm:"1"},maxWidth:{xs:"100%",sm:"300px"},display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",position:"relative",minHeight:{xs:"auto",sm:"400px"},width:{xs:"100%",sm:"auto"}},children:e.jsxs(u,{sx:{position:"relative",display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsxs(ce,{size:"lg",src:W||r?.avatar_url||s?.user_metadata?.avatar_url,sx:{width:160,height:160},children:[x?.[0],b?.[0]]},`avatar-${W}-${r?.avatar_url}`),i&&e.jsxs(u,{sx:{mt:2,display:"flex",flexDirection:"column",alignItems:"center",gap:1},children:[e.jsxs(te,{component:"label",size:"sm",variant:"solid",color:"primary",loading:p,sx:{borderRadius:"8px",px:2,py:1},children:[e.jsx(ct,{fontSize:"small",sx:{mr:1}}),"Upload Avatar",e.jsx("input",{type:"file",accept:"image/*",onChange:U,style:{display:"none"}})]}),e.jsx(g,{level:"body-xs",color:"neutral",sx:{textAlign:"center",maxWidth:180,lineHeight:1.4},children:"Max 5MB (JPG, PNG, GIF)"})]})]})}),e.jsxs(u,{sx:{flex:{xs:"none",sm:"2"},maxWidth:{xs:"100%",sm:"calc(100% - 300px - 24px)"},width:{xs:"100%",sm:"auto"},minWidth:0},children:[e.jsxs(Q,{spacing:2,children:[e.jsxs(u,{children:[e.jsx(ee,{sx:{mb:1},children:"Name"}),e.jsxs(u,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2},children:[e.jsx(B,{placeholder:"First name",value:x,onChange:_=>j(_.target.value),disabled:!i,sx:{flex:1}}),e.jsx(B,{placeholder:"Last name",value:b,onChange:_=>D(_.target.value),disabled:!i,sx:{flex:1}})]})]}),e.jsxs(u,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2},children:[e.jsxs(ne,{sx:{flex:1},children:[e.jsx(ee,{children:"Role"}),e.jsx(B,{value:C,onChange:_=>T(_.target.value),disabled:!i})]}),e.jsxs(ne,{sx:{flex:1},children:[e.jsx(ee,{children:"Department"}),e.jsx(B,{value:N,onChange:_=>P(_.target.value),disabled:!i,placeholder:"e.g., Engineering, Sales, Marketing"})]})]}),e.jsxs(ne,{children:[e.jsx(ee,{children:"Email"}),e.jsx(B,{value:k,disabled:!0,startDecorator:"✉️"})]}),e.jsxs(ne,{children:[e.jsx(ee,{children:"Avatar URL"}),e.jsx(B,{value:W,onChange:_=>A(_.target.value),disabled:!i,placeholder:"https://example.com/avatar.jpg",startDecorator:"🖼️"})]}),r&&e.jsxs(u,{sx:{mt:2,p:2,bgcolor:"background.level1",borderRadius:"sm"},children:[e.jsx(g,{level:"body-sm",color:"neutral",sx:{mb:1},children:"Account Information"}),e.jsxs(Q,{spacing:1,children:[r.created_at&&e.jsxs(g,{level:"body-sm",children:[e.jsx("strong",{children:"Member since:"})," ",new Date(r.created_at).toLocaleDateString()]}),r.last_login&&e.jsxs(g,{level:"body-sm",children:[e.jsx("strong",{children:"Last login:"})," ",new Date(r.last_login).toLocaleDateString()]}),e.jsxs(g,{level:"body-sm",children:[e.jsx("strong",{children:"User ID:"})," ",r.id]})]})]})]}),e.jsx(u,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:1,mt:3,justifyContent:{xs:"stretch",sm:"flex-end"}},children:i?e.jsxs(e.Fragment,{children:[e.jsx(q,{variant:"outlined",onClick:S,disabled:c,startDecorator:e.jsx(ko,{}),sx:{order:{xs:2,sm:1}},children:"Cancel"}),e.jsx(q,{variant:"solid",onClick:F,loading:c,startDecorator:e.jsx(Co,{}),sx:{order:{xs:1,sm:2}},children:"Save"})]}):e.jsx(q,{variant:"outlined",onClick:()=>a(!0),startDecorator:e.jsx(ct,{}),children:"Edit Profile"})})]})]})]})})}function _a(){const[s,t]=K.useState(""),[r,n]=K.useState(!0),[o,l]=K.useState(!1),i=`## Latest Release
**Version 2.1.2** - July 6, 2025

### Recent Updates
- Modern Login Page Redesign with Split Layout
- Glassmorphism effect with backdrop blur and semi-transparent backgrounds
- Dynamic mountain landscape background images that change with light/dark mode
- Dark/light mode toggle in login page header
- Company branding with SmartBack logo and name in header

### System Status
- All systems operational
- Database migrations up to date
- Authentication services active

*For complete release history, please check the development environment or contact support.*`;return K.useEffect(()=>{const a="/RELEASE_LOG.md";console.log("Fetching release log from:",a),fetch(a).then(c=>{if(console.log("Release log response status:",c.status,c.statusText),!c.ok)throw new Error(`Failed to fetch release log: ${c.status} ${c.statusText}`);return c.text()}).then(c=>{console.log("Release log loaded successfully, length:",c.length);const d=c.replace(/<!--[\s\S]*?-->/g,"").trim();t(d),l(!1)}).catch(c=>{console.error("Error fetching release log:",c),console.log("Using fallback content"),t(i),l(!1)}).finally(()=>n(!1))},[i]),e.jsx(ke,{sx:{height:"100%",minHeight:{xs:200,md:300}},children:e.jsxs(lt,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(en,{color:"primary"}),e.jsx(g,{level:"h4",children:"Release Log"})]}),e.jsxs(u,{sx:{flex:1,overflow:"auto"},children:[r&&e.jsx(g,{level:"body-sm",color:"neutral",children:"Loading release log..."}),!r&&e.jsx(u,{sx:{typography:"body-sm"},children:e.jsx("div",{dangerouslySetInnerHTML:{__html:X(s)}})})]})]})})}function Ia(){return Ce(),e.jsx(ke,{sx:{height:"100%",minHeight:{xs:120,md:300}},children:e.jsxs(lt,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(Po,{color:"primary"}),e.jsx(g,{level:"h4",children:"Application Info"})]}),e.jsxs(Q,{spacing:1.5,sx:{flex:1},children:[e.jsxs(g,{level:"title-md",sx:{fontWeight:"bold"},children:["smartback".charAt(0).toUpperCase()+"smartback".slice(1)," business System"]}),e.jsxs(Q,{spacing:.5,children:[e.jsxs(g,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Environment:"})," ","production"]}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Version:"})," ","3.0.0"]}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Build Date:"})," ",new Date().toLocaleDateString()]}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Platform:"})," Web Application"]}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Currency:"})," ",_e.currency," (",_e.symbol,") - ",_e.locale]})]})]}),e.jsx(q,{component:"a",href:"https://nicklasfangerfisk.github.io/Testflow/",target:"_blank",rel:"noopener noreferrer",startDecorator:e.jsx(Ro,{}),variant:"outlined",color:"primary",sx:{mt:2,alignSelf:"flex-start"},children:"System Test"})]})})}const Ea=()=>{const{isMobile:s}=Ce(),[t,r]=h.useState(0),n=async()=>{try{const{error:a}=await L.auth.signOut();a?console.error("Error signing out:",a):window.location.href="/login"}catch(a){console.error("Error during logout:",a)}},o=[{label:"User",icon:e.jsx(vt,{}),content:e.jsx(Ra,{})},{label:"App",icon:e.jsx(vo,{}),content:e.jsx(Ia,{})},{label:"Releases",icon:e.jsx(en,{}),content:e.jsx(_a,{})}],l=()=>e.jsx(u,{sx:{width:"100%",minHeight:"100vh"},children:e.jsxs(je,{padding:"medium",children:[e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(g,{level:"h2",sx:{fontSize:Y.sizes.xlarge},children:"My profile"}),e.jsx(q,{variant:"outlined",color:"danger",size:"sm",startDecorator:e.jsx(cr,{}),onClick:n,children:"Logout"})]}),e.jsxs(sr,{value:t,onChange:(a,c)=>r(typeof c=="number"?c:0),sx:{bgcolor:"transparent"},children:[e.jsx(rr,{sx:{bgcolor:"transparent"},children:o.map((a,c)=>e.jsx(nr,{value:c,sx:{bgcolor:"transparent"},children:a.label},c))}),o.map((a,c)=>e.jsx(or,{value:c,sx:{p:0,pt:3,bgcolor:"transparent"},children:a.content},c))]})]})}),i=()=>e.jsxs(je,{variant:"table-page",children:[e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(g,{level:"h2",sx:{fontSize:Y.sizes.xlarge},children:"My profile"}),e.jsx(q,{variant:"outlined",color:"danger",startDecorator:e.jsx(cr,{}),onClick:n,children:"Logout"})]}),e.jsxs(sr,{value:t,onChange:(a,c)=>r(typeof c=="number"?c:0),sx:{bgcolor:"transparent"},children:[e.jsx(rr,{sx:{bgcolor:"transparent"},children:o.map((a,c)=>e.jsx(nr,{value:c,sx:{bgcolor:"transparent"},children:a.label},c))}),o.map((a,c)=>e.jsx(or,{value:c,sx:{p:0,pt:3,bgcolor:"transparent"},children:a.content},c))]})]});return e.jsx($e,{children:s?e.jsx(l,{}):e.jsx(i,{})})};function Da(){const s=Ms(),{isMobile:t}=Ce(),r=Ns(),[n,o]=h.useState("dashboard"),l=[{label:"Dashboard",icon:e.jsx(As,{}),value:"dashboard"},{label:"Orders",icon:e.jsx(Os,{}),value:"orders"},{label:"Users",icon:e.jsx(Ts,{}),value:"users"},{label:"My Profile",icon:e.jsx(vt,{}),value:"profile"},{label:"Settings",icon:e.jsx(_o,{}),value:"settings"}];return h.useEffect(()=>{o({"/":"dashboard","/dashboard":"dashboard","/orders":"orders","/products":"dashboard","/users":"users","/suppliers":"dashboard","/purchase-orders":"dashboard","/tickets":"dashboard","/sms-campaigns":"dashboard","/movements":"dashboard","/settings":"profile"}[s.pathname]||"dashboard")},[s.pathname]),console.log("isMobile:",t),e.jsxs(u,{sx:{display:"flex",minHeight:"100vh"},children:[s.pathname!=="/login"&&!t&&e.jsx(Mo,{setView:i=>console.log(i),view:"home"}),e.jsxs(u,{component:"main",sx:{flexGrow:1,display:"flex",flexDirection:"column",minHeight:"100vh",bgcolor:"background.default",p:0,width:t?"100%":"calc(100% - var(--Sidebar-width, 240px))",marginBottom:t?"56px":0},children:[t&&s.pathname!=="/login"&&e.jsx(Ol,{items:l,value:n,onChange:i=>{o(i);const c={home:"/",dashboard:"/dashboard",orders:"/orders",products:"/products",users:"/users",suppliers:"/suppliers",purchaseorders:"/purchase-orders",tickets:"/tickets",smscampaigns:"/sms-campaigns",movements:"/movements",profile:"/settings",settings:"/settings"}[i]||`/${i}`;r(c)},toggleSidebar:()=>console.log("Sidebar toggled")}),e.jsxs(Fs,{children:[e.jsx(Se,{path:"/",element:e.jsx(qt,{to:"/dashboard",replace:!0})}),e.jsx(Se,{path:"/orders",element:e.jsx(Me,{children:e.jsx(Wo,{})})}),e.jsx(Se,{path:"/products",element:e.jsx(Me,{children:e.jsx(Vo,{})})}),e.jsx(Se,{path:"/users",element:e.jsx(Me,{children:e.jsx(Go,{})})}),e.jsx(Se,{path:"/suppliers",element:e.jsx(Me,{children:e.jsx(Zo,{})})}),e.jsx(Se,{path:"/purchase-orders",element:e.jsx(Me,{children:e.jsx(Al,{})})}),e.jsx(Se,{path:"/tickets",element:e.jsx(Me,{children:e.jsx(Ll,{})})}),e.jsx(Se,{path:"/sms-campaigns",element:e.jsx(Me,{children:e.jsx(Ml,{})})}),e.jsx(Se,{path:"/dashboard",element:e.jsx(Me,{children:e.jsx($l,{})})}),e.jsx(Se,{path:"/movements",element:e.jsx(Me,{children:e.jsx(Wl,{})})}),e.jsx(Se,{path:"/settings",element:e.jsx(Me,{children:e.jsx(Ea,{})})}),e.jsx(Se,{path:"*",element:e.jsx(qt,{to:"/",replace:!0})})]})]})]})}function Aa(){return e.jsx(Hr,{children:e.jsx(Eo,{children:e.jsxs(Fs,{children:[e.jsx(Se,{path:"/login/*",element:e.jsx(Bl,{})}),e.jsx(Se,{path:"/*",element:e.jsx(Da,{})})]})})})}console.log("Mounting React app...");const Fr=document.getElementById("root");Fr?(Ao.createRoot(Fr).render(e.jsx(Aa,{})),console.log("React app rendered!")):console.error("No #root element found in index.html!");

import{b as un,u as hn,r as p,j as e,I as oe,M as we,d as ve,D as qt,e as Ft,B as S,A as Ee,T as w,f as ft,h as F,i as $t,k as q,R as V,l as pn,m as Be,G as xn,L as pt,n as st,o as ht,p as Ne,q as yt,s as fn,t as We,F as X,v as Y,S as le,w as M,x as bs,y as Te,z as ke,C as Ut,E as js,H as ie,J as Ze,K as Pe,N as mn,O as gn,P as bn,Q as St,U as xr,V as rt,W as jn,X as yn,Y as Sn,Z as wn,_ as vn,$ as Fs,a0 as kn,a1 as Cn,a2 as _n,a3 as $s,a4 as fr,a5 as mr,a6 as Pn,a7 as Rn}from"./mui-core-Cy60SRnl.js";import{D as An,L as En,P as On,H as In,a as ys,S as Ss,b as gr,G as ws,c as br,A as jr,Q as yr,d as Et,I as vs,e as Ot,f as Dn,K as Tn,g as Us,h as is,i as qe,j as Fe,F as ks,k as Bs,l as Ws,m as Hs,E as os,M as Ln,C as Sr,n as Nn,o as zn,O as wr}from"./mui-icons-mf4ckH-Q.js";import{c as Mn}from"./supabase-CvCSjn6K.js";import{N as It,u as Bt,a as Cs,R as _s,b as fe,B as qn}from"./router-wSAmfRlt.js";import{f as Fn}from"./utils-CSQe5d3I.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();var wt={},Vs;function $n(){if(Vs)return wt;Vs=1;var s=un();return wt.createRoot=s.createRoot,wt.hydrateRoot=s.hydrateRoot,wt}var Un=$n();function Bn(s){const{onClick:t,sx:r,...i}=s,{mode:n,setMode:o}=hn(),[l,a]=p.useState(!1);return p.useEffect(()=>{a(!0)},[]),l?e.jsxs(oe,{"data-screenshot":"toggle-mode",size:"sm",variant:"outlined",color:"neutral",...i,onClick:c=>{o(n==="light"?"dark":"light"),t?.(c)},sx:[n==="dark"?{"& > *:first-of-type":{display:"none"}}:{"& > *:first-of-type":{display:"initial"}},n==="light"?{"& > *:last-of-type":{display:"none"}}:{"& > *:last-of-type":{display:"initial"}},...Array.isArray(r)?r:[r]],children:[e.jsx(An,{}),e.jsx(En,{})]}):e.jsx(oe,{size:"sm",variant:"outlined",color:"neutral",...i,sx:r,disabled:!0})}const vr="https://tfzvtzqybgbzxcxozdes.supabase.co",ls="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRmenZ0enF5YmdienhjeG96ZGVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NTc2MDIsImV4cCI6MjA2MzQzMzYwMn0.hD2WdkvI8LY9N0IHP7HDQliyicQA0c-mspKjCJf0_Fc";console.log("[Supabase] URL:",vr);console.log("[Supabase] Anon Key:",ls.slice(0,6)+"..."+ls.slice(-6));const O=Mn(vr,ls);O.auth.onAuthStateChange((s,t)=>{console.log("[Auth State Change]",s,t),s==="SIGNED_IN"?console.log("User signed in:",t?.user):s==="SIGNED_OUT"&&console.log("User signed out")});let Yt=!1;O.auth.onAuthStateChange((s,t)=>{Yt||(Yt=!0,console.log("[Auth State Change]",s,t),s==="SIGNED_IN"?console.log("User signed in:",t?.user):s==="SIGNED_OUT"&&(console.log("User signed out"),window.location.pathname!=="/login"&&(window.location.href="/login")),Yt=!1)});function Wn({open:s,onClose:t,userProfile:r,editName:i,setEditName:n,editAvatar:o,setEditAvatar:l,onSave:a}){const[c,d]=p.useState(!1),[u,h]=p.useState(null),g=p.useRef(null);async function b(x){const m=x.target.files&&x.target.files[0];if(!(!m||!r?.id)){d(!0),h(null);try{const y=m.name.split(".").pop()?.replace(/\./,"")||"png",_=`avatars/${r.id}_${Date.now()}.${y}`,D=await O.storage.from("avatars").upload(_,m,{upsert:!0,contentType:m.type});if(D.error)throw D.error;const{publicUrl:I}=O.storage.from("avatars").getPublicUrl(_).data;I&&l(I)}catch(y){h("Failed to upload avatar. Please try again."),console.error("Avatar upload failed",y)}d(!1)}}return e.jsx(we,{open:s,onClose:t,children:e.jsxs(ve,{children:[e.jsx(qt,{children:"Edit Profile"}),e.jsxs(Ft,{sx:{display:"flex",flexDirection:"row",gap:3,alignItems:"flex-start"},children:[e.jsxs(S,{sx:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:110},children:[e.jsx(Ee,{src:o||r?.avatar_url||"",alt:i||r?.name||"Avatar",sx:{width:96,height:96,mb:1}}),e.jsxs(w,{level:"body-xs",sx:{mt:1,textAlign:"center"},children:["Last login:",e.jsx("br",{}),r?.last_login?new Date(r.last_login).toLocaleString():"Never"]})]}),e.jsx(ft,{orientation:"vertical",sx:{mx:1,alignSelf:"stretch"}}),e.jsxs(S,{sx:{flex:1,display:"flex",flexDirection:"column",gap:2},children:[e.jsx(w,{level:"body-sm",children:"Name"}),e.jsx(F,{placeholder:"Your name",value:i,onChange:x=>n(x.target.value),sx:{mb:1},required:!0}),e.jsx(w,{level:"body-sm",children:"Avatar URL"}),e.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(F,{placeholder:"Avatar image URL",value:o,onChange:x=>l(x.target.value),sx:{flex:1}}),e.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},ref:g,onChange:b,disabled:c}),e.jsx(oe,{component:"span",onClick:()=>g.current?.click(),disabled:c,title:"Upload from device",children:e.jsx(On,{})})]}),u&&e.jsx(w,{color:"danger",sx:{mt:1},children:u})]})]}),e.jsxs($t,{children:[e.jsx(q,{variant:"plain",onClick:t,disabled:c,children:"Cancel"}),e.jsx(q,{onClick:()=>{a(),t()},disabled:c||!i,children:"Save"})]})]})})}const Ps=s=>t=>{const[r,i]=V.useState(null),[n,o]=V.useState(!0);return V.useEffect(()=>{async function l(){const{data:a}=await O.auth.getSession();i(a?.session||null),o(!1)}l()},[]),n?e.jsx("div",{children:"Loading..."}):r?e.jsx(s,{...t}):e.jsx(It,{to:"/login",replace:!0})},Hn=[{label:"Home",icon:V.createElement(In),value:"home",route:"/",showInMobile:!0},{label:"Dashboard",icon:V.createElement(ys),value:"dashboard",route:"/dashboard",showInMobile:!0},{label:"Orders",icon:V.createElement(Ss),value:"orders",route:"/orders",showInMobile:!0},{label:"Products",icon:V.createElement(gr),value:"products",route:"/products",showInMobile:!0},{label:"Users",icon:V.createElement(ws),value:"users",route:"/users",showInMobile:!0},{label:"Suppliers",icon:V.createElement(br),value:"suppliers",route:"/suppliers",showInMobile:!0},{label:"Purchase Orders",icon:V.createElement(jr),value:"purchaseorders",route:"/purchase-orders",showInMobile:!0},{label:"Tickets",icon:V.createElement(yr),value:"tickets",route:"/tickets",showInMobile:!0},{label:"SMS Campaigns",icon:V.createElement(Et),value:"smscampaigns",route:"/sms-campaigns",showInMobile:!0},{label:"Movements",icon:V.createElement(Et),value:"movements",route:"/movements",showInMobile:!0},{label:"Inventory",icon:V.createElement(vs),value:"inventory",route:"/inventory",showInMobile:!0},{label:"Settings",icon:V.createElement(Ot),value:"settings",route:"/settings",showInMobile:!1}],Ct={Sales:[{label:"Dashboard",icon:V.createElement(ys),value:"dashboard",route:"/dashboard",showInMobile:!0},{label:"Orders",icon:V.createElement(Ss),value:"orders",route:"/orders",showInMobile:!0},{label:"Products",icon:V.createElement(gr),value:"products",route:"/products",showInMobile:!0}],Support:[{label:"Tickets",icon:V.createElement(yr),value:"tickets",route:"/tickets",showInMobile:!0},{label:"Users",icon:V.createElement(ws),value:"users",route:"/users",showInMobile:!0}],Marketing:[{label:"SMS Campaigns",icon:V.createElement(Et),value:"smscampaigns",route:"/sms-campaigns",showInMobile:!0}],Operations:[{label:"Suppliers",icon:V.createElement(br),value:"suppliers",route:"/suppliers",showInMobile:!0},{label:"Purchase Orders",icon:V.createElement(jr),value:"purchaseorders",route:"/purchase-orders",showInMobile:!0},{label:"Movements",icon:V.createElement(Et),value:"movements",route:"/movements",showInMobile:!0},{label:"Inventory",icon:V.createElement(vs),value:"inventory",route:"/inventory",showInMobile:!0}]};function He(){const s=pn(),t=Be("(max-width:600px)"),r=Be("(min-width:601px) and (max-width:1024px)"),i=Be("(min-width:1025px)");return{isMobile:t,isTablet:r,isDesktop:i,isSmallScreen:t,isMediumScreen:r,isLargeScreen:i,breakpoints:{mobile:"600px",tablet:"1024px",desktop:"1025px"},theme:s}}function kr(){const{isMobile:s,isTablet:t}=He();return{containerPadding:s?1:t?2:3,sectionPadding:s?2:t?3:4,itemPadding:s?1:2,smallGap:s?1:2,mediumGap:s?2:3,largeGap:s?3:4,sectionMargin:s?2:3,itemMargin:s?1:2}}function Vn(){const{isMobile:s}=He();return{getModalSize:(r="medium")=>s?{width:"95vw",height:r==="fullscreen"?"95vh":"auto",maxHeight:"90vh",margin:1}:{small:{width:400,maxWidth:"90vw"},medium:{width:600,maxWidth:"90vw"},large:{width:800,maxWidth:"90vw"},fullscreen:{width:"90vw",height:"90vh"}}[r]}}function Jn({setView:s,view:t}){const r=Bt(),i=Cs(),{isMobile:n,isTablet:o,isDesktop:l}=He(),[a,c]=p.useState(!1),[d,u]=p.useState([]),[h,g]=p.useState(null),[b,x]=p.useState(null),[m,y]=p.useState(!1),[_,D]=p.useState(""),[I,v]=p.useState(""),[k,A]=p.useState(!1);p.useEffect(()=>{async function P(){const{data:E,error:$}=await O.from("users").select("*");!$&&E&&u(E)}P();async function C(E){if(g(E),E){let{data:$}=await O.from("users").select("*").eq("id",E.id).single();$||(await O.from("users").upsert({id:E.id,email:E.email,name:E.user_metadata?.full_name||null,avatar_url:E.user_metadata?.avatar_url||null,role:"employee"}),$={...E,role:"employee"}),x($),D($.name||""),v($.avatar_url||"")}else x(null),D(""),v("")}O.auth.getUser().then(({data:E})=>C(E.user));const{data:N}=O.auth.onAuthStateChange((E,$)=>{C($?.user??null)});return()=>{N?.subscription.unsubscribe()}},[]);const T=async()=>{if(!h)return;await O.from("users").update({name:_,avatar_url:I}).eq("id",h.id);const{data:P}=await O.from("users").select("*").eq("id",h.id).single();x(P||null),y(!1)};p.useEffect(()=>{o&&c(!0)},[o,l]);const U=P=>{r(P.route),s(P.value),o&&c(!0)},Q=()=>{c(!a)},K=(P,C)=>{U({value:C,route:P})},L=P=>i.pathname===P;return e.jsxs(S,{className:"Sidebar",sx:{display:n?"none":"flex",position:{xs:"fixed",md:"sticky"},transform:{xs:"translateX(calc(100% * (var(--SideNavigation-slideIn, 0) - 1)))",md:"none"},transition:"transform 0.4s, width 0.4s",zIndex:1e4,height:"100dvh",width:"var(--Sidebar-width)",top:0,p:2,flexShrink:0,flexDirection:"column",gap:2,borderRight:"1px solid",borderColor:"divider",background:"var(--joy-palette-background-surface, #fff)"},children:[e.jsx(xn,{styles:P=>({":root":{"--Sidebar-width":a?"60px":"220px",[P.breakpoints.up("lg")]:{"--Sidebar-width":a?"60px":"240px"}}})}),e.jsx(S,{className:"Sidebar-overlay",sx:{position:"fixed",zIndex:9998,top:0,left:0,width:"100vw",height:"100vh",opacity:"var(--SideNavigation-slideIn)",backgroundColor:"var(--joy-palette-background-backdrop)",transition:"opacity 0.4s",transform:{xs:"translateX(calc(100% * (var(--SideNavigation-slideIn, 0) - 1) + var(--SideNavigation-slideIn, 0) * var(--Sidebar-width, 0px)))",lg:"translateX(-100%)"}}}),e.jsxs(S,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(oe,{size:"sm",variant:"plain",onClick:Q,sx:{p:.5,borderRadius:1,"&:hover":{bgcolor:"neutral.100"}},children:e.jsx("img",{src:"/favicon.svg",alt:"Logo",style:{width:28,height:28,borderRadius:6}})}),!a&&e.jsxs(e.Fragment,{children:[e.jsx(w,{level:"title-lg",children:"Smartbuy"}),e.jsx(Bn,{sx:{ml:"auto"}})]})]}),!a&&e.jsx(F,{size:"sm",startDecorator:e.jsx(Dn,{}),placeholder:"Search"}),e.jsx(S,{sx:{minHeight:0,overflowY:"auto",overflowX:"hidden",flex:"0 0 auto",display:"flex",flexDirection:"column",[`& .${fn.root}`]:{gap:1.5}},children:e.jsx(pt,{size:"sm",sx:{gap:1,"--List-nestedInsetStart":"30px","--ListItem-radius":P=>P.vars.radius.sm},children:["Sales","Support","Operations","Marketing"].map(P=>e.jsx(st,{nested:!0,children:e.jsx(Gn,{defaultExpanded:!a,renderToggle:({open:C,setOpen:N})=>a?e.jsx(ht,{title:P,placement:"right",arrow:!0,children:e.jsx(Ne,{onClick:()=>N(!C),children:Ct[P][0]?.icon})}):e.jsxs(Ne,{onClick:()=>N(!C),children:[Ct[P][0]?.icon,e.jsx(yt,{children:e.jsx(w,{level:"title-sm",children:P})}),e.jsx(Tn,{sx:[C?{transform:"rotate(180deg)"}:{transform:"none"}]})]}),children:e.jsx(pt,{sx:{gap:.5},children:Ct[P].map(C=>e.jsx(st,{children:a?e.jsx(ht,{title:C.label,placement:"right",arrow:!0,children:e.jsx(Ne,{selected:L(C.route),onClick:()=>K(C.route,C.value),sx:{justifyContent:"center",px:1,width:"100%"},children:C.icon})}):e.jsxs(Ne,{selected:L(C.route),onClick:()=>K(C.route,C.value),sx:{justifyContent:"flex-start",px:2,width:"100%"},children:[C.icon,e.jsx(yt,{children:e.jsx(w,{level:"body-sm",children:C.label})})]})},C.value))})})},P))})}),e.jsx(S,{sx:{mt:"auto",mb:2},children:e.jsxs(pt,{sx:{p:0},children:[e.jsx(st,{sx:{p:0,alignItems:"stretch"},children:a?e.jsx(ht,{title:"Settings",placement:"right",arrow:!0,children:e.jsx(Ne,{selected:L("/settings"),onClick:()=>K("/settings","settings"),sx:{width:"100%",alignItems:"center",minHeight:40,justifyContent:"center",px:1},children:e.jsx(Ot,{})})}):e.jsxs(Ne,{selected:L("/settings"),onClick:()=>K("/settings","settings"),sx:{width:"100%",alignItems:"center",minHeight:40,justifyContent:"flex-start",px:2},children:[e.jsx(Ot,{sx:{mr:1}}),e.jsx(yt,{sx:{display:"flex",alignItems:"center",p:0},children:e.jsx(w,{level:"body-sm",children:"Settings"})})]})}),e.jsx(st,{sx:{p:0,alignItems:"stretch"},children:a?e.jsx(ht,{title:"Logout",placement:"right",arrow:!0,children:e.jsx(Ne,{onClick:async()=>{await O.auth.signOut(),window.location.href="/login"},sx:{width:"100%",alignItems:"center",minHeight:40,justifyContent:"center",px:1},children:e.jsx(Us,{})})}):e.jsxs(Ne,{onClick:async()=>{await O.auth.signOut(),window.location.href="/login"},sx:{width:"100%",alignItems:"center",minHeight:40,justifyContent:"flex-start",px:2},children:[e.jsx(Us,{sx:{mr:1}}),e.jsx(yt,{sx:{display:"flex",alignItems:"center",p:0},children:e.jsx(w,{level:"body-sm",children:"Logout"})})]})})]})}),e.jsx(ft,{}),e.jsxs(S,{sx:{display:"flex",gap:1,alignItems:"center",minHeight:48},children:[e.jsx(Ee,{variant:"outlined",size:"sm",src:b?.avatar_url||h?.user_metadata?.avatar_url||void 0,onClick:()=>A(!0),sx:{cursor:"pointer"}}),e.jsxs(S,{sx:{minWidth:0,flex:1,cursor:"pointer"},onClick:()=>A(!0),children:[e.jsx(w,{level:"title-sm",children:b?.name||h?.user_metadata?.full_name||h?.email||"Not signed in"}),e.jsx(w,{level:"body-xs",children:b?.email||h?.email||""})]})]}),e.jsx(Wn,{open:k,onClose:()=>A(!1),userProfile:b,editName:_,setEditName:D,editAvatar:I,setEditAvatar:v,onSave:T})]})}function Gn({defaultExpanded:s=!1,renderToggle:t,children:r}){const[i,n]=p.useState(s);return e.jsxs(p.Fragment,{children:[t({open:i,setOpen:n}),e.jsx(S,{sx:{display:"grid",transition:"0.2s ease","& > *":{overflow:"hidden"},gridTemplateRows:i?"1fr":"0fr"},children:r})]})}const Zn=Ps(Jn);function nt({children:s,variant:t="page",padding:r="medium",fullHeight:i=!1,className:n}){He();const o=kr(),l=()=>r==="none"?0:{small:o.itemPadding,medium:o.containerPadding,large:o.sectionPadding}[r]||o.containerPadding,a=()=>{const c={p:l(),boxSizing:"border-box"};switch(t){case"page":return{...c,height:i?"100%":"auto",overflow:"auto",width:"100%"};case"dialog":return{...c,height:"auto",overflow:"visible"};case"form":return{...c,display:"flex",flexDirection:"column",gap:o.mediumGap};case"card":return{...c,borderRadius:1,bgcolor:"background.surface"};default:return c}};return e.jsx(S,{sx:a(),className:n,children:s})}function Dt({open:s,onClose:t,children:r,title:i,size:n="medium",showCloseButton:o=!0,actions:l}){const{getModalSize:a}=Vn();return e.jsx(we,{open:s,onClose:t,children:e.jsxs(ve,{sx:a(n),children:[o&&e.jsx(We,{}),i&&e.jsx(qt,{children:i}),e.jsx(Ft,{children:r}),l&&e.jsx($t,{children:l})]})})}const $e=({children:s})=>e.jsx(S,{sx:{display:"flex",flexDirection:"column",pl:"16px",pr:"6px",pt:"6px",width:"100%",flex:1,minHeight:0,height:"100%",overflow:"hidden",bgcolor:"background.body"},children:s}),Qn=({open:s,creating:t,newOrder:r,setNewOrder:i,onClose:n,onCreate:o})=>{const[l,a]=p.useState([]),[c,d]=p.useState([{id:crypto.randomUUID(),product:null,quantity:1,unitprice:0,discount:0}]),[u,h]=p.useState(!1),[g,b]=p.useState(null),[x,m]=p.useState(null),[y,_]=p.useState(0),[D,I]=p.useState(!1),[v,k]=p.useState(null),[A,T]=p.useState(!1);p.useEffect(()=>{s&&(d([{id:crypto.randomUUID(),product:null,quantity:1,unitprice:0,discount:0}]),b(null),i(P=>({...P,date:P.date||new Date().toISOString().slice(0,10)})))},[s]),p.useEffect(()=>{s&&(h(!0),m(null),O.from("Products").select("*").then(({data:P,error:C})=>{!C&&P?(P.length===0&&m("No products available. Please add products first."),a(P.map(N=>({id:N.uuid||N.id,ProductName:N.ProductName,SalesPrice:N.SalesPrice??0})))):m("Failed to load products. Please try again later."),h(!1)}))},[s]);const U=()=>{d(P=>[...P,{id:crypto.randomUUID(),product:null,quantity:1,unitprice:0,discount:y}])},Q=P=>{d(C=>C.filter((N,E)=>E!==P))},K=(P,C,N)=>{d(E=>E.map(($,he)=>{if(he!==P)return $;if(C==="product"&&N){const Re=l.find(ne=>ne.id===N.id);return{...$,product:N,unitprice:Re?.SalesPrice??0}}return C==="product"&&!N?{...$,product:null,unitprice:0}:{...$,[C]:N}}))},L=P=>{P.preventDefault();const C=c.filter(N=>N.product&&N.product.id&&N.quantity>0).map(N=>({product_uuid:N.product.id,quantity:N.quantity,unitprice:N.unitprice,discount:N.discount}));if(C.length===0){b("Please add at least one valid order item.");return}b(null),o(C,y)};return e.jsx(we,{open:s,onClose:n,"aria-labelledby":"create-order-modal",children:e.jsxs(ve,{"aria-labelledby":"create-order-modal",sx:{maxWidth:600,width:"100%",minWidth:{xs:300,sm:400}},children:[e.jsx(We,{}),e.jsx(w,{id:"create-order-modal",level:"h4",sx:{mb:2},children:"Create Order"}),e.jsxs("form",{onSubmit:L,children:[e.jsxs(X,{sx:{mb:2},required:!0,children:[e.jsx(Y,{children:"Date"}),e.jsx(F,{type:"date",value:r.date,onChange:P=>i(C=>({...C,date:P.target.value})),required:!0})]}),e.jsxs(X,{sx:{mb:2},required:!0,children:[e.jsx(Y,{children:"Status"}),e.jsxs(le,{value:r.status,onChange:(P,C)=>i(N=>({...N,status:C||"Paid"})),children:[e.jsx(M,{value:"Paid",children:"Paid"}),e.jsx(M,{value:"Refunded",children:"Refunded"}),e.jsx(M,{value:"Cancelled",children:"Cancelled"})]})]}),e.jsxs(X,{sx:{mb:2},required:!0,children:[e.jsx(Y,{children:"Customer Name"}),e.jsx(F,{value:r.customer_name,onChange:P=>i(C=>({...C,customer_name:P.target.value})),required:!0})]}),e.jsxs(X,{sx:{mb:2},required:!0,children:[e.jsx(Y,{children:"Customer Email"}),e.jsx(F,{type:"email",value:r.customer_email,onChange:P=>i(C=>({...C,customer_email:P.target.value})),required:!0})]}),e.jsxs(X,{sx:{mb:2},required:!0,children:[e.jsx(Y,{children:"Order Discount (%)"}),e.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(F,{type:"number",value:y,disabled:c.length>0&&!(c.length===1&&!c[0].product),onChange:P=>{const C=Math.max(0,Math.min(100,Math.floor(Number(P.target.value))));_(C),d(N=>N.map(E=>({...E,discount:C})))},slotProps:{input:{min:0,max:100,step:1}},required:!0,placeholder:"Order Discount %",sx:{flex:1}}),(c.length>1||c.length===1&&c[0].product)&&e.jsx(q,{size:"sm",variant:"outlined",onClick:()=>I(!0),children:"Edit"})]})]}),g&&e.jsx(w,{color:"danger",sx:{mb:1},children:g}),e.jsx(ft,{sx:{my:2}}),e.jsx(S,{sx:{mb:1,fontWeight:"lg",fontSize:"lg"},children:"Order Items"}),x&&e.jsx(w,{color:"danger",sx:{mb:1},children:x}),c.map((P,C)=>e.jsxs(S,{sx:{display:"flex",gap:1,alignItems:"center",mb:1},children:[e.jsx(bs,{options:l,getOptionLabel:N=>N.ProductName,isOptionEqualToValue:(N,E)=>N.id===E.id,value:P.product,onChange:(N,E)=>K(C,"product",E),loading:u,placeholder:u?"Loading...":"Search product",sx:{minWidth:220},disabled:l.length===0,required:!0,renderOption:(N,E)=>e.jsx("li",{...N,children:E.ProductName})}),e.jsx(F,{type:"number",value:P.quantity,onChange:N=>K(C,"quantity",Math.max(1,Number(N.target.value))),sx:{width:80},required:!0,slotProps:{input:{min:1}}}),e.jsx(F,{type:"number",value:P.unitprice,onChange:N=>K(C,"unitprice",Math.max(0,Number(N.target.value))),sx:{width:100},required:!0,slotProps:{input:{min:0,step:.01}},placeholder:"Unit Price"}),e.jsx(F,{type:"number",value:P.discount,onChange:N=>K(C,"discount",Math.max(0,Math.min(100,Math.floor(Number(N.target.value))))),sx:{width:80},required:!0,slotProps:{input:{min:0,max:100,step:1}},placeholder:"Discount %"}),e.jsx(oe,{size:"sm",color:"danger",onClick:()=>Q(C),disabled:c.length===1,children:e.jsx(is,{})})]},P.id)),e.jsx(q,{startDecorator:e.jsx(qe,{}),variant:"soft",size:"sm",onClick:U,sx:{mb:2},disabled:!!x,children:"Add Item"}),e.jsx(we,{open:D,onClose:()=>I(!1),children:e.jsxs(ve,{sx:{minWidth:350},children:[e.jsx(w,{level:"title-md",sx:{mb:1},children:"Change Order Discount"}),e.jsxs(X,{sx:{mb:2},required:!0,children:[e.jsx(Y,{children:"Change discount to (%)"}),e.jsx(F,{type:"number",value:v??y,onChange:P=>k(Math.max(0,Math.min(100,Math.floor(Number(P.target.value))))),slotProps:{input:{min:0,max:100,step:1}},required:!0,autoFocus:!0})]}),e.jsx(w,{sx:{mb:2},children:"How do you want to apply the new order discount?"}),e.jsxs(S,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[e.jsx(q,{onClick:()=>{_(v),d(P=>P.map(C=>({...C,discount:v}))),I(!1),k(null)},children:"Overwrite all"}),e.jsx(q,{onClick:()=>{_(v),d(P=>P.map(C=>C.discount<v?{...C,discount:v}:C)),I(!1),k(null)},children:"Set discount on lower"}),e.jsx(q,{variant:"plain",onClick:()=>{I(!1),k(null)},children:"Cancel"})]})]})}),e.jsxs(S,{sx:{display:"flex",gap:2,mt:2},children:[e.jsx(q,{type:"submit",loading:t,color:"primary",disabled:!!x,children:"Create"}),e.jsx(q,{variant:"plain",onClick:n,disabled:t,children:"Cancel"})]})]})]})})};function Kn({open:s,onClose:t,selectedOrder:r,fetchOrderItems:i}){const[n,o]=p.useState([]),[l,a]=p.useState(!1);return p.useEffect(()=>{async function c(){if(r){a(!0);const d=await i(r.uuid);o(d),a(!1)}else o([])}s&&r?c():o([])},[s,r,i]),e.jsx(we,{open:s,onClose:t,"aria-labelledby":"order-details-modal",children:e.jsxs(ve,{"aria-labelledby":"order-details-modal",sx:{maxWidth:600,width:"100%"},children:[e.jsx(We,{}),e.jsx(w,{id:"order-details-modal",level:"title-md",fontWeight:"lg",sx:{mb:2},children:"Order Details"}),r&&e.jsxs(S,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(S,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(w,{level:"body-sm",sx:{color:"text.secondary"},children:["Order ID: ",r.uuid]}),e.jsxs(w,{level:"body-sm",sx:{color:"text.secondary"},children:["Date: ",new Date(r.date).toLocaleString()]}),e.jsxs(w,{level:"body-sm",sx:{color:"text.secondary"},children:["Status: ",r.status]})]}),e.jsx(ft,{}),e.jsxs(S,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(w,{level:"body-sm",fontWeight:"md",children:"Customer Information"}),e.jsxs(w,{level:"body-sm",sx:{color:"text.secondary"},children:["Name: ",r.customer.name]}),e.jsxs(w,{level:"body-sm",sx:{color:"text.secondary"},children:["Email: ",r.customer.email]})]}),e.jsx(ft,{}),e.jsxs(S,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(w,{level:"body-sm",fontWeight:"md",children:"Ordered Items"}),l?e.jsx(w,{level:"body-sm",sx:{color:"text.secondary"},children:"Loading items..."}):e.jsxs(Te,{size:"sm",sx:{minWidth:500},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{style:{textAlign:"right"},children:"Quantity"}),e.jsx("th",{style:{textAlign:"right"},children:"Unit Price"}),e.jsx("th",{style:{textAlign:"right"},children:"Discount (%)"}),e.jsx("th",{style:{textAlign:"right"},children:"Total Price"})]})}),e.jsx("tbody",{children:n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{textAlign:"center",padding:"16px"},children:e.jsx(w,{level:"body-sm",sx:{color:"text.secondary"},children:"No items found for this order."})})}):n.map(function(c){return e.jsxs("tr",{children:[e.jsx("td",{children:c.name||c.product_uuid}),e.jsx("td",{style:{textAlign:"right"},children:c.quantity??"-"}),e.jsx("td",{style:{textAlign:"right"},children:c.unitprice!=null?`$${Number(c.unitprice).toFixed(2)}`:"-"}),e.jsx("td",{style:{textAlign:"right"},children:c.discount!=null?`${Number(c.discount).toFixed(2)}%`:"-"}),e.jsx("td",{style:{textAlign:"right"},children:c.price!=null?`$${Number(c.price).toFixed(2)}`:"-"})]},c.uuid)})})]})]})]})]})})}const ee={sizes:{small:"0.875rem",xlarge:"1.5rem"}},ge={fontSize:ee.sizes.small},Xn=()=>{const{isMobile:s}=He(),[t,r]=p.useState([]),[i,n]=p.useState(!1),[o,l]=p.useState(""),[a,c]=p.useState(""),[d,u]=p.useState(""),[h,g]=p.useState(""),[b,x]=p.useState(!1),[m,y]=p.useState(!1),[_,D]=p.useState(!1),[I,v]=p.useState(null),[k,A]=p.useState(!1),[T,U]=p.useState({date:new Date().toISOString().split("T")[0],status:"Paid",customer_name:"",customer_email:""}),[Q,K]=p.useState(!1),[L,P]=p.useState(""),[C,N]=p.useState("success"),E=(f,z="success")=>{P(f),N(z),K(!0)},$=f=>{switch(f){case"Paid":return"success";case"Refunded":return"warning";case"Cancelled":return"danger";default:return"neutral"}},he=f=>{switch(f){case"Paid":return e.jsx(Ws,{});case"Refunded":return e.jsx(Ws,{});case"Cancelled":return e.jsx(Bs,{});default:return e.jsx(Bs,{})}},Re=f=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(f),ne=async()=>{n(!0);try{const{data:f,error:z}=await O.from("Orders").select("*");if(z){console.error("Error fetching orders:",z),E("Failed to fetch orders","danger");return}if(f){const Z=f.map(H=>({uuid:H.uuid,date:H.date||H.created_at||H["Created at"]||"",status:H.status||"Paid",customer:H.customer||{initial:H.customer_initial||(H.customer_name?H.customer_name[0]:"?"),name:H.customer_name||"Unknown",email:H.customer_email||""},order_number_display:H.order_number_display,order_total:typeof H.order_total=="number"?H.order_total:0,created_by:H.created_by||"",created_by_name:H.created_by_name||"",created_by_email:H.created_by_email||"",category:H.category||"purchase"})).sort((H,te)=>{const se=new Date(H.date||0);return new Date(te.date||0).getTime()-se.getTime()});r(Z)}}catch(f){console.error("Error fetching orders:",f),E("Failed to fetch orders","danger")}finally{n(!1)}},je=async f=>{try{const{data:z,error:Z}=await O.from("OrderItems").select("*, Products:product_uuid(ProductName)").eq("order_uuid",f);return Z?(console.error("Error fetching order items:",Z),[]):z?.map(H=>({...H,product_name:H.Products?.ProductName||H.product_uuid}))||[]}catch(z){return console.error("Error fetching order items:",z),[]}};p.useEffect(()=>{ne()},[]);const Le=t.filter(f=>{const z=!o||f.order_number_display?.toString().toLowerCase().includes(o.toLowerCase())||f.customer.name.toLowerCase().includes(o.toLowerCase())||f.customer.email.toLowerCase().includes(o.toLowerCase()),Z=!a||f.status===a,H=!d||f.category===d,te=!h||f.customer.name===h;return z&&Z&&H&&te}),Ve=Array.from(new Set(t.map(f=>f.status))),lt=Array.from(new Set(t.map(f=>f.category||"purchase"))),Ue=Array.from(new Set(t.map(f=>f.customer.name))),Ce=f=>{const z=t.find(Z=>Z.uuid===f||Z.order_number_display===f);z&&(v(z),D(!0))},Ye=()=>{y(!0)},et=async(f,z)=>{A(!0);try{const{data:Z,error:H}=await O.from("Orders").insert({date:T.date,status:T.status,customer_name:T.customer_name,customer_email:T.customer_email,order_total:f.reduce((te,se)=>te+se.quantity*se.unitprice*(1-se.discount/100),0)-z}).select().single();if(H){console.error("Error creating order:",H),E("Failed to create order","danger");return}if(f.length>0){const{error:te}=await O.from("OrderItems").insert(f.map(se=>({order_uuid:Z.uuid,product_uuid:se.product_uuid,quantity:se.quantity,unitprice:se.unitprice,discount_percent:se.discount})));te&&(console.error("Error creating order items:",te),E("Order created but failed to add items","warning"))}E("Order created successfully","success"),y(!1),U({date:new Date().toISOString().split("T")[0],status:"Paid",customer_name:"",customer_email:""}),ne()}catch(Z){console.error("Error creating order:",Z),E("Failed to create order","danger")}finally{A(!1)}},tt=()=>{x(!1)},R=()=>{c(""),u(""),g("")},W=()=>e.jsxs(S,{sx:{pb:2},children:[e.jsxs(nt,{variant:"page",padding:"medium",children:[e.jsxs(S,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(F,{placeholder:"Search orders...",value:o,onChange:f=>l(f.target.value),startDecorator:e.jsx(Fe,{}),sx:{flex:1,fontSize:"16px"}}),e.jsx(oe,{variant:"soft",onClick:()=>x(!0),sx:{flexShrink:0},children:e.jsx(ks,{})})]}),(a||d||h)&&e.jsxs(S,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:[a&&e.jsxs(ie,{size:"sm",variant:"soft",color:"primary",children:["Status: ",a]}),d&&e.jsxs(ie,{size:"sm",variant:"soft",color:"primary",children:["Category: ",d]}),h&&e.jsxs(ie,{size:"sm",variant:"soft",color:"primary",children:["Customer: ",h]})]}),i&&e.jsx(Ze,{sx:{mb:2}})]}),e.jsx(S,{children:Le.length===0?e.jsx(S,{sx:{textAlign:"center",py:6},children:e.jsx(w,{color:"neutral",children:i?"Loading orders...":"No orders found"})}):Le.map(f=>e.jsx(S,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider",cursor:"pointer","&:hover":{bgcolor:"background.level1"}},onClick:()=>Ce(f.uuid),children:e.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(S,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${$(f.status)}.100`,color:`${$(f.status)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",flexShrink:0},children:he(f.status)}),e.jsxs(S,{sx:{flex:1,minWidth:0},children:[e.jsxs(S,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsxs(w,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:["Order #",f.order_number_display||f.uuid.substring(0,8)]}),e.jsx(ie,{size:"sm",color:$(f.status),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content"},children:f.status})]}),e.jsxs(w,{level:"body-xs",color:"neutral",sx:{mb:.5},children:[f.customer.name," • ",new Date(f.date).toLocaleDateString()]}),f.order_total&&e.jsx(w,{level:"body-xs",sx:{fontWeight:"bold",color:"primary.600"},children:Re(f.order_total)})]})]})},f.uuid))}),e.jsx(oe,{color:"primary",variant:"soft",size:"sm",sx:{position:"fixed",bottom:80,right:16,zIndex:1e3,borderRadius:"8px",width:40,height:40,boxShadow:"sm",bgcolor:"primary.100","&:hover":{bgcolor:"primary.200",boxShadow:"md"}},onClick:Ye,children:e.jsx(qe,{fontSize:"small"})})]}),pe=()=>e.jsxs(nt,{variant:"page",padding:"large",children:[e.jsx(w,{level:"h2",sx:{mb:2,fontSize:ee.sizes.xlarge},children:"Orders"}),e.jsxs(S,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(F,{placeholder:"Search orders...",sx:{flex:1,fontSize:ee.sizes.small},value:o,onChange:f=>l(f.target.value),startDecorator:e.jsx(Fe,{})}),e.jsxs(le,{placeholder:"Filter status",value:a,onChange:(f,z)=>c(z||""),sx:{minWidth:160,fontSize:ee.sizes.small},children:[e.jsx(M,{value:"",children:"All Statuses"}),Ve.map(f=>e.jsx(M,{value:f,children:f},f))]}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(qe,{}),onClick:Ye,sx:{fontSize:ee.sizes.small},children:"Create Order"})]}),e.jsxs(Pe,{children:[i&&e.jsx(Ze,{}),e.jsxs(Te,{"aria-label":"Orders",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:ge,children:"Order #"}),e.jsx("th",{style:ge,children:"Date"}),e.jsx("th",{style:ge,children:"Customer"}),e.jsx("th",{style:ge,children:"Status"}),e.jsx("th",{style:ge,children:"Total"}),e.jsx("th",{style:ge,children:"Actions"})]})}),e.jsxs("tbody",{children:[Le.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{textAlign:"center",color:"#888",...ge},children:i?"Loading orders...":"No orders found."})}),Le.map(f=>e.jsxs("tr",{style:{cursor:"pointer"},children:[e.jsx("td",{style:ge,children:f.order_number_display||f.uuid.substring(0,8)}),e.jsx("td",{style:ge,children:new Date(f.date).toLocaleDateString()}),e.jsx("td",{style:ge,children:e.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(S,{sx:{width:24,height:24,borderRadius:"50%",bgcolor:"primary.100",color:"primary.600",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold"},children:f.customer.initial}),e.jsxs(S,{children:[e.jsx(w,{level:"body-sm",sx:{fontWeight:"bold"},children:f.customer.name}),e.jsx(w,{level:"body-xs",color:"neutral",children:f.customer.email})]})]})}),e.jsx("td",{style:ge,children:e.jsx(ie,{size:"sm",variant:"soft",color:$(f.status),children:f.status})}),e.jsx("td",{style:ge,children:e.jsx(w,{level:"body-sm",sx:{fontWeight:"bold"},children:f.order_total?Re(f.order_total):"N/A"})}),e.jsx("td",{style:ge,children:e.jsx(q,{size:"sm",variant:"soft",onClick:()=>Ce(f.uuid),children:"View"})})]},f.uuid))]})]})]})]});return e.jsxs($e,{children:[s?e.jsx(W,{}):e.jsx(pe,{}),e.jsx(Qn,{open:m,creating:k,newOrder:T,setNewOrder:U,onClose:()=>y(!1),onCreate:et}),e.jsx(Kn,{open:_,onClose:()=>D(!1),selectedOrder:I,fetchOrderItems:je}),s&&e.jsx(Dt,{open:b,onClose:tt,title:"Filter Orders",size:"medium",actions:e.jsxs(S,{sx:{display:"flex",gap:2},children:[e.jsx(q,{variant:"plain",onClick:R,sx:ge,children:"Clear All"}),e.jsx(q,{variant:"solid",onClick:tt,sx:ge,children:"Apply"})]}),children:e.jsxs(ke,{spacing:2,children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Status"}),e.jsxs(le,{placeholder:"All statuses",value:a,onChange:(f,z)=>c(z||""),children:[e.jsx(M,{value:"",children:"All Statuses"}),Ve.map(f=>e.jsx(M,{value:f,children:f},f))]})]}),e.jsxs(X,{children:[e.jsx(Y,{children:"Category"}),e.jsxs(le,{placeholder:"All categories",value:d,onChange:(f,z)=>u(z||""),children:[e.jsx(M,{value:"",children:"All Categories"}),lt.map(f=>e.jsx(M,{value:f,children:f},f))]})]}),e.jsxs(X,{children:[e.jsx(Y,{children:"Customer"}),e.jsxs(le,{placeholder:"All customers",value:h,onChange:(f,z)=>g(z||""),children:[e.jsx(M,{value:"",children:"All Customers"}),Ue.map(f=>e.jsx(M,{value:f,children:f},f))]})]})]})}),e.jsx(Ut,{open:Q,onClose:()=>K(!1),autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{top:16,zIndex:2e3},children:e.jsx(js,{color:C,variant:"solid",sx:{width:"100%"},children:L})})]})};function Yn({open:s,onClose:t,product:r,onSave:i}){const[n,o]=p.useState({ProductName:r?.ProductName||"",SalesPrice:r?.SalesPrice?.toString()||"",CostPrice:r?.CostPrice?.toString()||""}),[l,a]=p.useState(!1);p.useEffect(()=>{o({ProductName:r?.ProductName||"",SalesPrice:r?.SalesPrice?.toString()||"",CostPrice:r?.CostPrice?.toString()||""})},[r]);const c=async()=>{a(!0),await i(n),a(!1)};return e.jsx(we,{open:s,onClose:t,"aria-labelledby":"product-table-form-title",children:e.jsxs(ve,{children:[e.jsx(qt,{id:"product-table-form-title",children:r?"Edit Product":"Add Product"}),e.jsxs(Ft,{children:[e.jsx(F,{name:"ProductName",value:n.ProductName,onChange:d=>o({...n,ProductName:d.target.value}),placeholder:"Product Name",sx:{mb:2}}),e.jsx(F,{name:"SalesPrice",value:n.SalesPrice,onChange:d=>o({...n,SalesPrice:d.target.value}),placeholder:"Sales Price",type:"number",sx:{mb:2}}),e.jsx(F,{name:"CostPrice",value:n.CostPrice,onChange:d=>o({...n,CostPrice:d.target.value}),placeholder:"Cost Price",type:"number"})]}),e.jsxs($t,{children:[e.jsx(q,{onClick:t,variant:"plain",disabled:l,children:"Cancel"}),e.jsx(q,{onClick:c,variant:"solid",loading:l,disabled:l,children:"Save"})]})]})})}const Js=Ps(Yn),ae={fontSize:ee.sizes.small},ei=()=>{const{isMobile:s}=He(),[t,r]=p.useState([]),[i,n]=p.useState({}),[o,l]=p.useState(!1),[a,c]=p.useState(!1),[d,u]=p.useState(!1),[h,g]=p.useState(""),[b,x]=p.useState(""),[m,y]=p.useState(!1),[_,D]=p.useState(!1),[I,v]=p.useState(!1),[k,A]=p.useState(null),[T,U]=p.useState(!1),[Q,K]=p.useState(""),[L,P]=p.useState("success"),C=(R,W="success")=>{K(R),P(W),U(!0)},N=R=>R<=0?{status:"Out of Stock",color:"danger"}:R<=10?{status:"Low Stock",color:"warning"}:{status:"In Stock",color:"success"},E=R=>{const W=N(R);return e.jsx(S,{sx:{width:20,height:20,borderRadius:"50%",bgcolor:`${W.color}.100`,color:`${W.color}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold"},children:e.jsx(vs,{sx:{fontSize:"12px"}})})},$=R=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(R),he=async()=>{l(!0);try{const{data:R,error:W}=await O.from("Products").select("*").order("CreatedAt",{ascending:!1});if(W){console.error("Error fetching products:",W),C("Failed to fetch products","danger");return}R&&(r(R),await Re(R))}catch(R){console.error("Error fetching products:",R),C("Failed to fetch products","danger")}finally{l(!1)}},Re=async R=>{c(!0);try{const{data:W,error:pe}=await O.from("stock_movements").select("product_id, movement_type, quantity");if(pe){console.error("Error fetching stock data:",pe);return}if(W){const f={};R.forEach(z=>{const H=W.filter(te=>te.product_id===z.uuid).reduce((te,se)=>{switch(se.movement_type){case"incoming":case"adjustment":return te+(se.quantity||0);case"outgoing":return te-(se.quantity||0);default:return te}},0);f[z.uuid]=H}),n(f)}}catch(W){console.error("Error fetching stock levels:",W)}finally{c(!1)}};p.useEffect(()=>{he()},[]);const ne=t.filter(R=>{const W=!h||R.ProductName.toLowerCase().includes(h.toLowerCase())||R.ProductID?.toLowerCase().includes(h.toLowerCase()),pe=i[R.uuid]||0,f=!b||b==="in-stock"&&pe>10||b==="low-stock"&&pe>0&&pe<=10||b==="out-of-stock"&&pe<=0;return W&&f}),je=()=>{D(!0)},Le=R=>{A(R),v(!0)},Ve=async R=>{if(confirm("Are you sure you want to delete this product?")){u(!0);try{const{error:W}=await O.from("Products").delete().eq("uuid",R);if(W){console.error("Error deleting product:",W),C("Failed to delete product","danger");return}r(t.filter(pe=>pe.uuid!==R)),C("Product deleted successfully","success")}catch(W){console.error("Error deleting product:",W),C("Failed to delete product","danger")}finally{u(!1)}}},lt=async R=>{u(!0);try{const{data:W,error:pe}=await O.from("Products").insert([{ProductName:R.ProductName,SalesPrice:parseFloat(R.SalesPrice),CostPrice:parseFloat(R.CostPrice),CreatedAt:new Date().toISOString()}]).select().single();if(pe){console.error("Error adding product:",pe),C("Failed to add product","danger");return}C("Product added successfully","success"),D(!1),he()}catch(W){console.error("Error adding product:",W),C("Failed to add product","danger")}finally{u(!1)}},Ue=async R=>{if(k){u(!0);try{const{error:W}=await O.from("Products").update({ProductName:R.ProductName,SalesPrice:parseFloat(R.SalesPrice),CostPrice:parseFloat(R.CostPrice)}).eq("uuid",k.uuid);if(W){console.error("Error updating product:",W),C("Failed to update product","danger");return}C("Product updated successfully","success"),v(!1),A(null),he()}catch(W){console.error("Error updating product:",W),C("Failed to update product","danger")}finally{u(!1)}}},Ce=()=>{y(!1)},Ye=()=>{x("")},et=()=>e.jsxs(S,{sx:{pb:2},children:[e.jsxs(nt,{variant:"page",padding:"medium",children:[e.jsxs(S,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(F,{placeholder:"Search products...",value:h,onChange:R=>g(R.target.value),startDecorator:e.jsx(Fe,{}),sx:{flex:1,fontSize:"16px"}}),e.jsx(oe,{variant:"soft",onClick:()=>y(!0),sx:{flexShrink:0},children:e.jsx(ks,{})})]}),b&&e.jsx(S,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:e.jsxs(ie,{size:"sm",variant:"soft",color:"primary",children:["Stock: ",b.replace("-"," ")]})}),o&&e.jsx(Ze,{sx:{mb:2}})]}),e.jsx(S,{children:ne.length===0?e.jsx(S,{sx:{textAlign:"center",py:6},children:e.jsx(w,{color:"neutral",children:o?"Loading products...":"No products found"})}):ne.map(R=>e.jsx(S,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(S,{sx:{flexShrink:0},children:R.ImageUrl?e.jsx(Ee,{src:R.ImageUrl,sx:{width:48,height:48},alt:R.ProductName}):e.jsx(Ee,{sx:{width:48,height:48,bgcolor:"neutral.100"},children:e.jsx(Hs,{})})}),e.jsxs(S,{sx:{flex:1,minWidth:0},children:[e.jsxs(S,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(w,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:R.ProductName}),e.jsx(S,{sx:{display:"flex",alignItems:"center",gap:1},children:a?e.jsx(w,{level:"body-xs",color:"neutral",children:"..."}):e.jsxs(e.Fragment,{children:[E(i[R.uuid]||0),e.jsx(ie,{size:"sm",color:N(i[R.uuid]||0).color,variant:"soft",sx:{fontSize:"10px",minWidth:"fit-content"},children:i[R.uuid]||0})]})})]}),e.jsxs(w,{level:"body-xs",color:"neutral",sx:{mb:.5},children:["ID: ",R.ProductID||"N/A"," • ",new Date(R.CreatedAt).toLocaleDateString()]}),e.jsxs(S,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(S,{children:[e.jsxs(w,{level:"body-xs",sx:{fontWeight:"bold",color:"success.600"},children:["Sale: ",$(R.SalesPrice)]}),e.jsxs(w,{level:"body-xs",color:"neutral",children:["Cost: ",$(R.CostPrice)]})]}),e.jsxs(S,{sx:{display:"flex",gap:.5},children:[e.jsx(oe,{size:"sm",variant:"soft",color:"primary",onClick:()=>Le(R),children:e.jsx(os,{})}),e.jsx(oe,{size:"sm",variant:"soft",color:"danger",onClick:()=>Ve(R.uuid),disabled:d,children:e.jsx(is,{})})]})]})]})]})},R.uuid))}),e.jsx(oe,{color:"primary",variant:"soft",size:"sm",sx:{position:"fixed",bottom:80,right:16,zIndex:1e3,borderRadius:"8px",width:40,height:40,boxShadow:"sm",bgcolor:"primary.100","&:hover":{bgcolor:"primary.200",boxShadow:"md"}},onClick:je,children:e.jsx(qe,{fontSize:"small"})})]}),tt=()=>e.jsxs(nt,{variant:"page",padding:"large",children:[e.jsx(w,{level:"h2",sx:{mb:2,fontSize:ee.sizes.xlarge},children:"Products"}),e.jsxs(S,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(F,{placeholder:"Search products...",sx:{flex:1,fontSize:ee.sizes.small},value:h,onChange:R=>g(R.target.value),startDecorator:e.jsx(Fe,{})}),e.jsxs(le,{placeholder:"Filter by stock",value:b,onChange:(R,W)=>x(W||""),sx:{minWidth:160,fontSize:ee.sizes.small},children:[e.jsx(M,{value:"",children:"All Stock Levels"}),e.jsx(M,{value:"in-stock",children:"In Stock"}),e.jsx(M,{value:"low-stock",children:"Low Stock"}),e.jsx(M,{value:"out-of-stock",children:"Out of Stock"})]}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(qe,{}),onClick:je,sx:{fontSize:ee.sizes.small},children:"Add Product"})]}),e.jsxs(Pe,{children:[o&&e.jsx(Ze,{}),e.jsxs(Te,{"aria-label":"Products",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:ae,children:"Image"}),e.jsx("th",{style:ae,children:"Name"}),e.jsx("th",{style:ae,children:"Stock"}),e.jsx("th",{style:ae,children:"Sales Price"}),e.jsx("th",{style:ae,children:"Cost Price"}),e.jsx("th",{style:ae,children:"Created"}),e.jsx("th",{style:ae,children:"Actions"})]})}),e.jsxs("tbody",{children:[ne.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...ae},children:o?"Loading products...":"No products found."})}),ne.map(R=>e.jsxs("tr",{children:[e.jsx("td",{style:ae,children:R.ImageUrl?e.jsx(Ee,{src:R.ImageUrl,sx:{width:32,height:32},alt:R.ProductName}):e.jsx(Ee,{sx:{width:32,height:32,bgcolor:"neutral.100"},children:e.jsx(Hs,{sx:{fontSize:"16px"}})})}),e.jsx("td",{style:ae,children:e.jsxs(S,{children:[e.jsx(w,{level:"body-sm",sx:{fontWeight:"bold"},children:R.ProductName}),e.jsxs(w,{level:"body-xs",color:"neutral",children:["ID: ",R.ProductID||"N/A"]})]})}),e.jsx("td",{style:ae,children:a?e.jsx(w,{level:"body-sm",sx:{color:"neutral.500"},children:"Loading..."}):e.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ie,{size:"sm",variant:"soft",color:N(i[R.uuid]||0).color,children:N(i[R.uuid]||0).status}),e.jsx(ht,{title:`Current stock level: ${i[R.uuid]||0} units`,arrow:!0,children:e.jsx(w,{level:"body-sm",sx:{fontWeight:"bold",color:N(i[R.uuid]||0).color==="danger"?"danger.500":N(i[R.uuid]||0).color==="warning"?"warning.600":"success.600"},children:i[R.uuid]||0})}),e.jsx(S,{sx:{width:40,height:4,bgcolor:"neutral.200",borderRadius:2,overflow:"hidden"},children:e.jsx(S,{sx:{width:`${Math.min(100,Math.max(0,(i[R.uuid]||0)/50*100))}%`,height:"100%",bgcolor:N(i[R.uuid]||0).color==="danger"?"danger.400":N(i[R.uuid]||0).color==="warning"?"warning.400":"success.400",borderRadius:2}})})]})}),e.jsx("td",{style:ae,children:e.jsx(w,{level:"body-sm",sx:{fontWeight:"bold",color:"success.600"},children:$(R.SalesPrice)})}),e.jsx("td",{style:ae,children:e.jsx(w,{level:"body-sm",color:"neutral",children:$(R.CostPrice)})}),e.jsx("td",{style:ae,children:new Date(R.CreatedAt).toLocaleDateString()}),e.jsx("td",{style:ae,children:e.jsxs(S,{sx:{display:"flex",gap:.5},children:[e.jsx(oe,{size:"sm",variant:"soft",color:"primary",onClick:()=>Le(R),children:e.jsx(os,{})}),e.jsx(oe,{size:"sm",variant:"soft",color:"danger",onClick:()=>Ve(R.uuid),disabled:d,children:e.jsx(is,{})})]})})]},R.uuid))]})]})]})]});return e.jsxs($e,{children:[s?e.jsx(et,{}):e.jsx(tt,{}),e.jsx(Js,{open:_,onClose:()=>D(!1),product:null,onSave:lt}),e.jsx(Js,{open:I,onClose:()=>{v(!1),A(null)},product:k,onSave:Ue}),s&&e.jsx(Dt,{open:m,onClose:Ce,title:"Filter Products",size:"medium",actions:e.jsxs(S,{sx:{display:"flex",gap:2},children:[e.jsx(q,{variant:"plain",onClick:Ye,sx:ae,children:"Clear All"}),e.jsx(q,{variant:"solid",onClick:Ce,sx:ae,children:"Apply"})]}),children:e.jsx(ke,{spacing:2,children:e.jsxs(X,{children:[e.jsx(Y,{children:"Stock Level"}),e.jsxs(le,{placeholder:"All stock levels",value:b,onChange:(R,W)=>x(W||""),children:[e.jsx(M,{value:"",children:"All Stock Levels"}),e.jsx(M,{value:"in-stock",children:"In Stock"}),e.jsx(M,{value:"low-stock",children:"Low Stock"}),e.jsx(M,{value:"out-of-stock",children:"Out of Stock"})]})]})})}),e.jsx(Ut,{open:T,onClose:()=>U(!1),autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{top:16,zIndex:2e3},children:e.jsx(js,{color:L,variant:"solid",sx:{width:"100%"},children:Q})})]})},ce={fontSize:ee.sizes.small};function ti(){return e.jsxs(mn,{children:[e.jsx(gn,{slots:{root:oe},slotProps:{root:{variant:"plain",color:"neutral",size:"sm"}},children:e.jsx(Ln,{})}),e.jsxs(bn,{size:"sm",sx:{minWidth:140},children:[e.jsx(St,{children:"Edit"}),e.jsx(St,{children:"Reset Password"}),e.jsx(St,{children:"Disable"}),e.jsx(St,{color:"danger",children:"Delete"})]})]})}function si({users:s}){const[t,r]=p.useState(""),[i,n]=p.useState("all"),[o,l]=p.useState(!1),a=Be("(max-width:600px)"),c=Array.from(new Set(s.map(u=>u.role).filter(Boolean))),d=s.filter(u=>{const h=u.name?.toLowerCase().includes(t.toLowerCase())||u.email.toLowerCase().includes(t.toLowerCase()),g=i==="all"||u.role===i;return h&&g});return a?e.jsxs(S,{sx:{p:2},children:[e.jsx(w,{level:"h2",sx:{mb:2,fontSize:ee.sizes.xlarge},children:"Users"}),e.jsx(w,{children:"Mobile view not implemented."})]}):e.jsx($e,{children:e.jsxs(S,{sx:{width:"100%",minHeight:"100dvh",bgcolor:"background.body",borderRadius:2,boxShadow:2,pl:0,pr:0},children:[e.jsx(w,{level:"h2",sx:{mb:2,textAlign:"left",fontSize:"xlarge"},children:"Users"}),e.jsxs(S,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(F,{placeholder:"Search users...",sx:{flex:1,...ce},value:t,onChange:u=>r(u.target.value),startDecorator:e.jsx(Fe,{})}),e.jsxs(le,{placeholder:"Filter role",value:i,onChange:(u,h)=>n(h??"all"),sx:{minWidth:160,...ce},children:[e.jsx(M,{value:"all",children:"All Roles"}),c.map(u=>e.jsx(M,{value:u,children:u},u))]}),e.jsx(q,{onClick:()=>l(!0),variant:"solid",sx:ce,children:"Create User"})]}),e.jsx(Pe,{children:e.jsxs(Te,{"aria-label":"Users",sx:{minWidth:800},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:ce,children:"Name"}),e.jsx("th",{style:ce,children:"Email"}),e.jsx("th",{style:ce,children:"Role"}),e.jsx("th",{style:ce,children:"Created At"}),e.jsx("th",{style:ce,children:"Last Login"}),e.jsx("th",{style:ce,children:"Phone"}),e.jsx("th",{style:{width:120}})]})}),e.jsxs("tbody",{children:[d.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...ce},children:"No users found."})}),d.map(u=>e.jsxs("tr",{style:{cursor:"pointer"},children:[e.jsx("td",{style:ce,children:e.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ee,{size:"sm",children:u.name?u.name[0]:"?"}),e.jsx("div",{children:e.jsx(w,{level:"body-xs",fontWeight:"md",sx:ce,children:u.name||"Unknown"})})]})}),e.jsx("td",{style:ce,children:u.email}),e.jsx("td",{style:ce,children:u.role||"-"}),e.jsx("td",{style:ce,children:u.created_at?new Date(u.created_at).toLocaleString():"-"}),e.jsx("td",{style:ce,children:u.last_login?new Date(u.last_login).toLocaleString():"-"}),e.jsx("td",{style:ce,children:u.phone||"-"}),e.jsx("td",{children:e.jsx(ti,{})})]},u.id))]})]})}),e.jsx(we,{open:o,onClose:()=>l(!1),"aria-labelledby":"create-user-modal",children:e.jsxs(ve,{"aria-labelledby":"create-user-modal",sx:{maxWidth:600,width:"100%"},children:[e.jsx(We,{}),e.jsx(w,{id:"create-user-modal",level:"title-md",fontWeight:"lg",sx:{mb:2},children:"Create User"}),e.jsx(w,{children:"Form not implemented."})]})})]})})}const Cr=({items:s,renderItem:t,ariaLabel:r})=>e.jsx(S,{children:e.jsx(pt,{"aria-label":r,children:s.map((i,n)=>e.jsxs(p.Fragment,{children:[" ",e.jsx(st,{children:t(i)}),n<s.length-1&&e.jsx(xr,{})," "]},n))})}),ri=({users:s})=>{Bt();const t=r=>e.jsxs("div",{children:[e.jsx("strong",{children:"Name:"})," ",r.name||"-",e.jsx("br",{}),e.jsx("strong",{children:"Email:"})," ",r.email||"-",e.jsx("br",{}),e.jsx("strong",{children:"Role:"})," ",r.role||"-",e.jsx("br",{}),e.jsx("strong",{children:"ID:"})," ",r.id||"-",e.jsx("br",{}),e.jsx("strong",{children:"Created:"})," ",r.created_at?new Date(r.created_at).toLocaleString():"-",e.jsx("br",{}),e.jsx("strong",{children:"Last Login:"})," ",r.last_login?new Date(r.last_login).toLocaleString():"-",e.jsx("br",{}),e.jsx("strong",{children:"Phone:"})," ",r.phone||"-"]});return e.jsx(e.Fragment,{children:e.jsx(Cr,{items:s,renderItem:t,ariaLabel:"Users Mobile View"})})};function _r({open:s,onClose:t,onSaved:r,mode:i="add",supplier:n}){const[o,l]=p.useState(n?.name||""),[a,c]=p.useState(n?.contact_name||""),[d,u]=p.useState(n?.email||""),[h,g]=p.useState(n?.phone||""),[b,x]=p.useState(n?.address||""),[m,y]=p.useState(!1),[_,D]=p.useState(null);p.useEffect(()=>{s&&i==="edit"&&n?(l(n.name||""),c(n.contact_name||""),u(n.email||""),g(n.phone||""),x(n.address||"")):s&&i==="add"&&(l(""),c(""),u(""),g(""),x(""))},[s,i,n]);const I=async()=>{y(!0),D(null);const v={name:o,contact_name:a,email:d,phone:h,address:b};let k;if(i==="add"){k=await O.from("Suppliers").insert([v]).select(),y(!1),k.error?D(k.error.message):r(k.data?.[0]?.id);return}else k=await O.from("Suppliers").update(v).eq("id",n?.id);y(!1),k.error?D(k.error.message):r()};return e.jsx(we,{open:s,onClose:t,children:e.jsxs(ve,{sx:{minWidth:400},children:[e.jsx(We,{}),e.jsxs(w,{level:"title-md",sx:{mb:2},children:[i==="edit"?"Edit":"Add"," Supplier"]}),e.jsxs("form",{onSubmit:v=>{v.preventDefault(),v.stopPropagation(),I()},children:[e.jsx(F,{placeholder:"Name",value:o,onChange:v=>l(v.target.value),sx:{mb:2},required:!0}),e.jsx(F,{placeholder:"Contact Name",value:a,onChange:v=>c(v.target.value),sx:{mb:2}}),e.jsx(F,{placeholder:"Email",value:d,onChange:v=>u(v.target.value),sx:{mb:2},type:"email",required:!0}),e.jsx(F,{placeholder:"Phone",value:h,onChange:v=>g(v.target.value),sx:{mb:2},type:"tel"}),e.jsx(F,{placeholder:"Address",value:b,onChange:v=>x(v.target.value),sx:{mb:2}}),_&&e.jsx(w,{color:"danger",sx:{mb:1},children:_}),e.jsx(q,{type:"submit",loading:m,disabled:m,variant:"solid",children:"Save"})]})]})})}function ni(){const[s,t]=p.useState([]),[r,i]=p.useState(null),[n,o]=p.useState(!1),[l,a]=p.useState("view"),[c,d]=p.useState("");p.useEffect(()=>{u()},[]);const u=async()=>{const{data:b,error:x}=await O.from("Suppliers").select("*");x?console.log("error",x):t(b||[])},h=b=>{i(b),a("edit"),o(!0)},g=async b=>{const{error:x}=await O.from("Suppliers").delete().eq("id",b);x?console.log("error",x):u()};return e.jsx($e,{children:e.jsxs(S,{sx:{width:"100%",minHeight:"100dvh",bgcolor:"background.body",borderRadius:0,boxShadow:"none",pl:0,pr:0,pt:0,pb:0},children:[e.jsx(w,{level:"h2",sx:{mb:2,fontSize:"xlarge",textAlign:"left"},gutterBottom:!0,children:"Suppliers"}),e.jsxs(S,{sx:{display:"flex",gap:2,mb:3,alignItems:"center",justifyContent:"space-between"},children:[e.jsx(F,{placeholder:"Search suppliers...",value:c,onChange:b=>d(b.target.value),sx:{flex:1}}),e.jsx(q,{variant:"solid",onClick:()=>{i(null),a("add"),o(!0)},sx:{minWidth:140},children:"Add Supplier"})]}),e.jsx(rt,{container:!0,spacing:2,sx:{mt:2},children:s.filter(b=>b.name?.toLowerCase().includes(c.toLowerCase())||b.contact_name?.toLowerCase().includes(c.toLowerCase())||b.email?.toLowerCase().includes(c.toLowerCase())||b.phone?.toLowerCase().includes(c.toLowerCase())||b.address?.toLowerCase().includes(c.toLowerCase())).map(b=>e.jsx(rt,{xs:12,md:4,children:e.jsxs(Pe,{variant:"outlined",children:[e.jsxs(S,{sx:{p:2},children:[e.jsx(w,{level:"h4",sx:{mb:1},children:b.name}),e.jsxs(w,{level:"body-md",children:[e.jsx("b",{children:"Address:"})," ",b.address||"N/A"]}),e.jsxs(w,{level:"body-md",children:[e.jsx("b",{children:"Contact Name:"})," ",b.contact_name||"N/A"]}),e.jsxs(w,{level:"body-md",children:[e.jsx("b",{children:"Email:"})," ",b.email||"N/A"]}),e.jsxs(w,{level:"body-md",children:[e.jsx("b",{children:"Phone:"})," ",b.phone||"N/A"]})]}),e.jsxs(S,{sx:{display:"flex",justifyContent:"flex-end",mt:1},children:[e.jsx(q,{size:"sm",onClick:()=>h(b),startDecorator:e.jsx(os,{}),children:"Edit"}),e.jsx(q,{size:"sm",color:"danger",onClick:()=>g(b.id),startDecorator:e.jsx(Sr,{}),children:"Delete"})]})]})},b.id))}),e.jsx(_r,{open:n,onClose:()=>o(!1),supplier:r,onSaved:()=>{o(!1),u()},mode:l==="edit"||l==="add"?l:void 0})]})})}function ii({orderId:s,editable:t,onItemsChange:r,initialItems:i=[]}){const[n,o]=p.useState(i),[l,a]=p.useState([]),[c,d]=p.useState(!1);p.useEffect(()=>{d(!0),O.from("Products").select("uuid, ProductName").then(({data:b,error:x})=>{x?console.error("Failed to fetch products:",x.message):a(b||[]),d(!1)})},[]);const u=(b,x,m)=>{o(y=>{const _=y.map((D,I)=>I===b?{...D,[x]:m}:D);return r&&r(_),_})},h=()=>{o(b=>{const x=[...b,{product_id:null,quantity_ordered:1,unit_price:0}];return r&&r(x),x})},g=b=>{o(x=>{const m=x.filter((y,_)=>_!==b);return r&&r(m),m})};return e.jsxs(S,{sx:{mt:2},children:[e.jsxs(Te,{size:"sm",sx:{minWidth:500},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Quantity"}),e.jsx("th",{children:"Unit Price"}),e.jsx("th",{children:"Total"}),t&&e.jsx("th",{})]})}),e.jsx("tbody",{children:n.map((b,x)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(bs,{options:l,getOptionLabel:m=>m.ProductName,value:l.find(m=>m.uuid===b.product_id)||null,onChange:(m,y)=>u(x,"product_id",y?y.uuid:null),disabled:!t,sx:{minWidth:180},isOptionEqualToValue:(m,y)=>m.uuid===y.uuid,required:!0})}),e.jsx("td",{children:e.jsx(F,{type:"number",value:b.quantity_ordered??1,onChange:m=>u(x,"quantity_ordered",Math.max(1,Number(m.target.value))),disabled:!t,sx:{width:80},required:!0})}),e.jsx("td",{children:e.jsx(F,{type:"number",value:b.unit_price??0,onChange:m=>u(x,"unit_price",Math.max(0,Number(m.target.value))),disabled:!t,sx:{width:100},required:!0})}),e.jsx("td",{children:(b.quantity_ordered*b.unit_price).toFixed(2)}),t&&e.jsx("td",{children:e.jsx(q,{size:"sm",color:"danger",onClick:()=>g(x),children:"Remove"})})]},x))})]}),t&&e.jsx(q,{size:"sm",variant:"soft",onClick:h,sx:{mt:1},children:"Add Item"})]})}const vt=["Pending","Approved","Received","Cancelled"];function as({open:s,onClose:t,onCreated:r,mode:i="add",order:n}){const[o,l]=p.useState(n?.order_number||""),[a,c]=p.useState(n?.order_date||new Date().toISOString().slice(0,10)),[d,u]=p.useState(n?.status||"Pending"),[h,g]=p.useState(n?.total?String(n.total):""),[b,x]=p.useState(n?.notes||""),[m,y]=p.useState(n?.supplier_id||null),[_,D]=p.useState(!1),[I,v]=p.useState(null),[k,A]=p.useState([]),[T,U]=p.useState(""),[Q,K]=p.useState(!1),[L,P]=p.useState([{product_id:null,quantity_ordered:1,unit_price:0}]);p.useRef(null),p.useEffect(()=>{s?(console.log("[PurchaseOrderForm] Modal opened"),O.from("Suppliers").select("id, name").then(({data:E})=>{A(E||[])}),i==="edit"&&n?.id?O.from("purchaseorderitems").select("*").eq("purchase_order_id",n.id).then(({data:E})=>{P(E||[])}):i==="add"&&P([{product_id:null,quantity_ordered:1,unit_price:0}])):console.log("[PurchaseOrderForm] Modal closed")},[s,i,n]);const C=async E=>{console.log("[PurchaseOrderForm] handleSupplierAdded called");const{data:$}=await O.from("Suppliers").select("id, name");A($||[]),E&&(y(String(E)),console.log("[PurchaseOrderForm] New supplier set:",E)),K(!1),console.log("[PurchaseOrderForm] SupplierForm closed")},N=async()=>{console.log("[PurchaseOrderForm] handleSave called"),D(!0),v(null);const E={order_date:a,status:d,notes:b,supplier_id:m};i==="edit"&&(E.order_number=o),E.total=h?parseFloat(h):null;let $,he=n?.id;if(i==="add"?($=await O.from("PurchaseOrders").insert([E]).select(),!$.error&&$.data&&$.data[0]&&(he=$.data[0].id)):n&&($=await O.from("PurchaseOrders").update(E).eq("id",n.id)),$&&!$.error&&i==="add"&&he&&L.length>0){const Re=L.filter(je=>je.product_id).map(je=>({purchase_order_id:he,product_id:je.product_id,quantity_ordered:je.quantity_ordered,unit_price:je.unit_price,notes:je.notes||null}));if(Re.length===0){v("Please select a product for each item before saving."),D(!1);return}const ne=await O.from("purchaseorderitems").insert(Re);if(ne.error){v("Failed to save items: "+ne.error.message),D(!1);return}}D(!1),$?.error?(v($.error.message),console.log("[PurchaseOrderForm] Save error:",$.error.message)):(r(),t(),l(""),c(new Date().toISOString().slice(0,10)),u("Pending"),g(""),x(""),y(null),U(""),console.log("[PurchaseOrderForm] Purchase order saved and modal closed"))};return e.jsx(we,{open:s,onClose:t,"aria-labelledby":"purchase-order-form-title",children:e.jsxs(ve,{sx:{minWidth:400},children:[e.jsx(We,{}),e.jsxs(w,{id:"purchase-order-form-title",level:"title-md",sx:{mb:2},children:[i==="edit"?"Edit":"Add"," Purchase Order"]}),e.jsxs("form",{onSubmit:E=>{E.preventDefault(),N()},children:[e.jsx(F,{type:"date",value:a,onChange:E=>c(E.target.value),sx:{mb:2},required:!0}),e.jsx(le,{value:d,onChange:(E,$)=>u($??"Pending"),sx:{mb:2,display:"none"},required:!0,children:vt.map(E=>e.jsx(M,{value:E,children:E},E))}),i==="edit"&&e.jsx(S,{sx:{mb:2},children:e.jsx(ie,{variant:"soft",color:d==="Approved"?"success":d==="Received"?"primary":d==="Cancelled"?"danger":"neutral",sx:{textTransform:"capitalize",fontWeight:600,fontSize:"md",px:1.5,py:.5},onClick:()=>{const E=vt.indexOf(d);u(vt[(E+1)%vt.length])},children:d})}),e.jsxs(S,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(bs,{options:k,getOptionLabel:E=>E.name,value:k.find(E=>E.id===m)||null,onChange:(E,$)=>y($?$.id:null),inputValue:T,onInputChange:(E,$)=>U($),placeholder:"Select supplier",sx:{flex:1,mb:0},isOptionEqualToValue:(E,$)=>E.id===$.id,required:!0}),e.jsx(oe,{color:"primary",sx:{ml:1},onClick:()=>K(!0),children:e.jsx(qe,{})})]}),e.jsx(_r,{open:Q,onClose:()=>K(!1),onSaved:C,mode:"add"}),i==="edit"&&e.jsxs(e.Fragment,{children:[e.jsx(F,{placeholder:"Order Number",value:o,onChange:E=>l(E.target.value),sx:{mb:2}}),e.jsx(F,{placeholder:"Total",value:h,onChange:E=>g(E.target.value),sx:{mb:2},type:"number",readOnly:!0})]}),e.jsx(F,{placeholder:"Notes",value:b,onChange:E=>x(E.target.value),sx:{mb:2}}),e.jsx(ii,{orderId:n?.id,editable:i==="add",onItemsChange:P,initialItems:L}),e.jsx(S,{sx:{height:16}}),I&&e.jsx(w,{color:"danger",sx:{mb:1},children:I}),e.jsx(q,{type:"submit",loading:_,disabled:_,variant:"solid",children:"Save"})]})]})})}function Pr(s,t){return function(){return s.apply(t,arguments)}}const{toString:oi}=Object.prototype,{getPrototypeOf:Rs}=Object,{iterator:Wt,toStringTag:Rr}=Symbol,Ht=(s=>t=>{const r=oi.call(t);return s[r]||(s[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),Oe=s=>(s=s.toLowerCase(),t=>Ht(t)===s),Vt=s=>t=>typeof t===s,{isArray:it}=Array,mt=Vt("undefined");function li(s){return s!==null&&!mt(s)&&s.constructor!==null&&!mt(s.constructor)&&ye(s.constructor.isBuffer)&&s.constructor.isBuffer(s)}const Ar=Oe("ArrayBuffer");function ai(s){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(s):t=s&&s.buffer&&Ar(s.buffer),t}const ci=Vt("string"),ye=Vt("function"),Er=Vt("number"),Jt=s=>s!==null&&typeof s=="object",di=s=>s===!0||s===!1,_t=s=>{if(Ht(s)!=="object")return!1;const t=Rs(s);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Rr in s)&&!(Wt in s)},ui=Oe("Date"),hi=Oe("File"),pi=Oe("Blob"),xi=Oe("FileList"),fi=s=>Jt(s)&&ye(s.pipe),mi=s=>{let t;return s&&(typeof FormData=="function"&&s instanceof FormData||ye(s.append)&&((t=Ht(s))==="formdata"||t==="object"&&ye(s.toString)&&s.toString()==="[object FormData]"))},gi=Oe("URLSearchParams"),[bi,ji,yi,Si]=["ReadableStream","Request","Response","Headers"].map(Oe),wi=s=>s.trim?s.trim():s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function gt(s,t,{allOwnKeys:r=!1}={}){if(s===null||typeof s>"u")return;let i,n;if(typeof s!="object"&&(s=[s]),it(s))for(i=0,n=s.length;i<n;i++)t.call(null,s[i],i,s);else{const o=r?Object.getOwnPropertyNames(s):Object.keys(s),l=o.length;let a;for(i=0;i<l;i++)a=o[i],t.call(null,s[a],a,s)}}function Or(s,t){t=t.toLowerCase();const r=Object.keys(s);let i=r.length,n;for(;i-- >0;)if(n=r[i],t===n.toLowerCase())return n;return null}const Je=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Ir=s=>!mt(s)&&s!==Je;function cs(){const{caseless:s}=Ir(this)&&this||{},t={},r=(i,n)=>{const o=s&&Or(t,n)||n;_t(t[o])&&_t(i)?t[o]=cs(t[o],i):_t(i)?t[o]=cs({},i):it(i)?t[o]=i.slice():t[o]=i};for(let i=0,n=arguments.length;i<n;i++)arguments[i]&&gt(arguments[i],r);return t}const vi=(s,t,r,{allOwnKeys:i}={})=>(gt(t,(n,o)=>{r&&ye(n)?s[o]=Pr(n,r):s[o]=n},{allOwnKeys:i}),s),ki=s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),Ci=(s,t,r,i)=>{s.prototype=Object.create(t.prototype,i),s.prototype.constructor=s,Object.defineProperty(s,"super",{value:t.prototype}),r&&Object.assign(s.prototype,r)},_i=(s,t,r,i)=>{let n,o,l;const a={};if(t=t||{},s==null)return t;do{for(n=Object.getOwnPropertyNames(s),o=n.length;o-- >0;)l=n[o],(!i||i(l,s,t))&&!a[l]&&(t[l]=s[l],a[l]=!0);s=r!==!1&&Rs(s)}while(s&&(!r||r(s,t))&&s!==Object.prototype);return t},Pi=(s,t,r)=>{s=String(s),(r===void 0||r>s.length)&&(r=s.length),r-=t.length;const i=s.indexOf(t,r);return i!==-1&&i===r},Ri=s=>{if(!s)return null;if(it(s))return s;let t=s.length;if(!Er(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=s[t];return r},Ai=(s=>t=>s&&t instanceof s)(typeof Uint8Array<"u"&&Rs(Uint8Array)),Ei=(s,t)=>{const i=(s&&s[Wt]).call(s);let n;for(;(n=i.next())&&!n.done;){const o=n.value;t.call(s,o[0],o[1])}},Oi=(s,t)=>{let r;const i=[];for(;(r=s.exec(t))!==null;)i.push(r);return i},Ii=Oe("HTMLFormElement"),Di=s=>s.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,i,n){return i.toUpperCase()+n}),Gs=(({hasOwnProperty:s})=>(t,r)=>s.call(t,r))(Object.prototype),Ti=Oe("RegExp"),Dr=(s,t)=>{const r=Object.getOwnPropertyDescriptors(s),i={};gt(r,(n,o)=>{let l;(l=t(n,o,s))!==!1&&(i[o]=l||n)}),Object.defineProperties(s,i)},Li=s=>{Dr(s,(t,r)=>{if(ye(s)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const i=s[r];if(ye(i)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},Ni=(s,t)=>{const r={},i=n=>{n.forEach(o=>{r[o]=!0})};return it(s)?i(s):i(String(s).split(t)),r},zi=()=>{},Mi=(s,t)=>s!=null&&Number.isFinite(s=+s)?s:t;function qi(s){return!!(s&&ye(s.append)&&s[Rr]==="FormData"&&s[Wt])}const Fi=s=>{const t=new Array(10),r=(i,n)=>{if(Jt(i)){if(t.indexOf(i)>=0)return;if(!("toJSON"in i)){t[n]=i;const o=it(i)?[]:{};return gt(i,(l,a)=>{const c=r(l,n+1);!mt(c)&&(o[a]=c)}),t[n]=void 0,o}}return i};return r(s,0)},$i=Oe("AsyncFunction"),Ui=s=>s&&(Jt(s)||ye(s))&&ye(s.then)&&ye(s.catch),Tr=((s,t)=>s?setImmediate:t?((r,i)=>(Je.addEventListener("message",({source:n,data:o})=>{n===Je&&o===r&&i.length&&i.shift()()},!1),n=>{i.push(n),Je.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",ye(Je.postMessage)),Bi=typeof queueMicrotask<"u"?queueMicrotask.bind(Je):typeof process<"u"&&process.nextTick||Tr,Wi=s=>s!=null&&ye(s[Wt]),j={isArray:it,isArrayBuffer:Ar,isBuffer:li,isFormData:mi,isArrayBufferView:ai,isString:ci,isNumber:Er,isBoolean:di,isObject:Jt,isPlainObject:_t,isReadableStream:bi,isRequest:ji,isResponse:yi,isHeaders:Si,isUndefined:mt,isDate:ui,isFile:hi,isBlob:pi,isRegExp:Ti,isFunction:ye,isStream:fi,isURLSearchParams:gi,isTypedArray:Ai,isFileList:xi,forEach:gt,merge:cs,extend:vi,trim:wi,stripBOM:ki,inherits:Ci,toFlatObject:_i,kindOf:Ht,kindOfTest:Oe,endsWith:Pi,toArray:Ri,forEachEntry:Ei,matchAll:Oi,isHTMLForm:Ii,hasOwnProperty:Gs,hasOwnProp:Gs,reduceDescriptors:Dr,freezeMethods:Li,toObjectSet:Ni,toCamelCase:Di,noop:zi,toFiniteNumber:Mi,findKey:Or,global:Je,isContextDefined:Ir,isSpecCompliantForm:qi,toJSONObject:Fi,isAsyncFn:$i,isThenable:Ui,setImmediate:Tr,asap:Bi,isIterable:Wi};function B(s,t,r,i,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=s,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),i&&(this.request=i),n&&(this.response=n,this.status=n.status?n.status:null)}j.inherits(B,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:j.toJSONObject(this.config),code:this.code,status:this.status}}});const Lr=B.prototype,Nr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(s=>{Nr[s]={value:s}});Object.defineProperties(B,Nr);Object.defineProperty(Lr,"isAxiosError",{value:!0});B.from=(s,t,r,i,n,o)=>{const l=Object.create(Lr);return j.toFlatObject(s,l,function(c){return c!==Error.prototype},a=>a!=="isAxiosError"),B.call(l,s.message,t,r,i,n),l.cause=s,l.name=s.name,o&&Object.assign(l,o),l};const Hi=null;function ds(s){return j.isPlainObject(s)||j.isArray(s)}function zr(s){return j.endsWith(s,"[]")?s.slice(0,-2):s}function Zs(s,t,r){return s?s.concat(t).map(function(n,o){return n=zr(n),!r&&o?"["+n+"]":n}).join(r?".":""):t}function Vi(s){return j.isArray(s)&&!s.some(ds)}const Ji=j.toFlatObject(j,{},null,function(t){return/^is[A-Z]/.test(t)});function Gt(s,t,r){if(!j.isObject(s))throw new TypeError("target must be an object");t=t||new FormData,r=j.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,y){return!j.isUndefined(y[m])});const i=r.metaTokens,n=r.visitor||u,o=r.dots,l=r.indexes,c=(r.Blob||typeof Blob<"u"&&Blob)&&j.isSpecCompliantForm(t);if(!j.isFunction(n))throw new TypeError("visitor must be a function");function d(x){if(x===null)return"";if(j.isDate(x))return x.toISOString();if(j.isBoolean(x))return x.toString();if(!c&&j.isBlob(x))throw new B("Blob is not supported. Use a Buffer instead.");return j.isArrayBuffer(x)||j.isTypedArray(x)?c&&typeof Blob=="function"?new Blob([x]):Buffer.from(x):x}function u(x,m,y){let _=x;if(x&&!y&&typeof x=="object"){if(j.endsWith(m,"{}"))m=i?m:m.slice(0,-2),x=JSON.stringify(x);else if(j.isArray(x)&&Vi(x)||(j.isFileList(x)||j.endsWith(m,"[]"))&&(_=j.toArray(x)))return m=zr(m),_.forEach(function(I,v){!(j.isUndefined(I)||I===null)&&t.append(l===!0?Zs([m],v,o):l===null?m:m+"[]",d(I))}),!1}return ds(x)?!0:(t.append(Zs(y,m,o),d(x)),!1)}const h=[],g=Object.assign(Ji,{defaultVisitor:u,convertValue:d,isVisitable:ds});function b(x,m){if(!j.isUndefined(x)){if(h.indexOf(x)!==-1)throw Error("Circular reference detected in "+m.join("."));h.push(x),j.forEach(x,function(_,D){(!(j.isUndefined(_)||_===null)&&n.call(t,_,j.isString(D)?D.trim():D,m,g))===!0&&b(_,m?m.concat(D):[D])}),h.pop()}}if(!j.isObject(s))throw new TypeError("data must be an object");return b(s),t}function Qs(s){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(i){return t[i]})}function As(s,t){this._pairs=[],s&&Gt(s,this,t)}const Mr=As.prototype;Mr.append=function(t,r){this._pairs.push([t,r])};Mr.toString=function(t){const r=t?function(i){return t.call(this,i,Qs)}:Qs;return this._pairs.map(function(n){return r(n[0])+"="+r(n[1])},"").join("&")};function Gi(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function qr(s,t,r){if(!t)return s;const i=r&&r.encode||Gi;j.isFunction(r)&&(r={serialize:r});const n=r&&r.serialize;let o;if(n?o=n(t,r):o=j.isURLSearchParams(t)?t.toString():new As(t,r).toString(i),o){const l=s.indexOf("#");l!==-1&&(s=s.slice(0,l)),s+=(s.indexOf("?")===-1?"?":"&")+o}return s}class Ks{constructor(){this.handlers=[]}use(t,r,i){return this.handlers.push({fulfilled:t,rejected:r,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){j.forEach(this.handlers,function(i){i!==null&&t(i)})}}const Fr={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Zi=typeof URLSearchParams<"u"?URLSearchParams:As,Qi=typeof FormData<"u"?FormData:null,Ki=typeof Blob<"u"?Blob:null,Xi={isBrowser:!0,classes:{URLSearchParams:Zi,FormData:Qi,Blob:Ki},protocols:["http","https","file","blob","url","data"]},Es=typeof window<"u"&&typeof document<"u",us=typeof navigator=="object"&&navigator||void 0,Yi=Es&&(!us||["ReactNative","NativeScript","NS"].indexOf(us.product)<0),eo=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",to=Es&&window.location.href||"http://localhost",so=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Es,hasStandardBrowserEnv:Yi,hasStandardBrowserWebWorkerEnv:eo,navigator:us,origin:to},Symbol.toStringTag,{value:"Module"})),me={...so,...Xi};function ro(s,t){return Gt(s,new me.classes.URLSearchParams,Object.assign({visitor:function(r,i,n,o){return me.isNode&&j.isBuffer(r)?(this.append(i,r.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},t))}function no(s){return j.matchAll(/\w+|\[(\w*)]/g,s).map(t=>t[0]==="[]"?"":t[1]||t[0])}function io(s){const t={},r=Object.keys(s);let i;const n=r.length;let o;for(i=0;i<n;i++)o=r[i],t[o]=s[o];return t}function $r(s){function t(r,i,n,o){let l=r[o++];if(l==="__proto__")return!0;const a=Number.isFinite(+l),c=o>=r.length;return l=!l&&j.isArray(n)?n.length:l,c?(j.hasOwnProp(n,l)?n[l]=[n[l],i]:n[l]=i,!a):((!n[l]||!j.isObject(n[l]))&&(n[l]=[]),t(r,i,n[l],o)&&j.isArray(n[l])&&(n[l]=io(n[l])),!a)}if(j.isFormData(s)&&j.isFunction(s.entries)){const r={};return j.forEachEntry(s,(i,n)=>{t(no(i),n,r,0)}),r}return null}function oo(s,t,r){if(j.isString(s))try{return(t||JSON.parse)(s),j.trim(s)}catch(i){if(i.name!=="SyntaxError")throw i}return(r||JSON.stringify)(s)}const bt={transitional:Fr,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const i=r.getContentType()||"",n=i.indexOf("application/json")>-1,o=j.isObject(t);if(o&&j.isHTMLForm(t)&&(t=new FormData(t)),j.isFormData(t))return n?JSON.stringify($r(t)):t;if(j.isArrayBuffer(t)||j.isBuffer(t)||j.isStream(t)||j.isFile(t)||j.isBlob(t)||j.isReadableStream(t))return t;if(j.isArrayBufferView(t))return t.buffer;if(j.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let a;if(o){if(i.indexOf("application/x-www-form-urlencoded")>-1)return ro(t,this.formSerializer).toString();if((a=j.isFileList(t))||i.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Gt(a?{"files[]":t}:t,c&&new c,this.formSerializer)}}return o||n?(r.setContentType("application/json",!1),oo(t)):t}],transformResponse:[function(t){const r=this.transitional||bt.transitional,i=r&&r.forcedJSONParsing,n=this.responseType==="json";if(j.isResponse(t)||j.isReadableStream(t))return t;if(t&&j.isString(t)&&(i&&!this.responseType||n)){const l=!(r&&r.silentJSONParsing)&&n;try{return JSON.parse(t)}catch(a){if(l)throw a.name==="SyntaxError"?B.from(a,B.ERR_BAD_RESPONSE,this,null,this.response):a}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:me.classes.FormData,Blob:me.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};j.forEach(["delete","get","head","post","put","patch"],s=>{bt.headers[s]={}});const lo=j.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ao=s=>{const t={};let r,i,n;return s&&s.split(`
`).forEach(function(l){n=l.indexOf(":"),r=l.substring(0,n).trim().toLowerCase(),i=l.substring(n+1).trim(),!(!r||t[r]&&lo[r])&&(r==="set-cookie"?t[r]?t[r].push(i):t[r]=[i]:t[r]=t[r]?t[r]+", "+i:i)}),t},Xs=Symbol("internals");function at(s){return s&&String(s).trim().toLowerCase()}function Pt(s){return s===!1||s==null?s:j.isArray(s)?s.map(Pt):String(s)}function co(s){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=r.exec(s);)t[i[1]]=i[2];return t}const uo=s=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(s.trim());function es(s,t,r,i,n){if(j.isFunction(i))return i.call(this,t,r);if(n&&(t=r),!!j.isString(t)){if(j.isString(i))return t.indexOf(i)!==-1;if(j.isRegExp(i))return i.test(t)}}function ho(s){return s.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,i)=>r.toUpperCase()+i)}function po(s,t){const r=j.toCamelCase(" "+t);["get","set","has"].forEach(i=>{Object.defineProperty(s,i+r,{value:function(n,o,l){return this[i].call(this,t,n,o,l)},configurable:!0})})}let Se=class{constructor(t){t&&this.set(t)}set(t,r,i){const n=this;function o(a,c,d){const u=at(c);if(!u)throw new Error("header name must be a non-empty string");const h=j.findKey(n,u);(!h||n[h]===void 0||d===!0||d===void 0&&n[h]!==!1)&&(n[h||c]=Pt(a))}const l=(a,c)=>j.forEach(a,(d,u)=>o(d,u,c));if(j.isPlainObject(t)||t instanceof this.constructor)l(t,r);else if(j.isString(t)&&(t=t.trim())&&!uo(t))l(ao(t),r);else if(j.isObject(t)&&j.isIterable(t)){let a={},c,d;for(const u of t){if(!j.isArray(u))throw TypeError("Object iterator must return a key-value pair");a[d=u[0]]=(c=a[d])?j.isArray(c)?[...c,u[1]]:[c,u[1]]:u[1]}l(a,r)}else t!=null&&o(r,t,i);return this}get(t,r){if(t=at(t),t){const i=j.findKey(this,t);if(i){const n=this[i];if(!r)return n;if(r===!0)return co(n);if(j.isFunction(r))return r.call(this,n,i);if(j.isRegExp(r))return r.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=at(t),t){const i=j.findKey(this,t);return!!(i&&this[i]!==void 0&&(!r||es(this,this[i],i,r)))}return!1}delete(t,r){const i=this;let n=!1;function o(l){if(l=at(l),l){const a=j.findKey(i,l);a&&(!r||es(i,i[a],a,r))&&(delete i[a],n=!0)}}return j.isArray(t)?t.forEach(o):o(t),n}clear(t){const r=Object.keys(this);let i=r.length,n=!1;for(;i--;){const o=r[i];(!t||es(this,this[o],o,t,!0))&&(delete this[o],n=!0)}return n}normalize(t){const r=this,i={};return j.forEach(this,(n,o)=>{const l=j.findKey(i,o);if(l){r[l]=Pt(n),delete r[o];return}const a=t?ho(o):String(o).trim();a!==o&&delete r[o],r[a]=Pt(n),i[a]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return j.forEach(this,(i,n)=>{i!=null&&i!==!1&&(r[n]=t&&j.isArray(i)?i.join(", "):i)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const i=new this(t);return r.forEach(n=>i.set(n)),i}static accessor(t){const i=(this[Xs]=this[Xs]={accessors:{}}).accessors,n=this.prototype;function o(l){const a=at(l);i[a]||(po(n,l),i[a]=!0)}return j.isArray(t)?t.forEach(o):o(t),this}};Se.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);j.reduceDescriptors(Se.prototype,({value:s},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>s,set(i){this[r]=i}}});j.freezeMethods(Se);function ts(s,t){const r=this||bt,i=t||r,n=Se.from(i.headers);let o=i.data;return j.forEach(s,function(a){o=a.call(r,o,n.normalize(),t?t.status:void 0)}),n.normalize(),o}function Ur(s){return!!(s&&s.__CANCEL__)}function ot(s,t,r){B.call(this,s??"canceled",B.ERR_CANCELED,t,r),this.name="CanceledError"}j.inherits(ot,B,{__CANCEL__:!0});function Br(s,t,r){const i=r.config.validateStatus;!r.status||!i||i(r.status)?s(r):t(new B("Request failed with status code "+r.status,[B.ERR_BAD_REQUEST,B.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function xo(s){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return t&&t[1]||""}function fo(s,t){s=s||10;const r=new Array(s),i=new Array(s);let n=0,o=0,l;return t=t!==void 0?t:1e3,function(c){const d=Date.now(),u=i[o];l||(l=d),r[n]=c,i[n]=d;let h=o,g=0;for(;h!==n;)g+=r[h++],h=h%s;if(n=(n+1)%s,n===o&&(o=(o+1)%s),d-l<t)return;const b=u&&d-u;return b?Math.round(g*1e3/b):void 0}}function mo(s,t){let r=0,i=1e3/t,n,o;const l=(d,u=Date.now())=>{r=u,n=null,o&&(clearTimeout(o),o=null),s.apply(null,d)};return[(...d)=>{const u=Date.now(),h=u-r;h>=i?l(d,u):(n=d,o||(o=setTimeout(()=>{o=null,l(n)},i-h)))},()=>n&&l(n)]}const Tt=(s,t,r=3)=>{let i=0;const n=fo(50,250);return mo(o=>{const l=o.loaded,a=o.lengthComputable?o.total:void 0,c=l-i,d=n(c),u=l<=a;i=l;const h={loaded:l,total:a,progress:a?l/a:void 0,bytes:c,rate:d||void 0,estimated:d&&a&&u?(a-l)/d:void 0,event:o,lengthComputable:a!=null,[t?"download":"upload"]:!0};s(h)},r)},Ys=(s,t)=>{const r=s!=null;return[i=>t[0]({lengthComputable:r,total:s,loaded:i}),t[1]]},er=s=>(...t)=>j.asap(()=>s(...t)),go=me.hasStandardBrowserEnv?((s,t)=>r=>(r=new URL(r,me.origin),s.protocol===r.protocol&&s.host===r.host&&(t||s.port===r.port)))(new URL(me.origin),me.navigator&&/(msie|trident)/i.test(me.navigator.userAgent)):()=>!0,bo=me.hasStandardBrowserEnv?{write(s,t,r,i,n,o){const l=[s+"="+encodeURIComponent(t)];j.isNumber(r)&&l.push("expires="+new Date(r).toGMTString()),j.isString(i)&&l.push("path="+i),j.isString(n)&&l.push("domain="+n),o===!0&&l.push("secure"),document.cookie=l.join("; ")},read(s){const t=document.cookie.match(new RegExp("(^|;\\s*)("+s+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(s){this.write(s,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function jo(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}function yo(s,t){return t?s.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):s}function Wr(s,t,r){let i=!jo(t);return s&&(i||r==!1)?yo(s,t):t}const tr=s=>s instanceof Se?{...s}:s;function Qe(s,t){t=t||{};const r={};function i(d,u,h,g){return j.isPlainObject(d)&&j.isPlainObject(u)?j.merge.call({caseless:g},d,u):j.isPlainObject(u)?j.merge({},u):j.isArray(u)?u.slice():u}function n(d,u,h,g){if(j.isUndefined(u)){if(!j.isUndefined(d))return i(void 0,d,h,g)}else return i(d,u,h,g)}function o(d,u){if(!j.isUndefined(u))return i(void 0,u)}function l(d,u){if(j.isUndefined(u)){if(!j.isUndefined(d))return i(void 0,d)}else return i(void 0,u)}function a(d,u,h){if(h in t)return i(d,u);if(h in s)return i(void 0,d)}const c={url:o,method:o,data:o,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:a,headers:(d,u,h)=>n(tr(d),tr(u),h,!0)};return j.forEach(Object.keys(Object.assign({},s,t)),function(u){const h=c[u]||n,g=h(s[u],t[u],u);j.isUndefined(g)&&h!==a||(r[u]=g)}),r}const Hr=s=>{const t=Qe({},s);let{data:r,withXSRFToken:i,xsrfHeaderName:n,xsrfCookieName:o,headers:l,auth:a}=t;t.headers=l=Se.from(l),t.url=qr(Wr(t.baseURL,t.url,t.allowAbsoluteUrls),s.params,s.paramsSerializer),a&&l.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let c;if(j.isFormData(r)){if(me.hasStandardBrowserEnv||me.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if((c=l.getContentType())!==!1){const[d,...u]=c?c.split(";").map(h=>h.trim()).filter(Boolean):[];l.setContentType([d||"multipart/form-data",...u].join("; "))}}if(me.hasStandardBrowserEnv&&(i&&j.isFunction(i)&&(i=i(t)),i||i!==!1&&go(t.url))){const d=n&&o&&bo.read(o);d&&l.set(n,d)}return t},So=typeof XMLHttpRequest<"u",wo=So&&function(s){return new Promise(function(r,i){const n=Hr(s);let o=n.data;const l=Se.from(n.headers).normalize();let{responseType:a,onUploadProgress:c,onDownloadProgress:d}=n,u,h,g,b,x;function m(){b&&b(),x&&x(),n.cancelToken&&n.cancelToken.unsubscribe(u),n.signal&&n.signal.removeEventListener("abort",u)}let y=new XMLHttpRequest;y.open(n.method.toUpperCase(),n.url,!0),y.timeout=n.timeout;function _(){if(!y)return;const I=Se.from("getAllResponseHeaders"in y&&y.getAllResponseHeaders()),k={data:!a||a==="text"||a==="json"?y.responseText:y.response,status:y.status,statusText:y.statusText,headers:I,config:s,request:y};Br(function(T){r(T),m()},function(T){i(T),m()},k),y=null}"onloadend"in y?y.onloadend=_:y.onreadystatechange=function(){!y||y.readyState!==4||y.status===0&&!(y.responseURL&&y.responseURL.indexOf("file:")===0)||setTimeout(_)},y.onabort=function(){y&&(i(new B("Request aborted",B.ECONNABORTED,s,y)),y=null)},y.onerror=function(){i(new B("Network Error",B.ERR_NETWORK,s,y)),y=null},y.ontimeout=function(){let v=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const k=n.transitional||Fr;n.timeoutErrorMessage&&(v=n.timeoutErrorMessage),i(new B(v,k.clarifyTimeoutError?B.ETIMEDOUT:B.ECONNABORTED,s,y)),y=null},o===void 0&&l.setContentType(null),"setRequestHeader"in y&&j.forEach(l.toJSON(),function(v,k){y.setRequestHeader(k,v)}),j.isUndefined(n.withCredentials)||(y.withCredentials=!!n.withCredentials),a&&a!=="json"&&(y.responseType=n.responseType),d&&([g,x]=Tt(d,!0),y.addEventListener("progress",g)),c&&y.upload&&([h,b]=Tt(c),y.upload.addEventListener("progress",h),y.upload.addEventListener("loadend",b)),(n.cancelToken||n.signal)&&(u=I=>{y&&(i(!I||I.type?new ot(null,s,y):I),y.abort(),y=null)},n.cancelToken&&n.cancelToken.subscribe(u),n.signal&&(n.signal.aborted?u():n.signal.addEventListener("abort",u)));const D=xo(n.url);if(D&&me.protocols.indexOf(D)===-1){i(new B("Unsupported protocol "+D+":",B.ERR_BAD_REQUEST,s));return}y.send(o||null)})},vo=(s,t)=>{const{length:r}=s=s?s.filter(Boolean):[];if(t||r){let i=new AbortController,n;const o=function(d){if(!n){n=!0,a();const u=d instanceof Error?d:this.reason;i.abort(u instanceof B?u:new ot(u instanceof Error?u.message:u))}};let l=t&&setTimeout(()=>{l=null,o(new B(`timeout ${t} of ms exceeded`,B.ETIMEDOUT))},t);const a=()=>{s&&(l&&clearTimeout(l),l=null,s.forEach(d=>{d.unsubscribe?d.unsubscribe(o):d.removeEventListener("abort",o)}),s=null)};s.forEach(d=>d.addEventListener("abort",o));const{signal:c}=i;return c.unsubscribe=()=>j.asap(a),c}},ko=function*(s,t){let r=s.byteLength;if(r<t){yield s;return}let i=0,n;for(;i<r;)n=i+t,yield s.slice(i,n),i=n},Co=async function*(s,t){for await(const r of _o(s))yield*ko(r,t)},_o=async function*(s){if(s[Symbol.asyncIterator]){yield*s;return}const t=s.getReader();try{for(;;){const{done:r,value:i}=await t.read();if(r)break;yield i}}finally{await t.cancel()}},sr=(s,t,r,i)=>{const n=Co(s,t);let o=0,l,a=c=>{l||(l=!0,i&&i(c))};return new ReadableStream({async pull(c){try{const{done:d,value:u}=await n.next();if(d){a(),c.close();return}let h=u.byteLength;if(r){let g=o+=h;r(g)}c.enqueue(new Uint8Array(u))}catch(d){throw a(d),d}},cancel(c){return a(c),n.return()}},{highWaterMark:2})},Zt=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Vr=Zt&&typeof ReadableStream=="function",Po=Zt&&(typeof TextEncoder=="function"?(s=>t=>s.encode(t))(new TextEncoder):async s=>new Uint8Array(await new Response(s).arrayBuffer())),Jr=(s,...t)=>{try{return!!s(...t)}catch{return!1}},Ro=Vr&&Jr(()=>{let s=!1;const t=new Request(me.origin,{body:new ReadableStream,method:"POST",get duplex(){return s=!0,"half"}}).headers.has("Content-Type");return s&&!t}),rr=64*1024,hs=Vr&&Jr(()=>j.isReadableStream(new Response("").body)),Lt={stream:hs&&(s=>s.body)};Zt&&(s=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!Lt[t]&&(Lt[t]=j.isFunction(s[t])?r=>r[t]():(r,i)=>{throw new B(`Response type '${t}' is not supported`,B.ERR_NOT_SUPPORT,i)})})})(new Response);const Ao=async s=>{if(s==null)return 0;if(j.isBlob(s))return s.size;if(j.isSpecCompliantForm(s))return(await new Request(me.origin,{method:"POST",body:s}).arrayBuffer()).byteLength;if(j.isArrayBufferView(s)||j.isArrayBuffer(s))return s.byteLength;if(j.isURLSearchParams(s)&&(s=s+""),j.isString(s))return(await Po(s)).byteLength},Eo=async(s,t)=>{const r=j.toFiniteNumber(s.getContentLength());return r??Ao(t)},Oo=Zt&&(async s=>{let{url:t,method:r,data:i,signal:n,cancelToken:o,timeout:l,onDownloadProgress:a,onUploadProgress:c,responseType:d,headers:u,withCredentials:h="same-origin",fetchOptions:g}=Hr(s);d=d?(d+"").toLowerCase():"text";let b=vo([n,o&&o.toAbortSignal()],l),x;const m=b&&b.unsubscribe&&(()=>{b.unsubscribe()});let y;try{if(c&&Ro&&r!=="get"&&r!=="head"&&(y=await Eo(u,i))!==0){let k=new Request(t,{method:"POST",body:i,duplex:"half"}),A;if(j.isFormData(i)&&(A=k.headers.get("content-type"))&&u.setContentType(A),k.body){const[T,U]=Ys(y,Tt(er(c)));i=sr(k.body,rr,T,U)}}j.isString(h)||(h=h?"include":"omit");const _="credentials"in Request.prototype;x=new Request(t,{...g,signal:b,method:r.toUpperCase(),headers:u.normalize().toJSON(),body:i,duplex:"half",credentials:_?h:void 0});let D=await fetch(x,g);const I=hs&&(d==="stream"||d==="response");if(hs&&(a||I&&m)){const k={};["status","statusText","headers"].forEach(Q=>{k[Q]=D[Q]});const A=j.toFiniteNumber(D.headers.get("content-length")),[T,U]=a&&Ys(A,Tt(er(a),!0))||[];D=new Response(sr(D.body,rr,T,()=>{U&&U(),m&&m()}),k)}d=d||"text";let v=await Lt[j.findKey(Lt,d)||"text"](D,s);return!I&&m&&m(),await new Promise((k,A)=>{Br(k,A,{data:v,headers:Se.from(D.headers),status:D.status,statusText:D.statusText,config:s,request:x})})}catch(_){throw m&&m(),_&&_.name==="TypeError"&&/Load failed|fetch/i.test(_.message)?Object.assign(new B("Network Error",B.ERR_NETWORK,s,x),{cause:_.cause||_}):B.from(_,_&&_.code,s,x)}}),ps={http:Hi,xhr:wo,fetch:Oo};j.forEach(ps,(s,t)=>{if(s){try{Object.defineProperty(s,"name",{value:t})}catch{}Object.defineProperty(s,"adapterName",{value:t})}});const nr=s=>`- ${s}`,Io=s=>j.isFunction(s)||s===null||s===!1,Gr={getAdapter:s=>{s=j.isArray(s)?s:[s];const{length:t}=s;let r,i;const n={};for(let o=0;o<t;o++){r=s[o];let l;if(i=r,!Io(r)&&(i=ps[(l=String(r)).toLowerCase()],i===void 0))throw new B(`Unknown adapter '${l}'`);if(i)break;n[l||"#"+o]=i}if(!i){const o=Object.entries(n).map(([a,c])=>`adapter ${a} `+(c===!1?"is not supported by the environment":"is not available in the build"));let l=t?o.length>1?`since :
`+o.map(nr).join(`
`):" "+nr(o[0]):"as no adapter specified";throw new B("There is no suitable adapter to dispatch the request "+l,"ERR_NOT_SUPPORT")}return i},adapters:ps};function ss(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new ot(null,s)}function ir(s){return ss(s),s.headers=Se.from(s.headers),s.data=ts.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),Gr.getAdapter(s.adapter||bt.adapter)(s).then(function(i){return ss(s),i.data=ts.call(s,s.transformResponse,i),i.headers=Se.from(i.headers),i},function(i){return Ur(i)||(ss(s),i&&i.response&&(i.response.data=ts.call(s,s.transformResponse,i.response),i.response.headers=Se.from(i.response.headers))),Promise.reject(i)})}const Zr="1.10.0",Qt={};["object","boolean","number","function","string","symbol"].forEach((s,t)=>{Qt[s]=function(i){return typeof i===s||"a"+(t<1?"n ":" ")+s}});const or={};Qt.transitional=function(t,r,i){function n(o,l){return"[Axios v"+Zr+"] Transitional option '"+o+"'"+l+(i?". "+i:"")}return(o,l,a)=>{if(t===!1)throw new B(n(l," has been removed"+(r?" in "+r:"")),B.ERR_DEPRECATED);return r&&!or[l]&&(or[l]=!0,console.warn(n(l," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(o,l,a):!0}};Qt.spelling=function(t){return(r,i)=>(console.warn(`${i} is likely a misspelling of ${t}`),!0)};function Do(s,t,r){if(typeof s!="object")throw new B("options must be an object",B.ERR_BAD_OPTION_VALUE);const i=Object.keys(s);let n=i.length;for(;n-- >0;){const o=i[n],l=t[o];if(l){const a=s[o],c=a===void 0||l(a,o,s);if(c!==!0)throw new B("option "+o+" must be "+c,B.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new B("Unknown option "+o,B.ERR_BAD_OPTION)}}const Rt={assertOptions:Do,validators:Qt},Ie=Rt.validators;let Ge=class{constructor(t){this.defaults=t||{},this.interceptors={request:new Ks,response:new Ks}}async request(t,r){try{return await this._request(t,r)}catch(i){if(i instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const o=n.stack?n.stack.replace(/^.+\n/,""):"";try{i.stack?o&&!String(i.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+o):i.stack=o}catch{}}throw i}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=Qe(this.defaults,r);const{transitional:i,paramsSerializer:n,headers:o}=r;i!==void 0&&Rt.assertOptions(i,{silentJSONParsing:Ie.transitional(Ie.boolean),forcedJSONParsing:Ie.transitional(Ie.boolean),clarifyTimeoutError:Ie.transitional(Ie.boolean)},!1),n!=null&&(j.isFunction(n)?r.paramsSerializer={serialize:n}:Rt.assertOptions(n,{encode:Ie.function,serialize:Ie.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),Rt.assertOptions(r,{baseUrl:Ie.spelling("baseURL"),withXsrfToken:Ie.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let l=o&&j.merge(o.common,o[r.method]);o&&j.forEach(["delete","get","head","post","put","patch","common"],x=>{delete o[x]}),r.headers=Se.concat(l,o);const a=[];let c=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(r)===!1||(c=c&&m.synchronous,a.unshift(m.fulfilled,m.rejected))});const d=[];this.interceptors.response.forEach(function(m){d.push(m.fulfilled,m.rejected)});let u,h=0,g;if(!c){const x=[ir.bind(this),void 0];for(x.unshift.apply(x,a),x.push.apply(x,d),g=x.length,u=Promise.resolve(r);h<g;)u=u.then(x[h++],x[h++]);return u}g=a.length;let b=r;for(h=0;h<g;){const x=a[h++],m=a[h++];try{b=x(b)}catch(y){m.call(this,y);break}}try{u=ir.call(this,b)}catch(x){return Promise.reject(x)}for(h=0,g=d.length;h<g;)u=u.then(d[h++],d[h++]);return u}getUri(t){t=Qe(this.defaults,t);const r=Wr(t.baseURL,t.url,t.allowAbsoluteUrls);return qr(r,t.params,t.paramsSerializer)}};j.forEach(["delete","get","head","options"],function(t){Ge.prototype[t]=function(r,i){return this.request(Qe(i||{},{method:t,url:r,data:(i||{}).data}))}});j.forEach(["post","put","patch"],function(t){function r(i){return function(o,l,a){return this.request(Qe(a||{},{method:t,headers:i?{"Content-Type":"multipart/form-data"}:{},url:o,data:l}))}}Ge.prototype[t]=r(),Ge.prototype[t+"Form"]=r(!0)});let To=class Qr{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(o){r=o});const i=this;this.promise.then(n=>{if(!i._listeners)return;let o=i._listeners.length;for(;o-- >0;)i._listeners[o](n);i._listeners=null}),this.promise.then=n=>{let o;const l=new Promise(a=>{i.subscribe(a),o=a}).then(n);return l.cancel=function(){i.unsubscribe(o)},l},t(function(o,l,a){i.reason||(i.reason=new ot(o,l,a),r(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=i=>{t.abort(i)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new Qr(function(n){t=n}),cancel:t}}};function Lo(s){return function(r){return s.apply(null,r)}}function No(s){return j.isObject(s)&&s.isAxiosError===!0}const xs={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(xs).forEach(([s,t])=>{xs[t]=s});function Kr(s){const t=new Ge(s),r=Pr(Ge.prototype.request,t);return j.extend(r,Ge.prototype,t,{allOwnKeys:!0}),j.extend(r,t,null,{allOwnKeys:!0}),r.create=function(n){return Kr(Qe(s,n))},r}const re=Kr(bt);re.Axios=Ge;re.CanceledError=ot;re.CancelToken=To;re.isCancel=Ur;re.VERSION=Zr;re.toFormData=Gt;re.AxiosError=B;re.Cancel=re.CanceledError;re.all=function(t){return Promise.all(t)};re.spread=Lo;re.isAxiosError=No;re.mergeConfig=Qe;re.AxiosHeaders=Se;re.formToJSON=s=>$r(j.isHTMLForm(s)?new FormData(s):s);re.getAdapter=Gr.getAdapter;re.HttpStatusCode=xs;re.default=re;const{Axios:Xl,AxiosError:Yl,CanceledError:ea,isCancel:ta,CancelToken:sa,VERSION:ra,all:na,Cancel:ia,isAxiosError:oa,spread:la,toFormData:aa,AxiosHeaders:ca,HttpStatusCode:da,formToJSON:ua,getAdapter:ha,mergeConfig:pa}=re;async function zo(s,t){try{console.log("Sending to backend:",{purchaseOrderId:s,items:t});const r=await re.post("/api/receive-purchase-order",{purchaseOrderId:s,items:t});console.log("Purchase order received successfully:",r.data)}catch(r){throw console.error("Error receiving purchase order:",r),new Error("Failed to receive purchase order")}}const Xr=({open:s,onClose:t,poId:r,orderNumber:i,items:n,onConfirm:o})=>{const[l,a]=p.useState([]),[c,d]=p.useState(!0),[u,h]=p.useState(!1);p.useEffect(()=>{s&&(d(!0),a(n.map(x=>({id:x.id,product_id:x.product_id,ProductName:x.ProductName,quantity_ordered:x.quantity_ordered??0,quantity_received:x.quantity_received??x.quantity_ordered??0}))),d(!1))},[n,s]);const g=(x,m)=>{let y=0;if(m==="")y=0;else if(/^\d+$/.test(m))y=parseInt(m,10);else return;a(_=>_.map(D=>D.id===x?{...D,quantity_received:y}:D))},b=async()=>{try{const x=l.map(({product_id:m,quantity_received:y})=>({product_id:String(m),quantity_received:y}));await zo(String(r),x),h(!0),t()}catch(x){console.error("Error receiving purchase order:",x),alert("Failed to receive purchase order. Please try again.")}};return e.jsxs(e.Fragment,{children:[e.jsx(we,{open:s,onClose:t,"aria-labelledby":"receive-po-dialog-title",children:e.jsxs(ve,{sx:{minWidth:400},children:[e.jsx(We,{}),e.jsxs(w,{id:"receive-po-dialog-title",level:"h4",sx:{mb:2},children:["Receive Purchase Order #",i??r]}),c?e.jsx(w,{children:"Loading items..."}):l.length===0?e.jsx(w,{children:"No items found for this purchase order."}):e.jsxs(Te,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Ordered"}),e.jsx("th",{children:"Received"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:l.map(x=>e.jsxs("tr",{children:[e.jsx("td",{children:x.ProductName}),e.jsx("td",{children:x.quantity_ordered}),e.jsx("td",{children:e.jsx(F,{type:"number",value:x.quantity_received===0&&l.find(m=>m.id===x.id)?.quantity_received===0?"0":x.quantity_received,onChange:m=>g(x.id,m.target.value),sx:{width:80},slotProps:{input:{min:0,max:x.quantity_ordered}}})}),e.jsx("td",{style:{textAlign:"center"},children:x.quantity_received===x.quantity_ordered?e.jsx(Nn,{sx:{color:"#2e7d32"},titleAccess:"Received in full"}):e.jsx(Sr,{sx:{color:"#d32f2f"},titleAccess:"Not fully received"})})]},x.id))})]}),e.jsxs(S,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:3},children:[e.jsx(q,{variant:"plain",onClick:t,children:"Cancel"}),e.jsx(q,{variant:"solid",onClick:b,children:"Receive"})]})]})}),e.jsx(Ut,{open:u,autoHideDuration:3e3,onClose:()=>h(!1),color:"success",variant:"soft",anchorOrigin:{vertical:"top",horizontal:"center"},children:"Purchase order received successfully!"})]})},lr={Pending:0,Ordered:1,Received:2,Cancelled:3},Mo=({orders:s})=>{const[t,r]=p.useState(s),[i,n]=p.useState(!1),[o,l]=p.useState(null),[a,c]=p.useState(""),[d,u]=p.useState(""),[h,g]=p.useState(!1),[b,x]=p.useState(!1),[m,y]=p.useState(null),[_,D]=p.useState([]);p.useEffect(()=>{async function k(){n(!0),l(null);const{data:A,error:T}=await O.from("PurchaseOrders").select("id, order_number, order_date, status, total, notes, Suppliers(name)").order("order_date",{ascending:!1});!T&&A?r(A.map(U=>({...U,supplier_name:U.Suppliers?.[0]?.name||"N/A",Suppliers:void 0}))):T&&l(T.message||"Failed to fetch purchase orders"),n(!1)}k()},[]);const v=[...t.filter(k=>{const A=k.order_number?.toString().toLowerCase().includes(a.toLowerCase())||k.supplier_name?.toLowerCase().includes(a.toLowerCase()),T=d?k.status===d:!0;return A&&T})].sort((k,A)=>{const T=lr[k.status]??99,U=lr[A.status]??99;return T!==U?T-U:new Date(A.order_date).getTime()-new Date(k.order_date).getTime()});return p.useEffect(()=>{b&&m&&(async()=>{const{data:k,error:A}=await O.from("purchaseorderitems").select("id, product_id, Products(ProductName), quantity_ordered, quantity_received").eq("purchase_order_id",m.id);!A&&k&&D(k)})()},[b,m]),e.jsxs(S,{sx:{width:"100%",minHeight:"100dvh",bgcolor:"background.body",p:2},children:[e.jsx(w,{level:"h2",sx:{mb:2},children:"Purchase Orders"}),e.jsxs(S,{sx:{display:"flex",flexDirection:"column",gap:1,mb:2},children:[e.jsx(F,{placeholder:"Search purchase orders...",value:a,onChange:k=>c(k.target.value)}),e.jsxs(le,{placeholder:"Filter status",value:d,onChange:(k,A)=>u(A??""),children:[e.jsx(M,{value:"",children:"All Statuses"}),e.jsx(M,{value:"Pending",children:"Pending"}),e.jsx(M,{value:"Approved",children:"Approved"}),e.jsx(M,{value:"Received",children:"Received"}),e.jsx(M,{value:"Cancelled",children:"Cancelled"})]}),e.jsx(q,{onClick:()=>g(!0),variant:"solid",children:"Add Purchase Order"})]}),e.jsx(as,{open:h,onClose:()=>g(!1),onCreated:async()=>{g(!1),n(!0);const{data:k,error:A}=await O.from("PurchaseOrders").select("id, order_number, order_date, status, total, notes, Suppliers(name)").order("order_date",{ascending:!1});!A&&k&&r(k.map(T=>({...T,supplier_name:T.Suppliers?.[0]?.name||"N/A",Suppliers:void 0}))),n(!1)},mode:"add",order:void 0}),e.jsx(Xr,{open:b,onClose:()=>x(!1),poId:m?.order_number||m?.id,items:_,onConfirm:async k=>{for(const U of k)await O.from("purchaseorderitems").update({quantity_received:U.quantity_received}).eq("id",U.id);m?.id&&await O.from("PurchaseOrders").update({status:"Received"}).eq("id",m.id),x(!1),n(!0);const{data:A,error:T}=await O.from("PurchaseOrders").select("id, order_number, order_date, status, total, notes, Suppliers(name)").order("order_date",{ascending:!1});!T&&A&&r(A.map(U=>({...U,supplier_name:U.Suppliers?.[0]?.name||"N/A",Suppliers:void 0}))),n(!1)}}),i&&e.jsx(Ze,{}),o&&e.jsxs(w,{color:"danger",children:["Error: ",o]}),e.jsx(Cr,{items:Array.isArray(v)?v:[],ariaLabel:"Purchase Orders Mobile View",renderItem:k=>k?e.jsxs(S,{children:[e.jsxs(w,{fontWeight:"bold",children:["Order Number: ",k.order_number]}),e.jsxs(w,{children:["Order Date: ",k.order_date]}),e.jsxs(w,{children:["Status: ",k.status]}),e.jsxs(w,{children:["Total: $",k.total?.toFixed(2)??"0.00"]}),e.jsxs(w,{children:["Supplier: ",k.supplier_name]}),e.jsx(S,{sx:{display:"flex",gap:1,mt:1},children:k.status==="Pending"?e.jsx(q,{size:"sm",variant:"outlined",onClick:async()=>{if(k.id){const{error:A}=await O.from("PurchaseOrders").update({status:"Ordered"}).eq("id",k.id);if(!A){n(!0);const{data:T,error:U}=await O.from("PurchaseOrders").select("id, order_number, order_date, status, total, notes, Suppliers(name)").order("order_date",{ascending:!1});!U&&T&&r(T.map(Q=>({...Q,supplier_name:Q.Suppliers?.[0]?.name||"N/A",Suppliers:void 0}))),n(!1)}}},children:"Order"}):e.jsx(q,{size:"sm",variant:"outlined",onClick:async()=>{y(k),x(!0)},disabled:k.status!=="Approved"&&k.status!=="Ordered",children:"Receive"})})]}):e.jsx(w,{color:"neutral",children:"No data"})})]})};function qo(){const[s,t]=p.useState([]),[r,i]=p.useState(!1),[n,o]=p.useState(null),[l,a]=p.useState(""),[c,d]=p.useState(""),[u,h]=p.useState(!1),[g,b]=p.useState(!1),[x,m]=p.useState(!1),[y,_]=p.useState(null),[D,I]=p.useState([]),v=Be("(max-width:600px)"),k={fontSize:ee.sizes.small},A={...k,fontWeight:600,borderBottom:"1.5px solid #e0e0e0",background:"inherit"};p.useEffect(()=>{async function L(){i(!0),o(null);const{data:P,error:C}=await O.from("PurchaseOrders").select("id, order_number, order_date, status, total, notes, Suppliers(name)").order("order_date",{ascending:!1});!C&&P?t(P):C&&o(C.message||"Failed to fetch purchase orders"),i(!1)}L()},[]);const T=async()=>{i(!0),o(null);const{data:L,error:P}=await O.from("PurchaseOrders").select("id, order_number, order_date, status, total, notes, Suppliers(name)").order("order_date",{ascending:!1});if(!P&&L){const C=L.map(N=>({...N,supplier_name:N.Suppliers?.[0]?.name||"N/A",Suppliers:void 0}));if(t(C),y){const{data:N,error:E}=await O.from("purchaseorderitems").select(`
            id,
            product_id,
            Products(ProductName),
            quantity_ordered,
            quantity_received
          `).eq("purchase_order_id",y.id);if(!E&&N){const $=N.map(he=>({...he,ProductName:he.Products[0]?.ProductName}));I($)}}}else P&&o(P.message||"Failed to fetch purchase orders");i(!1)};s.filter(L=>{const P=L.order_number?.toString().toLowerCase().includes(l.toLowerCase())||L.Suppliers?.name?.toLowerCase().includes(l.toLowerCase()),C=c?L.status===c:!0;return P&&C});const U=[{id:"order_number",label:"Order Number",minWidth:100},{id:"order_date",label:"Order Date",minWidth:100},{id:"status",label:"Status",minWidth:100},{id:"total",label:"Total",minWidth:100,format:L=>L!=null?`$${L.toFixed(2)}`:"$0.00"},{id:"notes",label:"Notes",minWidth:200},{id:"supplier_name",label:"Supplier",minWidth:150}],Q=s.map(L=>({...L,supplier_name:L.Suppliers?.name||"N/A"})),K=s.map(L=>({id:L.id||L.order_number,order_number:L.order_number,order_date:L.order_date,status:L.status,total:L.total??0,supplier_name:L.Suppliers?.name||L.supplier_name||"N/A",Suppliers:L.Suppliers}));return v?e.jsx(Mo,{orders:K}):e.jsx($e,{children:e.jsxs(S,{sx:{width:"100%",minHeight:"100dvh",bgcolor:"background.body",borderRadius:0,boxShadow:"none",pl:0,pr:0,pt:3,pb:0},children:[e.jsx(w,{level:"h2",sx:{mb:2,fontSize:ee.sizes.xlarge},children:"Purchase Orders"}),e.jsxs(S,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(F,{placeholder:"Search purchase orders...",sx:{flex:1},value:l,onChange:L=>a(L.target.value)}),e.jsxs(le,{placeholder:"Filter status",value:c,onChange:(L,P)=>d(P??""),sx:{minWidth:160},children:[e.jsx(M,{value:"",children:"All Statuses"}),e.jsx(M,{value:"Pending",children:"Pending"}),e.jsx(M,{value:"Approved",children:"Approved"}),e.jsx(M,{value:"Received",children:"Received"}),e.jsx(M,{value:"Cancelled",children:"Cancelled"})]}),e.jsx(q,{onClick:()=>h(!0),variant:"solid",children:"Add Purchase Order"})]}),e.jsx(as,{open:u,onClose:()=>h(!1),onCreated:T,mode:"add",order:void 0}),e.jsx(as,{open:g,onClose:()=>{b(!1),_(null)},onCreated:T,mode:"edit",order:y}),e.jsx(Xr,{open:x&&!!y?.id&&D.every(L=>!!L.id&&!!L.product_id),onClose:()=>m(!1),poId:y?.id,orderNumber:y?.order_number,items:D.filter(L=>!!L.id&&!!L.product_id),onConfirm:async L=>{for(const P of L)await O.from("purchaseorderitems").update({quantity_received:P.quantity_received}).eq("id",P.id);y?.id&&await O.from("PurchaseOrders").update({status:"Received"}).eq("id",y.id),m(!1),await T()}}),e.jsxs(Pe,{children:[r&&e.jsx(Ze,{}),n&&e.jsxs(w,{color:"danger",children:["Error: ",n]}),e.jsxs(Te,{"aria-label":"Purchase Orders",sx:{minWidth:800},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[U.map(L=>e.jsx("th",{style:A,children:L.label},L.id)),e.jsx("th",{style:{width:120,...A}})]})}),e.jsxs("tbody",{children:[Q.length===0&&!r&&e.jsx("tr",{children:e.jsx("td",{colSpan:U.length+1,style:{textAlign:"center",color:"#888",...k},children:"No purchase orders found."})}),Q.map((L,P)=>e.jsxs("tr",{style:{cursor:"pointer",height:48},children:[U.map(C=>e.jsx("td",{style:k,children:C.format?C.format(L[C.id]):L[C.id]},C.id)),e.jsx("td",{children:L.status==="Pending"?e.jsx(q,{size:"sm",variant:"outlined",onClick:async()=>{if(L.id){const{error:C}=await O.from("PurchaseOrders").update({status:"Ordered"}).eq("id",L.id);C?alert("Failed to update order: "+C.message):await T()}},children:"Order"}):e.jsx(q,{size:"sm",variant:"outlined",onClick:()=>{_(L),m(!0)},disabled:L.status!=="Approved"&&L.status!=="Ordered",children:"Receive"})})]},L.id||L.order_number))]})]})]})]})})}function Fo({value:s,onChange:t,toggleSidebar:r}){const i=Cs(),[n,o]=p.useState(!1),[l,a]=p.useState("Sales");if(i.pathname==="/login")return null;const c=p.useMemo(()=>jn({components:{MuiTableRow:{styleOverrides:{root:{"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}}}}}}),[]);Hn.filter(h=>h.showInMobile);const d=l?Ct[l].filter(h=>h.showInMobile):[],u=async h=>{const{data:g}=await O.auth.getSession();if(!g&&["orders","products","users","suppliers","purchaseorders","tickets","smscampaigns","movements"].includes(h)){console.warn("Authentication required for this page"),t("home");return}t(h)};return e.jsxs(yn,{theme:c,children:[e.jsxs(Sn,{open:n,onClose:()=>o(!1),children:[e.jsx(wn,{children:"Select Area"}),e.jsx(vn,{children:["Sales","Support","Marketing","Operations"].map(h=>e.jsx(Fs,{fullWidth:!0,variant:l===h?"contained":"outlined",onClick:()=>{a(h),o(!1)},sx:{my:1},children:h},h))}),e.jsx(kn,{children:e.jsx(Fs,{onClick:()=>o(!1),children:"Close"})})]}),e.jsx(Cn,{sx:{position:"fixed",bottom:0,left:0,right:0,zIndex:9999,backgroundColor:"rgba(0, 0, 255, 0.2)",overflow:"hidden"},children:e.jsx("div",{style:{display:"flex",flexDirection:"row",overflowX:"auto"},children:e.jsxs(_n,{showLabels:!0,value:s,onChange:(h,g)=>{u(g)},sx:{minWidth:"max-content",flex:1},children:[d.map(h=>e.jsx($s,{label:h.label,icon:h.icon,value:h.value,onClick:()=>u(h.value)},h.value)),e.jsx($s,{label:l||"",icon:e.jsx(zn,{}),onClick:h=>{h.stopPropagation(),o(!0)}})]})})})]})}function $o({open:s,onClose:t,onCreated:r}){const[i,n]=p.useState(""),[o,l]=p.useState(""),[a,c]=p.useState(!1),[d,u]=p.useState(null),h=async g=>{g.preventDefault(),c(!0),u(null);const b={subject:i,requester_name:o,status:"Open"};console.log("[DialogTicketCreate] Creating ticket with payload:",b);const{error:x,data:m}=await O.from("tickets").insert(b);x&&(u(x.message||JSON.stringify(x)),console.error("[DialogTicketCreate] Error creating ticket:",x)),c(!1),x||(n(""),l(""),t(),r&&r())};return e.jsx(we,{open:s,onClose:t,children:e.jsxs(ve,{sx:{minWidth:400},children:[e.jsx(w,{level:"title-md",sx:{mb:2},children:"Create Ticket"}),e.jsxs("form",{onSubmit:h,children:[e.jsx(F,{placeholder:"Subject",value:i,onChange:g=>n(g.target.value),sx:{mb:2},required:!0}),e.jsx(F,{placeholder:"Requester Name",value:o,onChange:g=>l(g.target.value),sx:{mb:2},required:!0}),d&&e.jsx(w,{color:"danger",sx:{mb:1},children:d}),e.jsx(q,{type:"submit",loading:a,disabled:a||!i||!o,variant:"solid",children:"Create"})]})]})})}const Uo=["Refund issued","Replacement sent","Order cancelled","Technical support provided","Information provided","Awaiting customer response","Other"],Bo=({open:s,onClose:t,onSubmit:r})=>{const[i,n]=V.useState(""),[o,l]=V.useState("");return V.useEffect(()=>{s||(n(""),l(""))},[s]),e.jsx(we,{open:s,onClose:t,children:e.jsxs(ve,{children:[e.jsx(qt,{children:"Resolve Ticket"}),e.jsxs(Ft,{sx:{display:"flex",flexDirection:"column",gap:2,minWidth:320},children:[e.jsx(le,{value:i,onChange:(a,c)=>n(c||""),placeholder:"Select resolution",required:!0,children:Uo.map(a=>e.jsx(M,{value:a,children:a},a))}),e.jsx(fr,{minRows:3,placeholder:"Resolution comment to customer...",value:o,onChange:a=>l(a.target.value)})]}),e.jsxs($t,{children:[e.jsx(q,{variant:"plain",onClick:t,children:"Cancel"}),e.jsx(q,{variant:"solid",color:"primary",disabled:!i,onClick:()=>{try{r(i,o),t()}catch(a){console.error("Error during form submission:",a)}},children:"Submit"})]})]})})},Wo=Ps(Bo),Ho=s=>{if(!s)return"";const t=new Date(s),i=Math.floor((new Date().getTime()-t.getTime())/1e3);if(i<60)return"Just now";const n=Math.floor(i/60);if(n<60)return`${n} min ago`;const o=Math.floor(n/60);if(o<24)return`${o} hour${o>1?"s":""} ago`;const l=Math.floor(o/24);if(l<7)return`${l} day${l>1?"s":""} ago`;const a=Math.floor(l/7);if(a<4)return`${a} week${a>1?"s":""} ago`;const c=Math.floor(l/30);return`${c} month${c>1?"s":""} ago`};function Vo(){const[s,t]=p.useState([]),[r,i]=p.useState(null),[n,o]=p.useState([]),[l,a]=p.useState(""),[c,d]=p.useState(""),[u,h]=p.useState("Open"),[g,b]=p.useState(!1),[x,m]=p.useState(!1);p.useEffect(()=>{(async()=>{const{data:k,error:A}=await O.from("tickets").select("*").order("created_at",{ascending:!1});A||t(k||[])})()},[]),p.useEffect(()=>{if(!r){o([]);return}(async()=>{const{data:k,error:A}=await O.from("ticketactivities").select("*").eq("ticket_id",r).order("timestamp",{ascending:!0});A||o(k||[])})()},[r]);const y=async()=>{const{data:v,error:k}=await O.from("tickets").select("*").order("created_at",{ascending:!1});k||t(v||[])},_=async()=>{if(l.trim()&&r){console.log("Sending message:",{ticket_id:r,message:l,activity_type:"chat",sender_name:"You"});const{error:v,data:k}=await O.from("ticketactivities").insert({ticket_id:r,message:l,activity_type:"chat",sender_name:"You"}).select();if(v){console.error("Error sending message:",v),alert("Failed to send message: "+v.message);return}console.log("Message sent successfully:",k),a("");const{data:A,error:T}=await O.from("ticketactivities").select("*").eq("ticket_id",r).order("timestamp",{ascending:!0});T?console.error("Error fetching activities:",T):(console.log("Refreshed activities:",A),o(A||[]))}},D=async(v,k)=>{if(r)try{const{error:A}=await O.from("tickets").update({status:"Closed"}).eq("id",r);if(A){console.error("Error updating ticket status:",A),alert("Failed to resolve ticket: "+A.message);return}const{error:T}=await O.from("ticketactivities").insert({ticket_id:r,message:`Ticket resolved: ${v}${k?` - ${k}`:""}`,activity_type:"chat",sender_name:"You"});T&&console.error("Error adding resolution activity:",T),await y();const{data:U}=await O.from("ticketactivities").select("*").eq("ticket_id",r).order("timestamp",{ascending:!0});o(U||[])}catch(A){console.error("Error resolving ticket:",A),alert("Failed to resolve ticket")}},I=s.filter(v=>{if(u!=="All"&&v.status!==u)return!1;if(!c)return!0;const k=c.toLowerCase();return v.subject?.toLowerCase().includes(k)||v.requester_name?.toLowerCase().includes(k)||v.status?.toLowerCase().includes(k)});return e.jsxs(mr,{disableTransitionOnChange:!0,children:[e.jsx(Pn,{}),e.jsx(S,{sx:{display:"flex",flexDirection:"column",minHeight:"100dvh"},children:e.jsxs(S,{sx:{display:"flex",flex:1},children:[e.jsxs(S,{sx:{width:390,borderRight:"1px solid",borderColor:"divider",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs(S,{sx:{px:2,py:1,borderBottom:"1px solid",borderColor:"divider",flexShrink:0},children:[e.jsxs(ke,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[e.jsxs(ke,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(w,{level:"title-lg",children:"Messages"}),e.jsx(ie,{size:"sm",variant:"soft",color:"neutral",children:I.length})]}),e.jsx(oe,{size:"sm",variant:"soft",color:"primary",onClick:()=>b(!0),children:e.jsx(qe,{})})]}),e.jsx(F,{placeholder:"Search",startDecorator:e.jsx(Fe,{}),value:c,onChange:v=>d(v.target.value),size:"sm",sx:{width:"100%",mb:1}}),e.jsxs(le,{value:u,onChange:(v,k)=>h(k),size:"sm",sx:{width:"100%"},placeholder:"Filter by status",children:[e.jsx(M,{value:"All",children:"All Tickets"}),e.jsx(M,{value:"Open",children:"Open"}),e.jsx(M,{value:"Pending",children:"Pending"}),e.jsx(M,{value:"Closed",children:"Closed"})]})]}),e.jsx(S,{sx:{flex:1,overflowY:"auto",overflowX:"hidden",pt:1},children:e.jsx(pt,{size:"sm",sx:{gap:0},children:I.map(v=>e.jsxs(p.Fragment,{children:[e.jsx(st,{sx:{p:0},children:e.jsx(Ne,{selected:r===v.id,onClick:()=>i(v.id),sx:{py:1,px:2},children:e.jsxs(ke,{direction:"row",spacing:1.5,alignItems:"flex-start",sx:{width:"100%"},children:[e.jsx(S,{sx:{position:"relative"},children:e.jsx(Ee,{})}),e.jsxs(S,{sx:{flex:1,minWidth:0,pr:1},children:[e.jsxs(ke,{direction:"row",justifyContent:"space-between",alignItems:"flex-start",sx:{mb:.5},children:[e.jsx(w,{level:"body-md",noWrap:!0,sx:{flex:1,pr:1},children:v.subject||"Untitled"}),v.status&&e.jsx(ie,{size:"sm",color:v.status==="Open"?"success":v.status==="Pending"?"warning":v.status==="Closed"?"neutral":"primary",variant:"soft",sx:{flexShrink:0},children:v.status})]}),e.jsx(w,{level:"body-sm",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",mb:.5},children:v.requester_name||""}),e.jsx(S,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(w,{level:"body-xs",sx:{color:"text.tertiary"},children:Ho(v.updated_at)})})]})]})})}),e.jsx(xr,{component:"li",sx:{margin:0}})]},v.id))})})]}),e.jsxs(S,{sx:{flex:1,display:"flex",flexDirection:"column"},children:[r&&e.jsx(S,{sx:{px:3,py:2,borderBottom:"1px solid",borderColor:"divider",flexShrink:0},children:e.jsxs(ke,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(Ee,{size:"sm"}),e.jsxs(S,{sx:{flex:1},children:[e.jsx(w,{level:"title-sm",sx:{fontWeight:600},children:s.find(v=>v.id===r)?.requester_name||"Unknown User"}),e.jsx(w,{level:"body-xs",sx:{color:"text.secondary"},children:s.find(v=>v.id===r)?.status||"Unknown Status"})]}),e.jsx(q,{variant:"outlined",size:"sm",sx:{borderRadius:"16px"},children:"View profile"}),s.find(v=>v.id===r)?.status!=="Closed"&&e.jsx(q,{variant:"solid",color:"primary",size:"sm",sx:{borderRadius:"16px"},onClick:()=>m(!0),children:"Resolve"})]})}),e.jsx(S,{sx:{flex:1,overflowY:"auto",px:3,py:2},children:r?e.jsx(ke,{spacing:3,children:n.map((v,k)=>{const A=v.sender_name==="You";return e.jsxs(S,{children:[k===0||new Date(v.timestamp||"").toDateString()!==new Date(n[k-1]?.timestamp||"").toDateString()?e.jsxs(S,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(S,{sx:{flex:1,height:"1px",bgcolor:"divider"}}),e.jsx(w,{level:"body-xs",sx:{mx:2,color:"text.secondary"},children:v.timestamp?new Date(v.timestamp).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}):""}),e.jsx(S,{sx:{flex:1,height:"1px",bgcolor:"divider"}})]}):null,e.jsxs(ke,{direction:"row",spacing:1,sx:{alignItems:"flex-start"},children:[!A&&e.jsx(Ee,{size:"sm"}),e.jsx(S,{sx:{flex:1,display:"flex",flexDirection:A?"row-reverse":"row"},children:e.jsxs(S,{sx:{maxWidth:"70%",bgcolor:A?"primary.500":"neutral.50",color:A?"white":"text.primary",borderRadius:A?"18px 18px 4px 18px":"18px 18px 18px 4px",px:2,py:1.5,position:"relative",boxShadow:"sm"},children:[!A&&e.jsx(w,{level:"body-xs",sx:{fontWeight:600,mb:.5,color:A?"white":"text.primary"},children:v.sender_name}),e.jsx(w,{level:"body-sm",sx:{lineHeight:1.4,color:A?"white":"text.primary"},children:v.message})]})}),A&&e.jsx(Ee,{size:"sm"})]}),e.jsx(S,{sx:{display:"flex",justifyContent:A?"flex-end":"flex-start",mt:.5,ml:A?0:5},children:e.jsx(w,{level:"body-xs",sx:{color:"text.tertiary"},children:v.timestamp?new Date(v.timestamp).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):""})})]},v.id)})}):e.jsx(S,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx(w,{level:"body-md",sx:{color:"text.secondary"},children:"Select a ticket to view messages"})})}),r&&e.jsx(S,{sx:{px:3,py:2,borderTop:"1px solid",borderColor:"divider",flexShrink:0},children:e.jsxs(ke,{direction:"row",spacing:1,alignItems:"flex-end",children:[e.jsx(S,{sx:{flex:1},children:e.jsx(fr,{placeholder:"Type something here...",value:l,onChange:v=>a(v.target.value),minRows:1,maxRows:4,sx:{borderRadius:"20px",border:"1px solid",borderColor:"neutral.300","&:focus-within":{borderColor:"primary.500"},"& textarea":{border:"none",outline:"none",resize:"none",px:2,py:1}},onKeyDown:v=>{v.key==="Enter"&&!v.shiftKey&&(v.preventDefault(),_())}})}),e.jsx(q,{onClick:_,disabled:!l.trim(),variant:"solid",color:"primary",sx:{borderRadius:"20px",minWidth:60,height:40,fontWeight:600},children:"Send"})]})})]})]})}),e.jsx($o,{open:g,onClose:()=>b(!1),onCreated:y}),e.jsx(Wo,{open:x,onClose:()=>m(!1),onSubmit:D})]})}const _e={fontSize:ee.sizes.small},ct={..._e,fontWeight:600,borderBottom:"1.5px solid #e0e0e0",background:"inherit"};function Jo({campaigns:s}){const[t,r]=p.useState(s),[i,n]=p.useState(!1),[o,l]=p.useState(null),[a,c]=p.useState(""),[d,u]=p.useState(""),[h,g]=p.useState(!1),b=Be("(max-width: 600px)");p.useEffect(()=>{async function m(){n(!0),l(null);const{data:y,error:_}=await O.from("sms_campaigns").select("*").order("created_at",{ascending:!1});_?(l(_.message),r([])):y&&r(y),n(!1)}m()},[]);const x=t.filter(m=>{const y=m.name.toLowerCase().includes(a.toLowerCase())||m.CampaignNumber?.toLowerCase().includes(a.toLowerCase()),_=!d||m.status===d;return y&&_});return b?e.jsx("div",{children:"Mobile view coming soon..."}):e.jsx($e,{children:e.jsxs(S,{sx:{width:"100%",minHeight:"100dvh",bgcolor:"background.body",borderRadius:0,boxShadow:"none",pl:0,pr:0,pt:3,pb:0},children:[e.jsx(w,{level:"h2",sx:{..._e,mb:2,textAlign:"left",fontSize:ee.sizes.xlarge},children:"SMS Campaigns"}),e.jsxs(S,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(F,{placeholder:"Search campaigns...",sx:{..._e,flex:1},value:a,onChange:m=>c(m.target.value)}),e.jsxs(le,{placeholder:"Filter status",value:d,onChange:(m,y)=>u(y??""),sx:{..._e,minWidth:160},children:[e.jsx(M,{value:"",children:"All Statuses"}),e.jsx(M,{value:"draft",children:"Draft"}),e.jsx(M,{value:"scheduled",children:"Scheduled"}),e.jsx(M,{value:"sent",children:"Sent"}),e.jsx(M,{value:"failed",children:"Failed"})]}),e.jsx(q,{onClick:()=>g(!0),variant:"solid",sx:_e,children:"Create Campaign"})]}),e.jsxs(Pe,{children:[i&&e.jsx(Ze,{}),e.jsxs(Te,{"aria-label":"Campaigns",sx:{minWidth:800},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:ct,children:"Campaign #"}),e.jsx("th",{style:ct,children:"Name"}),e.jsx("th",{style:ct,children:"Status"}),e.jsx("th",{style:ct,children:"Scheduled"}),e.jsx("th",{style:ct,children:"Recipients"})]})}),e.jsxs("tbody",{children:[x.length===0&&!i&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{textAlign:"center",color:"#888",..._e},children:"No campaigns found."})}),x.map(m=>e.jsxs("tr",{style:{height:48},children:[e.jsx("td",{style:_e,children:m.CampaignNumber}),e.jsx("td",{style:_e,children:m.name}),e.jsx("td",{style:_e,children:e.jsx(ie,{variant:"soft",color:m.status==="sent"?"success":m.status==="failed"?"danger":m.status==="scheduled"?"warning":"neutral",size:"sm",sx:{textTransform:"capitalize",..._e},children:m.status})}),e.jsx("td",{style:_e,children:m.scheduled_at?Fn(new Date(m.scheduled_at),"yyyy-MM-dd HH:mm"):"-"}),e.jsx("td",{style:_e,children:m.recipients?.length??0})]},m.id))]})]})]}),o&&e.jsxs(w,{color:"danger",children:["Error: ",o]}),e.jsx(we,{open:h,onClose:()=>g(!1),children:e.jsxs(ve,{children:[e.jsx(w,{level:"h4",children:"Create New Campaign"}),e.jsx(q,{onClick:()=>g(!1),children:"Close"})]})})]})})}function rs(s,t){return t===0?s>0?100:0:(s-t)/t*100}function ns(s){return s==null?"—":`${s>0?"+":s<0?"−":""}${Math.abs(Math.round(s))}%`}async function Go(){const s=new Date,t=s.toISOString().slice(0,10),r=new Date(s.getTime()-30*24*60*60*1e3).toISOString().slice(0,10),i=new Date(s.getTime()-60*24*60*60*1e3).toISOString().slice(0,10),n=new Date(s.getTime()-30*24*60*60*1e3-1).toISOString().slice(0,10),o=await O.from("Orders").select("order_total, customer_email, date",{count:"exact"}).not("order_total","is",null);if(o.error||!o.data)throw new Error("Failed to fetch order stats");const l=o.data,a=l.filter(m=>m.date&&m.date>=r&&m.date<=t),c=l.filter(m=>m.date&&m.date>=i&&m.date<=n),d=a.reduce((m,y)=>m+(typeof y.order_total=="number"?y.order_total:0),0),u=c.reduce((m,y)=>m+(typeof y.order_total=="number"?y.order_total:0),0),h=a.length,g=c.length,b=new Set(a.map(m=>m.customer_email).filter(Boolean)),x=new Set(c.map(m=>m.customer_email).filter(Boolean));return{totalSales:d,orderCount:h,customerCount:b.size,salesChange:rs(d,u),ordersChange:rs(h,g),customersChange:rs(b.size,x.size)}}const Zo=()=>{const[s,t]=p.useState(null),[r,i]=p.useState(null),[n,o]=p.useState(null),[l,a]=p.useState(null),[c,d]=p.useState(null),[u,h]=p.useState(null),[g,b]=p.useState(!0),[x,m]=p.useState(null);return Be("(max-width:600px)"),p.useEffect(()=>{let y=!0,_=!0;async function D(){_&&b(!0),m(null);try{const{totalSales:v,orderCount:k,customerCount:A,salesChange:T,ordersChange:U,customersChange:Q}=await Go();y&&(t(v),i(k),o(A),a(T),d(U),h(Q))}catch(v){y&&m(v.message)}finally{_&&b(!1),_=!1}}D();const I=setInterval(D,1e4);return()=>{y=!1,clearInterval(I)}},[]),e.jsxs(S,{sx:{p:{xs:1,md:4},pt:{xs:0,md:4}},children:[e.jsx(w,{level:"h2",sx:{mb:2},children:"Dashboard"}),e.jsxs(rt,{container:!0,spacing:2,children:[e.jsx(rt,{xs:12,md:4,children:e.jsxs(Pe,{variant:"outlined",children:[e.jsx(w,{level:"h4",children:"Total Sales"}),e.jsx(w,{level:"h2",color:"success",children:g?"Loading...":x?"—":`$${s?.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`}),e.jsxs(w,{level:"body-sm",color:"neutral",children:[g?"":ns(l)," from last 30 days"]})]})}),e.jsx(rt,{xs:12,md:4,children:e.jsxs(Pe,{variant:"outlined",children:[e.jsx(w,{level:"h4",children:"Orders"}),e.jsx(w,{level:"h2",color:"primary",children:g?"Loading...":x?"—":r?.toLocaleString()}),e.jsxs(w,{level:"body-sm",color:"neutral",children:[g?"":ns(c)," from last 30 days"]})]})}),e.jsx(rt,{xs:12,md:4,children:e.jsxs(Pe,{variant:"outlined",children:[e.jsx(w,{level:"h4",children:"Customers"}),e.jsx(w,{level:"h2",color:"warning",children:g?"Loading...":x?"—":n?.toLocaleString()}),e.jsxs(w,{level:"body-sm",color:"neutral",children:[g?"":ns(u)," new last 30 days"]})]})})]})]})},Ae=({children:s})=>{const[t,r]=p.useState(null),[i,n]=p.useState(!0);return p.useEffect(()=>{async function o(){const{data:l}=await O.auth.getSession();r(l?.session||null),n(!1)}o()},[]),i?e.jsx("div",{children:"Loading..."}):t?e.jsx(e.Fragment,{children:s}):e.jsx(It,{to:"/",replace:!0})};function Qo({onLogin:s}){const t=Bt(),[r,i]=p.useState(""),[n,o]=p.useState(""),[l,a]=p.useState(!1),[c,d]=p.useState(null);p.useEffect(()=>{if(window.location.pathname==="/login"){async function g(){const{data:b}=await O.auth.getSession();b?.session&&t("/dashboard")}g()}},[t]);async function u(g){g.preventDefault(),a(!0),d(null);const{data:b,error:x}=await O.auth.signInWithPassword({email:r,password:n});if(x){console.error("[Login] Auth error:",x),d(x.message),a(!1);return}const m=b.user?.id;if(!m){d("Login failed: No user ID."),a(!1);return}let{data:y,error:_}=await O.from("users").select("*").eq("id",m).single();if(_||!y){console.error("[Login] User fetch error:",_);const{error:D}=await O.from("users").upsert({id:m,email:b.user.email,name:b.user.user_metadata?.full_name||b.user.user_metadata?.name||"",role:"employee"});if(D){console.error("Upsert failed:",D),d("Upsert failed: "+D.message),a(!1);return}let I=3,v,k;for(;I>0;){await new Promise(U=>setTimeout(U,300));const{data:A,error:T}=await O.from("users").select("*").eq("id",m).single();if(v=A,k=T,k&&console.error("[Login] Retry user fetch error:",k),v&&!k){y=v,_=null;break}I--}if(_||!y){d("Access denied: User not found."),await O.auth.signOut(),a(!1);return}}if(y.role!=="employee"){d("Access denied: Only employees can access this app."),await O.auth.signOut(),a(!1);return}a(!1),s(),t("/dashboard")}async function h(){a(!0),d(null),a(!1)}return e.jsx(S,{sx:{minHeight:"100dvh",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.body"},children:e.jsxs(Pe,{sx:{minWidth:340,p:4},children:[e.jsx(w,{level:"h3",sx:{mb:2},children:"Sign in to Smartbuy"}),e.jsxs("form",{onSubmit:u,children:[e.jsx(F,{type:"email",placeholder:"Email",value:r,onChange:g=>i(g.target.value),sx:{mb:2},required:!0}),e.jsx(F,{type:"password",placeholder:"Password",value:n,onChange:g=>o(g.target.value),sx:{mb:2},required:!0}),e.jsx(q,{type:"submit",loading:l,fullWidth:!0,sx:{mb:1},children:"Sign In"})]}),e.jsx(q,{onClick:h,variant:"outlined",fullWidth:!0,sx:{mb:1},disabled:l,children:"Sign in with Google"}),c&&e.jsx(w,{color:"danger",sx:{mt:1},children:c})]})})}function Ko(){return e.jsx(_s,{children:e.jsx(fe,{path:"*",element:e.jsx(Qo,{onLogin:()=>{}})})})}const de={fontSize:ee.sizes.small},Xo=()=>{const{isMobile:s}=He();kr();const[t,r]=p.useState([]),[i,n]=p.useState([]),[o,l]=p.useState(""),[a,c]=p.useState(!1),[d,u]=p.useState(!1),[h,g]=p.useState(""),[b,x]=p.useState(""),[m,y]=p.useState(""),[_,D]=p.useState(""),[I,v]=p.useState(null),[k,A]=p.useState(!1),[T,U]=p.useState(""),[Q,K]=p.useState(""),[L,P]=p.useState(!1),[C,N]=p.useState(!1),[E,$]=p.useState(""),[he,Re]=p.useState("success"),ne=(f,z="success")=>{$(f),Re(z),N(!0)},je=async()=>{try{const{data:f,error:z}=await O.from("stock_movements").select(`
                    *,
                    Products (
                        ProductName,
                        ProductID
                    )
                `).order("date",{ascending:!1});z?(console.error("Error fetching movements:",z),r([]),ne("Failed to load movements","danger")):r(f||[])}catch(f){console.error("Unexpected error:",f),r([]),ne("An unexpected error occurred","danger")}},Le=async()=>{try{const{data:f,error:z}=await O.from("Products").select("*").order("ProductName");z?(console.error("Error fetching products:",z),n([])):n(f||[])}catch(f){console.error("Unexpected error:",f),n([])}},Ve=async f=>{if(!f){v(null);return}A(!0);try{const{data:z,error:Z}=await O.from("stock_movements").select("movement_type, quantity").eq("product_id",f);if(Z)console.error("Error fetching stock movements:",Z),v(null);else{const H=(z||[]).reduce((te,se)=>{switch(se.movement_type){case"incoming":return te+se.quantity;case"outgoing":return te-se.quantity;case"adjustment":return te+se.quantity;default:return te}},0);v(H)}}catch(z){console.error("Error calculating stock:",z),v(null)}finally{A(!1)}};p.useEffect(()=>{_?Ve(_):v(null)},[_]);const lt=async()=>{if(!_||T===""||I===null){ne("Please select a product and enter a valid stock level","warning");return}const z=Number(T)-I;if(z===0){ne("No adjustment needed - the stock level is already at the specified amount","warning");return}P(!0);try{const{error:Z}=await O.from("stock_movements").insert({product_id:_,movement_type:"adjustment",quantity:z,reason:`Manual adjustment: ${Q||"Stock level correction"}`,date:new Date().toISOString()});Z?(console.error("Error creating adjustment:",Z),ne("Failed to create adjustment: "+Z.message,"danger")):(D(""),U(""),K(""),v(null),c(!1),je(),ne("Stock adjustment created successfully!","success"))}catch(Z){console.error("Unexpected error:",Z),ne("An unexpected error occurred","danger")}finally{P(!1)}};p.useEffect(()=>{je(),Le()},[]);const Ue=t.filter(f=>{const z=o.toLowerCase(),Z=o===""||f.id.toLowerCase().includes(z)||f.product_id.toLowerCase().includes(z)||f.movement_type.toLowerCase().includes(z)||(f.reason?.toLowerCase().includes(z)??!1)||(f.Products?.ProductName?.toLowerCase().includes(z)??!1),H=h===""||f.movement_type===h,te=b===""||f.product_id===b,se=m===""||(()=>{const xe=f.reason?.toLowerCase()||"";switch(m){case"manual":return xe.includes("manual")||xe.includes("adjustment")||xe.includes("correction");case"damage":return xe.includes("damage")||xe.includes("broken")||xe.includes("defect");case"loss":return xe.includes("loss")||xe.includes("lost")||xe.includes("missing");case"found":return xe.includes("found")||xe.includes("surplus")||xe.includes("extra");case"po":return xe.includes("po")||xe.includes("purchase")||xe.includes("receipt");default:return!0}})();return Z&&H&&te&&se}),Ce=f=>{switch(f.movement_type){case"incoming":return"success";case"outgoing":return"danger";case"adjustment":return f.quantity>=0?"success":"danger";default:return"neutral"}},Ye=f=>{switch(f.movement_type){case"incoming":return"↑";case"outgoing":return"↓";case"adjustment":return"⚖";default:return"•"}},et=f=>{switch(f.movement_type){case"incoming":return`+${f.quantity}`;case"outgoing":return`-${f.quantity}`;case"adjustment":return f.quantity>=0?`+${f.quantity}`:`${f.quantity}`;default:return f.quantity}},tt=()=>{g(""),x(""),y("")},R=h!==""||b!==""||m!=="",W=()=>e.jsxs(S,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(nt,{padding:"medium",children:[e.jsx(w,{level:"h2",sx:{mb:2,fontSize:ee.sizes.xlarge},children:"Stock Movements"}),e.jsxs(S,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(F,{placeholder:"Search movements...",value:o,onChange:f=>l(f.target.value),startDecorator:e.jsx(Fe,{}),sx:{flex:1}}),e.jsx(oe,{variant:R?"solid":"soft",color:R?"primary":"neutral",size:"sm",onClick:()=>u(!0),children:e.jsx(ks,{})})]}),R&&e.jsxs(S,{sx:{mb:2,display:"flex",gap:1,flexWrap:"wrap"},children:[h&&e.jsxs(ie,{size:"sm",variant:"soft",color:"primary",children:["Type: ",h]}),b&&e.jsxs(ie,{size:"sm",variant:"soft",color:"primary",children:["Product: ",i.find(f=>f.uuid===b)?.ProductName||"Selected"]}),m&&e.jsxs(ie,{size:"sm",variant:"soft",color:"primary",children:["Reason: ",m]})]})]}),e.jsx(S,{children:Ue.length===0?e.jsx(S,{sx:{textAlign:"center",py:6},children:e.jsx(w,{color:"neutral",children:"No stock movements found"})}):Ue.map(f=>e.jsx(S,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(S,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${Ce(f)}.100`,color:`${Ce(f)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",flexShrink:0},children:Ye(f)}),e.jsxs(S,{sx:{flex:1,minWidth:0},children:[e.jsxs(S,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(w,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:f.Products?.ProductName||"Unknown Product"}),e.jsx(ie,{size:"sm",color:Ce(f),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content"},children:et(f)})]}),e.jsxs(w,{level:"body-xs",color:"neutral",sx:{mb:.5},children:["ID: ",f.Products?.ProductID||"N/A"," • ",new Date(f.date).toLocaleDateString()]}),f.reason&&e.jsx(w,{level:"body-xs",color:"neutral",sx:{fontStyle:"italic",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:f.reason})]})]})},f.id))}),e.jsx(oe,{color:"primary",variant:"soft",size:"sm",sx:{position:"fixed",bottom:80,right:16,zIndex:1e3,borderRadius:"8px",width:40,height:40,boxShadow:"sm",bgcolor:"primary.100","&:hover":{bgcolor:"primary.200",boxShadow:"md"}},onClick:()=>c(!0),children:e.jsx(qe,{fontSize:"small"})})]}),pe=()=>e.jsxs(nt,{variant:"page",padding:"large",children:[e.jsx(w,{level:"h2",sx:{mb:2,fontSize:ee.sizes.xlarge},children:"Stock Movements"}),e.jsxs(S,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(F,{placeholder:"Search movements...",sx:{flex:1,fontSize:ee.sizes.small},value:o,onChange:f=>l(f.target.value),startDecorator:e.jsx(Fe,{})}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(qe,{}),onClick:()=>c(!0),sx:{fontSize:ee.sizes.small},children:"Adjust"})]}),e.jsx(Pe,{children:e.jsxs(Te,{"aria-label":"Stock Movements",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:de,children:"ID"}),e.jsx("th",{style:de,children:"Product"}),e.jsx("th",{style:de,children:"Movement Type"}),e.jsx("th",{style:de,children:"Quantity"}),e.jsx("th",{style:de,children:"Reason"}),e.jsx("th",{style:de,children:"Date"})]})}),e.jsxs("tbody",{children:[Ue.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{textAlign:"center",color:"#888",...de},children:"No stock movements found."})}),Ue.map(f=>e.jsxs("tr",{style:{cursor:"pointer"},children:[e.jsxs("td",{style:de,children:[f.id.substring(0,8),"..."]}),e.jsx("td",{style:de,children:f.Products?e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:f.Products.ProductName}),e.jsxs("div",{style:{fontSize:"0.8em",color:"#666"},children:["ID: ",f.Products.ProductID]})]}):e.jsx("span",{style:{color:"#999",fontStyle:"italic"},children:"Unknown Product"})}),e.jsx("td",{style:de,children:e.jsx(ie,{size:"sm",variant:"soft",color:Ce(f),children:f.movement_type==="incoming"?"↑ Incoming":f.movement_type==="outgoing"?"↓ Outgoing":"⚖ Adjustment"})}),e.jsx("td",{style:de,children:e.jsx("span",{style:{fontWeight:"bold",color:Ce(f)==="success"?"#059669":Ce(f)==="danger"?"#dc2626":"#666"},children:et(f)})}),e.jsx("td",{style:de,children:f.reason||"N/A"}),e.jsx("td",{style:de,children:new Date(f.date).toLocaleString()})]},f.id))]})]})})]});return e.jsxs($e,{children:[s?e.jsx(W,{}):e.jsx(pe,{}),e.jsx(Dt,{open:a,onClose:()=>c(!1),title:"Manual Stock Adjustment",size:"medium",actions:e.jsxs(S,{sx:{display:"flex",gap:2},children:[e.jsx(q,{variant:"plain",onClick:()=>c(!1),sx:de,children:"Cancel"}),e.jsx(q,{variant:"solid",onClick:lt,loading:L,disabled:!_||T===""||I===null||Number(T)===I,sx:de,children:"Create Adjustment"})]}),children:e.jsxs(ke,{spacing:2,children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Product"}),e.jsx(le,{placeholder:"Select a product...",value:_,onChange:(f,z)=>D(z||""),children:i.map(f=>e.jsxs(M,{value:f.uuid,children:[f.ProductName," (ID: ",f.ProductID,")"]},f.uuid))})]}),_&&e.jsxs(X,{children:[e.jsx(Y,{children:"Current Stock Level"}),e.jsx(F,{value:k?"Loading...":I!==null?I:"N/A",readOnly:!0,sx:{bgcolor:"neutral.100",color:I!==null&&I<=0?"danger.500":"neutral.600"}}),I!==null&&I<=0&&e.jsx(w,{level:"body-sm",sx:{color:"danger.500",mt:.5},children:"⚠️ Warning: Product is at or below zero stock level"})]}),I!==null&&e.jsxs(X,{children:[e.jsx(Y,{children:"Actual Stock Level"}),e.jsx(F,{type:"number",placeholder:"Enter the actual stock level...",value:T,onChange:f=>U(f.target.value),sx:{...de},slotProps:{input:{min:0,max:999999}}}),T!==""&&I!==null&&e.jsx(w,{level:"body-sm",sx:{mt:.5,color:Number(T)>I?"success.600":Number(T)<I?"danger.600":"neutral.600"},children:Number(T)>I?`+${Number(T)-I} (increase)`:Number(T)<I?`${Number(T)-I} (decrease)`:"No change needed"})]}),e.jsxs(X,{children:[e.jsx(Y,{children:"Reason for Adjustment"}),e.jsx(F,{placeholder:"e.g., damage, loss, found inventory, physical count correction...",value:Q,onChange:f=>K(f.target.value),sx:{...de}})]})]})}),s&&e.jsx(Dt,{open:d,onClose:()=>u(!1),title:"Filter Movements",size:"medium",actions:e.jsxs(S,{sx:{display:"flex",gap:1,justifyContent:"space-between",width:"100%"},children:[e.jsx(q,{variant:"plain",color:"neutral",onClick:tt,disabled:!R,children:"Clear All"}),e.jsx(q,{onClick:()=>u(!1),children:"Apply Filters"})]}),children:e.jsxs(ke,{spacing:2,children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Movement Type"}),e.jsxs(le,{placeholder:"All types",value:h,onChange:(f,z)=>g(z||""),children:[e.jsx(M,{value:"",children:"All Types"}),e.jsx(M,{value:"incoming",children:"Incoming"}),e.jsx(M,{value:"outgoing",children:"Outgoing"}),e.jsx(M,{value:"adjustment",children:"Adjustment"})]})]}),e.jsxs(X,{children:[e.jsx(Y,{children:"Product"}),e.jsxs(le,{placeholder:"All products",value:b,onChange:(f,z)=>x(z||""),children:[e.jsx(M,{value:"",children:"All Products"}),i.map(f=>e.jsx(M,{value:f.uuid,children:f.ProductName},f.uuid))]})]}),e.jsxs(X,{children:[e.jsx(Y,{children:"Reason Category"}),e.jsxs(le,{placeholder:"All reasons",value:m,onChange:(f,z)=>y(z||""),children:[e.jsx(M,{value:"",children:"All Reasons"}),e.jsx(M,{value:"manual",children:"Manual Adjustment"}),e.jsx(M,{value:"damage",children:"Damage/Defect"}),e.jsx(M,{value:"loss",children:"Loss/Missing"}),e.jsx(M,{value:"found",children:"Found/Surplus"}),e.jsx(M,{value:"po",children:"Purchase Order"})]})]})]})}),e.jsx(Ut,{open:C,onClose:()=>N(!1),autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{top:16,zIndex:2e3},children:e.jsx(js,{color:he,variant:"solid",sx:{width:"100%"},children:E})})]})},Yo=({open:s,onClose:t,product:r,onSave:i})=>{const[n,o]=p.useState(r?.min_stock??0),[l,a]=p.useState(r?.max_stock??0),[c,d]=p.useState(r?.reorder_amount??0);p.useEffect(()=>{o(r?.min_stock??0),a(r?.max_stock??0),d(r?.reorder_amount??0)},[r]);const u=()=>{i({min_stock:n,max_stock:l,reorder_amount:c})};return r?e.jsx(we,{open:s,onClose:t,children:e.jsxs(ve,{sx:{minWidth:320,width:{xs:"90vw",sm:400}},children:[e.jsx(We,{}),e.jsx(w,{level:"h4",sx:{mb:2},children:"Edit Inventory Settings"}),e.jsxs(ke,{spacing:2,children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Product ID"}),e.jsx(F,{value:r.ProductID??"",disabled:!0})]}),e.jsxs(X,{children:[e.jsx(Y,{children:"Product Name"}),e.jsx(F,{value:r.ProductName??"",disabled:!0})]}),e.jsxs(X,{children:[e.jsx(Y,{children:"Current Stock"}),e.jsx(F,{value:"N/A",disabled:!0})]}),e.jsxs(X,{children:[e.jsx(Y,{children:"Minimum Stock"}),e.jsx(F,{type:"number",value:n,onChange:h=>o(Number(h.target.value))})]}),e.jsxs(X,{children:[e.jsx(Y,{children:"Maximum Stock"}),e.jsx(F,{type:"number",value:l,onChange:h=>a(Number(h.target.value))})]}),e.jsxs(X,{children:[e.jsx(Y,{children:"Reorder Amount"}),e.jsx(F,{type:"number",value:c,onChange:h=>d(Number(h.target.value))})]})]}),e.jsxs(S,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:3},children:[e.jsx(q,{variant:"plain",onClick:t,children:"Cancel"}),e.jsx(q,{variant:"solid",onClick:u,children:"Save"})]})]})}):null},ue={fontSize:ee.sizes.small},el=()=>{const[s,t]=p.useState([]),[r,i]=p.useState(""),[n,o]=p.useState(!1),[l,a]=p.useState(null);p.useEffect(()=>{async function h(){const{data:g,error:b}=await O.from("Products").select("*");b?console.error("Error fetching products:",b):t(g||[])}h()},[]);const c=s.filter(h=>{const g=r.toLowerCase();return(h.ProductName?.toLowerCase().includes(g)??!1)||h.ProductID!==null&&h.ProductID!==void 0&&h.ProductID.toString().toLowerCase().includes(g)||(h.uuid?.toLowerCase().includes(g)??!1)}),d=h=>{a(h),o(!0)},u=async h=>{if(!l)return;const{error:g}=await O.from("Products").update(h).eq("uuid",l.uuid);g?alert("Failed to update product: "+g.message):(t(b=>b.map(x=>x.uuid===l.uuid?{...x,...h}:x)),o(!1))};return e.jsx($e,{children:e.jsxs(S,{sx:{width:"100%",minHeight:"100dvh",bgcolor:"background.body",borderRadius:0,boxShadow:"none",pl:0,pr:0,pt:3,pb:0},children:[e.jsx(w,{level:"h2",sx:{mb:2,textAlign:"left",fontSize:ee.sizes.xlarge},children:"Inventory"}),e.jsx(S,{sx:{display:"flex",gap:2,mb:2},children:e.jsx(F,{placeholder:"Search products...",sx:{flex:1,...ue},value:r,onChange:h=>i(h.target.value),startDecorator:e.jsx(Fe,{})})}),e.jsx(Pe,{children:e.jsxs(Te,{"aria-label":"Inventory Levels",sx:{minWidth:800},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:ue,children:"Product Name"}),e.jsx("th",{style:ue,children:"SKU"}),e.jsx("th",{style:ue,children:"Current Stock"}),e.jsx("th",{style:ue,children:"Min Stock"}),e.jsx("th",{style:ue,children:"Max Stock"}),e.jsx("th",{style:ue,children:"Reorder Amount"}),e.jsx("th",{style:ue,children:"Status"})]})}),e.jsxs("tbody",{children:[c.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...ue},children:"No products found."})}),c.map(h=>{const g=typeof h.min_stock=="number"&&h.min_stock>0;return e.jsxs("tr",{style:{cursor:"pointer"},onClick:()=>d(h),children:[e.jsx("td",{style:ue,children:h.ProductName}),e.jsx("td",{style:ue,children:h.ProductID}),e.jsx("td",{style:ue,children:"N/A"}),e.jsx("td",{style:ue,children:h.min_stock??"N/A"}),e.jsx("td",{style:ue,children:h.max_stock??"N/A"}),e.jsx("td",{style:ue,children:h.reorder_amount??"N/A"}),e.jsx("td",{children:g?e.jsx(ie,{color:"danger",variant:"soft",size:"sm",sx:ue,children:"Low Stock"}):e.jsx(ie,{color:"success",variant:"soft",size:"sm",sx:ue,children:"OK"})})]},h.uuid)})]})]})}),e.jsx(Yo,{open:n,onClose:()=>o(!1),product:l,onSave:u})]})})};function Os(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Xe=Os();function Yr(s){Xe=s}var xt={exec:()=>null};function G(s,t=""){let r=typeof s=="string"?s:s.source,i={replace:(n,o)=>{let l=typeof o=="string"?o:o.source;return l=l.replace(be.caret,"$1"),r=r.replace(n,l),i},getRegex:()=>new RegExp(r,t)};return i}var be={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:s=>new RegExp(`^( {0,3}${s})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}#`),htmlBeginRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}<(?:[a-z].*>|!--)`,"i")},tl=/^(?:[ \t]*(?:\n|$))+/,sl=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,rl=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,jt=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,nl=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Is=/(?:[*+-]|\d{1,9}[.)])/,en=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,tn=G(en).replace(/bull/g,Is).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),il=G(en).replace(/bull/g,Is).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Ds=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,ol=/^[^\n]+/,Ts=/(?!\s*\])(?:\\.|[^\[\]\\])+/,ll=G(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Ts).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),al=G(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Is).getRegex(),Kt="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Ls=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,cl=G("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Ls).replace("tag",Kt).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),sn=G(Ds).replace("hr",jt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Kt).getRegex(),dl=G(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",sn).getRegex(),Ns={blockquote:dl,code:sl,def:ll,fences:rl,heading:nl,hr:jt,html:cl,lheading:tn,list:al,newline:tl,paragraph:sn,table:xt,text:ol},ar=G("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",jt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Kt).getRegex(),ul={...Ns,lheading:il,table:ar,paragraph:G(Ds).replace("hr",jt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",ar).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Kt).getRegex()},hl={...Ns,html:G(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Ls).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:xt,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:G(Ds).replace("hr",jt).replace("heading",` *#{1,6} *[^
]`).replace("lheading",tn).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},pl=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,xl=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,rn=/^( {2,}|\\)\n(?!\s*$)/,fl=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Xt=/[\p{P}\p{S}]/u,zs=/[\s\p{P}\p{S}]/u,nn=/[^\s\p{P}\p{S}]/u,ml=G(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,zs).getRegex(),on=/(?!~)[\p{P}\p{S}]/u,gl=/(?!~)[\s\p{P}\p{S}]/u,bl=/(?:[^\s\p{P}\p{S}]|~)/u,jl=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,ln=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,yl=G(ln,"u").replace(/punct/g,Xt).getRegex(),Sl=G(ln,"u").replace(/punct/g,on).getRegex(),an="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",wl=G(an,"gu").replace(/notPunctSpace/g,nn).replace(/punctSpace/g,zs).replace(/punct/g,Xt).getRegex(),vl=G(an,"gu").replace(/notPunctSpace/g,bl).replace(/punctSpace/g,gl).replace(/punct/g,on).getRegex(),kl=G("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,nn).replace(/punctSpace/g,zs).replace(/punct/g,Xt).getRegex(),Cl=G(/\\(punct)/,"gu").replace(/punct/g,Xt).getRegex(),_l=G(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Pl=G(Ls).replace("(?:-->|$)","-->").getRegex(),Rl=G("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Pl).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Nt=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,Al=G(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Nt).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),cn=G(/^!?\[(label)\]\[(ref)\]/).replace("label",Nt).replace("ref",Ts).getRegex(),dn=G(/^!?\[(ref)\](?:\[\])?/).replace("ref",Ts).getRegex(),El=G("reflink|nolink(?!\\()","g").replace("reflink",cn).replace("nolink",dn).getRegex(),Ms={_backpedal:xt,anyPunctuation:Cl,autolink:_l,blockSkip:jl,br:rn,code:xl,del:xt,emStrongLDelim:yl,emStrongRDelimAst:wl,emStrongRDelimUnd:kl,escape:pl,link:Al,nolink:dn,punctuation:ml,reflink:cn,reflinkSearch:El,tag:Rl,text:fl,url:xt},Ol={...Ms,link:G(/^!?\[(label)\]\((.*?)\)/).replace("label",Nt).getRegex(),reflink:G(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Nt).getRegex()},fs={...Ms,emStrongRDelimAst:vl,emStrongLDelim:Sl,url:G(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},Il={...fs,br:G(rn).replace("{2,}","*").getRegex(),text:G(fs.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},kt={normal:Ns,gfm:ul,pedantic:hl},dt={normal:Ms,gfm:fs,breaks:Il,pedantic:Ol},Dl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},cr=s=>Dl[s];function De(s,t){if(t){if(be.escapeTest.test(s))return s.replace(be.escapeReplace,cr)}else if(be.escapeTestNoEncode.test(s))return s.replace(be.escapeReplaceNoEncode,cr);return s}function dr(s){try{s=encodeURI(s).replace(be.percentDecode,"%")}catch{return null}return s}function ur(s,t){let r=s.replace(be.findPipe,(o,l,a)=>{let c=!1,d=l;for(;--d>=0&&a[d]==="\\";)c=!c;return c?"|":" |"}),i=r.split(be.splitPipe),n=0;if(i[0].trim()||i.shift(),i.length>0&&!i.at(-1)?.trim()&&i.pop(),t)if(i.length>t)i.splice(t);else for(;i.length<t;)i.push("");for(;n<i.length;n++)i[n]=i[n].trim().replace(be.slashPipe,"|");return i}function ut(s,t,r){let i=s.length;if(i===0)return"";let n=0;for(;n<i&&s.charAt(i-n-1)===t;)n++;return s.slice(0,i-n)}function Tl(s,t){if(s.indexOf(t[1])===-1)return-1;let r=0;for(let i=0;i<s.length;i++)if(s[i]==="\\")i++;else if(s[i]===t[0])r++;else if(s[i]===t[1]&&(r--,r<0))return i;return r>0?-2:-1}function hr(s,t,r,i,n){let o=t.href,l=t.title||null,a=s[1].replace(n.other.outputLinkReplace,"$1");i.state.inLink=!0;let c={type:s[0].charAt(0)==="!"?"image":"link",raw:r,href:o,title:l,text:a,tokens:i.inlineTokens(a)};return i.state.inLink=!1,c}function Ll(s,t,r){let i=s.match(r.other.indentCodeCompensation);if(i===null)return t;let n=i[1];return t.split(`
`).map(o=>{let l=o.match(r.other.beginningSpace);if(l===null)return o;let[a]=l;return a.length>=n.length?o.slice(n.length):o}).join(`
`)}var zt=class{options;rules;lexer;constructor(s){this.options=s||Xe}space(s){let t=this.rules.block.newline.exec(s);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(s){let t=this.rules.block.code.exec(s);if(t){let r=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?r:ut(r,`
`)}}}fences(s){let t=this.rules.block.fences.exec(s);if(t){let r=t[0],i=Ll(r,t[3]||"",this.rules);return{type:"code",raw:r,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:i}}}heading(s){let t=this.rules.block.heading.exec(s);if(t){let r=t[2].trim();if(this.rules.other.endingHash.test(r)){let i=ut(r,"#");(this.options.pedantic||!i||this.rules.other.endingSpaceChar.test(i))&&(r=i.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:r,tokens:this.lexer.inline(r)}}}hr(s){let t=this.rules.block.hr.exec(s);if(t)return{type:"hr",raw:ut(t[0],`
`)}}blockquote(s){let t=this.rules.block.blockquote.exec(s);if(t){let r=ut(t[0],`
`).split(`
`),i="",n="",o=[];for(;r.length>0;){let l=!1,a=[],c;for(c=0;c<r.length;c++)if(this.rules.other.blockquoteStart.test(r[c]))a.push(r[c]),l=!0;else if(!l)a.push(r[c]);else break;r=r.slice(c);let d=a.join(`
`),u=d.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");i=i?`${i}
${d}`:d,n=n?`${n}
${u}`:u;let h=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(u,o,!0),this.lexer.state.top=h,r.length===0)break;let g=o.at(-1);if(g?.type==="code")break;if(g?.type==="blockquote"){let b=g,x=b.raw+`
`+r.join(`
`),m=this.blockquote(x);o[o.length-1]=m,i=i.substring(0,i.length-b.raw.length)+m.raw,n=n.substring(0,n.length-b.text.length)+m.text;break}else if(g?.type==="list"){let b=g,x=b.raw+`
`+r.join(`
`),m=this.list(x);o[o.length-1]=m,i=i.substring(0,i.length-g.raw.length)+m.raw,n=n.substring(0,n.length-b.raw.length)+m.raw,r=x.substring(o.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:i,tokens:o,text:n}}}list(s){let t=this.rules.block.list.exec(s);if(t){let r=t[1].trim(),i=r.length>1,n={type:"list",raw:"",ordered:i,start:i?+r.slice(0,-1):"",loose:!1,items:[]};r=i?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=i?r:"[*+-]");let o=this.rules.other.listItemRegex(r),l=!1;for(;s;){let c=!1,d="",u="";if(!(t=o.exec(s))||this.rules.block.hr.test(s))break;d=t[0],s=s.substring(d.length);let h=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,_=>" ".repeat(3*_.length)),g=s.split(`
`,1)[0],b=!h.trim(),x=0;if(this.options.pedantic?(x=2,u=h.trimStart()):b?x=t[1].length+1:(x=t[2].search(this.rules.other.nonSpaceChar),x=x>4?1:x,u=h.slice(x),x+=t[1].length),b&&this.rules.other.blankLine.test(g)&&(d+=g+`
`,s=s.substring(g.length+1),c=!0),!c){let _=this.rules.other.nextBulletRegex(x),D=this.rules.other.hrRegex(x),I=this.rules.other.fencesBeginRegex(x),v=this.rules.other.headingBeginRegex(x),k=this.rules.other.htmlBeginRegex(x);for(;s;){let A=s.split(`
`,1)[0],T;if(g=A,this.options.pedantic?(g=g.replace(this.rules.other.listReplaceNesting,"  "),T=g):T=g.replace(this.rules.other.tabCharGlobal,"    "),I.test(g)||v.test(g)||k.test(g)||_.test(g)||D.test(g))break;if(T.search(this.rules.other.nonSpaceChar)>=x||!g.trim())u+=`
`+T.slice(x);else{if(b||h.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||I.test(h)||v.test(h)||D.test(h))break;u+=`
`+g}!b&&!g.trim()&&(b=!0),d+=A+`
`,s=s.substring(A.length+1),h=T.slice(x)}}n.loose||(l?n.loose=!0:this.rules.other.doubleBlankLine.test(d)&&(l=!0));let m=null,y;this.options.gfm&&(m=this.rules.other.listIsTask.exec(u),m&&(y=m[0]!=="[ ] ",u=u.replace(this.rules.other.listReplaceTask,""))),n.items.push({type:"list_item",raw:d,task:!!m,checked:y,loose:!1,text:u,tokens:[]}),n.raw+=d}let a=n.items.at(-1);if(a)a.raw=a.raw.trimEnd(),a.text=a.text.trimEnd();else return;n.raw=n.raw.trimEnd();for(let c=0;c<n.items.length;c++)if(this.lexer.state.top=!1,n.items[c].tokens=this.lexer.blockTokens(n.items[c].text,[]),!n.loose){let d=n.items[c].tokens.filter(h=>h.type==="space"),u=d.length>0&&d.some(h=>this.rules.other.anyLine.test(h.raw));n.loose=u}if(n.loose)for(let c=0;c<n.items.length;c++)n.items[c].loose=!0;return n}}html(s){let t=this.rules.block.html.exec(s);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(s){let t=this.rules.block.def.exec(s);if(t){let r=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),i=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",n=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:r,raw:t[0],href:i,title:n}}}table(s){let t=this.rules.block.table.exec(s);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let r=ur(t[1]),i=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),n=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],o={type:"table",raw:t[0],header:[],align:[],rows:[]};if(r.length===i.length){for(let l of i)this.rules.other.tableAlignRight.test(l)?o.align.push("right"):this.rules.other.tableAlignCenter.test(l)?o.align.push("center"):this.rules.other.tableAlignLeft.test(l)?o.align.push("left"):o.align.push(null);for(let l=0;l<r.length;l++)o.header.push({text:r[l],tokens:this.lexer.inline(r[l]),header:!0,align:o.align[l]});for(let l of n)o.rows.push(ur(l,o.header.length).map((a,c)=>({text:a,tokens:this.lexer.inline(a),header:!1,align:o.align[c]})));return o}}lheading(s){let t=this.rules.block.lheading.exec(s);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(s){let t=this.rules.block.paragraph.exec(s);if(t){let r=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:r,tokens:this.lexer.inline(r)}}}text(s){let t=this.rules.block.text.exec(s);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(s){let t=this.rules.inline.escape.exec(s);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(s){let t=this.rules.inline.tag.exec(s);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(s){let t=this.rules.inline.link.exec(s);if(t){let r=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(r)){if(!this.rules.other.endAngleBracket.test(r))return;let o=ut(r.slice(0,-1),"\\");if((r.length-o.length)%2===0)return}else{let o=Tl(t[2],"()");if(o===-2)return;if(o>-1){let l=(t[0].indexOf("!")===0?5:4)+t[1].length+o;t[2]=t[2].substring(0,o),t[0]=t[0].substring(0,l).trim(),t[3]=""}}let i=t[2],n="";if(this.options.pedantic){let o=this.rules.other.pedanticHrefTitle.exec(i);o&&(i=o[1],n=o[3])}else n=t[3]?t[3].slice(1,-1):"";return i=i.trim(),this.rules.other.startAngleBracket.test(i)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(r)?i=i.slice(1):i=i.slice(1,-1)),hr(t,{href:i&&i.replace(this.rules.inline.anyPunctuation,"$1"),title:n&&n.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(s,t){let r;if((r=this.rules.inline.reflink.exec(s))||(r=this.rules.inline.nolink.exec(s))){let i=(r[2]||r[1]).replace(this.rules.other.multipleSpaceGlobal," "),n=t[i.toLowerCase()];if(!n){let o=r[0].charAt(0);return{type:"text",raw:o,text:o}}return hr(r,n,r[0],this.lexer,this.rules)}}emStrong(s,t,r=""){let i=this.rules.inline.emStrongLDelim.exec(s);if(!(!i||i[3]&&r.match(this.rules.other.unicodeAlphaNumeric))&&(!(i[1]||i[2])||!r||this.rules.inline.punctuation.exec(r))){let n=[...i[0]].length-1,o,l,a=n,c=0,d=i[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(d.lastIndex=0,t=t.slice(-1*s.length+n);(i=d.exec(t))!=null;){if(o=i[1]||i[2]||i[3]||i[4]||i[5]||i[6],!o)continue;if(l=[...o].length,i[3]||i[4]){a+=l;continue}else if((i[5]||i[6])&&n%3&&!((n+l)%3)){c+=l;continue}if(a-=l,a>0)continue;l=Math.min(l,l+a+c);let u=[...i[0]][0].length,h=s.slice(0,n+i.index+u+l);if(Math.min(n,l)%2){let b=h.slice(1,-1);return{type:"em",raw:h,text:b,tokens:this.lexer.inlineTokens(b)}}let g=h.slice(2,-2);return{type:"strong",raw:h,text:g,tokens:this.lexer.inlineTokens(g)}}}}codespan(s){let t=this.rules.inline.code.exec(s);if(t){let r=t[2].replace(this.rules.other.newLineCharGlobal," "),i=this.rules.other.nonSpaceChar.test(r),n=this.rules.other.startingSpaceChar.test(r)&&this.rules.other.endingSpaceChar.test(r);return i&&n&&(r=r.substring(1,r.length-1)),{type:"codespan",raw:t[0],text:r}}}br(s){let t=this.rules.inline.br.exec(s);if(t)return{type:"br",raw:t[0]}}del(s){let t=this.rules.inline.del.exec(s);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(s){let t=this.rules.inline.autolink.exec(s);if(t){let r,i;return t[2]==="@"?(r=t[1],i="mailto:"+r):(r=t[1],i=r),{type:"link",raw:t[0],text:r,href:i,tokens:[{type:"text",raw:r,text:r}]}}}url(s){let t;if(t=this.rules.inline.url.exec(s)){let r,i;if(t[2]==="@")r=t[0],i="mailto:"+r;else{let n;do n=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??"";while(n!==t[0]);r=t[0],t[1]==="www."?i="http://"+t[0]:i=t[0]}return{type:"link",raw:t[0],text:r,href:i,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(s){let t=this.rules.inline.text.exec(s);if(t){let r=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:r}}}},ze=class ms{tokens;options;state;tokenizer;inlineQueue;constructor(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||Xe,this.options.tokenizer=this.options.tokenizer||new zt,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let r={other:be,block:kt.normal,inline:dt.normal};this.options.pedantic?(r.block=kt.pedantic,r.inline=dt.pedantic):this.options.gfm&&(r.block=kt.gfm,this.options.breaks?r.inline=dt.breaks:r.inline=dt.gfm),this.tokenizer.rules=r}static get rules(){return{block:kt,inline:dt}}static lex(t,r){return new ms(r).lex(t)}static lexInline(t,r){return new ms(r).inlineTokens(t)}lex(t){t=t.replace(be.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let r=0;r<this.inlineQueue.length;r++){let i=this.inlineQueue[r];this.inlineTokens(i.src,i.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,r=[],i=!1){for(this.options.pedantic&&(t=t.replace(be.tabCharGlobal,"    ").replace(be.spaceLine,""));t;){let n;if(this.options.extensions?.block?.some(l=>(n=l.call({lexer:this},t,r))?(t=t.substring(n.raw.length),r.push(n),!0):!1))continue;if(n=this.tokenizer.space(t)){t=t.substring(n.raw.length);let l=r.at(-1);n.raw.length===1&&l!==void 0?l.raw+=`
`:r.push(n);continue}if(n=this.tokenizer.code(t)){t=t.substring(n.raw.length);let l=r.at(-1);l?.type==="paragraph"||l?.type==="text"?(l.raw+=`
`+n.raw,l.text+=`
`+n.text,this.inlineQueue.at(-1).src=l.text):r.push(n);continue}if(n=this.tokenizer.fences(t)){t=t.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.heading(t)){t=t.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.hr(t)){t=t.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.blockquote(t)){t=t.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.list(t)){t=t.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.html(t)){t=t.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.def(t)){t=t.substring(n.raw.length);let l=r.at(-1);l?.type==="paragraph"||l?.type==="text"?(l.raw+=`
`+n.raw,l.text+=`
`+n.raw,this.inlineQueue.at(-1).src=l.text):this.tokens.links[n.tag]||(this.tokens.links[n.tag]={href:n.href,title:n.title});continue}if(n=this.tokenizer.table(t)){t=t.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.lheading(t)){t=t.substring(n.raw.length),r.push(n);continue}let o=t;if(this.options.extensions?.startBlock){let l=1/0,a=t.slice(1),c;this.options.extensions.startBlock.forEach(d=>{c=d.call({lexer:this},a),typeof c=="number"&&c>=0&&(l=Math.min(l,c))}),l<1/0&&l>=0&&(o=t.substring(0,l+1))}if(this.state.top&&(n=this.tokenizer.paragraph(o))){let l=r.at(-1);i&&l?.type==="paragraph"?(l.raw+=`
`+n.raw,l.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=l.text):r.push(n),i=o.length!==t.length,t=t.substring(n.raw.length);continue}if(n=this.tokenizer.text(t)){t=t.substring(n.raw.length);let l=r.at(-1);l?.type==="text"?(l.raw+=`
`+n.raw,l.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=l.text):r.push(n);continue}if(t){let l="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(l);break}else throw new Error(l)}}return this.state.top=!0,r}inline(t,r=[]){return this.inlineQueue.push({src:t,tokens:r}),r}inlineTokens(t,r=[]){let i=t,n=null;if(this.tokens.links){let a=Object.keys(this.tokens.links);if(a.length>0)for(;(n=this.tokenizer.rules.inline.reflinkSearch.exec(i))!=null;)a.includes(n[0].slice(n[0].lastIndexOf("[")+1,-1))&&(i=i.slice(0,n.index)+"["+"a".repeat(n[0].length-2)+"]"+i.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(n=this.tokenizer.rules.inline.anyPunctuation.exec(i))!=null;)i=i.slice(0,n.index)+"++"+i.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(n=this.tokenizer.rules.inline.blockSkip.exec(i))!=null;)i=i.slice(0,n.index)+"["+"a".repeat(n[0].length-2)+"]"+i.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let o=!1,l="";for(;t;){o||(l=""),o=!1;let a;if(this.options.extensions?.inline?.some(d=>(a=d.call({lexer:this},t,r))?(t=t.substring(a.raw.length),r.push(a),!0):!1))continue;if(a=this.tokenizer.escape(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.tag(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.link(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(a.raw.length);let d=r.at(-1);a.type==="text"&&d?.type==="text"?(d.raw+=a.raw,d.text+=a.text):r.push(a);continue}if(a=this.tokenizer.emStrong(t,i,l)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.codespan(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.br(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.del(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.autolink(t)){t=t.substring(a.raw.length),r.push(a);continue}if(!this.state.inLink&&(a=this.tokenizer.url(t))){t=t.substring(a.raw.length),r.push(a);continue}let c=t;if(this.options.extensions?.startInline){let d=1/0,u=t.slice(1),h;this.options.extensions.startInline.forEach(g=>{h=g.call({lexer:this},u),typeof h=="number"&&h>=0&&(d=Math.min(d,h))}),d<1/0&&d>=0&&(c=t.substring(0,d+1))}if(a=this.tokenizer.inlineText(c)){t=t.substring(a.raw.length),a.raw.slice(-1)!=="_"&&(l=a.raw.slice(-1)),o=!0;let d=r.at(-1);d?.type==="text"?(d.raw+=a.raw,d.text+=a.text):r.push(a);continue}if(t){let d="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(d);break}else throw new Error(d)}}return r}},Mt=class{options;parser;constructor(s){this.options=s||Xe}space(s){return""}code({text:s,lang:t,escaped:r}){let i=(t||"").match(be.notSpaceStart)?.[0],n=s.replace(be.endingNewline,"")+`
`;return i?'<pre><code class="language-'+De(i)+'">'+(r?n:De(n,!0))+`</code></pre>
`:"<pre><code>"+(r?n:De(n,!0))+`</code></pre>
`}blockquote({tokens:s}){return`<blockquote>
${this.parser.parse(s)}</blockquote>
`}html({text:s}){return s}heading({tokens:s,depth:t}){return`<h${t}>${this.parser.parseInline(s)}</h${t}>
`}hr(s){return`<hr>
`}list(s){let t=s.ordered,r=s.start,i="";for(let l=0;l<s.items.length;l++){let a=s.items[l];i+=this.listitem(a)}let n=t?"ol":"ul",o=t&&r!==1?' start="'+r+'"':"";return"<"+n+o+`>
`+i+"</"+n+`>
`}listitem(s){let t="";if(s.task){let r=this.checkbox({checked:!!s.checked});s.loose?s.tokens[0]?.type==="paragraph"?(s.tokens[0].text=r+" "+s.tokens[0].text,s.tokens[0].tokens&&s.tokens[0].tokens.length>0&&s.tokens[0].tokens[0].type==="text"&&(s.tokens[0].tokens[0].text=r+" "+De(s.tokens[0].tokens[0].text),s.tokens[0].tokens[0].escaped=!0)):s.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):t+=r+" "}return t+=this.parser.parse(s.tokens,!!s.loose),`<li>${t}</li>
`}checkbox({checked:s}){return"<input "+(s?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:s}){return`<p>${this.parser.parseInline(s)}</p>
`}table(s){let t="",r="";for(let n=0;n<s.header.length;n++)r+=this.tablecell(s.header[n]);t+=this.tablerow({text:r});let i="";for(let n=0;n<s.rows.length;n++){let o=s.rows[n];r="";for(let l=0;l<o.length;l++)r+=this.tablecell(o[l]);i+=this.tablerow({text:r})}return i&&(i=`<tbody>${i}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+i+`</table>
`}tablerow({text:s}){return`<tr>
${s}</tr>
`}tablecell(s){let t=this.parser.parseInline(s.tokens),r=s.header?"th":"td";return(s.align?`<${r} align="${s.align}">`:`<${r}>`)+t+`</${r}>
`}strong({tokens:s}){return`<strong>${this.parser.parseInline(s)}</strong>`}em({tokens:s}){return`<em>${this.parser.parseInline(s)}</em>`}codespan({text:s}){return`<code>${De(s,!0)}</code>`}br(s){return"<br>"}del({tokens:s}){return`<del>${this.parser.parseInline(s)}</del>`}link({href:s,title:t,tokens:r}){let i=this.parser.parseInline(r),n=dr(s);if(n===null)return i;s=n;let o='<a href="'+s+'"';return t&&(o+=' title="'+De(t)+'"'),o+=">"+i+"</a>",o}image({href:s,title:t,text:r,tokens:i}){i&&(r=this.parser.parseInline(i,this.parser.textRenderer));let n=dr(s);if(n===null)return De(r);s=n;let o=`<img src="${s}" alt="${r}"`;return t&&(o+=` title="${De(t)}"`),o+=">",o}text(s){return"tokens"in s&&s.tokens?this.parser.parseInline(s.tokens):"escaped"in s&&s.escaped?s.text:De(s.text)}},qs=class{strong({text:s}){return s}em({text:s}){return s}codespan({text:s}){return s}del({text:s}){return s}html({text:s}){return s}text({text:s}){return s}link({text:s}){return""+s}image({text:s}){return""+s}br(){return""}},Me=class gs{options;renderer;textRenderer;constructor(t){this.options=t||Xe,this.options.renderer=this.options.renderer||new Mt,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new qs}static parse(t,r){return new gs(r).parse(t)}static parseInline(t,r){return new gs(r).parseInline(t)}parse(t,r=!0){let i="";for(let n=0;n<t.length;n++){let o=t[n];if(this.options.extensions?.renderers?.[o.type]){let a=o,c=this.options.extensions.renderers[a.type].call({parser:this},a);if(c!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(a.type)){i+=c||"";continue}}let l=o;switch(l.type){case"space":{i+=this.renderer.space(l);continue}case"hr":{i+=this.renderer.hr(l);continue}case"heading":{i+=this.renderer.heading(l);continue}case"code":{i+=this.renderer.code(l);continue}case"table":{i+=this.renderer.table(l);continue}case"blockquote":{i+=this.renderer.blockquote(l);continue}case"list":{i+=this.renderer.list(l);continue}case"html":{i+=this.renderer.html(l);continue}case"paragraph":{i+=this.renderer.paragraph(l);continue}case"text":{let a=l,c=this.renderer.text(a);for(;n+1<t.length&&t[n+1].type==="text";)a=t[++n],c+=`
`+this.renderer.text(a);r?i+=this.renderer.paragraph({type:"paragraph",raw:c,text:c,tokens:[{type:"text",raw:c,text:c,escaped:!0}]}):i+=c;continue}default:{let a='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return i}parseInline(t,r=this.renderer){let i="";for(let n=0;n<t.length;n++){let o=t[n];if(this.options.extensions?.renderers?.[o.type]){let a=this.options.extensions.renderers[o.type].call({parser:this},o);if(a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){i+=a||"";continue}}let l=o;switch(l.type){case"escape":{i+=r.text(l);break}case"html":{i+=r.html(l);break}case"link":{i+=r.link(l);break}case"image":{i+=r.image(l);break}case"strong":{i+=r.strong(l);break}case"em":{i+=r.em(l);break}case"codespan":{i+=r.codespan(l);break}case"br":{i+=r.br(l);break}case"del":{i+=r.del(l);break}case"text":{i+=r.text(l);break}default:{let a='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return i}},At=class{options;block;constructor(s){this.options=s||Xe}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(s){return s}postprocess(s){return s}processAllTokens(s){return s}provideLexer(){return this.block?ze.lex:ze.lexInline}provideParser(){return this.block?Me.parse:Me.parseInline}},Nl=class{defaults=Os();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=Me;Renderer=Mt;TextRenderer=qs;Lexer=ze;Tokenizer=zt;Hooks=At;constructor(...s){this.use(...s)}walkTokens(s,t){let r=[];for(let i of s)switch(r=r.concat(t.call(this,i)),i.type){case"table":{let n=i;for(let o of n.header)r=r.concat(this.walkTokens(o.tokens,t));for(let o of n.rows)for(let l of o)r=r.concat(this.walkTokens(l.tokens,t));break}case"list":{let n=i;r=r.concat(this.walkTokens(n.items,t));break}default:{let n=i;this.defaults.extensions?.childTokens?.[n.type]?this.defaults.extensions.childTokens[n.type].forEach(o=>{let l=n[o].flat(1/0);r=r.concat(this.walkTokens(l,t))}):n.tokens&&(r=r.concat(this.walkTokens(n.tokens,t)))}}return r}use(...s){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return s.forEach(r=>{let i={...r};if(i.async=this.defaults.async||i.async||!1,r.extensions&&(r.extensions.forEach(n=>{if(!n.name)throw new Error("extension name required");if("renderer"in n){let o=t.renderers[n.name];o?t.renderers[n.name]=function(...l){let a=n.renderer.apply(this,l);return a===!1&&(a=o.apply(this,l)),a}:t.renderers[n.name]=n.renderer}if("tokenizer"in n){if(!n.level||n.level!=="block"&&n.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let o=t[n.level];o?o.unshift(n.tokenizer):t[n.level]=[n.tokenizer],n.start&&(n.level==="block"?t.startBlock?t.startBlock.push(n.start):t.startBlock=[n.start]:n.level==="inline"&&(t.startInline?t.startInline.push(n.start):t.startInline=[n.start]))}"childTokens"in n&&n.childTokens&&(t.childTokens[n.name]=n.childTokens)}),i.extensions=t),r.renderer){let n=this.defaults.renderer||new Mt(this.defaults);for(let o in r.renderer){if(!(o in n))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;let l=o,a=r.renderer[l],c=n[l];n[l]=(...d)=>{let u=a.apply(n,d);return u===!1&&(u=c.apply(n,d)),u||""}}i.renderer=n}if(r.tokenizer){let n=this.defaults.tokenizer||new zt(this.defaults);for(let o in r.tokenizer){if(!(o in n))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;let l=o,a=r.tokenizer[l],c=n[l];n[l]=(...d)=>{let u=a.apply(n,d);return u===!1&&(u=c.apply(n,d)),u}}i.tokenizer=n}if(r.hooks){let n=this.defaults.hooks||new At;for(let o in r.hooks){if(!(o in n))throw new Error(`hook '${o}' does not exist`);if(["options","block"].includes(o))continue;let l=o,a=r.hooks[l],c=n[l];At.passThroughHooks.has(o)?n[l]=d=>{if(this.defaults.async)return Promise.resolve(a.call(n,d)).then(h=>c.call(n,h));let u=a.call(n,d);return c.call(n,u)}:n[l]=(...d)=>{let u=a.apply(n,d);return u===!1&&(u=c.apply(n,d)),u}}i.hooks=n}if(r.walkTokens){let n=this.defaults.walkTokens,o=r.walkTokens;i.walkTokens=function(l){let a=[];return a.push(o.call(this,l)),n&&(a=a.concat(n.call(this,l))),a}}this.defaults={...this.defaults,...i}}),this}setOptions(s){return this.defaults={...this.defaults,...s},this}lexer(s,t){return ze.lex(s,t??this.defaults)}parser(s,t){return Me.parse(s,t??this.defaults)}parseMarkdown(s){return(t,r)=>{let i={...r},n={...this.defaults,...i},o=this.onError(!!n.silent,!!n.async);if(this.defaults.async===!0&&i.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||t===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));n.hooks&&(n.hooks.options=n,n.hooks.block=s);let l=n.hooks?n.hooks.provideLexer():s?ze.lex:ze.lexInline,a=n.hooks?n.hooks.provideParser():s?Me.parse:Me.parseInline;if(n.async)return Promise.resolve(n.hooks?n.hooks.preprocess(t):t).then(c=>l(c,n)).then(c=>n.hooks?n.hooks.processAllTokens(c):c).then(c=>n.walkTokens?Promise.all(this.walkTokens(c,n.walkTokens)).then(()=>c):c).then(c=>a(c,n)).then(c=>n.hooks?n.hooks.postprocess(c):c).catch(o);try{n.hooks&&(t=n.hooks.preprocess(t));let c=l(t,n);n.hooks&&(c=n.hooks.processAllTokens(c)),n.walkTokens&&this.walkTokens(c,n.walkTokens);let d=a(c,n);return n.hooks&&(d=n.hooks.postprocess(d)),d}catch(c){return o(c)}}}onError(s,t){return r=>{if(r.message+=`
Please report this to https://github.com/markedjs/marked.`,s){let i="<p>An error occurred:</p><pre>"+De(r.message+"",!0)+"</pre>";return t?Promise.resolve(i):i}if(t)return Promise.reject(r);throw r}}},Ke=new Nl;function J(s,t){return Ke.parse(s,t)}J.options=J.setOptions=function(s){return Ke.setOptions(s),J.defaults=Ke.defaults,Yr(J.defaults),J};J.getDefaults=Os;J.defaults=Xe;J.use=function(...s){return Ke.use(...s),J.defaults=Ke.defaults,Yr(J.defaults),J};J.walkTokens=function(s,t){return Ke.walkTokens(s,t)};J.parseInline=Ke.parseInline;J.Parser=Me;J.parser=Me.parse;J.Renderer=Mt;J.TextRenderer=qs;J.Lexer=ze;J.lexer=ze.lex;J.Tokenizer=zt;J.Hooks=At;J.parse=J;J.options;J.setOptions;J.use;J.walkTokens;J.parseInline;Me.parse;ze.lex;function zl(){const[s,t]=V.useState("");return V.useEffect(()=>{fetch("/RELEASE_LOG.md").then(r=>r.text()).then(t)},[]),e.jsxs(S,{sx:{p:2,minHeight:300,overflow:"auto",bgcolor:"background.level1",borderRadius:"var(--joy-radius-lg)",border:"1px solid",borderColor:"divider"},children:[e.jsx(w,{level:"h4",sx:{mb:1},children:"Release Log"}),e.jsx(S,{sx:{typography:"body-md"},children:e.jsx("div",{dangerouslySetInnerHTML:{__html:J(s)}})})]})}function Ml(){return e.jsxs(S,{sx:{p:2,minHeight:300,bgcolor:"background.level1",borderRadius:"var(--joy-radius-lg)",border:"1px solid",borderColor:"divider"},children:[e.jsx(w,{level:"h4",sx:{mb:1},children:"Application Info"}),e.jsx(w,{level:"body-md",children:"Smartback Inventory System"}),e.jsxs(w,{level:"body-sm",sx:{mt:1},children:["Environment: ","production"]}),e.jsxs(w,{level:"body-sm",children:["Version: ","N/A"]}),e.jsxs(w,{level:"body-sm",children:["Build: ","N/A"]}),e.jsxs(w,{level:"body-sm",children:["Date: ",new Date().toLocaleDateString()]}),e.jsx(q,{component:"a",href:"https://nicklasfangerfisk.github.io/Testflow/",target:"_blank",rel:"noopener noreferrer",startDecorator:e.jsx(wr,{}),sx:{mt:2},variant:"outlined",color:"primary",children:"System test"})]})}function ql(){const s=Rn();return Be(s.breakpoints.down("md")),e.jsx($e,{children:e.jsxs(S,{sx:{width:"100%",minHeight:"100dvh",bgcolor:"background.body",borderRadius:0,boxShadow:"none",pl:0,pr:0,pt:3,pb:0},children:[e.jsx(w,{level:"h2",sx:{mb:2,fontSize:"xlarge"},children:"Settings"}),e.jsxs(S,{sx:{display:"grid",gap:2,gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"}},children:[e.jsx(S,{children:e.jsx(Ml,{})}),e.jsx(S,{children:e.jsx(zl,{})})]})]})})}function Fl(){const[s,t]=V.useState("");return V.useEffect(()=>{fetch("/RELEASE_LOG.md").then(r=>r.text()).then(t)},[]),e.jsxs(S,{sx:{p:2,minHeight:200,overflow:"auto",bgcolor:"background.level1",mt:2,borderRadius:"var(--joy-radius-lg)",border:"1px solid",borderColor:"divider"},children:[e.jsx(w,{level:"h4",sx:{mb:1},children:"Release Log"}),e.jsx(S,{sx:{fontSize:14},children:e.jsx("div",{dangerouslySetInnerHTML:{__html:J(s)}})})]})}function $l(){return e.jsxs(S,{sx:{p:2,minHeight:120,bgcolor:"background.level1",borderRadius:"var(--joy-radius-lg)",border:"1px solid",borderColor:"divider"},children:[e.jsx(w,{level:"h4",sx:{mb:1},children:"Application Info"}),e.jsx(w,{level:"body-md",children:"Smartback Inventory System"}),e.jsxs(w,{level:"body-sm",sx:{mt:1},children:["Environment: ","production"]}),e.jsxs(w,{level:"body-sm",children:["Version: ","N/A"]}),e.jsxs(w,{level:"body-sm",children:["Build: ","N/A"]}),e.jsxs(w,{level:"body-sm",children:["Date: ",new Date().toLocaleDateString()]}),e.jsx(q,{component:"a",href:"https://nicklasfangerfisk.github.io/Testflow/",target:"_blank",rel:"noopener noreferrer",startDecorator:e.jsx(wr,{}),sx:{mt:2},variant:"outlined",color:"primary",children:"System test"})]})}function Ul(){return e.jsxs(S,{sx:{p:1,width:"100%",maxWidth:600,mx:"auto"},children:[e.jsx(w,{level:"h2",sx:{mb:2},children:"Settings"}),e.jsx($l,{}),e.jsx(Fl,{})]})}function Bl(){const s=Cs(),{isMobile:t}=He(),r=Bt(),[i,n]=p.useState("dashboard"),[o,l]=p.useState([]),a=[{label:"Dashboard",icon:e.jsx(ys,{}),value:"dashboard"},{label:"Orders",icon:e.jsx(Ss,{}),value:"orders"},{label:"Users",icon:e.jsx(ws,{}),value:"users"},{label:"Settings",icon:e.jsx(Ot,{}),value:"settings"}];return p.useEffect(()=>{n({"/":"dashboard","/dashboard":"dashboard","/orders":"orders","/products":"dashboard","/users":"users","/suppliers":"dashboard","/purchase-orders":"dashboard","/tickets":"dashboard","/sms-campaigns":"dashboard","/movements":"dashboard","/inventory":"dashboard","/settings":"settings"}[s.pathname]||"dashboard")},[s.pathname]),p.useEffect(()=>{async function c(){const{data:d,error:u}=await O.from("users").select("*");if(u)console.error("Error fetching users:",u);else{console.log("Fetched users:",d);const h=(d||[]).map(g=>({id:g.id,name:g.name||null,email:g.email,role:g.role||null,created_at:g.created_at||null,last_login:g.last_login||null,phone:g.phone||null}));l(h)}}c()},[]),console.log("isMobile:",t),e.jsxs(S,{sx:{display:"flex",height:"100vh",overflow:"hidden"},children:[s.pathname!=="/login"&&!t&&e.jsx(Zn,{setView:c=>console.log(c),view:"home"}),e.jsxs(S,{component:"main",sx:{flexGrow:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0,overflowY:"auto",bgcolor:"background.default",p:s.pathname!=="/dashboard"&&s.pathname!=="/login"&&s.pathname!=="/tickets"&&s.pathname!=="/movements"?3:0,width:t?"100%":"calc(100% - var(--Sidebar-width, 240px))",marginBottom:t?"56px":0},children:[t&&s.pathname!=="/login"&&e.jsx(Fo,{items:a,value:i,onChange:c=>{n(c),r(`/${c}`)},toggleSidebar:()=>console.log("Sidebar toggled")}),e.jsxs(_s,{children:[e.jsx(fe,{path:"/",element:e.jsx(It,{to:"/dashboard",replace:!0})}),e.jsx(fe,{path:"/orders",element:e.jsx(Ae,{children:e.jsx(Xn,{})})}),e.jsx(fe,{path:"/products",element:e.jsx(Ae,{children:e.jsx(ei,{})})}),e.jsx(fe,{path:"/users",element:e.jsx(Ae,{children:t?e.jsx(ri,{users:o}):e.jsx(si,{users:o})})}),e.jsx(fe,{path:"/suppliers",element:e.jsx(Ae,{children:e.jsx(ni,{})})}),e.jsx(fe,{path:"/purchase-orders",element:e.jsx(Ae,{children:e.jsx(qo,{})})}),e.jsx(fe,{path:"/tickets",element:e.jsx(Ae,{children:e.jsx(Vo,{})})}),e.jsx(fe,{path:"/sms-campaigns",element:e.jsx(Ae,{children:e.jsx(Jo,{campaigns:[]})})}),e.jsx(fe,{path:"/dashboard",element:e.jsx(Ae,{children:e.jsx(Zo,{})})}),e.jsx(fe,{path:"/movements",element:e.jsx(Ae,{children:e.jsx(Xo,{})})}),e.jsx(fe,{path:"/inventory",element:e.jsx(Ae,{children:e.jsx(el,{})})}),e.jsx(fe,{path:"/settings",element:e.jsx(Ae,{children:t?e.jsx(Ul,{}):e.jsx(ql,{})})}),e.jsx(fe,{path:"*",element:e.jsx(It,{to:"/",replace:!0})})]})]})]})}function Wl(){return e.jsx(mr,{children:e.jsx(qn,{children:e.jsxs(_s,{children:[e.jsx(fe,{path:"/login/*",element:e.jsx(Ko,{})}),e.jsx(fe,{path:"/*",element:e.jsx(Bl,{})})]})})})}console.log("Mounting React app...");const pr=document.getElementById("root");pr?(Un.createRoot(pr).render(e.jsx(Wl,{})),console.log("React app rendered!")):console.error("No #root element found in index.html!");

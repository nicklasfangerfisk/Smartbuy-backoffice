import{b as fn,u as xn,r as u,j as e,I as de,M as ue,d as he,D as Nt,e as zt,B as w,A as Ae,T as y,f as at,h as M,i as Mt,k as q,R as V,l as mn,m as Ee,G as gn,L as Ze,n as $e,o as nt,p as Oe,q as it,s as bn,t as De,F as te,v as se,S as ye,w as B,x as xs,y as Le,z as ur,C as hr,E as je,H as pr,J as fr,K as jn,N as yn,O as Sn,P as zs,Q as Ms,U as wn,V as kn,W as we,X as ut,Y as vn,Z as Cn,_ as Pn,$ as _n,a0 as gt,a1 as Ge,a2 as xr,a3 as Rn,a4 as En,a5 as On,a6 as qs,a7 as An,a8 as In,a9 as Tn,aa as $s,ab as mr,ac as gr,ad as Dn,ae as Ce,af as Ln}from"./mui-core-CJnYBQcb.js";import{D as Nn,L as zn,P as Mn,H as qn,a as ms,S as gs,b as br,G as bs,c as jr,A as yr,Q as Sr,d as _t,I as wr,e as Rt,f as $n,K as Fn,g as Fs,h as js,i as lt,j as kr,E as ys,k as ct,M as Un,C as vr,l as Bn,m as Wn,F as Hn,O as Cr}from"./mui-icons-HXCTW2tw.js";import{c as Vn}from"./supabase-7AmLCMnb.js";import{N as Et,u as Qe,a as Ss,R as ws,b as ae,B as Jn}from"./router-Dh8bQaaG.js";import{f as Gn}from"./utils-CSQe5d3I.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=r(n);fetch(n.href,a)}})();var bt={},Us;function Zn(){if(Us)return bt;Us=1;var s=fn();return bt.createRoot=s.createRoot,bt.hydrateRoot=s.hydrateRoot,bt}var Qn=Zn();function Kn(s){const{onClick:t,sx:r,...i}=s,{mode:n,setMode:a}=xn(),[o,l]=u.useState(!1);return u.useEffect(()=>{l(!0)},[]),o?e.jsxs(de,{"data-screenshot":"toggle-mode",size:"sm",variant:"outlined",color:"neutral",...i,onClick:c=>{a(n==="light"?"dark":"light"),t?.(c)},sx:[n==="dark"?{"& > *:first-of-type":{display:"none"}}:{"& > *:first-of-type":{display:"initial"}},n==="light"?{"& > *:last-of-type":{display:"none"}}:{"& > *:last-of-type":{display:"initial"}},...Array.isArray(r)?r:[r]],children:[e.jsx(Nn,{}),e.jsx(zn,{})]}):e.jsx(de,{size:"sm",variant:"outlined",color:"neutral",...i,sx:r,disabled:!0})}const Pr="https://tfzvtzqybgbzxcxozdes.supabase.co",ns="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRmenZ0enF5YmdienhjeG96ZGVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NTc2MDIsImV4cCI6MjA2MzQzMzYwMn0.hD2WdkvI8LY9N0IHP7HDQliyicQA0c-mspKjCJf0_Fc";console.log("[Supabase] URL:",Pr);console.log("[Supabase] Anon Key:",ns.slice(0,6)+"..."+ns.slice(-6));const v=Vn(Pr,ns);v.auth.onAuthStateChange((s,t)=>{console.log("[Auth State Change]",s,t),s==="SIGNED_IN"?console.log("User signed in:",t?.user):s==="SIGNED_OUT"&&console.log("User signed out")});let Xt=!1;v.auth.onAuthStateChange((s,t)=>{Xt||(Xt=!0,console.log("[Auth State Change]",s,t),s==="SIGNED_IN"?console.log("User signed in:",t?.user):s==="SIGNED_OUT"&&(console.log("User signed out"),window.location.pathname!=="/login"&&(window.location.href="/login")),Xt=!1)});function Xn({open:s,onClose:t,userProfile:r,editName:i,setEditName:n,editAvatar:a,setEditAvatar:o,onSave:l}){const[c,d]=u.useState(!1),[h,p]=u.useState(null),g=u.useRef(null);async function m(f){const x=f.target.files&&f.target.files[0];if(!(!x||!r?.id)){d(!0),p(null);try{const b=x.name.split(".").pop()?.replace(/\./,"")||"png",_=`avatars/${r.id}_${Date.now()}.${b}`,I=await v.storage.from("avatars").upload(_,x,{upsert:!0,contentType:x.type});if(I.error)throw I.error;const{publicUrl:A}=v.storage.from("avatars").getPublicUrl(_).data;A&&o(A)}catch(b){p("Failed to upload avatar. Please try again."),console.error("Avatar upload failed",b)}d(!1)}}return e.jsx(ue,{open:s,onClose:t,children:e.jsxs(he,{children:[e.jsx(Nt,{children:"Edit Profile"}),e.jsxs(zt,{sx:{display:"flex",flexDirection:"row",gap:3,alignItems:"flex-start"},children:[e.jsxs(w,{sx:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:110},children:[e.jsx(Ae,{src:a||r?.avatar_url||"",alt:i||r?.name||"Avatar",sx:{width:96,height:96,mb:1}}),e.jsxs(y,{level:"body-xs",sx:{mt:1,textAlign:"center"},children:["Last login:",e.jsx("br",{}),r?.last_login?new Date(r.last_login).toLocaleString():"Never"]})]}),e.jsx(at,{orientation:"vertical",sx:{mx:1,alignSelf:"stretch"}}),e.jsxs(w,{sx:{flex:1,display:"flex",flexDirection:"column",gap:2},children:[e.jsx(y,{level:"body-sm",children:"Name"}),e.jsx(M,{placeholder:"Your name",value:i,onChange:f=>n(f.target.value),sx:{mb:1},required:!0}),e.jsx(y,{level:"body-sm",children:"Avatar URL"}),e.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(M,{placeholder:"Avatar image URL",value:a,onChange:f=>o(f.target.value),sx:{flex:1}}),e.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},ref:g,onChange:m,disabled:c}),e.jsx(de,{component:"span",onClick:()=>g.current?.click(),disabled:c,title:"Upload from device",children:e.jsx(Mn,{})})]}),h&&e.jsx(y,{color:"danger",sx:{mt:1},children:h})]})]}),e.jsxs(Mt,{children:[e.jsx(q,{variant:"plain",onClick:t,disabled:c,children:"Cancel"}),e.jsx(q,{onClick:()=>{l(),t()},disabled:c||!i,children:"Save"})]})]})})}const qt=s=>t=>{const[r,i]=V.useState(null),[n,a]=V.useState(!0);return V.useEffect(()=>{async function o(){const{data:l}=await v.auth.getSession();i(l?.session||null),a(!1)}o()},[]),n?e.jsx("div",{children:"Loading..."}):r?e.jsx(s,{...t}):e.jsx(Et,{to:"/login",replace:!0})},Yn=[{label:"Home",icon:V.createElement(qn),value:"home",route:"/",showInMobile:!0},{label:"Dashboard",icon:V.createElement(ms),value:"dashboard",route:"/dashboard",showInMobile:!0},{label:"Orders",icon:V.createElement(gs),value:"orders",route:"/orders",showInMobile:!0},{label:"Products",icon:V.createElement(br),value:"products",route:"/products",showInMobile:!0},{label:"Users",icon:V.createElement(bs),value:"users",route:"/users",showInMobile:!0},{label:"Suppliers",icon:V.createElement(jr),value:"suppliers",route:"/suppliers",showInMobile:!0},{label:"Purchase Orders",icon:V.createElement(yr),value:"purchaseorders",route:"/purchase-orders",showInMobile:!0},{label:"Tickets",icon:V.createElement(Sr),value:"tickets",route:"/tickets",showInMobile:!0},{label:"SMS Campaigns",icon:V.createElement(_t),value:"smscampaigns",route:"/sms-campaigns",showInMobile:!0},{label:"Movements",icon:V.createElement(_t),value:"movements",route:"/movements",showInMobile:!0},{label:"Inventory",icon:V.createElement(wr),value:"inventory",route:"/inventory",showInMobile:!0},{label:"Settings",icon:V.createElement(Rt),value:"settings",route:"/settings",showInMobile:!1}],wt={Sales:[{label:"Dashboard",icon:V.createElement(ms),value:"dashboard",route:"/dashboard",showInMobile:!0},{label:"Orders",icon:V.createElement(gs),value:"orders",route:"/orders",showInMobile:!0},{label:"Products",icon:V.createElement(br),value:"products",route:"/products",showInMobile:!0}],Support:[{label:"Tickets",icon:V.createElement(Sr),value:"tickets",route:"/tickets",showInMobile:!0},{label:"Users",icon:V.createElement(bs),value:"users",route:"/users",showInMobile:!0}],Marketing:[{label:"SMS Campaigns",icon:V.createElement(_t),value:"smscampaigns",route:"/sms-campaigns",showInMobile:!0}],Operations:[{label:"Suppliers",icon:V.createElement(jr),value:"suppliers",route:"/suppliers",showInMobile:!0},{label:"Purchase Orders",icon:V.createElement(yr),value:"purchaseorders",route:"/purchase-orders",showInMobile:!0},{label:"Movements",icon:V.createElement(_t),value:"movements",route:"/movements",showInMobile:!0},{label:"Inventory",icon:V.createElement(wr),value:"inventory",route:"/inventory",showInMobile:!0}]};function Ke(){const s=mn(),t=Ee("(max-width:600px)"),r=Ee("(min-width:601px) and (max-width:1024px)"),i=Ee("(min-width:1025px)");return{isMobile:t,isTablet:r,isDesktop:i,isSmallScreen:t,isMediumScreen:r,isLargeScreen:i,breakpoints:{mobile:"600px",tablet:"1024px",desktop:"1025px"},theme:s}}function _r(){const{isMobile:s,isTablet:t}=Ke();return{containerPadding:s?1:t?2:3,sectionPadding:s?2:t?3:4,itemPadding:s?1:2,smallGap:s?1:2,mediumGap:s?2:3,largeGap:s?3:4,sectionMargin:s?2:3,itemMargin:s?1:2}}function ei(){const{isMobile:s}=Ke();return{getModalSize:(r="medium")=>s?{width:"95vw",height:r==="fullscreen"?"95vh":"auto",maxHeight:"90vh",margin:1}:{small:{width:400,maxWidth:"90vw"},medium:{width:600,maxWidth:"90vw"},large:{width:800,maxWidth:"90vw"},fullscreen:{width:"90vw",height:"90vh"}}[r]}}function ti({setView:s,view:t}){const r=Qe(),i=Ss(),{isMobile:n,isTablet:a,isDesktop:o}=Ke(),[l,c]=u.useState(!1),[d,h]=u.useState([]),[p,g]=u.useState(null),[m,f]=u.useState(null),[x,b]=u.useState(!1),[_,I]=u.useState(""),[A,S]=u.useState(""),[k,E]=u.useState(!1);u.useEffect(()=>{async function C(){const{data:O,error:$}=await v.from("users").select("*");!$&&O&&h(O)}C();async function R(O){if(g(O),O){let{data:$}=await v.from("users").select("*").eq("id",O.id).single();$||(await v.from("users").upsert({id:O.id,email:O.email,name:O.user_metadata?.full_name||null,avatar_url:O.user_metadata?.avatar_url||null,role:"employee"}),$={...O,role:"employee"}),f($),I($.name||""),S($.avatar_url||"")}else f(null),I(""),S("")}v.auth.getUser().then(({data:O})=>R(O.user));const{data:z}=v.auth.onAuthStateChange((O,$)=>{R($?.user??null)});return()=>{z?.subscription.unsubscribe()}},[]);const D=async()=>{if(!p)return;await v.from("users").update({name:_,avatar_url:A}).eq("id",p.id);const{data:C}=await v.from("users").select("*").eq("id",p.id).single();f(C||null),b(!1)};u.useEffect(()=>{a&&c(!0)},[a,o]);const U=C=>{r(C.route),s(C.value),a&&c(!0)},X=()=>{c(!l)},Z=(C,R)=>{U({value:R,route:C})},L=C=>i.pathname===C;return e.jsxs(w,{className:"Sidebar",sx:{display:n?"none":"flex",position:{xs:"fixed",md:"sticky"},transform:{xs:"translateX(calc(100% * (var(--SideNavigation-slideIn, 0) - 1)))",md:"none"},transition:"transform 0.4s, width 0.4s",zIndex:1e4,height:"100dvh",width:"var(--Sidebar-width)",top:0,p:2,flexShrink:0,flexDirection:"column",gap:2,borderRight:"1px solid",borderColor:"divider",background:"var(--joy-palette-background-surface, #fff)"},children:[e.jsx(gn,{styles:C=>({":root":{"--Sidebar-width":l?"60px":"220px",[C.breakpoints.up("lg")]:{"--Sidebar-width":l?"60px":"240px"}}})}),e.jsx(w,{className:"Sidebar-overlay",sx:{position:"fixed",zIndex:9998,top:0,left:0,width:"100vw",height:"100vh",opacity:"var(--SideNavigation-slideIn)",backgroundColor:"var(--joy-palette-background-backdrop)",transition:"opacity 0.4s",transform:{xs:"translateX(calc(100% * (var(--SideNavigation-slideIn, 0) - 1) + var(--SideNavigation-slideIn, 0) * var(--Sidebar-width, 0px)))",lg:"translateX(-100%)"}}}),e.jsxs(w,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(de,{size:"sm",variant:"plain",onClick:X,sx:{p:.5,borderRadius:1,"&:hover":{bgcolor:"neutral.100"}},children:e.jsx("img",{src:"/favicon.svg",alt:"Logo",style:{width:28,height:28,borderRadius:6}})}),!l&&e.jsxs(e.Fragment,{children:[e.jsx(y,{level:"title-lg",children:"Smartbuy"}),e.jsx(Kn,{sx:{ml:"auto"}})]})]}),!l&&e.jsx(M,{size:"sm",startDecorator:e.jsx($n,{}),placeholder:"Search"}),e.jsx(w,{sx:{minHeight:0,overflowY:"auto",overflowX:"hidden",flex:"0 0 auto",display:"flex",flexDirection:"column",[`& .${bn.root}`]:{gap:1.5}},children:e.jsx(Ze,{size:"sm",sx:{gap:1,"--List-nestedInsetStart":"30px","--ListItem-radius":C=>C.vars.radius.sm},children:["Sales","Support","Operations","Marketing"].map(C=>e.jsx($e,{nested:!0,children:e.jsx(si,{defaultExpanded:!l,renderToggle:({open:R,setOpen:z})=>l?e.jsx(nt,{title:C,placement:"right",arrow:!0,children:e.jsx(Oe,{onClick:()=>z(!R),children:wt[C][0]?.icon})}):e.jsxs(Oe,{onClick:()=>z(!R),children:[wt[C][0]?.icon,e.jsx(it,{children:e.jsx(y,{level:"title-sm",children:C})}),e.jsx(Fn,{sx:[R?{transform:"rotate(180deg)"}:{transform:"none"}]})]}),children:e.jsx(Ze,{sx:{gap:.5},children:wt[C].map(R=>e.jsx($e,{children:l?e.jsx(nt,{title:R.label,placement:"right",arrow:!0,children:e.jsx(Oe,{selected:L(R.route),onClick:()=>Z(R.route,R.value),sx:{justifyContent:"center",px:1,width:"100%"},children:R.icon})}):e.jsxs(Oe,{selected:L(R.route),onClick:()=>Z(R.route,R.value),sx:{justifyContent:"flex-start",px:2,width:"100%"},children:[R.icon,e.jsx(it,{children:e.jsx(y,{level:"body-sm",children:R.label})})]})},R.value))})})},C))})}),e.jsx(w,{sx:{mt:"auto",mb:2},children:e.jsxs(Ze,{sx:{p:0},children:[e.jsx($e,{sx:{p:0,alignItems:"stretch"},children:l?e.jsx(nt,{title:"Settings",placement:"right",arrow:!0,children:e.jsx(Oe,{selected:L("/settings"),onClick:()=>Z("/settings","settings"),sx:{width:"100%",alignItems:"center",minHeight:40,justifyContent:"center",px:1},children:e.jsx(Rt,{})})}):e.jsxs(Oe,{selected:L("/settings"),onClick:()=>Z("/settings","settings"),sx:{width:"100%",alignItems:"center",minHeight:40,justifyContent:"flex-start",px:2},children:[e.jsx(Rt,{sx:{mr:1}}),e.jsx(it,{sx:{display:"flex",alignItems:"center",p:0},children:e.jsx(y,{level:"body-sm",children:"Settings"})})]})}),e.jsx($e,{sx:{p:0,alignItems:"stretch"},children:l?e.jsx(nt,{title:"Logout",placement:"right",arrow:!0,children:e.jsx(Oe,{onClick:async()=>{await v.auth.signOut(),window.location.href="/login"},sx:{width:"100%",alignItems:"center",minHeight:40,justifyContent:"center",px:1},children:e.jsx(Fs,{})})}):e.jsxs(Oe,{onClick:async()=>{await v.auth.signOut(),window.location.href="/login"},sx:{width:"100%",alignItems:"center",minHeight:40,justifyContent:"flex-start",px:2},children:[e.jsx(Fs,{sx:{mr:1}}),e.jsx(it,{sx:{display:"flex",alignItems:"center",p:0},children:e.jsx(y,{level:"body-sm",children:"Logout"})})]})})]})}),e.jsx(at,{}),e.jsxs(w,{sx:{display:"flex",gap:1,alignItems:"center",minHeight:48},children:[e.jsx(Ae,{variant:"outlined",size:"sm",src:m?.avatar_url||p?.user_metadata?.avatar_url||void 0,onClick:()=>E(!0),sx:{cursor:"pointer"}}),e.jsxs(w,{sx:{minWidth:0,flex:1,cursor:"pointer"},onClick:()=>E(!0),children:[e.jsx(y,{level:"title-sm",children:m?.name||p?.user_metadata?.full_name||p?.email||"Not signed in"}),e.jsx(y,{level:"body-xs",children:m?.email||p?.email||""})]})]}),e.jsx(Xn,{open:k,onClose:()=>E(!1),userProfile:m,editName:_,setEditName:I,editAvatar:A,setEditAvatar:S,onSave:D})]})}function si({defaultExpanded:s=!1,renderToggle:t,children:r}){const[i,n]=u.useState(s);return e.jsxs(u.Fragment,{children:[t({open:i,setOpen:n}),e.jsx(w,{sx:{display:"grid",transition:"0.2s ease","& > *":{overflow:"hidden"},gridTemplateRows:i?"1fr":"0fr"},children:r})]})}const ri=qt(ti),ni=({open:s,creating:t,newOrder:r,setNewOrder:i,onClose:n,onCreate:a})=>{const[o,l]=u.useState([]),[c,d]=u.useState([{id:crypto.randomUUID(),product:null,quantity:1,unitprice:0,discount:0}]),[h,p]=u.useState(!1),[g,m]=u.useState(null),[f,x]=u.useState(null),[b,_]=u.useState(0),[I,A]=u.useState(!1),[S,k]=u.useState(null),[E,D]=u.useState(!1);u.useEffect(()=>{s&&(d([{id:crypto.randomUUID(),product:null,quantity:1,unitprice:0,discount:0}]),m(null),i(C=>({...C,date:C.date||new Date().toISOString().slice(0,10)})))},[s]),u.useEffect(()=>{s&&(p(!0),x(null),v.from("Products").select("*").then(({data:C,error:R})=>{!R&&C?(C.length===0&&x("No products available. Please add products first."),l(C.map(z=>({id:z.uuid||z.id,ProductName:z.ProductName,SalesPrice:z.SalesPrice??0})))):x("Failed to load products. Please try again later."),p(!1)}))},[s]);const U=()=>{d(C=>[...C,{id:crypto.randomUUID(),product:null,quantity:1,unitprice:0,discount:b}])},X=C=>{d(R=>R.filter((z,O)=>O!==C))},Z=(C,R,z)=>{d(O=>O.map(($,N)=>{if(N!==C)return $;if(R==="product"&&z){const Q=o.find(W=>W.id===z.id);return{...$,product:z,unitprice:Q?.SalesPrice??0}}return R==="product"&&!z?{...$,product:null,unitprice:0}:{...$,[R]:z}}))},L=C=>{C.preventDefault();const R=c.filter(z=>z.product&&z.product.id&&z.quantity>0).map(z=>({product_uuid:z.product.id,quantity:z.quantity,unitprice:z.unitprice,discount:z.discount}));if(R.length===0){m("Please add at least one valid order item.");return}m(null),a(R,b)};return e.jsx(ue,{open:s,onClose:n,"aria-labelledby":"create-order-modal",children:e.jsxs(he,{"aria-labelledby":"create-order-modal",sx:{maxWidth:600,width:"100%",minWidth:{xs:300,sm:400}},children:[e.jsx(De,{}),e.jsx(y,{id:"create-order-modal",level:"h4",sx:{mb:2},children:"Create Order"}),e.jsxs("form",{onSubmit:L,children:[e.jsxs(te,{sx:{mb:2},required:!0,children:[e.jsx(se,{children:"Date"}),e.jsx(M,{type:"date",value:r.date,onChange:C=>i(R=>({...R,date:C.target.value})),required:!0})]}),e.jsxs(te,{sx:{mb:2},required:!0,children:[e.jsx(se,{children:"Status"}),e.jsxs(ye,{value:r.status,onChange:(C,R)=>i(z=>({...z,status:R||"Paid"})),children:[e.jsx(B,{value:"Paid",children:"Paid"}),e.jsx(B,{value:"Refunded",children:"Refunded"}),e.jsx(B,{value:"Cancelled",children:"Cancelled"})]})]}),e.jsxs(te,{sx:{mb:2},required:!0,children:[e.jsx(se,{children:"Customer Name"}),e.jsx(M,{value:r.customer_name,onChange:C=>i(R=>({...R,customer_name:C.target.value})),required:!0})]}),e.jsxs(te,{sx:{mb:2},required:!0,children:[e.jsx(se,{children:"Customer Email"}),e.jsx(M,{type:"email",value:r.customer_email,onChange:C=>i(R=>({...R,customer_email:C.target.value})),required:!0})]}),e.jsxs(te,{sx:{mb:2},required:!0,children:[e.jsx(se,{children:"Order Discount (%)"}),e.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(M,{type:"number",value:b,disabled:c.length>0&&!(c.length===1&&!c[0].product),onChange:C=>{const R=Math.max(0,Math.min(100,Math.floor(Number(C.target.value))));_(R),d(z=>z.map(O=>({...O,discount:R})))},slotProps:{input:{min:0,max:100,step:1}},required:!0,placeholder:"Order Discount %",sx:{flex:1}}),(c.length>1||c.length===1&&c[0].product)&&e.jsx(q,{size:"sm",variant:"outlined",onClick:()=>A(!0),children:"Edit"})]})]}),g&&e.jsx(y,{color:"danger",sx:{mb:1},children:g}),e.jsx(at,{sx:{my:2}}),e.jsx(w,{sx:{mb:1,fontWeight:"lg",fontSize:"lg"},children:"Order Items"}),f&&e.jsx(y,{color:"danger",sx:{mb:1},children:f}),c.map((C,R)=>e.jsxs(w,{sx:{display:"flex",gap:1,alignItems:"center",mb:1},children:[e.jsx(xs,{options:o,getOptionLabel:z=>z.ProductName,isOptionEqualToValue:(z,O)=>z.id===O.id,value:C.product,onChange:(z,O)=>Z(R,"product",O),loading:h,placeholder:h?"Loading...":"Search product",sx:{minWidth:220},disabled:o.length===0,required:!0,renderOption:(z,O)=>e.jsx("li",{...z,children:O.ProductName})}),e.jsx(M,{type:"number",value:C.quantity,onChange:z=>Z(R,"quantity",Math.max(1,Number(z.target.value))),sx:{width:80},required:!0,slotProps:{input:{min:1}}}),e.jsx(M,{type:"number",value:C.unitprice,onChange:z=>Z(R,"unitprice",Math.max(0,Number(z.target.value))),sx:{width:100},required:!0,slotProps:{input:{min:0,step:.01}},placeholder:"Unit Price"}),e.jsx(M,{type:"number",value:C.discount,onChange:z=>Z(R,"discount",Math.max(0,Math.min(100,Math.floor(Number(z.target.value))))),sx:{width:80},required:!0,slotProps:{input:{min:0,max:100,step:1}},placeholder:"Discount %"}),e.jsx(de,{size:"sm",color:"danger",onClick:()=>X(R),disabled:c.length===1,children:e.jsx(js,{})})]},C.id)),e.jsx(q,{startDecorator:e.jsx(lt,{}),variant:"soft",size:"sm",onClick:U,sx:{mb:2},disabled:!!f,children:"Add Item"}),e.jsx(ue,{open:I,onClose:()=>A(!1),children:e.jsxs(he,{sx:{minWidth:350},children:[e.jsx(y,{level:"title-md",sx:{mb:1},children:"Change Order Discount"}),e.jsxs(te,{sx:{mb:2},required:!0,children:[e.jsx(se,{children:"Change discount to (%)"}),e.jsx(M,{type:"number",value:S??b,onChange:C=>k(Math.max(0,Math.min(100,Math.floor(Number(C.target.value))))),slotProps:{input:{min:0,max:100,step:1}},required:!0,autoFocus:!0})]}),e.jsx(y,{sx:{mb:2},children:"How do you want to apply the new order discount?"}),e.jsxs(w,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[e.jsx(q,{onClick:()=>{_(S),d(C=>C.map(R=>({...R,discount:S}))),A(!1),k(null)},children:"Overwrite all"}),e.jsx(q,{onClick:()=>{_(S),d(C=>C.map(R=>R.discount<S?{...R,discount:S}:R)),A(!1),k(null)},children:"Set discount on lower"}),e.jsx(q,{variant:"plain",onClick:()=>{A(!1),k(null)},children:"Cancel"})]})]})}),e.jsxs(w,{sx:{display:"flex",gap:2,mt:2},children:[e.jsx(q,{type:"submit",loading:t,color:"primary",disabled:!!f,children:"Create"}),e.jsx(q,{variant:"plain",onClick:n,disabled:t,children:"Cancel"})]})]})]})})};function Rr({open:s,onClose:t,selectedOrder:r,fetchOrderItems:i}){const[n,a]=u.useState([]),[o,l]=u.useState(!1);return u.useEffect(()=>{async function c(){if(r){l(!0);const d=await i(r.uuid);a(d),l(!1)}else a([])}s&&r?c():a([])},[s,r,i]),e.jsx(ue,{open:s,onClose:t,"aria-labelledby":"order-details-modal",children:e.jsxs(he,{"aria-labelledby":"order-details-modal",sx:{maxWidth:600,width:"100%"},children:[e.jsx(De,{}),e.jsx(y,{id:"order-details-modal",level:"title-md",fontWeight:"lg",sx:{mb:2},children:"Order Details"}),r&&e.jsxs(w,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(w,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(y,{level:"body-sm",sx:{color:"text.secondary"},children:["Order ID: ",r.uuid]}),e.jsxs(y,{level:"body-sm",sx:{color:"text.secondary"},children:["Date: ",new Date(r.date).toLocaleString()]}),e.jsxs(y,{level:"body-sm",sx:{color:"text.secondary"},children:["Status: ",r.status]})]}),e.jsx(at,{}),e.jsxs(w,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(y,{level:"body-sm",fontWeight:"md",children:"Customer Information"}),e.jsxs(y,{level:"body-sm",sx:{color:"text.secondary"},children:["Name: ",r.customer.name]}),e.jsxs(y,{level:"body-sm",sx:{color:"text.secondary"},children:["Email: ",r.customer.email]})]}),e.jsx(at,{}),e.jsxs(w,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(y,{level:"body-sm",fontWeight:"md",children:"Ordered Items"}),o?e.jsx(y,{level:"body-sm",sx:{color:"text.secondary"},children:"Loading items..."}):e.jsxs(Le,{size:"sm",sx:{minWidth:500},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{style:{textAlign:"right"},children:"Quantity"}),e.jsx("th",{style:{textAlign:"right"},children:"Unit Price"}),e.jsx("th",{style:{textAlign:"right"},children:"Discount (%)"}),e.jsx("th",{style:{textAlign:"right"},children:"Total Price"})]})}),e.jsx("tbody",{children:n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{textAlign:"center",padding:"16px"},children:e.jsx(y,{level:"body-sm",sx:{color:"text.secondary"},children:"No items found for this order."})})}):n.map(function(c){return e.jsxs("tr",{children:[e.jsx("td",{children:c.name||c.product_uuid}),e.jsx("td",{style:{textAlign:"right"},children:c.quantity??"-"}),e.jsx("td",{style:{textAlign:"right"},children:c.unitprice!=null?`$${Number(c.unitprice).toFixed(2)}`:"-"}),e.jsx("td",{style:{textAlign:"right"},children:c.discount!=null?`${Number(c.discount).toFixed(2)}%`:"-"}),e.jsx("td",{style:{textAlign:"right"},children:c.price!=null?`$${Number(c.price).toFixed(2)}`:"-"})]},c.uuid)})})]})]})]})]})})}const ks=({items:s,renderItem:t,ariaLabel:r})=>e.jsx(w,{children:e.jsx(Ze,{"aria-label":r,children:s.map((i,n)=>e.jsxs(u.Fragment,{children:[" ",e.jsx($e,{children:t(i)}),n<s.length-1&&e.jsx(ur,{})," "]},n))})}),ii=({children:s})=>{const t=hr();return e.jsx(w,{sx:{pt:0,pb:0,height:"100vh",width:"100%",boxSizing:"border-box",overflowY:"auto",background:t.vars.palette.background.body,padding:0,margin:0},children:s})};function oi({orders:s,onRowClick:t,orderDetailsOpen:r,selectedOrder:i,fetchOrderItems:n,onCloseOrderDetails:a}){return Qe(),e.jsxs(ii,{children:[e.jsx(y,{level:"h2",sx:{mb:2,textAlign:"left"},children:"Orders"}),e.jsx(ks,{items:s,renderItem:o=>e.jsxs("div",{onClick:()=>t?.(o.id),style:{cursor:"pointer",position:"relative",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx(y,{children:o.date}),e.jsx(y,{children:o.customer.name})]}),e.jsx(je,{size:"sm",variant:"soft",color:o.status==="Paid"?"success":o.status==="Refunded"?"warning":"danger",style:{marginLeft:"auto",alignSelf:"flex-start"},children:o.status})]}),ariaLabel:"Orders Mobile View"}),e.jsx(Rr,{open:r,onClose:a,selectedOrder:i,fetchOrderItems:n})]})}const ai=pr({components:{MuiTableRow:{styleOverrides:{root:{"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}}}}}}),li=({columns:s,rows:t,ariaLabel:r,minWidth:i=600})=>e.jsx(fr,{theme:ai,children:e.jsxs(jn,{sx:{overflowX:"auto",pl:"24px",pr:"24px",pt:0},children:[" ",e.jsxs(yn,{"aria-label":r,sx:{minWidth:i},children:[e.jsxs(Sn,{children:[e.jsx(zs,{children:s.map(n=>e.jsx(Ms,{align:n.align||"left",sx:{minWidth:n.minWidth,pb:0},children:e.jsx(wn,{fontWeight:"bold",children:n.label})},n.id))})," "]}),e.jsx(kn,{children:t.map((n,a)=>e.jsx(zs,{children:s.map(o=>e.jsx(Ms,{align:o.align||"left",children:o.format?o.format(n[o.id]):n[o.id]},o.id))},a))})]})]})}),ci=qt(li),Ne=({children:s})=>e.jsx(w,{sx:{display:"flex",flexDirection:"column",pl:"16px",pr:"6px",pt:"6px",width:"100%",flex:1,minHeight:0,height:"100%",overflow:"hidden",bgcolor:"background.body"},children:s}),xe={sizes:{small:"0.875rem",xlarge:"1.5rem"}},jt={fontSize:xe.sizes.small},di=(s,t,r,i)=>{const n=t.find(a=>a.uuid===s);n&&(r(n),i(!0))};function ui({rows:s,onRowClick:t,orderDetailsOpen:r,selectedOrder:i,onCloseOrderDetails:n}){const[a,o]=u.useState(s),[l,c]=u.useState("desc"),[d,h]=u.useState([]),[p,g]=u.useState(!1),[m,f]=u.useState(!1),[x,b]=u.useState(!1),[_,I]=u.useState(null),[A,S]=u.useState([]),[k,E]=u.useState(!1),[D,U]=u.useState([]),[X,Z]=u.useState(!1),[L,C]=u.useState(!1),[R,z]=u.useState({date:"",status:"Paid",customer_name:"",customer_email:""}),[O,$]=u.useState(""),[N,Q]=u.useState("all"),[W,K]=u.useState("all"),[ke,Ve]=u.useState(""),qe=Ee("(max-width:600px)");async function pe(){g(!0);const{data:T,error:Y}=await v.from("Orders").select("*");if(!Y&&T){const be=T.map(H=>({uuid:H.uuid,date:H.date||H.created_at||"",status:H.status||"Paid",customer:H.customer?H.customer:{initial:H.customer_initial||(H.customer_name?H.customer_name[0]:"?"),name:H.customer_name||"Unknown",email:H.customer_email||""},order_number_display:H.order_number_display,order_total:typeof H.order_total=="number"?H.order_total:0,created_by:H.created_by||"",created_by_name:H.created_by_name||"",created_by_email:H.created_by_email||"",category:H.category||"purchase"}));o(be)}else Y&&console.error(Y.message||"Failed to fetch orders");g(!1)}u.useEffect(()=>{console.log("Fetching orders..."),pe()},[]),u.useEffect(()=>{console.log("Rows updated:",a)},[a]),u.useEffect(()=>{console.log("Status filter updated:",O)},[O]),u.useEffect(()=>{console.log("Category filter updated:",N)},[N]),u.useEffect(()=>{console.log("Customer filter updated:",W)},[W]);async function fe(T){const{data:Y,error:be}=await v.from("OrderItems").select("*, Products:product_uuid(ProductName)").eq("order_uuid",T);return!be&&Y?Y.map(H=>({...H,product_name:H.Products?.ProductName||H.product_uuid})):[]}const Zt=Array.from(new Set(a.map(T=>T.status)));Array.from(new Set(a.map(T=>T.customer.name)));const xt=a.filter(T=>{const Y=T.order_number_display?.toString().toLowerCase().includes(ke.toLowerCase())||T.customer?.name?.toLowerCase().includes(ke.toLowerCase()),be=!O||T.status===O;return Y&&be});async function Qt(T,Y){C(!0);const{data:be,error:H}=await v.from("Orders").insert([{date:R.date,status:R.status,customer_name:R.customer_name,customer_email:R.customer_email,discount:Y}]).select();if(H||!be||!be[0]){C(!1),alert("Failed to create order: "+(H?.message||"Unknown error"));return}const ze=be[0].uuid;if(T.length>0){const re=T.filter(Me=>Me.product_uuid&&Me.product_uuid.length>0).map(Me=>({order_uuid:ze,product_uuid:Me.product_uuid,quantity:Me.quantity,unitprice:Me.unitprice,discount:Me.discount}));if(re.length>0){const{data:Me,error:Ns}=await v.from("OrderItems").insert(re);if(Ns){C(!1),alert("Order created, but failed to add items: "+Ns.message);return}}}C(!1),Z(!1),z({date:"",status:"Paid",customer_name:"",customer_email:""}),setTimeout(()=>{pe()},1e3)}const Je=()=>{Z(!0)},mt=()=>{Z(!1),z({date:"",status:"Paid",customer_name:"",customer_email:""})},Kt=()=>{b(!1),I(null)},P=a.map(T=>({id:T.order_number_display||T.uuid,date:T.date,status:T.status,customer:T.customer}));return qe?e.jsx(oi,{orders:P,onRowClick:T=>{di(T,a,I,b)},orderDetailsOpen:x,selectedOrder:_,fetchOrderItems:fe,onCloseOrderDetails:()=>b(!1)}):e.jsxs(Ne,{children:[e.jsx(y,{level:"h2",sx:{mb:2,fontSize:"xlarge"},children:"Orders"}),e.jsxs(w,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(M,{placeholder:"Search orders...",sx:{flex:1,...jt},value:ke,onChange:T=>Ve(T.target.value)}),e.jsxs(ye,{placeholder:"Filter status",value:O,onChange:(T,Y)=>$(Y??""),sx:{minWidth:160,...jt},children:[e.jsx(B,{value:"",children:"All Statuses"}),Zt.map(T=>e.jsx(B,{value:T,sx:jt,children:T},T))]}),e.jsx(q,{onClick:Je,variant:"solid",sx:jt,children:"Create Order"})]}),e.jsxs(we,{sx:{pl:0,pr:0},children:[p&&e.jsx(ut,{}),e.jsx(ci,{columns:[{id:"order_number_display",label:"Order #",minWidth:100},{id:"date",label:"Date",minWidth:150},{id:"status",label:"Status",minWidth:100,align:"right"},{id:"customer_name",label:"Customer",minWidth:150},{id:"order_total",label:"Total",minWidth:100,format:T=>`$${T.toFixed(2)}`}],rows:xt.map(T=>({order_number_display:T.order_number_display||"-",date:new Date(T.date).toLocaleString(),status:T.status,customer_name:T.customer.name,order_total:T.order_total||0})),ariaLabel:"Orders Table"})]}),e.jsx(Rr,{open:r,onClose:Kt,selectedOrder:i,fetchOrderItems:fe}),e.jsx(ue,{open:X,onClose:mt,"aria-labelledby":"create-order-modal",children:e.jsxs(he,{"aria-labelledby":"create-order-modal",sx:{maxWidth:600,width:"100%"},children:[e.jsx(De,{}),e.jsx(y,{id:"create-order-modal",level:"title-md",fontWeight:"lg",sx:{mb:2},children:"Create Order"}),e.jsx(ni,{open:X,creating:L,newOrder:R,setNewOrder:z,onClose:mt,onCreate:Qt})]})})]})}function hi({open:s,onClose:t,product:r,onSave:i}){const[n,a]=u.useState({ProductName:r?.ProductName||"",SalesPrice:r?.SalesPrice?.toString()||"",CostPrice:r?.CostPrice?.toString()||""}),[o,l]=u.useState(!1);u.useEffect(()=>{a({ProductName:r?.ProductName||"",SalesPrice:r?.SalesPrice?.toString()||"",CostPrice:r?.CostPrice?.toString()||""})},[r]);const c=async()=>{l(!0),await i(n),l(!1)};return e.jsx(ue,{open:s,onClose:t,"aria-labelledby":"product-table-form-title",children:e.jsxs(he,{children:[e.jsx(Nt,{id:"product-table-form-title",children:r?"Edit Product":"Add Product"}),e.jsxs(zt,{children:[e.jsx(M,{name:"ProductName",value:n.ProductName,onChange:d=>a({...n,ProductName:d.target.value}),placeholder:"Product Name",sx:{mb:2}}),e.jsx(M,{name:"SalesPrice",value:n.SalesPrice,onChange:d=>a({...n,SalesPrice:d.target.value}),placeholder:"Sales Price",type:"number",sx:{mb:2}}),e.jsx(M,{name:"CostPrice",value:n.CostPrice,onChange:d=>a({...n,CostPrice:d.target.value}),placeholder:"Cost Price",type:"number"})]}),e.jsxs(Mt,{children:[e.jsx(q,{onClick:t,variant:"plain",disabled:o,children:"Cancel"}),e.jsx(q,{onClick:c,variant:"solid",loading:o,disabled:o,children:"Save"})]})]})})}const Ot=qt(hi);function pi(){const[s,t]=u.useState([]),[r,i]=u.useState(!1),[n,a]=u.useState(!1),[o,l]=u.useState(!1),[c,d]=u.useState(null);Qe(),u.useEffect(()=>{async function m(){i(!0);const{data:f,error:x}=await v.from("Products").select("*");!x&&f&&t(f),i(!1)}m()},[]);const h=async m=>{i(!0),await v.from("Products").delete().eq("uuid",m),t(s.filter(f=>f.uuid!==m)),i(!1)},p=async m=>{i(!0),await v.from("Products").insert([{ProductName:m.ProductName,SalesPrice:parseFloat(m.SalesPrice),CostPrice:parseFloat(m.CostPrice),CreatedAt:new Date().toISOString()}]);const{data:f}=await v.from("Products").select("*");f&&t(f),a(!1),i(!1)},g=async m=>{if(!c)return;i(!0),await v.from("Products").update({ProductName:m.ProductName,SalesPrice:parseFloat(m.SalesPrice),CostPrice:parseFloat(m.CostPrice)}).eq("uuid",c.uuid);const{data:f}=await v.from("Products").select("*");f&&t(f),l(!1),d(null),i(!1)};return e.jsx(e.Fragment,{children:e.jsxs(w,{sx:{p:2},children:[e.jsx(y,{level:"h2",sx:{mb:2},children:"Products"}),e.jsx(q,{onClick:()=>a(!0),sx:{mb:2},variant:"solid",children:"Add Product"}),e.jsx(Ot,{open:n,onClose:()=>a(!1),product:null,onSave:p}),e.jsx(Ot,{open:o,onClose:()=>{l(!1),d(null)},product:c,onSave:g}),e.jsxs(Ze,{children:[s.map(m=>e.jsxs($e,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(vn,{children:m.ImageUrl?e.jsx(Ae,{src:m.ImageUrl}):e.jsx(Ae,{children:e.jsx(kr,{})})}),e.jsxs(it,{children:[e.jsx(y,{level:"title-md",children:m.ProductName}),e.jsxs(y,{level:"body-sm",children:["Sales: ",m.SalesPrice," | Cost: ",m.CostPrice]}),e.jsx(y,{level:"body-xs",color:"neutral",children:m.CreatedAt})]}),e.jsx(de,{size:"sm",color:"primary",onClick:()=>{d(m),l(!0)},children:e.jsx(ys,{})}),e.jsx(de,{size:"sm",color:"danger",onClick:()=>h(m.uuid),children:e.jsx(js,{})})]},m.uuid)),s.length===0&&!r&&e.jsx(y,{level:"body-sm",sx:{textAlign:"center",color:"#888",width:"100%"},children:"No products found."})]})]})})}function fi(){const[s,t]=u.useState([]),[r,i]=u.useState({}),[n,a]=u.useState(!1),[o,l]=u.useState(!1),[c,d]=u.useState({ProductName:"",SalesPrice:"",CostPrice:""}),[h,p]=u.useState(!1),[g,m]=u.useState(!1),[f,x]=u.useState(!1),[b,_]=u.useState(null),[I,A]=u.useState(null),[S,k]=u.useState(!1),[E,D]=u.useState(""),U=Ee("(max-width: 600px)"),X=async N=>{a(!0);const Q={};try{const{data:W,error:K}=await v.from("stock_movements").select("product_id, movement_type, quantity");!K&&W&&N.forEach(ke=>{const qe=W.filter(pe=>pe.product_id===ke.uuid).reduce((pe,fe)=>{switch(fe.movement_type){case"incoming":return pe+fe.quantity;case"outgoing":return pe-fe.quantity;case"adjustment":return pe+fe.quantity;default:return pe}},0);Q[ke.uuid]=qe})}catch(W){console.error("Error fetching stock levels:",W)}finally{i(Q),a(!1)}},Z=N=>N<=0?{status:"Out of Stock",color:"danger"}:N<=10?{status:"Low Stock",color:"warning"}:{status:"In Stock",color:"success"};u.useEffect(()=>{async function N(){l(!0);const{data:Q,error:W}=await v.from("Products").select("*");!W&&Q&&(t(Q),await X(Q)),l(!1)}N()},[]);const L=async(N,Q)=>{const W=N.name.split(".").pop(),K=`${Q}_${Date.now()}.${W}`;await v.storage.from("productimages").remove([K]);const{error:ke}=await v.storage.from("productimages").upload(K,N,{upsert:!0});if(!ke){const{data:Ve}=v.storage.from("productimages").getPublicUrl(K),qe=Ve.publicUrl;await v.from("Products").update({ImageUrl:qe}).eq("id",Q)}return{error:ke,filePath:K}},C=async N=>{p(!0);const{error:Q}=await v.from("Products").delete().eq("uuid",N);p(!1),Q||t(s.filter(W=>W.uuid!==N))},R=N=>{_(N),m(!0)},z=async N=>{if(!b)return;p(!0),console.log("Editing product:",b),console.log("Form values:",N);const{error:Q,data:W}=await v.from("Products").update({ProductName:N.ProductName,SalesPrice:parseFloat(N.SalesPrice),CostPrice:parseFloat(N.CostPrice)}).eq("uuid",b.uuid).select();if(Q?(console.error("Supabase update error:",Q),alert("Failed to update product: "+Q.message)):console.log("Update result:",W),p(!1),m(!1),_(null),!Q){const{data:K}=await v.from("Products").select("*");K&&(t(K),await X(K))}},O=async N=>{p(!0);const{data:Q,error:W}=await v.from("Products").insert([{ProductName:N.ProductName,SalesPrice:parseFloat(N.SalesPrice),CostPrice:parseFloat(N.CostPrice),CreatedAt:new Date().toISOString()}]).select();if(p(!1),x(!1),!W){const{data:K}=await v.from("Products").select("*");K&&(t(K),await X(K))}},$=s.filter(N=>N.ProductName?.toLowerCase().includes(E.toLowerCase()));return U?e.jsx(pi,{}):e.jsx(Ne,{children:e.jsxs(w,{sx:{width:"100%",minHeight:"100dvh",bgcolor:"background.body",borderRadius:0,boxShadow:"none",pl:0,pr:0},children:[e.jsx(y,{level:"h2",sx:{mb:2,fontSize:"xlarge"},children:"Products"}),e.jsxs(w,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(M,{placeholder:"Search products...",sx:{flex:1},value:E,onChange:N=>D(N.target.value)}),e.jsx(q,{onClick:()=>x(!0),loading:h||S,disabled:h||S,variant:"solid",children:"Add Product"})]}),e.jsx(Ot,{open:f,onClose:()=>x(!1),product:null,onSave:O}),e.jsx(Ot,{open:g,onClose:()=>{m(!1),_(null)},product:b,onSave:z}),e.jsxs(we,{children:[o&&e.jsx(ut,{}),e.jsxs(Le,{"aria-label":"Products",sx:{minWidth:700},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Image"}),e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Current Stock"}),e.jsx("th",{children:"Sales price"}),e.jsx("th",{children:"Cost price"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[$.map(N=>e.jsxs("tr",{children:[e.jsx("td",{children:N.uuid}),e.jsx("td",{children:N.ImageUrl?e.jsx("img",{src:N.ImageUrl,alt:N.ProductName,style:{width:48,height:48,objectFit:"cover",borderRadius:4}}):e.jsx("span",{style:{color:"#aaa"},children:"No image"})}),e.jsx("td",{children:N.ProductName}),e.jsx("td",{children:n?e.jsx(y,{level:"body-sm",sx:{color:"neutral.500"},children:"Loading..."}):e.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(je,{size:"sm",variant:"soft",color:Z(r[N.uuid]||0).color,children:Z(r[N.uuid]||0).status}),e.jsx(nt,{title:`Current stock level: ${r[N.uuid]||0} units`,arrow:!0,children:e.jsx(y,{level:"body-sm",sx:{fontWeight:"bold",color:Z(r[N.uuid]||0).color==="danger"?"danger.500":Z(r[N.uuid]||0).color==="warning"?"warning.600":"success.600"},children:r[N.uuid]||0})}),e.jsx(w,{sx:{width:40,height:4,bgcolor:"neutral.200",borderRadius:2,overflow:"hidden"},children:e.jsx(w,{sx:{width:`${Math.min(100,Math.max(0,(r[N.uuid]||0)/50*100))}%`,height:"100%",bgcolor:Z(r[N.uuid]||0).color==="danger"?"danger.400":Z(r[N.uuid]||0).color==="warning"?"warning.400":"success.400",borderRadius:2}})})]})}),e.jsx("td",{children:N.SalesPrice}),e.jsx("td",{children:N.CostPrice}),e.jsx("td",{children:N.CreatedAt}),e.jsxs("td",{children:[e.jsx(de,{size:"sm",color:"primary",onClick:()=>R(N),disabled:h,children:e.jsx(ys,{})}),e.jsx(de,{size:"sm",color:"danger",onClick:()=>C(N.uuid),disabled:h,children:e.jsx(js,{})}),e.jsxs(de,{component:"label",size:"sm",color:"neutral",disabled:h||S,sx:{minWidth:0,px:1},children:[e.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:async Q=>{if(Q.target.files&&Q.target.files[0]){k(!0);const W=Q.target.files[0];await L(W,N.id);const{data:K}=await v.from("Products").select("*");K&&(t(K),await X(K)),k(!1)}}}),e.jsx(kr,{})]})]})]},N.uuid)),$.length===0&&!o&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{textAlign:"center",color:"#888"},children:"No products found."})})]})]})]})]})})}const ne={fontSize:xe.sizes.small};function xi(){return e.jsxs(Cn,{children:[e.jsx(Pn,{slots:{root:de},slotProps:{root:{variant:"plain",color:"neutral",size:"sm"}},children:e.jsx(Un,{})}),e.jsxs(_n,{size:"sm",sx:{minWidth:140},children:[e.jsx(gt,{children:"Edit"}),e.jsx(gt,{children:"Reset Password"}),e.jsx(gt,{children:"Disable"}),e.jsx(gt,{color:"danger",children:"Delete"})]})]})}function mi({users:s}){const[t,r]=u.useState(""),[i,n]=u.useState("all"),[a,o]=u.useState(!1),l=Ee("(max-width:600px)"),c=Array.from(new Set(s.map(h=>h.role).filter(Boolean))),d=s.filter(h=>{const p=h.name?.toLowerCase().includes(t.toLowerCase())||h.email.toLowerCase().includes(t.toLowerCase()),g=i==="all"||h.role===i;return p&&g});return l?e.jsxs(w,{sx:{p:2},children:[e.jsx(y,{level:"h2",sx:{mb:2,fontSize:xe.sizes.xlarge},children:"Users"}),e.jsx(y,{children:"Mobile view not implemented."})]}):e.jsx(Ne,{children:e.jsxs(w,{sx:{width:"100%",minHeight:"100dvh",bgcolor:"background.body",borderRadius:2,boxShadow:2,pl:0,pr:0},children:[e.jsx(y,{level:"h2",sx:{mb:2,textAlign:"left",fontSize:"xlarge"},children:"Users"}),e.jsxs(w,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(M,{placeholder:"Search users...",sx:{flex:1,...ne},value:t,onChange:h=>r(h.target.value),startDecorator:e.jsx(ct,{})}),e.jsxs(ye,{placeholder:"Filter role",value:i,onChange:(h,p)=>n(p??"all"),sx:{minWidth:160,...ne},children:[e.jsx(B,{value:"all",children:"All Roles"}),c.map(h=>e.jsx(B,{value:h,children:h},h))]}),e.jsx(q,{onClick:()=>o(!0),variant:"solid",sx:ne,children:"Create User"})]}),e.jsx(we,{children:e.jsxs(Le,{"aria-label":"Users",sx:{minWidth:800},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:ne,children:"Name"}),e.jsx("th",{style:ne,children:"Email"}),e.jsx("th",{style:ne,children:"Role"}),e.jsx("th",{style:ne,children:"Created At"}),e.jsx("th",{style:ne,children:"Last Login"}),e.jsx("th",{style:ne,children:"Phone"}),e.jsx("th",{style:{width:120}})]})}),e.jsxs("tbody",{children:[d.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...ne},children:"No users found."})}),d.map(h=>e.jsxs("tr",{style:{cursor:"pointer"},children:[e.jsx("td",{style:ne,children:e.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ae,{size:"sm",children:h.name?h.name[0]:"?"}),e.jsx("div",{children:e.jsx(y,{level:"body-xs",fontWeight:"md",sx:ne,children:h.name||"Unknown"})})]})}),e.jsx("td",{style:ne,children:h.email}),e.jsx("td",{style:ne,children:h.role||"-"}),e.jsx("td",{style:ne,children:h.created_at?new Date(h.created_at).toLocaleString():"-"}),e.jsx("td",{style:ne,children:h.last_login?new Date(h.last_login).toLocaleString():"-"}),e.jsx("td",{style:ne,children:h.phone||"-"}),e.jsx("td",{children:e.jsx(xi,{})})]},h.id))]})]})}),e.jsx(ue,{open:a,onClose:()=>o(!1),"aria-labelledby":"create-user-modal",children:e.jsxs(he,{"aria-labelledby":"create-user-modal",sx:{maxWidth:600,width:"100%"},children:[e.jsx(De,{}),e.jsx(y,{id:"create-user-modal",level:"title-md",fontWeight:"lg",sx:{mb:2},children:"Create User"}),e.jsx(y,{children:"Form not implemented."})]})})]})})}const gi=({users:s})=>{Qe();const t=r=>e.jsxs("div",{children:[e.jsx("strong",{children:"Name:"})," ",r.name||"-",e.jsx("br",{}),e.jsx("strong",{children:"Email:"})," ",r.email||"-",e.jsx("br",{}),e.jsx("strong",{children:"Role:"})," ",r.role||"-",e.jsx("br",{}),e.jsx("strong",{children:"ID:"})," ",r.id||"-",e.jsx("br",{}),e.jsx("strong",{children:"Created:"})," ",r.created_at?new Date(r.created_at).toLocaleString():"-",e.jsx("br",{}),e.jsx("strong",{children:"Last Login:"})," ",r.last_login?new Date(r.last_login).toLocaleString():"-",e.jsx("br",{}),e.jsx("strong",{children:"Phone:"})," ",r.phone||"-"]});return e.jsx(e.Fragment,{children:e.jsx(ks,{items:s,renderItem:t,ariaLabel:"Users Mobile View"})})};function Er({open:s,onClose:t,onSaved:r,mode:i="add",supplier:n}){const[a,o]=u.useState(n?.name||""),[l,c]=u.useState(n?.contact_name||""),[d,h]=u.useState(n?.email||""),[p,g]=u.useState(n?.phone||""),[m,f]=u.useState(n?.address||""),[x,b]=u.useState(!1),[_,I]=u.useState(null);u.useEffect(()=>{s&&i==="edit"&&n?(o(n.name||""),c(n.contact_name||""),h(n.email||""),g(n.phone||""),f(n.address||"")):s&&i==="add"&&(o(""),c(""),h(""),g(""),f(""))},[s,i,n]);const A=async()=>{b(!0),I(null);const S={name:a,contact_name:l,email:d,phone:p,address:m};let k;if(i==="add"){k=await v.from("Suppliers").insert([S]).select(),b(!1),k.error?I(k.error.message):r(k.data?.[0]?.id);return}else k=await v.from("Suppliers").update(S).eq("id",n?.id);b(!1),k.error?I(k.error.message):r()};return e.jsx(ue,{open:s,onClose:t,children:e.jsxs(he,{sx:{minWidth:400},children:[e.jsx(De,{}),e.jsxs(y,{level:"title-md",sx:{mb:2},children:[i==="edit"?"Edit":"Add"," Supplier"]}),e.jsxs("form",{onSubmit:S=>{S.preventDefault(),S.stopPropagation(),A()},children:[e.jsx(M,{placeholder:"Name",value:a,onChange:S=>o(S.target.value),sx:{mb:2},required:!0}),e.jsx(M,{placeholder:"Contact Name",value:l,onChange:S=>c(S.target.value),sx:{mb:2}}),e.jsx(M,{placeholder:"Email",value:d,onChange:S=>h(S.target.value),sx:{mb:2},type:"email",required:!0}),e.jsx(M,{placeholder:"Phone",value:p,onChange:S=>g(S.target.value),sx:{mb:2},type:"tel"}),e.jsx(M,{placeholder:"Address",value:m,onChange:S=>f(S.target.value),sx:{mb:2}}),_&&e.jsx(y,{color:"danger",sx:{mb:1},children:_}),e.jsx(q,{type:"submit",loading:x,disabled:x,variant:"solid",children:"Save"})]})]})})}function bi(){const[s,t]=u.useState([]),[r,i]=u.useState(null),[n,a]=u.useState(!1),[o,l]=u.useState("view"),[c,d]=u.useState("");u.useEffect(()=>{h()},[]);const h=async()=>{const{data:m,error:f}=await v.from("Suppliers").select("*");f?console.log("error",f):t(m||[])},p=m=>{i(m),l("edit"),a(!0)},g=async m=>{const{error:f}=await v.from("Suppliers").delete().eq("id",m);f?console.log("error",f):h()};return e.jsx(Ne,{children:e.jsxs(w,{sx:{width:"100%",minHeight:"100dvh",bgcolor:"background.body",borderRadius:0,boxShadow:"none",pl:0,pr:0,pt:0,pb:0},children:[e.jsx(y,{level:"h2",sx:{mb:2,fontSize:"xlarge",textAlign:"left"},gutterBottom:!0,children:"Suppliers"}),e.jsxs(w,{sx:{display:"flex",gap:2,mb:3,alignItems:"center",justifyContent:"space-between"},children:[e.jsx(M,{placeholder:"Search suppliers...",value:c,onChange:m=>d(m.target.value),sx:{flex:1}}),e.jsx(q,{variant:"solid",onClick:()=>{i(null),l("add"),a(!0)},sx:{minWidth:140},children:"Add Supplier"})]}),e.jsx(Ge,{container:!0,spacing:2,sx:{mt:2},children:s.filter(m=>m.name?.toLowerCase().includes(c.toLowerCase())||m.contact_name?.toLowerCase().includes(c.toLowerCase())||m.email?.toLowerCase().includes(c.toLowerCase())||m.phone?.toLowerCase().includes(c.toLowerCase())||m.address?.toLowerCase().includes(c.toLowerCase())).map(m=>e.jsx(Ge,{xs:12,md:4,children:e.jsxs(we,{variant:"outlined",children:[e.jsxs(w,{sx:{p:2},children:[e.jsx(y,{level:"h4",sx:{mb:1},children:m.name}),e.jsxs(y,{level:"body-md",children:[e.jsx("b",{children:"Address:"})," ",m.address||"N/A"]}),e.jsxs(y,{level:"body-md",children:[e.jsx("b",{children:"Contact Name:"})," ",m.contact_name||"N/A"]}),e.jsxs(y,{level:"body-md",children:[e.jsx("b",{children:"Email:"})," ",m.email||"N/A"]}),e.jsxs(y,{level:"body-md",children:[e.jsx("b",{children:"Phone:"})," ",m.phone||"N/A"]})]}),e.jsxs(w,{sx:{display:"flex",justifyContent:"flex-end",mt:1},children:[e.jsx(q,{size:"sm",onClick:()=>p(m),startDecorator:e.jsx(ys,{}),children:"Edit"}),e.jsx(q,{size:"sm",color:"danger",onClick:()=>g(m.id),startDecorator:e.jsx(vr,{}),children:"Delete"})]})]})},m.id))}),e.jsx(Er,{open:n,onClose:()=>a(!1),supplier:r,onSaved:()=>{a(!1),h()},mode:o==="edit"||o==="add"?o:void 0})]})})}function ji({orderId:s,editable:t,onItemsChange:r,initialItems:i=[]}){const[n,a]=u.useState(i),[o,l]=u.useState([]),[c,d]=u.useState(!1);u.useEffect(()=>{d(!0),v.from("Products").select("uuid, ProductName").then(({data:m,error:f})=>{f?console.error("Failed to fetch products:",f.message):l(m||[]),d(!1)})},[]);const h=(m,f,x)=>{a(b=>{const _=b.map((I,A)=>A===m?{...I,[f]:x}:I);return r&&r(_),_})},p=()=>{a(m=>{const f=[...m,{product_id:null,quantity_ordered:1,unit_price:0}];return r&&r(f),f})},g=m=>{a(f=>{const x=f.filter((b,_)=>_!==m);return r&&r(x),x})};return e.jsxs(w,{sx:{mt:2},children:[e.jsxs(Le,{size:"sm",sx:{minWidth:500},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Quantity"}),e.jsx("th",{children:"Unit Price"}),e.jsx("th",{children:"Total"}),t&&e.jsx("th",{})]})}),e.jsx("tbody",{children:n.map((m,f)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(xs,{options:o,getOptionLabel:x=>x.ProductName,value:o.find(x=>x.uuid===m.product_id)||null,onChange:(x,b)=>h(f,"product_id",b?b.uuid:null),disabled:!t,sx:{minWidth:180},isOptionEqualToValue:(x,b)=>x.uuid===b.uuid,required:!0})}),e.jsx("td",{children:e.jsx(M,{type:"number",value:m.quantity_ordered??1,onChange:x=>h(f,"quantity_ordered",Math.max(1,Number(x.target.value))),disabled:!t,sx:{width:80},required:!0})}),e.jsx("td",{children:e.jsx(M,{type:"number",value:m.unit_price??0,onChange:x=>h(f,"unit_price",Math.max(0,Number(x.target.value))),disabled:!t,sx:{width:100},required:!0})}),e.jsx("td",{children:(m.quantity_ordered*m.unit_price).toFixed(2)}),t&&e.jsx("td",{children:e.jsx(q,{size:"sm",color:"danger",onClick:()=>g(f),children:"Remove"})})]},f))})]}),t&&e.jsx(q,{size:"sm",variant:"soft",onClick:p,sx:{mt:1},children:"Add Item"})]})}const yt=["Pending","Approved","Received","Cancelled"];function is({open:s,onClose:t,onCreated:r,mode:i="add",order:n}){const[a,o]=u.useState(n?.order_number||""),[l,c]=u.useState(n?.order_date||new Date().toISOString().slice(0,10)),[d,h]=u.useState(n?.status||"Pending"),[p,g]=u.useState(n?.total?String(n.total):""),[m,f]=u.useState(n?.notes||""),[x,b]=u.useState(n?.supplier_id||null),[_,I]=u.useState(!1),[A,S]=u.useState(null),[k,E]=u.useState([]),[D,U]=u.useState(""),[X,Z]=u.useState(!1),[L,C]=u.useState([{product_id:null,quantity_ordered:1,unit_price:0}]);u.useRef(null),u.useEffect(()=>{s?(console.log("[PurchaseOrderForm] Modal opened"),v.from("Suppliers").select("id, name").then(({data:O})=>{E(O||[])}),i==="edit"&&n?.id?v.from("purchaseorderitems").select("*").eq("purchase_order_id",n.id).then(({data:O})=>{C(O||[])}):i==="add"&&C([{product_id:null,quantity_ordered:1,unit_price:0}])):console.log("[PurchaseOrderForm] Modal closed")},[s,i,n]);const R=async O=>{console.log("[PurchaseOrderForm] handleSupplierAdded called");const{data:$}=await v.from("Suppliers").select("id, name");E($||[]),O&&(b(String(O)),console.log("[PurchaseOrderForm] New supplier set:",O)),Z(!1),console.log("[PurchaseOrderForm] SupplierForm closed")},z=async()=>{console.log("[PurchaseOrderForm] handleSave called"),I(!0),S(null);const O={order_date:l,status:d,notes:m,supplier_id:x};i==="edit"&&(O.order_number=a),O.total=p?parseFloat(p):null;let $,N=n?.id;if(i==="add"?($=await v.from("PurchaseOrders").insert([O]).select(),!$.error&&$.data&&$.data[0]&&(N=$.data[0].id)):n&&($=await v.from("PurchaseOrders").update(O).eq("id",n.id)),$&&!$.error&&i==="add"&&N&&L.length>0){const Q=L.filter(K=>K.product_id).map(K=>({purchase_order_id:N,product_id:K.product_id,quantity_ordered:K.quantity_ordered,unit_price:K.unit_price,notes:K.notes||null}));if(Q.length===0){S("Please select a product for each item before saving."),I(!1);return}const W=await v.from("purchaseorderitems").insert(Q);if(W.error){S("Failed to save items: "+W.error.message),I(!1);return}}I(!1),$?.error?(S($.error.message),console.log("[PurchaseOrderForm] Save error:",$.error.message)):(r(),t(),o(""),c(new Date().toISOString().slice(0,10)),h("Pending"),g(""),f(""),b(null),U(""),console.log("[PurchaseOrderForm] Purchase order saved and modal closed"))};return e.jsx(ue,{open:s,onClose:t,"aria-labelledby":"purchase-order-form-title",children:e.jsxs(he,{sx:{minWidth:400},children:[e.jsx(De,{}),e.jsxs(y,{id:"purchase-order-form-title",level:"title-md",sx:{mb:2},children:[i==="edit"?"Edit":"Add"," Purchase Order"]}),e.jsxs("form",{onSubmit:O=>{O.preventDefault(),z()},children:[e.jsx(M,{type:"date",value:l,onChange:O=>c(O.target.value),sx:{mb:2},required:!0}),e.jsx(ye,{value:d,onChange:(O,$)=>h($??"Pending"),sx:{mb:2,display:"none"},required:!0,children:yt.map(O=>e.jsx(B,{value:O,children:O},O))}),i==="edit"&&e.jsx(w,{sx:{mb:2},children:e.jsx(je,{variant:"soft",color:d==="Approved"?"success":d==="Received"?"primary":d==="Cancelled"?"danger":"neutral",sx:{textTransform:"capitalize",fontWeight:600,fontSize:"md",px:1.5,py:.5},onClick:()=>{const O=yt.indexOf(d);h(yt[(O+1)%yt.length])},children:d})}),e.jsxs(w,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(xs,{options:k,getOptionLabel:O=>O.name,value:k.find(O=>O.id===x)||null,onChange:(O,$)=>b($?$.id:null),inputValue:D,onInputChange:(O,$)=>U($),placeholder:"Select supplier",sx:{flex:1,mb:0},isOptionEqualToValue:(O,$)=>O.id===$.id,required:!0}),e.jsx(de,{color:"primary",sx:{ml:1},onClick:()=>Z(!0),children:e.jsx(lt,{})})]}),e.jsx(Er,{open:X,onClose:()=>Z(!1),onSaved:R,mode:"add"}),i==="edit"&&e.jsxs(e.Fragment,{children:[e.jsx(M,{placeholder:"Order Number",value:a,onChange:O=>o(O.target.value),sx:{mb:2}}),e.jsx(M,{placeholder:"Total",value:p,onChange:O=>g(O.target.value),sx:{mb:2},type:"number",readOnly:!0})]}),e.jsx(M,{placeholder:"Notes",value:m,onChange:O=>f(O.target.value),sx:{mb:2}}),e.jsx(ji,{orderId:n?.id,editable:i==="add",onItemsChange:C,initialItems:L}),e.jsx(w,{sx:{height:16}}),A&&e.jsx(y,{color:"danger",sx:{mb:1},children:A}),e.jsx(q,{type:"submit",loading:_,disabled:_,variant:"solid",children:"Save"})]})]})})}function Or(s,t){return function(){return s.apply(t,arguments)}}const{toString:yi}=Object.prototype,{getPrototypeOf:vs}=Object,{iterator:$t,toStringTag:Ar}=Symbol,Ft=(s=>t=>{const r=yi.call(t);return s[r]||(s[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),Pe=s=>(s=s.toLowerCase(),t=>Ft(t)===s),Ut=s=>t=>typeof t===s,{isArray:Xe}=Array,dt=Ut("undefined");function Si(s){return s!==null&&!dt(s)&&s.constructor!==null&&!dt(s.constructor)&&me(s.constructor.isBuffer)&&s.constructor.isBuffer(s)}const Ir=Pe("ArrayBuffer");function wi(s){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(s):t=s&&s.buffer&&Ir(s.buffer),t}const ki=Ut("string"),me=Ut("function"),Tr=Ut("number"),Bt=s=>s!==null&&typeof s=="object",vi=s=>s===!0||s===!1,kt=s=>{if(Ft(s)!=="object")return!1;const t=vs(s);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Ar in s)&&!($t in s)},Ci=Pe("Date"),Pi=Pe("File"),_i=Pe("Blob"),Ri=Pe("FileList"),Ei=s=>Bt(s)&&me(s.pipe),Oi=s=>{let t;return s&&(typeof FormData=="function"&&s instanceof FormData||me(s.append)&&((t=Ft(s))==="formdata"||t==="object"&&me(s.toString)&&s.toString()==="[object FormData]"))},Ai=Pe("URLSearchParams"),[Ii,Ti,Di,Li]=["ReadableStream","Request","Response","Headers"].map(Pe),Ni=s=>s.trim?s.trim():s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ht(s,t,{allOwnKeys:r=!1}={}){if(s===null||typeof s>"u")return;let i,n;if(typeof s!="object"&&(s=[s]),Xe(s))for(i=0,n=s.length;i<n;i++)t.call(null,s[i],i,s);else{const a=r?Object.getOwnPropertyNames(s):Object.keys(s),o=a.length;let l;for(i=0;i<o;i++)l=a[i],t.call(null,s[l],l,s)}}function Dr(s,t){t=t.toLowerCase();const r=Object.keys(s);let i=r.length,n;for(;i-- >0;)if(n=r[i],t===n.toLowerCase())return n;return null}const Fe=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Lr=s=>!dt(s)&&s!==Fe;function os(){const{caseless:s}=Lr(this)&&this||{},t={},r=(i,n)=>{const a=s&&Dr(t,n)||n;kt(t[a])&&kt(i)?t[a]=os(t[a],i):kt(i)?t[a]=os({},i):Xe(i)?t[a]=i.slice():t[a]=i};for(let i=0,n=arguments.length;i<n;i++)arguments[i]&&ht(arguments[i],r);return t}const zi=(s,t,r,{allOwnKeys:i}={})=>(ht(t,(n,a)=>{r&&me(n)?s[a]=Or(n,r):s[a]=n},{allOwnKeys:i}),s),Mi=s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),qi=(s,t,r,i)=>{s.prototype=Object.create(t.prototype,i),s.prototype.constructor=s,Object.defineProperty(s,"super",{value:t.prototype}),r&&Object.assign(s.prototype,r)},$i=(s,t,r,i)=>{let n,a,o;const l={};if(t=t||{},s==null)return t;do{for(n=Object.getOwnPropertyNames(s),a=n.length;a-- >0;)o=n[a],(!i||i(o,s,t))&&!l[o]&&(t[o]=s[o],l[o]=!0);s=r!==!1&&vs(s)}while(s&&(!r||r(s,t))&&s!==Object.prototype);return t},Fi=(s,t,r)=>{s=String(s),(r===void 0||r>s.length)&&(r=s.length),r-=t.length;const i=s.indexOf(t,r);return i!==-1&&i===r},Ui=s=>{if(!s)return null;if(Xe(s))return s;let t=s.length;if(!Tr(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=s[t];return r},Bi=(s=>t=>s&&t instanceof s)(typeof Uint8Array<"u"&&vs(Uint8Array)),Wi=(s,t)=>{const i=(s&&s[$t]).call(s);let n;for(;(n=i.next())&&!n.done;){const a=n.value;t.call(s,a[0],a[1])}},Hi=(s,t)=>{let r;const i=[];for(;(r=s.exec(t))!==null;)i.push(r);return i},Vi=Pe("HTMLFormElement"),Ji=s=>s.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,i,n){return i.toUpperCase()+n}),Bs=(({hasOwnProperty:s})=>(t,r)=>s.call(t,r))(Object.prototype),Gi=Pe("RegExp"),Nr=(s,t)=>{const r=Object.getOwnPropertyDescriptors(s),i={};ht(r,(n,a)=>{let o;(o=t(n,a,s))!==!1&&(i[a]=o||n)}),Object.defineProperties(s,i)},Zi=s=>{Nr(s,(t,r)=>{if(me(s)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const i=s[r];if(me(i)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},Qi=(s,t)=>{const r={},i=n=>{n.forEach(a=>{r[a]=!0})};return Xe(s)?i(s):i(String(s).split(t)),r},Ki=()=>{},Xi=(s,t)=>s!=null&&Number.isFinite(s=+s)?s:t;function Yi(s){return!!(s&&me(s.append)&&s[Ar]==="FormData"&&s[$t])}const eo=s=>{const t=new Array(10),r=(i,n)=>{if(Bt(i)){if(t.indexOf(i)>=0)return;if(!("toJSON"in i)){t[n]=i;const a=Xe(i)?[]:{};return ht(i,(o,l)=>{const c=r(o,n+1);!dt(c)&&(a[l]=c)}),t[n]=void 0,a}}return i};return r(s,0)},to=Pe("AsyncFunction"),so=s=>s&&(Bt(s)||me(s))&&me(s.then)&&me(s.catch),zr=((s,t)=>s?setImmediate:t?((r,i)=>(Fe.addEventListener("message",({source:n,data:a})=>{n===Fe&&a===r&&i.length&&i.shift()()},!1),n=>{i.push(n),Fe.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",me(Fe.postMessage)),ro=typeof queueMicrotask<"u"?queueMicrotask.bind(Fe):typeof process<"u"&&process.nextTick||zr,no=s=>s!=null&&me(s[$t]),j={isArray:Xe,isArrayBuffer:Ir,isBuffer:Si,isFormData:Oi,isArrayBufferView:wi,isString:ki,isNumber:Tr,isBoolean:vi,isObject:Bt,isPlainObject:kt,isReadableStream:Ii,isRequest:Ti,isResponse:Di,isHeaders:Li,isUndefined:dt,isDate:Ci,isFile:Pi,isBlob:_i,isRegExp:Gi,isFunction:me,isStream:Ei,isURLSearchParams:Ai,isTypedArray:Bi,isFileList:Ri,forEach:ht,merge:os,extend:zi,trim:Ni,stripBOM:Mi,inherits:qi,toFlatObject:$i,kindOf:Ft,kindOfTest:Pe,endsWith:Fi,toArray:Ui,forEachEntry:Wi,matchAll:Hi,isHTMLForm:Vi,hasOwnProperty:Bs,hasOwnProp:Bs,reduceDescriptors:Nr,freezeMethods:Zi,toObjectSet:Qi,toCamelCase:Ji,noop:Ki,toFiniteNumber:Xi,findKey:Dr,global:Fe,isContextDefined:Lr,isSpecCompliantForm:Yi,toJSONObject:eo,isAsyncFn:to,isThenable:so,setImmediate:zr,asap:ro,isIterable:no};function F(s,t,r,i,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=s,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),i&&(this.request=i),n&&(this.response=n,this.status=n.status?n.status:null)}j.inherits(F,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:j.toJSONObject(this.config),code:this.code,status:this.status}}});const Mr=F.prototype,qr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(s=>{qr[s]={value:s}});Object.defineProperties(F,qr);Object.defineProperty(Mr,"isAxiosError",{value:!0});F.from=(s,t,r,i,n,a)=>{const o=Object.create(Mr);return j.toFlatObject(s,o,function(c){return c!==Error.prototype},l=>l!=="isAxiosError"),F.call(o,s.message,t,r,i,n),o.cause=s,o.name=s.name,a&&Object.assign(o,a),o};const io=null;function as(s){return j.isPlainObject(s)||j.isArray(s)}function $r(s){return j.endsWith(s,"[]")?s.slice(0,-2):s}function Ws(s,t,r){return s?s.concat(t).map(function(n,a){return n=$r(n),!r&&a?"["+n+"]":n}).join(r?".":""):t}function oo(s){return j.isArray(s)&&!s.some(as)}const ao=j.toFlatObject(j,{},null,function(t){return/^is[A-Z]/.test(t)});function Wt(s,t,r){if(!j.isObject(s))throw new TypeError("target must be an object");t=t||new FormData,r=j.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(x,b){return!j.isUndefined(b[x])});const i=r.metaTokens,n=r.visitor||h,a=r.dots,o=r.indexes,c=(r.Blob||typeof Blob<"u"&&Blob)&&j.isSpecCompliantForm(t);if(!j.isFunction(n))throw new TypeError("visitor must be a function");function d(f){if(f===null)return"";if(j.isDate(f))return f.toISOString();if(j.isBoolean(f))return f.toString();if(!c&&j.isBlob(f))throw new F("Blob is not supported. Use a Buffer instead.");return j.isArrayBuffer(f)||j.isTypedArray(f)?c&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function h(f,x,b){let _=f;if(f&&!b&&typeof f=="object"){if(j.endsWith(x,"{}"))x=i?x:x.slice(0,-2),f=JSON.stringify(f);else if(j.isArray(f)&&oo(f)||(j.isFileList(f)||j.endsWith(x,"[]"))&&(_=j.toArray(f)))return x=$r(x),_.forEach(function(A,S){!(j.isUndefined(A)||A===null)&&t.append(o===!0?Ws([x],S,a):o===null?x:x+"[]",d(A))}),!1}return as(f)?!0:(t.append(Ws(b,x,a),d(f)),!1)}const p=[],g=Object.assign(ao,{defaultVisitor:h,convertValue:d,isVisitable:as});function m(f,x){if(!j.isUndefined(f)){if(p.indexOf(f)!==-1)throw Error("Circular reference detected in "+x.join("."));p.push(f),j.forEach(f,function(_,I){(!(j.isUndefined(_)||_===null)&&n.call(t,_,j.isString(I)?I.trim():I,x,g))===!0&&m(_,x?x.concat(I):[I])}),p.pop()}}if(!j.isObject(s))throw new TypeError("data must be an object");return m(s),t}function Hs(s){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(i){return t[i]})}function Cs(s,t){this._pairs=[],s&&Wt(s,this,t)}const Fr=Cs.prototype;Fr.append=function(t,r){this._pairs.push([t,r])};Fr.toString=function(t){const r=t?function(i){return t.call(this,i,Hs)}:Hs;return this._pairs.map(function(n){return r(n[0])+"="+r(n[1])},"").join("&")};function lo(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Ur(s,t,r){if(!t)return s;const i=r&&r.encode||lo;j.isFunction(r)&&(r={serialize:r});const n=r&&r.serialize;let a;if(n?a=n(t,r):a=j.isURLSearchParams(t)?t.toString():new Cs(t,r).toString(i),a){const o=s.indexOf("#");o!==-1&&(s=s.slice(0,o)),s+=(s.indexOf("?")===-1?"?":"&")+a}return s}class Vs{constructor(){this.handlers=[]}use(t,r,i){return this.handlers.push({fulfilled:t,rejected:r,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){j.forEach(this.handlers,function(i){i!==null&&t(i)})}}const Br={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},co=typeof URLSearchParams<"u"?URLSearchParams:Cs,uo=typeof FormData<"u"?FormData:null,ho=typeof Blob<"u"?Blob:null,po={isBrowser:!0,classes:{URLSearchParams:co,FormData:uo,Blob:ho},protocols:["http","https","file","blob","url","data"]},Ps=typeof window<"u"&&typeof document<"u",ls=typeof navigator=="object"&&navigator||void 0,fo=Ps&&(!ls||["ReactNative","NativeScript","NS"].indexOf(ls.product)<0),xo=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",mo=Ps&&window.location.href||"http://localhost",go=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ps,hasStandardBrowserEnv:fo,hasStandardBrowserWebWorkerEnv:xo,navigator:ls,origin:mo},Symbol.toStringTag,{value:"Module"})),le={...go,...po};function bo(s,t){return Wt(s,new le.classes.URLSearchParams,Object.assign({visitor:function(r,i,n,a){return le.isNode&&j.isBuffer(r)?(this.append(i,r.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},t))}function jo(s){return j.matchAll(/\w+|\[(\w*)]/g,s).map(t=>t[0]==="[]"?"":t[1]||t[0])}function yo(s){const t={},r=Object.keys(s);let i;const n=r.length;let a;for(i=0;i<n;i++)a=r[i],t[a]=s[a];return t}function Wr(s){function t(r,i,n,a){let o=r[a++];if(o==="__proto__")return!0;const l=Number.isFinite(+o),c=a>=r.length;return o=!o&&j.isArray(n)?n.length:o,c?(j.hasOwnProp(n,o)?n[o]=[n[o],i]:n[o]=i,!l):((!n[o]||!j.isObject(n[o]))&&(n[o]=[]),t(r,i,n[o],a)&&j.isArray(n[o])&&(n[o]=yo(n[o])),!l)}if(j.isFormData(s)&&j.isFunction(s.entries)){const r={};return j.forEachEntry(s,(i,n)=>{t(jo(i),n,r,0)}),r}return null}function So(s,t,r){if(j.isString(s))try{return(t||JSON.parse)(s),j.trim(s)}catch(i){if(i.name!=="SyntaxError")throw i}return(r||JSON.stringify)(s)}const pt={transitional:Br,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const i=r.getContentType()||"",n=i.indexOf("application/json")>-1,a=j.isObject(t);if(a&&j.isHTMLForm(t)&&(t=new FormData(t)),j.isFormData(t))return n?JSON.stringify(Wr(t)):t;if(j.isArrayBuffer(t)||j.isBuffer(t)||j.isStream(t)||j.isFile(t)||j.isBlob(t)||j.isReadableStream(t))return t;if(j.isArrayBufferView(t))return t.buffer;if(j.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let l;if(a){if(i.indexOf("application/x-www-form-urlencoded")>-1)return bo(t,this.formSerializer).toString();if((l=j.isFileList(t))||i.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Wt(l?{"files[]":t}:t,c&&new c,this.formSerializer)}}return a||n?(r.setContentType("application/json",!1),So(t)):t}],transformResponse:[function(t){const r=this.transitional||pt.transitional,i=r&&r.forcedJSONParsing,n=this.responseType==="json";if(j.isResponse(t)||j.isReadableStream(t))return t;if(t&&j.isString(t)&&(i&&!this.responseType||n)){const o=!(r&&r.silentJSONParsing)&&n;try{return JSON.parse(t)}catch(l){if(o)throw l.name==="SyntaxError"?F.from(l,F.ERR_BAD_RESPONSE,this,null,this.response):l}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:le.classes.FormData,Blob:le.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};j.forEach(["delete","get","head","post","put","patch"],s=>{pt.headers[s]={}});const wo=j.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ko=s=>{const t={};let r,i,n;return s&&s.split(`
`).forEach(function(o){n=o.indexOf(":"),r=o.substring(0,n).trim().toLowerCase(),i=o.substring(n+1).trim(),!(!r||t[r]&&wo[r])&&(r==="set-cookie"?t[r]?t[r].push(i):t[r]=[i]:t[r]=t[r]?t[r]+", "+i:i)}),t},Js=Symbol("internals");function et(s){return s&&String(s).trim().toLowerCase()}function vt(s){return s===!1||s==null?s:j.isArray(s)?s.map(vt):String(s)}function vo(s){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=r.exec(s);)t[i[1]]=i[2];return t}const Co=s=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(s.trim());function Yt(s,t,r,i,n){if(j.isFunction(i))return i.call(this,t,r);if(n&&(t=r),!!j.isString(t)){if(j.isString(i))return t.indexOf(i)!==-1;if(j.isRegExp(i))return i.test(t)}}function Po(s){return s.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,i)=>r.toUpperCase()+i)}function _o(s,t){const r=j.toCamelCase(" "+t);["get","set","has"].forEach(i=>{Object.defineProperty(s,i+r,{value:function(n,a,o){return this[i].call(this,t,n,a,o)},configurable:!0})})}let ge=class{constructor(t){t&&this.set(t)}set(t,r,i){const n=this;function a(l,c,d){const h=et(c);if(!h)throw new Error("header name must be a non-empty string");const p=j.findKey(n,h);(!p||n[p]===void 0||d===!0||d===void 0&&n[p]!==!1)&&(n[p||c]=vt(l))}const o=(l,c)=>j.forEach(l,(d,h)=>a(d,h,c));if(j.isPlainObject(t)||t instanceof this.constructor)o(t,r);else if(j.isString(t)&&(t=t.trim())&&!Co(t))o(ko(t),r);else if(j.isObject(t)&&j.isIterable(t)){let l={},c,d;for(const h of t){if(!j.isArray(h))throw TypeError("Object iterator must return a key-value pair");l[d=h[0]]=(c=l[d])?j.isArray(c)?[...c,h[1]]:[c,h[1]]:h[1]}o(l,r)}else t!=null&&a(r,t,i);return this}get(t,r){if(t=et(t),t){const i=j.findKey(this,t);if(i){const n=this[i];if(!r)return n;if(r===!0)return vo(n);if(j.isFunction(r))return r.call(this,n,i);if(j.isRegExp(r))return r.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=et(t),t){const i=j.findKey(this,t);return!!(i&&this[i]!==void 0&&(!r||Yt(this,this[i],i,r)))}return!1}delete(t,r){const i=this;let n=!1;function a(o){if(o=et(o),o){const l=j.findKey(i,o);l&&(!r||Yt(i,i[l],l,r))&&(delete i[l],n=!0)}}return j.isArray(t)?t.forEach(a):a(t),n}clear(t){const r=Object.keys(this);let i=r.length,n=!1;for(;i--;){const a=r[i];(!t||Yt(this,this[a],a,t,!0))&&(delete this[a],n=!0)}return n}normalize(t){const r=this,i={};return j.forEach(this,(n,a)=>{const o=j.findKey(i,a);if(o){r[o]=vt(n),delete r[a];return}const l=t?Po(a):String(a).trim();l!==a&&delete r[a],r[l]=vt(n),i[l]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return j.forEach(this,(i,n)=>{i!=null&&i!==!1&&(r[n]=t&&j.isArray(i)?i.join(", "):i)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const i=new this(t);return r.forEach(n=>i.set(n)),i}static accessor(t){const i=(this[Js]=this[Js]={accessors:{}}).accessors,n=this.prototype;function a(o){const l=et(o);i[l]||(_o(n,o),i[l]=!0)}return j.isArray(t)?t.forEach(a):a(t),this}};ge.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);j.reduceDescriptors(ge.prototype,({value:s},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>s,set(i){this[r]=i}}});j.freezeMethods(ge);function es(s,t){const r=this||pt,i=t||r,n=ge.from(i.headers);let a=i.data;return j.forEach(s,function(l){a=l.call(r,a,n.normalize(),t?t.status:void 0)}),n.normalize(),a}function Hr(s){return!!(s&&s.__CANCEL__)}function Ye(s,t,r){F.call(this,s??"canceled",F.ERR_CANCELED,t,r),this.name="CanceledError"}j.inherits(Ye,F,{__CANCEL__:!0});function Vr(s,t,r){const i=r.config.validateStatus;!r.status||!i||i(r.status)?s(r):t(new F("Request failed with status code "+r.status,[F.ERR_BAD_REQUEST,F.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function Ro(s){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return t&&t[1]||""}function Eo(s,t){s=s||10;const r=new Array(s),i=new Array(s);let n=0,a=0,o;return t=t!==void 0?t:1e3,function(c){const d=Date.now(),h=i[a];o||(o=d),r[n]=c,i[n]=d;let p=a,g=0;for(;p!==n;)g+=r[p++],p=p%s;if(n=(n+1)%s,n===a&&(a=(a+1)%s),d-o<t)return;const m=h&&d-h;return m?Math.round(g*1e3/m):void 0}}function Oo(s,t){let r=0,i=1e3/t,n,a;const o=(d,h=Date.now())=>{r=h,n=null,a&&(clearTimeout(a),a=null),s.apply(null,d)};return[(...d)=>{const h=Date.now(),p=h-r;p>=i?o(d,h):(n=d,a||(a=setTimeout(()=>{a=null,o(n)},i-p)))},()=>n&&o(n)]}const At=(s,t,r=3)=>{let i=0;const n=Eo(50,250);return Oo(a=>{const o=a.loaded,l=a.lengthComputable?a.total:void 0,c=o-i,d=n(c),h=o<=l;i=o;const p={loaded:o,total:l,progress:l?o/l:void 0,bytes:c,rate:d||void 0,estimated:d&&l&&h?(l-o)/d:void 0,event:a,lengthComputable:l!=null,[t?"download":"upload"]:!0};s(p)},r)},Gs=(s,t)=>{const r=s!=null;return[i=>t[0]({lengthComputable:r,total:s,loaded:i}),t[1]]},Zs=s=>(...t)=>j.asap(()=>s(...t)),Ao=le.hasStandardBrowserEnv?((s,t)=>r=>(r=new URL(r,le.origin),s.protocol===r.protocol&&s.host===r.host&&(t||s.port===r.port)))(new URL(le.origin),le.navigator&&/(msie|trident)/i.test(le.navigator.userAgent)):()=>!0,Io=le.hasStandardBrowserEnv?{write(s,t,r,i,n,a){const o=[s+"="+encodeURIComponent(t)];j.isNumber(r)&&o.push("expires="+new Date(r).toGMTString()),j.isString(i)&&o.push("path="+i),j.isString(n)&&o.push("domain="+n),a===!0&&o.push("secure"),document.cookie=o.join("; ")},read(s){const t=document.cookie.match(new RegExp("(^|;\\s*)("+s+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(s){this.write(s,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function To(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}function Do(s,t){return t?s.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):s}function Jr(s,t,r){let i=!To(t);return s&&(i||r==!1)?Do(s,t):t}const Qs=s=>s instanceof ge?{...s}:s;function Be(s,t){t=t||{};const r={};function i(d,h,p,g){return j.isPlainObject(d)&&j.isPlainObject(h)?j.merge.call({caseless:g},d,h):j.isPlainObject(h)?j.merge({},h):j.isArray(h)?h.slice():h}function n(d,h,p,g){if(j.isUndefined(h)){if(!j.isUndefined(d))return i(void 0,d,p,g)}else return i(d,h,p,g)}function a(d,h){if(!j.isUndefined(h))return i(void 0,h)}function o(d,h){if(j.isUndefined(h)){if(!j.isUndefined(d))return i(void 0,d)}else return i(void 0,h)}function l(d,h,p){if(p in t)return i(d,h);if(p in s)return i(void 0,d)}const c={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:l,headers:(d,h,p)=>n(Qs(d),Qs(h),p,!0)};return j.forEach(Object.keys(Object.assign({},s,t)),function(h){const p=c[h]||n,g=p(s[h],t[h],h);j.isUndefined(g)&&p!==l||(r[h]=g)}),r}const Gr=s=>{const t=Be({},s);let{data:r,withXSRFToken:i,xsrfHeaderName:n,xsrfCookieName:a,headers:o,auth:l}=t;t.headers=o=ge.from(o),t.url=Ur(Jr(t.baseURL,t.url,t.allowAbsoluteUrls),s.params,s.paramsSerializer),l&&o.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):"")));let c;if(j.isFormData(r)){if(le.hasStandardBrowserEnv||le.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((c=o.getContentType())!==!1){const[d,...h]=c?c.split(";").map(p=>p.trim()).filter(Boolean):[];o.setContentType([d||"multipart/form-data",...h].join("; "))}}if(le.hasStandardBrowserEnv&&(i&&j.isFunction(i)&&(i=i(t)),i||i!==!1&&Ao(t.url))){const d=n&&a&&Io.read(a);d&&o.set(n,d)}return t},Lo=typeof XMLHttpRequest<"u",No=Lo&&function(s){return new Promise(function(r,i){const n=Gr(s);let a=n.data;const o=ge.from(n.headers).normalize();let{responseType:l,onUploadProgress:c,onDownloadProgress:d}=n,h,p,g,m,f;function x(){m&&m(),f&&f(),n.cancelToken&&n.cancelToken.unsubscribe(h),n.signal&&n.signal.removeEventListener("abort",h)}let b=new XMLHttpRequest;b.open(n.method.toUpperCase(),n.url,!0),b.timeout=n.timeout;function _(){if(!b)return;const A=ge.from("getAllResponseHeaders"in b&&b.getAllResponseHeaders()),k={data:!l||l==="text"||l==="json"?b.responseText:b.response,status:b.status,statusText:b.statusText,headers:A,config:s,request:b};Vr(function(D){r(D),x()},function(D){i(D),x()},k),b=null}"onloadend"in b?b.onloadend=_:b.onreadystatechange=function(){!b||b.readyState!==4||b.status===0&&!(b.responseURL&&b.responseURL.indexOf("file:")===0)||setTimeout(_)},b.onabort=function(){b&&(i(new F("Request aborted",F.ECONNABORTED,s,b)),b=null)},b.onerror=function(){i(new F("Network Error",F.ERR_NETWORK,s,b)),b=null},b.ontimeout=function(){let S=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const k=n.transitional||Br;n.timeoutErrorMessage&&(S=n.timeoutErrorMessage),i(new F(S,k.clarifyTimeoutError?F.ETIMEDOUT:F.ECONNABORTED,s,b)),b=null},a===void 0&&o.setContentType(null),"setRequestHeader"in b&&j.forEach(o.toJSON(),function(S,k){b.setRequestHeader(k,S)}),j.isUndefined(n.withCredentials)||(b.withCredentials=!!n.withCredentials),l&&l!=="json"&&(b.responseType=n.responseType),d&&([g,f]=At(d,!0),b.addEventListener("progress",g)),c&&b.upload&&([p,m]=At(c),b.upload.addEventListener("progress",p),b.upload.addEventListener("loadend",m)),(n.cancelToken||n.signal)&&(h=A=>{b&&(i(!A||A.type?new Ye(null,s,b):A),b.abort(),b=null)},n.cancelToken&&n.cancelToken.subscribe(h),n.signal&&(n.signal.aborted?h():n.signal.addEventListener("abort",h)));const I=Ro(n.url);if(I&&le.protocols.indexOf(I)===-1){i(new F("Unsupported protocol "+I+":",F.ERR_BAD_REQUEST,s));return}b.send(a||null)})},zo=(s,t)=>{const{length:r}=s=s?s.filter(Boolean):[];if(t||r){let i=new AbortController,n;const a=function(d){if(!n){n=!0,l();const h=d instanceof Error?d:this.reason;i.abort(h instanceof F?h:new Ye(h instanceof Error?h.message:h))}};let o=t&&setTimeout(()=>{o=null,a(new F(`timeout ${t} of ms exceeded`,F.ETIMEDOUT))},t);const l=()=>{s&&(o&&clearTimeout(o),o=null,s.forEach(d=>{d.unsubscribe?d.unsubscribe(a):d.removeEventListener("abort",a)}),s=null)};s.forEach(d=>d.addEventListener("abort",a));const{signal:c}=i;return c.unsubscribe=()=>j.asap(l),c}},Mo=function*(s,t){let r=s.byteLength;if(r<t){yield s;return}let i=0,n;for(;i<r;)n=i+t,yield s.slice(i,n),i=n},qo=async function*(s,t){for await(const r of $o(s))yield*Mo(r,t)},$o=async function*(s){if(s[Symbol.asyncIterator]){yield*s;return}const t=s.getReader();try{for(;;){const{done:r,value:i}=await t.read();if(r)break;yield i}}finally{await t.cancel()}},Ks=(s,t,r,i)=>{const n=qo(s,t);let a=0,o,l=c=>{o||(o=!0,i&&i(c))};return new ReadableStream({async pull(c){try{const{done:d,value:h}=await n.next();if(d){l(),c.close();return}let p=h.byteLength;if(r){let g=a+=p;r(g)}c.enqueue(new Uint8Array(h))}catch(d){throw l(d),d}},cancel(c){return l(c),n.return()}},{highWaterMark:2})},Ht=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Zr=Ht&&typeof ReadableStream=="function",Fo=Ht&&(typeof TextEncoder=="function"?(s=>t=>s.encode(t))(new TextEncoder):async s=>new Uint8Array(await new Response(s).arrayBuffer())),Qr=(s,...t)=>{try{return!!s(...t)}catch{return!1}},Uo=Zr&&Qr(()=>{let s=!1;const t=new Request(le.origin,{body:new ReadableStream,method:"POST",get duplex(){return s=!0,"half"}}).headers.has("Content-Type");return s&&!t}),Xs=64*1024,cs=Zr&&Qr(()=>j.isReadableStream(new Response("").body)),It={stream:cs&&(s=>s.body)};Ht&&(s=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!It[t]&&(It[t]=j.isFunction(s[t])?r=>r[t]():(r,i)=>{throw new F(`Response type '${t}' is not supported`,F.ERR_NOT_SUPPORT,i)})})})(new Response);const Bo=async s=>{if(s==null)return 0;if(j.isBlob(s))return s.size;if(j.isSpecCompliantForm(s))return(await new Request(le.origin,{method:"POST",body:s}).arrayBuffer()).byteLength;if(j.isArrayBufferView(s)||j.isArrayBuffer(s))return s.byteLength;if(j.isURLSearchParams(s)&&(s=s+""),j.isString(s))return(await Fo(s)).byteLength},Wo=async(s,t)=>{const r=j.toFiniteNumber(s.getContentLength());return r??Bo(t)},Ho=Ht&&(async s=>{let{url:t,method:r,data:i,signal:n,cancelToken:a,timeout:o,onDownloadProgress:l,onUploadProgress:c,responseType:d,headers:h,withCredentials:p="same-origin",fetchOptions:g}=Gr(s);d=d?(d+"").toLowerCase():"text";let m=zo([n,a&&a.toAbortSignal()],o),f;const x=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let b;try{if(c&&Uo&&r!=="get"&&r!=="head"&&(b=await Wo(h,i))!==0){let k=new Request(t,{method:"POST",body:i,duplex:"half"}),E;if(j.isFormData(i)&&(E=k.headers.get("content-type"))&&h.setContentType(E),k.body){const[D,U]=Gs(b,At(Zs(c)));i=Ks(k.body,Xs,D,U)}}j.isString(p)||(p=p?"include":"omit");const _="credentials"in Request.prototype;f=new Request(t,{...g,signal:m,method:r.toUpperCase(),headers:h.normalize().toJSON(),body:i,duplex:"half",credentials:_?p:void 0});let I=await fetch(f,g);const A=cs&&(d==="stream"||d==="response");if(cs&&(l||A&&x)){const k={};["status","statusText","headers"].forEach(X=>{k[X]=I[X]});const E=j.toFiniteNumber(I.headers.get("content-length")),[D,U]=l&&Gs(E,At(Zs(l),!0))||[];I=new Response(Ks(I.body,Xs,D,()=>{U&&U(),x&&x()}),k)}d=d||"text";let S=await It[j.findKey(It,d)||"text"](I,s);return!A&&x&&x(),await new Promise((k,E)=>{Vr(k,E,{data:S,headers:ge.from(I.headers),status:I.status,statusText:I.statusText,config:s,request:f})})}catch(_){throw x&&x(),_&&_.name==="TypeError"&&/Load failed|fetch/i.test(_.message)?Object.assign(new F("Network Error",F.ERR_NETWORK,s,f),{cause:_.cause||_}):F.from(_,_&&_.code,s,f)}}),ds={http:io,xhr:No,fetch:Ho};j.forEach(ds,(s,t)=>{if(s){try{Object.defineProperty(s,"name",{value:t})}catch{}Object.defineProperty(s,"adapterName",{value:t})}});const Ys=s=>`- ${s}`,Vo=s=>j.isFunction(s)||s===null||s===!1,Kr={getAdapter:s=>{s=j.isArray(s)?s:[s];const{length:t}=s;let r,i;const n={};for(let a=0;a<t;a++){r=s[a];let o;if(i=r,!Vo(r)&&(i=ds[(o=String(r)).toLowerCase()],i===void 0))throw new F(`Unknown adapter '${o}'`);if(i)break;n[o||"#"+a]=i}if(!i){const a=Object.entries(n).map(([l,c])=>`adapter ${l} `+(c===!1?"is not supported by the environment":"is not available in the build"));let o=t?a.length>1?`since :
`+a.map(Ys).join(`
`):" "+Ys(a[0]):"as no adapter specified";throw new F("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return i},adapters:ds};function ts(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new Ye(null,s)}function er(s){return ts(s),s.headers=ge.from(s.headers),s.data=es.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),Kr.getAdapter(s.adapter||pt.adapter)(s).then(function(i){return ts(s),i.data=es.call(s,s.transformResponse,i),i.headers=ge.from(i.headers),i},function(i){return Hr(i)||(ts(s),i&&i.response&&(i.response.data=es.call(s,s.transformResponse,i.response),i.response.headers=ge.from(i.response.headers))),Promise.reject(i)})}const Xr="1.10.0",Vt={};["object","boolean","number","function","string","symbol"].forEach((s,t)=>{Vt[s]=function(i){return typeof i===s||"a"+(t<1?"n ":" ")+s}});const tr={};Vt.transitional=function(t,r,i){function n(a,o){return"[Axios v"+Xr+"] Transitional option '"+a+"'"+o+(i?". "+i:"")}return(a,o,l)=>{if(t===!1)throw new F(n(o," has been removed"+(r?" in "+r:"")),F.ERR_DEPRECATED);return r&&!tr[o]&&(tr[o]=!0,console.warn(n(o," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(a,o,l):!0}};Vt.spelling=function(t){return(r,i)=>(console.warn(`${i} is likely a misspelling of ${t}`),!0)};function Jo(s,t,r){if(typeof s!="object")throw new F("options must be an object",F.ERR_BAD_OPTION_VALUE);const i=Object.keys(s);let n=i.length;for(;n-- >0;){const a=i[n],o=t[a];if(o){const l=s[a],c=l===void 0||o(l,a,s);if(c!==!0)throw new F("option "+a+" must be "+c,F.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new F("Unknown option "+a,F.ERR_BAD_OPTION)}}const Ct={assertOptions:Jo,validators:Vt},_e=Ct.validators;let Ue=class{constructor(t){this.defaults=t||{},this.interceptors={request:new Vs,response:new Vs}}async request(t,r){try{return await this._request(t,r)}catch(i){if(i instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const a=n.stack?n.stack.replace(/^.+\n/,""):"";try{i.stack?a&&!String(i.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+a):i.stack=a}catch{}}throw i}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=Be(this.defaults,r);const{transitional:i,paramsSerializer:n,headers:a}=r;i!==void 0&&Ct.assertOptions(i,{silentJSONParsing:_e.transitional(_e.boolean),forcedJSONParsing:_e.transitional(_e.boolean),clarifyTimeoutError:_e.transitional(_e.boolean)},!1),n!=null&&(j.isFunction(n)?r.paramsSerializer={serialize:n}:Ct.assertOptions(n,{encode:_e.function,serialize:_e.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),Ct.assertOptions(r,{baseUrl:_e.spelling("baseURL"),withXsrfToken:_e.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let o=a&&j.merge(a.common,a[r.method]);a&&j.forEach(["delete","get","head","post","put","patch","common"],f=>{delete a[f]}),r.headers=ge.concat(o,a);const l=[];let c=!0;this.interceptors.request.forEach(function(x){typeof x.runWhen=="function"&&x.runWhen(r)===!1||(c=c&&x.synchronous,l.unshift(x.fulfilled,x.rejected))});const d=[];this.interceptors.response.forEach(function(x){d.push(x.fulfilled,x.rejected)});let h,p=0,g;if(!c){const f=[er.bind(this),void 0];for(f.unshift.apply(f,l),f.push.apply(f,d),g=f.length,h=Promise.resolve(r);p<g;)h=h.then(f[p++],f[p++]);return h}g=l.length;let m=r;for(p=0;p<g;){const f=l[p++],x=l[p++];try{m=f(m)}catch(b){x.call(this,b);break}}try{h=er.call(this,m)}catch(f){return Promise.reject(f)}for(p=0,g=d.length;p<g;)h=h.then(d[p++],d[p++]);return h}getUri(t){t=Be(this.defaults,t);const r=Jr(t.baseURL,t.url,t.allowAbsoluteUrls);return Ur(r,t.params,t.paramsSerializer)}};j.forEach(["delete","get","head","options"],function(t){Ue.prototype[t]=function(r,i){return this.request(Be(i||{},{method:t,url:r,data:(i||{}).data}))}});j.forEach(["post","put","patch"],function(t){function r(i){return function(a,o,l){return this.request(Be(l||{},{method:t,headers:i?{"Content-Type":"multipart/form-data"}:{},url:a,data:o}))}}Ue.prototype[t]=r(),Ue.prototype[t+"Form"]=r(!0)});let Go=class Yr{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(a){r=a});const i=this;this.promise.then(n=>{if(!i._listeners)return;let a=i._listeners.length;for(;a-- >0;)i._listeners[a](n);i._listeners=null}),this.promise.then=n=>{let a;const o=new Promise(l=>{i.subscribe(l),a=l}).then(n);return o.cancel=function(){i.unsubscribe(a)},o},t(function(a,o,l){i.reason||(i.reason=new Ye(a,o,l),r(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=i=>{t.abort(i)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new Yr(function(n){t=n}),cancel:t}}};function Zo(s){return function(r){return s.apply(null,r)}}function Qo(s){return j.isObject(s)&&s.isAxiosError===!0}const us={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(us).forEach(([s,t])=>{us[t]=s});function en(s){const t=new Ue(s),r=Or(Ue.prototype.request,t);return j.extend(r,Ue.prototype,t,{allOwnKeys:!0}),j.extend(r,t,null,{allOwnKeys:!0}),r.create=function(n){return en(Be(s,n))},r}const ee=en(pt);ee.Axios=Ue;ee.CanceledError=Ye;ee.CancelToken=Go;ee.isCancel=Hr;ee.VERSION=Xr;ee.toFormData=Wt;ee.AxiosError=F;ee.Cancel=ee.CanceledError;ee.all=function(t){return Promise.all(t)};ee.spread=Zo;ee.isAxiosError=Qo;ee.mergeConfig=Be;ee.AxiosHeaders=ge;ee.formToJSON=s=>Wr(j.isHTMLForm(s)?new FormData(s):s);ee.getAdapter=Kr.getAdapter;ee.HttpStatusCode=us;ee.default=ee;const{Axios:hl,AxiosError:pl,CanceledError:fl,isCancel:xl,CancelToken:ml,VERSION:gl,all:bl,Cancel:jl,isAxiosError:yl,spread:Sl,toFormData:wl,AxiosHeaders:kl,HttpStatusCode:vl,formToJSON:Cl,getAdapter:Pl,mergeConfig:_l}=ee;async function Ko(s,t){try{console.log("Sending to backend:",{purchaseOrderId:s,items:t});const r=await ee.post("/api/receive-purchase-order",{purchaseOrderId:s,items:t});console.log("Purchase order received successfully:",r.data)}catch(r){throw console.error("Error receiving purchase order:",r),new Error("Failed to receive purchase order")}}const tn=({open:s,onClose:t,poId:r,orderNumber:i,items:n,onConfirm:a})=>{const[o,l]=u.useState([]),[c,d]=u.useState(!0),[h,p]=u.useState(!1);u.useEffect(()=>{s&&(d(!0),l(n.map(f=>({id:f.id,product_id:f.product_id,ProductName:f.ProductName,quantity_ordered:f.quantity_ordered??0,quantity_received:f.quantity_received??f.quantity_ordered??0}))),d(!1))},[n,s]);const g=(f,x)=>{let b=0;if(x==="")b=0;else if(/^\d+$/.test(x))b=parseInt(x,10);else return;l(_=>_.map(I=>I.id===f?{...I,quantity_received:b}:I))},m=async()=>{try{const f=o.map(({product_id:x,quantity_received:b})=>({product_id:String(x),quantity_received:b}));await Ko(String(r),f),p(!0),t()}catch(f){console.error("Error receiving purchase order:",f),alert("Failed to receive purchase order. Please try again.")}};return e.jsxs(e.Fragment,{children:[e.jsx(ue,{open:s,onClose:t,"aria-labelledby":"receive-po-dialog-title",children:e.jsxs(he,{sx:{minWidth:400},children:[e.jsx(De,{}),e.jsxs(y,{id:"receive-po-dialog-title",level:"h4",sx:{mb:2},children:["Receive Purchase Order #",i??r]}),c?e.jsx(y,{children:"Loading items..."}):o.length===0?e.jsx(y,{children:"No items found for this purchase order."}):e.jsxs(Le,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Ordered"}),e.jsx("th",{children:"Received"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:o.map(f=>e.jsxs("tr",{children:[e.jsx("td",{children:f.ProductName}),e.jsx("td",{children:f.quantity_ordered}),e.jsx("td",{children:e.jsx(M,{type:"number",value:f.quantity_received===0&&o.find(x=>x.id===f.id)?.quantity_received===0?"0":f.quantity_received,onChange:x=>g(f.id,x.target.value),sx:{width:80},slotProps:{input:{min:0,max:f.quantity_ordered}}})}),e.jsx("td",{style:{textAlign:"center"},children:f.quantity_received===f.quantity_ordered?e.jsx(Bn,{sx:{color:"#2e7d32"},titleAccess:"Received in full"}):e.jsx(vr,{sx:{color:"#d32f2f"},titleAccess:"Not fully received"})})]},f.id))})]}),e.jsxs(w,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:3},children:[e.jsx(q,{variant:"plain",onClick:t,children:"Cancel"}),e.jsx(q,{variant:"solid",onClick:m,children:"Receive"})]})]})}),e.jsx(xr,{open:h,autoHideDuration:3e3,onClose:()=>p(!1),color:"success",variant:"soft",anchorOrigin:{vertical:"top",horizontal:"center"},children:"Purchase order received successfully!"})]})},sr={Pending:0,Ordered:1,Received:2,Cancelled:3},Xo=({orders:s})=>{const[t,r]=u.useState(s),[i,n]=u.useState(!1),[a,o]=u.useState(null),[l,c]=u.useState(""),[d,h]=u.useState(""),[p,g]=u.useState(!1),[m,f]=u.useState(!1),[x,b]=u.useState(null),[_,I]=u.useState([]);u.useEffect(()=>{async function k(){n(!0),o(null);const{data:E,error:D}=await v.from("PurchaseOrders").select("id, order_number, order_date, status, total, notes, Suppliers(name)").order("order_date",{ascending:!1});!D&&E?r(E.map(U=>({...U,supplier_name:U.Suppliers?.[0]?.name||"N/A",Suppliers:void 0}))):D&&o(D.message||"Failed to fetch purchase orders"),n(!1)}k()},[]);const S=[...t.filter(k=>{const E=k.order_number?.toString().toLowerCase().includes(l.toLowerCase())||k.supplier_name?.toLowerCase().includes(l.toLowerCase()),D=d?k.status===d:!0;return E&&D})].sort((k,E)=>{const D=sr[k.status]??99,U=sr[E.status]??99;return D!==U?D-U:new Date(E.order_date).getTime()-new Date(k.order_date).getTime()});return u.useEffect(()=>{m&&x&&(async()=>{const{data:k,error:E}=await v.from("purchaseorderitems").select("id, product_id, Products(ProductName), quantity_ordered, quantity_received").eq("purchase_order_id",x.id);!E&&k&&I(k)})()},[m,x]),e.jsxs(w,{sx:{width:"100%",minHeight:"100dvh",bgcolor:"background.body",p:2},children:[e.jsx(y,{level:"h2",sx:{mb:2},children:"Purchase Orders"}),e.jsxs(w,{sx:{display:"flex",flexDirection:"column",gap:1,mb:2},children:[e.jsx(M,{placeholder:"Search purchase orders...",value:l,onChange:k=>c(k.target.value)}),e.jsxs(ye,{placeholder:"Filter status",value:d,onChange:(k,E)=>h(E??""),children:[e.jsx(B,{value:"",children:"All Statuses"}),e.jsx(B,{value:"Pending",children:"Pending"}),e.jsx(B,{value:"Approved",children:"Approved"}),e.jsx(B,{value:"Received",children:"Received"}),e.jsx(B,{value:"Cancelled",children:"Cancelled"})]}),e.jsx(q,{onClick:()=>g(!0),variant:"solid",children:"Add Purchase Order"})]}),e.jsx(is,{open:p,onClose:()=>g(!1),onCreated:async()=>{g(!1),n(!0);const{data:k,error:E}=await v.from("PurchaseOrders").select("id, order_number, order_date, status, total, notes, Suppliers(name)").order("order_date",{ascending:!1});!E&&k&&r(k.map(D=>({...D,supplier_name:D.Suppliers?.[0]?.name||"N/A",Suppliers:void 0}))),n(!1)},mode:"add",order:void 0}),e.jsx(tn,{open:m,onClose:()=>f(!1),poId:x?.order_number||x?.id,items:_,onConfirm:async k=>{for(const U of k)await v.from("purchaseorderitems").update({quantity_received:U.quantity_received}).eq("id",U.id);x?.id&&await v.from("PurchaseOrders").update({status:"Received"}).eq("id",x.id),f(!1),n(!0);const{data:E,error:D}=await v.from("PurchaseOrders").select("id, order_number, order_date, status, total, notes, Suppliers(name)").order("order_date",{ascending:!1});!D&&E&&r(E.map(U=>({...U,supplier_name:U.Suppliers?.[0]?.name||"N/A",Suppliers:void 0}))),n(!1)}}),i&&e.jsx(ut,{}),a&&e.jsxs(y,{color:"danger",children:["Error: ",a]}),e.jsx(ks,{items:Array.isArray(S)?S:[],ariaLabel:"Purchase Orders Mobile View",renderItem:k=>k?e.jsxs(w,{children:[e.jsxs(y,{fontWeight:"bold",children:["Order Number: ",k.order_number]}),e.jsxs(y,{children:["Order Date: ",k.order_date]}),e.jsxs(y,{children:["Status: ",k.status]}),e.jsxs(y,{children:["Total: $",k.total?.toFixed(2)??"0.00"]}),e.jsxs(y,{children:["Supplier: ",k.supplier_name]}),e.jsx(w,{sx:{display:"flex",gap:1,mt:1},children:k.status==="Pending"?e.jsx(q,{size:"sm",variant:"outlined",onClick:async()=>{if(k.id){const{error:E}=await v.from("PurchaseOrders").update({status:"Ordered"}).eq("id",k.id);if(!E){n(!0);const{data:D,error:U}=await v.from("PurchaseOrders").select("id, order_number, order_date, status, total, notes, Suppliers(name)").order("order_date",{ascending:!1});!U&&D&&r(D.map(X=>({...X,supplier_name:X.Suppliers?.[0]?.name||"N/A",Suppliers:void 0}))),n(!1)}}},children:"Order"}):e.jsx(q,{size:"sm",variant:"outlined",onClick:async()=>{b(k),f(!0)},disabled:k.status!=="Approved"&&k.status!=="Ordered",children:"Receive"})})]}):e.jsx(y,{color:"neutral",children:"No data"})})]})};function Yo(){const[s,t]=u.useState([]),[r,i]=u.useState(!1),[n,a]=u.useState(null),[o,l]=u.useState(""),[c,d]=u.useState(""),[h,p]=u.useState(!1),[g,m]=u.useState(!1),[f,x]=u.useState(!1),[b,_]=u.useState(null),[I,A]=u.useState([]),S=Ee("(max-width:600px)"),k={fontSize:xe.sizes.small},E={...k,fontWeight:600,borderBottom:"1.5px solid #e0e0e0",background:"inherit"};u.useEffect(()=>{async function L(){i(!0),a(null);const{data:C,error:R}=await v.from("PurchaseOrders").select("id, order_number, order_date, status, total, notes, Suppliers(name)").order("order_date",{ascending:!1});!R&&C?t(C):R&&a(R.message||"Failed to fetch purchase orders"),i(!1)}L()},[]);const D=async()=>{i(!0),a(null);const{data:L,error:C}=await v.from("PurchaseOrders").select("id, order_number, order_date, status, total, notes, Suppliers(name)").order("order_date",{ascending:!1});if(!C&&L){const R=L.map(z=>({...z,supplier_name:z.Suppliers?.[0]?.name||"N/A",Suppliers:void 0}));if(t(R),b){const{data:z,error:O}=await v.from("purchaseorderitems").select(`
            id,
            product_id,
            Products(ProductName),
            quantity_ordered,
            quantity_received
          `).eq("purchase_order_id",b.id);if(!O&&z){const $=z.map(N=>({...N,ProductName:N.Products[0]?.ProductName}));A($)}}}else C&&a(C.message||"Failed to fetch purchase orders");i(!1)};s.filter(L=>{const C=L.order_number?.toString().toLowerCase().includes(o.toLowerCase())||L.Suppliers?.name?.toLowerCase().includes(o.toLowerCase()),R=c?L.status===c:!0;return C&&R});const U=[{id:"order_number",label:"Order Number",minWidth:100},{id:"order_date",label:"Order Date",minWidth:100},{id:"status",label:"Status",minWidth:100},{id:"total",label:"Total",minWidth:100,format:L=>L!=null?`$${L.toFixed(2)}`:"$0.00"},{id:"notes",label:"Notes",minWidth:200},{id:"supplier_name",label:"Supplier",minWidth:150}],X=s.map(L=>({...L,supplier_name:L.Suppliers?.name||"N/A"})),Z=s.map(L=>({id:L.id||L.order_number,order_number:L.order_number,order_date:L.order_date,status:L.status,total:L.total??0,supplier_name:L.Suppliers?.name||L.supplier_name||"N/A",Suppliers:L.Suppliers}));return S?e.jsx(Xo,{orders:Z}):e.jsx(Ne,{children:e.jsxs(w,{sx:{width:"100%",minHeight:"100dvh",bgcolor:"background.body",borderRadius:0,boxShadow:"none",pl:0,pr:0,pt:3,pb:0},children:[e.jsx(y,{level:"h2",sx:{mb:2,fontSize:xe.sizes.xlarge},children:"Purchase Orders"}),e.jsxs(w,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(M,{placeholder:"Search purchase orders...",sx:{flex:1},value:o,onChange:L=>l(L.target.value)}),e.jsxs(ye,{placeholder:"Filter status",value:c,onChange:(L,C)=>d(C??""),sx:{minWidth:160},children:[e.jsx(B,{value:"",children:"All Statuses"}),e.jsx(B,{value:"Pending",children:"Pending"}),e.jsx(B,{value:"Approved",children:"Approved"}),e.jsx(B,{value:"Received",children:"Received"}),e.jsx(B,{value:"Cancelled",children:"Cancelled"})]}),e.jsx(q,{onClick:()=>p(!0),variant:"solid",children:"Add Purchase Order"})]}),e.jsx(is,{open:h,onClose:()=>p(!1),onCreated:D,mode:"add",order:void 0}),e.jsx(is,{open:g,onClose:()=>{m(!1),_(null)},onCreated:D,mode:"edit",order:b}),e.jsx(tn,{open:f&&!!b?.id&&I.every(L=>!!L.id&&!!L.product_id),onClose:()=>x(!1),poId:b?.id,orderNumber:b?.order_number,items:I.filter(L=>!!L.id&&!!L.product_id),onConfirm:async L=>{for(const C of L)await v.from("purchaseorderitems").update({quantity_received:C.quantity_received}).eq("id",C.id);b?.id&&await v.from("PurchaseOrders").update({status:"Received"}).eq("id",b.id),x(!1),await D()}}),e.jsxs(we,{children:[r&&e.jsx(ut,{}),n&&e.jsxs(y,{color:"danger",children:["Error: ",n]}),e.jsxs(Le,{"aria-label":"Purchase Orders",sx:{minWidth:800},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[U.map(L=>e.jsx("th",{style:E,children:L.label},L.id)),e.jsx("th",{style:{width:120,...E}})]})}),e.jsxs("tbody",{children:[X.length===0&&!r&&e.jsx("tr",{children:e.jsx("td",{colSpan:U.length+1,style:{textAlign:"center",color:"#888",...k},children:"No purchase orders found."})}),X.map((L,C)=>e.jsxs("tr",{style:{cursor:"pointer",height:48},children:[U.map(R=>e.jsx("td",{style:k,children:R.format?R.format(L[R.id]):L[R.id]},R.id)),e.jsx("td",{children:L.status==="Pending"?e.jsx(q,{size:"sm",variant:"outlined",onClick:async()=>{if(L.id){const{error:R}=await v.from("PurchaseOrders").update({status:"Ordered"}).eq("id",L.id);R?alert("Failed to update order: "+R.message):await D()}},children:"Order"}):e.jsx(q,{size:"sm",variant:"outlined",onClick:()=>{_(L),x(!0)},disabled:L.status!=="Approved"&&L.status!=="Ordered",children:"Receive"})})]},L.id||L.order_number))]})]})]})]})})}function ea({value:s,onChange:t,toggleSidebar:r}){const i=Ss(),[n,a]=u.useState(!1),[o,l]=u.useState("Sales");if(i.pathname==="/login")return null;const c=u.useMemo(()=>pr({components:{MuiTableRow:{styleOverrides:{root:{"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}}}}}}),[]);Yn.filter(p=>p.showInMobile);const d=o?wt[o].filter(p=>p.showInMobile):[],h=async p=>{const{data:g}=await v.auth.getSession();if(!g&&["orders","products","users","suppliers","purchaseorders","tickets","smscampaigns","movements"].includes(p)){console.warn("Authentication required for this page"),t("home");return}t(p)};return e.jsxs(fr,{theme:c,children:[e.jsxs(Rn,{open:n,onClose:()=>a(!1),children:[e.jsx(En,{children:"Select Area"}),e.jsx(On,{children:["Sales","Support","Marketing","Operations"].map(p=>e.jsx(qs,{fullWidth:!0,variant:o===p?"contained":"outlined",onClick:()=>{l(p),a(!1)},sx:{my:1},children:p},p))}),e.jsx(An,{children:e.jsx(qs,{onClick:()=>a(!1),children:"Close"})})]}),e.jsx(In,{sx:{position:"fixed",bottom:0,left:0,right:0,zIndex:9999,backgroundColor:"rgba(0, 0, 255, 0.2)",overflow:"hidden"},children:e.jsx("div",{style:{display:"flex",flexDirection:"row",overflowX:"auto"},children:e.jsxs(Tn,{showLabels:!0,value:s,onChange:(p,g)=>{h(g)},sx:{minWidth:"max-content",flex:1},children:[d.map(p=>e.jsx($s,{label:p.label,icon:p.icon,value:p.value,onClick:()=>h(p.value)},p.value)),e.jsx($s,{label:o||"",icon:e.jsx(Wn,{}),onClick:p=>{p.stopPropagation(),a(!0)}})]})})})]})}function ta({open:s,onClose:t,onCreated:r}){const[i,n]=u.useState(""),[a,o]=u.useState(""),[l,c]=u.useState(!1),[d,h]=u.useState(null),p=async g=>{g.preventDefault(),c(!0),h(null);const m={subject:i,requester_name:a,status:"Open"};console.log("[DialogTicketCreate] Creating ticket with payload:",m);const{error:f,data:x}=await v.from("tickets").insert(m);f&&(h(f.message||JSON.stringify(f)),console.error("[DialogTicketCreate] Error creating ticket:",f)),c(!1),f||(n(""),o(""),t(),r&&r())};return e.jsx(ue,{open:s,onClose:t,children:e.jsxs(he,{sx:{minWidth:400},children:[e.jsx(y,{level:"title-md",sx:{mb:2},children:"Create Ticket"}),e.jsxs("form",{onSubmit:p,children:[e.jsx(M,{placeholder:"Subject",value:i,onChange:g=>n(g.target.value),sx:{mb:2},required:!0}),e.jsx(M,{placeholder:"Requester Name",value:a,onChange:g=>o(g.target.value),sx:{mb:2},required:!0}),d&&e.jsx(y,{color:"danger",sx:{mb:1},children:d}),e.jsx(q,{type:"submit",loading:l,disabled:l||!i||!a,variant:"solid",children:"Create"})]})]})})}const sa=["Refund issued","Replacement sent","Order cancelled","Technical support provided","Information provided","Awaiting customer response","Other"],ra=({open:s,onClose:t,onSubmit:r})=>{const[i,n]=V.useState(""),[a,o]=V.useState("");return V.useEffect(()=>{s||(n(""),o(""))},[s]),e.jsx(ue,{open:s,onClose:t,children:e.jsxs(he,{children:[e.jsx(Nt,{children:"Resolve Ticket"}),e.jsxs(zt,{sx:{display:"flex",flexDirection:"column",gap:2,minWidth:320},children:[e.jsx(ye,{value:i,onChange:(l,c)=>n(c||""),placeholder:"Select resolution",required:!0,children:sa.map(l=>e.jsx(B,{value:l,children:l},l))}),e.jsx(mr,{minRows:3,placeholder:"Resolution comment to customer...",value:a,onChange:l=>o(l.target.value)})]}),e.jsxs(Mt,{children:[e.jsx(q,{variant:"plain",onClick:t,children:"Cancel"}),e.jsx(q,{variant:"solid",color:"primary",disabled:!i,onClick:()=>{try{r(i,a),t()}catch(l){console.error("Error during form submission:",l)}},children:"Submit"})]})]})})},na=qt(ra),ia=s=>{if(!s)return"";const t=new Date(s),i=Math.floor((new Date().getTime()-t.getTime())/1e3);if(i<60)return"Just now";const n=Math.floor(i/60);if(n<60)return`${n} min ago`;const a=Math.floor(n/60);if(a<24)return`${a} hour${a>1?"s":""} ago`;const o=Math.floor(a/24);if(o<7)return`${o} day${o>1?"s":""} ago`;const l=Math.floor(o/7);if(l<4)return`${l} week${l>1?"s":""} ago`;const c=Math.floor(o/30);return`${c} month${c>1?"s":""} ago`};function oa(){const[s,t]=u.useState([]),[r,i]=u.useState(null),[n,a]=u.useState([]),[o,l]=u.useState(""),[c,d]=u.useState(""),[h,p]=u.useState("Open"),[g,m]=u.useState(!1),[f,x]=u.useState(!1);u.useEffect(()=>{(async()=>{const{data:k,error:E}=await v.from("tickets").select("*").order("created_at",{ascending:!1});E||t(k||[])})()},[]),u.useEffect(()=>{if(!r){a([]);return}(async()=>{const{data:k,error:E}=await v.from("ticketactivities").select("*").eq("ticket_id",r).order("timestamp",{ascending:!0});E||a(k||[])})()},[r]);const b=async()=>{const{data:S,error:k}=await v.from("tickets").select("*").order("created_at",{ascending:!1});k||t(S||[])},_=async()=>{if(o.trim()&&r){console.log("Sending message:",{ticket_id:r,message:o,activity_type:"chat",sender_name:"You"});const{error:S,data:k}=await v.from("ticketactivities").insert({ticket_id:r,message:o,activity_type:"chat",sender_name:"You"}).select();if(S){console.error("Error sending message:",S),alert("Failed to send message: "+S.message);return}console.log("Message sent successfully:",k),l("");const{data:E,error:D}=await v.from("ticketactivities").select("*").eq("ticket_id",r).order("timestamp",{ascending:!0});D?console.error("Error fetching activities:",D):(console.log("Refreshed activities:",E),a(E||[]))}},I=async(S,k)=>{if(r)try{const{error:E}=await v.from("tickets").update({status:"Closed"}).eq("id",r);if(E){console.error("Error updating ticket status:",E),alert("Failed to resolve ticket: "+E.message);return}const{error:D}=await v.from("ticketactivities").insert({ticket_id:r,message:`Ticket resolved: ${S}${k?` - ${k}`:""}`,activity_type:"chat",sender_name:"You"});D&&console.error("Error adding resolution activity:",D),await b();const{data:U}=await v.from("ticketactivities").select("*").eq("ticket_id",r).order("timestamp",{ascending:!0});a(U||[])}catch(E){console.error("Error resolving ticket:",E),alert("Failed to resolve ticket")}},A=s.filter(S=>{if(h!=="All"&&S.status!==h)return!1;if(!c)return!0;const k=c.toLowerCase();return S.subject?.toLowerCase().includes(k)||S.requester_name?.toLowerCase().includes(k)||S.status?.toLowerCase().includes(k)});return e.jsxs(gr,{disableTransitionOnChange:!0,children:[e.jsx(Dn,{}),e.jsx(w,{sx:{display:"flex",flexDirection:"column",minHeight:"100dvh"},children:e.jsxs(w,{sx:{display:"flex",flex:1},children:[e.jsxs(w,{sx:{width:390,borderRight:"1px solid",borderColor:"divider",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs(w,{sx:{px:2,py:1,borderBottom:"1px solid",borderColor:"divider",flexShrink:0},children:[e.jsxs(Ce,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[e.jsxs(Ce,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(y,{level:"title-lg",children:"Messages"}),e.jsx(je,{size:"sm",variant:"soft",color:"neutral",children:A.length})]}),e.jsx(de,{size:"sm",variant:"soft",color:"primary",onClick:()=>m(!0),children:e.jsx(lt,{})})]}),e.jsx(M,{placeholder:"Search",startDecorator:e.jsx(ct,{}),value:c,onChange:S=>d(S.target.value),size:"sm",sx:{width:"100%",mb:1}}),e.jsxs(ye,{value:h,onChange:(S,k)=>p(k),size:"sm",sx:{width:"100%"},placeholder:"Filter by status",children:[e.jsx(B,{value:"All",children:"All Tickets"}),e.jsx(B,{value:"Open",children:"Open"}),e.jsx(B,{value:"Pending",children:"Pending"}),e.jsx(B,{value:"Closed",children:"Closed"})]})]}),e.jsx(w,{sx:{flex:1,overflowY:"auto",overflowX:"hidden",pt:1},children:e.jsx(Ze,{size:"sm",sx:{gap:0},children:A.map(S=>e.jsxs(u.Fragment,{children:[e.jsx($e,{sx:{p:0},children:e.jsx(Oe,{selected:r===S.id,onClick:()=>i(S.id),sx:{py:1,px:2},children:e.jsxs(Ce,{direction:"row",spacing:1.5,alignItems:"flex-start",sx:{width:"100%"},children:[e.jsx(w,{sx:{position:"relative"},children:e.jsx(Ae,{})}),e.jsxs(w,{sx:{flex:1,minWidth:0,pr:1},children:[e.jsxs(Ce,{direction:"row",justifyContent:"space-between",alignItems:"flex-start",sx:{mb:.5},children:[e.jsx(y,{level:"body-md",noWrap:!0,sx:{flex:1,pr:1},children:S.subject||"Untitled"}),S.status&&e.jsx(je,{size:"sm",color:S.status==="Open"?"success":S.status==="Pending"?"warning":S.status==="Closed"?"neutral":"primary",variant:"soft",sx:{flexShrink:0},children:S.status})]}),e.jsx(y,{level:"body-sm",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",mb:.5},children:S.requester_name||""}),e.jsx(w,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(y,{level:"body-xs",sx:{color:"text.tertiary"},children:ia(S.updated_at)})})]})]})})}),e.jsx(ur,{component:"li",sx:{margin:0}})]},S.id))})})]}),e.jsxs(w,{sx:{flex:1,display:"flex",flexDirection:"column"},children:[r&&e.jsx(w,{sx:{px:3,py:2,borderBottom:"1px solid",borderColor:"divider",flexShrink:0},children:e.jsxs(Ce,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(Ae,{size:"sm"}),e.jsxs(w,{sx:{flex:1},children:[e.jsx(y,{level:"title-sm",sx:{fontWeight:600},children:s.find(S=>S.id===r)?.requester_name||"Unknown User"}),e.jsx(y,{level:"body-xs",sx:{color:"text.secondary"},children:s.find(S=>S.id===r)?.status||"Unknown Status"})]}),e.jsx(q,{variant:"outlined",size:"sm",sx:{borderRadius:"16px"},children:"View profile"}),s.find(S=>S.id===r)?.status!=="Closed"&&e.jsx(q,{variant:"solid",color:"primary",size:"sm",sx:{borderRadius:"16px"},onClick:()=>x(!0),children:"Resolve"})]})}),e.jsx(w,{sx:{flex:1,overflowY:"auto",px:3,py:2},children:r?e.jsx(Ce,{spacing:3,children:n.map((S,k)=>{const E=S.sender_name==="You";return e.jsxs(w,{children:[k===0||new Date(S.timestamp||"").toDateString()!==new Date(n[k-1]?.timestamp||"").toDateString()?e.jsxs(w,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(w,{sx:{flex:1,height:"1px",bgcolor:"divider"}}),e.jsx(y,{level:"body-xs",sx:{mx:2,color:"text.secondary"},children:S.timestamp?new Date(S.timestamp).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}):""}),e.jsx(w,{sx:{flex:1,height:"1px",bgcolor:"divider"}})]}):null,e.jsxs(Ce,{direction:"row",spacing:1,sx:{alignItems:"flex-start"},children:[!E&&e.jsx(Ae,{size:"sm"}),e.jsx(w,{sx:{flex:1,display:"flex",flexDirection:E?"row-reverse":"row"},children:e.jsxs(w,{sx:{maxWidth:"70%",bgcolor:E?"primary.500":"neutral.50",color:E?"white":"text.primary",borderRadius:E?"18px 18px 4px 18px":"18px 18px 18px 4px",px:2,py:1.5,position:"relative",boxShadow:"sm"},children:[!E&&e.jsx(y,{level:"body-xs",sx:{fontWeight:600,mb:.5,color:E?"white":"text.primary"},children:S.sender_name}),e.jsx(y,{level:"body-sm",sx:{lineHeight:1.4,color:E?"white":"text.primary"},children:S.message})]})}),E&&e.jsx(Ae,{size:"sm"})]}),e.jsx(w,{sx:{display:"flex",justifyContent:E?"flex-end":"flex-start",mt:.5,ml:E?0:5},children:e.jsx(y,{level:"body-xs",sx:{color:"text.tertiary"},children:S.timestamp?new Date(S.timestamp).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):""})})]},S.id)})}):e.jsx(w,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx(y,{level:"body-md",sx:{color:"text.secondary"},children:"Select a ticket to view messages"})})}),r&&e.jsx(w,{sx:{px:3,py:2,borderTop:"1px solid",borderColor:"divider",flexShrink:0},children:e.jsxs(Ce,{direction:"row",spacing:1,alignItems:"flex-end",children:[e.jsx(w,{sx:{flex:1},children:e.jsx(mr,{placeholder:"Type something here...",value:o,onChange:S=>l(S.target.value),minRows:1,maxRows:4,sx:{borderRadius:"20px",border:"1px solid",borderColor:"neutral.300","&:focus-within":{borderColor:"primary.500"},"& textarea":{border:"none",outline:"none",resize:"none",px:2,py:1}},onKeyDown:S=>{S.key==="Enter"&&!S.shiftKey&&(S.preventDefault(),_())}})}),e.jsx(q,{onClick:_,disabled:!o.trim(),variant:"solid",color:"primary",sx:{borderRadius:"20px",minWidth:60,height:40,fontWeight:600},children:"Send"})]})})]})]})}),e.jsx(ta,{open:g,onClose:()=>m(!1),onCreated:b}),e.jsx(na,{open:f,onClose:()=>x(!1),onSubmit:I})]})}const Se={fontSize:xe.sizes.small},tt={...Se,fontWeight:600,borderBottom:"1.5px solid #e0e0e0",background:"inherit"};function aa({campaigns:s}){const[t,r]=u.useState(s),[i,n]=u.useState(!1),[a,o]=u.useState(null),[l,c]=u.useState(""),[d,h]=u.useState(""),[p,g]=u.useState(!1),m=Ee("(max-width: 600px)");u.useEffect(()=>{async function x(){n(!0),o(null);const{data:b,error:_}=await v.from("sms_campaigns").select("*").order("created_at",{ascending:!1});_?(o(_.message),r([])):b&&r(b),n(!1)}x()},[]);const f=t.filter(x=>{const b=x.name.toLowerCase().includes(l.toLowerCase())||x.CampaignNumber?.toLowerCase().includes(l.toLowerCase()),_=!d||x.status===d;return b&&_});return m?e.jsx("div",{children:"Mobile view coming soon..."}):e.jsx(Ne,{children:e.jsxs(w,{sx:{width:"100%",minHeight:"100dvh",bgcolor:"background.body",borderRadius:0,boxShadow:"none",pl:0,pr:0,pt:3,pb:0},children:[e.jsx(y,{level:"h2",sx:{...Se,mb:2,textAlign:"left",fontSize:xe.sizes.xlarge},children:"SMS Campaigns"}),e.jsxs(w,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(M,{placeholder:"Search campaigns...",sx:{...Se,flex:1},value:l,onChange:x=>c(x.target.value)}),e.jsxs(ye,{placeholder:"Filter status",value:d,onChange:(x,b)=>h(b??""),sx:{...Se,minWidth:160},children:[e.jsx(B,{value:"",children:"All Statuses"}),e.jsx(B,{value:"draft",children:"Draft"}),e.jsx(B,{value:"scheduled",children:"Scheduled"}),e.jsx(B,{value:"sent",children:"Sent"}),e.jsx(B,{value:"failed",children:"Failed"})]}),e.jsx(q,{onClick:()=>g(!0),variant:"solid",sx:Se,children:"Create Campaign"})]}),e.jsxs(we,{children:[i&&e.jsx(ut,{}),e.jsxs(Le,{"aria-label":"Campaigns",sx:{minWidth:800},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:tt,children:"Campaign #"}),e.jsx("th",{style:tt,children:"Name"}),e.jsx("th",{style:tt,children:"Status"}),e.jsx("th",{style:tt,children:"Scheduled"}),e.jsx("th",{style:tt,children:"Recipients"})]})}),e.jsxs("tbody",{children:[f.length===0&&!i&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{textAlign:"center",color:"#888",...Se},children:"No campaigns found."})}),f.map(x=>e.jsxs("tr",{style:{height:48},children:[e.jsx("td",{style:Se,children:x.CampaignNumber}),e.jsx("td",{style:Se,children:x.name}),e.jsx("td",{style:Se,children:e.jsx(je,{variant:"soft",color:x.status==="sent"?"success":x.status==="failed"?"danger":x.status==="scheduled"?"warning":"neutral",size:"sm",sx:{textTransform:"capitalize",...Se},children:x.status})}),e.jsx("td",{style:Se,children:x.scheduled_at?Gn(new Date(x.scheduled_at),"yyyy-MM-dd HH:mm"):"-"}),e.jsx("td",{style:Se,children:x.recipients?.length??0})]},x.id))]})]})]}),a&&e.jsxs(y,{color:"danger",children:["Error: ",a]}),e.jsx(ue,{open:p,onClose:()=>g(!1),children:e.jsxs(he,{children:[e.jsx(y,{level:"h4",children:"Create New Campaign"}),e.jsx(q,{onClick:()=>g(!1),children:"Close"})]})})]})})}function ss(s,t){return t===0?s>0?100:0:(s-t)/t*100}function rs(s){return s==null?"":`${s>0?"+":s<0?"":""}${Math.abs(Math.round(s))}%`}async function la(){const s=new Date,t=s.toISOString().slice(0,10),r=new Date(s.getTime()-30*24*60*60*1e3).toISOString().slice(0,10),i=new Date(s.getTime()-60*24*60*60*1e3).toISOString().slice(0,10),n=new Date(s.getTime()-30*24*60*60*1e3-1).toISOString().slice(0,10),a=await v.from("Orders").select("order_total, customer_email, date",{count:"exact"}).not("order_total","is",null);if(a.error||!a.data)throw new Error("Failed to fetch order stats");const o=a.data,l=o.filter(x=>x.date&&x.date>=r&&x.date<=t),c=o.filter(x=>x.date&&x.date>=i&&x.date<=n),d=l.reduce((x,b)=>x+(typeof b.order_total=="number"?b.order_total:0),0),h=c.reduce((x,b)=>x+(typeof b.order_total=="number"?b.order_total:0),0),p=l.length,g=c.length,m=new Set(l.map(x=>x.customer_email).filter(Boolean)),f=new Set(c.map(x=>x.customer_email).filter(Boolean));return{totalSales:d,orderCount:p,customerCount:m.size,salesChange:ss(d,h),ordersChange:ss(p,g),customersChange:ss(m.size,f.size)}}const ca=()=>{const[s,t]=u.useState(null),[r,i]=u.useState(null),[n,a]=u.useState(null),[o,l]=u.useState(null),[c,d]=u.useState(null),[h,p]=u.useState(null),[g,m]=u.useState(!0),[f,x]=u.useState(null);return Ee("(max-width:600px)"),u.useEffect(()=>{let b=!0,_=!0;async function I(){_&&m(!0),x(null);try{const{totalSales:S,orderCount:k,customerCount:E,salesChange:D,ordersChange:U,customersChange:X}=await la();b&&(t(S),i(k),a(E),l(D),d(U),p(X))}catch(S){b&&x(S.message)}finally{_&&m(!1),_=!1}}I();const A=setInterval(I,1e4);return()=>{b=!1,clearInterval(A)}},[]),e.jsxs(w,{sx:{p:{xs:1,md:4},pt:{xs:0,md:4}},children:[e.jsx(y,{level:"h2",sx:{mb:2},children:"Dashboard"}),e.jsxs(Ge,{container:!0,spacing:2,children:[e.jsx(Ge,{xs:12,md:4,children:e.jsxs(we,{variant:"outlined",children:[e.jsx(y,{level:"h4",children:"Total Sales"}),e.jsx(y,{level:"h2",color:"success",children:g?"Loading...":f?"":`$${s?.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`}),e.jsxs(y,{level:"body-sm",color:"neutral",children:[g?"":rs(o)," from last 30 days"]})]})}),e.jsx(Ge,{xs:12,md:4,children:e.jsxs(we,{variant:"outlined",children:[e.jsx(y,{level:"h4",children:"Orders"}),e.jsx(y,{level:"h2",color:"primary",children:g?"Loading...":f?"":r?.toLocaleString()}),e.jsxs(y,{level:"body-sm",color:"neutral",children:[g?"":rs(c)," from last 30 days"]})]})}),e.jsx(Ge,{xs:12,md:4,children:e.jsxs(we,{variant:"outlined",children:[e.jsx(y,{level:"h4",children:"Customers"}),e.jsx(y,{level:"h2",color:"warning",children:g?"Loading...":f?"":n?.toLocaleString()}),e.jsxs(y,{level:"body-sm",color:"neutral",children:[g?"":rs(h)," new last 30 days"]})]})})]})]})},ve=({children:s})=>{const[t,r]=u.useState(null),[i,n]=u.useState(!0);return u.useEffect(()=>{async function a(){const{data:o}=await v.auth.getSession();r(o?.session||null),n(!1)}a()},[]),i?e.jsx("div",{children:"Loading..."}):t?e.jsx(e.Fragment,{children:s}):e.jsx(Et,{to:"/",replace:!0})};function da({onLogin:s}){const t=Qe(),[r,i]=u.useState(""),[n,a]=u.useState(""),[o,l]=u.useState(!1),[c,d]=u.useState(null);u.useEffect(()=>{if(window.location.pathname==="/login"){async function g(){const{data:m}=await v.auth.getSession();m?.session&&t("/dashboard")}g()}},[t]);async function h(g){g.preventDefault(),l(!0),d(null);const{data:m,error:f}=await v.auth.signInWithPassword({email:r,password:n});if(f){console.error("[Login] Auth error:",f),d(f.message),l(!1);return}const x=m.user?.id;if(!x){d("Login failed: No user ID."),l(!1);return}let{data:b,error:_}=await v.from("users").select("*").eq("id",x).single();if(_||!b){console.error("[Login] User fetch error:",_);const{error:I}=await v.from("users").upsert({id:x,email:m.user.email,name:m.user.user_metadata?.full_name||m.user.user_metadata?.name||"",role:"employee"});if(I){console.error("Upsert failed:",I),d("Upsert failed: "+I.message),l(!1);return}let A=3,S,k;for(;A>0;){await new Promise(U=>setTimeout(U,300));const{data:E,error:D}=await v.from("users").select("*").eq("id",x).single();if(S=E,k=D,k&&console.error("[Login] Retry user fetch error:",k),S&&!k){b=S,_=null;break}A--}if(_||!b){d("Access denied: User not found."),await v.auth.signOut(),l(!1);return}}if(b.role!=="employee"){d("Access denied: Only employees can access this app."),await v.auth.signOut(),l(!1);return}l(!1),s(),t("/dashboard")}async function p(){l(!0),d(null),l(!1)}return e.jsx(w,{sx:{minHeight:"100dvh",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.body"},children:e.jsxs(we,{sx:{minWidth:340,p:4},children:[e.jsx(y,{level:"h3",sx:{mb:2},children:"Sign in to Smartbuy"}),e.jsxs("form",{onSubmit:h,children:[e.jsx(M,{type:"email",placeholder:"Email",value:r,onChange:g=>i(g.target.value),sx:{mb:2},required:!0}),e.jsx(M,{type:"password",placeholder:"Password",value:n,onChange:g=>a(g.target.value),sx:{mb:2},required:!0}),e.jsx(q,{type:"submit",loading:o,fullWidth:!0,sx:{mb:1},children:"Sign In"})]}),e.jsx(q,{onClick:p,variant:"outlined",fullWidth:!0,sx:{mb:1},disabled:o,children:"Sign in with Google"}),c&&e.jsx(y,{color:"danger",sx:{mt:1},children:c})]})})}function ua(){return e.jsx(ws,{children:e.jsx(ae,{path:"*",element:e.jsx(da,{onLogin:()=>{}})})})}function rr({children:s,variant:t="page",padding:r="medium",fullHeight:i=!1,className:n}){Ke();const a=_r(),o=()=>r==="none"?0:{small:a.itemPadding,medium:a.containerPadding,large:a.sectionPadding}[r]||a.containerPadding,l=()=>{const c={p:o(),boxSizing:"border-box"};switch(t){case"page":return{...c,height:i?"100%":"auto",overflow:"auto",width:"100%"};case"dialog":return{...c,height:"auto",overflow:"visible"};case"form":return{...c,display:"flex",flexDirection:"column",gap:a.mediumGap};case"card":return{...c,borderRadius:1,bgcolor:"background.surface"};default:return c}};return e.jsx(w,{sx:l(),className:n,children:s})}function nr({open:s,onClose:t,children:r,title:i,size:n="medium",showCloseButton:a=!0,actions:o}){const{getModalSize:l}=ei();return e.jsx(ue,{open:s,onClose:t,children:e.jsxs(he,{sx:l(n),children:[a&&e.jsx(De,{}),i&&e.jsx(Nt,{children:i}),e.jsx(zt,{children:r}),o&&e.jsx(Mt,{children:o})]})})}const ie={fontSize:xe.sizes.small},ha=()=>{const{isMobile:s}=Ke();_r();const[t,r]=u.useState([]),[i,n]=u.useState([]),[a,o]=u.useState(""),[l,c]=u.useState(!1),[d,h]=u.useState(!1),[p,g]=u.useState(""),[m,f]=u.useState(""),[x,b]=u.useState(""),[_,I]=u.useState(""),[A,S]=u.useState(null),[k,E]=u.useState(!1),[D,U]=u.useState(""),[X,Z]=u.useState(""),[L,C]=u.useState(!1),[R,z]=u.useState(!1),[O,$]=u.useState(""),[N,Q]=u.useState("success"),W=(P,T="success")=>{$(P),Q(T),z(!0)},K=async()=>{try{const{data:P,error:T}=await v.from("stock_movements").select(`
                    *,
                    Products (
                        ProductName,
                        ProductID
                    )
                `).order("date",{ascending:!1});T?(console.error("Error fetching movements:",T),r([]),W("Failed to load movements","danger")):r(P||[])}catch(P){console.error("Unexpected error:",P),r([]),W("An unexpected error occurred","danger")}},ke=async()=>{try{const{data:P,error:T}=await v.from("Products").select("*").order("ProductName");T?(console.error("Error fetching products:",T),n([])):n(P||[])}catch(P){console.error("Unexpected error:",P),n([])}},Ve=async P=>{if(!P){S(null);return}E(!0);try{const{data:T,error:Y}=await v.from("stock_movements").select("movement_type, quantity").eq("product_id",P);if(Y)console.error("Error fetching stock movements:",Y),S(null);else{const be=(T||[]).reduce((H,ze)=>{switch(ze.movement_type){case"incoming":return H+ze.quantity;case"outgoing":return H-ze.quantity;case"adjustment":return H+ze.quantity;default:return H}},0);S(be)}}catch(T){console.error("Error calculating stock:",T),S(null)}finally{E(!1)}};u.useEffect(()=>{_?Ve(_):S(null)},[_]);const qe=async()=>{if(!_||D===""||A===null){W("Please select a product and enter a valid stock level","warning");return}const T=Number(D)-A;if(T===0){W("No adjustment needed - the stock level is already at the specified amount","warning");return}C(!0);try{const{error:Y}=await v.from("stock_movements").insert({product_id:_,movement_type:"adjustment",quantity:T,reason:`Manual adjustment: ${X||"Stock level correction"}`,date:new Date().toISOString()});Y?(console.error("Error creating adjustment:",Y),W("Failed to create adjustment: "+Y.message,"danger")):(I(""),U(""),Z(""),S(null),c(!1),K(),W("Stock adjustment created successfully!","success"))}catch(Y){console.error("Unexpected error:",Y),W("An unexpected error occurred","danger")}finally{C(!1)}};u.useEffect(()=>{K(),ke()},[]);const pe=t.filter(P=>{const T=a.toLowerCase(),Y=a===""||P.id.toLowerCase().includes(T)||P.product_id.toLowerCase().includes(T)||P.movement_type.toLowerCase().includes(T)||(P.reason?.toLowerCase().includes(T)??!1)||(P.Products?.ProductName?.toLowerCase().includes(T)??!1),be=p===""||P.movement_type===p,H=m===""||P.product_id===m,ze=x===""||(()=>{const re=P.reason?.toLowerCase()||"";switch(x){case"manual":return re.includes("manual")||re.includes("adjustment")||re.includes("correction");case"damage":return re.includes("damage")||re.includes("broken")||re.includes("defect");case"loss":return re.includes("loss")||re.includes("lost")||re.includes("missing");case"found":return re.includes("found")||re.includes("surplus")||re.includes("extra");case"po":return re.includes("po")||re.includes("purchase")||re.includes("receipt");default:return!0}})();return Y&&be&&H&&ze}),fe=P=>{switch(P.movement_type){case"incoming":return"success";case"outgoing":return"danger";case"adjustment":return P.quantity>=0?"success":"danger";default:return"neutral"}},Zt=P=>{switch(P.movement_type){case"incoming":return"";case"outgoing":return"";case"adjustment":return"";default:return""}},xt=P=>{switch(P.movement_type){case"incoming":return`+${P.quantity}`;case"outgoing":return`-${P.quantity}`;case"adjustment":return P.quantity>=0?`+${P.quantity}`:`${P.quantity}`;default:return P.quantity}},Qt=()=>{g(""),f(""),b("")},Je=p!==""||m!==""||x!=="",mt=()=>e.jsxs(w,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(rr,{padding:"medium",children:[e.jsx(y,{level:"h2",sx:{mb:2,fontSize:xe.sizes.xlarge},children:"Stock Movements"}),e.jsxs(w,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(M,{placeholder:"Search movements...",value:a,onChange:P=>o(P.target.value),startDecorator:e.jsx(ct,{}),sx:{flex:1}}),e.jsx(de,{variant:Je?"solid":"soft",color:Je?"primary":"neutral",size:"sm",onClick:()=>h(!0),children:e.jsx(Hn,{})})]}),Je&&e.jsxs(w,{sx:{mb:2,display:"flex",gap:1,flexWrap:"wrap"},children:[p&&e.jsxs(je,{size:"sm",variant:"soft",color:"primary",children:["Type: ",p]}),m&&e.jsxs(je,{size:"sm",variant:"soft",color:"primary",children:["Product: ",i.find(P=>P.uuid===m)?.ProductName||"Selected"]}),x&&e.jsxs(je,{size:"sm",variant:"soft",color:"primary",children:["Reason: ",x]})]})]}),e.jsx(w,{children:pe.length===0?e.jsx(w,{sx:{textAlign:"center",py:6},children:e.jsx(y,{color:"neutral",children:"No stock movements found"})}):pe.map(P=>e.jsx(w,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(w,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${fe(P)}.100`,color:`${fe(P)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",flexShrink:0},children:Zt(P)}),e.jsxs(w,{sx:{flex:1,minWidth:0},children:[e.jsxs(w,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(y,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:P.Products?.ProductName||"Unknown Product"}),e.jsx(je,{size:"sm",color:fe(P),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content"},children:xt(P)})]}),e.jsxs(y,{level:"body-xs",color:"neutral",sx:{mb:.5},children:["ID: ",P.Products?.ProductID||"N/A","  ",new Date(P.date).toLocaleDateString()]}),P.reason&&e.jsx(y,{level:"body-xs",color:"neutral",sx:{fontStyle:"italic",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:P.reason})]})]})},P.id))}),e.jsx(de,{color:"primary",variant:"soft",size:"sm",sx:{position:"fixed",bottom:80,right:16,zIndex:1e3,borderRadius:"8px",width:40,height:40,boxShadow:"sm",bgcolor:"primary.100","&:hover":{bgcolor:"primary.200",boxShadow:"md"}},onClick:()=>c(!0),children:e.jsx(lt,{fontSize:"small"})})]}),Kt=()=>e.jsxs(rr,{variant:"page",padding:"large",children:[e.jsx(y,{level:"h2",sx:{mb:2,fontSize:xe.sizes.xlarge},children:"Stock Movements"}),e.jsxs(w,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(M,{placeholder:"Search movements...",sx:{flex:1,fontSize:xe.sizes.small},value:a,onChange:P=>o(P.target.value),startDecorator:e.jsx(ct,{})}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(lt,{}),onClick:()=>c(!0),sx:{fontSize:xe.sizes.small},children:"Adjust"})]}),e.jsx(we,{children:e.jsxs(Le,{"aria-label":"Stock Movements",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:ie,children:"ID"}),e.jsx("th",{style:ie,children:"Product"}),e.jsx("th",{style:ie,children:"Movement Type"}),e.jsx("th",{style:ie,children:"Quantity"}),e.jsx("th",{style:ie,children:"Reason"}),e.jsx("th",{style:ie,children:"Date"})]})}),e.jsxs("tbody",{children:[pe.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{textAlign:"center",color:"#888",...ie},children:"No stock movements found."})}),pe.map(P=>e.jsxs("tr",{style:{cursor:"pointer"},children:[e.jsxs("td",{style:ie,children:[P.id.substring(0,8),"..."]}),e.jsx("td",{style:ie,children:P.Products?e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:P.Products.ProductName}),e.jsxs("div",{style:{fontSize:"0.8em",color:"#666"},children:["ID: ",P.Products.ProductID]})]}):e.jsx("span",{style:{color:"#999",fontStyle:"italic"},children:"Unknown Product"})}),e.jsx("td",{style:ie,children:e.jsx(je,{size:"sm",variant:"soft",color:fe(P),children:P.movement_type==="incoming"?" Incoming":P.movement_type==="outgoing"?" Outgoing":" Adjustment"})}),e.jsx("td",{style:ie,children:e.jsx("span",{style:{fontWeight:"bold",color:fe(P)==="success"?"#059669":fe(P)==="danger"?"#dc2626":"#666"},children:xt(P)})}),e.jsx("td",{style:ie,children:P.reason||"N/A"}),e.jsx("td",{style:ie,children:new Date(P.date).toLocaleString()})]},P.id))]})]})})]});return e.jsxs(Ne,{children:[s?e.jsx(mt,{}):e.jsx(Kt,{}),e.jsx(nr,{open:l,onClose:()=>c(!1),title:"Manual Stock Adjustment",size:"medium",actions:e.jsxs(w,{sx:{display:"flex",gap:2},children:[e.jsx(q,{variant:"plain",onClick:()=>c(!1),sx:ie,children:"Cancel"}),e.jsx(q,{variant:"solid",onClick:qe,loading:L,disabled:!_||D===""||A===null||Number(D)===A,sx:ie,children:"Create Adjustment"})]}),children:e.jsxs(Ce,{spacing:2,children:[e.jsxs(te,{children:[e.jsx(se,{children:"Product"}),e.jsx(ye,{placeholder:"Select a product...",value:_,onChange:(P,T)=>I(T||""),children:i.map(P=>e.jsxs(B,{value:P.uuid,children:[P.ProductName," (ID: ",P.ProductID,")"]},P.uuid))})]}),_&&e.jsxs(te,{children:[e.jsx(se,{children:"Current Stock Level"}),e.jsx(M,{value:k?"Loading...":A!==null?A:"N/A",readOnly:!0,sx:{bgcolor:"neutral.100",color:A!==null&&A<=0?"danger.500":"neutral.600"}}),A!==null&&A<=0&&e.jsx(y,{level:"body-sm",sx:{color:"danger.500",mt:.5},children:" Warning: Product is at or below zero stock level"})]}),A!==null&&e.jsxs(te,{children:[e.jsx(se,{children:"Actual Stock Level"}),e.jsx(M,{type:"number",placeholder:"Enter the actual stock level...",value:D,onChange:P=>U(P.target.value),sx:{...ie},slotProps:{input:{min:0,max:999999}}}),D!==""&&A!==null&&e.jsx(y,{level:"body-sm",sx:{mt:.5,color:Number(D)>A?"success.600":Number(D)<A?"danger.600":"neutral.600"},children:Number(D)>A?`+${Number(D)-A} (increase)`:Number(D)<A?`${Number(D)-A} (decrease)`:"No change needed"})]}),e.jsxs(te,{children:[e.jsx(se,{children:"Reason for Adjustment"}),e.jsx(M,{placeholder:"e.g., damage, loss, found inventory, physical count correction...",value:X,onChange:P=>Z(P.target.value),sx:{...ie}})]})]})}),s&&e.jsx(nr,{open:d,onClose:()=>h(!1),title:"Filter Movements",size:"medium",actions:e.jsxs(w,{sx:{display:"flex",gap:1,justifyContent:"space-between",width:"100%"},children:[e.jsx(q,{variant:"plain",color:"neutral",onClick:Qt,disabled:!Je,children:"Clear All"}),e.jsx(q,{onClick:()=>h(!1),children:"Apply Filters"})]}),children:e.jsxs(Ce,{spacing:2,children:[e.jsxs(te,{children:[e.jsx(se,{children:"Movement Type"}),e.jsxs(ye,{placeholder:"All types",value:p,onChange:(P,T)=>g(T||""),children:[e.jsx(B,{value:"",children:"All Types"}),e.jsx(B,{value:"incoming",children:"Incoming"}),e.jsx(B,{value:"outgoing",children:"Outgoing"}),e.jsx(B,{value:"adjustment",children:"Adjustment"})]})]}),e.jsxs(te,{children:[e.jsx(se,{children:"Product"}),e.jsxs(ye,{placeholder:"All products",value:m,onChange:(P,T)=>f(T||""),children:[e.jsx(B,{value:"",children:"All Products"}),i.map(P=>e.jsx(B,{value:P.uuid,children:P.ProductName},P.uuid))]})]}),e.jsxs(te,{children:[e.jsx(se,{children:"Reason Category"}),e.jsxs(ye,{placeholder:"All reasons",value:x,onChange:(P,T)=>b(T||""),children:[e.jsx(B,{value:"",children:"All Reasons"}),e.jsx(B,{value:"manual",children:"Manual Adjustment"}),e.jsx(B,{value:"damage",children:"Damage/Defect"}),e.jsx(B,{value:"loss",children:"Loss/Missing"}),e.jsx(B,{value:"found",children:"Found/Surplus"}),e.jsx(B,{value:"po",children:"Purchase Order"})]})]})]})}),e.jsx(xr,{open:R,onClose:()=>z(!1),autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{top:16,zIndex:2e3},children:e.jsx(Ln,{color:N,variant:"solid",sx:{width:"100%"},children:O})})]})},pa=({open:s,onClose:t,product:r,onSave:i})=>{const[n,a]=u.useState(r?.min_stock??0),[o,l]=u.useState(r?.max_stock??0),[c,d]=u.useState(r?.reorder_amount??0);u.useEffect(()=>{a(r?.min_stock??0),l(r?.max_stock??0),d(r?.reorder_amount??0)},[r]);const h=()=>{i({min_stock:n,max_stock:o,reorder_amount:c})};return r?e.jsx(ue,{open:s,onClose:t,children:e.jsxs(he,{sx:{minWidth:320,width:{xs:"90vw",sm:400}},children:[e.jsx(De,{}),e.jsx(y,{level:"h4",sx:{mb:2},children:"Edit Inventory Settings"}),e.jsxs(Ce,{spacing:2,children:[e.jsxs(te,{children:[e.jsx(se,{children:"Product ID"}),e.jsx(M,{value:r.ProductID??"",disabled:!0})]}),e.jsxs(te,{children:[e.jsx(se,{children:"Product Name"}),e.jsx(M,{value:r.ProductName??"",disabled:!0})]}),e.jsxs(te,{children:[e.jsx(se,{children:"Current Stock"}),e.jsx(M,{value:"N/A",disabled:!0})]}),e.jsxs(te,{children:[e.jsx(se,{children:"Minimum Stock"}),e.jsx(M,{type:"number",value:n,onChange:p=>a(Number(p.target.value))})]}),e.jsxs(te,{children:[e.jsx(se,{children:"Maximum Stock"}),e.jsx(M,{type:"number",value:o,onChange:p=>l(Number(p.target.value))})]}),e.jsxs(te,{children:[e.jsx(se,{children:"Reorder Amount"}),e.jsx(M,{type:"number",value:c,onChange:p=>d(Number(p.target.value))})]})]}),e.jsxs(w,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:3},children:[e.jsx(q,{variant:"plain",onClick:t,children:"Cancel"}),e.jsx(q,{variant:"solid",onClick:h,children:"Save"})]})]})}):null},oe={fontSize:xe.sizes.small},fa=()=>{const[s,t]=u.useState([]),[r,i]=u.useState(""),[n,a]=u.useState(!1),[o,l]=u.useState(null);u.useEffect(()=>{async function p(){const{data:g,error:m}=await v.from("Products").select("*");m?console.error("Error fetching products:",m):t(g||[])}p()},[]);const c=s.filter(p=>{const g=r.toLowerCase();return(p.ProductName?.toLowerCase().includes(g)??!1)||p.ProductID!==null&&p.ProductID!==void 0&&p.ProductID.toString().toLowerCase().includes(g)||(p.uuid?.toLowerCase().includes(g)??!1)}),d=p=>{l(p),a(!0)},h=async p=>{if(!o)return;const{error:g}=await v.from("Products").update(p).eq("uuid",o.uuid);g?alert("Failed to update product: "+g.message):(t(m=>m.map(f=>f.uuid===o.uuid?{...f,...p}:f)),a(!1))};return e.jsx(Ne,{children:e.jsxs(w,{sx:{width:"100%",minHeight:"100dvh",bgcolor:"background.body",borderRadius:0,boxShadow:"none",pl:0,pr:0,pt:3,pb:0},children:[e.jsx(y,{level:"h2",sx:{mb:2,textAlign:"left",fontSize:xe.sizes.xlarge},children:"Inventory"}),e.jsx(w,{sx:{display:"flex",gap:2,mb:2},children:e.jsx(M,{placeholder:"Search products...",sx:{flex:1,...oe},value:r,onChange:p=>i(p.target.value),startDecorator:e.jsx(ct,{})})}),e.jsx(we,{children:e.jsxs(Le,{"aria-label":"Inventory Levels",sx:{minWidth:800},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:oe,children:"Product Name"}),e.jsx("th",{style:oe,children:"SKU"}),e.jsx("th",{style:oe,children:"Current Stock"}),e.jsx("th",{style:oe,children:"Min Stock"}),e.jsx("th",{style:oe,children:"Max Stock"}),e.jsx("th",{style:oe,children:"Reorder Amount"}),e.jsx("th",{style:oe,children:"Status"})]})}),e.jsxs("tbody",{children:[c.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...oe},children:"No products found."})}),c.map(p=>{const g=typeof p.min_stock=="number"&&p.min_stock>0;return e.jsxs("tr",{style:{cursor:"pointer"},onClick:()=>d(p),children:[e.jsx("td",{style:oe,children:p.ProductName}),e.jsx("td",{style:oe,children:p.ProductID}),e.jsx("td",{style:oe,children:"N/A"}),e.jsx("td",{style:oe,children:p.min_stock??"N/A"}),e.jsx("td",{style:oe,children:p.max_stock??"N/A"}),e.jsx("td",{style:oe,children:p.reorder_amount??"N/A"}),e.jsx("td",{children:g?e.jsx(je,{color:"danger",variant:"soft",size:"sm",sx:oe,children:"Low Stock"}):e.jsx(je,{color:"success",variant:"soft",size:"sm",sx:oe,children:"OK"})})]},p.uuid)})]})]})}),e.jsx(pa,{open:n,onClose:()=>a(!1),product:o,onSave:h})]})})};function _s(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var He=_s();function sn(s){He=s}var ot={exec:()=>null};function G(s,t=""){let r=typeof s=="string"?s:s.source,i={replace:(n,a)=>{let o=typeof a=="string"?a:a.source;return o=o.replace(ce.caret,"$1"),r=r.replace(n,o),i},getRegex:()=>new RegExp(r,t)};return i}var ce={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:s=>new RegExp(`^( {0,3}${s})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}#`),htmlBeginRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}<(?:[a-z].*>|!--)`,"i")},xa=/^(?:[ \t]*(?:\n|$))+/,ma=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,ga=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,ft=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,ba=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Rs=/(?:[*+-]|\d{1,9}[.)])/,rn=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,nn=G(rn).replace(/bull/g,Rs).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),ja=G(rn).replace(/bull/g,Rs).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Es=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,ya=/^[^\n]+/,Os=/(?!\s*\])(?:\\.|[^\[\]\\])+/,Sa=G(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Os).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),wa=G(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Rs).getRegex(),Jt="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",As=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,ka=G("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",As).replace("tag",Jt).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),on=G(Es).replace("hr",ft).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Jt).getRegex(),va=G(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",on).getRegex(),Is={blockquote:va,code:ma,def:Sa,fences:ga,heading:ba,hr:ft,html:ka,lheading:nn,list:wa,newline:xa,paragraph:on,table:ot,text:ya},ir=G("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",ft).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Jt).getRegex(),Ca={...Is,lheading:ja,table:ir,paragraph:G(Es).replace("hr",ft).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",ir).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Jt).getRegex()},Pa={...Is,html:G(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",As).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:ot,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:G(Es).replace("hr",ft).replace("heading",` *#{1,6} *[^
]`).replace("lheading",nn).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},_a=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Ra=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,an=/^( {2,}|\\)\n(?!\s*$)/,Ea=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Gt=/[\p{P}\p{S}]/u,Ts=/[\s\p{P}\p{S}]/u,ln=/[^\s\p{P}\p{S}]/u,Oa=G(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Ts).getRegex(),cn=/(?!~)[\p{P}\p{S}]/u,Aa=/(?!~)[\s\p{P}\p{S}]/u,Ia=/(?:[^\s\p{P}\p{S}]|~)/u,Ta=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,dn=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Da=G(dn,"u").replace(/punct/g,Gt).getRegex(),La=G(dn,"u").replace(/punct/g,cn).getRegex(),un="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Na=G(un,"gu").replace(/notPunctSpace/g,ln).replace(/punctSpace/g,Ts).replace(/punct/g,Gt).getRegex(),za=G(un,"gu").replace(/notPunctSpace/g,Ia).replace(/punctSpace/g,Aa).replace(/punct/g,cn).getRegex(),Ma=G("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,ln).replace(/punctSpace/g,Ts).replace(/punct/g,Gt).getRegex(),qa=G(/\\(punct)/,"gu").replace(/punct/g,Gt).getRegex(),$a=G(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Fa=G(As).replace("(?:-->|$)","-->").getRegex(),Ua=G("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Fa).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Tt=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,Ba=G(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Tt).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),hn=G(/^!?\[(label)\]\[(ref)\]/).replace("label",Tt).replace("ref",Os).getRegex(),pn=G(/^!?\[(ref)\](?:\[\])?/).replace("ref",Os).getRegex(),Wa=G("reflink|nolink(?!\\()","g").replace("reflink",hn).replace("nolink",pn).getRegex(),Ds={_backpedal:ot,anyPunctuation:qa,autolink:$a,blockSkip:Ta,br:an,code:Ra,del:ot,emStrongLDelim:Da,emStrongRDelimAst:Na,emStrongRDelimUnd:Ma,escape:_a,link:Ba,nolink:pn,punctuation:Oa,reflink:hn,reflinkSearch:Wa,tag:Ua,text:Ea,url:ot},Ha={...Ds,link:G(/^!?\[(label)\]\((.*?)\)/).replace("label",Tt).getRegex(),reflink:G(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Tt).getRegex()},hs={...Ds,emStrongRDelimAst:za,emStrongLDelim:La,url:G(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},Va={...hs,br:G(an).replace("{2,}","*").getRegex(),text:G(hs.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},St={normal:Is,gfm:Ca,pedantic:Pa},st={normal:Ds,gfm:hs,breaks:Va,pedantic:Ha},Ja={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},or=s=>Ja[s];function Re(s,t){if(t){if(ce.escapeTest.test(s))return s.replace(ce.escapeReplace,or)}else if(ce.escapeTestNoEncode.test(s))return s.replace(ce.escapeReplaceNoEncode,or);return s}function ar(s){try{s=encodeURI(s).replace(ce.percentDecode,"%")}catch{return null}return s}function lr(s,t){let r=s.replace(ce.findPipe,(a,o,l)=>{let c=!1,d=o;for(;--d>=0&&l[d]==="\\";)c=!c;return c?"|":" |"}),i=r.split(ce.splitPipe),n=0;if(i[0].trim()||i.shift(),i.length>0&&!i.at(-1)?.trim()&&i.pop(),t)if(i.length>t)i.splice(t);else for(;i.length<t;)i.push("");for(;n<i.length;n++)i[n]=i[n].trim().replace(ce.slashPipe,"|");return i}function rt(s,t,r){let i=s.length;if(i===0)return"";let n=0;for(;n<i&&s.charAt(i-n-1)===t;)n++;return s.slice(0,i-n)}function Ga(s,t){if(s.indexOf(t[1])===-1)return-1;let r=0;for(let i=0;i<s.length;i++)if(s[i]==="\\")i++;else if(s[i]===t[0])r++;else if(s[i]===t[1]&&(r--,r<0))return i;return r>0?-2:-1}function cr(s,t,r,i,n){let a=t.href,o=t.title||null,l=s[1].replace(n.other.outputLinkReplace,"$1");i.state.inLink=!0;let c={type:s[0].charAt(0)==="!"?"image":"link",raw:r,href:a,title:o,text:l,tokens:i.inlineTokens(l)};return i.state.inLink=!1,c}function Za(s,t,r){let i=s.match(r.other.indentCodeCompensation);if(i===null)return t;let n=i[1];return t.split(`
`).map(a=>{let o=a.match(r.other.beginningSpace);if(o===null)return a;let[l]=o;return l.length>=n.length?a.slice(n.length):a}).join(`
`)}var Dt=class{options;rules;lexer;constructor(s){this.options=s||He}space(s){let t=this.rules.block.newline.exec(s);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(s){let t=this.rules.block.code.exec(s);if(t){let r=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?r:rt(r,`
`)}}}fences(s){let t=this.rules.block.fences.exec(s);if(t){let r=t[0],i=Za(r,t[3]||"",this.rules);return{type:"code",raw:r,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:i}}}heading(s){let t=this.rules.block.heading.exec(s);if(t){let r=t[2].trim();if(this.rules.other.endingHash.test(r)){let i=rt(r,"#");(this.options.pedantic||!i||this.rules.other.endingSpaceChar.test(i))&&(r=i.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:r,tokens:this.lexer.inline(r)}}}hr(s){let t=this.rules.block.hr.exec(s);if(t)return{type:"hr",raw:rt(t[0],`
`)}}blockquote(s){let t=this.rules.block.blockquote.exec(s);if(t){let r=rt(t[0],`
`).split(`
`),i="",n="",a=[];for(;r.length>0;){let o=!1,l=[],c;for(c=0;c<r.length;c++)if(this.rules.other.blockquoteStart.test(r[c]))l.push(r[c]),o=!0;else if(!o)l.push(r[c]);else break;r=r.slice(c);let d=l.join(`
`),h=d.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");i=i?`${i}
${d}`:d,n=n?`${n}
${h}`:h;let p=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(h,a,!0),this.lexer.state.top=p,r.length===0)break;let g=a.at(-1);if(g?.type==="code")break;if(g?.type==="blockquote"){let m=g,f=m.raw+`
`+r.join(`
`),x=this.blockquote(f);a[a.length-1]=x,i=i.substring(0,i.length-m.raw.length)+x.raw,n=n.substring(0,n.length-m.text.length)+x.text;break}else if(g?.type==="list"){let m=g,f=m.raw+`
`+r.join(`
`),x=this.list(f);a[a.length-1]=x,i=i.substring(0,i.length-g.raw.length)+x.raw,n=n.substring(0,n.length-m.raw.length)+x.raw,r=f.substring(a.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:i,tokens:a,text:n}}}list(s){let t=this.rules.block.list.exec(s);if(t){let r=t[1].trim(),i=r.length>1,n={type:"list",raw:"",ordered:i,start:i?+r.slice(0,-1):"",loose:!1,items:[]};r=i?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=i?r:"[*+-]");let a=this.rules.other.listItemRegex(r),o=!1;for(;s;){let c=!1,d="",h="";if(!(t=a.exec(s))||this.rules.block.hr.test(s))break;d=t[0],s=s.substring(d.length);let p=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,_=>" ".repeat(3*_.length)),g=s.split(`
`,1)[0],m=!p.trim(),f=0;if(this.options.pedantic?(f=2,h=p.trimStart()):m?f=t[1].length+1:(f=t[2].search(this.rules.other.nonSpaceChar),f=f>4?1:f,h=p.slice(f),f+=t[1].length),m&&this.rules.other.blankLine.test(g)&&(d+=g+`
`,s=s.substring(g.length+1),c=!0),!c){let _=this.rules.other.nextBulletRegex(f),I=this.rules.other.hrRegex(f),A=this.rules.other.fencesBeginRegex(f),S=this.rules.other.headingBeginRegex(f),k=this.rules.other.htmlBeginRegex(f);for(;s;){let E=s.split(`
`,1)[0],D;if(g=E,this.options.pedantic?(g=g.replace(this.rules.other.listReplaceNesting,"  "),D=g):D=g.replace(this.rules.other.tabCharGlobal,"    "),A.test(g)||S.test(g)||k.test(g)||_.test(g)||I.test(g))break;if(D.search(this.rules.other.nonSpaceChar)>=f||!g.trim())h+=`
`+D.slice(f);else{if(m||p.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||A.test(p)||S.test(p)||I.test(p))break;h+=`
`+g}!m&&!g.trim()&&(m=!0),d+=E+`
`,s=s.substring(E.length+1),p=D.slice(f)}}n.loose||(o?n.loose=!0:this.rules.other.doubleBlankLine.test(d)&&(o=!0));let x=null,b;this.options.gfm&&(x=this.rules.other.listIsTask.exec(h),x&&(b=x[0]!=="[ ] ",h=h.replace(this.rules.other.listReplaceTask,""))),n.items.push({type:"list_item",raw:d,task:!!x,checked:b,loose:!1,text:h,tokens:[]}),n.raw+=d}let l=n.items.at(-1);if(l)l.raw=l.raw.trimEnd(),l.text=l.text.trimEnd();else return;n.raw=n.raw.trimEnd();for(let c=0;c<n.items.length;c++)if(this.lexer.state.top=!1,n.items[c].tokens=this.lexer.blockTokens(n.items[c].text,[]),!n.loose){let d=n.items[c].tokens.filter(p=>p.type==="space"),h=d.length>0&&d.some(p=>this.rules.other.anyLine.test(p.raw));n.loose=h}if(n.loose)for(let c=0;c<n.items.length;c++)n.items[c].loose=!0;return n}}html(s){let t=this.rules.block.html.exec(s);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(s){let t=this.rules.block.def.exec(s);if(t){let r=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),i=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",n=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:r,raw:t[0],href:i,title:n}}}table(s){let t=this.rules.block.table.exec(s);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let r=lr(t[1]),i=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),n=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],a={type:"table",raw:t[0],header:[],align:[],rows:[]};if(r.length===i.length){for(let o of i)this.rules.other.tableAlignRight.test(o)?a.align.push("right"):this.rules.other.tableAlignCenter.test(o)?a.align.push("center"):this.rules.other.tableAlignLeft.test(o)?a.align.push("left"):a.align.push(null);for(let o=0;o<r.length;o++)a.header.push({text:r[o],tokens:this.lexer.inline(r[o]),header:!0,align:a.align[o]});for(let o of n)a.rows.push(lr(o,a.header.length).map((l,c)=>({text:l,tokens:this.lexer.inline(l),header:!1,align:a.align[c]})));return a}}lheading(s){let t=this.rules.block.lheading.exec(s);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(s){let t=this.rules.block.paragraph.exec(s);if(t){let r=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:r,tokens:this.lexer.inline(r)}}}text(s){let t=this.rules.block.text.exec(s);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(s){let t=this.rules.inline.escape.exec(s);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(s){let t=this.rules.inline.tag.exec(s);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(s){let t=this.rules.inline.link.exec(s);if(t){let r=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(r)){if(!this.rules.other.endAngleBracket.test(r))return;let a=rt(r.slice(0,-1),"\\");if((r.length-a.length)%2===0)return}else{let a=Ga(t[2],"()");if(a===-2)return;if(a>-1){let o=(t[0].indexOf("!")===0?5:4)+t[1].length+a;t[2]=t[2].substring(0,a),t[0]=t[0].substring(0,o).trim(),t[3]=""}}let i=t[2],n="";if(this.options.pedantic){let a=this.rules.other.pedanticHrefTitle.exec(i);a&&(i=a[1],n=a[3])}else n=t[3]?t[3].slice(1,-1):"";return i=i.trim(),this.rules.other.startAngleBracket.test(i)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(r)?i=i.slice(1):i=i.slice(1,-1)),cr(t,{href:i&&i.replace(this.rules.inline.anyPunctuation,"$1"),title:n&&n.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(s,t){let r;if((r=this.rules.inline.reflink.exec(s))||(r=this.rules.inline.nolink.exec(s))){let i=(r[2]||r[1]).replace(this.rules.other.multipleSpaceGlobal," "),n=t[i.toLowerCase()];if(!n){let a=r[0].charAt(0);return{type:"text",raw:a,text:a}}return cr(r,n,r[0],this.lexer,this.rules)}}emStrong(s,t,r=""){let i=this.rules.inline.emStrongLDelim.exec(s);if(!(!i||i[3]&&r.match(this.rules.other.unicodeAlphaNumeric))&&(!(i[1]||i[2])||!r||this.rules.inline.punctuation.exec(r))){let n=[...i[0]].length-1,a,o,l=n,c=0,d=i[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(d.lastIndex=0,t=t.slice(-1*s.length+n);(i=d.exec(t))!=null;){if(a=i[1]||i[2]||i[3]||i[4]||i[5]||i[6],!a)continue;if(o=[...a].length,i[3]||i[4]){l+=o;continue}else if((i[5]||i[6])&&n%3&&!((n+o)%3)){c+=o;continue}if(l-=o,l>0)continue;o=Math.min(o,o+l+c);let h=[...i[0]][0].length,p=s.slice(0,n+i.index+h+o);if(Math.min(n,o)%2){let m=p.slice(1,-1);return{type:"em",raw:p,text:m,tokens:this.lexer.inlineTokens(m)}}let g=p.slice(2,-2);return{type:"strong",raw:p,text:g,tokens:this.lexer.inlineTokens(g)}}}}codespan(s){let t=this.rules.inline.code.exec(s);if(t){let r=t[2].replace(this.rules.other.newLineCharGlobal," "),i=this.rules.other.nonSpaceChar.test(r),n=this.rules.other.startingSpaceChar.test(r)&&this.rules.other.endingSpaceChar.test(r);return i&&n&&(r=r.substring(1,r.length-1)),{type:"codespan",raw:t[0],text:r}}}br(s){let t=this.rules.inline.br.exec(s);if(t)return{type:"br",raw:t[0]}}del(s){let t=this.rules.inline.del.exec(s);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(s){let t=this.rules.inline.autolink.exec(s);if(t){let r,i;return t[2]==="@"?(r=t[1],i="mailto:"+r):(r=t[1],i=r),{type:"link",raw:t[0],text:r,href:i,tokens:[{type:"text",raw:r,text:r}]}}}url(s){let t;if(t=this.rules.inline.url.exec(s)){let r,i;if(t[2]==="@")r=t[0],i="mailto:"+r;else{let n;do n=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??"";while(n!==t[0]);r=t[0],t[1]==="www."?i="http://"+t[0]:i=t[0]}return{type:"link",raw:t[0],text:r,href:i,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(s){let t=this.rules.inline.text.exec(s);if(t){let r=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:r}}}},Ie=class ps{tokens;options;state;tokenizer;inlineQueue;constructor(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||He,this.options.tokenizer=this.options.tokenizer||new Dt,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let r={other:ce,block:St.normal,inline:st.normal};this.options.pedantic?(r.block=St.pedantic,r.inline=st.pedantic):this.options.gfm&&(r.block=St.gfm,this.options.breaks?r.inline=st.breaks:r.inline=st.gfm),this.tokenizer.rules=r}static get rules(){return{block:St,inline:st}}static lex(t,r){return new ps(r).lex(t)}static lexInline(t,r){return new ps(r).inlineTokens(t)}lex(t){t=t.replace(ce.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let r=0;r<this.inlineQueue.length;r++){let i=this.inlineQueue[r];this.inlineTokens(i.src,i.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,r=[],i=!1){for(this.options.pedantic&&(t=t.replace(ce.tabCharGlobal,"    ").replace(ce.spaceLine,""));t;){let n;if(this.options.extensions?.block?.some(o=>(n=o.call({lexer:this},t,r))?(t=t.substring(n.raw.length),r.push(n),!0):!1))continue;if(n=this.tokenizer.space(t)){t=t.substring(n.raw.length);let o=r.at(-1);n.raw.length===1&&o!==void 0?o.raw+=`
`:r.push(n);continue}if(n=this.tokenizer.code(t)){t=t.substring(n.raw.length);let o=r.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=`
`+n.raw,o.text+=`
`+n.text,this.inlineQueue.at(-1).src=o.text):r.push(n);continue}if(n=this.tokenizer.fences(t)){t=t.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.heading(t)){t=t.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.hr(t)){t=t.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.blockquote(t)){t=t.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.list(t)){t=t.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.html(t)){t=t.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.def(t)){t=t.substring(n.raw.length);let o=r.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=`
`+n.raw,o.text+=`
`+n.raw,this.inlineQueue.at(-1).src=o.text):this.tokens.links[n.tag]||(this.tokens.links[n.tag]={href:n.href,title:n.title});continue}if(n=this.tokenizer.table(t)){t=t.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.lheading(t)){t=t.substring(n.raw.length),r.push(n);continue}let a=t;if(this.options.extensions?.startBlock){let o=1/0,l=t.slice(1),c;this.options.extensions.startBlock.forEach(d=>{c=d.call({lexer:this},l),typeof c=="number"&&c>=0&&(o=Math.min(o,c))}),o<1/0&&o>=0&&(a=t.substring(0,o+1))}if(this.state.top&&(n=this.tokenizer.paragraph(a))){let o=r.at(-1);i&&o?.type==="paragraph"?(o.raw+=`
`+n.raw,o.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):r.push(n),i=a.length!==t.length,t=t.substring(n.raw.length);continue}if(n=this.tokenizer.text(t)){t=t.substring(n.raw.length);let o=r.at(-1);o?.type==="text"?(o.raw+=`
`+n.raw,o.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):r.push(n);continue}if(t){let o="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(o);break}else throw new Error(o)}}return this.state.top=!0,r}inline(t,r=[]){return this.inlineQueue.push({src:t,tokens:r}),r}inlineTokens(t,r=[]){let i=t,n=null;if(this.tokens.links){let l=Object.keys(this.tokens.links);if(l.length>0)for(;(n=this.tokenizer.rules.inline.reflinkSearch.exec(i))!=null;)l.includes(n[0].slice(n[0].lastIndexOf("[")+1,-1))&&(i=i.slice(0,n.index)+"["+"a".repeat(n[0].length-2)+"]"+i.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(n=this.tokenizer.rules.inline.anyPunctuation.exec(i))!=null;)i=i.slice(0,n.index)+"++"+i.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(n=this.tokenizer.rules.inline.blockSkip.exec(i))!=null;)i=i.slice(0,n.index)+"["+"a".repeat(n[0].length-2)+"]"+i.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let a=!1,o="";for(;t;){a||(o=""),a=!1;let l;if(this.options.extensions?.inline?.some(d=>(l=d.call({lexer:this},t,r))?(t=t.substring(l.raw.length),r.push(l),!0):!1))continue;if(l=this.tokenizer.escape(t)){t=t.substring(l.raw.length),r.push(l);continue}if(l=this.tokenizer.tag(t)){t=t.substring(l.raw.length),r.push(l);continue}if(l=this.tokenizer.link(t)){t=t.substring(l.raw.length),r.push(l);continue}if(l=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(l.raw.length);let d=r.at(-1);l.type==="text"&&d?.type==="text"?(d.raw+=l.raw,d.text+=l.text):r.push(l);continue}if(l=this.tokenizer.emStrong(t,i,o)){t=t.substring(l.raw.length),r.push(l);continue}if(l=this.tokenizer.codespan(t)){t=t.substring(l.raw.length),r.push(l);continue}if(l=this.tokenizer.br(t)){t=t.substring(l.raw.length),r.push(l);continue}if(l=this.tokenizer.del(t)){t=t.substring(l.raw.length),r.push(l);continue}if(l=this.tokenizer.autolink(t)){t=t.substring(l.raw.length),r.push(l);continue}if(!this.state.inLink&&(l=this.tokenizer.url(t))){t=t.substring(l.raw.length),r.push(l);continue}let c=t;if(this.options.extensions?.startInline){let d=1/0,h=t.slice(1),p;this.options.extensions.startInline.forEach(g=>{p=g.call({lexer:this},h),typeof p=="number"&&p>=0&&(d=Math.min(d,p))}),d<1/0&&d>=0&&(c=t.substring(0,d+1))}if(l=this.tokenizer.inlineText(c)){t=t.substring(l.raw.length),l.raw.slice(-1)!=="_"&&(o=l.raw.slice(-1)),a=!0;let d=r.at(-1);d?.type==="text"?(d.raw+=l.raw,d.text+=l.text):r.push(l);continue}if(t){let d="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(d);break}else throw new Error(d)}}return r}},Lt=class{options;parser;constructor(s){this.options=s||He}space(s){return""}code({text:s,lang:t,escaped:r}){let i=(t||"").match(ce.notSpaceStart)?.[0],n=s.replace(ce.endingNewline,"")+`
`;return i?'<pre><code class="language-'+Re(i)+'">'+(r?n:Re(n,!0))+`</code></pre>
`:"<pre><code>"+(r?n:Re(n,!0))+`</code></pre>
`}blockquote({tokens:s}){return`<blockquote>
${this.parser.parse(s)}</blockquote>
`}html({text:s}){return s}heading({tokens:s,depth:t}){return`<h${t}>${this.parser.parseInline(s)}</h${t}>
`}hr(s){return`<hr>
`}list(s){let t=s.ordered,r=s.start,i="";for(let o=0;o<s.items.length;o++){let l=s.items[o];i+=this.listitem(l)}let n=t?"ol":"ul",a=t&&r!==1?' start="'+r+'"':"";return"<"+n+a+`>
`+i+"</"+n+`>
`}listitem(s){let t="";if(s.task){let r=this.checkbox({checked:!!s.checked});s.loose?s.tokens[0]?.type==="paragraph"?(s.tokens[0].text=r+" "+s.tokens[0].text,s.tokens[0].tokens&&s.tokens[0].tokens.length>0&&s.tokens[0].tokens[0].type==="text"&&(s.tokens[0].tokens[0].text=r+" "+Re(s.tokens[0].tokens[0].text),s.tokens[0].tokens[0].escaped=!0)):s.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):t+=r+" "}return t+=this.parser.parse(s.tokens,!!s.loose),`<li>${t}</li>
`}checkbox({checked:s}){return"<input "+(s?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:s}){return`<p>${this.parser.parseInline(s)}</p>
`}table(s){let t="",r="";for(let n=0;n<s.header.length;n++)r+=this.tablecell(s.header[n]);t+=this.tablerow({text:r});let i="";for(let n=0;n<s.rows.length;n++){let a=s.rows[n];r="";for(let o=0;o<a.length;o++)r+=this.tablecell(a[o]);i+=this.tablerow({text:r})}return i&&(i=`<tbody>${i}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+i+`</table>
`}tablerow({text:s}){return`<tr>
${s}</tr>
`}tablecell(s){let t=this.parser.parseInline(s.tokens),r=s.header?"th":"td";return(s.align?`<${r} align="${s.align}">`:`<${r}>`)+t+`</${r}>
`}strong({tokens:s}){return`<strong>${this.parser.parseInline(s)}</strong>`}em({tokens:s}){return`<em>${this.parser.parseInline(s)}</em>`}codespan({text:s}){return`<code>${Re(s,!0)}</code>`}br(s){return"<br>"}del({tokens:s}){return`<del>${this.parser.parseInline(s)}</del>`}link({href:s,title:t,tokens:r}){let i=this.parser.parseInline(r),n=ar(s);if(n===null)return i;s=n;let a='<a href="'+s+'"';return t&&(a+=' title="'+Re(t)+'"'),a+=">"+i+"</a>",a}image({href:s,title:t,text:r,tokens:i}){i&&(r=this.parser.parseInline(i,this.parser.textRenderer));let n=ar(s);if(n===null)return Re(r);s=n;let a=`<img src="${s}" alt="${r}"`;return t&&(a+=` title="${Re(t)}"`),a+=">",a}text(s){return"tokens"in s&&s.tokens?this.parser.parseInline(s.tokens):"escaped"in s&&s.escaped?s.text:Re(s.text)}},Ls=class{strong({text:s}){return s}em({text:s}){return s}codespan({text:s}){return s}del({text:s}){return s}html({text:s}){return s}text({text:s}){return s}link({text:s}){return""+s}image({text:s}){return""+s}br(){return""}},Te=class fs{options;renderer;textRenderer;constructor(t){this.options=t||He,this.options.renderer=this.options.renderer||new Lt,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Ls}static parse(t,r){return new fs(r).parse(t)}static parseInline(t,r){return new fs(r).parseInline(t)}parse(t,r=!0){let i="";for(let n=0;n<t.length;n++){let a=t[n];if(this.options.extensions?.renderers?.[a.type]){let l=a,c=this.options.extensions.renderers[l.type].call({parser:this},l);if(c!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(l.type)){i+=c||"";continue}}let o=a;switch(o.type){case"space":{i+=this.renderer.space(o);continue}case"hr":{i+=this.renderer.hr(o);continue}case"heading":{i+=this.renderer.heading(o);continue}case"code":{i+=this.renderer.code(o);continue}case"table":{i+=this.renderer.table(o);continue}case"blockquote":{i+=this.renderer.blockquote(o);continue}case"list":{i+=this.renderer.list(o);continue}case"html":{i+=this.renderer.html(o);continue}case"paragraph":{i+=this.renderer.paragraph(o);continue}case"text":{let l=o,c=this.renderer.text(l);for(;n+1<t.length&&t[n+1].type==="text";)l=t[++n],c+=`
`+this.renderer.text(l);r?i+=this.renderer.paragraph({type:"paragraph",raw:c,text:c,tokens:[{type:"text",raw:c,text:c,escaped:!0}]}):i+=c;continue}default:{let l='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(l),"";throw new Error(l)}}}return i}parseInline(t,r=this.renderer){let i="";for(let n=0;n<t.length;n++){let a=t[n];if(this.options.extensions?.renderers?.[a.type]){let l=this.options.extensions.renderers[a.type].call({parser:this},a);if(l!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(a.type)){i+=l||"";continue}}let o=a;switch(o.type){case"escape":{i+=r.text(o);break}case"html":{i+=r.html(o);break}case"link":{i+=r.link(o);break}case"image":{i+=r.image(o);break}case"strong":{i+=r.strong(o);break}case"em":{i+=r.em(o);break}case"codespan":{i+=r.codespan(o);break}case"br":{i+=r.br(o);break}case"del":{i+=r.del(o);break}case"text":{i+=r.text(o);break}default:{let l='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(l),"";throw new Error(l)}}}return i}},Pt=class{options;block;constructor(s){this.options=s||He}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(s){return s}postprocess(s){return s}processAllTokens(s){return s}provideLexer(){return this.block?Ie.lex:Ie.lexInline}provideParser(){return this.block?Te.parse:Te.parseInline}},Qa=class{defaults=_s();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=Te;Renderer=Lt;TextRenderer=Ls;Lexer=Ie;Tokenizer=Dt;Hooks=Pt;constructor(...s){this.use(...s)}walkTokens(s,t){let r=[];for(let i of s)switch(r=r.concat(t.call(this,i)),i.type){case"table":{let n=i;for(let a of n.header)r=r.concat(this.walkTokens(a.tokens,t));for(let a of n.rows)for(let o of a)r=r.concat(this.walkTokens(o.tokens,t));break}case"list":{let n=i;r=r.concat(this.walkTokens(n.items,t));break}default:{let n=i;this.defaults.extensions?.childTokens?.[n.type]?this.defaults.extensions.childTokens[n.type].forEach(a=>{let o=n[a].flat(1/0);r=r.concat(this.walkTokens(o,t))}):n.tokens&&(r=r.concat(this.walkTokens(n.tokens,t)))}}return r}use(...s){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return s.forEach(r=>{let i={...r};if(i.async=this.defaults.async||i.async||!1,r.extensions&&(r.extensions.forEach(n=>{if(!n.name)throw new Error("extension name required");if("renderer"in n){let a=t.renderers[n.name];a?t.renderers[n.name]=function(...o){let l=n.renderer.apply(this,o);return l===!1&&(l=a.apply(this,o)),l}:t.renderers[n.name]=n.renderer}if("tokenizer"in n){if(!n.level||n.level!=="block"&&n.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let a=t[n.level];a?a.unshift(n.tokenizer):t[n.level]=[n.tokenizer],n.start&&(n.level==="block"?t.startBlock?t.startBlock.push(n.start):t.startBlock=[n.start]:n.level==="inline"&&(t.startInline?t.startInline.push(n.start):t.startInline=[n.start]))}"childTokens"in n&&n.childTokens&&(t.childTokens[n.name]=n.childTokens)}),i.extensions=t),r.renderer){let n=this.defaults.renderer||new Lt(this.defaults);for(let a in r.renderer){if(!(a in n))throw new Error(`renderer '${a}' does not exist`);if(["options","parser"].includes(a))continue;let o=a,l=r.renderer[o],c=n[o];n[o]=(...d)=>{let h=l.apply(n,d);return h===!1&&(h=c.apply(n,d)),h||""}}i.renderer=n}if(r.tokenizer){let n=this.defaults.tokenizer||new Dt(this.defaults);for(let a in r.tokenizer){if(!(a in n))throw new Error(`tokenizer '${a}' does not exist`);if(["options","rules","lexer"].includes(a))continue;let o=a,l=r.tokenizer[o],c=n[o];n[o]=(...d)=>{let h=l.apply(n,d);return h===!1&&(h=c.apply(n,d)),h}}i.tokenizer=n}if(r.hooks){let n=this.defaults.hooks||new Pt;for(let a in r.hooks){if(!(a in n))throw new Error(`hook '${a}' does not exist`);if(["options","block"].includes(a))continue;let o=a,l=r.hooks[o],c=n[o];Pt.passThroughHooks.has(a)?n[o]=d=>{if(this.defaults.async)return Promise.resolve(l.call(n,d)).then(p=>c.call(n,p));let h=l.call(n,d);return c.call(n,h)}:n[o]=(...d)=>{let h=l.apply(n,d);return h===!1&&(h=c.apply(n,d)),h}}i.hooks=n}if(r.walkTokens){let n=this.defaults.walkTokens,a=r.walkTokens;i.walkTokens=function(o){let l=[];return l.push(a.call(this,o)),n&&(l=l.concat(n.call(this,o))),l}}this.defaults={...this.defaults,...i}}),this}setOptions(s){return this.defaults={...this.defaults,...s},this}lexer(s,t){return Ie.lex(s,t??this.defaults)}parser(s,t){return Te.parse(s,t??this.defaults)}parseMarkdown(s){return(t,r)=>{let i={...r},n={...this.defaults,...i},a=this.onError(!!n.silent,!!n.async);if(this.defaults.async===!0&&i.async===!1)return a(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||t===null)return a(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return a(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));n.hooks&&(n.hooks.options=n,n.hooks.block=s);let o=n.hooks?n.hooks.provideLexer():s?Ie.lex:Ie.lexInline,l=n.hooks?n.hooks.provideParser():s?Te.parse:Te.parseInline;if(n.async)return Promise.resolve(n.hooks?n.hooks.preprocess(t):t).then(c=>o(c,n)).then(c=>n.hooks?n.hooks.processAllTokens(c):c).then(c=>n.walkTokens?Promise.all(this.walkTokens(c,n.walkTokens)).then(()=>c):c).then(c=>l(c,n)).then(c=>n.hooks?n.hooks.postprocess(c):c).catch(a);try{n.hooks&&(t=n.hooks.preprocess(t));let c=o(t,n);n.hooks&&(c=n.hooks.processAllTokens(c)),n.walkTokens&&this.walkTokens(c,n.walkTokens);let d=l(c,n);return n.hooks&&(d=n.hooks.postprocess(d)),d}catch(c){return a(c)}}}onError(s,t){return r=>{if(r.message+=`
Please report this to https://github.com/markedjs/marked.`,s){let i="<p>An error occurred:</p><pre>"+Re(r.message+"",!0)+"</pre>";return t?Promise.resolve(i):i}if(t)return Promise.reject(r);throw r}}},We=new Qa;function J(s,t){return We.parse(s,t)}J.options=J.setOptions=function(s){return We.setOptions(s),J.defaults=We.defaults,sn(J.defaults),J};J.getDefaults=_s;J.defaults=He;J.use=function(...s){return We.use(...s),J.defaults=We.defaults,sn(J.defaults),J};J.walkTokens=function(s,t){return We.walkTokens(s,t)};J.parseInline=We.parseInline;J.Parser=Te;J.parser=Te.parse;J.Renderer=Lt;J.TextRenderer=Ls;J.Lexer=Ie;J.lexer=Ie.lex;J.Tokenizer=Dt;J.Hooks=Pt;J.parse=J;J.options;J.setOptions;J.use;J.walkTokens;J.parseInline;Te.parse;Ie.lex;function Ka(){const[s,t]=V.useState("");return V.useEffect(()=>{fetch("/RELEASE_LOG.md").then(r=>r.text()).then(t)},[]),e.jsxs(w,{sx:{p:2,minHeight:300,overflow:"auto",bgcolor:"background.level1",borderRadius:"var(--joy-radius-lg)",border:"1px solid",borderColor:"divider"},children:[e.jsx(y,{level:"h4",sx:{mb:1},children:"Release Log"}),e.jsx(w,{sx:{typography:"body-md"},children:e.jsx("div",{dangerouslySetInnerHTML:{__html:J(s)}})})]})}function Xa(){return e.jsxs(w,{sx:{p:2,minHeight:300,bgcolor:"background.level1",borderRadius:"var(--joy-radius-lg)",border:"1px solid",borderColor:"divider"},children:[e.jsx(y,{level:"h4",sx:{mb:1},children:"Application Info"}),e.jsx(y,{level:"body-md",children:"Smartback Inventory System"}),e.jsxs(y,{level:"body-sm",sx:{mt:1},children:["Environment: ","production"]}),e.jsxs(y,{level:"body-sm",children:["Version: ","N/A"]}),e.jsxs(y,{level:"body-sm",children:["Build: ","N/A"]}),e.jsxs(y,{level:"body-sm",children:["Date: ",new Date().toLocaleDateString()]}),e.jsx(q,{component:"a",href:"https://nicklasfangerfisk.github.io/Testflow/",target:"_blank",rel:"noopener noreferrer",startDecorator:e.jsx(Cr,{}),sx:{mt:2},variant:"outlined",color:"primary",children:"System test"})]})}function Ya(){const s=hr();return Ee(s.breakpoints.down("md")),e.jsx(Ne,{children:e.jsxs(w,{sx:{width:"100%",minHeight:"100dvh",bgcolor:"background.body",borderRadius:0,boxShadow:"none",pl:0,pr:0,pt:3,pb:0},children:[e.jsx(y,{level:"h2",sx:{mb:2,fontSize:"xlarge"},children:"Settings"}),e.jsxs(w,{sx:{display:"grid",gap:2,gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"}},children:[e.jsx(w,{children:e.jsx(Xa,{})}),e.jsx(w,{children:e.jsx(Ka,{})})]})]})})}function el(){const[s,t]=V.useState("");return V.useEffect(()=>{fetch("/RELEASE_LOG.md").then(r=>r.text()).then(t)},[]),e.jsxs(w,{sx:{p:2,minHeight:200,overflow:"auto",bgcolor:"background.level1",mt:2,borderRadius:"var(--joy-radius-lg)",border:"1px solid",borderColor:"divider"},children:[e.jsx(y,{level:"h4",sx:{mb:1},children:"Release Log"}),e.jsx(w,{sx:{fontSize:14},children:e.jsx("div",{dangerouslySetInnerHTML:{__html:J(s)}})})]})}function tl(){return e.jsxs(w,{sx:{p:2,minHeight:120,bgcolor:"background.level1",borderRadius:"var(--joy-radius-lg)",border:"1px solid",borderColor:"divider"},children:[e.jsx(y,{level:"h4",sx:{mb:1},children:"Application Info"}),e.jsx(y,{level:"body-md",children:"Smartback Inventory System"}),e.jsxs(y,{level:"body-sm",sx:{mt:1},children:["Environment: ","production"]}),e.jsxs(y,{level:"body-sm",children:["Version: ","N/A"]}),e.jsxs(y,{level:"body-sm",children:["Build: ","N/A"]}),e.jsxs(y,{level:"body-sm",children:["Date: ",new Date().toLocaleDateString()]}),e.jsx(q,{component:"a",href:"https://nicklasfangerfisk.github.io/Testflow/",target:"_blank",rel:"noopener noreferrer",startDecorator:e.jsx(Cr,{}),sx:{mt:2},variant:"outlined",color:"primary",children:"System test"})]})}function sl(){return e.jsxs(w,{sx:{p:1,width:"100%",maxWidth:600,mx:"auto"},children:[e.jsx(y,{level:"h2",sx:{mb:2},children:"Settings"}),e.jsx(tl,{}),e.jsx(el,{})]})}function rl(){const s=Ss(),{isMobile:t}=Ke(),r=Qe(),[i,n]=u.useState("dashboard"),[a,o]=u.useState([]),l=[{label:"Dashboard",icon:e.jsx(ms,{}),value:"dashboard"},{label:"Orders",icon:e.jsx(gs,{}),value:"orders"},{label:"Users",icon:e.jsx(bs,{}),value:"users"},{label:"Settings",icon:e.jsx(Rt,{}),value:"settings"}];return u.useEffect(()=>{n({"/":"dashboard","/dashboard":"dashboard","/orders":"orders","/products":"dashboard","/users":"users","/suppliers":"dashboard","/purchase-orders":"dashboard","/tickets":"dashboard","/sms-campaigns":"dashboard","/movements":"dashboard","/inventory":"dashboard","/settings":"settings"}[s.pathname]||"dashboard")},[s.pathname]),u.useEffect(()=>{async function c(){const{data:d,error:h}=await v.from("users").select("*");if(h)console.error("Error fetching users:",h);else{console.log("Fetched users:",d);const p=(d||[]).map(g=>({id:g.id,name:g.name||null,email:g.email,role:g.role||null,created_at:g.created_at||null,last_login:g.last_login||null,phone:g.phone||null}));o(p)}}c()},[]),console.log("isMobile:",t),e.jsxs(w,{sx:{display:"flex",height:"100vh",overflow:"hidden"},children:[s.pathname!=="/login"&&!t&&e.jsx(ri,{setView:c=>console.log(c),view:"home"}),e.jsxs(w,{component:"main",sx:{flexGrow:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0,overflowY:"auto",bgcolor:"background.default",p:s.pathname!=="/dashboard"&&s.pathname!=="/login"&&s.pathname!=="/tickets"&&s.pathname!=="/movements"?3:0,width:t?"100%":"calc(100% - var(--Sidebar-width, 240px))",marginBottom:t?"56px":0},children:[t&&s.pathname!=="/login"&&e.jsx(ea,{items:l,value:i,onChange:c=>{n(c),r(`/${c}`)},toggleSidebar:()=>console.log("Sidebar toggled")}),e.jsxs(ws,{children:[e.jsx(ae,{path:"/",element:e.jsx(Et,{to:"/dashboard",replace:!0})}),e.jsx(ae,{path:"/orders",element:e.jsx(ve,{children:e.jsx(ui,{rows:[],orderDetailsOpen:!1,selectedOrder:null,fetchOrderItems:c=>Promise.resolve([]),onCloseOrderDetails:()=>{}})})}),e.jsx(ae,{path:"/products",element:e.jsx(ve,{children:e.jsx(fi,{})})}),e.jsx(ae,{path:"/users",element:e.jsx(ve,{children:t?e.jsx(gi,{users:a}):e.jsx(mi,{users:a})})}),e.jsx(ae,{path:"/suppliers",element:e.jsx(ve,{children:e.jsx(bi,{})})}),e.jsx(ae,{path:"/purchase-orders",element:e.jsx(ve,{children:e.jsx(Yo,{})})}),e.jsx(ae,{path:"/tickets",element:e.jsx(ve,{children:e.jsx(oa,{})})}),e.jsx(ae,{path:"/sms-campaigns",element:e.jsx(ve,{children:e.jsx(aa,{campaigns:[]})})}),e.jsx(ae,{path:"/dashboard",element:e.jsx(ve,{children:e.jsx(ca,{})})}),e.jsx(ae,{path:"/movements",element:e.jsx(ve,{children:e.jsx(ha,{})})}),e.jsx(ae,{path:"/inventory",element:e.jsx(ve,{children:e.jsx(fa,{})})}),e.jsx(ae,{path:"/settings",element:e.jsx(ve,{children:t?e.jsx(sl,{}):e.jsx(Ya,{})})}),e.jsx(ae,{path:"*",element:e.jsx(Et,{to:"/",replace:!0})})]})]})]})}function nl(){return e.jsx(gr,{children:e.jsx(Jn,{children:e.jsxs(ws,{children:[e.jsx(ae,{path:"/login/*",element:e.jsx(ua,{})}),e.jsx(ae,{path:"/*",element:e.jsx(rl,{})})]})})})}console.log("Mounting React app...");const dr=document.getElementById("root");dr?(Qn.createRoot(dr).render(e.jsx(nl,{})),console.log("React app rendered!")):console.error("No #root element found in index.html!");

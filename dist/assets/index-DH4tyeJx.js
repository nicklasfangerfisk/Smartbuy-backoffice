import{b as Pr,u as tr,r as h,j as e,I as de,R as se,d as zr,e as vt,B as i,G as sr,T as d,f as q,L as Qt,h as Zt,i as Yt,k as it,l as Ss,m as Or,D as Te,A as ge,M as Re,n as Ee,o as qe,p as ss,q as rs,s as ns,F as X,t as J,S as je,v as W,w as M,x as _t,y as Ue,z as G,C as wt,E as ye,H as ue,J as Ae,K as rr,N as at,O as ie,P as ks,Q as Ar,U as Rr,V as Er,W as Tr,X as ht,Y as Tt,Z as Me,_ as Lr,$ as Mr,a0 as Nr,a1 as gt,a2 as qr,a3 as $r,a4 as Wr,a5 as Fr,a6 as Ur,a7 as Cs,a8 as Br,a9 as Hr,aa as Vr,ab as _s,ac as Jt,ad as Gr,ae as nr,af as Qr,ag as Zr,ah as Ds,ai as Is,aj as Ps,ak as zs}from"./mui-core-vqoB0BLE.js";import{D as lr,L as Yr,H as Jr,a as ls,S as is,b as ir,G as as,c as ar,A as or,Q as cr,d as Dt,P as st,e as Xr,K as Kr,f as dt,g as be,h as dr,i as en,j as tn,F as sn,C as qt,k as Lt,E as rn,l as nn,m as ln,n as an,o as ke,p as os,q as Os,r as ot,s as As,t as ur,I as hr,u as Rs,v as ut,w as It,x as Pt,y as on,M as cn,z as xr,B as Es,J as pr,N as Ts,O as dn,R as un,T as hn,U as xn,V as pn,W as mn,X as gn,Y as fn,Z as jn,_ as Ls,$ as bn,a0 as mr,a1 as yn,a2 as vn,a3 as wn,a4 as Sn}from"./mui-icons-CcfeKLif.js";import{c as kn}from"./supabase-BOE27HOG.js";import{N as zt,u as cs,a as ds,R as us,b as De,B as Cn}from"./router-Do70T27L.js";import{f as $t}from"./utils-CSQe5d3I.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))l(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function l(s){if(s.ep)return;s.ep=!0;const c=n(s);fetch(s.href,c)}})();var ft={},Ms;function _n(){if(Ms)return ft;Ms=1;var r=Pr();return ft.createRoot=r.createRoot,ft.hydrateRoot=r.hydrateRoot,ft}var Dn=_n();function In(r){const{onClick:t,sx:n,...l}=r,{mode:s,setMode:c}=tr(),[a,o]=h.useState(!1);return h.useEffect(()=>{o(!0)},[]),a?e.jsxs(de,{"data-screenshot":"toggle-mode",size:"sm",variant:"outlined",color:"neutral",...l,onClick:u=>{c(s==="light"?"dark":"light"),t?.(u)},sx:[s==="dark"?{"& > *:first-of-type":{display:"none"}}:{"& > *:first-of-type":{display:"initial"}},s==="light"?{"& > *:last-of-type":{display:"none"}}:{"& > *:last-of-type":{display:"initial"}},...Array.isArray(n)?n:[n]],children:[e.jsx(lr,{}),e.jsx(Yr,{})]}):e.jsx(de,{size:"sm",variant:"outlined",color:"neutral",...l,sx:n,disabled:!0})}const gr="https://tfzvtzqybgbzxcxozdes.supabase.co",Xt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRmenZ0enF5YmdienhjeG96ZGVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NTc2MDIsImV4cCI6MjA2MzQzMzYwMn0.hD2WdkvI8LY9N0IHP7HDQliyicQA0c-mspKjCJf0_Fc";console.log("[Supabase] URL:",gr);console.log("[Supabase] Anon Key:",Xt.slice(0,6)+"..."+Xt.slice(-6));const T=kn(gr,Xt);T.auth.onAuthStateChange((r,t)=>{console.log("[Auth State Change]",r,t),r==="SIGNED_IN"?console.log("User signed in:",t?.user):r==="SIGNED_OUT"&&console.log("User signed out")});let Wt=!1;T.auth.onAuthStateChange((r,t)=>{Wt||(Wt=!0,console.log("[Auth State Change]",r,t),r==="SIGNED_IN"?console.log("User signed in:",t?.user):r==="SIGNED_OUT"&&(console.log("User signed out"),window.location.pathname!=="/login"&&(window.location.href="/login")),Wt=!1)});const hs=r=>t=>{const[n,l]=se.useState(null),[s,c]=se.useState(!0);return se.useEffect(()=>{async function a(){const{data:o}=await T.auth.getSession();l(o?.session||null),c(!1)}a()},[]),s?e.jsx("div",{children:"Loading..."}):n?e.jsx(r,{...t}):e.jsx(zt,{to:"/login",replace:!0})},Pn=[{label:"Home",icon:se.createElement(Jr),value:"home",route:"/",showInMobile:!0},{label:"Dashboard",icon:se.createElement(ls),value:"dashboard",route:"/dashboard",showInMobile:!0},{label:"Orders",icon:se.createElement(is),value:"orders",route:"/orders",showInMobile:!0},{label:"Products",icon:se.createElement(ir),value:"products",route:"/products",showInMobile:!0},{label:"Users",icon:se.createElement(as),value:"users",route:"/users",showInMobile:!0},{label:"Suppliers",icon:se.createElement(ar),value:"suppliers",route:"/suppliers",showInMobile:!0},{label:"Purchase Orders",icon:se.createElement(or),value:"purchaseorders",route:"/purchase-orders",showInMobile:!0},{label:"Tickets",icon:se.createElement(cr),value:"tickets",route:"/tickets",showInMobile:!0},{label:"SMS Campaigns",icon:se.createElement(Dt),value:"smscampaigns",route:"/sms-campaigns",showInMobile:!0},{label:"Movements",icon:se.createElement(Dt),value:"movements",route:"/movements",showInMobile:!0},{label:"My Profile",icon:se.createElement(st),value:"profile",route:"/settings",showInMobile:!0}],St={Sales:[{label:"Dashboard",icon:se.createElement(ls),value:"dashboard",route:"/dashboard",showInMobile:!0},{label:"Orders",icon:se.createElement(is),value:"orders",route:"/orders",showInMobile:!0},{label:"Products",icon:se.createElement(ir),value:"products",route:"/products",showInMobile:!0}],Support:[{label:"Tickets",icon:se.createElement(cr),value:"tickets",route:"/tickets",showInMobile:!0},{label:"Users",icon:se.createElement(as),value:"users",route:"/users",showInMobile:!0},{label:"My Profile",icon:se.createElement(st),value:"profile",route:"/settings",showInMobile:!0}],Marketing:[{label:"SMS Campaigns",icon:se.createElement(Dt),value:"smscampaigns",route:"/sms-campaigns",showInMobile:!0}],Operations:[{label:"Suppliers",icon:se.createElement(ar),value:"suppliers",route:"/suppliers",showInMobile:!0},{label:"Purchase Orders",icon:se.createElement(or),value:"purchaseorders",route:"/purchase-orders",showInMobile:!0},{label:"Movements",icon:se.createElement(Dt),value:"movements",route:"/movements",showInMobile:!0}]};function Pe(){const r=zr(),t=vt("(max-width:600px)"),n=vt("(min-width:601px) and (max-width:1024px)"),l=vt("(min-width:1025px)");return{isMobile:t,isTablet:n,isDesktop:l,isSmallScreen:t,isMediumScreen:n,isLargeScreen:l,breakpoints:{mobile:"600px",tablet:"1024px",desktop:"1025px"},theme:r}}function fr(){const{isMobile:r,isTablet:t}=Pe();return{containerPadding:r?1:t?2:3,sectionPadding:r?2:t?3:4,itemPadding:r?1:2,smallGap:r?1:2,mediumGap:r?2:3,largeGap:r?3:4,sectionMargin:r?2:3,itemMargin:r?1:2}}function zn(){const{isMobile:r}=Pe();return{getModalSize:(n="medium")=>r?{width:"95vw",height:n==="fullscreen"?"95vh":"auto",maxHeight:"90vh",margin:1}:{small:{width:400,maxWidth:"90vw"},medium:{width:600,maxWidth:"90vw"},large:{width:800,maxWidth:"90vw"},fullscreen:{width:"90vw",height:"90vh"}}[n]}}function On({setView:r,view:t}){const n=cs(),l=ds(),{isMobile:s,isTablet:c,isDesktop:a}=Pe(),[o,u]=h.useState(!1),[p,b]=h.useState([]),[g,y]=h.useState(null),[C,m]=h.useState(null);h.useEffect(()=>{async function x(){const{data:B,error:V}=await T.from("users").select("*");!V&&B&&b(B)}x();async function S(B){if(y(B),B){let{data:V}=await T.from("users").select("*").eq("id",B.id).single();V||(await T.from("users").upsert({id:B.id,email:B.email,name:B.user_metadata?.full_name||null,avatar_url:B.user_metadata?.avatar_url||null,role:"employee"}),V={...B,role:"employee"}),m(V)}else m(null)}T.auth.getUser().then(({data:B})=>S(B.user));const{data:U}=T.auth.onAuthStateChange((B,V)=>{S(V?.user??null)});return()=>{U?.subscription.unsubscribe()}},[]),h.useEffect(()=>{c&&u(!0)},[c,a]);const j=x=>{n(x.route),r(x.value),c&&u(!0)},v=()=>{u(!o)},R=(x,S)=>{j({value:S,route:x})},w=x=>l.pathname===x;return e.jsxs(i,{className:"Sidebar",sx:{display:s?"none":"flex",position:{xs:"fixed",md:"sticky"},transform:{xs:"translateX(calc(100% * (var(--SideNavigation-slideIn, 0) - 1)))",md:"none"},transition:"transform 0.4s, width 0.4s",zIndex:1e4,height:"100vh",maxHeight:"100vh",minHeight:"100vh",width:"var(--Sidebar-width)",top:0,p:2,flexShrink:0,flexDirection:"column",gap:2,borderRight:"1px solid",borderColor:"divider",background:"var(--joy-palette-background-surface, #fff)",overflow:"hidden",boxSizing:"border-box"},children:[e.jsx(sr,{styles:x=>({":root":{"--Sidebar-width":o?"60px":"220px",[x.breakpoints.up("lg")]:{"--Sidebar-width":o?"60px":"240px"}}})}),e.jsx(i,{className:"Sidebar-overlay",sx:{position:"fixed",zIndex:9998,top:0,left:0,width:"100vw",height:"100vh",opacity:"var(--SideNavigation-slideIn)",backgroundColor:"var(--joy-palette-background-backdrop)",transition:"opacity 0.4s",transform:{xs:"translateX(calc(100% * (var(--SideNavigation-slideIn, 0) - 1) + var(--SideNavigation-slideIn, 0) * var(--Sidebar-width, 0px)))",lg:"translateX(-100%)"}}}),e.jsxs(i,{sx:{display:"flex",gap:1,alignItems:"center",flexShrink:0},children:[e.jsx(de,{size:"sm",variant:"plain",onClick:v,sx:{p:.5,borderRadius:1,"&:hover":{bgcolor:"neutral.100"}},children:e.jsx("img",{src:"/favicon.svg",alt:"Logo",style:{width:28,height:28,borderRadius:6}})}),!o&&e.jsxs(e.Fragment,{children:[e.jsx(d,{level:"title-lg",children:"Smartbuy"}),e.jsx(In,{sx:{ml:"auto"}})]})]}),!o&&e.jsx(i,{sx:{flexShrink:0},children:e.jsx(q,{size:"sm",startDecorator:e.jsx(Xr,{}),placeholder:"Search"})}),e.jsx(i,{sx:{minHeight:0,overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",display:"flex",flexDirection:"column",[`& .${Or.root}`]:{gap:1.5}},children:e.jsx(Qt,{size:"sm",sx:{gap:1,"--List-nestedInsetStart":"30px","--ListItem-radius":x=>x.vars.radius.sm},children:["Sales","Support","Operations","Marketing"].map(x=>e.jsx(Zt,{nested:!0,children:e.jsx(An,{defaultExpanded:!o,renderToggle:({open:S,setOpen:U})=>o?e.jsx(Yt,{title:x,placement:"right",arrow:!0,children:e.jsx(it,{onClick:()=>U(!S),children:St[x][0]?.icon})}):e.jsxs(it,{onClick:()=>U(!S),children:[St[x][0]?.icon,e.jsx(Ss,{children:e.jsx(d,{level:"title-sm",children:x})}),e.jsx(Kr,{sx:[S?{transform:"rotate(180deg)"}:{transform:"none"}]})]}),children:e.jsx(Qt,{sx:{gap:.5},children:St[x].map(S=>e.jsx(Zt,{children:o?e.jsx(Yt,{title:S.label,placement:"right",arrow:!0,children:e.jsx(it,{selected:w(S.route),onClick:()=>R(S.route,S.value),sx:{justifyContent:"center",px:1,width:"100%"},children:S.icon})}):e.jsxs(it,{selected:w(S.route),onClick:()=>R(S.route,S.value),sx:{justifyContent:"flex-start",px:2,width:"100%"},children:[S.icon,e.jsx(Ss,{children:e.jsx(d,{level:"body-sm",children:S.label})})]})},S.value))})})},x))})}),e.jsx(i,{sx:{flexShrink:0}}),e.jsx(Te,{sx:{flexShrink:0}}),e.jsxs(i,{sx:{display:"flex",gap:1,alignItems:"center",minHeight:48,flexShrink:0,cursor:"pointer",borderRadius:"sm","&:hover":{bgcolor:"neutral.50"}},onClick:()=>R("/settings","settings"),children:[e.jsx(ge,{variant:"outlined",size:"sm",src:C?.avatar_url||g?.user_metadata?.avatar_url||void 0}),!o&&e.jsxs(i,{sx:{minWidth:0,flex:1},children:[e.jsx(d,{level:"title-sm",children:C?.name||g?.user_metadata?.full_name||g?.email||"Not signed in"}),e.jsx(d,{level:"body-xs",children:C?.email||g?.email||""})]})]})]})}function An({defaultExpanded:r=!1,renderToggle:t,children:n}){const[l,s]=h.useState(r);return e.jsxs(h.Fragment,{children:[t({open:l,setOpen:s}),e.jsx(i,{sx:{display:"grid",transition:"0.2s ease","& > *":{overflow:"hidden"},gridTemplateRows:l?"1fr":"0fr"},children:n})]})}const Rn=hs(On);function Ce({children:r,variant:t="page",padding:n="medium",fullHeight:l=!1,className:s}){const{isMobile:c}=Pe(),a=fr(),o=()=>n==="none"?0:{small:a.itemPadding,medium:a.containerPadding,large:a.sectionPadding}[n]||a.containerPadding,u=()=>{const p={p:o(),boxSizing:"border-box"};switch(t){case"page":return{...p,height:l?"100%":"auto",overflow:"auto",width:"100%"};case"dialog":return{...p,height:"auto",overflow:"visible"};case"form":return{...p,display:"flex",flexDirection:"column",gap:a.mediumGap};case"card":return{...p,borderRadius:1,bgcolor:"background.surface"};case"table-page":return{width:"100%",overflow:"visible",pt:c?1:2,pl:c?1:2,pr:c?1:2,pb:c?1:2,boxSizing:"border-box"};default:return p}};return e.jsx(i,{sx:u(),className:s,children:r})}function Ot({open:r,onClose:t,children:n,title:l,size:s="medium",showCloseButton:c=!0,actions:a}){const{getModalSize:o}=zn();return e.jsx(Re,{open:r,onClose:t,children:e.jsxs(Ee,{sx:o(s),children:[c&&e.jsx(qe,{}),l&&e.jsx(ss,{children:l}),e.jsx(rs,{children:n}),a&&e.jsx(ns,{children:a})]})})}const Fe=({children:r})=>e.jsx(i,{sx:{display:"flex",flexDirection:"column",width:"100%",flex:1,bgcolor:"background.body"},children:r}),En=({open:r,creating:t,newOrder:n,setNewOrder:l,onClose:s,onCreate:c})=>{const[a,o]=h.useState([]),[u,p]=h.useState([{id:crypto.randomUUID(),product:null,quantity:1,unitprice:0,discount:0}]),[b,g]=h.useState(!1),[y,C]=h.useState(null),[m,j]=h.useState(null),[v,R]=h.useState(0),[w,x]=h.useState(!1),[S,U]=h.useState(null),[B,V]=h.useState(!1);h.useEffect(()=>{r&&(p([{id:crypto.randomUUID(),product:null,quantity:1,unitprice:0,discount:0}]),C(null),l(F=>({...F,date:F.date||new Date().toISOString().slice(0,10)})))},[r]),h.useEffect(()=>{r&&(g(!0),j(null),T.from("Products").select("*").then(({data:F,error:E})=>{!E&&F?(F.length===0&&j("No products available. Please add products first."),o(F.map(f=>({id:f.uuid||f.id,ProductName:f.ProductName,SalesPrice:f.SalesPrice??0})))):j("Failed to load products. Please try again later."),g(!1)}))},[r]);const _=()=>{p(F=>[...F,{id:crypto.randomUUID(),product:null,quantity:1,unitprice:0,discount:v}])},I=F=>{p(E=>E.filter((f,$)=>$!==F))},N=(F,E,f)=>{p($=>$.map((Z,A)=>{if(A!==F)return Z;if(E==="product"&&f){const H=a.find(oe=>oe.id===f.id);return{...Z,product:f,unitprice:H?.SalesPrice??0}}return E==="product"&&!f?{...Z,product:null,unitprice:0}:{...Z,[E]:f}}))},L=F=>{F.preventDefault();const E=u.filter(f=>f.product&&f.product.id&&f.quantity>0).map(f=>({product_uuid:f.product.id,quantity:f.quantity,unitprice:f.unitprice,discount:f.discount}));if(E.length===0){C("Please add at least one valid order item.");return}C(null),c(E,v)};return e.jsx(Re,{open:r,onClose:s,"aria-labelledby":"create-order-modal",children:e.jsxs(Ee,{"aria-labelledby":"create-order-modal",sx:{maxWidth:600,width:"100%",minWidth:{xs:300,sm:400}},children:[e.jsx(qe,{}),e.jsx(d,{id:"create-order-modal",level:"h4",sx:{mb:2},children:"Create Order"}),e.jsxs("form",{onSubmit:L,children:[e.jsxs(X,{sx:{mb:2},required:!0,children:[e.jsx(J,{children:"Date"}),e.jsx(q,{type:"date",value:n.date,onChange:F=>l(E=>({...E,date:F.target.value})),required:!0})]}),e.jsxs(X,{sx:{mb:2},required:!0,children:[e.jsx(J,{children:"Status"}),e.jsxs(je,{value:n.status,onChange:(F,E)=>l(f=>({...f,status:E||"Draft"})),children:[e.jsx(W,{value:"Draft",children:"Draft"}),e.jsx(W,{value:"Paid",children:"Paid"}),e.jsx(W,{value:"Refunded",children:"Refunded"}),e.jsx(W,{value:"Cancelled",children:"Cancelled"})]})]}),e.jsxs(X,{sx:{mb:2},required:!0,children:[e.jsx(J,{children:"Customer Name"}),e.jsx(q,{value:n.customer_name,onChange:F=>l(E=>({...E,customer_name:F.target.value})),required:!0})]}),e.jsxs(X,{sx:{mb:2},required:!0,children:[e.jsx(J,{children:"Customer Email"}),e.jsx(q,{type:"email",value:n.customer_email,onChange:F=>l(E=>({...E,customer_email:F.target.value})),required:!0})]}),e.jsxs(X,{sx:{mb:2},required:!0,children:[e.jsx(J,{children:"Order Discount (%)"}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(q,{type:"number",value:v,disabled:u.length>0&&!(u.length===1&&!u[0].product),onChange:F=>{const E=Math.max(0,Math.min(100,Math.floor(Number(F.target.value))));R(E),p(f=>f.map($=>({...$,discount:E})))},slotProps:{input:{min:0,max:100,step:1}},required:!0,placeholder:"Order Discount %",sx:{flex:1}}),(u.length>1||u.length===1&&u[0].product)&&e.jsx(M,{size:"sm",variant:"outlined",onClick:()=>x(!0),children:"Edit"})]})]}),y&&e.jsx(d,{color:"danger",sx:{mb:1},children:y}),e.jsx(Te,{sx:{my:2}}),e.jsx(i,{sx:{mb:1,fontWeight:"lg",fontSize:"lg"},children:"Order Items"}),m&&e.jsx(d,{color:"danger",sx:{mb:1},children:m}),u.map((F,E)=>e.jsxs(i,{sx:{display:"flex",gap:1,alignItems:"center",mb:1},children:[e.jsx(_t,{options:a,getOptionLabel:f=>f.ProductName,isOptionEqualToValue:(f,$)=>f.id===$.id,value:F.product,onChange:(f,$)=>N(E,"product",$),loading:b,placeholder:b?"Loading...":"Search product",sx:{minWidth:220},disabled:a.length===0,required:!0,renderOption:(f,$)=>{const{key:Z,...A}=f;return e.jsx("li",{...A,children:$.ProductName},$.id)}}),e.jsx(q,{type:"number",value:F.quantity,onChange:f=>N(E,"quantity",Math.max(1,Number(f.target.value))),sx:{width:80},required:!0,slotProps:{input:{min:1}}}),e.jsx(q,{type:"number",value:F.unitprice,onChange:f=>N(E,"unitprice",Math.max(0,Number(f.target.value))),sx:{width:100},required:!0,slotProps:{input:{min:0,step:.01}},placeholder:"Unit Price"}),e.jsx(q,{type:"number",value:F.discount,onChange:f=>N(E,"discount",Math.max(0,Math.min(100,Math.floor(Number(f.target.value))))),sx:{width:80},required:!0,slotProps:{input:{min:0,max:100,step:1}},placeholder:"Discount %"}),e.jsx(de,{size:"sm",color:"danger",onClick:()=>I(E),disabled:u.length===1,children:e.jsx(dt,{})})]},F.id)),e.jsx(M,{startDecorator:e.jsx(be,{}),variant:"soft",size:"sm",onClick:_,sx:{mb:2},disabled:!!m,children:"Add Item"}),e.jsx(Re,{open:w,onClose:()=>x(!1),children:e.jsxs(Ee,{sx:{minWidth:350},children:[e.jsx(d,{level:"title-md",sx:{mb:1},children:"Change Order Discount"}),e.jsxs(X,{sx:{mb:2},required:!0,children:[e.jsx(J,{children:"Change discount to (%)"}),e.jsx(q,{type:"number",value:S??v,onChange:F=>U(Math.max(0,Math.min(100,Math.floor(Number(F.target.value))))),slotProps:{input:{min:0,max:100,step:1}},required:!0,autoFocus:!0})]}),e.jsx(d,{sx:{mb:2},children:"How do you want to apply the new order discount?"}),e.jsxs(i,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[e.jsx(M,{onClick:()=>{R(S),p(F=>F.map(E=>({...E,discount:S}))),x(!1),U(null)},children:"Overwrite all"}),e.jsx(M,{onClick:()=>{R(S),p(F=>F.map(E=>E.discount<S?{...E,discount:S}:E)),x(!1),U(null)},children:"Set discount on lower"}),e.jsx(M,{variant:"plain",onClick:()=>{x(!1),U(null)},children:"Cancel"})]})]})}),e.jsxs(i,{sx:{display:"flex",gap:2,mt:2},children:[e.jsx(M,{type:"submit",loading:t,color:"primary",disabled:!!m,children:"Create"}),e.jsx(M,{variant:"plain",onClick:s,disabled:t,children:"Cancel"})]})]})]})})},Le={currency:"DKK",locale:"da-DK",symbol:"kr"};function ze(r){if(r==null||isNaN(r))return"0 kr";const t=r%1!==0;return new Intl.NumberFormat(Le.locale,{style:"currency",currency:Le.currency,minimumFractionDigits:t?2:0,maximumFractionDigits:2}).format(r)}function ae(r,t=!0){if(r==null||isNaN(r))return t?"0 kr":"kr 0";const n=r%1!==0,l=new Intl.NumberFormat(Le.locale,{minimumFractionDigits:n?2:0,maximumFractionDigits:2}).format(r);return t?`${l} kr`:`kr ${l}`}function Ns(r){return{...r,salesprice_currency:Le.currency,salesprice_exchrate:1,costprice_currency:Le.currency,costprice_exchrate:1}}function Tn(r){return{...r,order_total_currency:Le.currency,order_total_exchrate:1}}function Ln(r){return{...r,unitprice_currency:Le.currency,unitprice_exchrate:1,price_currency:Le.currency,price_exchrate:1}}function Mn(r){return{...r,unit_price_currency:Le.currency,unit_price_exchrate:1}}function Nn({open:r,onClose:t,selectedOrder:n,fetchOrderItems:l}){const[s,c]=h.useState([]),[a,o]=h.useState(!1);return h.useEffect(()=>{async function u(){if(n){o(!0);const p=await l(n.uuid);c(p),o(!1)}else c([])}r&&n?u():c([])},[r,n,l]),e.jsx(Re,{open:r,onClose:t,"aria-labelledby":"order-details-modal",children:e.jsxs(Ee,{"aria-labelledby":"order-details-modal",sx:{maxWidth:600,width:"100%"},children:[e.jsx(qe,{}),e.jsx(d,{id:"order-details-modal",level:"title-md",fontWeight:"lg",sx:{mb:2},children:"Order Details"}),n&&e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(d,{level:"body-sm",sx:{color:"text.secondary"},children:["Order ID: ",n.uuid]}),e.jsxs(d,{level:"body-sm",sx:{color:"text.secondary"},children:["Date: ",new Date(n.date).toLocaleString()]}),e.jsxs(d,{level:"body-sm",sx:{color:"text.secondary"},children:["Status: ",n.status]})]}),e.jsx(Te,{}),e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(d,{level:"body-sm",fontWeight:"md",children:"Customer Information"}),e.jsxs(d,{level:"body-sm",sx:{color:"text.secondary"},children:["Name: ",n.customer.name]}),e.jsxs(d,{level:"body-sm",sx:{color:"text.secondary"},children:["Email: ",n.customer.email]})]}),e.jsx(Te,{}),e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(d,{level:"body-sm",fontWeight:"md",children:"Ordered Items"}),a?e.jsx(d,{level:"body-sm",sx:{color:"text.secondary"},children:"Loading items..."}):e.jsxs(Ue,{size:"sm",sx:{minWidth:500},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{style:{textAlign:"right"},children:"Quantity"}),e.jsx("th",{style:{textAlign:"right"},children:"Unit Price"}),e.jsx("th",{style:{textAlign:"right"},children:"Discount (%)"}),e.jsx("th",{style:{textAlign:"right"},children:"Total Price"})]})}),e.jsx("tbody",{children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{textAlign:"center",padding:"16px"},children:e.jsx(d,{level:"body-sm",sx:{color:"text.secondary"},children:"No items found for this order."})})}):s.map(function(u){return e.jsxs("tr",{children:[e.jsx("td",{children:u.name||u.product_uuid}),e.jsx("td",{style:{textAlign:"right"},children:u.quantity??"-"}),e.jsx("td",{style:{textAlign:"right"},children:u.unitprice!=null?ae(u.unitprice):"-"}),e.jsx("td",{style:{textAlign:"right"},children:u.discount!=null?`${Number(u.discount).toFixed(2)}%`:"-"}),e.jsx("td",{style:{textAlign:"right"},children:u.price!=null?ae(u.price):"-"})]},u.uuid)})})]})]})]})]})})}function qn({customerInfo:r,onChange:t,onLogin:n}){const l=c=>a=>{t({...r,[c]:a.target.value})},s=()=>{n?n():console.log("Login functionality not available in this app")};return e.jsx(i,{sx:{width:"100%"},children:e.jsxs(G,{spacing:3,sx:{width:"100%"},children:[e.jsxs(i,{sx:{textAlign:"center"},children:[e.jsx(d,{level:"body-sm",color:"neutral",sx:{mb:2},children:"Already have an account? Sign in to auto-fill your information"}),e.jsx(M,{variant:"outlined",startDecorator:e.jsx(dr,{}),onClick:s,disabled:!n,sx:{minWidth:150},children:"Login"})]}),e.jsx(Te,{sx:{my:1},children:e.jsx(d,{level:"body-xs",color:"neutral",children:"or continue as guest"})}),e.jsxs(i,{children:[e.jsx(d,{level:"h4",sx:{mb:3},children:"Contact"}),e.jsxs(G,{spacing:2,children:[e.jsxs(X,{required:!0,children:[e.jsx(J,{children:"Email *"}),e.jsx(q,{type:"email",value:r.email,onChange:l("email"),placeholder:"Enter email",variant:"outlined"})]}),e.jsxs(X,{children:[e.jsx(J,{children:"Phone Number *"}),e.jsx(q,{value:r.phone||"",onChange:l("phone"),placeholder:"Enter phone number",variant:"outlined"})]}),e.jsx(wt,{checked:r.newsletter||!1,onChange:c=>t({...r,newsletter:c.target.checked}),label:"I would like to receive newsletters",sx:{mt:1}})]})]}),e.jsxs(i,{children:[e.jsx(d,{level:"h4",sx:{mb:3},children:"Address"}),e.jsxs(G,{spacing:2,children:[e.jsxs(ye,{container:!0,spacing:2,sx:{width:"100%",m:0},children:[e.jsx(ye,{xs:12,md:6,children:e.jsxs(X,{required:!0,children:[e.jsx(J,{children:"First Name *"}),e.jsx(q,{value:r.firstName||"",onChange:l("firstName"),placeholder:"Enter first name",variant:"outlined"})]})}),e.jsx(ye,{xs:12,md:6,children:e.jsxs(X,{required:!0,children:[e.jsx(J,{children:"Last Name *"}),e.jsx(q,{value:r.lastName||"",onChange:l("lastName"),placeholder:"Enter last name",variant:"outlined"})]})})]}),e.jsx(ye,{container:!0,spacing:2,sx:{width:"100%",m:0},children:e.jsx(ye,{xs:12,children:e.jsxs(X,{required:!0,children:[e.jsx(J,{children:"Address*"}),e.jsx(q,{value:r.address||"",onChange:l("address"),placeholder:"Enter address and house number",variant:"outlined"})]})})}),e.jsxs(ye,{container:!0,spacing:2,sx:{width:"100%",m:0},children:[e.jsx(ye,{xs:12,md:4,children:e.jsxs(X,{required:!0,children:[e.jsx(J,{children:"Postal Code *"}),e.jsx(q,{value:r.postalCode||"",onChange:l("postalCode"),placeholder:"Enter postal code",variant:"outlined"})]})}),e.jsx(ye,{xs:12,md:8,children:e.jsxs(X,{required:!0,children:[e.jsx(J,{children:"City *"}),e.jsx(q,{value:r.city||"",onChange:l("city"),placeholder:"Enter city",variant:"outlined"})]})})]}),e.jsxs(X,{children:[e.jsx(J,{children:"Reference"}),e.jsx(q,{value:r.reference||"",onChange:l("reference"),placeholder:"Reference/employee number",variant:"outlined"})]}),e.jsxs(G,{spacing:1,sx:{mt:2},children:[e.jsx(wt,{label:"Log me in so I can easily shop again",sx:{fontSize:"sm"}}),e.jsx(wt,{label:"The addess is not my home address",sx:{fontSize:"sm"}})]})]})]})]})})}const qs=[{value:"standard",label:"Standard Delivery",description:"5-7 business days",cost:99,icon:e.jsx(en,{})},{value:"express",label:"Express Delivery",description:"2-3 business days",cost:199,icon:e.jsx(tn,{})},{value:"overnight",label:"Overnight Delivery",description:"Next business day",cost:349,icon:e.jsx(sn,{})}];function $n({deliveryInfo:r,onChange:t,subtotal:n=0}){const s=n>=1e3,c=(o,u)=>u==="standard"&&s?0:o,a=o=>{const u=qs.find(b=>b.value===o),p=c(u?.cost||0,o);t({...r,method:o,cost:p,estimatedDays:o==="overnight"?1:o==="express"?3:6})};return e.jsx(ue,{variant:"outlined",children:e.jsxs(Ae,{children:[e.jsx(d,{level:"h4",sx:{mb:2},children:"Delivery Method"}),(()=>{const o=Math.max(0,1e3-n),u=Math.min(100,n/1e3*100);return n<1e3?e.jsxs(i,{sx:{mb:3,p:2,backgroundColor:"neutral.50",borderRadius:"sm"},children:[e.jsxs(d,{level:"body-sm",sx:{mb:1,fontWeight:600},children:["🚚 Spend ",ae(o)," more for free standard shipping"]}),e.jsx(i,{sx:{position:"relative",width:"100%",height:8,backgroundColor:"#e5e5e5",borderRadius:4,overflow:"hidden",border:"1px solid #d4d4d8"},children:e.jsx(i,{sx:{position:"absolute",top:0,left:0,width:`${u}%`,height:"100%",backgroundColor:"#22c55e",borderRadius:3,transition:"width 0.3s ease-in-out"}})}),e.jsxs(d,{level:"body-xs",color:"neutral",sx:{mt:.5},children:[ae(n)," of ",ae(1e3)]})]}):e.jsx(i,{sx:{mb:3,p:2,backgroundColor:"success.50",borderRadius:"sm"},children:e.jsx(d,{level:"body-sm",color:"success",sx:{fontWeight:600},children:"🎉 You qualify for free standard shipping!"})})})(),e.jsx(rr,{value:r.method,onChange:o=>a(o.target.value),children:e.jsx(G,{spacing:2,children:qs.map(o=>e.jsx(ue,{variant:r.method===o.value?"soft":"outlined",sx:{cursor:"pointer",transition:"all 0.2s","&:hover":{boxShadow:"sm"}},onClick:()=>a(o.value),children:e.jsxs(Ae,{children:[e.jsx(at,{value:o.value,sx:{display:"none"}}),e.jsxs(G,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(i,{sx:{color:"primary.500"},children:o.icon}),e.jsxs(i,{sx:{flex:1},children:[e.jsx(d,{level:"title-md",children:o.label}),e.jsx(d,{level:"body-sm",sx:{color:"text.secondary"},children:o.description})]}),e.jsx(i,{children:(()=>{const u=c(o.cost,o.value),p=o.cost;return u===0&&p>0?e.jsxs(G,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(ie,{variant:"soft",color:"success",children:"Free"}),e.jsx(d,{level:"body-xs",sx:{textDecoration:"line-through",color:"text.secondary"},children:ze(p)})]}):u>0?e.jsx(ie,{variant:"soft",color:"primary",children:ze(u)}):e.jsx(ie,{variant:"soft",color:"success",children:"Free"})})()})]})]})},o.value))})})]})})}const Wn=({sx:r})=>e.jsx(i,{component:"img",src:"/mobilepay-icon.svg",alt:"MobilePay",sx:{width:24,height:24,...r}});function Fn({paymentInfo:r,onChange:t}){const n=s=>{t({...r,method:s,cardNumber:s==="card"?r.cardNumber:"",cardHolder:s==="card"?r.cardHolder:"",expiryDate:s==="card"?r.expiryDate:"",cvv:s==="card"?r.cvv:"",bankAccount:"",routingNumber:""})},l=s=>c=>{let a=c.target.value;s==="cardNumber"&&(a=a.replace(/\s/g,"").replace(/(\d{4})/g,"$1 ").trim(),a.length>19&&(a=a.substring(0,19))),s==="expiryDate"&&(a=a.replace(/\D/g,""),a.length>=2&&(a=a.substring(0,2)+"/"+a.substring(2,4)),a.length>5&&(a=a.substring(0,5))),s==="cvv"&&(a=a.replace(/\D/g,"").substring(0,3)),t({...r,[s]:a})};return e.jsx(i,{sx:{width:"100%"},children:e.jsxs(G,{spacing:3,sx:{width:"100%"},children:[e.jsxs(X,{children:[e.jsx(J,{children:"Select Payment Method"}),e.jsx(rr,{value:r.method,onChange:s=>n(s.target.value),children:e.jsxs(G,{spacing:2,children:[e.jsx(ue,{variant:r.method==="card"?"solid":"outlined",color:r.method==="card"?"primary":"neutral",sx:{cursor:"pointer"},onClick:()=>n("card"),children:e.jsx(Ae,{children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(at,{value:"card"}),e.jsxs(i,{children:[e.jsx(d,{level:"title-sm",children:"Cards"}),e.jsx(i,{sx:{display:"flex",justifyContent:"center",mt:1},children:e.jsx(qt,{sx:{fontSize:32}})})]})]})})}),e.jsx(ue,{variant:r.method==="mobilepay"?"solid":"outlined",color:r.method==="mobilepay"?"primary":"neutral",sx:{cursor:"pointer"},onClick:()=>n("mobilepay"),children:e.jsx(Ae,{children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(at,{value:"mobilepay"}),e.jsxs(i,{children:[e.jsx(d,{level:"title-sm",children:"MobilePay"}),e.jsx(i,{sx:{display:"flex",justifyContent:"center",mt:1},children:e.jsx(Wn,{sx:{width:32,height:32}})})]})]})})}),e.jsx(ue,{variant:r.method==="viabill"?"solid":"outlined",color:r.method==="viabill"?"primary":"neutral",sx:{cursor:"pointer"},onClick:()=>n("viabill"),children:e.jsx(Ae,{children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(at,{value:"viabill"}),e.jsxs(i,{children:[e.jsx(d,{level:"title-sm",children:"Apple Pay / Google Pay"}),e.jsxs(i,{sx:{display:"flex",justifyContent:"center",gap:2,mt:1},children:[e.jsx(i,{component:"span",sx:{fontWeight:700,fontSize:18,color:"#000",px:1,borderRadius:1,background:"#fff",border:"1px solid #eee"},children:" Pay"}),e.jsx(i,{component:"span",sx:{fontWeight:700,fontSize:18,color:"#4285F4",px:1,borderRadius:1,background:"#fff",border:"1px solid #eee"},children:"G Pay"})]})]})]})})}),e.jsx(ue,{variant:r.method==="international"?"solid":"outlined",color:r.method==="international"?"primary":"neutral",sx:{cursor:"pointer"},onClick:()=>n("international"),children:e.jsx(Ae,{children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(at,{value:"international"}),e.jsxs(i,{children:[e.jsx(d,{level:"title-sm",children:"International Credit Cards"}),e.jsx(i,{sx:{display:"flex",justifyContent:"center",mt:1},children:e.jsx(qt,{sx:{fontSize:32}})})]})]})})})]})})]}),r.method==="card"&&e.jsx(ue,{variant:"outlined",children:e.jsx(Ae,{children:e.jsxs(G,{spacing:2,children:[e.jsxs(X,{required:!0,children:[e.jsx(J,{children:"Card Number"}),e.jsx(q,{value:r.cardNumber||"",onChange:l("cardNumber"),placeholder:"1234 5678 9012 3456",startDecorator:e.jsx(qt,{})})]}),e.jsxs(X,{required:!0,children:[e.jsx(J,{children:"Cardholder Name"}),e.jsx(q,{value:r.cardHolder||"",onChange:l("cardHolder"),placeholder:"John Doe"})]}),e.jsxs(ye,{container:!0,spacing:2,sx:{width:"100%",m:0},children:[e.jsx(ye,{xs:8,children:e.jsxs(X,{required:!0,children:[e.jsx(J,{children:"Expiry Date"}),e.jsx(q,{value:r.expiryDate||"",onChange:l("expiryDate"),placeholder:"MM/YY"})]})}),e.jsx(ye,{xs:4,children:e.jsxs(X,{required:!0,children:[e.jsx(J,{children:"CVV"}),e.jsx(q,{value:r.cvv||"",onChange:l("cvv"),placeholder:"123",type:"password"})]})})]})]})})})]})})}const Ft=[{label:"Contact"},{label:"Delivery"},{label:"Payment"}];function Un({open:r,onClose:t,order:n,onSuccess:l}){const[s,c]=h.useState(0),[a,o]=h.useState([]),[u,p]=h.useState(!1),[b,g]=h.useState({name:n?.customer_name||"",email:n?.customer_email||"",phone:"",address:"",city:"",postalCode:"",country:"USA",firstName:"",lastName:"",newsletter:!1,reference:""}),[y,C]=h.useState({method:"standard"}),[m,j]=h.useState({method:"card",cardNumber:"",cardHolder:"",expiryDate:"",cvv:""}),[v,R]=h.useState(!1),[w,x]=h.useState(null),[S,U]=h.useState(!1);h.useEffect(()=>{r&&n&&(B(),c(0),U(!1),x(null),g(f=>{const $=n.customer_name||f.name,Z=$.split(" ");return{...f,name:$,firstName:Z[0]||"",lastName:Z.slice(1).join(" ")||"",email:n.customer_email||f.email}}))},[r,n]);const B=async()=>{if(n){R(!0);try{const{data:f,error:$}=await T.from("OrderItems").select(`
          uuid,
          product_uuid,
          quantity,
          unitprice,
          discount,
          Products:product_uuid(ProductName)
        `).eq("order_uuid",n.uuid);if($)throw $;const Z=f?.map(A=>({...A,ProductName:A.Products?.ProductName||"Unknown Product"}))||[];o(Z)}catch(f){x(f.message||"Failed to load order items")}finally{R(!1)}}},V=()=>{s<Ft.length-1?c(s+1):I()},_=()=>{c(s-1)},I=async()=>{if(n){R(!0),x(null);try{const f=b.firstName&&b.lastName?`${b.firstName} ${b.lastName}`:b.name||"",{error:$}=await T.from("Orders").update({customer_name:f,customer_email:b.email,status:"Paid"}).eq("uuid",n.uuid);if($)throw $;if(a.length>0){const Z=a.map(H=>({product_id:H.product_uuid,movement_type:"outgoing",quantity:H.quantity,date:new Date().toISOString(),reason:"Order Fulfillment",referenceuuid:n.uuid})),{error:A}=await T.from("stock_movements").insert(Z);A&&console.warn("Failed to create stock movements:",A)}U(!0),setTimeout(()=>{l(),t()},2e3)}catch(f){x(f.message||"Failed to complete order")}finally{R(!1)}}},N=f=>{switch(f){case 0:return!!(b.email?.trim()&&b.phone?.trim()&&b.firstName?.trim()&&b.lastName?.trim()&&b.address?.trim()&&b.city?.trim()&&b.postalCode?.trim());case 1:return!0;case 2:return m.method==="card"?!!(m.cardNumber?.replace(/\s/g,"").length===16&&m.cardHolder?.trim()&&m.expiryDate?.length===5&&m.cvv?.length===3):!0;default:return!1}},L=f=>{switch(f){case 0:return e.jsx(qn,{customerInfo:b,onChange:g});case 1:return e.jsx($n,{deliveryInfo:y,onChange:C,subtotal:F()});case 2:return e.jsx(Fn,{paymentInfo:m,onChange:j});default:return null}},F=()=>{const f=a.reduce((Z,A)=>{const H=(A.unitprice||0)*A.quantity,oe=(A.discount||0)*A.quantity;return Z+H-oe},0),$=n?.discount||0;return f-$},E=()=>{const f=F(),$=y.cost||0;return f+$};return n?e.jsx(Re,{open:r,onClose:t,sx:{display:"flex",justifyContent:"center",alignItems:"center",p:{xs:0,md:2},zIndex:10001},children:e.jsxs(Ee,{size:"lg",sx:{width:{xs:"100vw",md:"90vw"},maxWidth:{xs:"none",md:1e3},height:{xs:"100vh",md:"90vh"},maxHeight:{xs:"none",md:750},overflow:"hidden",display:"flex",flexDirection:"column",m:0,borderRadius:{xs:0,md:"md"},p:0},children:[e.jsx(i,{sx:{display:{xs:"none",md:"flex"},justifyContent:"flex-end",alignItems:"center",p:2,borderBottom:"1px solid",borderColor:"divider"},children:e.jsx(qe,{})}),e.jsx(i,{sx:{display:{xs:"flex",md:"none"},justifyContent:"flex-end",alignItems:"center",p:1,position:"absolute",top:0,right:0,zIndex:1e3,backgroundColor:"background.surface"},children:e.jsx(qe,{})}),S?e.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",gap:2,p:3},children:[e.jsx(Lt,{sx:{fontSize:80,color:"success.main"}}),e.jsx(d,{level:"h2",children:"Order Completed!"}),e.jsxs(d,{level:"body-lg",textAlign:"center",color:"neutral",children:["Thank you for your order! Order #",n.order_number_display," has been processed successfully."]})]}):e.jsxs(i,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},height:"100%",overflow:"hidden"},children:[e.jsxs(i,{sx:{display:{xs:"block",md:"none"},borderBottom:"1px solid",borderColor:"divider"},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:2,pr:6},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(d,{level:"title-md",children:"Order Summary"}),e.jsx(d,{level:"body-sm",color:"primary",children:ae(E())})]}),e.jsx(M,{variant:"plain",size:"sm",onClick:()=>p(!u),sx:{minWidth:"auto",p:1},children:u?e.jsx(rn,{}):e.jsx(nn,{})})]}),u&&e.jsxs(i,{sx:{p:2,backgroundColor:"background.level1",animation:"fadeIn 0.2s ease-in-out","@keyframes fadeIn":{from:{opacity:0,transform:"translateY(-10px)"},to:{opacity:1,transform:"translateY(0)"}}},children:[e.jsxs(d,{level:"body-sm",color:"neutral",sx:{mb:2},children:["Order #",n.order_number_display]}),v?e.jsx(i,{sx:{display:"flex",justifyContent:"center",my:2},children:e.jsx(ks,{size:"sm"})}):e.jsx(G,{spacing:1,sx:{mb:2},children:a.map(f=>e.jsxs(i,{sx:{py:.5},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",mb:.5},children:[e.jsx(d,{level:"body-sm",sx:{fontWeight:600},children:f.ProductName}),e.jsx(d,{level:"body-sm",sx:{fontWeight:600},children:ae((f.unitprice||0)*f.quantity-(f.discount||0)*f.quantity)})]}),e.jsxs(d,{level:"body-xs",color:"neutral",children:["Qty: ",f.quantity," × ",ae(f.unitprice||0)]})]},f.uuid))}),e.jsx(Te,{sx:{my:1}}),e.jsxs(G,{spacing:.5,children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(d,{level:"body-xs",children:"Shipping"}),e.jsx(d,{level:"body-xs",children:ae(y.cost||0)})]}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(d,{level:"body-xs",children:"VAT included"}),e.jsx(d,{level:"body-xs",children:ae(a.reduce((f,$)=>f+($.unitprice||0)*$.quantity,0)*.2)})]})]}),e.jsx(Te,{sx:{my:1}}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(d,{level:"title-sm",sx:{fontWeight:700},children:"Total:"}),e.jsx(d,{level:"title-sm",sx:{fontWeight:700,color:"primary.main"},children:ae(E())})]})]})]}),e.jsxs(i,{sx:{display:{xs:"none",md:"block"},width:{md:"350px"},borderRight:"1px solid",borderColor:"divider",p:3,overflow:"auto"},children:[e.jsx(d,{level:"h4",sx:{mb:2},children:"Summary"}),e.jsxs(d,{level:"body-sm",color:"neutral",sx:{mb:2},children:["Order #",n.order_number_display]}),v?e.jsx(i,{sx:{display:"flex",justifyContent:"center",my:3},children:e.jsx(ks,{})}):e.jsx(G,{spacing:1,sx:{mb:3},children:a.map(f=>e.jsxs(i,{sx:{py:1},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",mb:.5},children:[e.jsx(d,{level:"body-sm",sx:{fontWeight:600},children:f.ProductName}),e.jsx(d,{level:"body-sm",sx:{fontWeight:600},children:ae((f.unitprice||0)*f.quantity-(f.discount||0)*f.quantity)})]}),e.jsxs(d,{level:"body-xs",color:"neutral",children:["Qty: ",f.quantity," × ",ae(f.unitprice||0),(f.discount||0)>0&&e.jsxs(i,{component:"span",sx:{color:"warning.main",ml:1},children:["(",f.discount,"% off)"]})]})]},f.uuid))}),e.jsx(Te,{sx:{my:2}}),e.jsxs(G,{spacing:.5,children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(d,{level:"body-sm",children:"Shipping: Delivery to your door"}),e.jsx(d,{level:"body-sm",children:ae(y.cost||0)})]}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(d,{level:"body-sm",children:"Subtotal:"}),e.jsx(d,{level:"body-sm",children:ae(a.reduce((f,$)=>f+($.unitprice||0)*$.quantity,0))})]}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(d,{level:"body-sm",children:"VAT included:"}),e.jsx(d,{level:"body-sm",children:ae(a.reduce((f,$)=>f+($.unitprice||0)*$.quantity,0)*.2)})]})]}),e.jsx(Te,{sx:{my:1}}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(d,{level:"title-md",sx:{fontWeight:700},children:"Total:"}),e.jsx(d,{level:"title-md",sx:{fontWeight:700,color:"primary.main"},children:ae(E())})]})]}),e.jsxs(i,{sx:{flex:1,display:"flex",flexDirection:"column",minHeight:0,overflow:"hidden"},children:[e.jsx(i,{sx:{p:{xs:1,md:3},pb:{xs:1,md:2},borderBottom:"1px solid",borderColor:"divider",flexShrink:0},children:e.jsx(Ar,{sx:{mb:0},children:Ft.map((f,$)=>e.jsx(Rr,{indicator:e.jsx(Tr,{variant:s===$||s>$?"solid":"outlined",color:s>$?"success":"primary",sx:{width:{xs:8,md:12},height:{xs:8,md:12},minWidth:{xs:8,md:12},fontSize:0,"--StepIndicator-size":{xs:"8px",md:"12px"}}}),children:e.jsx(Er,{onClick:()=>c($),children:e.jsx(d,{level:"body-sm",sx:{fontSize:{xs:"0.75rem",md:"0.875rem"}},children:f.label})})},f.label))})}),w&&e.jsx(i,{sx:{p:{xs:1,md:3},pt:0,flexShrink:0},children:e.jsx(ht,{color:"danger",children:w})}),e.jsx(i,{sx:{flex:1,overflow:"auto",p:{xs:1,md:3},pt:{xs:2,md:3},minHeight:0},children:L(s)}),e.jsxs(i,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},justifyContent:{xs:"stretch",md:s===0?"flex-end":"space-between"},p:{xs:1,md:3},borderTop:"1px solid",borderColor:"divider",gap:{xs:1,md:2},backgroundColor:"background.surface",flexShrink:0,position:{xs:"sticky",md:"static"},bottom:0,zIndex:1e4},children:[e.jsx(M,{variant:"solid",endDecorator:e.jsx(ln,{}),onClick:V,loading:v,disabled:!N(s)||v,size:"lg",sx:{width:{xs:"100%",md:"auto"},minHeight:"48px",order:{xs:1,md:2},fontWeight:600},children:s===Ft.length-1?"Approve and pay":"Next"}),s>0&&e.jsx(M,{variant:"outlined",startDecorator:e.jsx(an,{}),onClick:_,size:"lg",sx:{width:{xs:"100%",md:"auto"},minHeight:"48px",order:{xs:2,md:1}},children:"Back"})]})]})]})]})}):null}const le={sizes:{small:"0.875rem",xlarge:"1.5rem"}},_e={fontSize:le.sizes.small},Bn=()=>{const{isMobile:r}=Pe(),[t,n]=h.useState([]),[l,s]=h.useState(!1),[c,a]=h.useState(""),[o,u]=h.useState(""),[p,b]=h.useState(""),[g,y]=h.useState(""),[C,m]=h.useState(!1),[j,v]=h.useState(!1),[R,w]=h.useState(!1),[x,S]=h.useState(!1),[U,B]=h.useState(null),[V,_]=h.useState(!1),[I,N]=h.useState({date:new Date().toISOString().split("T")[0],status:"Draft",customer_name:"",customer_email:""}),[L,F]=h.useState(!1),[E,f]=h.useState(""),[$,Z]=h.useState("success"),A=(k,ee="success")=>{f(k),Z(ee),F(!0)},H=k=>{switch(k){case"Draft":return"neutral";case"Paid":return"success";case"Refunded":return"warning";case"Cancelled":return"danger";default:return"neutral"}},oe=k=>{switch(k){case"Draft":return e.jsx(ot,{});case"Paid":return e.jsx(As,{});case"Refunded":return e.jsx(As,{});case"Cancelled":return e.jsx(ot,{});default:return e.jsx(ot,{})}},he=async()=>{s(!0);try{const{data:k,error:ee}=await T.from("Orders").select("*");if(ee){console.error("Error fetching orders:",ee),A("Failed to fetch orders","danger");return}if(k){const ce=k.map(K=>({uuid:K.uuid,date:K.date||K.created_at||K["Created at"]||"",status:K.status||"Paid",customer:K.customer||{initial:K.customer_initial||(K.customer_name?K.customer_name[0]:"?"),name:K.customer_name||"Unknown",email:K.customer_email||""},order_number_display:K.order_number_display,order_total:typeof K.order_total=="number"?K.order_total:0,created_by:K.created_by||"",created_by_name:K.created_by_name||"",created_by_email:K.created_by_email||"",category:K.category||"purchase"})).sort((K,me)=>{const pt=new Date(K.date||0);return new Date(me.date||0).getTime()-pt.getTime()});n(ce)}}catch(k){console.error("Error fetching orders:",k),A("Failed to fetch orders","danger")}finally{s(!1)}},Se=async k=>{try{const{data:ee,error:ce}=await T.from("OrderItems").select("*, Products:product_uuid(ProductName)").eq("order_uuid",k);return ce?(console.error("Error fetching order items:",ce),[]):ee?.map(K=>({...K,product_name:K.Products?.ProductName||K.product_uuid}))||[]}catch(ee){return console.error("Error fetching order items:",ee),[]}};h.useEffect(()=>{he()},[]);const xe=t.filter(k=>{const ee=!c||k.order_number_display?.toString().toLowerCase().includes(c.toLowerCase())||k.customer.name.toLowerCase().includes(c.toLowerCase())||k.customer.email.toLowerCase().includes(c.toLowerCase()),ce=!o||k.status===o,K=!p||k.category===p,me=!g||k.customer.name===g;return ee&&ce&&K&&me}),P=Array.from(new Set(t.map(k=>k.status))),O=Array.from(new Set(t.map(k=>k.category||"purchase"))),Q=Array.from(new Set(t.map(k=>k.customer.name))),pe=k=>{const ee=t.find(ce=>ce.uuid===k||ce.order_number_display===k);ee&&(B(ee),w(!0))},Oe=k=>{B(k),S(!0)},D=()=>{v(!0)},Y=async(k,ee)=>{_(!0);try{const ce=k.reduce((et,tt)=>et+tt.quantity*tt.unitprice*(1-tt.discount/100),0)-ee,K=Tn({date:I.date,status:I.status,customer_name:I.customer_name,customer_email:I.customer_email,order_total:ce}),{data:me,error:pt}=await T.from("Orders").insert(K).select().single();if(pt){console.error("Error creating order:",pt),A("Failed to create order","danger");return}if(k.length>0){const et=k.map(mt=>Ln({order_uuid:me.uuid,product_uuid:mt.product_uuid,quantity:mt.quantity,unitprice:mt.unitprice,discount:mt.discount,price:0}));console.log("Inserting order items:",et);const{error:tt}=await T.from("OrderItems").insert(et);tt?(console.error("Error creating order items:",tt),console.error("Order items data that failed:",et),A("Order created but failed to add items","warning")):console.log("Order items created successfully")}A("Order created successfully","success"),v(!1),N({date:new Date().toISOString().split("T")[0],status:"Paid",customer_name:"",customer_email:""}),he()}catch(ce){console.error("Error creating order:",ce),A("Failed to create order","danger")}finally{_(!1)}},fe=()=>{m(!1)},Ne=()=>{u(""),b(""),y("")},z=()=>e.jsxs(i,{sx:{pb:2},children:[e.jsxs(Ce,{variant:"page",padding:"medium",children:[e.jsxs(i,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(q,{placeholder:"Search orders...",value:c,onChange:k=>a(k.target.value),startDecorator:e.jsx(ke,{}),sx:{flex:1,fontSize:"16px"}}),e.jsx(de,{variant:"soft",onClick:()=>m(!0),sx:{flexShrink:0},children:e.jsx(os,{})})]}),(o||p||g)&&e.jsxs(i,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:[o&&e.jsxs(ie,{size:"sm",variant:"soft",color:"primary",children:["Status: ",o]}),p&&e.jsxs(ie,{size:"sm",variant:"soft",color:"primary",children:["Category: ",p]}),g&&e.jsxs(ie,{size:"sm",variant:"soft",color:"primary",children:["Customer: ",g]})]}),l&&e.jsx(Me,{sx:{mb:2}})]}),e.jsx(i,{children:xe.length===0?e.jsx(i,{sx:{textAlign:"center",py:6},children:e.jsx(d,{color:"neutral",children:l?"Loading orders...":"No orders found"})}):xe.map(k=>e.jsxs(i,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider"},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(i,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${H(k.status)}.100`,color:`${H(k.status)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",flexShrink:0},children:oe(k.status)}),e.jsxs(i,{sx:{flex:1,minWidth:0},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsxs(d,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:["Order #",k.order_number_display||k.uuid.substring(0,8)]}),e.jsx(ie,{size:"sm",color:H(k.status),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content"},children:k.status})]}),e.jsxs(d,{level:"body-xs",color:"neutral",sx:{mb:.5},children:[k.customer.name," • ",new Date(k.date).toLocaleDateString()]}),k.order_total&&e.jsx(d,{level:"body-xs",sx:{fontWeight:"bold",color:"primary.600"},children:ze(k.order_total)})]})]}),e.jsxs(i,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[e.jsx(M,{size:"sm",variant:"soft",onClick:()=>pe(k.uuid),children:"View"}),k.status==="Draft"&&e.jsx(M,{size:"sm",variant:"solid",color:"primary",onClick:()=>Oe(k),startDecorator:e.jsx(Os,{}),children:"Checkout"})]})]},k.uuid))}),e.jsx(de,{color:"primary",variant:"soft",size:"sm",sx:{position:"fixed",bottom:80,right:16,zIndex:1e3,borderRadius:"8px",width:40,height:40,boxShadow:"sm",bgcolor:"primary.100","&:hover":{bgcolor:"primary.200",boxShadow:"md"}},onClick:D,children:e.jsx(be,{fontSize:"small"})})]}),te=()=>e.jsxs(Ce,{variant:"table-page",children:[e.jsx(d,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Orders"}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(q,{placeholder:"Search orders...",sx:{flex:1,fontSize:le.sizes.small},value:c,onChange:k=>a(k.target.value),startDecorator:e.jsx(ke,{})}),e.jsxs(je,{placeholder:"Filter status",value:o,onChange:(k,ee)=>u(ee||""),sx:{minWidth:160,fontSize:le.sizes.small},children:[e.jsx(W,{value:"",children:"All Statuses"}),P.map(k=>e.jsx(W,{value:k,children:k},k))]}),e.jsx(M,{variant:"solid",startDecorator:e.jsx(be,{}),onClick:D,sx:{fontSize:le.sizes.small},children:"Create Order"})]}),e.jsxs(ue,{sx:{overflow:"visible"},children:[l&&e.jsx(Me,{}),e.jsxs(Ue,{"aria-label":"Orders",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:_e,children:"Order #"}),e.jsx("th",{style:_e,children:"Date"}),e.jsx("th",{style:_e,children:"Customer"}),e.jsx("th",{style:_e,children:"Status"}),e.jsx("th",{style:_e,children:"Total"}),e.jsx("th",{style:_e,children:"Actions"})]})}),e.jsxs("tbody",{children:[xe.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{textAlign:"center",color:"#888",..._e},children:l?"Loading orders...":"No orders found."})}),xe.map(k=>e.jsxs("tr",{style:{cursor:"pointer"},children:[e.jsx("td",{style:_e,children:k.order_number_display||k.uuid.substring(0,8)}),e.jsx("td",{style:_e,children:new Date(k.date).toLocaleDateString()}),e.jsx("td",{style:_e,children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(i,{sx:{width:24,height:24,borderRadius:"50%",bgcolor:"primary.100",color:"primary.600",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold"},children:k.customer.initial}),e.jsxs(i,{children:[e.jsx(d,{level:"body-sm",sx:{fontWeight:"bold"},children:k.customer.name}),e.jsx(d,{level:"body-xs",color:"neutral",children:k.customer.email})]})]})}),e.jsx("td",{style:_e,children:e.jsx(ie,{size:"sm",variant:"soft",color:H(k.status),children:k.status})}),e.jsx("td",{style:_e,children:e.jsx(d,{level:"body-sm",sx:{fontWeight:"bold"},children:k.order_total?ze(k.order_total):"N/A"})}),e.jsx("td",{style:_e,children:e.jsxs(i,{sx:{display:"flex",gap:1},children:[e.jsx(M,{size:"sm",variant:"soft",onClick:()=>pe(k.uuid),children:"View"}),k.status==="Draft"&&e.jsx(M,{size:"sm",variant:"solid",color:"primary",onClick:()=>Oe(k),startDecorator:e.jsx(Os,{}),children:"Checkout"})]})})]},k.uuid))]})]})]})]});return e.jsxs(Fe,{children:[r?e.jsx(z,{}):e.jsx(te,{}),e.jsx(En,{open:j,creating:V,newOrder:I,setNewOrder:N,onClose:()=>v(!1),onCreate:Y}),e.jsx(Nn,{open:R,onClose:()=>w(!1),selectedOrder:U,fetchOrderItems:Se}),e.jsx(Un,{open:x,onClose:()=>S(!1),order:U?{uuid:U.uuid,order_number_display:U.order_number_display,order_total:U.order_total,customer_name:U.customer.name,customer_email:U.customer.email}:null,onSuccess:()=>{S(!1),he(),A("Order completed successfully!","success")}}),r&&e.jsx(Ot,{open:C,onClose:fe,title:"Filter Orders",size:"medium",actions:e.jsxs(i,{sx:{display:"flex",gap:2},children:[e.jsx(M,{variant:"plain",onClick:Ne,sx:_e,children:"Clear All"}),e.jsx(M,{variant:"solid",onClick:fe,sx:_e,children:"Apply"})]}),children:e.jsxs(G,{spacing:2,children:[e.jsxs(X,{children:[e.jsx(J,{children:"Status"}),e.jsxs(je,{placeholder:"All statuses",value:o,onChange:(k,ee)=>u(ee||""),children:[e.jsx(W,{value:"",children:"All Statuses"}),P.map(k=>e.jsx(W,{value:k,children:k},k))]})]}),e.jsxs(X,{children:[e.jsx(J,{children:"Category"}),e.jsxs(je,{placeholder:"All categories",value:p,onChange:(k,ee)=>b(ee||""),children:[e.jsx(W,{value:"",children:"All Categories"}),O.map(k=>e.jsx(W,{value:k,children:k},k))]})]}),e.jsxs(X,{children:[e.jsx(J,{children:"Customer"}),e.jsxs(je,{placeholder:"All customers",value:g,onChange:(k,ee)=>y(ee||""),children:[e.jsx(W,{value:"",children:"All Customers"}),Q.map(k=>e.jsx(W,{value:k,children:k},k))]})]})]})}),e.jsx(Tt,{open:L,onClose:()=>F(!1),autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{top:16,zIndex:2e3},children:e.jsx(ht,{color:$,variant:"solid",sx:{width:"100%"},children:E})})]})};function Hn({open:r,onClose:t,product:n,onSave:l}){const[s,c]=h.useState({ProductName:n?.ProductName||"",SalesPrice:n?.SalesPrice?.toString()||"",CostPrice:n?.CostPrice?.toString()||"",image_url:n?.image_url||"",min_stock:n?.min_stock?.toString()||"",max_stock:n?.max_stock?.toString()||"",reorder_amount:n?.reorder_amount?.toString()||""}),[a,o]=h.useState(!1),[u,p]=h.useState(!1),b=h.useRef(null);h.useEffect(()=>{c({ProductName:n?.ProductName||"",SalesPrice:n?.SalesPrice?.toString()||"",CostPrice:n?.CostPrice?.toString()||"",image_url:n?.image_url||"",min_stock:n?.min_stock?.toString()||"",max_stock:n?.max_stock?.toString()||"",reorder_amount:n?.reorder_amount?.toString()||""})},[n]);const g=async m=>{const j=m.target.files?.[0];if(j){if(!j.type.startsWith("image/")){alert("Please select a valid image file");return}if(j.size>5*1024*1024){alert("Image size must be less than 5MB");return}try{p(!0);const v=j.name.split(".").pop(),w=`products/${`product-${Date.now()}.${v}`}`,{data:x,error:S}=await T.storage.from("productimages").upload(w,j,{cacheControl:"3600",upsert:!0});if(S)throw new Error(`Upload failed: ${S.message}`);const{data:{publicUrl:U}}=T.storage.from("productimages").getPublicUrl(w);c(B=>({...B,image_url:U}))}catch(v){console.error("Image upload failed:",v),alert("Failed to upload image. Please try again.")}finally{p(!1),m.target&&(m.target.value="")}}},y=()=>{c(m=>({...m,image_url:""}))},C=async()=>{o(!0),await l(s),o(!1)};return e.jsx(Re,{open:r,onClose:t,"aria-labelledby":"product-table-form-title",children:e.jsxs(Ee,{sx:{minWidth:{xs:"90vw",sm:500}},children:[e.jsx(ss,{id:"product-table-form-title",children:n?"Edit Product":"Add Product"}),e.jsx(rs,{children:e.jsxs(G,{spacing:2,children:[e.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:1},children:[e.jsx(d,{level:"body-sm",sx:{alignSelf:"flex-start"},children:"Product Image"}),s.image_url?e.jsxs(i,{sx:{position:"relative"},children:[e.jsx(ge,{src:s.image_url,alt:"Product",variant:"soft",sx:{width:120,height:120,borderRadius:2,border:"2px solid",borderColor:"neutral.300"}}),e.jsx(de,{size:"sm",variant:"solid",color:"danger",onClick:y,sx:{position:"absolute",top:-8,right:-8,minHeight:24,minWidth:24},children:e.jsx(dt,{fontSize:"small"})})]}):e.jsx(i,{sx:{width:120,height:120,borderRadius:2,border:"2px dashed",borderColor:"neutral.300",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer","&:hover":{borderColor:"primary.500",backgroundColor:"primary.50"}},onClick:()=>b.current?.click(),children:e.jsx(ur,{sx:{fontSize:32,color:"neutral.400"}})}),e.jsx("input",{ref:b,type:"file",accept:"image/*",onChange:g,style:{display:"none"}}),e.jsxs(G,{direction:"row",spacing:1,children:[e.jsx(M,{size:"sm",variant:"outlined",onClick:()=>b.current?.click(),loading:u,disabled:u,children:s.image_url?"Change Image":"Upload Image"}),s.image_url&&e.jsx(M,{size:"sm",variant:"plain",color:"danger",onClick:y,children:"Remove"})]})]}),e.jsx(q,{name:"ProductName",value:s.ProductName,onChange:m=>c({...s,ProductName:m.target.value}),placeholder:"Product Name"}),e.jsx(q,{name:"SalesPrice",value:s.SalesPrice,onChange:m=>c({...s,SalesPrice:m.target.value}),placeholder:"Sales Price",type:"number"}),e.jsx(q,{name:"CostPrice",value:s.CostPrice,onChange:m=>c({...s,CostPrice:m.target.value}),placeholder:"Cost Price",type:"number"}),e.jsxs(i,{sx:{mt:3,mb:2},children:[e.jsxs(d,{level:"title-md",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(hr,{}),"Inventory Management"]}),e.jsxs(G,{spacing:2,children:[e.jsx(q,{name:"min_stock",value:s.min_stock,onChange:m=>c({...s,min_stock:m.target.value}),placeholder:"Minimum Stock Level",type:"number",startDecorator:e.jsx(d,{level:"body-sm",children:"Min:"})}),e.jsx(q,{name:"max_stock",value:s.max_stock,onChange:m=>c({...s,max_stock:m.target.value}),placeholder:"Maximum Stock Level",type:"number",startDecorator:e.jsx(d,{level:"body-sm",children:"Max:"})}),e.jsx(q,{name:"reorder_amount",value:s.reorder_amount,onChange:m=>c({...s,reorder_amount:m.target.value}),placeholder:"Reorder Amount",type:"number",startDecorator:e.jsx(d,{level:"body-sm",children:"Reorder:"})})]})]})]})}),e.jsxs(ns,{children:[e.jsx(M,{onClick:t,variant:"plain",disabled:a||u,children:"Cancel"}),e.jsx(M,{onClick:C,variant:"solid",loading:a,disabled:a||u,children:"Save"})]})]})})}const $s=hs(Hn),ve={fontSize:le.sizes.small},Vn=()=>{const{isMobile:r}=Pe(),[t,n]=h.useState([]),[l,s]=h.useState({}),[c,a]=h.useState(!1),[o,u]=h.useState(!1),[p,b]=h.useState(!1),[g,y]=h.useState(""),[C,m]=h.useState(""),[j,v]=h.useState(!1),[R,w]=h.useState(!1),[x,S]=h.useState(!1),[U,B]=h.useState(null),[V,_]=h.useState(!1),[I,N]=h.useState(""),[L,F]=h.useState("success"),E=(D,Y="success")=>{N(D),F(Y),_(!0)},f=D=>D<=0?{status:"Out of Stock",color:"danger"}:D<=10?{status:"Low Stock",color:"warning"}:{status:"In Stock",color:"success"},$=D=>{const Y=f(D);return e.jsx(i,{sx:{width:20,height:20,borderRadius:"50%",bgcolor:`${Y.color}.100`,color:`${Y.color}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold"},children:e.jsx(hr,{sx:{fontSize:"12px"}})})},Z=async()=>{a(!0);try{const{data:D,error:Y}=await T.from("Products").select("*").order("CreatedAt",{ascending:!1});if(Y){console.error("Error fetching products:",Y),E("Failed to fetch products","danger");return}D&&(n(D),await A(D))}catch(D){console.error("Error fetching products:",D),E("Failed to fetch products","danger")}finally{a(!1)}},A=async D=>{u(!0);try{const{data:Y,error:fe}=await T.from("stock_movements").select("product_id, movement_type, quantity");if(fe){console.error("Error fetching stock data:",fe);return}if(Y){const Ne={};D.forEach(z=>{const k=Y.filter(ee=>ee.product_id===z.uuid).reduce((ee,ce)=>{switch(ce.movement_type){case"incoming":case"adjustment":return ee+(ce.quantity||0);case"outgoing":return ee-(ce.quantity||0);default:return ee}},0);Ne[z.uuid]=k}),s(Ne)}}catch(Y){console.error("Error fetching stock levels:",Y)}finally{u(!1)}};h.useEffect(()=>{Z()},[]);const H=t.filter(D=>{const Y=!g||D.ProductName.toLowerCase().includes(g.toLowerCase())||D.ProductID?.toLowerCase().includes(g.toLowerCase()),fe=l[D.uuid]||0,Ne=!C||C==="in-stock"&&fe>10||C==="low-stock"&&fe>0&&fe<=10||C==="out-of-stock"&&fe<=0;return Y&&Ne}),oe=()=>{w(!0)},he=D=>{B(D),S(!0)},Se=async D=>{if(confirm("Are you sure you want to delete this product?")){b(!0);try{const{error:Y}=await T.from("Products").delete().eq("uuid",D);if(Y){console.error("Error deleting product:",Y),E("Failed to delete product","danger");return}n(t.filter(fe=>fe.uuid!==D)),E("Product deleted successfully","success")}catch(Y){console.error("Error deleting product:",Y),E("Failed to delete product","danger")}finally{b(!1)}}},xe=async D=>{b(!0);try{const Y=Ns({ProductName:D.ProductName,SalesPrice:parseFloat(D.SalesPrice),CostPrice:parseFloat(D.CostPrice),image_url:D.image_url||null,min_stock:D.min_stock?parseInt(D.min_stock):null,max_stock:D.max_stock?parseInt(D.max_stock):null,reorder_amount:D.reorder_amount?parseInt(D.reorder_amount):null,CreatedAt:new Date().toISOString()}),{data:fe,error:Ne}=await T.from("Products").insert([Y]).select().single();if(Ne){console.error("Error adding product:",Ne),E("Failed to add product","danger");return}E("Product added successfully","success"),w(!1),Z()}catch(Y){console.error("Error adding product:",Y),E("Failed to add product","danger")}finally{b(!1)}},P=async D=>{if(U){b(!0);try{const Y=Ns({ProductName:D.ProductName,SalesPrice:parseFloat(D.SalesPrice),CostPrice:parseFloat(D.CostPrice),image_url:D.image_url||null,min_stock:D.min_stock?parseInt(D.min_stock):null,max_stock:D.max_stock?parseInt(D.max_stock):null,reorder_amount:D.reorder_amount?parseInt(D.reorder_amount):null}),{error:fe}=await T.from("Products").update(Y).eq("uuid",U.uuid);if(fe){console.error("Error updating product:",fe),E("Failed to update product","danger");return}E("Product updated successfully","success"),S(!1),B(null),Z()}catch(Y){console.error("Error updating product:",Y),E("Failed to update product","danger")}finally{b(!1)}}},O=()=>{v(!1)},Q=()=>{m("")},pe=()=>e.jsxs(i,{sx:{pb:2},children:[e.jsxs(Ce,{variant:"page",padding:"medium",children:[e.jsxs(i,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(q,{placeholder:"Search products...",value:g,onChange:D=>y(D.target.value),startDecorator:e.jsx(ke,{}),sx:{flex:1,fontSize:"16px"}}),e.jsx(de,{variant:"soft",onClick:()=>v(!0),sx:{flexShrink:0},children:e.jsx(os,{})})]}),C&&e.jsx(i,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:e.jsxs(ie,{size:"sm",variant:"soft",color:"primary",children:["Stock: ",C.replace("-"," ")]})}),c&&e.jsx(Me,{sx:{mb:2}})]}),e.jsx(i,{children:H.length===0?e.jsx(i,{sx:{textAlign:"center",py:6},children:e.jsx(d,{color:"neutral",children:c?"Loading products...":"No products found"})}):H.map(D=>e.jsx(i,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(i,{sx:{flexShrink:0},children:D.image_url?e.jsx(ge,{src:D.image_url,sx:{width:48,height:48},alt:D.ProductName}):e.jsx(ge,{sx:{width:48,height:48,bgcolor:"neutral.100"},children:e.jsx(Rs,{})})}),e.jsxs(i,{sx:{flex:1,minWidth:0},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(d,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:D.ProductName}),e.jsx(i,{sx:{display:"flex",alignItems:"center",gap:1},children:o?e.jsx(d,{level:"body-xs",color:"neutral",children:"..."}):e.jsxs(e.Fragment,{children:[$(l[D.uuid]||0),e.jsx(ie,{size:"sm",color:f(l[D.uuid]||0).color,variant:"soft",sx:{fontSize:"10px",minWidth:"fit-content"},children:l[D.uuid]||0})]})})]}),e.jsxs(d,{level:"body-xs",color:"neutral",sx:{mb:.5},children:["ID: ",D.ProductID||"N/A"," • ",new Date(D.CreatedAt).toLocaleDateString()]}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(i,{children:[e.jsxs(d,{level:"body-xs",sx:{fontWeight:"bold",color:"success.600"},children:["Sale: ",ze(D.SalesPrice)]}),e.jsxs(d,{level:"body-xs",color:"neutral",children:["Cost: ",ze(D.CostPrice)]})]}),e.jsxs(i,{sx:{display:"flex",gap:.5},children:[e.jsx(de,{size:"sm",variant:"soft",color:"primary",onClick:()=>he(D),children:e.jsx(ut,{})}),e.jsx(de,{size:"sm",variant:"soft",color:"danger",onClick:()=>Se(D.uuid),disabled:p,children:e.jsx(dt,{})})]})]})]})]})},D.uuid))}),e.jsx(de,{color:"primary",variant:"soft",size:"sm",sx:{position:"fixed",bottom:80,right:16,zIndex:1e3,borderRadius:"8px",width:40,height:40,boxShadow:"sm",bgcolor:"primary.100","&:hover":{bgcolor:"primary.200",boxShadow:"md"}},onClick:oe,children:e.jsx(be,{fontSize:"small"})})]}),Oe=()=>e.jsxs(Ce,{variant:"table-page",children:[e.jsx(d,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Products"}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(q,{placeholder:"Search products...",sx:{flex:1,fontSize:le.sizes.small},value:g,onChange:D=>y(D.target.value),startDecorator:e.jsx(ke,{})}),e.jsxs(je,{placeholder:"Filter by stock",value:C,onChange:(D,Y)=>m(Y||""),sx:{minWidth:160,fontSize:le.sizes.small},children:[e.jsx(W,{value:"",children:"All Stock Levels"}),e.jsx(W,{value:"in-stock",children:"In Stock"}),e.jsx(W,{value:"low-stock",children:"Low Stock"}),e.jsx(W,{value:"out-of-stock",children:"Out of Stock"})]}),e.jsx(M,{variant:"solid",startDecorator:e.jsx(be,{}),onClick:oe,sx:{fontSize:le.sizes.small},children:"Add Product"})]}),e.jsxs(ue,{sx:{overflow:"visible"},children:[c&&e.jsx(Me,{}),e.jsxs(Ue,{"aria-label":"Products",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:ve,children:"Image"}),e.jsx("th",{style:ve,children:"Name"}),e.jsx("th",{style:ve,children:"Stock"}),e.jsx("th",{style:ve,children:"Sales Price"}),e.jsx("th",{style:ve,children:"Cost Price"}),e.jsx("th",{style:ve,children:"Created"}),e.jsx("th",{style:ve,children:"Actions"})]})}),e.jsxs("tbody",{children:[H.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...ve},children:c?"Loading products...":"No products found."})}),H.map(D=>e.jsxs("tr",{children:[e.jsx("td",{style:ve,children:D.image_url?e.jsx(ge,{src:D.image_url,sx:{width:32,height:32},alt:D.ProductName}):e.jsx(ge,{sx:{width:32,height:32,bgcolor:"neutral.100"},children:e.jsx(Rs,{sx:{fontSize:"16px"}})})}),e.jsx("td",{style:ve,children:e.jsxs(i,{children:[e.jsx(d,{level:"body-sm",sx:{fontWeight:"bold"},children:D.ProductName}),e.jsxs(d,{level:"body-xs",color:"neutral",children:["ID: ",D.ProductID||"N/A"]})]})}),e.jsx("td",{style:ve,children:o?e.jsx(d,{level:"body-sm",sx:{color:"neutral.500"},children:"Loading..."}):e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ie,{size:"sm",variant:"soft",color:f(l[D.uuid]||0).color,children:f(l[D.uuid]||0).status}),e.jsx(Yt,{title:`Current stock level: ${l[D.uuid]||0} units`,arrow:!0,children:e.jsx(d,{level:"body-sm",sx:{fontWeight:"bold",color:f(l[D.uuid]||0).color==="danger"?"danger.500":f(l[D.uuid]||0).color==="warning"?"warning.600":"success.600"},children:l[D.uuid]||0})}),e.jsx(i,{sx:{width:40,height:4,bgcolor:"neutral.200",borderRadius:2,overflow:"hidden"},children:e.jsx(i,{sx:{width:`${Math.min(100,Math.max(0,(l[D.uuid]||0)/50*100))}%`,height:"100%",bgcolor:f(l[D.uuid]||0).color==="danger"?"danger.400":f(l[D.uuid]||0).color==="warning"?"warning.400":"success.400",borderRadius:2}})})]})}),e.jsx("td",{style:ve,children:e.jsx(d,{level:"body-sm",sx:{fontWeight:"bold",color:"success.600"},children:ze(D.SalesPrice)})}),e.jsx("td",{style:ve,children:e.jsx(d,{level:"body-sm",color:"neutral",children:ze(D.CostPrice)})}),e.jsx("td",{style:ve,children:new Date(D.CreatedAt).toLocaleDateString()}),e.jsx("td",{style:ve,children:e.jsxs(i,{sx:{display:"flex",gap:.5},children:[e.jsx(de,{size:"sm",variant:"soft",color:"primary",onClick:()=>he(D),children:e.jsx(ut,{})}),e.jsx(de,{size:"sm",variant:"soft",color:"danger",onClick:()=>Se(D.uuid),disabled:p,children:e.jsx(dt,{})})]})})]},D.uuid))]})]})]})]});return e.jsxs(Fe,{children:[r?e.jsx(pe,{}):e.jsx(Oe,{}),e.jsx($s,{open:R,onClose:()=>w(!1),product:null,onSave:xe}),e.jsx($s,{open:x,onClose:()=>{S(!1),B(null)},product:U,onSave:P}),r&&e.jsx(Ot,{open:j,onClose:O,title:"Filter Products",size:"medium",actions:e.jsxs(i,{sx:{display:"flex",gap:2},children:[e.jsx(M,{variant:"plain",onClick:Q,sx:ve,children:"Clear All"}),e.jsx(M,{variant:"solid",onClick:O,sx:ve,children:"Apply"})]}),children:e.jsx(G,{spacing:2,children:e.jsxs(X,{children:[e.jsx(J,{children:"Stock Level"}),e.jsxs(je,{placeholder:"All stock levels",value:C,onChange:(D,Y)=>m(Y||""),children:[e.jsx(W,{value:"",children:"All Stock Levels"}),e.jsx(W,{value:"in-stock",children:"In Stock"}),e.jsx(W,{value:"low-stock",children:"Low Stock"}),e.jsx(W,{value:"out-of-stock",children:"Out of Stock"})]})]})})}),e.jsx(Tt,{open:V,onClose:()=>_(!1),autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{top:16,zIndex:2e3},children:e.jsx(ht,{color:L,variant:"solid",sx:{width:"100%"},children:I})})]})},Ge={fontSize:le.sizes.small},Ze={...Ge,fontWeight:600,borderBottom:"1.5px solid #e0e0e0",background:"inherit"},Ws=r=>{switch(r?.toLowerCase()){case"admin":return"danger";case"manager":return"warning";case"user":return"primary";case"staff":return"success";default:return"neutral"}},Fs=(r,t)=>{const n=r||t;let l=0;for(let c=0;c<n.length;c++)l=n.charCodeAt(c)+((l<<5)-l);const s=["primary","success","warning","danger","neutral"];return s[Math.abs(l)%s.length]},Us=(r,t)=>{if(r){const n=r.split(" ");return n.length>=2?(n[0][0]+n[1][0]).toUpperCase():r.substring(0,2).toUpperCase()}return t.substring(0,2).toUpperCase()};function Gn(){return e.jsxs(Lr,{children:[e.jsx(Mr,{slots:{root:de},slotProps:{root:{variant:"plain",color:"neutral",size:"sm"}},children:e.jsx(cn,{})}),e.jsxs(Nr,{size:"sm",sx:{minWidth:140},children:[e.jsx(gt,{children:"Edit"}),e.jsx(gt,{children:"Reset Password"}),e.jsx(gt,{children:"Disable"}),e.jsx(gt,{color:"danger",children:"Delete"})]})]})}const Qn=()=>{const{isMobile:r}=Pe(),[t,n]=h.useState([]),[l,s]=h.useState(!1),[c,a]=h.useState(null),[o,u]=h.useState(""),[p,b]=h.useState("all"),[g,y]=h.useState(!1),C=async()=>{s(!0),a(null);try{const{data:x,error:S}=await T.from("users").select("*");if(S)throw S;if(x){const U=x.map(B=>({id:B.id,name:B.name||null,email:B.email,role:B.role||null,created_at:B.created_at||null,last_login:B.last_login||null,phone:B.phone||null}));n(U)}}catch(x){console.error("Error fetching users:",x),a(x.message||"Failed to fetch users")}finally{s(!1)}},m=Array.from(new Set(t.map(x=>x.role).filter(Boolean))),v=[...t.filter(x=>{const S=x.name?.toLowerCase().includes(o.toLowerCase())||x.email.toLowerCase().includes(o.toLowerCase()),U=p==="all"||x.role===p;return S&&U})].sort((x,S)=>{const U=x.name||x.email,B=S.name||S.email;return U.localeCompare(B)});h.useEffect(()=>{C()},[]);const R=()=>e.jsxs(i,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(Ce,{padding:"medium",children:[e.jsx(d,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Users"}),e.jsxs(i,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(q,{placeholder:"Search users...",value:o,onChange:x=>u(x.target.value),startDecorator:e.jsx(ke,{}),sx:{flex:1}}),e.jsxs(je,{placeholder:"Role",value:p,onChange:(x,S)=>b(S??"all"),sx:{minWidth:120},children:[e.jsx(W,{value:"all",children:"All"}),m.map(x=>e.jsx(W,{value:x,children:x},x))]})]}),e.jsx(M,{variant:"solid",startDecorator:e.jsx(be,{}),onClick:()=>y(!0),sx:{width:"100%",mb:2},children:"Create User"})]}),l&&e.jsx(Me,{}),c&&e.jsx(i,{sx:{p:2},children:e.jsxs(d,{color:"danger",children:["Error: ",c]})}),e.jsx(i,{children:v.length===0?e.jsx(i,{sx:{textAlign:"center",py:6},children:e.jsx(d,{color:"neutral",children:"No users found"})}):v.map(x=>e.jsx(i,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ge,{size:"md",color:Fs(x.name,x.email),sx:{flexShrink:0},children:Us(x.name,x.email)}),e.jsxs(i,{sx:{flex:1,minWidth:0},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(d,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:x.name||"Unnamed User"}),x.role&&e.jsx(ie,{size:"sm",color:Ws(x.role),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content",textTransform:"capitalize"},children:x.role})]}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(It,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsx(d,{level:"body-xs",color:"neutral",children:x.email})]}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:.5},children:[x.phone&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Pt,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsx(d,{level:"body-xs",color:"neutral",children:x.phone})]}),x.last_login&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(dr,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsx(d,{level:"body-xs",color:"neutral",children:new Date(x.last_login).toLocaleDateString()})]})]}),x.created_at&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(on,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsxs(d,{level:"body-xs",color:"neutral",children:["Joined ",new Date(x.created_at).toLocaleDateString()]})]})]})]})},x.id))})]}),w=()=>e.jsxs(Ce,{variant:"table-page",children:[e.jsx(d,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Users"}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(q,{placeholder:"Search users...",sx:{flex:1},value:o,onChange:x=>u(x.target.value),startDecorator:e.jsx(ke,{})}),e.jsxs(je,{placeholder:"Filter role",value:p,onChange:(x,S)=>b(S??"all"),sx:{minWidth:160},children:[e.jsx(W,{value:"all",children:"All Roles"}),m.map(x=>e.jsx(W,{value:x,children:x},x))]}),e.jsx(M,{onClick:()=>y(!0),variant:"solid",startDecorator:e.jsx(be,{}),children:"Create User"})]}),e.jsxs(ue,{sx:{overflow:"visible"},children:[l&&e.jsx(Me,{}),c&&e.jsxs(d,{color:"danger",children:["Error: ",c]}),e.jsxs(Ue,{"aria-label":"Users",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:Ze,children:"Name"}),e.jsx("th",{style:Ze,children:"Email"}),e.jsx("th",{style:Ze,children:"Role"}),e.jsx("th",{style:Ze,children:"Created At"}),e.jsx("th",{style:Ze,children:"Last Login"}),e.jsx("th",{style:Ze,children:"Phone"}),e.jsx("th",{style:{width:120,...Ze},children:"Actions"})]})}),e.jsxs("tbody",{children:[v.length===0&&!l&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...Ge},children:"No users found."})}),v.map(x=>e.jsxs("tr",{style:{cursor:"pointer",height:48},children:[e.jsx("td",{style:Ge,children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ge,{size:"sm",color:Fs(x.name,x.email),children:Us(x.name,x.email)}),e.jsx(d,{level:"body-sm",fontWeight:"md",children:x.name||"Unnamed User"})]})}),e.jsx("td",{style:Ge,children:x.email}),e.jsx("td",{style:Ge,children:x.role?e.jsx(ie,{size:"sm",color:Ws(x.role),variant:"soft",sx:{textTransform:"capitalize"},children:x.role}):"-"}),e.jsx("td",{style:Ge,children:x.created_at?new Date(x.created_at).toLocaleDateString():"-"}),e.jsx("td",{style:Ge,children:x.last_login?new Date(x.last_login).toLocaleDateString():"-"}),e.jsx("td",{style:Ge,children:x.phone||"-"}),e.jsx("td",{children:e.jsx(Gn,{})})]},x.id))]})]})]})]});return e.jsxs(Fe,{children:[r?e.jsx(R,{}):e.jsx(w,{}),e.jsx(Re,{open:g,onClose:()=>y(!1),"aria-labelledby":"create-user-modal",children:e.jsxs(Ee,{"aria-labelledby":"create-user-modal",sx:{maxWidth:600,width:"100%"},children:[e.jsx(qe,{}),e.jsx(d,{id:"create-user-modal",level:"title-md",fontWeight:"lg",sx:{mb:2},children:"Create User"}),e.jsx(d,{level:"body-sm",sx:{mb:2},children:"User creation functionality will be implemented here."}),e.jsx(M,{onClick:()=>y(!1),variant:"outlined",children:"Close"})]})})]})};function Zn({orderId:r,editable:t,onItemsChange:n,initialItems:l=[]}){const[s,c]=h.useState(l),[a,o]=h.useState([]),[u,p]=h.useState(!1);h.useEffect(()=>{p(!0),T.from("Products").select("uuid, ProductName").then(({data:m,error:j})=>{j?console.error("Failed to fetch products:",j.message):o(m||[]),p(!1)})},[]);const b=(m,j,v)=>{c(R=>{const w=R.map((x,S)=>S===m?{...x,[j]:v}:x);return n&&n(w),w})},g=()=>{c(m=>{const j=[...m,{product_id:null,quantity_ordered:1,unit_price:0}];return n&&n(j),j})},y=m=>{c(j=>{const v=j.filter((R,w)=>w!==m);return n&&n(v),v})},C=()=>s.reduce((m,j)=>m+j.quantity_ordered*j.unit_price,0);return e.jsxs(i,{sx:{mt:0},children:[e.jsxs(i,{sx:{display:{xs:"block",md:"none"}},children:[s.length===0?e.jsx(d,{color:"neutral",textAlign:"center",sx:{py:4},children:"No items added yet"}):s.map((m,j)=>e.jsxs(i,{sx:{mb:2,p:2,border:"1px solid",borderColor:"divider",borderRadius:"md"},children:[e.jsxs(i,{sx:{mb:2},children:[e.jsx(d,{level:"body-sm",sx:{mb:1},children:"Product:"}),e.jsx(_t,{options:a,getOptionLabel:v=>v.ProductName,value:a.find(v=>v.uuid===m.product_id)||null,onChange:(v,R)=>b(j,"product_id",R?R.uuid:null),disabled:!t,sx:{width:"100%"},isOptionEqualToValue:(v,R)=>v.uuid===R.uuid,required:!0})]}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:2},children:[e.jsxs(i,{sx:{flex:1},children:[e.jsx(d,{level:"body-sm",sx:{mb:1},children:"Quantity:"}),e.jsx(q,{type:"number",value:m.quantity_ordered??1,onChange:v=>b(j,"quantity_ordered",Math.max(1,Number(v.target.value))),disabled:!t,sx:{width:"100%"},required:!0})]}),e.jsxs(i,{sx:{flex:1},children:[e.jsx(d,{level:"body-sm",sx:{mb:1},children:"Unit Price:"}),e.jsx(q,{type:"number",value:m.unit_price??0,onChange:v=>b(j,"unit_price",Math.max(0,Number(v.target.value))),disabled:!t,sx:{width:"100%"},required:!0})]})]}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(i,{children:[e.jsx(d,{level:"body-sm",color:"neutral",children:"Total:"}),e.jsx(d,{level:"title-sm",children:ae(m.quantity_ordered*m.unit_price)})]}),t&&e.jsx(M,{size:"sm",color:"danger",onClick:()=>y(j),children:"Remove"})]})]},j)),s.length>0&&e.jsx(i,{sx:{mt:2,p:2,backgroundColor:"background.level1",borderRadius:"md",border:"1px solid",borderColor:"divider"},children:e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(d,{level:"title-sm",sx:{fontWeight:600},children:"Total:"}),e.jsx(d,{level:"title-sm",sx:{fontWeight:600,color:"primary.main"},children:ae(C())})]})}),t&&e.jsx(M,{size:"sm",variant:"soft",onClick:g,sx:{mt:1},fullWidth:!0,children:"Add Item"})]}),e.jsxs(i,{sx:{display:{xs:"none",md:"block"}},children:[e.jsxs(Ue,{size:"sm",sx:{minWidth:500,"& th":{padding:"12px 8px",fontSize:"0.875rem",fontWeight:600,borderBottom:"2px solid",borderColor:"divider"},"& td":{padding:"8px",verticalAlign:"middle"}},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"40%"},children:"Product"}),e.jsx("th",{style:{width:"15%",textAlign:"center"},children:"Qty"}),e.jsx("th",{style:{width:"20%",textAlign:"center"},children:"Unit Price"}),e.jsx("th",{style:{width:"15%",textAlign:"right"},children:"Total"}),t&&e.jsx("th",{style:{width:"10%",textAlign:"center"}})]})}),e.jsx("tbody",{children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:t?5:4,style:{textAlign:"center",padding:"2rem",color:"#888"},children:"No items added yet"})}):s.map((m,j)=>e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"8px"},children:e.jsx(_t,{options:a,getOptionLabel:v=>v.ProductName,value:a.find(v=>v.uuid===m.product_id)||null,onChange:(v,R)=>b(j,"product_id",R?R.uuid:null),disabled:!t,sx:{width:"100%"},isOptionEqualToValue:(v,R)=>v.uuid===R.uuid,required:!0})}),e.jsx("td",{style:{padding:"8px",textAlign:"center"},children:e.jsx(q,{type:"number",value:m.quantity_ordered??1,onChange:v=>b(j,"quantity_ordered",Math.max(1,Number(v.target.value))),disabled:!t,sx:{width:"100%",maxWidth:100},required:!0})}),e.jsx("td",{style:{padding:"8px",textAlign:"center"},children:e.jsx(q,{type:"number",value:m.unit_price??0,onChange:v=>b(j,"unit_price",Math.max(0,Number(v.target.value))),disabled:!t,sx:{width:"100%",maxWidth:120},required:!0})}),e.jsx("td",{style:{padding:"8px",textAlign:"right",fontWeight:500},children:ae(m.quantity_ordered*m.unit_price)}),t&&e.jsx("td",{style:{padding:"8px",textAlign:"center"},children:e.jsx(M,{size:"sm",color:"danger",onClick:()=>y(j),children:"Remove"})})]},j))})]}),t&&e.jsx(M,{size:"sm",variant:"soft",onClick:g,sx:{mt:2},children:"Add Item"})]})]})}const Ut=["Pending","Approved","Received","Cancelled"];function kt({open:r,onClose:t,onCreated:n,mode:l="add",order:s}){const[c,a]=h.useState(s?.order_number||""),[o,u]=h.useState(s?.order_date||new Date().toISOString().slice(0,10)),[p,b]=h.useState(s?.status||"Pending"),[g,y]=h.useState(s?.total?String(s.total):""),[C,m]=h.useState(s?.notes||""),[j,v]=h.useState(s?.supplier_id||null),[R,w]=h.useState(!1),[x,S]=h.useState(null),[U,B]=h.useState([]),[V,_]=h.useState(""),[I,N]=h.useState(!1),[L,F]=h.useState([{product_id:null,quantity_ordered:1,unit_price:0}]);h.useRef(null),h.useEffect(()=>{r?(console.log("[PurchaseOrderForm] Modal opened"),T.from("Suppliers").select("id, name").then(({data:A})=>{B(A||[])}),(l==="edit"||l==="view")&&s?.id?T.from("purchaseorderitems").select("*").eq("purchase_order_id",s.id).then(({data:A})=>{F(A||[])}):l==="add"&&F([{product_id:null,quantity_ordered:1,unit_price:0}])):console.log("[PurchaseOrderForm] Modal closed")},[r,l,s]),h.useEffect(()=>{r&&s?(a(s.order_number||""),u(s.order_date||new Date().toISOString().slice(0,10)),b(s.status||"Pending"),y(s.total?String(s.total):""),m(s.notes||""),v(s.supplier_id||null)):r&&l==="add"&&(a(""),u(new Date().toISOString().slice(0,10)),b("Pending"),y(""),m(""),v(null),_(""))},[r,s,l]);const E=async A=>{console.log("[PurchaseOrderForm] handleSupplierAdded called");const{data:H}=await T.from("Suppliers").select("id, name");B(H||[]),A&&(v(String(A)),console.log("[PurchaseOrderForm] New supplier set:",A)),N(!1),console.log("[PurchaseOrderForm] SupplierForm closed")},f=()=>{const A=new Date().toISOString().slice(0,10).replace(/-/g,""),H=Math.floor(1e3+Math.random()*9e3);return`PO-${A}-${H}`},$=()=>L.reduce((A,H)=>A+H.quantity_ordered*H.unit_price,0);h.useEffect(()=>{const A=$();y(A.toString())},[L]);const Z=async()=>{console.log("[PurchaseOrderForm] handleSave called"),w(!0),S(null);const A={order_date:o,status:p,notes:C,supplier_id:j,total:g?parseFloat(g):null};l==="edit"?A.order_number=c:l==="add"&&(A.order_number=f());let H,oe=s?.id;if(l==="add"?(H=await T.from("PurchaseOrders").insert([A]).select(),!H.error&&H.data&&H.data[0]&&(oe=H.data[0].id)):s&&(H=await T.from("PurchaseOrders").update(A).eq("id",s.id)),H&&!H.error&&l==="add"&&oe&&L.length>0){const he=L.filter(xe=>xe.product_id).map(xe=>Mn({purchase_order_id:oe,product_id:xe.product_id,quantity_ordered:xe.quantity_ordered,unit_price:xe.unit_price,notes:xe.notes||null}));if(he.length===0){S("Please select a product for each item before saving."),w(!1);return}const Se=await T.from("purchaseorderitems").insert(he);if(Se.error){S("Failed to save items: "+Se.error.message),w(!1);return}}w(!1),H?.error?(S(H.error.message),console.log("[PurchaseOrderForm] Save error:",H.error.message)):(n(),t(),a(""),u(new Date().toISOString().slice(0,10)),b("Pending"),y(""),m(""),v(null),_(""),console.log("[PurchaseOrderForm] Purchase order saved and modal closed"))};return e.jsx(Re,{open:r,onClose:t,"aria-labelledby":"purchase-order-form-title",children:e.jsxs(Ee,{size:"lg",sx:{width:{xs:"100vw",md:"90vw"},maxWidth:{xs:"none",md:1200},height:{xs:"100vh",md:"90vh"},maxHeight:{xs:"none",md:800},overflow:"hidden",display:"flex",flexDirection:"column",m:0,borderRadius:{xs:0,md:"md"},p:0},children:[e.jsxs(i,{sx:{display:{xs:"none",md:"flex"},justifyContent:"space-between",alignItems:"center",p:2,borderBottom:"1px solid",borderColor:"divider"},children:[e.jsxs(d,{id:"purchase-order-form-title",level:"title-md",children:[l==="edit"?"Edit":l==="view"?"View":"Add"," Purchase Order"]}),e.jsx(qe,{})]}),e.jsxs(i,{sx:{display:{xs:"flex",md:"none"},justifyContent:"space-between",alignItems:"center",p:2,borderBottom:"1px solid",borderColor:"divider"},children:[e.jsxs(d,{id:"purchase-order-form-title",level:"title-md",children:[l==="edit"?"Edit":l==="view"?"View":"Add"," Purchase Order"]}),e.jsx(qe,{})]}),e.jsxs(i,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},height:"100%",overflow:"hidden"},children:[e.jsxs(i,{sx:{width:{xs:"100%",md:"400px"},borderRight:{xs:"none",md:"1px solid"},borderBottom:{xs:"1px solid",md:"none"},borderColor:"divider",p:3,overflow:"auto",flexShrink:0},children:[e.jsx(d,{level:"title-sm",sx:{mb:2},children:"Order Information"}),e.jsxs("form",{onSubmit:A=>{A.preventDefault(),l!=="view"&&Z()},children:[e.jsx(q,{type:"date",value:o,onChange:A=>u(A.target.value),sx:{mb:2},required:!0,readOnly:l==="view",startDecorator:e.jsx(d,{level:"body-sm",sx:{minWidth:80},children:"Date:"})}),(l==="edit"||l==="view")&&e.jsxs(i,{sx:{mb:2},children:[e.jsx(d,{level:"body-sm",sx:{mb:1},children:"Status:"}),e.jsx(ie,{variant:"soft",color:p==="Approved"?"success":p==="Received"?"primary":p==="Cancelled"?"danger":"neutral",sx:{textTransform:"capitalize",fontWeight:600,fontSize:"md",px:1.5,py:.5},onClick:l==="view"?void 0:()=>{const A=Ut.indexOf(p);b(Ut[(A+1)%Ut.length])},children:p})]}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(d,{level:"body-sm",sx:{mb:1},children:"Supplier:"}),e.jsxs(i,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(_t,{options:U,getOptionLabel:A=>A.name,value:U.find(A=>A.id===j)||null,onChange:(A,H)=>v(H?H.id:null),inputValue:V,onInputChange:(A,H)=>_(H),placeholder:"Select supplier",sx:{flex:1,mb:0},isOptionEqualToValue:(A,H)=>A.id===H.id,required:!0,readOnly:l==="view"}),l!=="view"&&e.jsx(de,{color:"primary",sx:{ml:1},onClick:()=>N(!0),children:e.jsx(be,{})})]})]}),(l==="edit"||l==="view")&&e.jsxs(e.Fragment,{children:[e.jsx(q,{placeholder:"Order Number",value:c,onChange:A=>a(A.target.value),sx:{mb:2},readOnly:l==="view",startDecorator:e.jsx(d,{level:"body-sm",sx:{minWidth:80},children:"Number:"})}),e.jsx(q,{placeholder:"Total",value:g,onChange:A=>y(A.target.value),sx:{mb:2},type:"number",readOnly:!0,startDecorator:e.jsx(d,{level:"body-sm",sx:{minWidth:80},children:"Total:"})})]}),e.jsx(q,{placeholder:"Notes",value:C,onChange:A=>m(A.target.value),sx:{mb:2},readOnly:l==="view",startDecorator:e.jsx(d,{level:"body-sm",sx:{minWidth:80},children:"Notes:"})}),l!=="view"&&e.jsxs(i,{sx:{mt:3},children:[x&&e.jsx(d,{color:"danger",sx:{mb:2},children:x}),e.jsx(M,{type:"submit",loading:R,disabled:R,variant:"solid",fullWidth:!0,children:"Save Purchase Order"})]})]}),e.jsx(xs,{open:I,onClose:()=>N(!1),onSaved:E,mode:"add"})]}),e.jsxs(i,{sx:{flex:1,display:"flex",flexDirection:"column",minHeight:0,overflow:"hidden"},children:[e.jsx(i,{sx:{p:1,borderBottom:"0px solid",borderColor:"divider",flexShrink:0},children:e.jsx(d,{level:"title-sm",children:"Order Items"})}),e.jsx(i,{sx:{flex:1,overflow:"auto",p:2,paddingBottom:0},children:e.jsx(Zn,{orderId:s?.id,editable:l==="add"||l==="edit",onItemsChange:F,initialItems:L})}),e.jsx(i,{sx:{borderTop:"1px solid",borderColor:"divider",p:3,flexShrink:0,backgroundColor:"background.level1"},children:e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",maxWidth:{xs:"100%",md:"400px"},ml:"auto"},children:[e.jsx(d,{level:"title-md",sx:{fontWeight:600},children:"Total:"}),e.jsx(d,{level:"title-md",sx:{fontWeight:600,color:"primary.main"},children:ae($())})]})})]})]})]})})}function xs({open:r,onClose:t,onSaved:n,mode:l="add",supplier:s,onDelete:c,onEdit:a}){const[o,u]=h.useState(s?.name||""),[p,b]=h.useState(s?.contact_name||""),[g,y]=h.useState(s?.email||""),[C,m]=h.useState(s?.phone||""),[j,v]=h.useState(s?.address||""),[R,w]=h.useState(s?.image_url||""),[x,S]=h.useState(!1),[U,B]=h.useState(!1),[V,_]=h.useState(null),I=h.useRef(null),[N,L]=h.useState([]),[F,E]=h.useState(!1),[f,$]=h.useState(null),[Z,A]=h.useState(!1);h.useEffect(()=>{r&&(l==="edit"||l==="view")&&s?(u(s.name||""),b(s.contact_name||""),y(s.email||""),m(s.phone||""),v(s.address||""),w(s.image_url||""),l==="view"&&H()):r&&l==="add"&&(u(""),b(""),y(""),m(""),v(""),w(""))},[r,l,s]);const H=async()=>{if(s?.id){E(!0),$(null);try{const{data:O,error:Q}=await T.from("PurchaseOrders").select("id, order_number, order_date, status, total, notes").eq("supplier_id",s.id).order("order_date",{ascending:!1});if(Q)throw Q;O&&L(O)}catch(O){console.error("Error fetching purchase orders:",O),$(O.message||"Failed to fetch purchase orders")}finally{E(!1)}}},oe=()=>{A(!1),l==="view"&&H()},he=async O=>{const Q=O.target.files?.[0];if(Q){if(!Q.type.startsWith("image/")){_("Please select a valid image file");return}if(Q.size>5*1024*1024){_("Image size must be less than 5MB");return}try{B(!0),_(null);const pe=Q.name.split(".").pop(),Oe=`${Date.now()}-${Math.random().toString(36).substring(2)}.${pe}`,{data:D,error:Y}=await T.storage.from("supplierimages").upload(Oe,Q);if(Y)throw Y;const{data:{publicUrl:fe}}=T.storage.from("supplierimages").getPublicUrl(Oe);w(fe)}catch(pe){console.error("Error uploading image:",pe),_(pe.message||"Failed to upload image")}finally{B(!1)}}},Se=async()=>{if(R)try{B(!0);const O=R.split("/").pop();O&&await T.storage.from("supplierimages").remove([O]),w("")}catch(O){console.error("Error removing image:",O),_(O.message||"Failed to remove image")}finally{B(!1)}},xe=async()=>{if(!o.trim()||!g.trim()){_("Name and email are required");return}try{S(!0),_(null);const O={name:o.trim(),contact_name:p.trim()||null,email:g.trim(),phone:C.trim()||null,address:j.trim()||null,image_url:R||null};if(l==="edit"&&s?.id){const{error:Q}=await T.from("Suppliers").update(O).eq("id",s.id);if(Q)throw Q}else{const{data:Q,error:pe}=await T.from("Suppliers").insert([O]).select();if(pe)throw pe;Q?.[0]&&n(Q[0].id)}n(),t()}catch(O){console.error("Error saving supplier:",O),_(O.message||"Failed to save supplier")}finally{S(!1)}},P=async()=>{if(!(!s?.id||!c)&&confirm("Are you sure you want to delete this supplier?"))try{const{error:O}=await T.from("Suppliers").delete().eq("id",s.id);if(O)throw O;c(s.id),t()}catch(O){_(O.message||"Failed to delete supplier")}};return e.jsxs(e.Fragment,{children:[e.jsx(Re,{open:r,onClose:t,children:e.jsxs(Ee,{sx:{minWidth:l==="view"?{xs:"90vw",sm:"80vw",md:"1000px"}:400,maxWidth:l==="view"?{xs:"95vw",sm:"90vw",md:"1200px"}:500,minHeight:l==="view"?"70vh":"auto",maxHeight:"90vh",overflow:"hidden"},children:[e.jsx(qe,{}),e.jsxs(d,{level:"title-md",sx:{mb:2},children:[l==="view"?"Supplier Details":l==="edit"?"Edit":"Add",l!=="view"?" Supplier":""]}),l==="view"?e.jsxs(i,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:3,height:"100%",overflow:"hidden"},children:[e.jsxs(i,{sx:{flex:1,display:"flex",flexDirection:"column",gap:3,minWidth:{xs:"100%",md:"340px"},maxWidth:{xs:"100%",md:"420px"},borderRight:{md:"1px solid"},borderColor:"divider",pr:{md:3}},children:[e.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[e.jsx(ge,{size:"lg",src:R,sx:{width:80,height:80},children:!R&&o&&o.substring(0,2).toUpperCase()}),e.jsx(d,{level:"h3",textAlign:"center",children:o})]}),e.jsxs(ue,{variant:"soft",children:[e.jsx(d,{level:"h4",sx:{mb:0},children:"Company"}),e.jsx(Te,{sx:{mb:0}}),e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(d,{level:"body-md",children:[e.jsx("strong",{children:"Name:"})," ",o]}),e.jsxs(d,{level:"body-md",children:[e.jsx("strong",{children:"Address:"})," ",j||"N/A"]})]})]}),e.jsxs(ue,{variant:"soft",children:[e.jsx(d,{level:"h4",sx:{mb:0},children:"Contact"}),e.jsx(Te,{sx:{mb:0}}),e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(d,{level:"body-md",children:[e.jsx("strong",{children:"Contact Name:"})," ",p||"N/A"]}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:1},children:[e.jsxs(d,{level:"body-md",sx:{flex:1,minWidth:0},children:[e.jsx("strong",{children:"Email:"})," ",g||"N/A"]}),g&&e.jsx(M,{size:"sm",variant:"outlined",startDecorator:e.jsx(It,{}),onClick:()=>window.open(`mailto:${g}`,"_self"),sx:{flexShrink:0},children:"Email"})]}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:1},children:[e.jsxs(d,{level:"body-md",sx:{flex:1,minWidth:0},children:[e.jsx("strong",{children:"Phone:"})," ",C||"N/A"]}),C&&e.jsx(M,{size:"sm",variant:"outlined",startDecorator:e.jsx(Pt,{}),onClick:()=>window.open(`tel:${C}`,"_self"),sx:{flexShrink:0},children:"Call"})]})]})]}),e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2,mt:"auto"},children:[e.jsx(M,{variant:"solid",startDecorator:e.jsx(be,{}),onClick:()=>A(!0),sx:{width:"100%"},children:"Add Purchase Order"}),e.jsx(M,{variant:"outlined",startDecorator:e.jsx(ut,{}),onClick:a,sx:{width:"100%"},children:"Edit Supplier"})]})]}),e.jsxs(i,{sx:{flex:2,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(d,{level:"h3",sx:{mb:2},children:"Purchase Orders"}),F&&e.jsx(d,{children:"Loading purchase orders..."}),f&&e.jsxs(d,{color:"danger",children:["Error: ",f]}),e.jsx(i,{sx:{flex:1,overflow:"auto"},children:e.jsxs(Ue,{stickyHeader:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Order #"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Notes"})]})}),e.jsxs("tbody",{children:[N.map(O=>e.jsxs("tr",{children:[e.jsx("td",{children:O.order_number}),e.jsx("td",{children:O.order_date}),e.jsx("td",{children:O.status}),e.jsx("td",{children:O.total!=null?ae(O.total):"—"}),e.jsx("td",{children:O.notes||""})]},O.id)),N.length===0&&!F&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{textAlign:"center",color:"#888"},children:"No purchase orders for this supplier."})})]})]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:3,gap:2},children:[e.jsx(d,{level:"body-sm",children:"Supplier Avatar"}),e.jsxs(i,{sx:{position:"relative"},children:[e.jsx(ge,{size:"lg",src:R,sx:{width:80,height:80},children:!R&&o&&o.substring(0,2).toUpperCase()}),R&&e.jsx(de,{size:"sm",variant:"solid",color:"danger",sx:{position:"absolute",top:-8,right:-8,width:24,height:24},onClick:Se,children:e.jsx(xr,{sx:{fontSize:14}})})]}),e.jsxs(i,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx("input",{type:"file",accept:"image/*",onChange:he,style:{display:"none"},ref:I,disabled:U}),e.jsx(M,{variant:"outlined",size:"sm",loading:U,onClick:()=>I.current?.click(),startDecorator:e.jsx(ur,{}),children:R?"Change Image":"Upload Image"})]}),e.jsx(d,{level:"body-xs",color:"neutral",sx:{textAlign:"center"},children:"Max 5MB (JPG, PNG, GIF)"})]}),e.jsxs("form",{onSubmit:O=>{O.preventDefault(),O.stopPropagation(),xe()},children:[e.jsx(q,{placeholder:"Name",value:o,onChange:O=>u(O.target.value),sx:{mb:2},required:!0}),e.jsx(q,{placeholder:"Contact Name",value:p,onChange:O=>b(O.target.value),sx:{mb:2}}),e.jsx(q,{placeholder:"Email",value:g,onChange:O=>y(O.target.value),sx:{mb:2},type:"email",required:!0}),e.jsx(q,{placeholder:"Phone",value:C,onChange:O=>m(O.target.value),sx:{mb:2},type:"tel"}),e.jsx(q,{placeholder:"Address",value:j,onChange:O=>v(O.target.value),sx:{mb:2}}),V&&e.jsx(d,{color:"danger",sx:{mb:1},children:V}),e.jsxs(i,{sx:{display:"flex",gap:1,justifyContent:"space-between"},children:[e.jsx(M,{type:"submit",loading:x,disabled:x,variant:"solid",sx:{flex:1},children:l==="edit"?"Update":"Save"}),l==="edit"&&s?.id&&c&&e.jsx(M,{variant:"outlined",color:"danger",startDecorator:e.jsx(dt,{}),onClick:P,disabled:x,children:"Delete"})]})]})]})]})}),e.jsx(kt,{open:Z,onClose:()=>A(!1),onCreated:oe,mode:"add",order:s?.id?{id:"",order_number:"",order_date:"",status:"",total:0,notes:"",supplier_id:s.id.toString()}:void 0})]})}const Bs=r=>{let t=0;for(let l=0;l<r.length;l++)t=r.charCodeAt(l)+((t<<5)-t);const n=["primary","success","warning","danger","neutral"];return n[Math.abs(t)%n.length]},Hs=r=>{const t=r.split(" ");return t.length>=2?(t[0][0]+t[1][0]).toUpperCase():r.substring(0,2).toUpperCase()},Yn=()=>{const{isMobile:r}=Pe(),[t,n]=h.useState([]),[l,s]=h.useState(!1),[c,a]=h.useState(null),[o,u]=h.useState(""),[p,b]=h.useState(!1),[g,y]=h.useState(null),[C,m]=h.useState("view"),j=async()=>{s(!0),a(null);try{const{data:_,error:I}=await T.from("Suppliers").select("*");if(I)throw I;_&&n(_)}catch(_){console.error("Error fetching suppliers:",_),a(_.message||"Failed to fetch suppliers")}finally{s(!1)}},v=_=>{y(_),m("view"),b(!0)},R=()=>{m("edit")},w=async _=>{await j()},x=async()=>{b(!1),await j()},U=[...t.filter(_=>_.name?.toLowerCase().includes(o.toLowerCase())||_.contact_name?.toLowerCase().includes(o.toLowerCase())||_.email?.toLowerCase().includes(o.toLowerCase())||_.phone?.toLowerCase().includes(o.toLowerCase())||_.address?.toLowerCase().includes(o.toLowerCase()))].sort((_,I)=>_.name.localeCompare(I.name));h.useEffect(()=>{j()},[]);const B=()=>e.jsxs(i,{sx:{pb:2},children:[e.jsxs(Ce,{padding:"medium",children:[e.jsx(d,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Suppliers"}),e.jsx(i,{sx:{display:"flex",gap:1,mb:2},children:e.jsx(q,{placeholder:"Search suppliers...",value:o,onChange:_=>u(_.target.value),startDecorator:e.jsx(ke,{}),sx:{flex:1}})}),e.jsx(M,{variant:"solid",startDecorator:e.jsx(be,{}),onClick:()=>{y(null),m("add"),b(!0)},sx:{width:"100%",mb:2},children:"Add Supplier"})]}),l&&e.jsx(Me,{}),c&&e.jsx(i,{sx:{p:2},children:e.jsxs(d,{color:"danger",children:["Error: ",c]})}),e.jsx(i,{children:U.length===0?e.jsx(i,{sx:{textAlign:"center",py:6},children:e.jsx(d,{color:"neutral",children:"No suppliers found"})}):U.map(_=>e.jsx(ue,{variant:"outlined",sx:{mx:2,mb:2,cursor:"pointer","&:hover":{boxShadow:"md",transform:"translateY(-2px)",transition:"all 0.2s ease-in-out"}},onClick:()=>v(_),children:e.jsx(Ae,{sx:{p:2},children:e.jsxs(i,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(ge,{size:"md",src:_.image_url,color:Bs(_.name),sx:{flexShrink:0},children:!_.image_url&&Hs(_.name)}),e.jsxs(i,{sx:{flex:1,minWidth:0},children:[e.jsx(i,{sx:{mb:1},children:e.jsx(d,{level:"title-md",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:_.name})}),e.jsxs(G,{spacing:.5,children:[_.contact_name&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(st,{sx:{fontSize:16,color:"text.tertiary"}}),e.jsx(d,{level:"body-sm",color:"neutral",children:_.contact_name})]}),_.email&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(It,{sx:{fontSize:16,color:"text.tertiary"}}),e.jsx(d,{level:"body-sm",color:"neutral",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:_.email})]}),_.phone&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Pt,{sx:{fontSize:16,color:"text.tertiary"}}),e.jsx(d,{level:"body-sm",color:"neutral",children:_.phone})]}),_.address&&e.jsxs(i,{sx:{display:"flex",alignItems:"flex-start",gap:1,mt:.5},children:[e.jsx(Es,{sx:{fontSize:16,color:"text.tertiary",mt:.25}}),e.jsx(d,{level:"body-sm",color:"neutral",sx:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.2},children:_.address})]})]})]})]})})},_.id))})]}),V=()=>e.jsxs(Ce,{variant:"table-page",children:[e.jsx(d,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Suppliers"}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:2,alignItems:"center"},children:[e.jsx(q,{placeholder:"Search suppliers...",value:o,onChange:_=>u(_.target.value),startDecorator:e.jsx(ke,{}),sx:{flex:1}}),e.jsx(M,{variant:"solid",startDecorator:e.jsx(be,{}),onClick:()=>{y(null),m("add"),b(!0)},sx:{minWidth:140,flexShrink:0},children:"Add Supplier"})]}),l&&e.jsx(Me,{sx:{mb:2}}),c&&e.jsxs(d,{color:"danger",sx:{mb:2},children:["Error: ",c]}),e.jsx(ye,{container:!0,spacing:2,sx:{width:"calc(100% + 16px)",ml:"-8px",mt:"-8px"},children:U.length===0?e.jsx(ye,{xs:12,sx:{width:"100%"},children:e.jsx(i,{sx:{textAlign:"center",py:6},children:e.jsx(d,{color:"neutral",children:"No suppliers found"})})}):U.map(_=>e.jsx(ye,{xs:12,sm:6,lg:4,xl:3,sx:{display:"flex",width:"100%"},children:e.jsx(ue,{variant:"outlined",sx:{width:"100%",minHeight:"200px",cursor:"pointer",display:"flex",flexDirection:"column","&:hover":{boxShadow:"md",transform:"translateY(-2px)",transition:"all 0.2s ease-in-out"}},onClick:()=>v(_),children:e.jsxs(Ae,{sx:{flex:1,display:"flex",flexDirection:"column",p:2},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(ge,{size:"md",src:_.image_url,color:Bs(_.name),sx:{flexShrink:0},children:!_.image_url&&Hs(_.name)}),e.jsx(d,{level:"title-md",fontWeight:"bold",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1,minWidth:0},children:_.name})]}),e.jsxs(G,{spacing:1.5,sx:{flex:1},children:[_.contact_name&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(st,{sx:{fontSize:16,color:"text.tertiary",flexShrink:0}}),e.jsx(d,{level:"body-sm",color:"neutral",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1,minWidth:0},children:_.contact_name})]}),_.email&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(It,{sx:{fontSize:16,color:"text.tertiary",flexShrink:0}}),e.jsx(d,{level:"body-sm",color:"neutral",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1,minWidth:0},children:_.email})]}),_.phone&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(Pt,{sx:{fontSize:16,color:"text.tertiary",flexShrink:0}}),e.jsx(d,{level:"body-sm",color:"neutral",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1,minWidth:0},children:_.phone})]}),_.address&&e.jsxs(i,{sx:{display:"flex",alignItems:"flex-start",gap:1.5},children:[e.jsx(Es,{sx:{fontSize:16,color:"text.tertiary",flexShrink:0,mt:.25}}),e.jsx(d,{level:"body-sm",color:"neutral",sx:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.3,flex:1,minWidth:0},children:_.address})]})]})]})})},_.id))})]});return e.jsxs(Fe,{children:[r?e.jsx(B,{}):e.jsx(V,{}),e.jsx(xs,{open:p,onClose:()=>b(!1),supplier:g,onSaved:x,mode:C==="edit"||C==="add"||C==="view"?C:void 0,onDelete:C==="edit"?w:void 0,onEdit:R})]})};async function Jn(r,t){try{console.log("Receiving purchase order:",{purchaseOrderId:r,items:t});for(const s of t){const{error:c}=await T.from("purchaseorderitems").update({quantity_received:s.quantity_received}).eq("purchase_order_id",r).eq("product_id",s.product_id);if(c)throw console.error("Error updating purchase order item:",c),new Error(`Failed to update purchase order item: ${c.message}`)}const n=t.filter(s=>s.quantity_received>0).map(s=>({product_id:s.product_id,movement_type:"incoming",quantity:s.quantity_received,date:new Date().toISOString(),reason:"PO Receipt",referenceuuid:r}));if(n.length>0){const{error:s}=await T.from("stock_movements").insert(n);if(s)throw console.error("Error inserting stock movements:",s),new Error(`Failed to insert stock movements: ${s.message}`)}const{error:l}=await T.from("PurchaseOrders").update({status:"Received"}).eq("id",r);if(l)throw console.error("Error updating purchase order status:",l),new Error(`Failed to update purchase order status: ${l.message}`);console.log("Purchase order received successfully")}catch(n){throw console.error("Error receiving purchase order:",n),n}}const Xn=({open:r,onClose:t,poId:n,orderNumber:l,items:s,onConfirm:c})=>{const[a,o]=h.useState([]),[u,p]=h.useState(!0),[b,g]=h.useState(!1);h.useEffect(()=>{r&&(p(!0),o(s.map(m=>({id:m.id,product_id:m.product_id,ProductName:m.ProductName,quantity_ordered:m.quantity_ordered??0,quantity_received:m.quantity_received??m.quantity_ordered??0}))),p(!1))},[s,r]);const y=(m,j)=>{let v=0;if(j==="")v=0;else if(/^\d+$/.test(j))v=parseInt(j,10);else return;o(R=>R.map(w=>w.id===m?{...w,quantity_received:v}:w))},C=async()=>{try{const m=a.map(({product_id:j,quantity_received:v})=>({product_id:String(j),quantity_received:v}));await Jn(String(n),m),c(a.map(j=>({id:j.id,quantity_received:j.quantity_received}))),g(!0),t()}catch(m){console.error("Error receiving purchase order:",m),alert("Failed to receive purchase order. Please try again.")}};return e.jsxs(e.Fragment,{children:[e.jsx(Re,{open:r,onClose:t,"aria-labelledby":"receive-po-dialog-title",children:e.jsxs(Ee,{sx:{minWidth:400},children:[e.jsx(qe,{}),e.jsxs(d,{id:"receive-po-dialog-title",level:"h4",sx:{mb:2},children:["Receive Purchase Order #",l??n]}),u?e.jsx(d,{children:"Loading items..."}):a.length===0?e.jsx(d,{children:"No items found for this purchase order."}):e.jsxs(Ue,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Ordered"}),e.jsx("th",{children:"Received"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:a.map(m=>e.jsxs("tr",{children:[e.jsx("td",{children:m.ProductName}),e.jsx("td",{children:m.quantity_ordered}),e.jsx("td",{children:e.jsx(q,{type:"number",value:m.quantity_received===0&&a.find(j=>j.id===m.id)?.quantity_received===0?"0":m.quantity_received,onChange:j=>y(m.id,j.target.value),sx:{width:80},slotProps:{input:{min:0,max:m.quantity_ordered}}})}),e.jsx("td",{style:{textAlign:"center"},children:m.quantity_received===m.quantity_ordered?e.jsx(Lt,{sx:{color:"#2e7d32"},titleAccess:"Received in full"}):e.jsx(pr,{sx:{color:"#d32f2f"},titleAccess:"Not fully received"})})]},m.id))})]}),e.jsxs(i,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:3},children:[e.jsx(M,{variant:"plain",onClick:t,children:"Cancel"}),e.jsx(M,{variant:"solid",onClick:C,children:"Receive"})]})]})}),e.jsx(Tt,{open:b,autoHideDuration:3e3,onClose:()=>g(!1),color:"success",variant:"soft",anchorOrigin:{vertical:"top",horizontal:"center"},children:"Purchase order received successfully!"})]})},Vs={Pending:0,Ordered:1,Approved:2,Received:3,Cancelled:4},Qe={fontSize:le.sizes.small},Ye={...Qe,fontWeight:600,borderBottom:"1.5px solid #e0e0e0",background:"inherit"},jt=r=>{switch(r){case"Pending":return"warning";case"Ordered":return"primary";case"Approved":return"primary";case"Received":return"success";case"Cancelled":return"danger";default:return"neutral"}},Kn=r=>{switch(r){case"Pending":return e.jsx(Ts,{});case"Ordered":return e.jsx(ot,{});case"Approved":return e.jsx(ot,{});case"Received":return e.jsx(Lt,{});case"Cancelled":return e.jsx(pr,{});default:return e.jsx(Ts,{})}},el=()=>{const{isMobile:r}=Pe(),[t,n]=h.useState([]),[l,s]=h.useState(!1),[c,a]=h.useState(null),[o,u]=h.useState(""),[p,b]=h.useState(""),[g,y]=h.useState(!1),[C,m]=h.useState(!1),[j,v]=h.useState(!1),[R,w]=h.useState(!1),[x,S]=h.useState(null),[U,B]=h.useState([]),[V,_]=h.useState(!1),[I,N]=h.useState(null),L=async()=>{s(!0),a(null);try{const{data:P,error:O}=await T.from("PurchaseOrders").select(`
          id, 
          order_number, 
          order_date, 
          status, 
          total, 
          notes,
          supplier_id,
          Suppliers(name)
        `).order("order_date",{ascending:!1});if(O)throw O;if(P){const Q=P.map(pe=>({...pe,supplier_name:pe.Suppliers?.name||"N/A",Suppliers:void 0}));n(Q)}}catch(P){a(P.message||"Failed to fetch purchase orders")}finally{s(!1)}},F=async P=>{try{const{data:O,error:Q}=await T.from("purchaseorderitems").select("id, product_id, Products(ProductName), quantity_ordered, quantity_received").eq("purchase_order_id",P);if(Q)throw Q;if(O){const pe=O.map(Oe=>({...Oe,ProductName:Oe.Products?.ProductName||"Unknown Product"}));B(pe)}}catch(O){console.error("Error fetching PO items:",O)}},E=async()=>{await L()},f=async(P,O)=>{try{const{error:Q}=await T.from("PurchaseOrders").update({status:O}).eq("id",P);if(Q)throw Q;await L()}catch(Q){a(Q.message||"Failed to update order status")}},$=async P=>{S(P),await F(P.id),v(!0)},Z=async P=>{try{v(!1),S(null),await L()}catch(O){a(O.message||"Failed to receive order")}},A=async P=>{if(P)try{const{data:O,error:Q}=await T.from("Suppliers").select("*").eq("id",P).single();if(Q)throw Q;O&&(N(O),_(!0))}catch(O){console.error("Error fetching supplier:",O),a(O.message||"Failed to fetch supplier details")}},H=P=>{S(P),P.status==="Pending"?m(!0):w(!0)},he=[...t.filter(P=>{const O=P.order_number?.toString().toLowerCase().includes(o.toLowerCase())||P.supplier_name?.toLowerCase().includes(o.toLowerCase()),Q=p?P.status===p:!0;return O&&Q})].sort((P,O)=>{const Q=Vs[P.status]??99,pe=Vs[O.status]??99;return Q!==pe?Q-pe:new Date(O.order_date).getTime()-new Date(P.order_date).getTime()});h.useEffect(()=>{L()},[]);const Se=()=>e.jsxs(i,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(Ce,{padding:"medium",children:[e.jsx(d,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Purchase Orders"}),e.jsxs(i,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(q,{placeholder:"Search orders...",value:o,onChange:P=>u(P.target.value),startDecorator:e.jsx(ke,{}),sx:{flex:1}}),e.jsxs(je,{placeholder:"Status",value:p,onChange:(P,O)=>b(O??""),sx:{minWidth:120},children:[e.jsx(W,{value:"",children:"All"}),e.jsx(W,{value:"Pending",children:"Pending"}),e.jsx(W,{value:"Ordered",children:"Ordered"}),e.jsx(W,{value:"Approved",children:"Approved"}),e.jsx(W,{value:"Received",children:"Received"}),e.jsx(W,{value:"Cancelled",children:"Cancelled"})]})]}),e.jsx(M,{variant:"solid",startDecorator:e.jsx(be,{}),onClick:()=>y(!0),sx:{width:"100%",mb:2},children:"Add Purchase Order"})]}),l&&e.jsx(Me,{}),c&&e.jsx(i,{sx:{p:2},children:e.jsxs(d,{color:"danger",children:["Error: ",c]})}),e.jsx(i,{children:he.length===0?e.jsx(i,{sx:{textAlign:"center",py:6},children:e.jsx(d,{color:"neutral",children:"No purchase orders found"})}):he.map(P=>e.jsx(i,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},onClick:()=>H(P),title:P.status==="Pending"?"Tap to edit (pending orders are editable)":"Tap to view details",children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(i,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${jt(P.status)}.100`,color:`${jt(P.status)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",flexShrink:0},children:Kn(P.status)}),e.jsxs(i,{sx:{flex:1,minWidth:0},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(d,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:P.order_number?`Order #${P.order_number}`:e.jsx(d,{component:"span",sx:{color:"neutral.400",fontStyle:"italic"},children:"No order number"})}),e.jsx(ie,{size:"sm",color:jt(P.status),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content"},children:P.status})]}),e.jsxs(d,{level:"body-xs",color:"neutral",sx:{mb:.5},children:[e.jsx(d,{component:"span",sx:{cursor:P.supplier_id?"pointer":"default",color:P.supplier_id?"primary.600":"inherit",textDecoration:P.supplier_id?"underline":"none","&:hover":P.supplier_id?{color:"primary.800"}:{}},onClick:()=>P.supplier_id&&A(P.supplier_id),children:P.supplier_name})," • ",new Date(P.order_date).toLocaleDateString()]}),e.jsxs(d,{level:"body-sm",sx:{fontWeight:"bold",color:"text.primary"},children:["Total: ",ae(P.total||0)]}),e.jsx(i,{sx:{display:"flex",gap:1,mt:1},children:P.status==="Pending"?e.jsx(M,{size:"sm",variant:"outlined",onClick:()=>f(P.id,"Ordered"),children:"Order"}):e.jsx(M,{size:"sm",variant:"outlined",onClick:()=>$(P),disabled:P.status!=="Approved"&&P.status!=="Ordered",children:"Receive"})})]})]})},P.id))})]}),xe=()=>e.jsxs(Ce,{variant:"table-page",children:[e.jsx(d,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Purchase Orders"}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(q,{placeholder:"Search purchase orders...",sx:{flex:1},value:o,onChange:P=>u(P.target.value),startDecorator:e.jsx(ke,{})}),e.jsxs(je,{placeholder:"Filter status",value:p,onChange:(P,O)=>b(O??""),sx:{minWidth:160},children:[e.jsx(W,{value:"",children:"All Statuses"}),e.jsx(W,{value:"Pending",children:"Pending"}),e.jsx(W,{value:"Ordered",children:"Ordered"}),e.jsx(W,{value:"Approved",children:"Approved"}),e.jsx(W,{value:"Received",children:"Received"}),e.jsx(W,{value:"Cancelled",children:"Cancelled"})]}),e.jsx(M,{onClick:()=>y(!0),variant:"solid",startDecorator:e.jsx(be,{}),children:"Add Purchase Order"})]}),e.jsxs(ue,{sx:{overflow:"visible"},children:[l&&e.jsx(Me,{}),c&&e.jsxs(d,{color:"danger",children:["Error: ",c]}),e.jsxs(Ue,{"aria-label":"Purchase Orders",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:Ye,children:"Order Number"}),e.jsx("th",{style:Ye,children:"Order Date"}),e.jsx("th",{style:Ye,children:"Status"}),e.jsx("th",{style:Ye,children:"Total"}),e.jsx("th",{style:Ye,children:"Supplier"}),e.jsx("th",{style:Ye,children:"Notes"}),e.jsx("th",{style:{width:120,...Ye},children:"Actions"})]})}),e.jsxs("tbody",{children:[he.length===0&&!l&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...Qe},children:"No purchase orders found."})}),he.map(P=>e.jsxs("tr",{style:{cursor:"pointer",height:48},onClick:()=>H(P),title:P.status==="Pending"?"Click to edit (pending orders are editable)":"Click to view details",children:[e.jsx("td",{style:Qe,children:P.order_number||e.jsx(d,{component:"span",sx:{color:"neutral.400",fontStyle:"italic"},children:"No order number"})}),e.jsx("td",{style:Qe,children:new Date(P.order_date).toLocaleDateString()}),e.jsx("td",{style:Qe,children:e.jsx(ie,{size:"sm",color:jt(P.status),variant:"soft",children:P.status})}),e.jsx("td",{style:Qe,children:ae(P.total||0)}),e.jsx("td",{style:Qe,children:e.jsx(d,{component:"span",sx:{cursor:P.supplier_id?"pointer":"default",color:P.supplier_id?"primary.600":"inherit",textDecoration:P.supplier_id?"underline":"none",fontSize:le.sizes.small,"&:hover":P.supplier_id?{color:"primary.800"}:{}},onClick:()=>P.supplier_id&&A(P.supplier_id),children:P.supplier_name})}),e.jsx("td",{style:Qe,children:P.notes||"-"}),e.jsx("td",{children:P.status==="Pending"?e.jsx(M,{size:"sm",variant:"outlined",onClick:()=>f(P.id,"Ordered"),children:"Order"}):e.jsx(M,{size:"sm",variant:"outlined",onClick:()=>$(P),disabled:P.status!=="Approved"&&P.status!=="Ordered",children:"Receive"})})]},P.id))]})]})]})]});return e.jsxs(Fe,{children:[r?e.jsx(Se,{}):e.jsx(xe,{}),e.jsx(kt,{open:g,onClose:()=>y(!1),onCreated:E,mode:"add",order:void 0}),e.jsx(kt,{open:C,onClose:()=>{m(!1),S(null)},onCreated:E,mode:"edit",order:x?{id:x.id,order_number:x.order_number,order_date:x.order_date,status:x.status,total:x.total,notes:x.notes||"",supplier_id:x.supplier_id||""}:void 0}),e.jsx(kt,{open:R,onClose:()=>{w(!1),S(null)},onCreated:()=>{},mode:"view",order:x?{id:x.id,order_number:x.order_number,order_date:x.order_date,status:x.status,total:x.total,notes:x.notes||"",supplier_id:x.supplier_id||""}:void 0}),e.jsx(Xn,{open:j&&!!x?.id,onClose:()=>{v(!1),S(null)},poId:x?.id||"",orderNumber:x?.order_number||"",items:U.filter(P=>!!P.id&&!!P.product_id),onConfirm:Z}),e.jsx(xs,{open:V,onClose:()=>{_(!1),N(null)},supplier:I,onSaved:()=>{},mode:"view",onEdit:()=>{}})]})};function tl({value:r,onChange:t,toggleSidebar:n}){const l=ds(),[s,c]=h.useState(!1),[a,o]=h.useState("Sales");if(l.pathname==="/login")return null;const u=h.useMemo(()=>qr({components:{MuiTableRow:{styleOverrides:{root:{"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}}}}}}),[]);Pn.filter(g=>g.showInMobile);const p=a?St[a].filter(g=>g.showInMobile):[],b=async g=>{const{data:y}=await T.auth.getSession();if(!y&&["orders","products","users","suppliers","purchaseorders","tickets","smscampaigns","movements"].includes(g)){console.warn("Authentication required for this page"),t("home");return}t(g)};return e.jsxs($r,{theme:u,children:[e.jsxs(Wr,{open:s,onClose:()=>c(!1),children:[e.jsx(Fr,{children:"Select Area"}),e.jsx(Ur,{children:["Sales","Support","Marketing","Operations"].map(g=>e.jsx(Cs,{fullWidth:!0,variant:a===g?"contained":"outlined",onClick:()=>{o(g),c(!1)},sx:{my:1},children:g},g))}),e.jsx(Br,{children:e.jsx(Cs,{onClick:()=>c(!1),children:"Close"})})]}),e.jsx(Hr,{sx:{position:"fixed",bottom:0,left:0,right:0,zIndex:9999,backgroundColor:"rgba(0, 0, 255, 0.2)",overflow:"hidden"},children:e.jsx("div",{style:{display:"flex",flexDirection:"row",overflowX:"auto"},children:e.jsxs(Vr,{showLabels:!0,value:r,onChange:(g,y)=>{b(y)},sx:{minWidth:"max-content",flex:1},children:[p.map(g=>e.jsx(_s,{label:g.label,icon:g.icon,value:g.value,onClick:()=>b(g.value)},g.value)),e.jsx(_s,{label:a||"",icon:e.jsx(dn,{}),onClick:g=>{g.stopPropagation(),c(!0)}})]})})})]})}function Bt({open:r,onClose:t,onCreated:n}){const[l,s]=h.useState(""),[c,a]=h.useState(""),[o,u]=h.useState(!1),[p,b]=h.useState(null),g=async y=>{y.preventDefault(),u(!0),b(null);const C={subject:l,requester_name:c,status:"Open"};console.log("[DialogTicketCreate] Creating ticket with payload:",C);const{error:m,data:j}=await T.from("tickets").insert(C);m&&(b(m.message||JSON.stringify(m)),console.error("[DialogTicketCreate] Error creating ticket:",m)),u(!1),m||(s(""),a(""),t(),n&&n())};return e.jsx(Re,{open:r,onClose:t,children:e.jsxs(Ee,{sx:{minWidth:400},children:[e.jsx(d,{level:"title-md",sx:{mb:2},children:"Create Ticket"}),e.jsxs("form",{onSubmit:g,children:[e.jsx(q,{placeholder:"Subject",value:l,onChange:y=>s(y.target.value),sx:{mb:2},required:!0}),e.jsx(q,{placeholder:"Requester Name",value:c,onChange:y=>a(y.target.value),sx:{mb:2},required:!0}),p&&e.jsx(d,{color:"danger",sx:{mb:1},children:p}),e.jsx(M,{type:"submit",loading:o,disabled:o||!l||!c,variant:"solid",children:"Create"})]})]})})}const sl=["Refund issued","Replacement sent","Order cancelled","Technical support provided","Information provided","Awaiting customer response","Other"],rl=({open:r,onClose:t,onSubmit:n})=>{const[l,s]=se.useState(""),[c,a]=se.useState("");return se.useEffect(()=>{r||(s(""),a(""))},[r]),e.jsx(Re,{open:r,onClose:t,children:e.jsxs(Ee,{children:[e.jsx(ss,{children:"Resolve Ticket"}),e.jsxs(rs,{sx:{display:"flex",flexDirection:"column",gap:2,minWidth:320},children:[e.jsx(je,{value:l,onChange:(o,u)=>s(u||""),placeholder:"Select resolution",required:!0,children:sl.map(o=>e.jsx(W,{value:o,children:o},o))}),e.jsx(Jt,{minRows:3,placeholder:"Resolution comment to customer...",value:c,onChange:o=>a(o.target.value)})]}),e.jsxs(ns,{children:[e.jsx(M,{variant:"plain",onClick:t,children:"Cancel"}),e.jsx(M,{variant:"solid",color:"primary",disabled:!l,onClick:()=>{try{n(l,c),t()}catch(o){console.error("Error during form submission:",o)}},children:"Submit"})]})]})})},Ht=hs(rl),Gs=r=>{if(!r)return"";const t=new Date(r),l=Math.floor((new Date().getTime()-t.getTime())/1e3);if(l<60)return"Just now";const s=Math.floor(l/60);if(s<60)return`${s} min ago`;const c=Math.floor(s/60);if(c<24)return`${c} hour${c>1?"s":""} ago`;const a=Math.floor(c/24);if(a<7)return`${a} day${a>1?"s":""} ago`;const o=Math.floor(a/7);if(o<4)return`${o} week${o>1?"s":""} ago`;const u=Math.floor(a/30);return`${u} month${u>1?"s":""} ago`},rt={Open:{color:"success",label:"Open"},Pending:{color:"warning",label:"Pending"},Closed:{color:"neutral",label:"Closed"}};function nl(){const{isMobile:r}=Pe(),[t,n]=h.useState([]),[l,s]=h.useState(null),[c,a]=h.useState([]),[o,u]=h.useState(""),[p,b]=h.useState(""),[g,y]=h.useState("Open"),[C,m]=h.useState(!1),[j,v]=h.useState(!1),[R,w]=h.useState(!1);h.useEffect(()=>{(async()=>{const{data:N,error:L}=await T.from("tickets").select("*").order("created_at",{ascending:!1});L||n(N||[])})()},[]),h.useEffect(()=>{if(!l){a([]);return}(async()=>{const{data:N,error:L}=await T.from("ticketactivities").select("*").eq("ticket_id",l).order("timestamp",{ascending:!0});L||a(N||[])})()},[l]);const x=async()=>{const{data:I,error:N}=await T.from("tickets").select("*").order("created_at",{ascending:!1});N||n(I||[])},S=async()=>{if(o.trim()&&l){console.log("Sending message:",{ticket_id:l,message:o,activity_type:"chat",sender_name:"You"});const{error:I,data:N}=await T.from("ticketactivities").insert({ticket_id:l,message:o,activity_type:"chat",sender_name:"You"}).select();if(I){console.error("Error sending message:",I),alert("Failed to send message: "+I.message);return}console.log("Message sent successfully:",N),u("");const{data:L,error:F}=await T.from("ticketactivities").select("*").eq("ticket_id",l).order("timestamp",{ascending:!0});F?console.error("Error fetching activities:",F):(console.log("Refreshed activities:",L),a(L||[]))}},U=async(I,N)=>{if(l)try{const{error:L}=await T.from("tickets").update({status:"Closed"}).eq("id",l);if(L){console.error("Error updating ticket status:",L),alert("Failed to resolve ticket: "+L.message);return}const{error:F}=await T.from("ticketactivities").insert({ticket_id:l,message:`Ticket resolved: ${I}${N?` - ${N}`:""}`,activity_type:"chat",sender_name:"You"});F&&console.error("Error adding resolution activity:",F),await x();const{data:E}=await T.from("ticketactivities").select("*").eq("ticket_id",l).order("timestamp",{ascending:!0});a(E||[])}catch(L){console.error("Error resolving ticket:",L),alert("Failed to resolve ticket")}},B=I=>{s(I),w(!0)},V=()=>{w(!1),s(null)},_=t.filter(I=>{if(g!=="All"&&I.status!==g)return!1;if(!p)return!0;const N=p.toLowerCase();return I.subject?.toLowerCase().includes(N)||I.requester_name?.toLowerCase().includes(N)||I.status?.toLowerCase().includes(N)});if(r){const I=t.length>0&&t.every(N=>N.status==="Closed")&&g==="Open";if(R&&l){const N=t.find(L=>L.id===l);return e.jsxs(Fe,{children:[e.jsxs(i,{sx:{display:"flex",flexDirection:"column",height:"100vh"},children:[e.jsxs(i,{sx:{px:2,py:1.5,borderBottom:"1px solid",borderColor:"divider",display:"flex",alignItems:"center",gap:2,bgcolor:"background.surface"},children:[e.jsx(de,{size:"sm",variant:"plain",onClick:V,children:e.jsx(un,{})}),e.jsx(ge,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:N?.requester_name?.[0]?.toUpperCase()||"?"}),e.jsxs(i,{sx:{flex:1,minWidth:0},children:[e.jsx(d,{level:"title-sm",sx:{fontWeight:600,mb:.5},children:N?.subject||"Untitled"}),e.jsx(d,{level:"body-xs",color:"neutral",children:N?.requester_name})]}),e.jsx(ie,{variant:"soft",size:"sm",color:rt[N?.status||"Open"]?.color,sx:{fontWeight:600},children:rt[N?.status||"Open"]?.label}),N?.status!=="Closed"&&e.jsx(M,{variant:"solid",color:"primary",size:"sm",onClick:()=>v(!0),children:"Resolve"})]}),e.jsx(i,{sx:{flex:1,overflowY:"auto",px:2,py:2},children:e.jsx(G,{spacing:3,children:c.map((L,F)=>{const E=L.sender_name==="You";return e.jsxs(i,{children:[F===0||new Date(L.timestamp||"").toDateString()!==new Date(c[F-1]?.timestamp||"").toDateString()?e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(i,{sx:{flex:1,height:"1px",bgcolor:"divider"}}),e.jsx(d,{level:"body-xs",sx:{mx:2,color:"text.secondary"},children:L.timestamp?new Date(L.timestamp).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}):""}),e.jsx(i,{sx:{flex:1,height:"1px",bgcolor:"divider"}})]}):null,e.jsxs(G,{direction:"row",spacing:1,sx:{alignItems:"flex-start"},children:[!E&&e.jsx(ge,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:L.sender_name?.[0]?.toUpperCase()||"?"}),e.jsx(i,{sx:{flex:1,display:"flex",flexDirection:E?"row-reverse":"row"},children:e.jsxs(i,{sx:{maxWidth:"85%",bgcolor:E?"primary.500":"neutral.50",color:E?"white":"text.primary",borderRadius:E?"18px 18px 4px 18px":"18px 18px 18px 4px",px:2,py:1.5,position:"relative",boxShadow:"sm"},children:[!E&&e.jsx(d,{level:"body-xs",sx:{fontWeight:600,mb:.5,color:E?"white":"text.primary"},children:L.sender_name}),e.jsx(d,{level:"body-sm",sx:{lineHeight:1.4,color:E?"white":"text.primary"},children:L.message})]})}),E&&e.jsx(ge,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:L.sender_name?.[0]?.toUpperCase()||"?"})]}),e.jsx(i,{sx:{display:"flex",justifyContent:E?"flex-end":"flex-start",mt:.5,ml:E?0:5},children:e.jsx(d,{level:"body-xs",sx:{color:"text.tertiary"},children:L.timestamp?new Date(L.timestamp).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):""})})]},L.id)})})}),e.jsx(i,{sx:{px:2,py:1.5,borderTop:"1px solid",borderColor:"divider",bgcolor:"background.surface"},children:e.jsxs(G,{direction:"row",spacing:1,alignItems:"flex-end",children:[e.jsx(i,{sx:{flex:1},children:e.jsx(Jt,{placeholder:"Type something here...",value:o,onChange:L=>u(L.target.value),minRows:1,maxRows:3,sx:{borderRadius:"20px",border:"1px solid",borderColor:"neutral.300","&:focus-within":{borderColor:"primary.500"},"& textarea":{border:"none",outline:"none",resize:"none",px:2,py:1}},onKeyDown:L=>{L.key==="Enter"&&!L.shiftKey&&(L.preventDefault(),S())}})}),e.jsx(M,{onClick:S,disabled:!o.trim(),variant:"solid",color:"primary",size:"sm",sx:{borderRadius:"20px",minWidth:50,height:36,fontWeight:600},children:"Send"})]})})]}),e.jsx(Bt,{open:C,onClose:()=>m(!1),onCreated:x}),e.jsx(Ht,{open:j,onClose:()=>v(!1),onSubmit:U})]})}return e.jsxs(Fe,{children:[e.jsxs(i,{sx:{p:2},children:[e.jsx(d,{level:"h2",sx:{mb:3,fontWeight:600},children:"Tickets"}),e.jsxs(G,{spacing:2,sx:{mb:2},children:[e.jsxs(G,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(q,{placeholder:"Search tickets...",startDecorator:e.jsx(ke,{}),value:p,onChange:N=>b(N.target.value),size:"sm",sx:{flex:1}}),e.jsx(de,{size:"sm",variant:"soft",color:"primary",onClick:()=>m(!0),children:e.jsx(be,{})})]}),e.jsxs(je,{value:g,onChange:(N,L)=>y(L),size:"sm",placeholder:"Filter by status",children:[e.jsx(W,{value:"All",children:"All Tickets"}),e.jsx(W,{value:"Open",children:"Open"}),e.jsx(W,{value:"Pending",children:"Pending"}),e.jsx(W,{value:"Closed",children:"Closed"})]})]}),I?e.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"60vh",gap:2},children:[e.jsx(hn,{sx:{fontSize:80,color:"primary.500"}}),e.jsx(d,{level:"h3",sx:{fontWeight:700,textAlign:"center"},children:"All done, you can now go to the beach"})]}):e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:0},children:[_.map((N,L)=>e.jsxs(h.Fragment,{children:[e.jsxs(i,{sx:{p:2,display:"flex",alignItems:"flex-start",gap:2,cursor:"pointer",background:"transparent",borderRadius:1,transition:"all 0.2s","&:hover":{bgcolor:"neutral.50"}},onClick:()=>B(N.id),children:[e.jsx(ge,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600,mt:.5},children:N.requester_name?.[0]?.toUpperCase()||"?"}),e.jsxs(i,{sx:{flex:1,minWidth:0},children:[e.jsx(d,{level:"title-sm",sx:{fontWeight:600,mb:.5,wordBreak:"break-word"},children:N.subject||"Untitled"}),e.jsx(d,{level:"body-xs",color:"neutral",sx:{mb:.5,wordBreak:"break-word"},children:N.requester_name}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(d,{level:"body-xs",color:"neutral",children:Gs(N.updated_at)}),e.jsx(d,{level:"body-xs",color:"neutral",children:"•"}),e.jsxs(d,{level:"body-xs",color:"neutral",sx:{wordBreak:"break-all"},children:[N.id?.slice(0,8),"..."]})]})]}),e.jsx(ie,{variant:"soft",size:"sm",color:rt[N.status||"Open"]?.color,sx:{fontWeight:600,px:1.5,py:.5,ml:1},children:rt[N.status||"Open"]?.label})]}),L<_.length-1&&e.jsx(Te,{sx:{my:.5}})]},N.id)),_.length===0&&e.jsx(d,{color:"neutral",sx:{textAlign:"center",mt:4},children:"No tickets found."})]})]}),e.jsx(Bt,{open:C,onClose:()=>m(!1),onCreated:x}),e.jsx(Ht,{open:j,onClose:()=>v(!1),onSubmit:U})]})}return e.jsxs(i,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[e.jsxs(i,{sx:{display:"flex",flex:1},children:[e.jsxs(i,{sx:{width:390,borderRight:"1px solid",borderColor:"divider",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs(i,{sx:{px:2,py:1,borderBottom:"1px solid",borderColor:"divider",flexShrink:0},children:[e.jsxs(G,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[e.jsxs(G,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(d,{level:"title-lg",children:"Messages"}),e.jsx(ie,{size:"sm",variant:"soft",color:"neutral",children:_.length})]}),e.jsx(de,{size:"sm",variant:"soft",color:"primary",onClick:()=>m(!0),children:e.jsx(be,{})})]}),e.jsx(q,{placeholder:"Search",startDecorator:e.jsx(ke,{}),value:p,onChange:I=>b(I.target.value),size:"sm",sx:{width:"100%",mb:1}}),e.jsxs(je,{value:g,onChange:(I,N)=>y(N),size:"sm",sx:{width:"100%"},placeholder:"Filter by status",children:[e.jsx(W,{value:"All",children:"All Tickets"}),e.jsx(W,{value:"Open",children:"Open"}),e.jsx(W,{value:"Pending",children:"Pending"}),e.jsx(W,{value:"Closed",children:"Closed"})]})]}),e.jsx(i,{sx:{flex:1,overflowY:"auto",overflowX:"hidden",pt:1},children:e.jsx(Qt,{size:"sm",sx:{gap:0},children:_.map(I=>e.jsxs(h.Fragment,{children:[e.jsx(Zt,{sx:{p:0},children:e.jsx(it,{selected:l===I.id,onClick:()=>s(I.id),sx:{py:1,px:2},children:e.jsxs(G,{direction:"row",spacing:1.5,alignItems:"flex-start",sx:{width:"100%"},children:[e.jsx(i,{sx:{position:"relative"},children:e.jsx(ge,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:I.requester_name?.[0]?.toUpperCase()||"?"})}),e.jsxs(i,{sx:{flex:1,minWidth:0,pr:1},children:[e.jsxs(G,{direction:"row",justifyContent:"space-between",alignItems:"flex-start",sx:{mb:.5},children:[e.jsx(d,{level:"body-md",noWrap:!0,sx:{flex:1,pr:1},children:I.subject||"Untitled"}),I.status&&e.jsx(ie,{size:"sm",color:rt[I.status]?.color,variant:"soft",sx:{flexShrink:0},children:I.status})]}),e.jsx(d,{level:"body-sm",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",mb:.5},children:I.requester_name||""}),e.jsx(i,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(d,{level:"body-xs",sx:{color:"text.tertiary"},children:Gs(I.updated_at)})})]})]})})}),e.jsx(Gr,{component:"li",sx:{margin:0}})]},I.id))})})]}),e.jsxs(i,{sx:{flex:1,display:"flex",flexDirection:"column"},children:[l&&e.jsx(i,{sx:{px:3,py:2,borderBottom:"1px solid",borderColor:"divider",flexShrink:0},children:e.jsxs(G,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(ge,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:t.find(I=>I.id===l)?.requester_name?.[0]?.toUpperCase()||"?"}),e.jsxs(i,{sx:{flex:1},children:[e.jsx(d,{level:"title-sm",sx:{fontWeight:600},children:t.find(I=>I.id===l)?.requester_name||"Unknown User"}),e.jsx(d,{level:"body-xs",sx:{color:"text.secondary"},children:t.find(I=>I.id===l)?.status||"Unknown Status"})]}),e.jsx(M,{variant:"outlined",size:"sm",sx:{borderRadius:"16px"},children:"View profile"}),t.find(I=>I.id===l)?.status!=="Closed"&&e.jsx(M,{variant:"solid",color:"primary",size:"sm",sx:{borderRadius:"16px"},onClick:()=>v(!0),children:"Resolve"})]})}),e.jsx(i,{sx:{flex:1,overflowY:"auto",px:3,py:2},children:l?e.jsx(G,{spacing:3,children:c.map((I,N)=>{const L=I.sender_name==="You";return e.jsxs(i,{children:[N===0||new Date(I.timestamp||"").toDateString()!==new Date(c[N-1]?.timestamp||"").toDateString()?e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(i,{sx:{flex:1,height:"1px",bgcolor:"divider"}}),e.jsx(d,{level:"body-xs",sx:{mx:2,color:"text.secondary"},children:I.timestamp?new Date(I.timestamp).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}):""}),e.jsx(i,{sx:{flex:1,height:"1px",bgcolor:"divider"}})]}):null,e.jsxs(G,{direction:"row",spacing:1,sx:{alignItems:"flex-start"},children:[!L&&e.jsx(ge,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:I.sender_name?.[0]?.toUpperCase()||"?"}),e.jsx(i,{sx:{flex:1,display:"flex",flexDirection:L?"row-reverse":"row"},children:e.jsxs(i,{sx:{maxWidth:"70%",bgcolor:L?"primary.500":"neutral.50",color:L?"white":"text.primary",borderRadius:L?"18px 18px 4px 18px":"18px 18px 18px 4px",px:2,py:1.5,position:"relative",boxShadow:"sm"},children:[!L&&e.jsx(d,{level:"body-xs",sx:{fontWeight:600,mb:.5,color:L?"white":"text.primary"},children:I.sender_name}),e.jsx(d,{level:"body-sm",sx:{lineHeight:1.4,color:L?"white":"text.primary"},children:I.message})]})}),L&&e.jsx(ge,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:I.sender_name?.[0]?.toUpperCase()||"?"})]}),e.jsx(i,{sx:{display:"flex",justifyContent:L?"flex-end":"flex-start",mt:.5,ml:L?0:5},children:e.jsx(d,{level:"body-xs",sx:{color:"text.tertiary"},children:I.timestamp?new Date(I.timestamp).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):""})})]},I.id)})}):e.jsx(i,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx(d,{level:"body-md",sx:{color:"text.secondary"},children:"Select a ticket to view messages"})})}),l&&e.jsx(i,{sx:{px:3,py:2,borderTop:"1px solid",borderColor:"divider",flexShrink:0},children:e.jsxs(G,{direction:"row",spacing:1,alignItems:"flex-end",children:[e.jsx(i,{sx:{flex:1},children:e.jsx(Jt,{placeholder:"Type something here...",value:o,onChange:I=>u(I.target.value),minRows:1,maxRows:4,sx:{borderRadius:"20px",border:"1px solid",borderColor:"neutral.300","&:focus-within":{borderColor:"primary.500"},"& textarea":{border:"none",outline:"none",resize:"none",px:2,py:1}},onKeyDown:I=>{I.key==="Enter"&&!I.shiftKey&&(I.preventDefault(),S())}})}),e.jsx(M,{onClick:S,disabled:!o.trim(),variant:"solid",color:"primary",sx:{borderRadius:"20px",minWidth:60,height:40,fontWeight:600},children:"Send"})]})})]})]}),e.jsx(Bt,{open:C,onClose:()=>m(!1),onCreated:x}),e.jsx(Ht,{open:j,onClose:()=>v(!1),onSubmit:U})]})}const Qs={draft:0,scheduled:1,sent:2,failed:3},Be={fontSize:le.sizes.small},Je={...Be,fontWeight:600,borderBottom:"1.5px solid #e0e0e0",background:"inherit"},bt=r=>{switch(r){case"draft":return"neutral";case"scheduled":return"warning";case"sent":return"success";case"failed":return"danger";default:return"neutral"}},ll=r=>{switch(r){case"draft":return e.jsx(gn,{});case"scheduled":return e.jsx(mn,{});case"sent":return e.jsx(Lt,{});case"failed":return e.jsx(pn,{});default:return e.jsx(xn,{})}},il=()=>{const{isMobile:r}=Pe(),[t,n]=h.useState([]),[l,s]=h.useState(!1),[c,a]=h.useState(null),[o,u]=h.useState(""),[p,b]=h.useState(""),[g,y]=h.useState(!1),C=async()=>{s(!0),a(null);try{const{data:w,error:x}=await T.from("sms_campaigns").select("*").order("created_at",{ascending:!1});if(x)throw x;w&&n(w)}catch(w){console.error("Error fetching campaigns:",w),a(w.message||"Failed to fetch campaigns")}finally{s(!1)}},j=[...t.filter(w=>{const x=w.name.toLowerCase().includes(o.toLowerCase())||w.CampaignNumber?.toLowerCase().includes(o.toLowerCase()),S=p?w.status===p:!0;return x&&S})].sort((w,x)=>{const S=Qs[w.status]??99,U=Qs[x.status]??99;return S!==U?S-U:new Date(x.created_at).getTime()-new Date(w.created_at).getTime()});h.useEffect(()=>{C()},[]);const v=()=>e.jsxs(i,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(Ce,{padding:"medium",children:[e.jsx(d,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"SMS Campaigns"}),e.jsxs(i,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(q,{placeholder:"Search campaigns...",value:o,onChange:w=>u(w.target.value),startDecorator:e.jsx(ke,{}),sx:{flex:1}}),e.jsxs(je,{placeholder:"Status",value:p,onChange:(w,x)=>b(x??""),sx:{minWidth:120},children:[e.jsx(W,{value:"",children:"All"}),e.jsx(W,{value:"draft",children:"Draft"}),e.jsx(W,{value:"scheduled",children:"Scheduled"}),e.jsx(W,{value:"sent",children:"Sent"}),e.jsx(W,{value:"failed",children:"Failed"})]})]}),e.jsx(M,{variant:"solid",startDecorator:e.jsx(be,{}),onClick:()=>y(!0),sx:{width:"100%",mb:2},children:"Create Campaign"})]}),l&&e.jsx(Me,{}),c&&e.jsx(i,{sx:{p:2},children:e.jsxs(d,{color:"danger",children:["Error: ",c]})}),e.jsx(i,{children:j.length===0?e.jsx(i,{sx:{textAlign:"center",py:6},children:e.jsx(d,{color:"neutral",children:"No SMS campaigns found"})}):j.map(w=>e.jsx(i,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(i,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${bt(w.status)}.100`,color:`${bt(w.status)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",flexShrink:0},children:ll(w.status)}),e.jsxs(i,{sx:{flex:1,minWidth:0},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(d,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:w.name}),e.jsx(ie,{size:"sm",color:bt(w.status),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content",textTransform:"capitalize"},children:w.status})]}),e.jsxs(d,{level:"body-xs",color:"neutral",sx:{mb:.5},children:["Campaign #",w.CampaignNumber," • ",new Date(w.created_at).toLocaleDateString()]}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:.5},children:[e.jsxs(d,{level:"body-xs",color:"neutral",children:["Recipients: ",w.recipients?.length??0]}),w.scheduled_at&&e.jsxs(d,{level:"body-xs",color:"neutral",children:["Scheduled: ",$t(new Date(w.scheduled_at),"MMM dd, HH:mm")]})]}),w.message&&e.jsxs(d,{level:"body-xs",color:"neutral",sx:{fontStyle:"italic",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:['"',w.message,'"']})]})]})},w.id))})]}),R=()=>e.jsxs(Ce,{variant:"table-page",children:[e.jsx(d,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"SMS Campaigns"}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(q,{placeholder:"Search campaigns...",sx:{flex:1},value:o,onChange:w=>u(w.target.value),startDecorator:e.jsx(ke,{})}),e.jsxs(je,{placeholder:"Filter status",value:p,onChange:(w,x)=>b(x??""),sx:{minWidth:160},children:[e.jsx(W,{value:"",children:"All Statuses"}),e.jsx(W,{value:"draft",children:"Draft"}),e.jsx(W,{value:"scheduled",children:"Scheduled"}),e.jsx(W,{value:"sent",children:"Sent"}),e.jsx(W,{value:"failed",children:"Failed"})]}),e.jsx(M,{onClick:()=>y(!0),variant:"solid",startDecorator:e.jsx(be,{}),children:"Create Campaign"})]}),e.jsxs(ue,{sx:{overflow:"visible"},children:[l&&e.jsx(Me,{}),c&&e.jsxs(d,{color:"danger",children:["Error: ",c]}),e.jsxs(Ue,{"aria-label":"SMS Campaigns",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:Je,children:"Campaign #"}),e.jsx("th",{style:Je,children:"Name"}),e.jsx("th",{style:Je,children:"Status"}),e.jsx("th",{style:Je,children:"Scheduled"}),e.jsx("th",{style:Je,children:"Sent"}),e.jsx("th",{style:Je,children:"Recipients"}),e.jsx("th",{style:Je,children:"Message"})]})}),e.jsxs("tbody",{children:[j.length===0&&!l&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...Be},children:"No campaigns found."})}),j.map(w=>e.jsxs("tr",{style:{cursor:"pointer",height:48},children:[e.jsx("td",{style:Be,children:w.CampaignNumber}),e.jsx("td",{style:Be,children:w.name}),e.jsx("td",{style:Be,children:e.jsx(ie,{size:"sm",color:bt(w.status),variant:"soft",sx:{textTransform:"capitalize"},children:w.status})}),e.jsx("td",{style:Be,children:w.scheduled_at?$t(new Date(w.scheduled_at),"yyyy-MM-dd HH:mm"):"-"}),e.jsx("td",{style:Be,children:w.sent_at?$t(new Date(w.sent_at),"yyyy-MM-dd HH:mm"):"-"}),e.jsx("td",{style:Be,children:w.recipients?.length??0}),e.jsx("td",{style:Be,children:e.jsx(d,{level:"body-sm",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:w.message||"-"})})]},w.id))]})]})]})]});return e.jsxs(Fe,{children:[r?e.jsx(v,{}):e.jsx(R,{}),e.jsx(Re,{open:g,onClose:()=>y(!1),children:e.jsxs(Ee,{children:[e.jsx(qe,{}),e.jsx(d,{level:"h4",children:"Create New Campaign"}),e.jsx(d,{level:"body-sm",sx:{mt:1,mb:2},children:"Campaign creation functionality will be implemented here."}),e.jsx(M,{onClick:()=>y(!1),variant:"outlined",children:"Close"})]})})]})};function Vt(r,t){return t===0?r>0?100:0:(r-t)/t*100}function Gt(r){return r==null?"—":`${r>0?"+":r<0?"−":""}${Math.abs(Math.round(r))}%`}async function al(){const r=new Date,t=r.toISOString().slice(0,10),n=new Date(r.getTime()-30*24*60*60*1e3).toISOString().slice(0,10),l=new Date(r.getTime()-60*24*60*60*1e3).toISOString().slice(0,10),s=new Date(r.getTime()-30*24*60*60*1e3-1).toISOString().slice(0,10),c=await T.from("Orders").select("order_total, customer_email, date",{count:"exact"}).not("order_total","is",null);if(c.error||!c.data)throw new Error("Failed to fetch order stats");const a=c.data,o=a.filter(j=>j.date&&j.date>=n&&j.date<=t),u=a.filter(j=>j.date&&j.date>=l&&j.date<=s),p=o.reduce((j,v)=>j+(typeof v.order_total=="number"?v.order_total:0),0),b=u.reduce((j,v)=>j+(typeof v.order_total=="number"?v.order_total:0),0),g=o.length,y=u.length,C=new Set(o.map(j=>j.customer_email).filter(Boolean)),m=new Set(u.map(j=>j.customer_email).filter(Boolean));return{totalSales:p,orderCount:g,customerCount:C.size,salesChange:Vt(p,b),ordersChange:Vt(g,y),customersChange:Vt(C.size,m.size)}}const ol=()=>{const[r,t]=h.useState(null),[n,l]=h.useState(null),[s,c]=h.useState(null),[a,o]=h.useState(null),[u,p]=h.useState(null),[b,g]=h.useState(null),[y,C]=h.useState(!0),[m,j]=h.useState(null);return vt("(max-width:600px)"),h.useEffect(()=>{let v=!0,R=!0;async function w(){R&&C(!0),j(null);try{const{totalSales:S,orderCount:U,customerCount:B,salesChange:V,ordersChange:_,customersChange:I}=await al();v&&(t(S),l(U),c(B),o(V),p(_),g(I))}catch(S){v&&j(S.message)}finally{R&&C(!1),R=!1}}w();const x=setInterval(w,1e4);return()=>{v=!1,clearInterval(x)}},[]),e.jsxs(i,{sx:{p:{xs:2,md:3},pt:{xs:2,md:3},height:"100%",overflow:"auto"},children:[e.jsx(d,{level:"h2",sx:{mb:2},children:"Dashboard"}),e.jsxs(ye,{container:!0,spacing:2,children:[e.jsx(ye,{xs:12,md:4,children:e.jsxs(ue,{variant:"outlined",children:[e.jsx(d,{level:"h4",children:"Total Sales"}),e.jsx(d,{level:"h2",color:"success",children:y?"Loading...":m?"—":ae(r)}),e.jsxs(d,{level:"body-sm",color:"neutral",children:[y?"":Gt(a)," from last 30 days"]})]})}),e.jsx(ye,{xs:12,md:4,children:e.jsxs(ue,{variant:"outlined",children:[e.jsx(d,{level:"h4",children:"Orders"}),e.jsx(d,{level:"h2",color:"primary",children:y?"Loading...":m?"—":n?.toLocaleString()}),e.jsxs(d,{level:"body-sm",color:"neutral",children:[y?"":Gt(u)," from last 30 days"]})]})}),e.jsx(ye,{xs:12,md:4,children:e.jsxs(ue,{variant:"outlined",children:[e.jsx(d,{level:"h4",children:"Customers"}),e.jsx(d,{level:"h2",color:"warning",children:y?"Loading...":m?"—":s?.toLocaleString()}),e.jsxs(d,{level:"body-sm",color:"neutral",children:[y?"":Gt(b)," new last 30 days"]})]})})]})]})},$e=({children:r})=>{const[t,n]=h.useState(null),[l,s]=h.useState(!0);return h.useEffect(()=>{async function c(){const{data:a}=await T.auth.getSession();n(a?.session||null),s(!1)}c()},[]),l?e.jsx("div",{children:"Loading..."}):t?e.jsx(e.Fragment,{children:r}):e.jsx(zt,{to:"/",replace:!0})};function cl(r){const{onClick:t,...n}=r,{mode:l,setMode:s}=tr(),[c,a]=h.useState(!1);return h.useEffect(()=>a(!0),[]),e.jsx(de,{"aria-label":"toggle light/dark mode",size:"sm",variant:"outlined",disabled:!c,onClick:o=>{s(l==="light"?"dark":"light"),t?.(o)},...n,children:l==="light"?e.jsx(lr,{}):e.jsx(jn,{})})}function dl({onLogin:r}){const t=cs(),[n,l]=h.useState(""),[s,c]=h.useState(""),[a,o]=h.useState(!1),[u,p]=h.useState(null);h.useEffect(()=>{if(window.location.pathname==="/login"){async function g(){const{data:y}=await T.auth.getSession();y?.session&&t("/dashboard")}g()}},[t]);async function b(g){g.preventDefault(),o(!0),p(null);const{data:y,error:C}=await T.auth.signInWithPassword({email:n,password:s});if(C){console.error("[Login] Auth error:",C),p(C.message),o(!1);return}const m=y.user?.id;if(!m){p("Login failed: No user ID."),o(!1);return}let{data:j,error:v}=await T.from("users").select("*").eq("id",m).single();if(v||!j){console.error("[Login] User fetch error:",v);const{error:R}=await T.from("users").upsert({id:m,email:y.user.email,name:y.user.user_metadata?.full_name||y.user.user_metadata?.name||"",role:"employee"});if(R){console.error("Upsert failed:",R),p("Upsert failed: "+R.message),o(!1);return}let w=3,x,S;for(;w>0;){await new Promise(V=>setTimeout(V,300));const{data:U,error:B}=await T.from("users").select("*").eq("id",m).single();if(x=U,S=B,S&&console.error("[Login] Retry user fetch error:",S),x&&!S){j=x,v=null;break}w--}if(v||!j){p("Access denied: User not found."),await T.auth.signOut(),o(!1);return}}if(j.role!=="employee"){p("Access denied: Only employees can access this app."),await T.auth.signOut(),o(!1);return}o(!1),r(),t("/dashboard")}return e.jsxs(nr,{disableTransitionOnChange:!0,children:[e.jsx(Qr,{}),e.jsx(sr,{styles:{":root":{"--Form-maxWidth":"800px","--Transition-duration":"0.4s"}}}),e.jsx(i,{sx:g=>({width:{xs:"100%",md:"50vw"},transition:"width var(--Transition-duration)",transitionDelay:"calc(var(--Transition-duration) + 0.1s)",position:"relative",zIndex:1,display:"flex",justifyContent:"flex-end",backdropFilter:"blur(12px)",backgroundColor:"rgba(255 255 255 / 0.2)",[g.getColorSchemeSelector("dark")]:{backgroundColor:"rgba(19 19 24 / 0.4)"}}),children:e.jsxs(i,{sx:{display:"flex",flexDirection:"column",minHeight:"100dvh",width:"100%",px:2},children:[e.jsxs(i,{component:"header",sx:{py:3,display:"flex",justifyContent:"space-between"},children:[e.jsxs(i,{sx:{gap:2,display:"flex",alignItems:"center"},children:[e.jsx(de,{variant:"soft",color:"primary",size:"sm",children:e.jsx(fn,{})}),e.jsx(d,{level:"title-lg",children:"SmartBack"})]}),e.jsx(cl,{})]}),e.jsxs(i,{component:"main",sx:{my:"auto",py:2,pb:5,display:"flex",flexDirection:"column",gap:2,width:400,maxWidth:"100%",mx:"auto",borderRadius:"sm","& form":{display:"flex",flexDirection:"column",gap:2},"& .MuiFormLabel-asterisk":{visibility:"hidden"}},children:[e.jsx(G,{sx:{gap:4,mb:2},children:e.jsxs(G,{sx:{gap:1},children:[e.jsx(d,{component:"h1",level:"h3",children:"Sign in"}),e.jsx(d,{level:"body-sm",children:"Welcome back to SmartBack! Please sign in to continue."})]})}),e.jsx(G,{sx:{gap:4,mt:2},children:e.jsxs("form",{onSubmit:b,children:[e.jsxs(X,{required:!0,children:[e.jsx(J,{children:"Email"}),e.jsx(q,{type:"email",name:"email",value:n,onChange:g=>l(g.target.value),placeholder:"your@email.com",disabled:a})]}),e.jsxs(X,{required:!0,children:[e.jsx(J,{children:"Password"}),e.jsx(q,{type:"password",name:"password",value:s,onChange:g=>c(g.target.value),placeholder:"••••••",disabled:a})]}),e.jsxs(G,{sx:{gap:4,mt:2},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(wt,{size:"sm",label:"Remember me",name:"persistent"}),e.jsx(Zr,{level:"title-sm",href:"#forgot-password",children:"Forgot your password?"})]}),e.jsx(M,{type:"submit",fullWidth:!0,loading:a,children:"Sign in"})]})]})}),u&&e.jsx(i,{sx:{mt:2},children:e.jsx(d,{level:"body-sm",color:"danger",children:u})})]}),e.jsx(i,{component:"footer",sx:{py:3},children:e.jsxs(d,{level:"body-xs",sx:{textAlign:"center"},children:["© SmartBack ",new Date().getFullYear()]})})]})}),e.jsx(i,{sx:g=>({height:"100%",position:"fixed",right:0,top:0,bottom:0,left:{xs:0,md:"50vw"},transition:"background-image var(--Transition-duration), left var(--Transition-duration) !important",transitionDelay:"calc(var(--Transition-duration) + 0.1s)",backgroundColor:"background.level1",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundImage:"url(https://images.unsplash.com/photo-1527181152855-fc03fc7949c8?auto=format&w=1000&dpr=2)",[g.getColorSchemeSelector("dark")]:{backgroundImage:"url(https://images.unsplash.com/photo-1572072393749-3ca9c8ea0831?auto=format&w=1000&dpr=2)"}})})]})}function ul(){return e.jsx(us,{children:e.jsx(De,{path:"*",element:e.jsx(dl,{onLogin:()=>{}})})})}const we={fontSize:le.sizes.small},hl=()=>{const{isMobile:r}=Pe();fr();const[t,n]=h.useState([]),[l,s]=h.useState([]),[c,a]=h.useState(""),[o,u]=h.useState(!1),[p,b]=h.useState(!1),[g,y]=h.useState(""),[C,m]=h.useState(""),[j,v]=h.useState(""),[R,w]=h.useState(""),[x,S]=h.useState(null),[U,B]=h.useState(!1),[V,_]=h.useState(""),[I,N]=h.useState(""),[L,F]=h.useState(!1),[E,f]=h.useState(!1),[$,Z]=h.useState(""),[A,H]=h.useState("success"),oe=(z,te="success")=>{Z(z),H(te),f(!0)},he=async()=>{try{const{data:z,error:te}=await T.from("stock_movements").select(`
                    *,
                    Products (
                        ProductName,
                        ProductID
                    )
                `).order("date",{ascending:!1});te?(console.error("Error fetching movements:",te),n([]),oe("Failed to load movements","danger")):n(z||[])}catch(z){console.error("Unexpected error:",z),n([]),oe("An unexpected error occurred","danger")}},Se=async()=>{try{const{data:z,error:te}=await T.from("Products").select("*").order("ProductName");te?(console.error("Error fetching products:",te),s([])):s(z||[])}catch(z){console.error("Unexpected error:",z),s([])}},xe=async z=>{if(!z){S(null);return}B(!0);try{const{data:te,error:k}=await T.from("stock_movements").select("movement_type, quantity").eq("product_id",z);if(k)console.error("Error fetching stock movements:",k),S(null);else{const ee=(te||[]).reduce((ce,K)=>{switch(K.movement_type){case"incoming":return ce+K.quantity;case"outgoing":return ce-K.quantity;case"adjustment":return ce+K.quantity;default:return ce}},0);S(ee)}}catch(te){console.error("Error calculating stock:",te),S(null)}finally{B(!1)}};h.useEffect(()=>{R?xe(R):S(null)},[R]);const P=async()=>{if(!R||V===""||x===null){oe("Please select a product and enter a valid stock level","warning");return}const te=Number(V)-x;if(te===0){oe("No adjustment needed - the stock level is already at the specified amount","warning");return}F(!0);try{const{error:k}=await T.from("stock_movements").insert({product_id:R,movement_type:"adjustment",quantity:te,reason:`Manual adjustment: ${I||"Stock level correction"}`,date:new Date().toISOString()});k?(console.error("Error creating adjustment:",k),oe("Failed to create adjustment: "+k.message,"danger")):(w(""),_(""),N(""),S(null),u(!1),he(),oe("Stock adjustment created successfully!","success"))}catch(k){console.error("Unexpected error:",k),oe("An unexpected error occurred","danger")}finally{F(!1)}};h.useEffect(()=>{he(),Se()},[]);const O=t.filter(z=>{const te=c.toLowerCase(),k=c===""||z.id.toLowerCase().includes(te)||z.product_id.toLowerCase().includes(te)||z.movement_type.toLowerCase().includes(te)||(z.reason?.toLowerCase().includes(te)??!1)||(z.Products?.ProductName?.toLowerCase().includes(te)??!1),ee=g===""||z.movement_type===g,ce=C===""||z.product_id===C,K=j===""||(()=>{const me=z.reason?.toLowerCase()||"";switch(j){case"manual":return me.includes("manual")||me.includes("adjustment")||me.includes("correction");case"damage":return me.includes("damage")||me.includes("broken")||me.includes("defect");case"loss":return me.includes("loss")||me.includes("lost")||me.includes("missing");case"found":return me.includes("found")||me.includes("surplus")||me.includes("extra");case"po":return me.includes("po")||me.includes("purchase")||me.includes("receipt");default:return!0}})();return k&&ee&&ce&&K}),Q=z=>{switch(z.movement_type){case"incoming":return"success";case"outgoing":return"danger";case"adjustment":return z.quantity>=0?"success":"danger";default:return"neutral"}},pe=z=>{switch(z.movement_type){case"incoming":return"↑";case"outgoing":return"↓";case"adjustment":return"⚖";default:return"•"}},Oe=z=>{switch(z.movement_type){case"incoming":return`+${z.quantity}`;case"outgoing":return`-${z.quantity}`;case"adjustment":return z.quantity>=0?`+${z.quantity}`:`${z.quantity}`;default:return z.quantity}},D=()=>{y(""),m(""),v("")},Y=g!==""||C!==""||j!=="",fe=()=>e.jsxs(i,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(Ce,{padding:"medium",children:[e.jsx(d,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Stock Movements"}),e.jsxs(i,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(q,{placeholder:"Search movements...",value:c,onChange:z=>a(z.target.value),startDecorator:e.jsx(ke,{}),sx:{flex:1}}),e.jsx(de,{variant:Y?"solid":"soft",color:Y?"primary":"neutral",size:"sm",onClick:()=>b(!0),children:e.jsx(os,{})})]}),Y&&e.jsxs(i,{sx:{mb:2,display:"flex",gap:1,flexWrap:"wrap"},children:[g&&e.jsxs(ie,{size:"sm",variant:"soft",color:"primary",children:["Type: ",g]}),C&&e.jsxs(ie,{size:"sm",variant:"soft",color:"primary",children:["Product: ",l.find(z=>z.uuid===C)?.ProductName||"Selected"]}),j&&e.jsxs(ie,{size:"sm",variant:"soft",color:"primary",children:["Reason: ",j]})]})]}),e.jsx(i,{children:O.length===0?e.jsx(i,{sx:{textAlign:"center",py:6},children:e.jsx(d,{color:"neutral",children:"No stock movements found"})}):O.map(z=>e.jsx(i,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(i,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${Q(z)}.100`,color:`${Q(z)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",flexShrink:0},children:pe(z)}),e.jsxs(i,{sx:{flex:1,minWidth:0},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(d,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:z.Products?.ProductName||"Unknown Product"}),e.jsx(ie,{size:"sm",color:Q(z),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content"},children:Oe(z)})]}),e.jsxs(d,{level:"body-xs",color:"neutral",sx:{mb:.5},children:["ID: ",z.Products?.ProductID||"N/A"," • ",new Date(z.date).toLocaleDateString()]}),z.reason&&e.jsx(d,{level:"body-xs",color:"neutral",sx:{fontStyle:"italic",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:z.reason})]})]})},z.id))}),e.jsx(de,{color:"primary",variant:"soft",size:"sm",sx:{position:"fixed",bottom:80,right:16,zIndex:1e3,borderRadius:"8px",width:40,height:40,boxShadow:"sm",bgcolor:"primary.100","&:hover":{bgcolor:"primary.200",boxShadow:"md"}},onClick:()=>u(!0),children:e.jsx(be,{fontSize:"small"})})]}),Ne=()=>e.jsxs(Ce,{variant:"table-page",children:[e.jsx(d,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Stock Movements"}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(q,{placeholder:"Search movements...",sx:{flex:1,fontSize:le.sizes.small},value:c,onChange:z=>a(z.target.value),startDecorator:e.jsx(ke,{})}),e.jsx(M,{variant:"solid",startDecorator:e.jsx(be,{}),onClick:()=>u(!0),sx:{fontSize:le.sizes.small},children:"Adjust"})]}),e.jsx(ue,{sx:{overflow:"visible"},children:e.jsxs(Ue,{"aria-label":"Stock Movements",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:we,children:"ID"}),e.jsx("th",{style:we,children:"Product"}),e.jsx("th",{style:we,children:"Movement Type"}),e.jsx("th",{style:we,children:"Quantity"}),e.jsx("th",{style:we,children:"Reason"}),e.jsx("th",{style:we,children:"Date"})]})}),e.jsxs("tbody",{children:[O.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{textAlign:"center",color:"#888",...we},children:"No stock movements found."})}),O.map(z=>e.jsxs("tr",{style:{cursor:"pointer"},children:[e.jsxs("td",{style:we,children:[z.id.substring(0,8),"..."]}),e.jsx("td",{style:we,children:z.Products?e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:z.Products.ProductName}),e.jsxs("div",{style:{fontSize:"0.8em",color:"#666"},children:["ID: ",z.Products.ProductID]})]}):e.jsx("span",{style:{color:"#999",fontStyle:"italic"},children:"Unknown Product"})}),e.jsx("td",{style:we,children:e.jsx(ie,{size:"sm",variant:"soft",color:Q(z),children:z.movement_type==="incoming"?"↑ Incoming":z.movement_type==="outgoing"?"↓ Outgoing":"⚖ Adjustment"})}),e.jsx("td",{style:we,children:e.jsx("span",{style:{fontWeight:"bold",color:Q(z)==="success"?"#059669":Q(z)==="danger"?"#dc2626":"#666"},children:Oe(z)})}),e.jsx("td",{style:we,children:z.reason||"N/A"}),e.jsx("td",{style:we,children:new Date(z.date).toLocaleString()})]},z.id))]})]})})]});return e.jsxs(Fe,{children:[r?e.jsx(fe,{}):e.jsx(Ne,{}),e.jsx(Ot,{open:o,onClose:()=>u(!1),title:"Manual Stock Adjustment",size:"medium",actions:e.jsxs(i,{sx:{display:"flex",gap:2},children:[e.jsx(M,{variant:"plain",onClick:()=>u(!1),sx:we,children:"Cancel"}),e.jsx(M,{variant:"solid",onClick:P,loading:L,disabled:!R||V===""||x===null||Number(V)===x,sx:we,children:"Create Adjustment"})]}),children:e.jsxs(G,{spacing:2,children:[e.jsxs(X,{children:[e.jsx(J,{children:"Product"}),e.jsx(je,{placeholder:"Select a product...",value:R,onChange:(z,te)=>w(te||""),children:l.map(z=>e.jsxs(W,{value:z.uuid,children:[z.ProductName," (ID: ",z.ProductID,")"]},z.uuid))})]}),R&&e.jsxs(X,{children:[e.jsx(J,{children:"Current Stock Level"}),e.jsx(q,{value:U?"Loading...":x!==null?x:"N/A",readOnly:!0,sx:{bgcolor:"neutral.100",color:x!==null&&x<=0?"danger.500":"neutral.600"}}),x!==null&&x<=0&&e.jsx(d,{level:"body-sm",sx:{color:"danger.500",mt:.5},children:"⚠️ Warning: Product is at or below zero stock level"})]}),x!==null&&e.jsxs(X,{children:[e.jsx(J,{children:"Actual Stock Level"}),e.jsx(q,{type:"number",placeholder:"Enter the actual stock level...",value:V,onChange:z=>_(z.target.value),sx:{...we},slotProps:{input:{min:0,max:999999}}}),V!==""&&x!==null&&e.jsx(d,{level:"body-sm",sx:{mt:.5,color:Number(V)>x?"success.600":Number(V)<x?"danger.600":"neutral.600"},children:Number(V)>x?`+${Number(V)-x} (increase)`:Number(V)<x?`${Number(V)-x} (decrease)`:"No change needed"})]}),e.jsxs(X,{children:[e.jsx(J,{children:"Reason for Adjustment"}),e.jsx(q,{placeholder:"e.g., damage, loss, found inventory, physical count correction...",value:I,onChange:z=>N(z.target.value),sx:{...we}})]})]})}),r&&e.jsx(Ot,{open:p,onClose:()=>b(!1),title:"Filter Movements",size:"medium",actions:e.jsxs(i,{sx:{display:"flex",gap:1,justifyContent:"space-between",width:"100%"},children:[e.jsx(M,{variant:"plain",color:"neutral",onClick:D,disabled:!Y,children:"Clear All"}),e.jsx(M,{onClick:()=>b(!1),children:"Apply Filters"})]}),children:e.jsxs(G,{spacing:2,children:[e.jsxs(X,{children:[e.jsx(J,{children:"Movement Type"}),e.jsxs(je,{placeholder:"All types",value:g,onChange:(z,te)=>y(te||""),children:[e.jsx(W,{value:"",children:"All Types"}),e.jsx(W,{value:"incoming",children:"Incoming"}),e.jsx(W,{value:"outgoing",children:"Outgoing"}),e.jsx(W,{value:"adjustment",children:"Adjustment"})]})]}),e.jsxs(X,{children:[e.jsx(J,{children:"Product"}),e.jsxs(je,{placeholder:"All products",value:C,onChange:(z,te)=>m(te||""),children:[e.jsx(W,{value:"",children:"All Products"}),l.map(z=>e.jsx(W,{value:z.uuid,children:z.ProductName},z.uuid))]})]}),e.jsxs(X,{children:[e.jsx(J,{children:"Reason Category"}),e.jsxs(je,{placeholder:"All reasons",value:j,onChange:(z,te)=>v(te||""),children:[e.jsx(W,{value:"",children:"All Reasons"}),e.jsx(W,{value:"manual",children:"Manual Adjustment"}),e.jsx(W,{value:"damage",children:"Damage/Defect"}),e.jsx(W,{value:"loss",children:"Loss/Missing"}),e.jsx(W,{value:"found",children:"Found/Surplus"}),e.jsx(W,{value:"po",children:"Purchase Order"})]})]})]})}),e.jsx(Tt,{open:E,onClose:()=>f(!1),autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{top:16,zIndex:2e3},children:e.jsx(ht,{color:A,variant:"solid",sx:{width:"100%"},children:$})})]})};function ps(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Ke=ps();function jr(r){Ke=r}var ct={exec:()=>null};function re(r,t=""){let n=typeof r=="string"?r:r.source,l={replace:(s,c)=>{let a=typeof c=="string"?c:c.source;return a=a.replace(Ie.caret,"$1"),n=n.replace(s,a),l},getRegex:()=>new RegExp(n,t)};return l}var Ie={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:r=>new RegExp(`^( {0,3}${r})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}#`),htmlBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}<(?:[a-z].*>|!--)`,"i")},xl=/^(?:[ \t]*(?:\n|$))+/,pl=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,ml=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,xt=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,gl=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,ms=/(?:[*+-]|\d{1,9}[.)])/,br=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,yr=re(br).replace(/bull/g,ms).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),fl=re(br).replace(/bull/g,ms).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),gs=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,jl=/^[^\n]+/,fs=/(?!\s*\])(?:\\.|[^\[\]\\])+/,bl=re(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",fs).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),yl=re(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,ms).getRegex(),Mt="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",js=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,vl=re("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",js).replace("tag",Mt).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),vr=re(gs).replace("hr",xt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Mt).getRegex(),wl=re(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",vr).getRegex(),bs={blockquote:wl,code:pl,def:bl,fences:ml,heading:gl,hr:xt,html:vl,lheading:yr,list:yl,newline:xl,paragraph:vr,table:ct,text:jl},Zs=re("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",xt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Mt).getRegex(),Sl={...bs,lheading:fl,table:Zs,paragraph:re(gs).replace("hr",xt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Zs).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Mt).getRegex()},kl={...bs,html:re(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",js).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:ct,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:re(gs).replace("hr",xt).replace("heading",` *#{1,6} *[^
]`).replace("lheading",yr).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Cl=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,_l=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,wr=/^( {2,}|\\)\n(?!\s*$)/,Dl=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Nt=/[\p{P}\p{S}]/u,ys=/[\s\p{P}\p{S}]/u,Sr=/[^\s\p{P}\p{S}]/u,Il=re(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,ys).getRegex(),kr=/(?!~)[\p{P}\p{S}]/u,Pl=/(?!~)[\s\p{P}\p{S}]/u,zl=/(?:[^\s\p{P}\p{S}]|~)/u,Ol=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,Cr=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Al=re(Cr,"u").replace(/punct/g,Nt).getRegex(),Rl=re(Cr,"u").replace(/punct/g,kr).getRegex(),_r="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",El=re(_r,"gu").replace(/notPunctSpace/g,Sr).replace(/punctSpace/g,ys).replace(/punct/g,Nt).getRegex(),Tl=re(_r,"gu").replace(/notPunctSpace/g,zl).replace(/punctSpace/g,Pl).replace(/punct/g,kr).getRegex(),Ll=re("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Sr).replace(/punctSpace/g,ys).replace(/punct/g,Nt).getRegex(),Ml=re(/\\(punct)/,"gu").replace(/punct/g,Nt).getRegex(),Nl=re(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),ql=re(js).replace("(?:-->|$)","-->").getRegex(),$l=re("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",ql).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),At=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,Wl=re(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",At).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Dr=re(/^!?\[(label)\]\[(ref)\]/).replace("label",At).replace("ref",fs).getRegex(),Ir=re(/^!?\[(ref)\](?:\[\])?/).replace("ref",fs).getRegex(),Fl=re("reflink|nolink(?!\\()","g").replace("reflink",Dr).replace("nolink",Ir).getRegex(),vs={_backpedal:ct,anyPunctuation:Ml,autolink:Nl,blockSkip:Ol,br:wr,code:_l,del:ct,emStrongLDelim:Al,emStrongRDelimAst:El,emStrongRDelimUnd:Ll,escape:Cl,link:Wl,nolink:Ir,punctuation:Il,reflink:Dr,reflinkSearch:Fl,tag:$l,text:Dl,url:ct},Ul={...vs,link:re(/^!?\[(label)\]\((.*?)\)/).replace("label",At).getRegex(),reflink:re(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",At).getRegex()},Kt={...vs,emStrongRDelimAst:Tl,emStrongLDelim:Rl,url:re(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},Bl={...Kt,br:re(wr).replace("{2,}","*").getRegex(),text:re(Kt.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},yt={normal:bs,gfm:Sl,pedantic:kl},nt={normal:vs,gfm:Kt,breaks:Bl,pedantic:Ul},Hl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Ys=r=>Hl[r];function We(r,t){if(t){if(Ie.escapeTest.test(r))return r.replace(Ie.escapeReplace,Ys)}else if(Ie.escapeTestNoEncode.test(r))return r.replace(Ie.escapeReplaceNoEncode,Ys);return r}function Js(r){try{r=encodeURI(r).replace(Ie.percentDecode,"%")}catch{return null}return r}function Xs(r,t){let n=r.replace(Ie.findPipe,(c,a,o)=>{let u=!1,p=a;for(;--p>=0&&o[p]==="\\";)u=!u;return u?"|":" |"}),l=n.split(Ie.splitPipe),s=0;if(l[0].trim()||l.shift(),l.length>0&&!l.at(-1)?.trim()&&l.pop(),t)if(l.length>t)l.splice(t);else for(;l.length<t;)l.push("");for(;s<l.length;s++)l[s]=l[s].trim().replace(Ie.slashPipe,"|");return l}function lt(r,t,n){let l=r.length;if(l===0)return"";let s=0;for(;s<l&&r.charAt(l-s-1)===t;)s++;return r.slice(0,l-s)}function Vl(r,t){if(r.indexOf(t[1])===-1)return-1;let n=0;for(let l=0;l<r.length;l++)if(r[l]==="\\")l++;else if(r[l]===t[0])n++;else if(r[l]===t[1]&&(n--,n<0))return l;return n>0?-2:-1}function Ks(r,t,n,l,s){let c=t.href,a=t.title||null,o=r[1].replace(s.other.outputLinkReplace,"$1");l.state.inLink=!0;let u={type:r[0].charAt(0)==="!"?"image":"link",raw:n,href:c,title:a,text:o,tokens:l.inlineTokens(o)};return l.state.inLink=!1,u}function Gl(r,t,n){let l=r.match(n.other.indentCodeCompensation);if(l===null)return t;let s=l[1];return t.split(`
`).map(c=>{let a=c.match(n.other.beginningSpace);if(a===null)return c;let[o]=a;return o.length>=s.length?c.slice(s.length):c}).join(`
`)}var Rt=class{options;rules;lexer;constructor(r){this.options=r||Ke}space(r){let t=this.rules.block.newline.exec(r);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(r){let t=this.rules.block.code.exec(r);if(t){let n=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?n:lt(n,`
`)}}}fences(r){let t=this.rules.block.fences.exec(r);if(t){let n=t[0],l=Gl(n,t[3]||"",this.rules);return{type:"code",raw:n,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:l}}}heading(r){let t=this.rules.block.heading.exec(r);if(t){let n=t[2].trim();if(this.rules.other.endingHash.test(n)){let l=lt(n,"#");(this.options.pedantic||!l||this.rules.other.endingSpaceChar.test(l))&&(n=l.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(r){let t=this.rules.block.hr.exec(r);if(t)return{type:"hr",raw:lt(t[0],`
`)}}blockquote(r){let t=this.rules.block.blockquote.exec(r);if(t){let n=lt(t[0],`
`).split(`
`),l="",s="",c=[];for(;n.length>0;){let a=!1,o=[],u;for(u=0;u<n.length;u++)if(this.rules.other.blockquoteStart.test(n[u]))o.push(n[u]),a=!0;else if(!a)o.push(n[u]);else break;n=n.slice(u);let p=o.join(`
`),b=p.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");l=l?`${l}
${p}`:p,s=s?`${s}
${b}`:b;let g=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(b,c,!0),this.lexer.state.top=g,n.length===0)break;let y=c.at(-1);if(y?.type==="code")break;if(y?.type==="blockquote"){let C=y,m=C.raw+`
`+n.join(`
`),j=this.blockquote(m);c[c.length-1]=j,l=l.substring(0,l.length-C.raw.length)+j.raw,s=s.substring(0,s.length-C.text.length)+j.text;break}else if(y?.type==="list"){let C=y,m=C.raw+`
`+n.join(`
`),j=this.list(m);c[c.length-1]=j,l=l.substring(0,l.length-y.raw.length)+j.raw,s=s.substring(0,s.length-C.raw.length)+j.raw,n=m.substring(c.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:l,tokens:c,text:s}}}list(r){let t=this.rules.block.list.exec(r);if(t){let n=t[1].trim(),l=n.length>1,s={type:"list",raw:"",ordered:l,start:l?+n.slice(0,-1):"",loose:!1,items:[]};n=l?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=l?n:"[*+-]");let c=this.rules.other.listItemRegex(n),a=!1;for(;r;){let u=!1,p="",b="";if(!(t=c.exec(r))||this.rules.block.hr.test(r))break;p=t[0],r=r.substring(p.length);let g=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,R=>" ".repeat(3*R.length)),y=r.split(`
`,1)[0],C=!g.trim(),m=0;if(this.options.pedantic?(m=2,b=g.trimStart()):C?m=t[1].length+1:(m=t[2].search(this.rules.other.nonSpaceChar),m=m>4?1:m,b=g.slice(m),m+=t[1].length),C&&this.rules.other.blankLine.test(y)&&(p+=y+`
`,r=r.substring(y.length+1),u=!0),!u){let R=this.rules.other.nextBulletRegex(m),w=this.rules.other.hrRegex(m),x=this.rules.other.fencesBeginRegex(m),S=this.rules.other.headingBeginRegex(m),U=this.rules.other.htmlBeginRegex(m);for(;r;){let B=r.split(`
`,1)[0],V;if(y=B,this.options.pedantic?(y=y.replace(this.rules.other.listReplaceNesting,"  "),V=y):V=y.replace(this.rules.other.tabCharGlobal,"    "),x.test(y)||S.test(y)||U.test(y)||R.test(y)||w.test(y))break;if(V.search(this.rules.other.nonSpaceChar)>=m||!y.trim())b+=`
`+V.slice(m);else{if(C||g.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||x.test(g)||S.test(g)||w.test(g))break;b+=`
`+y}!C&&!y.trim()&&(C=!0),p+=B+`
`,r=r.substring(B.length+1),g=V.slice(m)}}s.loose||(a?s.loose=!0:this.rules.other.doubleBlankLine.test(p)&&(a=!0));let j=null,v;this.options.gfm&&(j=this.rules.other.listIsTask.exec(b),j&&(v=j[0]!=="[ ] ",b=b.replace(this.rules.other.listReplaceTask,""))),s.items.push({type:"list_item",raw:p,task:!!j,checked:v,loose:!1,text:b,tokens:[]}),s.raw+=p}let o=s.items.at(-1);if(o)o.raw=o.raw.trimEnd(),o.text=o.text.trimEnd();else return;s.raw=s.raw.trimEnd();for(let u=0;u<s.items.length;u++)if(this.lexer.state.top=!1,s.items[u].tokens=this.lexer.blockTokens(s.items[u].text,[]),!s.loose){let p=s.items[u].tokens.filter(g=>g.type==="space"),b=p.length>0&&p.some(g=>this.rules.other.anyLine.test(g.raw));s.loose=b}if(s.loose)for(let u=0;u<s.items.length;u++)s.items[u].loose=!0;return s}}html(r){let t=this.rules.block.html.exec(r);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(r){let t=this.rules.block.def.exec(r);if(t){let n=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),l=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",s=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:n,raw:t[0],href:l,title:s}}}table(r){let t=this.rules.block.table.exec(r);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let n=Xs(t[1]),l=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),s=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],c={type:"table",raw:t[0],header:[],align:[],rows:[]};if(n.length===l.length){for(let a of l)this.rules.other.tableAlignRight.test(a)?c.align.push("right"):this.rules.other.tableAlignCenter.test(a)?c.align.push("center"):this.rules.other.tableAlignLeft.test(a)?c.align.push("left"):c.align.push(null);for(let a=0;a<n.length;a++)c.header.push({text:n[a],tokens:this.lexer.inline(n[a]),header:!0,align:c.align[a]});for(let a of s)c.rows.push(Xs(a,c.header.length).map((o,u)=>({text:o,tokens:this.lexer.inline(o),header:!1,align:c.align[u]})));return c}}lheading(r){let t=this.rules.block.lheading.exec(r);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(r){let t=this.rules.block.paragraph.exec(r);if(t){let n=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:n,tokens:this.lexer.inline(n)}}}text(r){let t=this.rules.block.text.exec(r);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(r){let t=this.rules.inline.escape.exec(r);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(r){let t=this.rules.inline.tag.exec(r);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(r){let t=this.rules.inline.link.exec(r);if(t){let n=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let c=lt(n.slice(0,-1),"\\");if((n.length-c.length)%2===0)return}else{let c=Vl(t[2],"()");if(c===-2)return;if(c>-1){let a=(t[0].indexOf("!")===0?5:4)+t[1].length+c;t[2]=t[2].substring(0,c),t[0]=t[0].substring(0,a).trim(),t[3]=""}}let l=t[2],s="";if(this.options.pedantic){let c=this.rules.other.pedanticHrefTitle.exec(l);c&&(l=c[1],s=c[3])}else s=t[3]?t[3].slice(1,-1):"";return l=l.trim(),this.rules.other.startAngleBracket.test(l)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?l=l.slice(1):l=l.slice(1,-1)),Ks(t,{href:l&&l.replace(this.rules.inline.anyPunctuation,"$1"),title:s&&s.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(r,t){let n;if((n=this.rules.inline.reflink.exec(r))||(n=this.rules.inline.nolink.exec(r))){let l=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),s=t[l.toLowerCase()];if(!s){let c=n[0].charAt(0);return{type:"text",raw:c,text:c}}return Ks(n,s,n[0],this.lexer,this.rules)}}emStrong(r,t,n=""){let l=this.rules.inline.emStrongLDelim.exec(r);if(!(!l||l[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(l[1]||l[2])||!n||this.rules.inline.punctuation.exec(n))){let s=[...l[0]].length-1,c,a,o=s,u=0,p=l[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(p.lastIndex=0,t=t.slice(-1*r.length+s);(l=p.exec(t))!=null;){if(c=l[1]||l[2]||l[3]||l[4]||l[5]||l[6],!c)continue;if(a=[...c].length,l[3]||l[4]){o+=a;continue}else if((l[5]||l[6])&&s%3&&!((s+a)%3)){u+=a;continue}if(o-=a,o>0)continue;a=Math.min(a,a+o+u);let b=[...l[0]][0].length,g=r.slice(0,s+l.index+b+a);if(Math.min(s,a)%2){let C=g.slice(1,-1);return{type:"em",raw:g,text:C,tokens:this.lexer.inlineTokens(C)}}let y=g.slice(2,-2);return{type:"strong",raw:g,text:y,tokens:this.lexer.inlineTokens(y)}}}}codespan(r){let t=this.rules.inline.code.exec(r);if(t){let n=t[2].replace(this.rules.other.newLineCharGlobal," "),l=this.rules.other.nonSpaceChar.test(n),s=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return l&&s&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:t[0],text:n}}}br(r){let t=this.rules.inline.br.exec(r);if(t)return{type:"br",raw:t[0]}}del(r){let t=this.rules.inline.del.exec(r);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(r){let t=this.rules.inline.autolink.exec(r);if(t){let n,l;return t[2]==="@"?(n=t[1],l="mailto:"+n):(n=t[1],l=n),{type:"link",raw:t[0],text:n,href:l,tokens:[{type:"text",raw:n,text:n}]}}}url(r){let t;if(t=this.rules.inline.url.exec(r)){let n,l;if(t[2]==="@")n=t[0],l="mailto:"+n;else{let s;do s=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??"";while(s!==t[0]);n=t[0],t[1]==="www."?l="http://"+t[0]:l=t[0]}return{type:"link",raw:t[0],text:n,href:l,tokens:[{type:"text",raw:n,text:n}]}}}inlineText(r){let t=this.rules.inline.text.exec(r);if(t){let n=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:n}}}},He=class es{tokens;options;state;tokenizer;inlineQueue;constructor(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||Ke,this.options.tokenizer=this.options.tokenizer||new Rt,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:Ie,block:yt.normal,inline:nt.normal};this.options.pedantic?(n.block=yt.pedantic,n.inline=nt.pedantic):this.options.gfm&&(n.block=yt.gfm,this.options.breaks?n.inline=nt.breaks:n.inline=nt.gfm),this.tokenizer.rules=n}static get rules(){return{block:yt,inline:nt}}static lex(t,n){return new es(n).lex(t)}static lexInline(t,n){return new es(n).inlineTokens(t)}lex(t){t=t.replace(Ie.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let l=this.inlineQueue[n];this.inlineTokens(l.src,l.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,n=[],l=!1){for(this.options.pedantic&&(t=t.replace(Ie.tabCharGlobal,"    ").replace(Ie.spaceLine,""));t;){let s;if(this.options.extensions?.block?.some(a=>(s=a.call({lexer:this},t,n))?(t=t.substring(s.raw.length),n.push(s),!0):!1))continue;if(s=this.tokenizer.space(t)){t=t.substring(s.raw.length);let a=n.at(-1);s.raw.length===1&&a!==void 0?a.raw+=`
`:n.push(s);continue}if(s=this.tokenizer.code(t)){t=t.substring(s.raw.length);let a=n.at(-1);a?.type==="paragraph"||a?.type==="text"?(a.raw+=`
`+s.raw,a.text+=`
`+s.text,this.inlineQueue.at(-1).src=a.text):n.push(s);continue}if(s=this.tokenizer.fences(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.heading(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.hr(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.blockquote(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.list(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.html(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.def(t)){t=t.substring(s.raw.length);let a=n.at(-1);a?.type==="paragraph"||a?.type==="text"?(a.raw+=`
`+s.raw,a.text+=`
`+s.raw,this.inlineQueue.at(-1).src=a.text):this.tokens.links[s.tag]||(this.tokens.links[s.tag]={href:s.href,title:s.title});continue}if(s=this.tokenizer.table(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.lheading(t)){t=t.substring(s.raw.length),n.push(s);continue}let c=t;if(this.options.extensions?.startBlock){let a=1/0,o=t.slice(1),u;this.options.extensions.startBlock.forEach(p=>{u=p.call({lexer:this},o),typeof u=="number"&&u>=0&&(a=Math.min(a,u))}),a<1/0&&a>=0&&(c=t.substring(0,a+1))}if(this.state.top&&(s=this.tokenizer.paragraph(c))){let a=n.at(-1);l&&a?.type==="paragraph"?(a.raw+=`
`+s.raw,a.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=a.text):n.push(s),l=c.length!==t.length,t=t.substring(s.raw.length);continue}if(s=this.tokenizer.text(t)){t=t.substring(s.raw.length);let a=n.at(-1);a?.type==="text"?(a.raw+=`
`+s.raw,a.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=a.text):n.push(s);continue}if(t){let a="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(a);break}else throw new Error(a)}}return this.state.top=!0,n}inline(t,n=[]){return this.inlineQueue.push({src:t,tokens:n}),n}inlineTokens(t,n=[]){let l=t,s=null;if(this.tokens.links){let o=Object.keys(this.tokens.links);if(o.length>0)for(;(s=this.tokenizer.rules.inline.reflinkSearch.exec(l))!=null;)o.includes(s[0].slice(s[0].lastIndexOf("[")+1,-1))&&(l=l.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+l.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(s=this.tokenizer.rules.inline.anyPunctuation.exec(l))!=null;)l=l.slice(0,s.index)+"++"+l.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(s=this.tokenizer.rules.inline.blockSkip.exec(l))!=null;)l=l.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+l.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let c=!1,a="";for(;t;){c||(a=""),c=!1;let o;if(this.options.extensions?.inline?.some(p=>(o=p.call({lexer:this},t,n))?(t=t.substring(o.raw.length),n.push(o),!0):!1))continue;if(o=this.tokenizer.escape(t)){t=t.substring(o.raw.length),n.push(o);continue}if(o=this.tokenizer.tag(t)){t=t.substring(o.raw.length),n.push(o);continue}if(o=this.tokenizer.link(t)){t=t.substring(o.raw.length),n.push(o);continue}if(o=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(o.raw.length);let p=n.at(-1);o.type==="text"&&p?.type==="text"?(p.raw+=o.raw,p.text+=o.text):n.push(o);continue}if(o=this.tokenizer.emStrong(t,l,a)){t=t.substring(o.raw.length),n.push(o);continue}if(o=this.tokenizer.codespan(t)){t=t.substring(o.raw.length),n.push(o);continue}if(o=this.tokenizer.br(t)){t=t.substring(o.raw.length),n.push(o);continue}if(o=this.tokenizer.del(t)){t=t.substring(o.raw.length),n.push(o);continue}if(o=this.tokenizer.autolink(t)){t=t.substring(o.raw.length),n.push(o);continue}if(!this.state.inLink&&(o=this.tokenizer.url(t))){t=t.substring(o.raw.length),n.push(o);continue}let u=t;if(this.options.extensions?.startInline){let p=1/0,b=t.slice(1),g;this.options.extensions.startInline.forEach(y=>{g=y.call({lexer:this},b),typeof g=="number"&&g>=0&&(p=Math.min(p,g))}),p<1/0&&p>=0&&(u=t.substring(0,p+1))}if(o=this.tokenizer.inlineText(u)){t=t.substring(o.raw.length),o.raw.slice(-1)!=="_"&&(a=o.raw.slice(-1)),c=!0;let p=n.at(-1);p?.type==="text"?(p.raw+=o.raw,p.text+=o.text):n.push(o);continue}if(t){let p="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(p);break}else throw new Error(p)}}return n}},Et=class{options;parser;constructor(r){this.options=r||Ke}space(r){return""}code({text:r,lang:t,escaped:n}){let l=(t||"").match(Ie.notSpaceStart)?.[0],s=r.replace(Ie.endingNewline,"")+`
`;return l?'<pre><code class="language-'+We(l)+'">'+(n?s:We(s,!0))+`</code></pre>
`:"<pre><code>"+(n?s:We(s,!0))+`</code></pre>
`}blockquote({tokens:r}){return`<blockquote>
${this.parser.parse(r)}</blockquote>
`}html({text:r}){return r}heading({tokens:r,depth:t}){return`<h${t}>${this.parser.parseInline(r)}</h${t}>
`}hr(r){return`<hr>
`}list(r){let t=r.ordered,n=r.start,l="";for(let a=0;a<r.items.length;a++){let o=r.items[a];l+=this.listitem(o)}let s=t?"ol":"ul",c=t&&n!==1?' start="'+n+'"':"";return"<"+s+c+`>
`+l+"</"+s+`>
`}listitem(r){let t="";if(r.task){let n=this.checkbox({checked:!!r.checked});r.loose?r.tokens[0]?.type==="paragraph"?(r.tokens[0].text=n+" "+r.tokens[0].text,r.tokens[0].tokens&&r.tokens[0].tokens.length>0&&r.tokens[0].tokens[0].type==="text"&&(r.tokens[0].tokens[0].text=n+" "+We(r.tokens[0].tokens[0].text),r.tokens[0].tokens[0].escaped=!0)):r.tokens.unshift({type:"text",raw:n+" ",text:n+" ",escaped:!0}):t+=n+" "}return t+=this.parser.parse(r.tokens,!!r.loose),`<li>${t}</li>
`}checkbox({checked:r}){return"<input "+(r?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:r}){return`<p>${this.parser.parseInline(r)}</p>
`}table(r){let t="",n="";for(let s=0;s<r.header.length;s++)n+=this.tablecell(r.header[s]);t+=this.tablerow({text:n});let l="";for(let s=0;s<r.rows.length;s++){let c=r.rows[s];n="";for(let a=0;a<c.length;a++)n+=this.tablecell(c[a]);l+=this.tablerow({text:n})}return l&&(l=`<tbody>${l}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+l+`</table>
`}tablerow({text:r}){return`<tr>
${r}</tr>
`}tablecell(r){let t=this.parser.parseInline(r.tokens),n=r.header?"th":"td";return(r.align?`<${n} align="${r.align}">`:`<${n}>`)+t+`</${n}>
`}strong({tokens:r}){return`<strong>${this.parser.parseInline(r)}</strong>`}em({tokens:r}){return`<em>${this.parser.parseInline(r)}</em>`}codespan({text:r}){return`<code>${We(r,!0)}</code>`}br(r){return"<br>"}del({tokens:r}){return`<del>${this.parser.parseInline(r)}</del>`}link({href:r,title:t,tokens:n}){let l=this.parser.parseInline(n),s=Js(r);if(s===null)return l;r=s;let c='<a href="'+r+'"';return t&&(c+=' title="'+We(t)+'"'),c+=">"+l+"</a>",c}image({href:r,title:t,text:n,tokens:l}){l&&(n=this.parser.parseInline(l,this.parser.textRenderer));let s=Js(r);if(s===null)return We(n);r=s;let c=`<img src="${r}" alt="${n}"`;return t&&(c+=` title="${We(t)}"`),c+=">",c}text(r){return"tokens"in r&&r.tokens?this.parser.parseInline(r.tokens):"escaped"in r&&r.escaped?r.text:We(r.text)}},ws=class{strong({text:r}){return r}em({text:r}){return r}codespan({text:r}){return r}del({text:r}){return r}html({text:r}){return r}text({text:r}){return r}link({text:r}){return""+r}image({text:r}){return""+r}br(){return""}},Ve=class ts{options;renderer;textRenderer;constructor(t){this.options=t||Ke,this.options.renderer=this.options.renderer||new Et,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new ws}static parse(t,n){return new ts(n).parse(t)}static parseInline(t,n){return new ts(n).parseInline(t)}parse(t,n=!0){let l="";for(let s=0;s<t.length;s++){let c=t[s];if(this.options.extensions?.renderers?.[c.type]){let o=c,u=this.options.extensions.renderers[o.type].call({parser:this},o);if(u!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(o.type)){l+=u||"";continue}}let a=c;switch(a.type){case"space":{l+=this.renderer.space(a);continue}case"hr":{l+=this.renderer.hr(a);continue}case"heading":{l+=this.renderer.heading(a);continue}case"code":{l+=this.renderer.code(a);continue}case"table":{l+=this.renderer.table(a);continue}case"blockquote":{l+=this.renderer.blockquote(a);continue}case"list":{l+=this.renderer.list(a);continue}case"html":{l+=this.renderer.html(a);continue}case"paragraph":{l+=this.renderer.paragraph(a);continue}case"text":{let o=a,u=this.renderer.text(o);for(;s+1<t.length&&t[s+1].type==="text";)o=t[++s],u+=`
`+this.renderer.text(o);n?l+=this.renderer.paragraph({type:"paragraph",raw:u,text:u,tokens:[{type:"text",raw:u,text:u,escaped:!0}]}):l+=u;continue}default:{let o='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(o),"";throw new Error(o)}}}return l}parseInline(t,n=this.renderer){let l="";for(let s=0;s<t.length;s++){let c=t[s];if(this.options.extensions?.renderers?.[c.type]){let o=this.options.extensions.renderers[c.type].call({parser:this},c);if(o!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(c.type)){l+=o||"";continue}}let a=c;switch(a.type){case"escape":{l+=n.text(a);break}case"html":{l+=n.html(a);break}case"link":{l+=n.link(a);break}case"image":{l+=n.image(a);break}case"strong":{l+=n.strong(a);break}case"em":{l+=n.em(a);break}case"codespan":{l+=n.codespan(a);break}case"br":{l+=n.br(a);break}case"del":{l+=n.del(a);break}case"text":{l+=n.text(a);break}default:{let o='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(o),"";throw new Error(o)}}}return l}},Ct=class{options;block;constructor(r){this.options=r||Ke}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(r){return r}postprocess(r){return r}processAllTokens(r){return r}provideLexer(){return this.block?He.lex:He.lexInline}provideParser(){return this.block?Ve.parse:Ve.parseInline}},Ql=class{defaults=ps();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=Ve;Renderer=Et;TextRenderer=ws;Lexer=He;Tokenizer=Rt;Hooks=Ct;constructor(...r){this.use(...r)}walkTokens(r,t){let n=[];for(let l of r)switch(n=n.concat(t.call(this,l)),l.type){case"table":{let s=l;for(let c of s.header)n=n.concat(this.walkTokens(c.tokens,t));for(let c of s.rows)for(let a of c)n=n.concat(this.walkTokens(a.tokens,t));break}case"list":{let s=l;n=n.concat(this.walkTokens(s.items,t));break}default:{let s=l;this.defaults.extensions?.childTokens?.[s.type]?this.defaults.extensions.childTokens[s.type].forEach(c=>{let a=s[c].flat(1/0);n=n.concat(this.walkTokens(a,t))}):s.tokens&&(n=n.concat(this.walkTokens(s.tokens,t)))}}return n}use(...r){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return r.forEach(n=>{let l={...n};if(l.async=this.defaults.async||l.async||!1,n.extensions&&(n.extensions.forEach(s=>{if(!s.name)throw new Error("extension name required");if("renderer"in s){let c=t.renderers[s.name];c?t.renderers[s.name]=function(...a){let o=s.renderer.apply(this,a);return o===!1&&(o=c.apply(this,a)),o}:t.renderers[s.name]=s.renderer}if("tokenizer"in s){if(!s.level||s.level!=="block"&&s.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let c=t[s.level];c?c.unshift(s.tokenizer):t[s.level]=[s.tokenizer],s.start&&(s.level==="block"?t.startBlock?t.startBlock.push(s.start):t.startBlock=[s.start]:s.level==="inline"&&(t.startInline?t.startInline.push(s.start):t.startInline=[s.start]))}"childTokens"in s&&s.childTokens&&(t.childTokens[s.name]=s.childTokens)}),l.extensions=t),n.renderer){let s=this.defaults.renderer||new Et(this.defaults);for(let c in n.renderer){if(!(c in s))throw new Error(`renderer '${c}' does not exist`);if(["options","parser"].includes(c))continue;let a=c,o=n.renderer[a],u=s[a];s[a]=(...p)=>{let b=o.apply(s,p);return b===!1&&(b=u.apply(s,p)),b||""}}l.renderer=s}if(n.tokenizer){let s=this.defaults.tokenizer||new Rt(this.defaults);for(let c in n.tokenizer){if(!(c in s))throw new Error(`tokenizer '${c}' does not exist`);if(["options","rules","lexer"].includes(c))continue;let a=c,o=n.tokenizer[a],u=s[a];s[a]=(...p)=>{let b=o.apply(s,p);return b===!1&&(b=u.apply(s,p)),b}}l.tokenizer=s}if(n.hooks){let s=this.defaults.hooks||new Ct;for(let c in n.hooks){if(!(c in s))throw new Error(`hook '${c}' does not exist`);if(["options","block"].includes(c))continue;let a=c,o=n.hooks[a],u=s[a];Ct.passThroughHooks.has(c)?s[a]=p=>{if(this.defaults.async)return Promise.resolve(o.call(s,p)).then(g=>u.call(s,g));let b=o.call(s,p);return u.call(s,b)}:s[a]=(...p)=>{let b=o.apply(s,p);return b===!1&&(b=u.apply(s,p)),b}}l.hooks=s}if(n.walkTokens){let s=this.defaults.walkTokens,c=n.walkTokens;l.walkTokens=function(a){let o=[];return o.push(c.call(this,a)),s&&(o=o.concat(s.call(this,a))),o}}this.defaults={...this.defaults,...l}}),this}setOptions(r){return this.defaults={...this.defaults,...r},this}lexer(r,t){return He.lex(r,t??this.defaults)}parser(r,t){return Ve.parse(r,t??this.defaults)}parseMarkdown(r){return(t,n)=>{let l={...n},s={...this.defaults,...l},c=this.onError(!!s.silent,!!s.async);if(this.defaults.async===!0&&l.async===!1)return c(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||t===null)return c(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return c(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));s.hooks&&(s.hooks.options=s,s.hooks.block=r);let a=s.hooks?s.hooks.provideLexer():r?He.lex:He.lexInline,o=s.hooks?s.hooks.provideParser():r?Ve.parse:Ve.parseInline;if(s.async)return Promise.resolve(s.hooks?s.hooks.preprocess(t):t).then(u=>a(u,s)).then(u=>s.hooks?s.hooks.processAllTokens(u):u).then(u=>s.walkTokens?Promise.all(this.walkTokens(u,s.walkTokens)).then(()=>u):u).then(u=>o(u,s)).then(u=>s.hooks?s.hooks.postprocess(u):u).catch(c);try{s.hooks&&(t=s.hooks.preprocess(t));let u=a(t,s);s.hooks&&(u=s.hooks.processAllTokens(u)),s.walkTokens&&this.walkTokens(u,s.walkTokens);let p=o(u,s);return s.hooks&&(p=s.hooks.postprocess(p)),p}catch(u){return c(u)}}}onError(r,t){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,r){let l="<p>An error occurred:</p><pre>"+We(n.message+"",!0)+"</pre>";return t?Promise.resolve(l):l}if(t)return Promise.reject(n);throw n}}},Xe=new Ql;function ne(r,t){return Xe.parse(r,t)}ne.options=ne.setOptions=function(r){return Xe.setOptions(r),ne.defaults=Xe.defaults,jr(ne.defaults),ne};ne.getDefaults=ps;ne.defaults=Ke;ne.use=function(...r){return Xe.use(...r),ne.defaults=Xe.defaults,jr(ne.defaults),ne};ne.walkTokens=function(r,t){return Xe.walkTokens(r,t)};ne.parseInline=Xe.parseInline;ne.Parser=Ve;ne.parser=Ve.parse;ne.Renderer=Et;ne.TextRenderer=ws;ne.Lexer=He;ne.lexer=He.lex;ne.Tokenizer=Rt;ne.Hooks=Ct;ne.parse=ne;ne.options;ne.setOptions;ne.use;ne.walkTokens;ne.parseInline;Ve.parse;He.lex;function Zl(){const[r,t]=h.useState(null),[n,l]=h.useState(null),[s,c]=h.useState(!0),[a,o]=h.useState(!1),[u,p]=h.useState(!1),[b,g]=h.useState(!1),[y,C]=h.useState(null),[m,j]=h.useState(""),[v,R]=h.useState(""),[w,x]=h.useState(""),[S,U]=h.useState(""),[B,V]=h.useState(""),[_,I]=h.useState("");h.useEffect(()=>{N()},[]);const N=async()=>{try{c(!0);const{data:f}=await T.auth.getUser(),$=f.user;if($){t($),x($.email||"");const{data:Z}=await T.from("users").select("*").eq("id",$.id).single();if(Z){l(Z);const A=(Z.name||"").split(" ");j(A[0]||""),R(A.slice(1).join(" ")||""),U(Z.role||"UI Developer"),V(Z.department||""),I(Z.avatar_url||"")}}}catch(f){console.error("Error loading user data:",f),C({type:"danger",text:"Failed to load user data"})}finally{c(!1)}},L=async()=>{if(r)try{p(!0);const f=`${m} ${v}`.trim(),{error:$}=await T.from("users").update({name:f,role:S,department:B,avatar_url:_||null}).eq("id",r.id);if($)throw $;await N(),o(!1),C({type:"success",text:"Profile updated successfully"}),setTimeout(()=>C(null),3e3)}catch(f){console.error("Error saving profile:",f),C({type:"danger",text:"Failed to save profile"})}finally{p(!1)}},F=async f=>{const $=f.target.files?.[0];if(!(!$||!r)){if(!$.type.startsWith("image/")){C({type:"danger",text:"Please select a valid image file"});return}if($.size>5*1024*1024){C({type:"danger",text:"Image size must be less than 5MB"});return}try{g(!0),C(null);const Z=$.name.split(".").pop(),H=`${r.id}-${Date.now()}.${Z}`,{data:oe,error:he}=await T.storage.from("avatars").upload(H,$,{cacheControl:"3600",upsert:!0});if(he)throw new Error(`Upload failed: ${he.message}`);const{data:{publicUrl:Se}}=T.storage.from("avatars").getPublicUrl(H);I(Se);const{error:xe}=await T.from("users").update({avatar_url:Se}).eq("id",r.id);if(xe)throw new Error(`Database update failed: ${xe.message}`);await N(),C({type:"success",text:"Avatar uploaded successfully"}),setTimeout(()=>C(null),3e3)}catch(Z){let A="Failed to upload avatar";Z instanceof Error&&(Z.message.includes("not found")?A="Storage bucket not configured. Please contact admin.":Z.message.includes("permission")?A="Permission denied. Please contact admin.":A=`Upload failed: ${Z.message}`),C({type:"danger",text:A})}finally{g(!1),f.target.value=""}}},E=()=>{const f=(n?.name||"").split(" ");j(f[0]||""),R(f.slice(1).join(" ")||""),U(n?.role||"UI Developer"),V(n?.department||""),I(n?.avatar_url||""),o(!1),C(null)};return s?e.jsx(ue,{children:e.jsx(Ae,{children:e.jsx(d,{level:"body-sm",color:"neutral",children:"Loading profile..."})})}):e.jsx(ue,{children:e.jsxs(Ae,{children:[e.jsx(d,{level:"h4",sx:{mb:1},children:"Personal info"}),e.jsx(d,{level:"body-sm",color:"neutral",sx:{mb:3},children:"Your profile information."}),y&&e.jsx(ht,{color:y.type,sx:{mb:2},children:y.text}),e.jsxs(i,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:3,alignItems:{xs:"center",sm:"stretch"},width:"100%",maxWidth:"100%",overflow:"hidden"},children:[e.jsx(i,{sx:{flex:{xs:"none",sm:"1"},maxWidth:{xs:"100%",sm:"300px"},display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",position:"relative",minHeight:{xs:"auto",sm:"400px"},width:{xs:"100%",sm:"auto"}},children:e.jsxs(i,{sx:{position:"relative",display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsxs(ge,{size:"lg",src:_||n?.avatar_url||r?.user_metadata?.avatar_url,sx:{width:160,height:160},children:[m?.[0],v?.[0]]},`avatar-${_}-${n?.avatar_url}`),a&&e.jsxs(i,{sx:{mt:2,display:"flex",flexDirection:"column",alignItems:"center",gap:1},children:[e.jsxs(de,{component:"label",size:"sm",variant:"solid",color:"primary",loading:b,sx:{borderRadius:"8px",px:2,py:1},children:[e.jsx(ut,{fontSize:"small",sx:{mr:1}}),"Upload Avatar",e.jsx("input",{type:"file",accept:"image/*",onChange:F,style:{display:"none"}})]}),e.jsx(d,{level:"body-xs",color:"neutral",sx:{textAlign:"center",maxWidth:180,lineHeight:1.4},children:"Max 5MB (JPG, PNG, GIF)"})]})]})}),e.jsxs(i,{sx:{flex:{xs:"none",sm:"2"},maxWidth:{xs:"100%",sm:"calc(100% - 300px - 24px)"},width:{xs:"100%",sm:"auto"},minWidth:0},children:[e.jsxs(G,{spacing:2,children:[e.jsxs(i,{children:[e.jsx(J,{sx:{mb:1},children:"Name"}),e.jsxs(i,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2},children:[e.jsx(q,{placeholder:"First name",value:m,onChange:f=>j(f.target.value),disabled:!a,sx:{flex:1}}),e.jsx(q,{placeholder:"Last name",value:v,onChange:f=>R(f.target.value),disabled:!a,sx:{flex:1}})]})]}),e.jsxs(i,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2},children:[e.jsxs(X,{sx:{flex:1},children:[e.jsx(J,{children:"Role"}),e.jsx(q,{value:S,onChange:f=>U(f.target.value),disabled:!a})]}),e.jsxs(X,{sx:{flex:1},children:[e.jsx(J,{children:"Department"}),e.jsx(q,{value:B,onChange:f=>V(f.target.value),disabled:!a,placeholder:"e.g., Engineering, Sales, Marketing"})]})]}),e.jsxs(X,{children:[e.jsx(J,{children:"Email"}),e.jsx(q,{value:w,disabled:!0,startDecorator:"✉️"})]}),e.jsxs(X,{children:[e.jsx(J,{children:"Avatar URL"}),e.jsx(q,{value:_,onChange:f=>I(f.target.value),disabled:!a,placeholder:"https://example.com/avatar.jpg",startDecorator:"🖼️"})]}),n&&e.jsxs(i,{sx:{mt:2,p:2,bgcolor:"background.level1",borderRadius:"sm"},children:[e.jsx(d,{level:"body-sm",color:"neutral",sx:{mb:1},children:"Account Information"}),e.jsxs(G,{spacing:1,children:[n.created_at&&e.jsxs(d,{level:"body-sm",children:[e.jsx("strong",{children:"Member since:"})," ",new Date(n.created_at).toLocaleDateString()]}),n.last_login&&e.jsxs(d,{level:"body-sm",children:[e.jsx("strong",{children:"Last login:"})," ",new Date(n.last_login).toLocaleDateString()]}),e.jsxs(d,{level:"body-sm",children:[e.jsx("strong",{children:"User ID:"})," ",n.id]})]})]})]}),e.jsx(i,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:1,mt:3,justifyContent:{xs:"stretch",sm:"flex-end"}},children:a?e.jsxs(e.Fragment,{children:[e.jsx(M,{variant:"outlined",onClick:E,disabled:u,startDecorator:e.jsx(xr,{}),sx:{order:{xs:2,sm:1}},children:"Cancel"}),e.jsx(M,{variant:"solid",onClick:L,loading:u,startDecorator:e.jsx(yn,{}),sx:{order:{xs:1,sm:2}},children:"Save"})]}):e.jsx(M,{variant:"outlined",onClick:()=>o(!0),startDecorator:e.jsx(ut,{}),children:"Edit Profile"})})]})]})]})})}function Yl(){const[r,t]=se.useState(""),[n,l]=se.useState(!0),[s,c]=se.useState(!1),a=`## Latest Release
**Version 2.1.2** - July 6, 2025

### Recent Updates
- Modern Login Page Redesign with Split Layout
- Glassmorphism effect with backdrop blur and semi-transparent backgrounds
- Dynamic mountain landscape background images that change with light/dark mode
- Dark/light mode toggle in login page header
- Company branding with SmartBack logo and name in header

### System Status
- All systems operational
- Database migrations up to date
- Authentication services active

*For complete release history, please check the development environment or contact support.*`;return se.useEffect(()=>{const o="/RELEASE_LOG.md";console.log("Fetching release log from:",o),fetch(o).then(u=>{if(console.log("Release log response status:",u.status,u.statusText),!u.ok)throw new Error(`Failed to fetch release log: ${u.status} ${u.statusText}`);return u.text()}).then(u=>{console.log("Release log loaded successfully, length:",u.length);const p=u.replace(/<!--[\s\S]*?-->/g,"").trim();t(p),c(!1)}).catch(u=>{console.error("Error fetching release log:",u),console.log("Using fallback content"),t(a),c(!1)}).finally(()=>l(!1))},[a]),e.jsx(ue,{sx:{height:"100%",minHeight:{xs:200,md:300}},children:e.jsxs(Ae,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(mr,{color:"primary"}),e.jsx(d,{level:"h4",children:"Release Log"})]}),e.jsxs(i,{sx:{flex:1,overflow:"auto"},children:[n&&e.jsx(d,{level:"body-sm",color:"neutral",children:"Loading release log..."}),!n&&e.jsx(i,{sx:{typography:"body-sm"},children:e.jsx("div",{dangerouslySetInnerHTML:{__html:ne(r)}})})]})]})})}function Jl(){return Pe(),e.jsx(ue,{sx:{height:"100%",minHeight:{xs:120,md:300}},children:e.jsxs(Ae,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(vn,{color:"primary"}),e.jsx(d,{level:"h4",children:"Application Info"})]}),e.jsxs(G,{spacing:1.5,sx:{flex:1},children:[e.jsxs(d,{level:"title-md",sx:{fontWeight:"bold"},children:["smartback".charAt(0).toUpperCase()+"smartback".slice(1)," business System"]}),e.jsxs(G,{spacing:.5,children:[e.jsxs(d,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Environment:"})," ","production"]}),e.jsxs(d,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Version:"})," ","3.2.10"]}),e.jsxs(d,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Build Date:"})," ",new Date().toLocaleDateString()]}),e.jsxs(d,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Platform:"})," Web Application"]}),e.jsxs(d,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Language:"})," English (US)"]}),e.jsxs(d,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Currency:"})," ",Le.currency," (",Le.symbol,") - ",Le.locale]}),e.jsxs(d,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Currency Precision:"})," Smart formatting (0-2 decimal places)"]})]})]}),e.jsxs(i,{sx:{mt:3,p:2,backgroundColor:"neutral.50",borderRadius:"md"},children:[e.jsx(d,{level:"title-sm",sx:{mb:1},children:"Currency Formatting Examples"}),e.jsxs(G,{spacing:.5,children:[e.jsxs(d,{level:"body-xs",color:"neutral",children:[e.jsx("strong",{children:"Whole numbers:"})," ",ze(100)," • ",ze(1500)," • ",ze(25e3)]}),e.jsxs(d,{level:"body-xs",color:"neutral",children:[e.jsx("strong",{children:"With decimals:"})," ",ze(99.5)," • ",ze(1234.56)," • ",ze(15.25)]})]})]}),e.jsx(M,{component:"a",href:"https://nicklasfangerfisk.github.io/Testflow/",target:"_blank",rel:"noopener noreferrer",startDecorator:e.jsx(wn,{}),variant:"outlined",color:"primary",sx:{mt:2,alignSelf:"flex-start"},children:"System Test"})]})})}const Xl=()=>{const{isMobile:r}=Pe(),[t,n]=h.useState(0),l=async()=>{try{const{error:o}=await T.auth.signOut();o?console.error("Error signing out:",o):window.location.href="/login"}catch(o){console.error("Error during logout:",o)}},s=[{label:"User",icon:e.jsx(st,{}),content:e.jsx(Zl,{})},{label:"App",icon:e.jsx(bn,{}),content:e.jsx(Jl,{})},{label:"Releases",icon:e.jsx(mr,{}),content:e.jsx(Yl,{})}],c=()=>e.jsx(i,{sx:{width:"100%",minHeight:"100vh"},children:e.jsxs(Ce,{padding:"medium",children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(d,{level:"h2",sx:{fontSize:le.sizes.xlarge},children:"My profile"}),e.jsx(M,{variant:"outlined",color:"danger",size:"sm",startDecorator:e.jsx(Ls,{}),onClick:l,children:"Logout"})]}),e.jsxs(Ds,{value:t,onChange:(o,u)=>n(typeof u=="number"?u:0),sx:{bgcolor:"transparent"},children:[e.jsx(Is,{sx:{bgcolor:"transparent"},children:s.map((o,u)=>e.jsx(Ps,{value:u,sx:{bgcolor:"transparent"},children:o.label},u))}),s.map((o,u)=>e.jsx(zs,{value:u,sx:{p:0,pt:3,bgcolor:"transparent"},children:o.content},u))]})]})}),a=()=>e.jsxs(Ce,{variant:"table-page",children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(d,{level:"h2",sx:{fontSize:le.sizes.xlarge},children:"My profile"}),e.jsx(M,{variant:"outlined",color:"danger",startDecorator:e.jsx(Ls,{}),onClick:l,children:"Logout"})]}),e.jsxs(Ds,{value:t,onChange:(o,u)=>n(typeof u=="number"?u:0),sx:{bgcolor:"transparent"},children:[e.jsx(Is,{sx:{bgcolor:"transparent"},children:s.map((o,u)=>e.jsx(Ps,{value:u,sx:{bgcolor:"transparent"},children:o.label},u))}),s.map((o,u)=>e.jsx(zs,{value:u,sx:{p:0,pt:3,bgcolor:"transparent"},children:o.content},u))]})]});return e.jsx(Fe,{children:r?e.jsx(c,{}):e.jsx(a,{})})};function Kl(){const r=ds(),{isMobile:t}=Pe(),n=cs(),[l,s]=h.useState("dashboard"),c=[{label:"Dashboard",icon:e.jsx(ls,{}),value:"dashboard"},{label:"Orders",icon:e.jsx(is,{}),value:"orders"},{label:"Users",icon:e.jsx(as,{}),value:"users"},{label:"My Profile",icon:e.jsx(st,{}),value:"profile"},{label:"Settings",icon:e.jsx(Sn,{}),value:"settings"}];return h.useEffect(()=>{s({"/":"dashboard","/dashboard":"dashboard","/orders":"orders","/products":"dashboard","/users":"users","/suppliers":"dashboard","/purchase-orders":"dashboard","/tickets":"dashboard","/sms-campaigns":"dashboard","/movements":"dashboard","/settings":"profile"}[r.pathname]||"dashboard")},[r.pathname]),console.log("isMobile:",t),e.jsxs(i,{sx:{display:"flex",height:"100vh",overflow:"hidden"},children:[r.pathname!=="/login"&&!t&&e.jsx(Rn,{setView:a=>console.log(a),view:"home"}),e.jsxs(i,{component:"main",sx:{flexGrow:1,display:"flex",flexDirection:"column",height:"100%",bgcolor:"background.default",p:0,width:t?"100%":"calc(100% - var(--Sidebar-width, 240px))",marginBottom:t?"56px":0,overflow:"auto"},children:[t&&r.pathname!=="/login"&&e.jsx(tl,{items:c,value:l,onChange:a=>{s(a);const u={home:"/",dashboard:"/dashboard",orders:"/orders",products:"/products",users:"/users",suppliers:"/suppliers",purchaseorders:"/purchase-orders",tickets:"/tickets",smscampaigns:"/sms-campaigns",movements:"/movements",profile:"/settings",settings:"/settings"}[a]||`/${a}`;n(u)},toggleSidebar:()=>console.log("Sidebar toggled")}),e.jsxs(us,{children:[e.jsx(De,{path:"/",element:e.jsx(zt,{to:"/dashboard",replace:!0})}),e.jsx(De,{path:"/orders",element:e.jsx($e,{children:e.jsx(Bn,{})})}),e.jsx(De,{path:"/products",element:e.jsx($e,{children:e.jsx(Vn,{})})}),e.jsx(De,{path:"/users",element:e.jsx($e,{children:e.jsx(Qn,{})})}),e.jsx(De,{path:"/suppliers",element:e.jsx($e,{children:e.jsx(Yn,{})})}),e.jsx(De,{path:"/purchase-orders",element:e.jsx($e,{children:e.jsx(el,{})})}),e.jsx(De,{path:"/tickets",element:e.jsx($e,{children:e.jsx(nl,{})})}),e.jsx(De,{path:"/sms-campaigns",element:e.jsx($e,{children:e.jsx(il,{})})}),e.jsx(De,{path:"/dashboard",element:e.jsx($e,{children:e.jsx(ol,{})})}),e.jsx(De,{path:"/movements",element:e.jsx($e,{children:e.jsx(hl,{})})}),e.jsx(De,{path:"/settings",element:e.jsx($e,{children:e.jsx(Xl,{})})}),e.jsx(De,{path:"*",element:e.jsx(zt,{to:"/",replace:!0})})]})]})]})}function ei(){return e.jsx(nr,{children:e.jsx(Cn,{children:e.jsxs(us,{children:[e.jsx(De,{path:"/login/*",element:e.jsx(ul,{})}),e.jsx(De,{path:"/*",element:e.jsx(Kl,{})})]})})})}console.log("Mounting React app...");const er=document.getElementById("root");er?(Dn.createRoot(er).render(e.jsx(ei,{})),console.log("React app rendered!")):console.error("No #root element found in index.html!");

import{b as En,u as An,r as u,j as e,I as ne,M as _e,d as Pe,D as Jt,e as Gt,B as m,A as ye,T as g,f as ot,h as q,i as Zt,k as F,R as H,l as On,m as Pt,G as In,L as Et,n as pt,o as ft,p as Ne,q as St,s as Dn,t as Ve,F as de,v as ue,S as ee,w as z,x as ks,y as $e,z as ie,C as Qt,E as Cs,H as K,J as Ae,K as ke,N as Ir,O as Dr,P as Tr,Q as lt,U as zt,V as Ke,W as Tn,X as zn,Y as Ln,Z as Nn,_ as Mn,$ as Js,a0 as Fn,a1 as qn,a2 as $n,a3 as Gs,a4 as zr,a5 as Un,a6 as Bn}from"./mui-core-BlyZvqL8.js";import{D as Wn,L as Hn,P as Vn,H as Jn,a as Rs,S as _s,b as Lr,G as Ps,c as Nr,A as Mr,Q as Fr,d as Lt,e as Nt,f as Gn,K as Zn,g as Zs,h as gt,i as oe,j as me,F as Es,k as Mt,l as Qs,I as Ks,E as Ft,m as Qn,n as qr,o as $r,p as Kn,C as Xn,M as Yn,q as ei,r as ti,s as si,t as As,u as Ur,v as Xs,w as ri,B as ni,x as ii,y as li,z as oi,J as ai,N as ci,O as di,U as ui}from"./mui-icons-BH5QIami.js";import{c as hi}from"./supabase-BxkNBt-5.js";import{N as qt,u as Os,a as Is,R as Ds,b as be,B as xi}from"./router-CnZFtCWX.js";import{f as ls}from"./utils-CSQe5d3I.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(i){if(i.ep)return;i.ep=!0;const l=r(i);fetch(i.href,l)}})();var vt={},Ys;function pi(){if(Ys)return vt;Ys=1;var s=En();return vt.createRoot=s.createRoot,vt.hydrateRoot=s.hydrateRoot,vt}var fi=pi();function mi(s){const{onClick:t,sx:r,...n}=s,{mode:i,setMode:l}=An(),[o,a]=u.useState(!1);return u.useEffect(()=>{a(!0)},[]),o?e.jsxs(ne,{"data-screenshot":"toggle-mode",size:"sm",variant:"outlined",color:"neutral",...n,onClick:c=>{l(i==="light"?"dark":"light"),t?.(c)},sx:[i==="dark"?{"& > *:first-of-type":{display:"none"}}:{"& > *:first-of-type":{display:"initial"}},i==="light"?{"& > *:last-of-type":{display:"none"}}:{"& > *:last-of-type":{display:"initial"}},...Array.isArray(r)?r:[r]],children:[e.jsx(Wn,{}),e.jsx(Hn,{})]}):e.jsx(ne,{size:"sm",variant:"outlined",color:"neutral",...n,sx:r,disabled:!0})}const Br="https://tfzvtzqybgbzxcxozdes.supabase.co",ps="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRmenZ0enF5YmdienhjeG96ZGVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NTc2MDIsImV4cCI6MjA2MzQzMzYwMn0.hD2WdkvI8LY9N0IHP7HDQliyicQA0c-mspKjCJf0_Fc";console.log("[Supabase] URL:",Br);console.log("[Supabase] Anon Key:",ps.slice(0,6)+"..."+ps.slice(-6));const L=hi(Br,ps);L.auth.onAuthStateChange((s,t)=>{console.log("[Auth State Change]",s,t),s==="SIGNED_IN"?console.log("User signed in:",t?.user):s==="SIGNED_OUT"&&console.log("User signed out")});let os=!1;L.auth.onAuthStateChange((s,t)=>{os||(os=!0,console.log("[Auth State Change]",s,t),s==="SIGNED_IN"?console.log("User signed in:",t?.user):s==="SIGNED_OUT"&&(console.log("User signed out"),window.location.pathname!=="/login"&&(window.location.href="/login")),os=!1)});function gi({open:s,onClose:t,userProfile:r,editName:n,setEditName:i,editAvatar:l,setEditAvatar:o,onSave:a}){const[c,d]=u.useState(!1),[x,f]=u.useState(null),w=u.useRef(null);async function _(h){const b=h.target.files&&h.target.files[0];if(!(!b||!r?.id)){d(!0),f(null);try{const S=b.name.split(".").pop()?.replace(/\./,"")||"png",O=`avatars/${r.id}_${Date.now()}.${S}`,C=await L.storage.from("avatars").upload(O,b,{upsert:!0,contentType:b.type});if(C.error)throw C.error;const{publicUrl:j}=L.storage.from("avatars").getPublicUrl(O).data;j&&o(j)}catch(S){f("Failed to upload avatar. Please try again."),console.error("Avatar upload failed",S)}d(!1)}}return e.jsx(_e,{open:s,onClose:t,children:e.jsxs(Pe,{children:[e.jsx(Jt,{children:"Edit Profile"}),e.jsxs(Gt,{sx:{display:"flex",flexDirection:"row",gap:3,alignItems:"flex-start"},children:[e.jsxs(m,{sx:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:110},children:[e.jsx(ye,{src:l||r?.avatar_url||"",alt:n||r?.name||"Avatar",sx:{width:96,height:96,mb:1}}),e.jsxs(g,{level:"body-xs",sx:{mt:1,textAlign:"center"},children:["Last login:",e.jsx("br",{}),r?.last_login?new Date(r.last_login).toLocaleString():"Never"]})]}),e.jsx(ot,{orientation:"vertical",sx:{mx:1,alignSelf:"stretch"}}),e.jsxs(m,{sx:{flex:1,display:"flex",flexDirection:"column",gap:2},children:[e.jsx(g,{level:"body-sm",children:"Name"}),e.jsx(q,{placeholder:"Your name",value:n,onChange:h=>i(h.target.value),sx:{mb:1},required:!0}),e.jsx(g,{level:"body-sm",children:"Avatar URL"}),e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(q,{placeholder:"Avatar image URL",value:l,onChange:h=>o(h.target.value),sx:{flex:1}}),e.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},ref:w,onChange:_,disabled:c}),e.jsx(ne,{component:"span",onClick:()=>w.current?.click(),disabled:c,title:"Upload from device",children:e.jsx(Vn,{})})]}),x&&e.jsx(g,{color:"danger",sx:{mt:1},children:x})]})]}),e.jsxs(Zt,{children:[e.jsx(F,{variant:"plain",onClick:t,disabled:c,children:"Cancel"}),e.jsx(F,{onClick:()=>{a(),t()},disabled:c||!n,children:"Save"})]})]})})}const Ts=s=>t=>{const[r,n]=H.useState(null),[i,l]=H.useState(!0);return H.useEffect(()=>{async function o(){const{data:a}=await L.auth.getSession();n(a?.session||null),l(!1)}o()},[]),i?e.jsx("div",{children:"Loading..."}):r?e.jsx(s,{...t}):e.jsx(qt,{to:"/login",replace:!0})},ji=[{label:"Home",icon:H.createElement(Jn),value:"home",route:"/",showInMobile:!0},{label:"Dashboard",icon:H.createElement(Rs),value:"dashboard",route:"/dashboard",showInMobile:!0},{label:"Orders",icon:H.createElement(_s),value:"orders",route:"/orders",showInMobile:!0},{label:"Products",icon:H.createElement(Lr),value:"products",route:"/products",showInMobile:!0},{label:"Users",icon:H.createElement(Ps),value:"users",route:"/users",showInMobile:!0},{label:"Suppliers",icon:H.createElement(Nr),value:"suppliers",route:"/suppliers",showInMobile:!0},{label:"Purchase Orders",icon:H.createElement(Mr),value:"purchaseorders",route:"/purchase-orders",showInMobile:!0},{label:"Tickets",icon:H.createElement(Fr),value:"tickets",route:"/tickets",showInMobile:!0},{label:"SMS Campaigns",icon:H.createElement(Lt),value:"smscampaigns",route:"/sms-campaigns",showInMobile:!0},{label:"Movements",icon:H.createElement(Lt),value:"movements",route:"/movements",showInMobile:!0},{label:"Settings",icon:H.createElement(Nt),value:"settings",route:"/settings",showInMobile:!1}],At={Sales:[{label:"Dashboard",icon:H.createElement(Rs),value:"dashboard",route:"/dashboard",showInMobile:!0},{label:"Orders",icon:H.createElement(_s),value:"orders",route:"/orders",showInMobile:!0},{label:"Products",icon:H.createElement(Lr),value:"products",route:"/products",showInMobile:!0}],Support:[{label:"Tickets",icon:H.createElement(Fr),value:"tickets",route:"/tickets",showInMobile:!0},{label:"Users",icon:H.createElement(Ps),value:"users",route:"/users",showInMobile:!0}],Marketing:[{label:"SMS Campaigns",icon:H.createElement(Lt),value:"smscampaigns",route:"/sms-campaigns",showInMobile:!0}],Operations:[{label:"Suppliers",icon:H.createElement(Nr),value:"suppliers",route:"/suppliers",showInMobile:!0},{label:"Purchase Orders",icon:H.createElement(Mr),value:"purchaseorders",route:"/purchase-orders",showInMobile:!0},{label:"Movements",icon:H.createElement(Lt),value:"movements",route:"/movements",showInMobile:!0}]};function Se(){const s=On(),t=Pt("(max-width:600px)"),r=Pt("(min-width:601px) and (max-width:1024px)"),n=Pt("(min-width:1025px)");return{isMobile:t,isTablet:r,isDesktop:n,isSmallScreen:t,isMediumScreen:r,isLargeScreen:n,breakpoints:{mobile:"600px",tablet:"1024px",desktop:"1025px"},theme:s}}function Wr(){const{isMobile:s,isTablet:t}=Se();return{containerPadding:s?1:t?2:3,sectionPadding:s?2:t?3:4,itemPadding:s?1:2,smallGap:s?1:2,mediumGap:s?2:3,largeGap:s?3:4,sectionMargin:s?2:3,itemMargin:s?1:2}}function bi(){const{isMobile:s}=Se();return{getModalSize:(r="medium")=>s?{width:"95vw",height:r==="fullscreen"?"95vh":"auto",maxHeight:"90vh",margin:1}:{small:{width:400,maxWidth:"90vw"},medium:{width:600,maxWidth:"90vw"},large:{width:800,maxWidth:"90vw"},fullscreen:{width:"90vw",height:"90vh"}}[r]}}function yi({setView:s,view:t}){const r=Os(),n=Is(),{isMobile:i,isTablet:l,isDesktop:o}=Se(),[a,c]=u.useState(!1),[d,x]=u.useState([]),[f,w]=u.useState(null),[_,h]=u.useState(null),[b,S]=u.useState(!1),[O,C]=u.useState(""),[j,P]=u.useState(""),[R,A]=u.useState(!1);u.useEffect(()=>{async function T(){const{data:E,error:N}=await L.from("users").select("*");!N&&E&&x(E)}T();async function v(E){if(w(E),E){let{data:N}=await L.from("users").select("*").eq("id",E.id).single();N||(await L.from("users").upsert({id:E.id,email:E.email,name:E.user_metadata?.full_name||null,avatar_url:E.user_metadata?.avatar_url||null,role:"employee"}),N={...E,role:"employee"}),h(N),C(N.name||""),P(N.avatar_url||"")}else h(null),C(""),P("")}L.auth.getUser().then(({data:E})=>v(E.user));const{data:I}=L.auth.onAuthStateChange((E,N)=>{v(N?.user??null)});return()=>{I?.subscription.unsubscribe()}},[]);const k=async()=>{if(!f)return;await L.from("users").update({name:O,avatar_url:j}).eq("id",f.id);const{data:T}=await L.from("users").select("*").eq("id",f.id).single();h(T||null),S(!1)};u.useEffect(()=>{l&&c(!0)},[l,o]);const $=T=>{r(T.route),s(T.value),l&&c(!0)},se=()=>{c(!a)},Z=(T,v)=>{$({value:v,route:T})},le=T=>n.pathname===T;return e.jsxs(m,{className:"Sidebar",sx:{display:i?"none":"flex",position:{xs:"fixed",md:"sticky"},transform:{xs:"translateX(calc(100% * (var(--SideNavigation-slideIn, 0) - 1)))",md:"none"},transition:"transform 0.4s, width 0.4s",zIndex:1e4,height:"100dvh",width:"var(--Sidebar-width)",top:0,p:2,flexShrink:0,flexDirection:"column",gap:2,borderRight:"1px solid",borderColor:"divider",background:"var(--joy-palette-background-surface, #fff)"},children:[e.jsx(In,{styles:T=>({":root":{"--Sidebar-width":a?"60px":"220px",[T.breakpoints.up("lg")]:{"--Sidebar-width":a?"60px":"240px"}}})}),e.jsx(m,{className:"Sidebar-overlay",sx:{position:"fixed",zIndex:9998,top:0,left:0,width:"100vw",height:"100vh",opacity:"var(--SideNavigation-slideIn)",backgroundColor:"var(--joy-palette-background-backdrop)",transition:"opacity 0.4s",transform:{xs:"translateX(calc(100% * (var(--SideNavigation-slideIn, 0) - 1) + var(--SideNavigation-slideIn, 0) * var(--Sidebar-width, 0px)))",lg:"translateX(-100%)"}}}),e.jsxs(m,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(ne,{size:"sm",variant:"plain",onClick:se,sx:{p:.5,borderRadius:1,"&:hover":{bgcolor:"neutral.100"}},children:e.jsx("img",{src:"/favicon.svg",alt:"Logo",style:{width:28,height:28,borderRadius:6}})}),!a&&e.jsxs(e.Fragment,{children:[e.jsx(g,{level:"title-lg",children:"Smartbuy"}),e.jsx(mi,{sx:{ml:"auto"}})]})]}),!a&&e.jsx(q,{size:"sm",startDecorator:e.jsx(Gn,{}),placeholder:"Search"}),e.jsx(m,{sx:{minHeight:0,overflowY:"auto",overflowX:"hidden",flex:"0 0 auto",display:"flex",flexDirection:"column",[`& .${Dn.root}`]:{gap:1.5}},children:e.jsx(Et,{size:"sm",sx:{gap:1,"--List-nestedInsetStart":"30px","--ListItem-radius":T=>T.vars.radius.sm},children:["Sales","Support","Operations","Marketing"].map(T=>e.jsx(pt,{nested:!0,children:e.jsx(wi,{defaultExpanded:!a,renderToggle:({open:v,setOpen:I})=>a?e.jsx(ft,{title:T,placement:"right",arrow:!0,children:e.jsx(Ne,{onClick:()=>I(!v),children:At[T][0]?.icon})}):e.jsxs(Ne,{onClick:()=>I(!v),children:[At[T][0]?.icon,e.jsx(St,{children:e.jsx(g,{level:"title-sm",children:T})}),e.jsx(Zn,{sx:[v?{transform:"rotate(180deg)"}:{transform:"none"}]})]}),children:e.jsx(Et,{sx:{gap:.5},children:At[T].map(v=>e.jsx(pt,{children:a?e.jsx(ft,{title:v.label,placement:"right",arrow:!0,children:e.jsx(Ne,{selected:le(v.route),onClick:()=>Z(v.route,v.value),sx:{justifyContent:"center",px:1,width:"100%"},children:v.icon})}):e.jsxs(Ne,{selected:le(v.route),onClick:()=>Z(v.route,v.value),sx:{justifyContent:"flex-start",px:2,width:"100%"},children:[v.icon,e.jsx(St,{children:e.jsx(g,{level:"body-sm",children:v.label})})]})},v.value))})})},T))})}),e.jsx(m,{sx:{mt:"auto",mb:2},children:e.jsxs(Et,{sx:{p:0},children:[e.jsx(pt,{sx:{p:0,alignItems:"stretch"},children:a?e.jsx(ft,{title:"Settings",placement:"right",arrow:!0,children:e.jsx(Ne,{selected:le("/settings"),onClick:()=>Z("/settings","settings"),sx:{width:"100%",alignItems:"center",minHeight:40,justifyContent:"center",px:1},children:e.jsx(Nt,{})})}):e.jsxs(Ne,{selected:le("/settings"),onClick:()=>Z("/settings","settings"),sx:{width:"100%",alignItems:"center",minHeight:40,justifyContent:"flex-start",px:2},children:[e.jsx(Nt,{sx:{mr:1}}),e.jsx(St,{sx:{display:"flex",alignItems:"center",p:0},children:e.jsx(g,{level:"body-sm",children:"Settings"})})]})}),e.jsx(pt,{sx:{p:0,alignItems:"stretch"},children:a?e.jsx(ft,{title:"Logout",placement:"right",arrow:!0,children:e.jsx(Ne,{onClick:async()=>{await L.auth.signOut(),window.location.href="/login"},sx:{width:"100%",alignItems:"center",minHeight:40,justifyContent:"center",px:1},children:e.jsx(Zs,{})})}):e.jsxs(Ne,{onClick:async()=>{await L.auth.signOut(),window.location.href="/login"},sx:{width:"100%",alignItems:"center",minHeight:40,justifyContent:"flex-start",px:2},children:[e.jsx(Zs,{sx:{mr:1}}),e.jsx(St,{sx:{display:"flex",alignItems:"center",p:0},children:e.jsx(g,{level:"body-sm",children:"Logout"})})]})})]})}),e.jsx(ot,{}),e.jsxs(m,{sx:{display:"flex",gap:1,alignItems:"center",minHeight:48},children:[e.jsx(ye,{variant:"outlined",size:"sm",src:_?.avatar_url||f?.user_metadata?.avatar_url||void 0,onClick:()=>A(!0),sx:{cursor:"pointer"}}),e.jsxs(m,{sx:{minWidth:0,flex:1,cursor:"pointer"},onClick:()=>A(!0),children:[e.jsx(g,{level:"title-sm",children:_?.name||f?.user_metadata?.full_name||f?.email||"Not signed in"}),e.jsx(g,{level:"body-xs",children:_?.email||f?.email||""})]})]}),e.jsx(gi,{open:R,onClose:()=>A(!1),userProfile:_,editName:O,setEditName:C,editAvatar:j,setEditAvatar:P,onSave:k})]})}function wi({defaultExpanded:s=!1,renderToggle:t,children:r}){const[n,i]=u.useState(s);return e.jsxs(u.Fragment,{children:[t({open:n,setOpen:i}),e.jsx(m,{sx:{display:"grid",transition:"0.2s ease","& > *":{overflow:"hidden"},gridTemplateRows:n?"1fr":"0fr"},children:r})]})}const Si=Ts(yi);function ge({children:s,variant:t="page",padding:r="medium",fullHeight:n=!1,className:i}){Se();const l=Wr(),o=()=>r==="none"?0:{small:l.itemPadding,medium:l.containerPadding,large:l.sectionPadding}[r]||l.containerPadding,a=()=>{const c={p:o(),boxSizing:"border-box"};switch(t){case"page":return{...c,height:n?"100%":"auto",overflow:"auto",width:"100%"};case"dialog":return{...c,height:"auto",overflow:"visible"};case"form":return{...c,display:"flex",flexDirection:"column",gap:l.mediumGap};case"card":return{...c,borderRadius:1,bgcolor:"background.surface"};default:return c}};return e.jsx(m,{sx:a(),className:i,children:s})}function $t({open:s,onClose:t,children:r,title:n,size:i="medium",showCloseButton:l=!0,actions:o}){const{getModalSize:a}=bi();return e.jsx(_e,{open:s,onClose:t,children:e.jsxs(Pe,{sx:a(i),children:[l&&e.jsx(Ve,{}),n&&e.jsx(Jt,{children:n}),e.jsx(Gt,{children:r}),o&&e.jsx(Zt,{children:o})]})})}const Ue=({children:s})=>e.jsx(m,{sx:{display:"flex",flexDirection:"column",pl:"16px",pr:"6px",pt:"6px",width:"100%",flex:1,minHeight:0,height:"100%",overflow:"hidden",bgcolor:"background.body"},children:s}),vi=({open:s,creating:t,newOrder:r,setNewOrder:n,onClose:i,onCreate:l})=>{const[o,a]=u.useState([]),[c,d]=u.useState([{id:crypto.randomUUID(),product:null,quantity:1,unitprice:0,discount:0}]),[x,f]=u.useState(!1),[w,_]=u.useState(null),[h,b]=u.useState(null),[S,O]=u.useState(0),[C,j]=u.useState(!1),[P,R]=u.useState(null),[A,k]=u.useState(!1);u.useEffect(()=>{s&&(d([{id:crypto.randomUUID(),product:null,quantity:1,unitprice:0,discount:0}]),_(null),n(T=>({...T,date:T.date||new Date().toISOString().slice(0,10)})))},[s]),u.useEffect(()=>{s&&(f(!0),b(null),L.from("Products").select("*").then(({data:T,error:v})=>{!v&&T?(T.length===0&&b("No products available. Please add products first."),a(T.map(I=>({id:I.uuid||I.id,ProductName:I.ProductName,SalesPrice:I.SalesPrice??0})))):b("Failed to load products. Please try again later."),f(!1)}))},[s]);const $=()=>{d(T=>[...T,{id:crypto.randomUUID(),product:null,quantity:1,unitprice:0,discount:S}])},se=T=>{d(v=>v.filter((I,E)=>E!==T))},Z=(T,v,I)=>{d(E=>E.map((N,he)=>{if(he!==T)return N;if(v==="product"&&I){const Oe=o.find(re=>re.id===I.id);return{...N,product:I,unitprice:Oe?.SalesPrice??0}}return v==="product"&&!I?{...N,product:null,unitprice:0}:{...N,[v]:I}}))},le=T=>{T.preventDefault();const v=c.filter(I=>I.product&&I.product.id&&I.quantity>0).map(I=>({product_uuid:I.product.id,quantity:I.quantity,unitprice:I.unitprice,discount:I.discount}));if(v.length===0){_("Please add at least one valid order item.");return}_(null),l(v,S)};return e.jsx(_e,{open:s,onClose:i,"aria-labelledby":"create-order-modal",children:e.jsxs(Pe,{"aria-labelledby":"create-order-modal",sx:{maxWidth:600,width:"100%",minWidth:{xs:300,sm:400}},children:[e.jsx(Ve,{}),e.jsx(g,{id:"create-order-modal",level:"h4",sx:{mb:2},children:"Create Order"}),e.jsxs("form",{onSubmit:le,children:[e.jsxs(de,{sx:{mb:2},required:!0,children:[e.jsx(ue,{children:"Date"}),e.jsx(q,{type:"date",value:r.date,onChange:T=>n(v=>({...v,date:T.target.value})),required:!0})]}),e.jsxs(de,{sx:{mb:2},required:!0,children:[e.jsx(ue,{children:"Status"}),e.jsxs(ee,{value:r.status,onChange:(T,v)=>n(I=>({...I,status:v||"Paid"})),children:[e.jsx(z,{value:"Paid",children:"Paid"}),e.jsx(z,{value:"Refunded",children:"Refunded"}),e.jsx(z,{value:"Cancelled",children:"Cancelled"})]})]}),e.jsxs(de,{sx:{mb:2},required:!0,children:[e.jsx(ue,{children:"Customer Name"}),e.jsx(q,{value:r.customer_name,onChange:T=>n(v=>({...v,customer_name:T.target.value})),required:!0})]}),e.jsxs(de,{sx:{mb:2},required:!0,children:[e.jsx(ue,{children:"Customer Email"}),e.jsx(q,{type:"email",value:r.customer_email,onChange:T=>n(v=>({...v,customer_email:T.target.value})),required:!0})]}),e.jsxs(de,{sx:{mb:2},required:!0,children:[e.jsx(ue,{children:"Order Discount (%)"}),e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(q,{type:"number",value:S,disabled:c.length>0&&!(c.length===1&&!c[0].product),onChange:T=>{const v=Math.max(0,Math.min(100,Math.floor(Number(T.target.value))));O(v),d(I=>I.map(E=>({...E,discount:v})))},slotProps:{input:{min:0,max:100,step:1}},required:!0,placeholder:"Order Discount %",sx:{flex:1}}),(c.length>1||c.length===1&&c[0].product)&&e.jsx(F,{size:"sm",variant:"outlined",onClick:()=>j(!0),children:"Edit"})]})]}),w&&e.jsx(g,{color:"danger",sx:{mb:1},children:w}),e.jsx(ot,{sx:{my:2}}),e.jsx(m,{sx:{mb:1,fontWeight:"lg",fontSize:"lg"},children:"Order Items"}),h&&e.jsx(g,{color:"danger",sx:{mb:1},children:h}),c.map((T,v)=>e.jsxs(m,{sx:{display:"flex",gap:1,alignItems:"center",mb:1},children:[e.jsx(ks,{options:o,getOptionLabel:I=>I.ProductName,isOptionEqualToValue:(I,E)=>I.id===E.id,value:T.product,onChange:(I,E)=>Z(v,"product",E),loading:x,placeholder:x?"Loading...":"Search product",sx:{minWidth:220},disabled:o.length===0,required:!0,renderOption:(I,E)=>e.jsx("li",{...I,children:E.ProductName})}),e.jsx(q,{type:"number",value:T.quantity,onChange:I=>Z(v,"quantity",Math.max(1,Number(I.target.value))),sx:{width:80},required:!0,slotProps:{input:{min:1}}}),e.jsx(q,{type:"number",value:T.unitprice,onChange:I=>Z(v,"unitprice",Math.max(0,Number(I.target.value))),sx:{width:100},required:!0,slotProps:{input:{min:0,step:.01}},placeholder:"Unit Price"}),e.jsx(q,{type:"number",value:T.discount,onChange:I=>Z(v,"discount",Math.max(0,Math.min(100,Math.floor(Number(I.target.value))))),sx:{width:80},required:!0,slotProps:{input:{min:0,max:100,step:1}},placeholder:"Discount %"}),e.jsx(ne,{size:"sm",color:"danger",onClick:()=>se(v),disabled:c.length===1,children:e.jsx(gt,{})})]},T.id)),e.jsx(F,{startDecorator:e.jsx(oe,{}),variant:"soft",size:"sm",onClick:$,sx:{mb:2},disabled:!!h,children:"Add Item"}),e.jsx(_e,{open:C,onClose:()=>j(!1),children:e.jsxs(Pe,{sx:{minWidth:350},children:[e.jsx(g,{level:"title-md",sx:{mb:1},children:"Change Order Discount"}),e.jsxs(de,{sx:{mb:2},required:!0,children:[e.jsx(ue,{children:"Change discount to (%)"}),e.jsx(q,{type:"number",value:P??S,onChange:T=>R(Math.max(0,Math.min(100,Math.floor(Number(T.target.value))))),slotProps:{input:{min:0,max:100,step:1}},required:!0,autoFocus:!0})]}),e.jsx(g,{sx:{mb:2},children:"How do you want to apply the new order discount?"}),e.jsxs(m,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[e.jsx(F,{onClick:()=>{O(P),d(T=>T.map(v=>({...v,discount:P}))),j(!1),R(null)},children:"Overwrite all"}),e.jsx(F,{onClick:()=>{O(P),d(T=>T.map(v=>v.discount<P?{...v,discount:P}:v)),j(!1),R(null)},children:"Set discount on lower"}),e.jsx(F,{variant:"plain",onClick:()=>{j(!1),R(null)},children:"Cancel"})]})]})}),e.jsxs(m,{sx:{display:"flex",gap:2,mt:2},children:[e.jsx(F,{type:"submit",loading:t,color:"primary",disabled:!!h,children:"Create"}),e.jsx(F,{variant:"plain",onClick:i,disabled:t,children:"Cancel"})]})]})]})})};function ki({open:s,onClose:t,selectedOrder:r,fetchOrderItems:n}){const[i,l]=u.useState([]),[o,a]=u.useState(!1);return u.useEffect(()=>{async function c(){if(r){a(!0);const d=await n(r.uuid);l(d),a(!1)}else l([])}s&&r?c():l([])},[s,r,n]),e.jsx(_e,{open:s,onClose:t,"aria-labelledby":"order-details-modal",children:e.jsxs(Pe,{"aria-labelledby":"order-details-modal",sx:{maxWidth:600,width:"100%"},children:[e.jsx(Ve,{}),e.jsx(g,{id:"order-details-modal",level:"title-md",fontWeight:"lg",sx:{mb:2},children:"Order Details"}),r&&e.jsxs(m,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(m,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(g,{level:"body-sm",sx:{color:"text.secondary"},children:["Order ID: ",r.uuid]}),e.jsxs(g,{level:"body-sm",sx:{color:"text.secondary"},children:["Date: ",new Date(r.date).toLocaleString()]}),e.jsxs(g,{level:"body-sm",sx:{color:"text.secondary"},children:["Status: ",r.status]})]}),e.jsx(ot,{}),e.jsxs(m,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(g,{level:"body-sm",fontWeight:"md",children:"Customer Information"}),e.jsxs(g,{level:"body-sm",sx:{color:"text.secondary"},children:["Name: ",r.customer.name]}),e.jsxs(g,{level:"body-sm",sx:{color:"text.secondary"},children:["Email: ",r.customer.email]})]}),e.jsx(ot,{}),e.jsxs(m,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(g,{level:"body-sm",fontWeight:"md",children:"Ordered Items"}),o?e.jsx(g,{level:"body-sm",sx:{color:"text.secondary"},children:"Loading items..."}):e.jsxs($e,{size:"sm",sx:{minWidth:500},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{style:{textAlign:"right"},children:"Quantity"}),e.jsx("th",{style:{textAlign:"right"},children:"Unit Price"}),e.jsx("th",{style:{textAlign:"right"},children:"Discount (%)"}),e.jsx("th",{style:{textAlign:"right"},children:"Total Price"})]})}),e.jsx("tbody",{children:i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{textAlign:"center",padding:"16px"},children:e.jsx(g,{level:"body-sm",sx:{color:"text.secondary"},children:"No items found for this order."})})}):i.map(function(c){return e.jsxs("tr",{children:[e.jsx("td",{children:c.name||c.product_uuid}),e.jsx("td",{style:{textAlign:"right"},children:c.quantity??"-"}),e.jsx("td",{style:{textAlign:"right"},children:c.unitprice!=null?`$${Number(c.unitprice).toFixed(2)}`:"-"}),e.jsx("td",{style:{textAlign:"right"},children:c.discount!=null?`${Number(c.discount).toFixed(2)}%`:"-"}),e.jsx("td",{style:{textAlign:"right"},children:c.price!=null?`$${Number(c.price).toFixed(2)}`:"-"})]},c.uuid)})})]})]})]})]})})}const G={sizes:{small:"0.875rem",xlarge:"1.5rem"}},je={fontSize:G.sizes.small},Ci=()=>{const{isMobile:s}=Se(),[t,r]=u.useState([]),[n,i]=u.useState(!1),[l,o]=u.useState(""),[a,c]=u.useState(""),[d,x]=u.useState(""),[f,w]=u.useState(""),[_,h]=u.useState(!1),[b,S]=u.useState(!1),[O,C]=u.useState(!1),[j,P]=u.useState(null),[R,A]=u.useState(!1),[k,$]=u.useState({date:new Date().toISOString().split("T")[0],status:"Paid",customer_name:"",customer_email:""}),[se,Z]=u.useState(!1),[le,T]=u.useState(""),[v,I]=u.useState("success"),E=(p,M="success")=>{T(p),I(M),Z(!0)},N=p=>{switch(p){case"Paid":return"success";case"Refunded":return"warning";case"Cancelled":return"danger";default:return"neutral"}},he=p=>{switch(p){case"Paid":return e.jsx(Qs,{});case"Refunded":return e.jsx(Qs,{});case"Cancelled":return e.jsx(Mt,{});default:return e.jsx(Mt,{})}},Oe=p=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(p),re=async()=>{i(!0);try{const{data:p,error:M}=await L.from("Orders").select("*");if(M){console.error("Error fetching orders:",M),E("Failed to fetch orders","danger");return}if(p){const Q=p.map(W=>({uuid:W.uuid,date:W.date||W.created_at||W["Created at"]||"",status:W.status||"Paid",customer:W.customer||{initial:W.customer_initial||(W.customer_name?W.customer_name[0]:"?"),name:W.customer_name||"Unknown",email:W.customer_email||""},order_number_display:W.order_number_display,order_total:typeof W.order_total=="number"?W.order_total:0,created_by:W.created_by||"",created_by_name:W.created_by_name||"",created_by_email:W.created_by_email||"",category:W.category||"purchase"})).sort((W,X)=>{const Y=new Date(W.date||0);return new Date(X.date||0).getTime()-Y.getTime()});r(Q)}}catch(p){console.error("Error fetching orders:",p),E("Failed to fetch orders","danger")}finally{i(!1)}},ve=async p=>{try{const{data:M,error:Q}=await L.from("OrderItems").select("*, Products:product_uuid(ProductName)").eq("order_uuid",p);return Q?(console.error("Error fetching order items:",Q),[]):M?.map(W=>({...W,product_name:W.Products?.ProductName||W.product_uuid}))||[]}catch(M){return console.error("Error fetching order items:",M),[]}};u.useEffect(()=>{re()},[]);const Le=t.filter(p=>{const M=!l||p.order_number_display?.toString().toLowerCase().includes(l.toLowerCase())||p.customer.name.toLowerCase().includes(l.toLowerCase())||p.customer.email.toLowerCase().includes(l.toLowerCase()),Q=!a||p.status===a,W=!d||p.category===d,X=!f||p.customer.name===f;return M&&Q&&W&&X}),Je=Array.from(new Set(t.map(p=>p.status))),dt=Array.from(new Set(t.map(p=>p.category||"purchase"))),Be=Array.from(new Set(t.map(p=>p.customer.name))),Ee=p=>{const M=t.find(Q=>Q.uuid===p||Q.order_number_display===p);M&&(P(M),C(!0))},rt=()=>{S(!0)},nt=async(p,M)=>{A(!0);try{const{data:Q,error:W}=await L.from("Orders").insert({date:k.date,status:k.status,customer_name:k.customer_name,customer_email:k.customer_email,order_total:p.reduce((X,Y)=>X+Y.quantity*Y.unitprice*(1-Y.discount/100),0)-M}).select().single();if(W){console.error("Error creating order:",W),E("Failed to create order","danger");return}if(p.length>0){const{error:X}=await L.from("OrderItems").insert(p.map(Y=>({order_uuid:Q.uuid,product_uuid:Y.product_uuid,quantity:Y.quantity,unitprice:Y.unitprice,discount_percent:Y.discount})));X&&(console.error("Error creating order items:",X),E("Order created but failed to add items","warning"))}E("Order created successfully","success"),S(!1),$({date:new Date().toISOString().split("T")[0],status:"Paid",customer_name:"",customer_email:""}),re()}catch(Q){console.error("Error creating order:",Q),E("Failed to create order","danger")}finally{A(!1)}},it=()=>{h(!1)},D=()=>{c(""),x(""),w("")},B=()=>e.jsxs(m,{sx:{pb:2},children:[e.jsxs(ge,{variant:"page",padding:"medium",children:[e.jsxs(m,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(q,{placeholder:"Search orders...",value:l,onChange:p=>o(p.target.value),startDecorator:e.jsx(me,{}),sx:{flex:1,fontSize:"16px"}}),e.jsx(ne,{variant:"soft",onClick:()=>h(!0),sx:{flexShrink:0},children:e.jsx(Es,{})})]}),(a||d||f)&&e.jsxs(m,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:[a&&e.jsxs(K,{size:"sm",variant:"soft",color:"primary",children:["Status: ",a]}),d&&e.jsxs(K,{size:"sm",variant:"soft",color:"primary",children:["Category: ",d]}),f&&e.jsxs(K,{size:"sm",variant:"soft",color:"primary",children:["Customer: ",f]})]}),n&&e.jsx(Ae,{sx:{mb:2}})]}),e.jsx(m,{children:Le.length===0?e.jsx(m,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:n?"Loading orders...":"No orders found"})}):Le.map(p=>e.jsx(m,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider",cursor:"pointer","&:hover":{bgcolor:"background.level1"}},onClick:()=>Ee(p.uuid),children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(m,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${N(p.status)}.100`,color:`${N(p.status)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",flexShrink:0},children:he(p.status)}),e.jsxs(m,{sx:{flex:1,minWidth:0},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsxs(g,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:["Order #",p.order_number_display||p.uuid.substring(0,8)]}),e.jsx(K,{size:"sm",color:N(p.status),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content"},children:p.status})]}),e.jsxs(g,{level:"body-xs",color:"neutral",sx:{mb:.5},children:[p.customer.name," • ",new Date(p.date).toLocaleDateString()]}),p.order_total&&e.jsx(g,{level:"body-xs",sx:{fontWeight:"bold",color:"primary.600"},children:Oe(p.order_total)})]})]})},p.uuid))}),e.jsx(ne,{color:"primary",variant:"soft",size:"sm",sx:{position:"fixed",bottom:80,right:16,zIndex:1e3,borderRadius:"8px",width:40,height:40,boxShadow:"sm",bgcolor:"primary.100","&:hover":{bgcolor:"primary.200",boxShadow:"md"}},onClick:rt,children:e.jsx(oe,{fontSize:"small"})})]}),xe=()=>e.jsxs(ge,{variant:"page",padding:"large",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:G.sizes.xlarge},children:"Orders"}),e.jsxs(m,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(q,{placeholder:"Search orders...",sx:{flex:1,fontSize:G.sizes.small},value:l,onChange:p=>o(p.target.value),startDecorator:e.jsx(me,{})}),e.jsxs(ee,{placeholder:"Filter status",value:a,onChange:(p,M)=>c(M||""),sx:{minWidth:160,fontSize:G.sizes.small},children:[e.jsx(z,{value:"",children:"All Statuses"}),Je.map(p=>e.jsx(z,{value:p,children:p},p))]}),e.jsx(F,{variant:"solid",startDecorator:e.jsx(oe,{}),onClick:rt,sx:{fontSize:G.sizes.small},children:"Create Order"})]}),e.jsxs(ke,{children:[n&&e.jsx(Ae,{}),e.jsxs($e,{"aria-label":"Orders",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:je,children:"Order #"}),e.jsx("th",{style:je,children:"Date"}),e.jsx("th",{style:je,children:"Customer"}),e.jsx("th",{style:je,children:"Status"}),e.jsx("th",{style:je,children:"Total"}),e.jsx("th",{style:je,children:"Actions"})]})}),e.jsxs("tbody",{children:[Le.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{textAlign:"center",color:"#888",...je},children:n?"Loading orders...":"No orders found."})}),Le.map(p=>e.jsxs("tr",{style:{cursor:"pointer"},children:[e.jsx("td",{style:je,children:p.order_number_display||p.uuid.substring(0,8)}),e.jsx("td",{style:je,children:new Date(p.date).toLocaleDateString()}),e.jsx("td",{style:je,children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(m,{sx:{width:24,height:24,borderRadius:"50%",bgcolor:"primary.100",color:"primary.600",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold"},children:p.customer.initial}),e.jsxs(m,{children:[e.jsx(g,{level:"body-sm",sx:{fontWeight:"bold"},children:p.customer.name}),e.jsx(g,{level:"body-xs",color:"neutral",children:p.customer.email})]})]})}),e.jsx("td",{style:je,children:e.jsx(K,{size:"sm",variant:"soft",color:N(p.status),children:p.status})}),e.jsx("td",{style:je,children:e.jsx(g,{level:"body-sm",sx:{fontWeight:"bold"},children:p.order_total?Oe(p.order_total):"N/A"})}),e.jsx("td",{style:je,children:e.jsx(F,{size:"sm",variant:"soft",onClick:()=>Ee(p.uuid),children:"View"})})]},p.uuid))]})]})]})]});return e.jsxs(Ue,{children:[s?e.jsx(B,{}):e.jsx(xe,{}),e.jsx(vi,{open:b,creating:R,newOrder:k,setNewOrder:$,onClose:()=>S(!1),onCreate:nt}),e.jsx(ki,{open:O,onClose:()=>C(!1),selectedOrder:j,fetchOrderItems:ve}),s&&e.jsx($t,{open:_,onClose:it,title:"Filter Orders",size:"medium",actions:e.jsxs(m,{sx:{display:"flex",gap:2},children:[e.jsx(F,{variant:"plain",onClick:D,sx:je,children:"Clear All"}),e.jsx(F,{variant:"solid",onClick:it,sx:je,children:"Apply"})]}),children:e.jsxs(ie,{spacing:2,children:[e.jsxs(de,{children:[e.jsx(ue,{children:"Status"}),e.jsxs(ee,{placeholder:"All statuses",value:a,onChange:(p,M)=>c(M||""),children:[e.jsx(z,{value:"",children:"All Statuses"}),Je.map(p=>e.jsx(z,{value:p,children:p},p))]})]}),e.jsxs(de,{children:[e.jsx(ue,{children:"Category"}),e.jsxs(ee,{placeholder:"All categories",value:d,onChange:(p,M)=>x(M||""),children:[e.jsx(z,{value:"",children:"All Categories"}),dt.map(p=>e.jsx(z,{value:p,children:p},p))]})]}),e.jsxs(de,{children:[e.jsx(ue,{children:"Customer"}),e.jsxs(ee,{placeholder:"All customers",value:f,onChange:(p,M)=>w(M||""),children:[e.jsx(z,{value:"",children:"All Customers"}),Be.map(p=>e.jsx(z,{value:p,children:p},p))]})]})]})}),e.jsx(Qt,{open:se,onClose:()=>Z(!1),autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{top:16,zIndex:2e3},children:e.jsx(Cs,{color:v,variant:"solid",sx:{width:"100%"},children:le})})]})};function Ri({open:s,onClose:t,product:r,onSave:n}){const[i,l]=u.useState({ProductName:r?.ProductName||"",SalesPrice:r?.SalesPrice?.toString()||"",CostPrice:r?.CostPrice?.toString()||""}),[o,a]=u.useState(!1);u.useEffect(()=>{l({ProductName:r?.ProductName||"",SalesPrice:r?.SalesPrice?.toString()||"",CostPrice:r?.CostPrice?.toString()||""})},[r]);const c=async()=>{a(!0),await n(i),a(!1)};return e.jsx(_e,{open:s,onClose:t,"aria-labelledby":"product-table-form-title",children:e.jsxs(Pe,{children:[e.jsx(Jt,{id:"product-table-form-title",children:r?"Edit Product":"Add Product"}),e.jsxs(Gt,{children:[e.jsx(q,{name:"ProductName",value:i.ProductName,onChange:d=>l({...i,ProductName:d.target.value}),placeholder:"Product Name",sx:{mb:2}}),e.jsx(q,{name:"SalesPrice",value:i.SalesPrice,onChange:d=>l({...i,SalesPrice:d.target.value}),placeholder:"Sales Price",type:"number",sx:{mb:2}}),e.jsx(q,{name:"CostPrice",value:i.CostPrice,onChange:d=>l({...i,CostPrice:d.target.value}),placeholder:"Cost Price",type:"number"})]}),e.jsxs(Zt,{children:[e.jsx(F,{onClick:t,variant:"plain",disabled:o,children:"Cancel"}),e.jsx(F,{onClick:c,variant:"solid",loading:o,disabled:o,children:"Save"})]})]})})}const er=Ts(Ri),ae={fontSize:G.sizes.small},_i=()=>{const{isMobile:s}=Se(),[t,r]=u.useState([]),[n,i]=u.useState({}),[l,o]=u.useState(!1),[a,c]=u.useState(!1),[d,x]=u.useState(!1),[f,w]=u.useState(""),[_,h]=u.useState(""),[b,S]=u.useState(!1),[O,C]=u.useState(!1),[j,P]=u.useState(!1),[R,A]=u.useState(null),[k,$]=u.useState(!1),[se,Z]=u.useState(""),[le,T]=u.useState("success"),v=(D,B="success")=>{Z(D),T(B),$(!0)},I=D=>D<=0?{status:"Out of Stock",color:"danger"}:D<=10?{status:"Low Stock",color:"warning"}:{status:"In Stock",color:"success"},E=D=>{const B=I(D);return e.jsx(m,{sx:{width:20,height:20,borderRadius:"50%",bgcolor:`${B.color}.100`,color:`${B.color}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold"},children:e.jsx(Qn,{sx:{fontSize:"12px"}})})},N=D=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(D),he=async()=>{o(!0);try{const{data:D,error:B}=await L.from("Products").select("*").order("CreatedAt",{ascending:!1});if(B){console.error("Error fetching products:",B),v("Failed to fetch products","danger");return}D&&(r(D),await Oe(D))}catch(D){console.error("Error fetching products:",D),v("Failed to fetch products","danger")}finally{o(!1)}},Oe=async D=>{c(!0);try{const{data:B,error:xe}=await L.from("stock_movements").select("product_id, movement_type, quantity");if(xe){console.error("Error fetching stock data:",xe);return}if(B){const p={};D.forEach(M=>{const W=B.filter(X=>X.product_id===M.uuid).reduce((X,Y)=>{switch(Y.movement_type){case"incoming":case"adjustment":return X+(Y.quantity||0);case"outgoing":return X-(Y.quantity||0);default:return X}},0);p[M.uuid]=W}),i(p)}}catch(B){console.error("Error fetching stock levels:",B)}finally{c(!1)}};u.useEffect(()=>{he()},[]);const re=t.filter(D=>{const B=!f||D.ProductName.toLowerCase().includes(f.toLowerCase())||D.ProductID?.toLowerCase().includes(f.toLowerCase()),xe=n[D.uuid]||0,p=!_||_==="in-stock"&&xe>10||_==="low-stock"&&xe>0&&xe<=10||_==="out-of-stock"&&xe<=0;return B&&p}),ve=()=>{C(!0)},Le=D=>{A(D),P(!0)},Je=async D=>{if(confirm("Are you sure you want to delete this product?")){x(!0);try{const{error:B}=await L.from("Products").delete().eq("uuid",D);if(B){console.error("Error deleting product:",B),v("Failed to delete product","danger");return}r(t.filter(xe=>xe.uuid!==D)),v("Product deleted successfully","success")}catch(B){console.error("Error deleting product:",B),v("Failed to delete product","danger")}finally{x(!1)}}},dt=async D=>{x(!0);try{const{data:B,error:xe}=await L.from("Products").insert([{ProductName:D.ProductName,SalesPrice:parseFloat(D.SalesPrice),CostPrice:parseFloat(D.CostPrice),CreatedAt:new Date().toISOString()}]).select().single();if(xe){console.error("Error adding product:",xe),v("Failed to add product","danger");return}v("Product added successfully","success"),C(!1),he()}catch(B){console.error("Error adding product:",B),v("Failed to add product","danger")}finally{x(!1)}},Be=async D=>{if(R){x(!0);try{const{error:B}=await L.from("Products").update({ProductName:D.ProductName,SalesPrice:parseFloat(D.SalesPrice),CostPrice:parseFloat(D.CostPrice)}).eq("uuid",R.uuid);if(B){console.error("Error updating product:",B),v("Failed to update product","danger");return}v("Product updated successfully","success"),P(!1),A(null),he()}catch(B){console.error("Error updating product:",B),v("Failed to update product","danger")}finally{x(!1)}}},Ee=()=>{S(!1)},rt=()=>{h("")},nt=()=>e.jsxs(m,{sx:{pb:2},children:[e.jsxs(ge,{variant:"page",padding:"medium",children:[e.jsxs(m,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(q,{placeholder:"Search products...",value:f,onChange:D=>w(D.target.value),startDecorator:e.jsx(me,{}),sx:{flex:1,fontSize:"16px"}}),e.jsx(ne,{variant:"soft",onClick:()=>S(!0),sx:{flexShrink:0},children:e.jsx(Es,{})})]}),_&&e.jsx(m,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:e.jsxs(K,{size:"sm",variant:"soft",color:"primary",children:["Stock: ",_.replace("-"," ")]})}),l&&e.jsx(Ae,{sx:{mb:2}})]}),e.jsx(m,{children:re.length===0?e.jsx(m,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:l?"Loading products...":"No products found"})}):re.map(D=>e.jsx(m,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(m,{sx:{flexShrink:0},children:D.ImageUrl?e.jsx(ye,{src:D.ImageUrl,sx:{width:48,height:48},alt:D.ProductName}):e.jsx(ye,{sx:{width:48,height:48,bgcolor:"neutral.100"},children:e.jsx(Ks,{})})}),e.jsxs(m,{sx:{flex:1,minWidth:0},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:D.ProductName}),e.jsx(m,{sx:{display:"flex",alignItems:"center",gap:1},children:a?e.jsx(g,{level:"body-xs",color:"neutral",children:"..."}):e.jsxs(e.Fragment,{children:[E(n[D.uuid]||0),e.jsx(K,{size:"sm",color:I(n[D.uuid]||0).color,variant:"soft",sx:{fontSize:"10px",minWidth:"fit-content"},children:n[D.uuid]||0})]})})]}),e.jsxs(g,{level:"body-xs",color:"neutral",sx:{mb:.5},children:["ID: ",D.ProductID||"N/A"," • ",new Date(D.CreatedAt).toLocaleDateString()]}),e.jsxs(m,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(m,{children:[e.jsxs(g,{level:"body-xs",sx:{fontWeight:"bold",color:"success.600"},children:["Sale: ",N(D.SalesPrice)]}),e.jsxs(g,{level:"body-xs",color:"neutral",children:["Cost: ",N(D.CostPrice)]})]}),e.jsxs(m,{sx:{display:"flex",gap:.5},children:[e.jsx(ne,{size:"sm",variant:"soft",color:"primary",onClick:()=>Le(D),children:e.jsx(Ft,{})}),e.jsx(ne,{size:"sm",variant:"soft",color:"danger",onClick:()=>Je(D.uuid),disabled:d,children:e.jsx(gt,{})})]})]})]})]})},D.uuid))}),e.jsx(ne,{color:"primary",variant:"soft",size:"sm",sx:{position:"fixed",bottom:80,right:16,zIndex:1e3,borderRadius:"8px",width:40,height:40,boxShadow:"sm",bgcolor:"primary.100","&:hover":{bgcolor:"primary.200",boxShadow:"md"}},onClick:ve,children:e.jsx(oe,{fontSize:"small"})})]}),it=()=>e.jsxs(ge,{variant:"page",padding:"large",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:G.sizes.xlarge},children:"Products"}),e.jsxs(m,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(q,{placeholder:"Search products...",sx:{flex:1,fontSize:G.sizes.small},value:f,onChange:D=>w(D.target.value),startDecorator:e.jsx(me,{})}),e.jsxs(ee,{placeholder:"Filter by stock",value:_,onChange:(D,B)=>h(B||""),sx:{minWidth:160,fontSize:G.sizes.small},children:[e.jsx(z,{value:"",children:"All Stock Levels"}),e.jsx(z,{value:"in-stock",children:"In Stock"}),e.jsx(z,{value:"low-stock",children:"Low Stock"}),e.jsx(z,{value:"out-of-stock",children:"Out of Stock"})]}),e.jsx(F,{variant:"solid",startDecorator:e.jsx(oe,{}),onClick:ve,sx:{fontSize:G.sizes.small},children:"Add Product"})]}),e.jsxs(ke,{children:[l&&e.jsx(Ae,{}),e.jsxs($e,{"aria-label":"Products",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:ae,children:"Image"}),e.jsx("th",{style:ae,children:"Name"}),e.jsx("th",{style:ae,children:"Stock"}),e.jsx("th",{style:ae,children:"Sales Price"}),e.jsx("th",{style:ae,children:"Cost Price"}),e.jsx("th",{style:ae,children:"Created"}),e.jsx("th",{style:ae,children:"Actions"})]})}),e.jsxs("tbody",{children:[re.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...ae},children:l?"Loading products...":"No products found."})}),re.map(D=>e.jsxs("tr",{children:[e.jsx("td",{style:ae,children:D.ImageUrl?e.jsx(ye,{src:D.ImageUrl,sx:{width:32,height:32},alt:D.ProductName}):e.jsx(ye,{sx:{width:32,height:32,bgcolor:"neutral.100"},children:e.jsx(Ks,{sx:{fontSize:"16px"}})})}),e.jsx("td",{style:ae,children:e.jsxs(m,{children:[e.jsx(g,{level:"body-sm",sx:{fontWeight:"bold"},children:D.ProductName}),e.jsxs(g,{level:"body-xs",color:"neutral",children:["ID: ",D.ProductID||"N/A"]})]})}),e.jsx("td",{style:ae,children:a?e.jsx(g,{level:"body-sm",sx:{color:"neutral.500"},children:"Loading..."}):e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(K,{size:"sm",variant:"soft",color:I(n[D.uuid]||0).color,children:I(n[D.uuid]||0).status}),e.jsx(ft,{title:`Current stock level: ${n[D.uuid]||0} units`,arrow:!0,children:e.jsx(g,{level:"body-sm",sx:{fontWeight:"bold",color:I(n[D.uuid]||0).color==="danger"?"danger.500":I(n[D.uuid]||0).color==="warning"?"warning.600":"success.600"},children:n[D.uuid]||0})}),e.jsx(m,{sx:{width:40,height:4,bgcolor:"neutral.200",borderRadius:2,overflow:"hidden"},children:e.jsx(m,{sx:{width:`${Math.min(100,Math.max(0,(n[D.uuid]||0)/50*100))}%`,height:"100%",bgcolor:I(n[D.uuid]||0).color==="danger"?"danger.400":I(n[D.uuid]||0).color==="warning"?"warning.400":"success.400",borderRadius:2}})})]})}),e.jsx("td",{style:ae,children:e.jsx(g,{level:"body-sm",sx:{fontWeight:"bold",color:"success.600"},children:N(D.SalesPrice)})}),e.jsx("td",{style:ae,children:e.jsx(g,{level:"body-sm",color:"neutral",children:N(D.CostPrice)})}),e.jsx("td",{style:ae,children:new Date(D.CreatedAt).toLocaleDateString()}),e.jsx("td",{style:ae,children:e.jsxs(m,{sx:{display:"flex",gap:.5},children:[e.jsx(ne,{size:"sm",variant:"soft",color:"primary",onClick:()=>Le(D),children:e.jsx(Ft,{})}),e.jsx(ne,{size:"sm",variant:"soft",color:"danger",onClick:()=>Je(D.uuid),disabled:d,children:e.jsx(gt,{})})]})})]},D.uuid))]})]})]})]});return e.jsxs(Ue,{children:[s?e.jsx(nt,{}):e.jsx(it,{}),e.jsx(er,{open:O,onClose:()=>C(!1),product:null,onSave:dt}),e.jsx(er,{open:j,onClose:()=>{P(!1),A(null)},product:R,onSave:Be}),s&&e.jsx($t,{open:b,onClose:Ee,title:"Filter Products",size:"medium",actions:e.jsxs(m,{sx:{display:"flex",gap:2},children:[e.jsx(F,{variant:"plain",onClick:rt,sx:ae,children:"Clear All"}),e.jsx(F,{variant:"solid",onClick:Ee,sx:ae,children:"Apply"})]}),children:e.jsx(ie,{spacing:2,children:e.jsxs(de,{children:[e.jsx(ue,{children:"Stock Level"}),e.jsxs(ee,{placeholder:"All stock levels",value:_,onChange:(D,B)=>h(B||""),children:[e.jsx(z,{value:"",children:"All Stock Levels"}),e.jsx(z,{value:"in-stock",children:"In Stock"}),e.jsx(z,{value:"low-stock",children:"Low Stock"}),e.jsx(z,{value:"out-of-stock",children:"Out of Stock"})]})]})})}),e.jsx(Qt,{open:k,onClose:()=>$(!1),autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{top:16,zIndex:2e3},children:e.jsx(Cs,{color:le,variant:"solid",sx:{width:"100%"},children:se})})]})},We={fontSize:G.sizes.small},Ge={...We,fontWeight:600,borderBottom:"1.5px solid #e0e0e0",background:"inherit"},tr=s=>{switch(s?.toLowerCase()){case"admin":return"danger";case"manager":return"warning";case"user":return"primary";case"staff":return"success";default:return"neutral"}},sr=(s,t)=>{const r=s||t;let n=0;for(let l=0;l<r.length;l++)n=r.charCodeAt(l)+((n<<5)-n);const i=["primary","success","warning","danger","neutral"];return i[Math.abs(n)%i.length]},rr=(s,t)=>{if(s){const r=s.split(" ");return r.length>=2?(r[0][0]+r[1][0]).toUpperCase():s.substring(0,2).toUpperCase()}return t.substring(0,2).toUpperCase()};function Pi(){return e.jsxs(Ir,{children:[e.jsx(Dr,{slots:{root:ne},slotProps:{root:{variant:"plain",color:"neutral",size:"sm"}},children:e.jsx(Yn,{})}),e.jsxs(Tr,{size:"sm",sx:{minWidth:140},children:[e.jsx(lt,{children:"Edit"}),e.jsx(lt,{children:"Reset Password"}),e.jsx(lt,{children:"Disable"}),e.jsx(lt,{color:"danger",children:"Delete"})]})]})}const Ei=()=>{const{isMobile:s}=Se(),[t,r]=u.useState([]),[n,i]=u.useState(!1),[l,o]=u.useState(null),[a,c]=u.useState(""),[d,x]=u.useState("all"),[f,w]=u.useState(!1),_=async()=>{i(!0),o(null);try{const{data:j,error:P}=await L.from("users").select("*");if(P)throw P;if(j){const R=j.map(A=>({id:A.id,name:A.name||null,email:A.email,role:A.role||null,created_at:A.created_at||null,last_login:A.last_login||null,phone:A.phone||null}));r(R)}}catch(j){console.error("Error fetching users:",j),o(j.message||"Failed to fetch users")}finally{i(!1)}},h=Array.from(new Set(t.map(j=>j.role).filter(Boolean))),S=[...t.filter(j=>{const P=j.name?.toLowerCase().includes(a.toLowerCase())||j.email.toLowerCase().includes(a.toLowerCase()),R=d==="all"||j.role===d;return P&&R})].sort((j,P)=>{const R=j.name||j.email,A=P.name||P.email;return R.localeCompare(A)});u.useEffect(()=>{_()},[]);const O=()=>e.jsxs(m,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(ge,{padding:"medium",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:G.sizes.xlarge},children:"Users"}),e.jsxs(m,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(q,{placeholder:"Search users...",value:a,onChange:j=>c(j.target.value),startDecorator:e.jsx(me,{}),sx:{flex:1}}),e.jsxs(ee,{placeholder:"Role",value:d,onChange:(j,P)=>x(P??"all"),sx:{minWidth:120},children:[e.jsx(z,{value:"all",children:"All"}),h.map(j=>e.jsx(z,{value:j,children:j},j))]})]}),e.jsx(F,{variant:"solid",startDecorator:e.jsx(oe,{}),onClick:()=>w(!0),sx:{width:"100%",mb:2},children:"Create User"})]}),n&&e.jsx(Ae,{}),l&&e.jsx(m,{sx:{p:2},children:e.jsxs(g,{color:"danger",children:["Error: ",l]})}),e.jsx(m,{children:S.length===0?e.jsx(m,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:"No users found"})}):S.map(j=>e.jsx(m,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ye,{size:"md",color:sr(j.name,j.email),sx:{flexShrink:0},children:rr(j.name,j.email)}),e.jsxs(m,{sx:{flex:1,minWidth:0},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:j.name||"Unnamed User"}),j.role&&e.jsx(K,{size:"sm",color:tr(j.role),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content",textTransform:"capitalize"},children:j.role})]}),e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(qr,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsx(g,{level:"body-xs",color:"neutral",children:j.email})]}),e.jsxs(m,{sx:{display:"flex",gap:2,mb:.5},children:[j.phone&&e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx($r,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsx(g,{level:"body-xs",color:"neutral",children:j.phone})]}),j.last_login&&e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Kn,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsx(g,{level:"body-xs",color:"neutral",children:new Date(j.last_login).toLocaleDateString()})]})]}),j.created_at&&e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Xn,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsxs(g,{level:"body-xs",color:"neutral",children:["Joined ",new Date(j.created_at).toLocaleDateString()]})]})]})]})},j.id))})]}),C=()=>e.jsxs(ge,{children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:G.sizes.xlarge},children:"Users"}),e.jsxs(m,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(q,{placeholder:"Search users...",sx:{flex:1},value:a,onChange:j=>c(j.target.value),startDecorator:e.jsx(me,{})}),e.jsxs(ee,{placeholder:"Filter role",value:d,onChange:(j,P)=>x(P??"all"),sx:{minWidth:160},children:[e.jsx(z,{value:"all",children:"All Roles"}),h.map(j=>e.jsx(z,{value:j,children:j},j))]}),e.jsx(F,{onClick:()=>w(!0),variant:"solid",startDecorator:e.jsx(oe,{}),children:"Create User"})]}),e.jsxs(ke,{children:[n&&e.jsx(Ae,{}),l&&e.jsxs(g,{color:"danger",children:["Error: ",l]}),e.jsxs($e,{"aria-label":"Users",sx:{minWidth:800},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:Ge,children:"Name"}),e.jsx("th",{style:Ge,children:"Email"}),e.jsx("th",{style:Ge,children:"Role"}),e.jsx("th",{style:Ge,children:"Created At"}),e.jsx("th",{style:Ge,children:"Last Login"}),e.jsx("th",{style:Ge,children:"Phone"}),e.jsx("th",{style:{width:120,...Ge},children:"Actions"})]})}),e.jsxs("tbody",{children:[S.length===0&&!n&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...We},children:"No users found."})}),S.map(j=>e.jsxs("tr",{style:{cursor:"pointer",height:48},children:[e.jsx("td",{style:We,children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ye,{size:"sm",color:sr(j.name,j.email),children:rr(j.name,j.email)}),e.jsx(g,{level:"body-sm",fontWeight:"md",children:j.name||"Unnamed User"})]})}),e.jsx("td",{style:We,children:j.email}),e.jsx("td",{style:We,children:j.role?e.jsx(K,{size:"sm",color:tr(j.role),variant:"soft",sx:{textTransform:"capitalize"},children:j.role}):"-"}),e.jsx("td",{style:We,children:j.created_at?new Date(j.created_at).toLocaleDateString():"-"}),e.jsx("td",{style:We,children:j.last_login?new Date(j.last_login).toLocaleDateString():"-"}),e.jsx("td",{style:We,children:j.phone||"-"}),e.jsx("td",{children:e.jsx(Pi,{})})]},j.id))]})]})]})]});return e.jsxs(Ue,{children:[s?e.jsx(O,{}):e.jsx(C,{}),e.jsx(_e,{open:f,onClose:()=>w(!1),"aria-labelledby":"create-user-modal",children:e.jsxs(Pe,{"aria-labelledby":"create-user-modal",sx:{maxWidth:600,width:"100%"},children:[e.jsx(Ve,{}),e.jsx(g,{id:"create-user-modal",level:"title-md",fontWeight:"lg",sx:{mb:2},children:"Create User"}),e.jsx(g,{level:"body-sm",sx:{mb:2},children:"User creation functionality will be implemented here."}),e.jsx(F,{onClick:()=>w(!1),variant:"outlined",children:"Close"})]})})]})};function Hr({open:s,onClose:t,onSaved:r,mode:n="add",supplier:i}){const[l,o]=u.useState(i?.name||""),[a,c]=u.useState(i?.contact_name||""),[d,x]=u.useState(i?.email||""),[f,w]=u.useState(i?.phone||""),[_,h]=u.useState(i?.address||""),[b,S]=u.useState(!1),[O,C]=u.useState(null);u.useEffect(()=>{s&&n==="edit"&&i?(o(i.name||""),c(i.contact_name||""),x(i.email||""),w(i.phone||""),h(i.address||"")):s&&n==="add"&&(o(""),c(""),x(""),w(""),h(""))},[s,n,i]);const j=async()=>{S(!0),C(null);const P={name:l,contact_name:a,email:d,phone:f,address:_};let R;if(n==="add"){R=await L.from("Suppliers").insert([P]).select(),S(!1),R.error?C(R.error.message):r(R.data?.[0]?.id);return}else R=await L.from("Suppliers").update(P).eq("id",i?.id);S(!1),R.error?C(R.error.message):r()};return e.jsx(_e,{open:s,onClose:t,children:e.jsxs(Pe,{sx:{minWidth:400},children:[e.jsx(Ve,{}),e.jsxs(g,{level:"title-md",sx:{mb:2},children:[n==="edit"?"Edit":"Add"," Supplier"]}),e.jsxs("form",{onSubmit:P=>{P.preventDefault(),P.stopPropagation(),j()},children:[e.jsx(q,{placeholder:"Name",value:l,onChange:P=>o(P.target.value),sx:{mb:2},required:!0}),e.jsx(q,{placeholder:"Contact Name",value:a,onChange:P=>c(P.target.value),sx:{mb:2}}),e.jsx(q,{placeholder:"Email",value:d,onChange:P=>x(P.target.value),sx:{mb:2},type:"email",required:!0}),e.jsx(q,{placeholder:"Phone",value:f,onChange:P=>w(P.target.value),sx:{mb:2},type:"tel"}),e.jsx(q,{placeholder:"Address",value:_,onChange:P=>h(P.target.value),sx:{mb:2}}),O&&e.jsx(g,{color:"danger",sx:{mb:1},children:O}),e.jsx(F,{type:"submit",loading:b,disabled:b,variant:"solid",children:"Save"})]})]})})}const nr=s=>{let t=0;for(let n=0;n<s.length;n++)t=s.charCodeAt(n)+((t<<5)-t);const r=["primary","success","warning","danger","neutral"];return r[Math.abs(t)%r.length]},ir=s=>{const t=s.split(" ");return t.length>=2?(t[0][0]+t[1][0]).toUpperCase():s.substring(0,2).toUpperCase()};function Ai({supplier:s,onEdit:t,onDelete:r}){return e.jsxs(Ir,{children:[e.jsx(Dr,{slots:{root:ne},slotProps:{root:{variant:"plain",color:"neutral",size:"sm"}},children:e.jsx(si,{})}),e.jsxs(Tr,{size:"sm",sx:{minWidth:120},children:[e.jsxs(lt,{onClick:()=>t(s),children:[e.jsx(Ft,{sx:{mr:1},fontSize:"small"}),"Edit"]}),e.jsxs(lt,{color:"danger",onClick:()=>r(s.id),children:[e.jsx(gt,{sx:{mr:1},fontSize:"small"}),"Delete"]})]})]})}const Oi=()=>{const{isMobile:s}=Se(),[t,r]=u.useState([]),[n,i]=u.useState(!1),[l,o]=u.useState(null),[a,c]=u.useState(""),[d,x]=u.useState(!1),[f,w]=u.useState(null),[_,h]=u.useState("view"),b=async()=>{i(!0),o(null);try{const{data:k,error:$}=await L.from("Suppliers").select("*");if($)throw $;k&&r(k)}catch(k){console.error("Error fetching suppliers:",k),o(k.message||"Failed to fetch suppliers")}finally{i(!1)}},S=k=>{w(k),h("edit"),x(!0)},O=async k=>{if(confirm("Are you sure you want to delete this supplier?"))try{const{error:$}=await L.from("Suppliers").delete().eq("id",k);if($)throw $;await b()}catch($){console.error("Error deleting supplier:",$),o($.message||"Failed to delete supplier")}},C=async()=>{x(!1),await b()},P=[...t.filter(k=>k.name?.toLowerCase().includes(a.toLowerCase())||k.contact_name?.toLowerCase().includes(a.toLowerCase())||k.email?.toLowerCase().includes(a.toLowerCase())||k.phone?.toLowerCase().includes(a.toLowerCase())||k.address?.toLowerCase().includes(a.toLowerCase()))].sort((k,$)=>k.name.localeCompare($.name));u.useEffect(()=>{b()},[]);const R=()=>e.jsxs(m,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(ge,{padding:"medium",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:G.sizes.xlarge},children:"Suppliers"}),e.jsx(m,{sx:{display:"flex",gap:1,mb:2},children:e.jsx(q,{placeholder:"Search suppliers...",value:a,onChange:k=>c(k.target.value),startDecorator:e.jsx(me,{}),sx:{flex:1}})}),e.jsx(F,{variant:"solid",startDecorator:e.jsx(oe,{}),onClick:()=>{w(null),h("add"),x(!0)},sx:{width:"100%",mb:2},children:"Add Supplier"})]}),n&&e.jsx(Ae,{}),l&&e.jsx(m,{sx:{p:2},children:e.jsxs(g,{color:"danger",children:["Error: ",l]})}),e.jsx(m,{sx:{px:2},children:P.length===0?e.jsx(m,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:"No suppliers found"})}):P.map(k=>e.jsx(ke,{variant:"outlined",sx:{mb:2,"&:hover":{boxShadow:"sm"}},children:e.jsx(zt,{sx:{p:2},children:e.jsxs(m,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(ye,{size:"md",color:nr(k.name),sx:{flexShrink:0},children:k.image_url?e.jsx("img",{src:k.image_url,alt:k.name}):ir(k.name)}),e.jsxs(m,{sx:{flex:1,minWidth:0},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",mb:1},children:[e.jsx(g,{level:"title-md",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"calc(100% - 40px)"},children:k.name}),e.jsx(Ai,{supplier:k,onEdit:S,onDelete:O})]}),e.jsxs(ie,{spacing:.5,children:[k.contact_name&&e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ei,{sx:{fontSize:16,color:"text.tertiary"}}),e.jsx(g,{level:"body-sm",color:"neutral",children:k.contact_name})]}),k.email&&e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(qr,{sx:{fontSize:16,color:"text.tertiary"}}),e.jsx(g,{level:"body-sm",color:"neutral",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:k.email})]}),k.phone&&e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx($r,{sx:{fontSize:16,color:"text.tertiary"}}),e.jsx(g,{level:"body-sm",color:"neutral",children:k.phone})]}),k.address&&e.jsxs(m,{sx:{display:"flex",alignItems:"flex-start",gap:1,mt:.5},children:[e.jsx(ti,{sx:{fontSize:16,color:"text.tertiary",mt:.25}}),e.jsx(g,{level:"body-sm",color:"neutral",sx:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.2},children:k.address})]})]})]})]})})},k.id))})]}),A=()=>e.jsxs(ge,{children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:G.sizes.xlarge},children:"Suppliers"}),e.jsxs(m,{sx:{display:"flex",gap:2,mb:3,alignItems:"center"},children:[e.jsx(q,{placeholder:"Search suppliers...",value:a,onChange:k=>c(k.target.value),startDecorator:e.jsx(me,{}),sx:{flex:1}}),e.jsx(F,{variant:"solid",startDecorator:e.jsx(oe,{}),onClick:()=>{w(null),h("add"),x(!0)},sx:{minWidth:140},children:"Add Supplier"})]}),n&&e.jsx(Ae,{sx:{mb:2}}),l&&e.jsxs(g,{color:"danger",sx:{mb:2},children:["Error: ",l]}),e.jsx(Ke,{container:!0,spacing:2,children:P.length===0?e.jsx(Ke,{xs:12,children:e.jsx(m,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:"No suppliers found"})})}):P.map(k=>e.jsx(Ke,{xs:12,md:6,lg:4,children:e.jsx(ke,{variant:"outlined",sx:{height:"100%"},children:e.jsxs(zt,{children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(ye,{size:"sm",color:nr(k.name),children:k.image_url?e.jsx("img",{src:k.image_url,alt:k.name}):ir(k.name)}),e.jsx(g,{level:"title-md",fontWeight:"bold",children:k.name})]}),e.jsxs(ie,{spacing:1,children:[e.jsxs(g,{level:"body-sm",children:[e.jsx("strong",{children:"Contact:"})," ",k.contact_name||"N/A"]}),e.jsxs(g,{level:"body-sm",children:[e.jsx("strong",{children:"Email:"})," ",k.email||"N/A"]}),e.jsxs(g,{level:"body-sm",children:[e.jsx("strong",{children:"Phone:"})," ",k.phone||"N/A"]}),e.jsxs(g,{level:"body-sm",children:[e.jsx("strong",{children:"Address:"})," ",k.address||"N/A"]})]}),e.jsxs(m,{sx:{display:"flex",gap:1,mt:2},children:[e.jsx(F,{size:"sm",variant:"outlined",startDecorator:e.jsx(Ft,{}),onClick:()=>S(k),children:"Edit"}),e.jsx(F,{size:"sm",variant:"outlined",color:"danger",startDecorator:e.jsx(gt,{}),onClick:()=>O(k.id),children:"Delete"})]})]})})},k.id))})]});return e.jsxs(Ue,{children:[s?e.jsx(R,{}):e.jsx(A,{}),e.jsx(Hr,{open:d,onClose:()=>x(!1),supplier:f,onSaved:C,mode:_==="edit"||_==="add"?_:void 0})]})};function Ii({orderId:s,editable:t,onItemsChange:r,initialItems:n=[]}){const[i,l]=u.useState(n),[o,a]=u.useState([]),[c,d]=u.useState(!1);u.useEffect(()=>{d(!0),L.from("Products").select("uuid, ProductName").then(({data:_,error:h})=>{h?console.error("Failed to fetch products:",h.message):a(_||[]),d(!1)})},[]);const x=(_,h,b)=>{l(S=>{const O=S.map((C,j)=>j===_?{...C,[h]:b}:C);return r&&r(O),O})},f=()=>{l(_=>{const h=[..._,{product_id:null,quantity_ordered:1,unit_price:0}];return r&&r(h),h})},w=_=>{l(h=>{const b=h.filter((S,O)=>O!==_);return r&&r(b),b})};return e.jsxs(m,{sx:{mt:2},children:[e.jsxs($e,{size:"sm",sx:{minWidth:500},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Quantity"}),e.jsx("th",{children:"Unit Price"}),e.jsx("th",{children:"Total"}),t&&e.jsx("th",{})]})}),e.jsx("tbody",{children:i.map((_,h)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(ks,{options:o,getOptionLabel:b=>b.ProductName,value:o.find(b=>b.uuid===_.product_id)||null,onChange:(b,S)=>x(h,"product_id",S?S.uuid:null),disabled:!t,sx:{minWidth:180},isOptionEqualToValue:(b,S)=>b.uuid===S.uuid,required:!0})}),e.jsx("td",{children:e.jsx(q,{type:"number",value:_.quantity_ordered??1,onChange:b=>x(h,"quantity_ordered",Math.max(1,Number(b.target.value))),disabled:!t,sx:{width:80},required:!0})}),e.jsx("td",{children:e.jsx(q,{type:"number",value:_.unit_price??0,onChange:b=>x(h,"unit_price",Math.max(0,Number(b.target.value))),disabled:!t,sx:{width:100},required:!0})}),e.jsx("td",{children:(_.quantity_ordered*_.unit_price).toFixed(2)}),t&&e.jsx("td",{children:e.jsx(F,{size:"sm",color:"danger",onClick:()=>w(h),children:"Remove"})})]},h))})]}),t&&e.jsx(F,{size:"sm",variant:"soft",onClick:f,sx:{mt:1},children:"Add Item"})]})}const kt=["Pending","Approved","Received","Cancelled"];function Di({open:s,onClose:t,onCreated:r,mode:n="add",order:i}){const[l,o]=u.useState(i?.order_number||""),[a,c]=u.useState(i?.order_date||new Date().toISOString().slice(0,10)),[d,x]=u.useState(i?.status||"Pending"),[f,w]=u.useState(i?.total?String(i.total):""),[_,h]=u.useState(i?.notes||""),[b,S]=u.useState(i?.supplier_id||null),[O,C]=u.useState(!1),[j,P]=u.useState(null),[R,A]=u.useState([]),[k,$]=u.useState(""),[se,Z]=u.useState(!1),[le,T]=u.useState([{product_id:null,quantity_ordered:1,unit_price:0}]);u.useRef(null),u.useEffect(()=>{s?(console.log("[PurchaseOrderForm] Modal opened"),L.from("Suppliers").select("id, name").then(({data:E})=>{A(E||[])}),n==="edit"&&i?.id?L.from("purchaseorderitems").select("*").eq("purchase_order_id",i.id).then(({data:E})=>{T(E||[])}):n==="add"&&T([{product_id:null,quantity_ordered:1,unit_price:0}])):console.log("[PurchaseOrderForm] Modal closed")},[s,n,i]);const v=async E=>{console.log("[PurchaseOrderForm] handleSupplierAdded called");const{data:N}=await L.from("Suppliers").select("id, name");A(N||[]),E&&(S(String(E)),console.log("[PurchaseOrderForm] New supplier set:",E)),Z(!1),console.log("[PurchaseOrderForm] SupplierForm closed")},I=async()=>{console.log("[PurchaseOrderForm] handleSave called"),C(!0),P(null);const E={order_date:a,status:d,notes:_,supplier_id:b};n==="edit"&&(E.order_number=l),E.total=f?parseFloat(f):null;let N,he=i?.id;if(n==="add"?(N=await L.from("PurchaseOrders").insert([E]).select(),!N.error&&N.data&&N.data[0]&&(he=N.data[0].id)):i&&(N=await L.from("PurchaseOrders").update(E).eq("id",i.id)),N&&!N.error&&n==="add"&&he&&le.length>0){const Oe=le.filter(ve=>ve.product_id).map(ve=>({purchase_order_id:he,product_id:ve.product_id,quantity_ordered:ve.quantity_ordered,unit_price:ve.unit_price,notes:ve.notes||null}));if(Oe.length===0){P("Please select a product for each item before saving."),C(!1);return}const re=await L.from("purchaseorderitems").insert(Oe);if(re.error){P("Failed to save items: "+re.error.message),C(!1);return}}C(!1),N?.error?(P(N.error.message),console.log("[PurchaseOrderForm] Save error:",N.error.message)):(r(),t(),o(""),c(new Date().toISOString().slice(0,10)),x("Pending"),w(""),h(""),S(null),$(""),console.log("[PurchaseOrderForm] Purchase order saved and modal closed"))};return e.jsx(_e,{open:s,onClose:t,"aria-labelledby":"purchase-order-form-title",children:e.jsxs(Pe,{sx:{minWidth:400},children:[e.jsx(Ve,{}),e.jsxs(g,{id:"purchase-order-form-title",level:"title-md",sx:{mb:2},children:[n==="edit"?"Edit":"Add"," Purchase Order"]}),e.jsxs("form",{onSubmit:E=>{E.preventDefault(),I()},children:[e.jsx(q,{type:"date",value:a,onChange:E=>c(E.target.value),sx:{mb:2},required:!0}),e.jsx(ee,{value:d,onChange:(E,N)=>x(N??"Pending"),sx:{mb:2,display:"none"},required:!0,children:kt.map(E=>e.jsx(z,{value:E,children:E},E))}),n==="edit"&&e.jsx(m,{sx:{mb:2},children:e.jsx(K,{variant:"soft",color:d==="Approved"?"success":d==="Received"?"primary":d==="Cancelled"?"danger":"neutral",sx:{textTransform:"capitalize",fontWeight:600,fontSize:"md",px:1.5,py:.5},onClick:()=>{const E=kt.indexOf(d);x(kt[(E+1)%kt.length])},children:d})}),e.jsxs(m,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(ks,{options:R,getOptionLabel:E=>E.name,value:R.find(E=>E.id===b)||null,onChange:(E,N)=>S(N?N.id:null),inputValue:k,onInputChange:(E,N)=>$(N),placeholder:"Select supplier",sx:{flex:1,mb:0},isOptionEqualToValue:(E,N)=>E.id===N.id,required:!0}),e.jsx(ne,{color:"primary",sx:{ml:1},onClick:()=>Z(!0),children:e.jsx(oe,{})})]}),e.jsx(Hr,{open:se,onClose:()=>Z(!1),onSaved:v,mode:"add"}),n==="edit"&&e.jsxs(e.Fragment,{children:[e.jsx(q,{placeholder:"Order Number",value:l,onChange:E=>o(E.target.value),sx:{mb:2}}),e.jsx(q,{placeholder:"Total",value:f,onChange:E=>w(E.target.value),sx:{mb:2},type:"number",readOnly:!0})]}),e.jsx(q,{placeholder:"Notes",value:_,onChange:E=>h(E.target.value),sx:{mb:2}}),e.jsx(Ii,{orderId:i?.id,editable:n==="add",onItemsChange:T,initialItems:le}),e.jsx(m,{sx:{height:16}}),j&&e.jsx(g,{color:"danger",sx:{mb:1},children:j}),e.jsx(F,{type:"submit",loading:O,disabled:O,variant:"solid",children:"Save"})]})]})})}function Vr(s,t){return function(){return s.apply(t,arguments)}}const{toString:Ti}=Object.prototype,{getPrototypeOf:zs}=Object,{iterator:Kt,toStringTag:Jr}=Symbol,Xt=(s=>t=>{const r=Ti.call(t);return s[r]||(s[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),Ie=s=>(s=s.toLowerCase(),t=>Xt(t)===s),Yt=s=>t=>typeof t===s,{isArray:at}=Array,jt=Yt("undefined");function zi(s){return s!==null&&!jt(s)&&s.constructor!==null&&!jt(s.constructor)&&Ce(s.constructor.isBuffer)&&s.constructor.isBuffer(s)}const Gr=Ie("ArrayBuffer");function Li(s){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(s):t=s&&s.buffer&&Gr(s.buffer),t}const Ni=Yt("string"),Ce=Yt("function"),Zr=Yt("number"),es=s=>s!==null&&typeof s=="object",Mi=s=>s===!0||s===!1,Ot=s=>{if(Xt(s)!=="object")return!1;const t=zs(s);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Jr in s)&&!(Kt in s)},Fi=Ie("Date"),qi=Ie("File"),$i=Ie("Blob"),Ui=Ie("FileList"),Bi=s=>es(s)&&Ce(s.pipe),Wi=s=>{let t;return s&&(typeof FormData=="function"&&s instanceof FormData||Ce(s.append)&&((t=Xt(s))==="formdata"||t==="object"&&Ce(s.toString)&&s.toString()==="[object FormData]"))},Hi=Ie("URLSearchParams"),[Vi,Ji,Gi,Zi]=["ReadableStream","Request","Response","Headers"].map(Ie),Qi=s=>s.trim?s.trim():s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function bt(s,t,{allOwnKeys:r=!1}={}){if(s===null||typeof s>"u")return;let n,i;if(typeof s!="object"&&(s=[s]),at(s))for(n=0,i=s.length;n<i;n++)t.call(null,s[n],n,s);else{const l=r?Object.getOwnPropertyNames(s):Object.keys(s),o=l.length;let a;for(n=0;n<o;n++)a=l[n],t.call(null,s[a],a,s)}}function Qr(s,t){t=t.toLowerCase();const r=Object.keys(s);let n=r.length,i;for(;n-- >0;)if(i=r[n],t===i.toLowerCase())return i;return null}const Xe=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Kr=s=>!jt(s)&&s!==Xe;function fs(){const{caseless:s}=Kr(this)&&this||{},t={},r=(n,i)=>{const l=s&&Qr(t,i)||i;Ot(t[l])&&Ot(n)?t[l]=fs(t[l],n):Ot(n)?t[l]=fs({},n):at(n)?t[l]=n.slice():t[l]=n};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&bt(arguments[n],r);return t}const Ki=(s,t,r,{allOwnKeys:n}={})=>(bt(t,(i,l)=>{r&&Ce(i)?s[l]=Vr(i,r):s[l]=i},{allOwnKeys:n}),s),Xi=s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),Yi=(s,t,r,n)=>{s.prototype=Object.create(t.prototype,n),s.prototype.constructor=s,Object.defineProperty(s,"super",{value:t.prototype}),r&&Object.assign(s.prototype,r)},el=(s,t,r,n)=>{let i,l,o;const a={};if(t=t||{},s==null)return t;do{for(i=Object.getOwnPropertyNames(s),l=i.length;l-- >0;)o=i[l],(!n||n(o,s,t))&&!a[o]&&(t[o]=s[o],a[o]=!0);s=r!==!1&&zs(s)}while(s&&(!r||r(s,t))&&s!==Object.prototype);return t},tl=(s,t,r)=>{s=String(s),(r===void 0||r>s.length)&&(r=s.length),r-=t.length;const n=s.indexOf(t,r);return n!==-1&&n===r},sl=s=>{if(!s)return null;if(at(s))return s;let t=s.length;if(!Zr(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=s[t];return r},rl=(s=>t=>s&&t instanceof s)(typeof Uint8Array<"u"&&zs(Uint8Array)),nl=(s,t)=>{const n=(s&&s[Kt]).call(s);let i;for(;(i=n.next())&&!i.done;){const l=i.value;t.call(s,l[0],l[1])}},il=(s,t)=>{let r;const n=[];for(;(r=s.exec(t))!==null;)n.push(r);return n},ll=Ie("HTMLFormElement"),ol=s=>s.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,n,i){return n.toUpperCase()+i}),lr=(({hasOwnProperty:s})=>(t,r)=>s.call(t,r))(Object.prototype),al=Ie("RegExp"),Xr=(s,t)=>{const r=Object.getOwnPropertyDescriptors(s),n={};bt(r,(i,l)=>{let o;(o=t(i,l,s))!==!1&&(n[l]=o||i)}),Object.defineProperties(s,n)},cl=s=>{Xr(s,(t,r)=>{if(Ce(s)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const n=s[r];if(Ce(n)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},dl=(s,t)=>{const r={},n=i=>{i.forEach(l=>{r[l]=!0})};return at(s)?n(s):n(String(s).split(t)),r},ul=()=>{},hl=(s,t)=>s!=null&&Number.isFinite(s=+s)?s:t;function xl(s){return!!(s&&Ce(s.append)&&s[Jr]==="FormData"&&s[Kt])}const pl=s=>{const t=new Array(10),r=(n,i)=>{if(es(n)){if(t.indexOf(n)>=0)return;if(!("toJSON"in n)){t[i]=n;const l=at(n)?[]:{};return bt(n,(o,a)=>{const c=r(o,i+1);!jt(c)&&(l[a]=c)}),t[i]=void 0,l}}return n};return r(s,0)},fl=Ie("AsyncFunction"),ml=s=>s&&(es(s)||Ce(s))&&Ce(s.then)&&Ce(s.catch),Yr=((s,t)=>s?setImmediate:t?((r,n)=>(Xe.addEventListener("message",({source:i,data:l})=>{i===Xe&&l===r&&n.length&&n.shift()()},!1),i=>{n.push(i),Xe.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",Ce(Xe.postMessage)),gl=typeof queueMicrotask<"u"?queueMicrotask.bind(Xe):typeof process<"u"&&process.nextTick||Yr,jl=s=>s!=null&&Ce(s[Kt]),y={isArray:at,isArrayBuffer:Gr,isBuffer:zi,isFormData:Wi,isArrayBufferView:Li,isString:Ni,isNumber:Zr,isBoolean:Mi,isObject:es,isPlainObject:Ot,isReadableStream:Vi,isRequest:Ji,isResponse:Gi,isHeaders:Zi,isUndefined:jt,isDate:Fi,isFile:qi,isBlob:$i,isRegExp:al,isFunction:Ce,isStream:Bi,isURLSearchParams:Hi,isTypedArray:rl,isFileList:Ui,forEach:bt,merge:fs,extend:Ki,trim:Qi,stripBOM:Xi,inherits:Yi,toFlatObject:el,kindOf:Xt,kindOfTest:Ie,endsWith:tl,toArray:sl,forEachEntry:nl,matchAll:il,isHTMLForm:ll,hasOwnProperty:lr,hasOwnProp:lr,reduceDescriptors:Xr,freezeMethods:cl,toObjectSet:dl,toCamelCase:ol,noop:ul,toFiniteNumber:hl,findKey:Qr,global:Xe,isContextDefined:Kr,isSpecCompliantForm:xl,toJSONObject:pl,isAsyncFn:fl,isThenable:ml,setImmediate:Yr,asap:gl,isIterable:jl};function U(s,t,r,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=s,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}y.inherits(U,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:y.toJSONObject(this.config),code:this.code,status:this.status}}});const en=U.prototype,tn={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(s=>{tn[s]={value:s}});Object.defineProperties(U,tn);Object.defineProperty(en,"isAxiosError",{value:!0});U.from=(s,t,r,n,i,l)=>{const o=Object.create(en);return y.toFlatObject(s,o,function(c){return c!==Error.prototype},a=>a!=="isAxiosError"),U.call(o,s.message,t,r,n,i),o.cause=s,o.name=s.name,l&&Object.assign(o,l),o};const bl=null;function ms(s){return y.isPlainObject(s)||y.isArray(s)}function sn(s){return y.endsWith(s,"[]")?s.slice(0,-2):s}function or(s,t,r){return s?s.concat(t).map(function(i,l){return i=sn(i),!r&&l?"["+i+"]":i}).join(r?".":""):t}function yl(s){return y.isArray(s)&&!s.some(ms)}const wl=y.toFlatObject(y,{},null,function(t){return/^is[A-Z]/.test(t)});function ts(s,t,r){if(!y.isObject(s))throw new TypeError("target must be an object");t=t||new FormData,r=y.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(b,S){return!y.isUndefined(S[b])});const n=r.metaTokens,i=r.visitor||x,l=r.dots,o=r.indexes,c=(r.Blob||typeof Blob<"u"&&Blob)&&y.isSpecCompliantForm(t);if(!y.isFunction(i))throw new TypeError("visitor must be a function");function d(h){if(h===null)return"";if(y.isDate(h))return h.toISOString();if(y.isBoolean(h))return h.toString();if(!c&&y.isBlob(h))throw new U("Blob is not supported. Use a Buffer instead.");return y.isArrayBuffer(h)||y.isTypedArray(h)?c&&typeof Blob=="function"?new Blob([h]):Buffer.from(h):h}function x(h,b,S){let O=h;if(h&&!S&&typeof h=="object"){if(y.endsWith(b,"{}"))b=n?b:b.slice(0,-2),h=JSON.stringify(h);else if(y.isArray(h)&&yl(h)||(y.isFileList(h)||y.endsWith(b,"[]"))&&(O=y.toArray(h)))return b=sn(b),O.forEach(function(j,P){!(y.isUndefined(j)||j===null)&&t.append(o===!0?or([b],P,l):o===null?b:b+"[]",d(j))}),!1}return ms(h)?!0:(t.append(or(S,b,l),d(h)),!1)}const f=[],w=Object.assign(wl,{defaultVisitor:x,convertValue:d,isVisitable:ms});function _(h,b){if(!y.isUndefined(h)){if(f.indexOf(h)!==-1)throw Error("Circular reference detected in "+b.join("."));f.push(h),y.forEach(h,function(O,C){(!(y.isUndefined(O)||O===null)&&i.call(t,O,y.isString(C)?C.trim():C,b,w))===!0&&_(O,b?b.concat(C):[C])}),f.pop()}}if(!y.isObject(s))throw new TypeError("data must be an object");return _(s),t}function ar(s){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function Ls(s,t){this._pairs=[],s&&ts(s,this,t)}const rn=Ls.prototype;rn.append=function(t,r){this._pairs.push([t,r])};rn.toString=function(t){const r=t?function(n){return t.call(this,n,ar)}:ar;return this._pairs.map(function(i){return r(i[0])+"="+r(i[1])},"").join("&")};function Sl(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function nn(s,t,r){if(!t)return s;const n=r&&r.encode||Sl;y.isFunction(r)&&(r={serialize:r});const i=r&&r.serialize;let l;if(i?l=i(t,r):l=y.isURLSearchParams(t)?t.toString():new Ls(t,r).toString(n),l){const o=s.indexOf("#");o!==-1&&(s=s.slice(0,o)),s+=(s.indexOf("?")===-1?"?":"&")+l}return s}class cr{constructor(){this.handlers=[]}use(t,r,n){return this.handlers.push({fulfilled:t,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){y.forEach(this.handlers,function(n){n!==null&&t(n)})}}const ln={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},vl=typeof URLSearchParams<"u"?URLSearchParams:Ls,kl=typeof FormData<"u"?FormData:null,Cl=typeof Blob<"u"?Blob:null,Rl={isBrowser:!0,classes:{URLSearchParams:vl,FormData:kl,Blob:Cl},protocols:["http","https","file","blob","url","data"]},Ns=typeof window<"u"&&typeof document<"u",gs=typeof navigator=="object"&&navigator||void 0,_l=Ns&&(!gs||["ReactNative","NativeScript","NS"].indexOf(gs.product)<0),Pl=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",El=Ns&&window.location.href||"http://localhost",Al=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ns,hasStandardBrowserEnv:_l,hasStandardBrowserWebWorkerEnv:Pl,navigator:gs,origin:El},Symbol.toStringTag,{value:"Module"})),fe={...Al,...Rl};function Ol(s,t){return ts(s,new fe.classes.URLSearchParams,Object.assign({visitor:function(r,n,i,l){return fe.isNode&&y.isBuffer(r)?(this.append(n,r.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},t))}function Il(s){return y.matchAll(/\w+|\[(\w*)]/g,s).map(t=>t[0]==="[]"?"":t[1]||t[0])}function Dl(s){const t={},r=Object.keys(s);let n;const i=r.length;let l;for(n=0;n<i;n++)l=r[n],t[l]=s[l];return t}function on(s){function t(r,n,i,l){let o=r[l++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),c=l>=r.length;return o=!o&&y.isArray(i)?i.length:o,c?(y.hasOwnProp(i,o)?i[o]=[i[o],n]:i[o]=n,!a):((!i[o]||!y.isObject(i[o]))&&(i[o]=[]),t(r,n,i[o],l)&&y.isArray(i[o])&&(i[o]=Dl(i[o])),!a)}if(y.isFormData(s)&&y.isFunction(s.entries)){const r={};return y.forEachEntry(s,(n,i)=>{t(Il(n),i,r,0)}),r}return null}function Tl(s,t,r){if(y.isString(s))try{return(t||JSON.parse)(s),y.trim(s)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(s)}const yt={transitional:ln,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const n=r.getContentType()||"",i=n.indexOf("application/json")>-1,l=y.isObject(t);if(l&&y.isHTMLForm(t)&&(t=new FormData(t)),y.isFormData(t))return i?JSON.stringify(on(t)):t;if(y.isArrayBuffer(t)||y.isBuffer(t)||y.isStream(t)||y.isFile(t)||y.isBlob(t)||y.isReadableStream(t))return t;if(y.isArrayBufferView(t))return t.buffer;if(y.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let a;if(l){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Ol(t,this.formSerializer).toString();if((a=y.isFileList(t))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return ts(a?{"files[]":t}:t,c&&new c,this.formSerializer)}}return l||i?(r.setContentType("application/json",!1),Tl(t)):t}],transformResponse:[function(t){const r=this.transitional||yt.transitional,n=r&&r.forcedJSONParsing,i=this.responseType==="json";if(y.isResponse(t)||y.isReadableStream(t))return t;if(t&&y.isString(t)&&(n&&!this.responseType||i)){const o=!(r&&r.silentJSONParsing)&&i;try{return JSON.parse(t)}catch(a){if(o)throw a.name==="SyntaxError"?U.from(a,U.ERR_BAD_RESPONSE,this,null,this.response):a}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:fe.classes.FormData,Blob:fe.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};y.forEach(["delete","get","head","post","put","patch"],s=>{yt.headers[s]={}});const zl=y.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ll=s=>{const t={};let r,n,i;return s&&s.split(`
`).forEach(function(o){i=o.indexOf(":"),r=o.substring(0,i).trim().toLowerCase(),n=o.substring(i+1).trim(),!(!r||t[r]&&zl[r])&&(r==="set-cookie"?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t},dr=Symbol("internals");function ut(s){return s&&String(s).trim().toLowerCase()}function It(s){return s===!1||s==null?s:y.isArray(s)?s.map(It):String(s)}function Nl(s){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(s);)t[n[1]]=n[2];return t}const Ml=s=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(s.trim());function as(s,t,r,n,i){if(y.isFunction(n))return n.call(this,t,r);if(i&&(t=r),!!y.isString(t)){if(y.isString(n))return t.indexOf(n)!==-1;if(y.isRegExp(n))return n.test(t)}}function Fl(s){return s.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,n)=>r.toUpperCase()+n)}function ql(s,t){const r=y.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(s,n+r,{value:function(i,l,o){return this[n].call(this,t,i,l,o)},configurable:!0})})}let Re=class{constructor(t){t&&this.set(t)}set(t,r,n){const i=this;function l(a,c,d){const x=ut(c);if(!x)throw new Error("header name must be a non-empty string");const f=y.findKey(i,x);(!f||i[f]===void 0||d===!0||d===void 0&&i[f]!==!1)&&(i[f||c]=It(a))}const o=(a,c)=>y.forEach(a,(d,x)=>l(d,x,c));if(y.isPlainObject(t)||t instanceof this.constructor)o(t,r);else if(y.isString(t)&&(t=t.trim())&&!Ml(t))o(Ll(t),r);else if(y.isObject(t)&&y.isIterable(t)){let a={},c,d;for(const x of t){if(!y.isArray(x))throw TypeError("Object iterator must return a key-value pair");a[d=x[0]]=(c=a[d])?y.isArray(c)?[...c,x[1]]:[c,x[1]]:x[1]}o(a,r)}else t!=null&&l(r,t,n);return this}get(t,r){if(t=ut(t),t){const n=y.findKey(this,t);if(n){const i=this[n];if(!r)return i;if(r===!0)return Nl(i);if(y.isFunction(r))return r.call(this,i,n);if(y.isRegExp(r))return r.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=ut(t),t){const n=y.findKey(this,t);return!!(n&&this[n]!==void 0&&(!r||as(this,this[n],n,r)))}return!1}delete(t,r){const n=this;let i=!1;function l(o){if(o=ut(o),o){const a=y.findKey(n,o);a&&(!r||as(n,n[a],a,r))&&(delete n[a],i=!0)}}return y.isArray(t)?t.forEach(l):l(t),i}clear(t){const r=Object.keys(this);let n=r.length,i=!1;for(;n--;){const l=r[n];(!t||as(this,this[l],l,t,!0))&&(delete this[l],i=!0)}return i}normalize(t){const r=this,n={};return y.forEach(this,(i,l)=>{const o=y.findKey(n,l);if(o){r[o]=It(i),delete r[l];return}const a=t?Fl(l):String(l).trim();a!==l&&delete r[l],r[a]=It(i),n[a]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return y.forEach(this,(n,i)=>{n!=null&&n!==!1&&(r[i]=t&&y.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const n=new this(t);return r.forEach(i=>n.set(i)),n}static accessor(t){const n=(this[dr]=this[dr]={accessors:{}}).accessors,i=this.prototype;function l(o){const a=ut(o);n[a]||(ql(i,o),n[a]=!0)}return y.isArray(t)?t.forEach(l):l(t),this}};Re.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);y.reduceDescriptors(Re.prototype,({value:s},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>s,set(n){this[r]=n}}});y.freezeMethods(Re);function cs(s,t){const r=this||yt,n=t||r,i=Re.from(n.headers);let l=n.data;return y.forEach(s,function(a){l=a.call(r,l,i.normalize(),t?t.status:void 0)}),i.normalize(),l}function an(s){return!!(s&&s.__CANCEL__)}function ct(s,t,r){U.call(this,s??"canceled",U.ERR_CANCELED,t,r),this.name="CanceledError"}y.inherits(ct,U,{__CANCEL__:!0});function cn(s,t,r){const n=r.config.validateStatus;!r.status||!n||n(r.status)?s(r):t(new U("Request failed with status code "+r.status,[U.ERR_BAD_REQUEST,U.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function $l(s){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return t&&t[1]||""}function Ul(s,t){s=s||10;const r=new Array(s),n=new Array(s);let i=0,l=0,o;return t=t!==void 0?t:1e3,function(c){const d=Date.now(),x=n[l];o||(o=d),r[i]=c,n[i]=d;let f=l,w=0;for(;f!==i;)w+=r[f++],f=f%s;if(i=(i+1)%s,i===l&&(l=(l+1)%s),d-o<t)return;const _=x&&d-x;return _?Math.round(w*1e3/_):void 0}}function Bl(s,t){let r=0,n=1e3/t,i,l;const o=(d,x=Date.now())=>{r=x,i=null,l&&(clearTimeout(l),l=null),s.apply(null,d)};return[(...d)=>{const x=Date.now(),f=x-r;f>=n?o(d,x):(i=d,l||(l=setTimeout(()=>{l=null,o(i)},n-f)))},()=>i&&o(i)]}const Ut=(s,t,r=3)=>{let n=0;const i=Ul(50,250);return Bl(l=>{const o=l.loaded,a=l.lengthComputable?l.total:void 0,c=o-n,d=i(c),x=o<=a;n=o;const f={loaded:o,total:a,progress:a?o/a:void 0,bytes:c,rate:d||void 0,estimated:d&&a&&x?(a-o)/d:void 0,event:l,lengthComputable:a!=null,[t?"download":"upload"]:!0};s(f)},r)},ur=(s,t)=>{const r=s!=null;return[n=>t[0]({lengthComputable:r,total:s,loaded:n}),t[1]]},hr=s=>(...t)=>y.asap(()=>s(...t)),Wl=fe.hasStandardBrowserEnv?((s,t)=>r=>(r=new URL(r,fe.origin),s.protocol===r.protocol&&s.host===r.host&&(t||s.port===r.port)))(new URL(fe.origin),fe.navigator&&/(msie|trident)/i.test(fe.navigator.userAgent)):()=>!0,Hl=fe.hasStandardBrowserEnv?{write(s,t,r,n,i,l){const o=[s+"="+encodeURIComponent(t)];y.isNumber(r)&&o.push("expires="+new Date(r).toGMTString()),y.isString(n)&&o.push("path="+n),y.isString(i)&&o.push("domain="+i),l===!0&&o.push("secure"),document.cookie=o.join("; ")},read(s){const t=document.cookie.match(new RegExp("(^|;\\s*)("+s+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(s){this.write(s,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Vl(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}function Jl(s,t){return t?s.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):s}function dn(s,t,r){let n=!Vl(t);return s&&(n||r==!1)?Jl(s,t):t}const xr=s=>s instanceof Re?{...s}:s;function et(s,t){t=t||{};const r={};function n(d,x,f,w){return y.isPlainObject(d)&&y.isPlainObject(x)?y.merge.call({caseless:w},d,x):y.isPlainObject(x)?y.merge({},x):y.isArray(x)?x.slice():x}function i(d,x,f,w){if(y.isUndefined(x)){if(!y.isUndefined(d))return n(void 0,d,f,w)}else return n(d,x,f,w)}function l(d,x){if(!y.isUndefined(x))return n(void 0,x)}function o(d,x){if(y.isUndefined(x)){if(!y.isUndefined(d))return n(void 0,d)}else return n(void 0,x)}function a(d,x,f){if(f in t)return n(d,x);if(f in s)return n(void 0,d)}const c={url:l,method:l,data:l,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(d,x,f)=>i(xr(d),xr(x),f,!0)};return y.forEach(Object.keys(Object.assign({},s,t)),function(x){const f=c[x]||i,w=f(s[x],t[x],x);y.isUndefined(w)&&f!==a||(r[x]=w)}),r}const un=s=>{const t=et({},s);let{data:r,withXSRFToken:n,xsrfHeaderName:i,xsrfCookieName:l,headers:o,auth:a}=t;t.headers=o=Re.from(o),t.url=nn(dn(t.baseURL,t.url,t.allowAbsoluteUrls),s.params,s.paramsSerializer),a&&o.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let c;if(y.isFormData(r)){if(fe.hasStandardBrowserEnv||fe.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((c=o.getContentType())!==!1){const[d,...x]=c?c.split(";").map(f=>f.trim()).filter(Boolean):[];o.setContentType([d||"multipart/form-data",...x].join("; "))}}if(fe.hasStandardBrowserEnv&&(n&&y.isFunction(n)&&(n=n(t)),n||n!==!1&&Wl(t.url))){const d=i&&l&&Hl.read(l);d&&o.set(i,d)}return t},Gl=typeof XMLHttpRequest<"u",Zl=Gl&&function(s){return new Promise(function(r,n){const i=un(s);let l=i.data;const o=Re.from(i.headers).normalize();let{responseType:a,onUploadProgress:c,onDownloadProgress:d}=i,x,f,w,_,h;function b(){_&&_(),h&&h(),i.cancelToken&&i.cancelToken.unsubscribe(x),i.signal&&i.signal.removeEventListener("abort",x)}let S=new XMLHttpRequest;S.open(i.method.toUpperCase(),i.url,!0),S.timeout=i.timeout;function O(){if(!S)return;const j=Re.from("getAllResponseHeaders"in S&&S.getAllResponseHeaders()),R={data:!a||a==="text"||a==="json"?S.responseText:S.response,status:S.status,statusText:S.statusText,headers:j,config:s,request:S};cn(function(k){r(k),b()},function(k){n(k),b()},R),S=null}"onloadend"in S?S.onloadend=O:S.onreadystatechange=function(){!S||S.readyState!==4||S.status===0&&!(S.responseURL&&S.responseURL.indexOf("file:")===0)||setTimeout(O)},S.onabort=function(){S&&(n(new U("Request aborted",U.ECONNABORTED,s,S)),S=null)},S.onerror=function(){n(new U("Network Error",U.ERR_NETWORK,s,S)),S=null},S.ontimeout=function(){let P=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const R=i.transitional||ln;i.timeoutErrorMessage&&(P=i.timeoutErrorMessage),n(new U(P,R.clarifyTimeoutError?U.ETIMEDOUT:U.ECONNABORTED,s,S)),S=null},l===void 0&&o.setContentType(null),"setRequestHeader"in S&&y.forEach(o.toJSON(),function(P,R){S.setRequestHeader(R,P)}),y.isUndefined(i.withCredentials)||(S.withCredentials=!!i.withCredentials),a&&a!=="json"&&(S.responseType=i.responseType),d&&([w,h]=Ut(d,!0),S.addEventListener("progress",w)),c&&S.upload&&([f,_]=Ut(c),S.upload.addEventListener("progress",f),S.upload.addEventListener("loadend",_)),(i.cancelToken||i.signal)&&(x=j=>{S&&(n(!j||j.type?new ct(null,s,S):j),S.abort(),S=null)},i.cancelToken&&i.cancelToken.subscribe(x),i.signal&&(i.signal.aborted?x():i.signal.addEventListener("abort",x)));const C=$l(i.url);if(C&&fe.protocols.indexOf(C)===-1){n(new U("Unsupported protocol "+C+":",U.ERR_BAD_REQUEST,s));return}S.send(l||null)})},Ql=(s,t)=>{const{length:r}=s=s?s.filter(Boolean):[];if(t||r){let n=new AbortController,i;const l=function(d){if(!i){i=!0,a();const x=d instanceof Error?d:this.reason;n.abort(x instanceof U?x:new ct(x instanceof Error?x.message:x))}};let o=t&&setTimeout(()=>{o=null,l(new U(`timeout ${t} of ms exceeded`,U.ETIMEDOUT))},t);const a=()=>{s&&(o&&clearTimeout(o),o=null,s.forEach(d=>{d.unsubscribe?d.unsubscribe(l):d.removeEventListener("abort",l)}),s=null)};s.forEach(d=>d.addEventListener("abort",l));const{signal:c}=n;return c.unsubscribe=()=>y.asap(a),c}},Kl=function*(s,t){let r=s.byteLength;if(r<t){yield s;return}let n=0,i;for(;n<r;)i=n+t,yield s.slice(n,i),n=i},Xl=async function*(s,t){for await(const r of Yl(s))yield*Kl(r,t)},Yl=async function*(s){if(s[Symbol.asyncIterator]){yield*s;return}const t=s.getReader();try{for(;;){const{done:r,value:n}=await t.read();if(r)break;yield n}}finally{await t.cancel()}},pr=(s,t,r,n)=>{const i=Xl(s,t);let l=0,o,a=c=>{o||(o=!0,n&&n(c))};return new ReadableStream({async pull(c){try{const{done:d,value:x}=await i.next();if(d){a(),c.close();return}let f=x.byteLength;if(r){let w=l+=f;r(w)}c.enqueue(new Uint8Array(x))}catch(d){throw a(d),d}},cancel(c){return a(c),i.return()}},{highWaterMark:2})},ss=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",hn=ss&&typeof ReadableStream=="function",eo=ss&&(typeof TextEncoder=="function"?(s=>t=>s.encode(t))(new TextEncoder):async s=>new Uint8Array(await new Response(s).arrayBuffer())),xn=(s,...t)=>{try{return!!s(...t)}catch{return!1}},to=hn&&xn(()=>{let s=!1;const t=new Request(fe.origin,{body:new ReadableStream,method:"POST",get duplex(){return s=!0,"half"}}).headers.has("Content-Type");return s&&!t}),fr=64*1024,js=hn&&xn(()=>y.isReadableStream(new Response("").body)),Bt={stream:js&&(s=>s.body)};ss&&(s=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!Bt[t]&&(Bt[t]=y.isFunction(s[t])?r=>r[t]():(r,n)=>{throw new U(`Response type '${t}' is not supported`,U.ERR_NOT_SUPPORT,n)})})})(new Response);const so=async s=>{if(s==null)return 0;if(y.isBlob(s))return s.size;if(y.isSpecCompliantForm(s))return(await new Request(fe.origin,{method:"POST",body:s}).arrayBuffer()).byteLength;if(y.isArrayBufferView(s)||y.isArrayBuffer(s))return s.byteLength;if(y.isURLSearchParams(s)&&(s=s+""),y.isString(s))return(await eo(s)).byteLength},ro=async(s,t)=>{const r=y.toFiniteNumber(s.getContentLength());return r??so(t)},no=ss&&(async s=>{let{url:t,method:r,data:n,signal:i,cancelToken:l,timeout:o,onDownloadProgress:a,onUploadProgress:c,responseType:d,headers:x,withCredentials:f="same-origin",fetchOptions:w}=un(s);d=d?(d+"").toLowerCase():"text";let _=Ql([i,l&&l.toAbortSignal()],o),h;const b=_&&_.unsubscribe&&(()=>{_.unsubscribe()});let S;try{if(c&&to&&r!=="get"&&r!=="head"&&(S=await ro(x,n))!==0){let R=new Request(t,{method:"POST",body:n,duplex:"half"}),A;if(y.isFormData(n)&&(A=R.headers.get("content-type"))&&x.setContentType(A),R.body){const[k,$]=ur(S,Ut(hr(c)));n=pr(R.body,fr,k,$)}}y.isString(f)||(f=f?"include":"omit");const O="credentials"in Request.prototype;h=new Request(t,{...w,signal:_,method:r.toUpperCase(),headers:x.normalize().toJSON(),body:n,duplex:"half",credentials:O?f:void 0});let C=await fetch(h,w);const j=js&&(d==="stream"||d==="response");if(js&&(a||j&&b)){const R={};["status","statusText","headers"].forEach(se=>{R[se]=C[se]});const A=y.toFiniteNumber(C.headers.get("content-length")),[k,$]=a&&ur(A,Ut(hr(a),!0))||[];C=new Response(pr(C.body,fr,k,()=>{$&&$(),b&&b()}),R)}d=d||"text";let P=await Bt[y.findKey(Bt,d)||"text"](C,s);return!j&&b&&b(),await new Promise((R,A)=>{cn(R,A,{data:P,headers:Re.from(C.headers),status:C.status,statusText:C.statusText,config:s,request:h})})}catch(O){throw b&&b(),O&&O.name==="TypeError"&&/Load failed|fetch/i.test(O.message)?Object.assign(new U("Network Error",U.ERR_NETWORK,s,h),{cause:O.cause||O}):U.from(O,O&&O.code,s,h)}}),bs={http:bl,xhr:Zl,fetch:no};y.forEach(bs,(s,t)=>{if(s){try{Object.defineProperty(s,"name",{value:t})}catch{}Object.defineProperty(s,"adapterName",{value:t})}});const mr=s=>`- ${s}`,io=s=>y.isFunction(s)||s===null||s===!1,pn={getAdapter:s=>{s=y.isArray(s)?s:[s];const{length:t}=s;let r,n;const i={};for(let l=0;l<t;l++){r=s[l];let o;if(n=r,!io(r)&&(n=bs[(o=String(r)).toLowerCase()],n===void 0))throw new U(`Unknown adapter '${o}'`);if(n)break;i[o||"#"+l]=n}if(!n){const l=Object.entries(i).map(([a,c])=>`adapter ${a} `+(c===!1?"is not supported by the environment":"is not available in the build"));let o=t?l.length>1?`since :
`+l.map(mr).join(`
`):" "+mr(l[0]):"as no adapter specified";throw new U("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return n},adapters:bs};function ds(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new ct(null,s)}function gr(s){return ds(s),s.headers=Re.from(s.headers),s.data=cs.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),pn.getAdapter(s.adapter||yt.adapter)(s).then(function(n){return ds(s),n.data=cs.call(s,s.transformResponse,n),n.headers=Re.from(n.headers),n},function(n){return an(n)||(ds(s),n&&n.response&&(n.response.data=cs.call(s,s.transformResponse,n.response),n.response.headers=Re.from(n.response.headers))),Promise.reject(n)})}const fn="1.10.0",rs={};["object","boolean","number","function","string","symbol"].forEach((s,t)=>{rs[s]=function(n){return typeof n===s||"a"+(t<1?"n ":" ")+s}});const jr={};rs.transitional=function(t,r,n){function i(l,o){return"[Axios v"+fn+"] Transitional option '"+l+"'"+o+(n?". "+n:"")}return(l,o,a)=>{if(t===!1)throw new U(i(o," has been removed"+(r?" in "+r:"")),U.ERR_DEPRECATED);return r&&!jr[o]&&(jr[o]=!0,console.warn(i(o," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(l,o,a):!0}};rs.spelling=function(t){return(r,n)=>(console.warn(`${n} is likely a misspelling of ${t}`),!0)};function lo(s,t,r){if(typeof s!="object")throw new U("options must be an object",U.ERR_BAD_OPTION_VALUE);const n=Object.keys(s);let i=n.length;for(;i-- >0;){const l=n[i],o=t[l];if(o){const a=s[l],c=a===void 0||o(a,l,s);if(c!==!0)throw new U("option "+l+" must be "+c,U.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new U("Unknown option "+l,U.ERR_BAD_OPTION)}}const Dt={assertOptions:lo,validators:rs},De=Dt.validators;let Ye=class{constructor(t){this.defaults=t||{},this.interceptors={request:new cr,response:new cr}}async request(t,r){try{return await this._request(t,r)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const l=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?l&&!String(n.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+l):n.stack=l}catch{}}throw n}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=et(this.defaults,r);const{transitional:n,paramsSerializer:i,headers:l}=r;n!==void 0&&Dt.assertOptions(n,{silentJSONParsing:De.transitional(De.boolean),forcedJSONParsing:De.transitional(De.boolean),clarifyTimeoutError:De.transitional(De.boolean)},!1),i!=null&&(y.isFunction(i)?r.paramsSerializer={serialize:i}:Dt.assertOptions(i,{encode:De.function,serialize:De.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),Dt.assertOptions(r,{baseUrl:De.spelling("baseURL"),withXsrfToken:De.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let o=l&&y.merge(l.common,l[r.method]);l&&y.forEach(["delete","get","head","post","put","patch","common"],h=>{delete l[h]}),r.headers=Re.concat(o,l);const a=[];let c=!0;this.interceptors.request.forEach(function(b){typeof b.runWhen=="function"&&b.runWhen(r)===!1||(c=c&&b.synchronous,a.unshift(b.fulfilled,b.rejected))});const d=[];this.interceptors.response.forEach(function(b){d.push(b.fulfilled,b.rejected)});let x,f=0,w;if(!c){const h=[gr.bind(this),void 0];for(h.unshift.apply(h,a),h.push.apply(h,d),w=h.length,x=Promise.resolve(r);f<w;)x=x.then(h[f++],h[f++]);return x}w=a.length;let _=r;for(f=0;f<w;){const h=a[f++],b=a[f++];try{_=h(_)}catch(S){b.call(this,S);break}}try{x=gr.call(this,_)}catch(h){return Promise.reject(h)}for(f=0,w=d.length;f<w;)x=x.then(d[f++],d[f++]);return x}getUri(t){t=et(this.defaults,t);const r=dn(t.baseURL,t.url,t.allowAbsoluteUrls);return nn(r,t.params,t.paramsSerializer)}};y.forEach(["delete","get","head","options"],function(t){Ye.prototype[t]=function(r,n){return this.request(et(n||{},{method:t,url:r,data:(n||{}).data}))}});y.forEach(["post","put","patch"],function(t){function r(n){return function(l,o,a){return this.request(et(a||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:l,data:o}))}}Ye.prototype[t]=r(),Ye.prototype[t+"Form"]=r(!0)});let oo=class mn{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(l){r=l});const n=this;this.promise.then(i=>{if(!n._listeners)return;let l=n._listeners.length;for(;l-- >0;)n._listeners[l](i);n._listeners=null}),this.promise.then=i=>{let l;const o=new Promise(a=>{n.subscribe(a),l=a}).then(i);return o.cancel=function(){n.unsubscribe(l)},o},t(function(l,o,a){n.reason||(n.reason=new ct(l,o,a),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=n=>{t.abort(n)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new mn(function(i){t=i}),cancel:t}}};function ao(s){return function(r){return s.apply(null,r)}}function co(s){return y.isObject(s)&&s.isAxiosError===!0}const ys={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ys).forEach(([s,t])=>{ys[t]=s});function gn(s){const t=new Ye(s),r=Vr(Ye.prototype.request,t);return y.extend(r,Ye.prototype,t,{allOwnKeys:!0}),y.extend(r,t,null,{allOwnKeys:!0}),r.create=function(i){return gn(et(s,i))},r}const te=gn(yt);te.Axios=Ye;te.CanceledError=ct;te.CancelToken=oo;te.isCancel=an;te.VERSION=fn;te.toFormData=ts;te.AxiosError=U;te.Cancel=te.CanceledError;te.all=function(t){return Promise.all(t)};te.spread=ao;te.isAxiosError=co;te.mergeConfig=et;te.AxiosHeaders=Re;te.formToJSON=s=>on(y.isHTMLForm(s)?new FormData(s):s);te.getAdapter=pn.getAdapter;te.HttpStatusCode=ys;te.default=te;const{Axios:ja,AxiosError:ba,CanceledError:ya,isCancel:wa,CancelToken:Sa,VERSION:va,all:ka,Cancel:Ca,isAxiosError:Ra,spread:_a,toFormData:Pa,AxiosHeaders:Ea,HttpStatusCode:Aa,formToJSON:Oa,getAdapter:Ia,mergeConfig:Da}=te;async function uo(s,t){try{console.log("Sending to backend:",{purchaseOrderId:s,items:t});const r=await te.post("/api/receive-purchase-order",{purchaseOrderId:s,items:t});console.log("Purchase order received successfully:",r.data)}catch(r){throw console.error("Error receiving purchase order:",r),new Error("Failed to receive purchase order")}}const ho=({open:s,onClose:t,poId:r,orderNumber:n,items:i,onConfirm:l})=>{const[o,a]=u.useState([]),[c,d]=u.useState(!0),[x,f]=u.useState(!1);u.useEffect(()=>{s&&(d(!0),a(i.map(h=>({id:h.id,product_id:h.product_id,ProductName:h.ProductName,quantity_ordered:h.quantity_ordered??0,quantity_received:h.quantity_received??h.quantity_ordered??0}))),d(!1))},[i,s]);const w=(h,b)=>{let S=0;if(b==="")S=0;else if(/^\d+$/.test(b))S=parseInt(b,10);else return;a(O=>O.map(C=>C.id===h?{...C,quantity_received:S}:C))},_=async()=>{try{const h=o.map(({product_id:b,quantity_received:S})=>({product_id:String(b),quantity_received:S}));await uo(String(r),h),f(!0),t()}catch(h){console.error("Error receiving purchase order:",h),alert("Failed to receive purchase order. Please try again.")}};return e.jsxs(e.Fragment,{children:[e.jsx(_e,{open:s,onClose:t,"aria-labelledby":"receive-po-dialog-title",children:e.jsxs(Pe,{sx:{minWidth:400},children:[e.jsx(Ve,{}),e.jsxs(g,{id:"receive-po-dialog-title",level:"h4",sx:{mb:2},children:["Receive Purchase Order #",n??r]}),c?e.jsx(g,{children:"Loading items..."}):o.length===0?e.jsx(g,{children:"No items found for this purchase order."}):e.jsxs($e,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Ordered"}),e.jsx("th",{children:"Received"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:o.map(h=>e.jsxs("tr",{children:[e.jsx("td",{children:h.ProductName}),e.jsx("td",{children:h.quantity_ordered}),e.jsx("td",{children:e.jsx(q,{type:"number",value:h.quantity_received===0&&o.find(b=>b.id===h.id)?.quantity_received===0?"0":h.quantity_received,onChange:b=>w(h.id,b.target.value),sx:{width:80},slotProps:{input:{min:0,max:h.quantity_ordered}}})}),e.jsx("td",{style:{textAlign:"center"},children:h.quantity_received===h.quantity_ordered?e.jsx(As,{sx:{color:"#2e7d32"},titleAccess:"Received in full"}):e.jsx(Ur,{sx:{color:"#d32f2f"},titleAccess:"Not fully received"})})]},h.id))})]}),e.jsxs(m,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:3},children:[e.jsx(F,{variant:"plain",onClick:t,children:"Cancel"}),e.jsx(F,{variant:"solid",onClick:_,children:"Receive"})]})]})}),e.jsx(Qt,{open:x,autoHideDuration:3e3,onClose:()=>f(!1),color:"success",variant:"soft",anchorOrigin:{vertical:"top",horizontal:"center"},children:"Purchase order received successfully!"})]})},br={Pending:0,Ordered:1,Approved:2,Received:3,Cancelled:4},He={fontSize:G.sizes.small},Ze={...He,fontWeight:600,borderBottom:"1.5px solid #e0e0e0",background:"inherit"},Ct=s=>{switch(s){case"Pending":return"warning";case"Ordered":return"primary";case"Approved":return"primary";case"Received":return"success";case"Cancelled":return"danger";default:return"neutral"}},xo=s=>{switch(s){case"Pending":return e.jsx(Xs,{});case"Ordered":return e.jsx(Mt,{});case"Approved":return e.jsx(Mt,{});case"Received":return e.jsx(As,{});case"Cancelled":return e.jsx(Ur,{});default:return e.jsx(Xs,{})}},po=()=>{const{isMobile:s}=Se(),[t,r]=u.useState([]),[n,i]=u.useState(!1),[l,o]=u.useState(null),[a,c]=u.useState(""),[d,x]=u.useState(""),[f,w]=u.useState(!1),[_,h]=u.useState(!1),[b,S]=u.useState(null),[O,C]=u.useState([]),j=async()=>{i(!0),o(null);try{const{data:v,error:I}=await L.from("PurchaseOrders").select("id, order_number, order_date, status, total, notes, Suppliers(name)").order("order_date",{ascending:!1});if(I)throw I;if(v){const E=v.map(N=>({...N,supplier_name:N.Suppliers?.[0]?.name||"N/A",Suppliers:void 0}));r(E)}}catch(v){o(v.message||"Failed to fetch purchase orders")}finally{i(!1)}},P=async v=>{try{const{data:I,error:E}=await L.from("purchaseorderitems").select("id, product_id, Products(ProductName), quantity_ordered, quantity_received").eq("purchase_order_id",v);if(E)throw E;if(I){const N=I.map(he=>({...he,ProductName:he.Products?.[0]?.ProductName||"Unknown Product"}));C(N)}}catch(I){console.error("Error fetching PO items:",I)}},R=async()=>{await j()},A=async(v,I)=>{try{const{error:E}=await L.from("PurchaseOrders").update({status:I}).eq("id",v);if(E)throw E;await j()}catch(E){o(E.message||"Failed to update order status")}},k=async v=>{S(v),await P(v.id),h(!0)},$=async v=>{try{for(const I of v)await L.from("purchaseorderitems").update({quantity_received:I.quantity_received}).eq("id",I.id);b?.id&&await L.from("PurchaseOrders").update({status:"Received"}).eq("id",b.id),h(!1),S(null),await j()}catch(I){o(I.message||"Failed to receive order")}},Z=[...t.filter(v=>{const I=v.order_number?.toString().toLowerCase().includes(a.toLowerCase())||v.supplier_name?.toLowerCase().includes(a.toLowerCase()),E=d?v.status===d:!0;return I&&E})].sort((v,I)=>{const E=br[v.status]??99,N=br[I.status]??99;return E!==N?E-N:new Date(I.order_date).getTime()-new Date(v.order_date).getTime()});u.useEffect(()=>{j()},[]);const le=()=>e.jsxs(m,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(ge,{padding:"medium",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:G.sizes.xlarge},children:"Purchase Orders"}),e.jsxs(m,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(q,{placeholder:"Search orders...",value:a,onChange:v=>c(v.target.value),startDecorator:e.jsx(me,{}),sx:{flex:1}}),e.jsxs(ee,{placeholder:"Status",value:d,onChange:(v,I)=>x(I??""),sx:{minWidth:120},children:[e.jsx(z,{value:"",children:"All"}),e.jsx(z,{value:"Pending",children:"Pending"}),e.jsx(z,{value:"Ordered",children:"Ordered"}),e.jsx(z,{value:"Approved",children:"Approved"}),e.jsx(z,{value:"Received",children:"Received"}),e.jsx(z,{value:"Cancelled",children:"Cancelled"})]})]}),e.jsx(F,{variant:"solid",startDecorator:e.jsx(oe,{}),onClick:()=>w(!0),sx:{width:"100%",mb:2},children:"Add Purchase Order"})]}),n&&e.jsx(Ae,{}),l&&e.jsx(m,{sx:{p:2},children:e.jsxs(g,{color:"danger",children:["Error: ",l]})}),e.jsx(m,{children:Z.length===0?e.jsx(m,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:"No purchase orders found"})}):Z.map(v=>e.jsx(m,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(m,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${Ct(v.status)}.100`,color:`${Ct(v.status)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",flexShrink:0},children:xo(v.status)}),e.jsxs(m,{sx:{flex:1,minWidth:0},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsxs(g,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:["Order #",v.order_number]}),e.jsx(K,{size:"sm",color:Ct(v.status),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content"},children:v.status})]}),e.jsxs(g,{level:"body-xs",color:"neutral",sx:{mb:.5},children:[v.supplier_name," • ",new Date(v.order_date).toLocaleDateString()]}),e.jsxs(g,{level:"body-sm",sx:{fontWeight:"bold",color:"text.primary"},children:["Total: $",v.total?.toFixed(2)||"0.00"]}),e.jsx(m,{sx:{display:"flex",gap:1,mt:1},children:v.status==="Pending"?e.jsx(F,{size:"sm",variant:"outlined",onClick:()=>A(v.id,"Ordered"),children:"Order"}):e.jsx(F,{size:"sm",variant:"outlined",onClick:()=>k(v),disabled:v.status!=="Approved"&&v.status!=="Ordered",children:"Receive"})})]})]})},v.id))})]}),T=()=>e.jsxs(ge,{children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:G.sizes.xlarge},children:"Purchase Orders"}),e.jsxs(m,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(q,{placeholder:"Search purchase orders...",sx:{flex:1},value:a,onChange:v=>c(v.target.value),startDecorator:e.jsx(me,{})}),e.jsxs(ee,{placeholder:"Filter status",value:d,onChange:(v,I)=>x(I??""),sx:{minWidth:160},children:[e.jsx(z,{value:"",children:"All Statuses"}),e.jsx(z,{value:"Pending",children:"Pending"}),e.jsx(z,{value:"Ordered",children:"Ordered"}),e.jsx(z,{value:"Approved",children:"Approved"}),e.jsx(z,{value:"Received",children:"Received"}),e.jsx(z,{value:"Cancelled",children:"Cancelled"})]}),e.jsx(F,{onClick:()=>w(!0),variant:"solid",startDecorator:e.jsx(oe,{}),children:"Add Purchase Order"})]}),e.jsxs(ke,{children:[n&&e.jsx(Ae,{}),l&&e.jsxs(g,{color:"danger",children:["Error: ",l]}),e.jsxs($e,{"aria-label":"Purchase Orders",sx:{minWidth:800},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:Ze,children:"Order Number"}),e.jsx("th",{style:Ze,children:"Order Date"}),e.jsx("th",{style:Ze,children:"Status"}),e.jsx("th",{style:Ze,children:"Total"}),e.jsx("th",{style:Ze,children:"Supplier"}),e.jsx("th",{style:Ze,children:"Notes"}),e.jsx("th",{style:{width:120,...Ze},children:"Actions"})]})}),e.jsxs("tbody",{children:[Z.length===0&&!n&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...He},children:"No purchase orders found."})}),Z.map(v=>e.jsxs("tr",{style:{cursor:"pointer",height:48},children:[e.jsx("td",{style:He,children:v.order_number}),e.jsx("td",{style:He,children:new Date(v.order_date).toLocaleDateString()}),e.jsx("td",{style:He,children:e.jsx(K,{size:"sm",color:Ct(v.status),variant:"soft",children:v.status})}),e.jsxs("td",{style:He,children:["$",v.total?.toFixed(2)||"0.00"]}),e.jsx("td",{style:He,children:v.supplier_name}),e.jsx("td",{style:He,children:v.notes||"-"}),e.jsx("td",{children:v.status==="Pending"?e.jsx(F,{size:"sm",variant:"outlined",onClick:()=>A(v.id,"Ordered"),children:"Order"}):e.jsx(F,{size:"sm",variant:"outlined",onClick:()=>k(v),disabled:v.status!=="Approved"&&v.status!=="Ordered",children:"Receive"})})]},v.id))]})]})]})]});return e.jsxs(Ue,{children:[s?e.jsx(le,{}):e.jsx(T,{}),e.jsx(Di,{open:f,onClose:()=>w(!1),onCreated:R,mode:"add",order:void 0}),e.jsx(ho,{open:_&&!!b?.id,onClose:()=>{h(!1),S(null)},poId:b?.id||"",orderNumber:b?.order_number||"",items:O.filter(v=>!!v.id&&!!v.product_id),onConfirm:$})]})};function fo({value:s,onChange:t,toggleSidebar:r}){const n=Is(),[i,l]=u.useState(!1),[o,a]=u.useState("Sales");if(n.pathname==="/login")return null;const c=u.useMemo(()=>Tn({components:{MuiTableRow:{styleOverrides:{root:{"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}}}}}}),[]);ji.filter(f=>f.showInMobile);const d=o?At[o].filter(f=>f.showInMobile):[],x=async f=>{const{data:w}=await L.auth.getSession();if(!w&&["orders","products","users","suppliers","purchaseorders","tickets","smscampaigns","movements"].includes(f)){console.warn("Authentication required for this page"),t("home");return}t(f)};return e.jsxs(zn,{theme:c,children:[e.jsxs(Ln,{open:i,onClose:()=>l(!1),children:[e.jsx(Nn,{children:"Select Area"}),e.jsx(Mn,{children:["Sales","Support","Marketing","Operations"].map(f=>e.jsx(Js,{fullWidth:!0,variant:o===f?"contained":"outlined",onClick:()=>{a(f),l(!1)},sx:{my:1},children:f},f))}),e.jsx(Fn,{children:e.jsx(Js,{onClick:()=>l(!1),children:"Close"})})]}),e.jsx(qn,{sx:{position:"fixed",bottom:0,left:0,right:0,zIndex:9999,backgroundColor:"rgba(0, 0, 255, 0.2)",overflow:"hidden"},children:e.jsx("div",{style:{display:"flex",flexDirection:"row",overflowX:"auto"},children:e.jsxs($n,{showLabels:!0,value:s,onChange:(f,w)=>{x(w)},sx:{minWidth:"max-content",flex:1},children:[d.map(f=>e.jsx(Gs,{label:f.label,icon:f.icon,value:f.value,onClick:()=>x(f.value)},f.value)),e.jsx(Gs,{label:o||"",icon:e.jsx(ri,{}),onClick:f=>{f.stopPropagation(),l(!0)}})]})})})]})}function yr({open:s,onClose:t,onCreated:r}){const[n,i]=u.useState(""),[l,o]=u.useState(""),[a,c]=u.useState(!1),[d,x]=u.useState(null),f=async w=>{w.preventDefault(),c(!0),x(null);const _={subject:n,requester_name:l,status:"Open"};console.log("[DialogTicketCreate] Creating ticket with payload:",_);const{error:h,data:b}=await L.from("tickets").insert(_);h&&(x(h.message||JSON.stringify(h)),console.error("[DialogTicketCreate] Error creating ticket:",h)),c(!1),h||(i(""),o(""),t(),r&&r())};return e.jsx(_e,{open:s,onClose:t,children:e.jsxs(Pe,{sx:{minWidth:400},children:[e.jsx(g,{level:"title-md",sx:{mb:2},children:"Create Ticket"}),e.jsxs("form",{onSubmit:f,children:[e.jsx(q,{placeholder:"Subject",value:n,onChange:w=>i(w.target.value),sx:{mb:2},required:!0}),e.jsx(q,{placeholder:"Requester Name",value:l,onChange:w=>o(w.target.value),sx:{mb:2},required:!0}),d&&e.jsx(g,{color:"danger",sx:{mb:1},children:d}),e.jsx(F,{type:"submit",loading:a,disabled:a||!n||!l,variant:"solid",children:"Create"})]})]})})}const mo=["Refund issued","Replacement sent","Order cancelled","Technical support provided","Information provided","Awaiting customer response","Other"],go=({open:s,onClose:t,onSubmit:r})=>{const[n,i]=H.useState(""),[l,o]=H.useState("");return H.useEffect(()=>{s||(i(""),o(""))},[s]),e.jsx(_e,{open:s,onClose:t,children:e.jsxs(Pe,{children:[e.jsx(Jt,{children:"Resolve Ticket"}),e.jsxs(Gt,{sx:{display:"flex",flexDirection:"column",gap:2,minWidth:320},children:[e.jsx(ee,{value:n,onChange:(a,c)=>i(c||""),placeholder:"Select resolution",required:!0,children:mo.map(a=>e.jsx(z,{value:a,children:a},a))}),e.jsx(zr,{minRows:3,placeholder:"Resolution comment to customer...",value:l,onChange:a=>o(a.target.value)})]}),e.jsxs(Zt,{children:[e.jsx(F,{variant:"plain",onClick:t,children:"Cancel"}),e.jsx(F,{variant:"solid",color:"primary",disabled:!n,onClick:()=>{try{r(n,l),t()}catch(a){console.error("Error during form submission:",a)}},children:"Submit"})]})]})})},wr=Ts(go),Sr=s=>{if(!s)return"";const t=new Date(s),n=Math.floor((new Date().getTime()-t.getTime())/1e3);if(n<60)return"Just now";const i=Math.floor(n/60);if(i<60)return`${i} min ago`;const l=Math.floor(i/60);if(l<24)return`${l} hour${l>1?"s":""} ago`;const o=Math.floor(l/24);if(o<7)return`${o} day${o>1?"s":""} ago`;const a=Math.floor(o/7);if(a<4)return`${a} week${a>1?"s":""} ago`;const c=Math.floor(o/30);return`${c} month${c>1?"s":""} ago`},us={Open:{color:"success",label:"Open"},Pending:{color:"warning",label:"Pending"},Closed:{color:"neutral",label:"Closed"}};function jo(){const{isMobile:s}=Se(),[t,r]=u.useState([]),[n,i]=u.useState(null),[l,o]=u.useState([]),[a,c]=u.useState(""),[d,x]=u.useState(""),[f,w]=u.useState("Open"),[_,h]=u.useState(!1),[b,S]=u.useState(!1);u.useEffect(()=>{(async()=>{const{data:A,error:k}=await L.from("tickets").select("*").order("created_at",{ascending:!1});k||r(A||[])})()},[]),u.useEffect(()=>{if(!n){o([]);return}(async()=>{const{data:A,error:k}=await L.from("ticketactivities").select("*").eq("ticket_id",n).order("timestamp",{ascending:!0});k||o(A||[])})()},[n]);const O=async()=>{const{data:R,error:A}=await L.from("tickets").select("*").order("created_at",{ascending:!1});A||r(R||[])},C=async()=>{if(a.trim()&&n){console.log("Sending message:",{ticket_id:n,message:a,activity_type:"chat",sender_name:"You"});const{error:R,data:A}=await L.from("ticketactivities").insert({ticket_id:n,message:a,activity_type:"chat",sender_name:"You"}).select();if(R){console.error("Error sending message:",R),alert("Failed to send message: "+R.message);return}console.log("Message sent successfully:",A),c("");const{data:k,error:$}=await L.from("ticketactivities").select("*").eq("ticket_id",n).order("timestamp",{ascending:!0});$?console.error("Error fetching activities:",$):(console.log("Refreshed activities:",k),o(k||[]))}},j=async(R,A)=>{if(n)try{const{error:k}=await L.from("tickets").update({status:"Closed"}).eq("id",n);if(k){console.error("Error updating ticket status:",k),alert("Failed to resolve ticket: "+k.message);return}const{error:$}=await L.from("ticketactivities").insert({ticket_id:n,message:`Ticket resolved: ${R}${A?` - ${A}`:""}`,activity_type:"chat",sender_name:"You"});$&&console.error("Error adding resolution activity:",$),await O();const{data:se}=await L.from("ticketactivities").select("*").eq("ticket_id",n).order("timestamp",{ascending:!0});o(se||[])}catch(k){console.error("Error resolving ticket:",k),alert("Failed to resolve ticket")}},P=t.filter(R=>{if(f!=="All"&&R.status!==f)return!1;if(!d)return!0;const A=d.toLowerCase();return R.subject?.toLowerCase().includes(A)||R.requester_name?.toLowerCase().includes(A)||R.status?.toLowerCase().includes(A)});if(s){const R=t.length>0&&t.every(A=>A.status==="Closed")&&f==="Open";return e.jsxs(Ue,{children:[e.jsxs(m,{sx:{p:2},children:[e.jsx(g,{level:"h2",sx:{mb:3,fontWeight:600},children:"Tickets"}),e.jsxs(ie,{spacing:2,sx:{mb:2},children:[e.jsxs(ie,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(q,{placeholder:"Search tickets...",startDecorator:e.jsx(me,{}),value:d,onChange:A=>x(A.target.value),size:"sm",sx:{flex:1}}),e.jsx(ne,{size:"sm",variant:"soft",color:"primary",onClick:()=>h(!0),children:e.jsx(oe,{})})]}),e.jsxs(ee,{value:f,onChange:(A,k)=>w(k),size:"sm",placeholder:"Filter by status",children:[e.jsx(z,{value:"All",children:"All Tickets"}),e.jsx(z,{value:"Open",children:"Open"}),e.jsx(z,{value:"Pending",children:"Pending"}),e.jsx(z,{value:"Closed",children:"Closed"})]})]}),R?e.jsxs(m,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"60vh",gap:2},children:[e.jsx(ni,{sx:{fontSize:80,color:"primary.500"}}),e.jsx(g,{level:"h3",sx:{fontWeight:700,textAlign:"center"},children:"All done, you can now go to the beach"})]}):e.jsxs(m,{sx:{display:"flex",flexDirection:"column",gap:0},children:[P.map((A,k)=>e.jsxs(u.Fragment,{children:[e.jsxs(m,{sx:{p:2,display:"flex",alignItems:"flex-start",gap:2,cursor:"pointer",background:n===A.id?"primary.50":"transparent",borderRadius:1,transition:"all 0.2s","&:hover":{bgcolor:"neutral.50"}},onClick:()=>i(A.id),children:[e.jsx(ye,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600,mt:.5},children:A.requester_name?.[0]?.toUpperCase()||"?"}),e.jsxs(m,{sx:{flex:1,minWidth:0},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:600,mb:.5,wordBreak:"break-word"},children:A.subject||"Untitled"}),e.jsx(g,{level:"body-xs",color:"neutral",sx:{mb:.5,wordBreak:"break-word"},children:A.requester_name}),e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(g,{level:"body-xs",color:"neutral",children:Sr(A.updated_at)}),e.jsx(g,{level:"body-xs",color:"neutral",children:"•"}),e.jsxs(g,{level:"body-xs",color:"neutral",sx:{wordBreak:"break-all"},children:[A.id?.slice(0,8),"..."]})]})]}),e.jsx(K,{variant:"soft",size:"sm",color:us[A.status||"Open"]?.color,sx:{fontWeight:600,px:1.5,py:.5,ml:1},children:us[A.status||"Open"]?.label})]}),k<P.length-1&&e.jsx(ot,{sx:{my:.5}})]},A.id)),P.length===0&&e.jsx(g,{color:"neutral",sx:{textAlign:"center",mt:4},children:"No tickets found."})]})]}),e.jsx(yr,{open:_,onClose:()=>h(!1),onCreated:O}),e.jsx(wr,{open:b,onClose:()=>S(!1),onSubmit:j})]})}return e.jsxs(m,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[e.jsxs(m,{sx:{display:"flex",flex:1},children:[e.jsxs(m,{sx:{width:390,borderRight:"1px solid",borderColor:"divider",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs(m,{sx:{px:2,py:1,borderBottom:"1px solid",borderColor:"divider",flexShrink:0},children:[e.jsxs(ie,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[e.jsxs(ie,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(g,{level:"title-lg",children:"Messages"}),e.jsx(K,{size:"sm",variant:"soft",color:"neutral",children:P.length})]}),e.jsx(ne,{size:"sm",variant:"soft",color:"primary",onClick:()=>h(!0),children:e.jsx(oe,{})})]}),e.jsx(q,{placeholder:"Search",startDecorator:e.jsx(me,{}),value:d,onChange:R=>x(R.target.value),size:"sm",sx:{width:"100%",mb:1}}),e.jsxs(ee,{value:f,onChange:(R,A)=>w(A),size:"sm",sx:{width:"100%"},placeholder:"Filter by status",children:[e.jsx(z,{value:"All",children:"All Tickets"}),e.jsx(z,{value:"Open",children:"Open"}),e.jsx(z,{value:"Pending",children:"Pending"}),e.jsx(z,{value:"Closed",children:"Closed"})]})]}),e.jsx(m,{sx:{flex:1,overflowY:"auto",overflowX:"hidden",pt:1},children:e.jsx(Et,{size:"sm",sx:{gap:0},children:P.map(R=>e.jsxs(u.Fragment,{children:[e.jsx(pt,{sx:{p:0},children:e.jsx(Ne,{selected:n===R.id,onClick:()=>i(R.id),sx:{py:1,px:2},children:e.jsxs(ie,{direction:"row",spacing:1.5,alignItems:"flex-start",sx:{width:"100%"},children:[e.jsx(m,{sx:{position:"relative"},children:e.jsx(ye,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:R.requester_name?.[0]?.toUpperCase()||"?"})}),e.jsxs(m,{sx:{flex:1,minWidth:0,pr:1},children:[e.jsxs(ie,{direction:"row",justifyContent:"space-between",alignItems:"flex-start",sx:{mb:.5},children:[e.jsx(g,{level:"body-md",noWrap:!0,sx:{flex:1,pr:1},children:R.subject||"Untitled"}),R.status&&e.jsx(K,{size:"sm",color:us[R.status]?.color,variant:"soft",sx:{flexShrink:0},children:R.status})]}),e.jsx(g,{level:"body-sm",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",mb:.5},children:R.requester_name||""}),e.jsx(m,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(g,{level:"body-xs",sx:{color:"text.tertiary"},children:Sr(R.updated_at)})})]})]})})}),e.jsx(Un,{component:"li",sx:{margin:0}})]},R.id))})})]}),e.jsxs(m,{sx:{flex:1,display:"flex",flexDirection:"column"},children:[n&&e.jsx(m,{sx:{px:3,py:2,borderBottom:"1px solid",borderColor:"divider",flexShrink:0},children:e.jsxs(ie,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(ye,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:t.find(R=>R.id===n)?.requester_name?.[0]?.toUpperCase()||"?"}),e.jsxs(m,{sx:{flex:1},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:600},children:t.find(R=>R.id===n)?.requester_name||"Unknown User"}),e.jsx(g,{level:"body-xs",sx:{color:"text.secondary"},children:t.find(R=>R.id===n)?.status||"Unknown Status"})]}),e.jsx(F,{variant:"outlined",size:"sm",sx:{borderRadius:"16px"},children:"View profile"}),t.find(R=>R.id===n)?.status!=="Closed"&&e.jsx(F,{variant:"solid",color:"primary",size:"sm",sx:{borderRadius:"16px"},onClick:()=>S(!0),children:"Resolve"})]})}),e.jsx(m,{sx:{flex:1,overflowY:"auto",px:3,py:2},children:n?e.jsx(ie,{spacing:3,children:l.map((R,A)=>{const k=R.sender_name==="You";return e.jsxs(m,{children:[A===0||new Date(R.timestamp||"").toDateString()!==new Date(l[A-1]?.timestamp||"").toDateString()?e.jsxs(m,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(m,{sx:{flex:1,height:"1px",bgcolor:"divider"}}),e.jsx(g,{level:"body-xs",sx:{mx:2,color:"text.secondary"},children:R.timestamp?new Date(R.timestamp).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}):""}),e.jsx(m,{sx:{flex:1,height:"1px",bgcolor:"divider"}})]}):null,e.jsxs(ie,{direction:"row",spacing:1,sx:{alignItems:"flex-start"},children:[!k&&e.jsx(ye,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:R.sender_name?.[0]?.toUpperCase()||"?"}),e.jsx(m,{sx:{flex:1,display:"flex",flexDirection:k?"row-reverse":"row"},children:e.jsxs(m,{sx:{maxWidth:"70%",bgcolor:k?"primary.500":"neutral.50",color:k?"white":"text.primary",borderRadius:k?"18px 18px 4px 18px":"18px 18px 18px 4px",px:2,py:1.5,position:"relative",boxShadow:"sm"},children:[!k&&e.jsx(g,{level:"body-xs",sx:{fontWeight:600,mb:.5,color:k?"white":"text.primary"},children:R.sender_name}),e.jsx(g,{level:"body-sm",sx:{lineHeight:1.4,color:k?"white":"text.primary"},children:R.message})]})}),k&&e.jsx(ye,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:R.sender_name?.[0]?.toUpperCase()||"?"})]}),e.jsx(m,{sx:{display:"flex",justifyContent:k?"flex-end":"flex-start",mt:.5,ml:k?0:5},children:e.jsx(g,{level:"body-xs",sx:{color:"text.tertiary"},children:R.timestamp?new Date(R.timestamp).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):""})})]},R.id)})}):e.jsx(m,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx(g,{level:"body-md",sx:{color:"text.secondary"},children:"Select a ticket to view messages"})})}),n&&e.jsx(m,{sx:{px:3,py:2,borderTop:"1px solid",borderColor:"divider",flexShrink:0},children:e.jsxs(ie,{direction:"row",spacing:1,alignItems:"flex-end",children:[e.jsx(m,{sx:{flex:1},children:e.jsx(zr,{placeholder:"Type something here...",value:a,onChange:R=>c(R.target.value),minRows:1,maxRows:4,sx:{borderRadius:"20px",border:"1px solid",borderColor:"neutral.300","&:focus-within":{borderColor:"primary.500"},"& textarea":{border:"none",outline:"none",resize:"none",px:2,py:1}},onKeyDown:R=>{R.key==="Enter"&&!R.shiftKey&&(R.preventDefault(),C())}})}),e.jsx(F,{onClick:C,disabled:!a.trim(),variant:"solid",color:"primary",sx:{borderRadius:"20px",minWidth:60,height:40,fontWeight:600},children:"Send"})]})})]})]}),e.jsx(yr,{open:_,onClose:()=>h(!1),onCreated:O}),e.jsx(wr,{open:b,onClose:()=>S(!1),onSubmit:j})]})}const vr={draft:0,scheduled:1,sent:2,failed:3},Me={fontSize:G.sizes.small},Qe={...Me,fontWeight:600,borderBottom:"1.5px solid #e0e0e0",background:"inherit"},Rt=s=>{switch(s){case"draft":return"neutral";case"scheduled":return"warning";case"sent":return"success";case"failed":return"danger";default:return"neutral"}},bo=s=>{switch(s){case"draft":return e.jsx(ai,{});case"scheduled":return e.jsx(oi,{});case"sent":return e.jsx(As,{});case"failed":return e.jsx(li,{});default:return e.jsx(ii,{})}},yo=()=>{const{isMobile:s}=Se(),[t,r]=u.useState([]),[n,i]=u.useState(!1),[l,o]=u.useState(null),[a,c]=u.useState(""),[d,x]=u.useState(""),[f,w]=u.useState(!1),_=async()=>{i(!0),o(null);try{const{data:C,error:j}=await L.from("sms_campaigns").select("*").order("created_at",{ascending:!1});if(j)throw j;C&&r(C)}catch(C){console.error("Error fetching campaigns:",C),o(C.message||"Failed to fetch campaigns")}finally{i(!1)}},b=[...t.filter(C=>{const j=C.name.toLowerCase().includes(a.toLowerCase())||C.CampaignNumber?.toLowerCase().includes(a.toLowerCase()),P=d?C.status===d:!0;return j&&P})].sort((C,j)=>{const P=vr[C.status]??99,R=vr[j.status]??99;return P!==R?P-R:new Date(j.created_at).getTime()-new Date(C.created_at).getTime()});u.useEffect(()=>{_()},[]);const S=()=>e.jsxs(m,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(ge,{padding:"medium",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:G.sizes.xlarge},children:"SMS Campaigns"}),e.jsxs(m,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(q,{placeholder:"Search campaigns...",value:a,onChange:C=>c(C.target.value),startDecorator:e.jsx(me,{}),sx:{flex:1}}),e.jsxs(ee,{placeholder:"Status",value:d,onChange:(C,j)=>x(j??""),sx:{minWidth:120},children:[e.jsx(z,{value:"",children:"All"}),e.jsx(z,{value:"draft",children:"Draft"}),e.jsx(z,{value:"scheduled",children:"Scheduled"}),e.jsx(z,{value:"sent",children:"Sent"}),e.jsx(z,{value:"failed",children:"Failed"})]})]}),e.jsx(F,{variant:"solid",startDecorator:e.jsx(oe,{}),onClick:()=>w(!0),sx:{width:"100%",mb:2},children:"Create Campaign"})]}),n&&e.jsx(Ae,{}),l&&e.jsx(m,{sx:{p:2},children:e.jsxs(g,{color:"danger",children:["Error: ",l]})}),e.jsx(m,{children:b.length===0?e.jsx(m,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:"No SMS campaigns found"})}):b.map(C=>e.jsx(m,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(m,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${Rt(C.status)}.100`,color:`${Rt(C.status)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",flexShrink:0},children:bo(C.status)}),e.jsxs(m,{sx:{flex:1,minWidth:0},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:C.name}),e.jsx(K,{size:"sm",color:Rt(C.status),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content",textTransform:"capitalize"},children:C.status})]}),e.jsxs(g,{level:"body-xs",color:"neutral",sx:{mb:.5},children:["Campaign #",C.CampaignNumber," • ",new Date(C.created_at).toLocaleDateString()]}),e.jsxs(m,{sx:{display:"flex",gap:2,mb:.5},children:[e.jsxs(g,{level:"body-xs",color:"neutral",children:["Recipients: ",C.recipients?.length??0]}),C.scheduled_at&&e.jsxs(g,{level:"body-xs",color:"neutral",children:["Scheduled: ",ls(new Date(C.scheduled_at),"MMM dd, HH:mm")]})]}),C.message&&e.jsxs(g,{level:"body-xs",color:"neutral",sx:{fontStyle:"italic",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:['"',C.message,'"']})]})]})},C.id))})]}),O=()=>e.jsxs(ge,{children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:G.sizes.xlarge},children:"SMS Campaigns"}),e.jsxs(m,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(q,{placeholder:"Search campaigns...",sx:{flex:1},value:a,onChange:C=>c(C.target.value),startDecorator:e.jsx(me,{})}),e.jsxs(ee,{placeholder:"Filter status",value:d,onChange:(C,j)=>x(j??""),sx:{minWidth:160},children:[e.jsx(z,{value:"",children:"All Statuses"}),e.jsx(z,{value:"draft",children:"Draft"}),e.jsx(z,{value:"scheduled",children:"Scheduled"}),e.jsx(z,{value:"sent",children:"Sent"}),e.jsx(z,{value:"failed",children:"Failed"})]}),e.jsx(F,{onClick:()=>w(!0),variant:"solid",startDecorator:e.jsx(oe,{}),children:"Create Campaign"})]}),e.jsxs(ke,{children:[n&&e.jsx(Ae,{}),l&&e.jsxs(g,{color:"danger",children:["Error: ",l]}),e.jsxs($e,{"aria-label":"SMS Campaigns",sx:{minWidth:800},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:Qe,children:"Campaign #"}),e.jsx("th",{style:Qe,children:"Name"}),e.jsx("th",{style:Qe,children:"Status"}),e.jsx("th",{style:Qe,children:"Scheduled"}),e.jsx("th",{style:Qe,children:"Sent"}),e.jsx("th",{style:Qe,children:"Recipients"}),e.jsx("th",{style:Qe,children:"Message"})]})}),e.jsxs("tbody",{children:[b.length===0&&!n&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...Me},children:"No campaigns found."})}),b.map(C=>e.jsxs("tr",{style:{cursor:"pointer",height:48},children:[e.jsx("td",{style:Me,children:C.CampaignNumber}),e.jsx("td",{style:Me,children:C.name}),e.jsx("td",{style:Me,children:e.jsx(K,{size:"sm",color:Rt(C.status),variant:"soft",sx:{textTransform:"capitalize"},children:C.status})}),e.jsx("td",{style:Me,children:C.scheduled_at?ls(new Date(C.scheduled_at),"yyyy-MM-dd HH:mm"):"-"}),e.jsx("td",{style:Me,children:C.sent_at?ls(new Date(C.sent_at),"yyyy-MM-dd HH:mm"):"-"}),e.jsx("td",{style:Me,children:C.recipients?.length??0}),e.jsx("td",{style:Me,children:e.jsx(g,{level:"body-sm",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:C.message||"-"})})]},C.id))]})]})]})]});return e.jsxs(Ue,{children:[s?e.jsx(S,{}):e.jsx(O,{}),e.jsx(_e,{open:f,onClose:()=>w(!1),children:e.jsxs(Pe,{children:[e.jsx(Ve,{}),e.jsx(g,{level:"h4",children:"Create New Campaign"}),e.jsx(g,{level:"body-sm",sx:{mt:1,mb:2},children:"Campaign creation functionality will be implemented here."}),e.jsx(F,{onClick:()=>w(!1),variant:"outlined",children:"Close"})]})})]})};function hs(s,t){return t===0?s>0?100:0:(s-t)/t*100}function xs(s){return s==null?"—":`${s>0?"+":s<0?"−":""}${Math.abs(Math.round(s))}%`}async function wo(){const s=new Date,t=s.toISOString().slice(0,10),r=new Date(s.getTime()-30*24*60*60*1e3).toISOString().slice(0,10),n=new Date(s.getTime()-60*24*60*60*1e3).toISOString().slice(0,10),i=new Date(s.getTime()-30*24*60*60*1e3-1).toISOString().slice(0,10),l=await L.from("Orders").select("order_total, customer_email, date",{count:"exact"}).not("order_total","is",null);if(l.error||!l.data)throw new Error("Failed to fetch order stats");const o=l.data,a=o.filter(b=>b.date&&b.date>=r&&b.date<=t),c=o.filter(b=>b.date&&b.date>=n&&b.date<=i),d=a.reduce((b,S)=>b+(typeof S.order_total=="number"?S.order_total:0),0),x=c.reduce((b,S)=>b+(typeof S.order_total=="number"?S.order_total:0),0),f=a.length,w=c.length,_=new Set(a.map(b=>b.customer_email).filter(Boolean)),h=new Set(c.map(b=>b.customer_email).filter(Boolean));return{totalSales:d,orderCount:f,customerCount:_.size,salesChange:hs(d,x),ordersChange:hs(f,w),customersChange:hs(_.size,h.size)}}const So=()=>{const[s,t]=u.useState(null),[r,n]=u.useState(null),[i,l]=u.useState(null),[o,a]=u.useState(null),[c,d]=u.useState(null),[x,f]=u.useState(null),[w,_]=u.useState(!0),[h,b]=u.useState(null);return Pt("(max-width:600px)"),u.useEffect(()=>{let S=!0,O=!0;async function C(){O&&_(!0),b(null);try{const{totalSales:P,orderCount:R,customerCount:A,salesChange:k,ordersChange:$,customersChange:se}=await wo();S&&(t(P),n(R),l(A),a(k),d($),f(se))}catch(P){S&&b(P.message)}finally{O&&_(!1),O=!1}}C();const j=setInterval(C,1e4);return()=>{S=!1,clearInterval(j)}},[]),e.jsxs(m,{sx:{p:{xs:1,md:4},pt:{xs:0,md:4}},children:[e.jsx(g,{level:"h2",sx:{mb:2},children:"Dashboard"}),e.jsxs(Ke,{container:!0,spacing:2,children:[e.jsx(Ke,{xs:12,md:4,children:e.jsxs(ke,{variant:"outlined",children:[e.jsx(g,{level:"h4",children:"Total Sales"}),e.jsx(g,{level:"h2",color:"success",children:w?"Loading...":h?"—":`$${s?.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[w?"":xs(o)," from last 30 days"]})]})}),e.jsx(Ke,{xs:12,md:4,children:e.jsxs(ke,{variant:"outlined",children:[e.jsx(g,{level:"h4",children:"Orders"}),e.jsx(g,{level:"h2",color:"primary",children:w?"Loading...":h?"—":r?.toLocaleString()}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[w?"":xs(c)," from last 30 days"]})]})}),e.jsx(Ke,{xs:12,md:4,children:e.jsxs(ke,{variant:"outlined",children:[e.jsx(g,{level:"h4",children:"Customers"}),e.jsx(g,{level:"h2",color:"warning",children:w?"Loading...":h?"—":i?.toLocaleString()}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[w?"":xs(x)," new last 30 days"]})]})})]})]})},Te=({children:s})=>{const[t,r]=u.useState(null),[n,i]=u.useState(!0);return u.useEffect(()=>{async function l(){const{data:o}=await L.auth.getSession();r(o?.session||null),i(!1)}l()},[]),n?e.jsx("div",{children:"Loading..."}):t?e.jsx(e.Fragment,{children:s}):e.jsx(qt,{to:"/",replace:!0})};function vo({onLogin:s}){const t=Os(),[r,n]=u.useState(""),[i,l]=u.useState(""),[o,a]=u.useState(!1),[c,d]=u.useState(null);u.useEffect(()=>{if(window.location.pathname==="/login"){async function w(){const{data:_}=await L.auth.getSession();_?.session&&t("/dashboard")}w()}},[t]);async function x(w){w.preventDefault(),a(!0),d(null);const{data:_,error:h}=await L.auth.signInWithPassword({email:r,password:i});if(h){console.error("[Login] Auth error:",h),d(h.message),a(!1);return}const b=_.user?.id;if(!b){d("Login failed: No user ID."),a(!1);return}let{data:S,error:O}=await L.from("users").select("*").eq("id",b).single();if(O||!S){console.error("[Login] User fetch error:",O);const{error:C}=await L.from("users").upsert({id:b,email:_.user.email,name:_.user.user_metadata?.full_name||_.user.user_metadata?.name||"",role:"employee"});if(C){console.error("Upsert failed:",C),d("Upsert failed: "+C.message),a(!1);return}let j=3,P,R;for(;j>0;){await new Promise($=>setTimeout($,300));const{data:A,error:k}=await L.from("users").select("*").eq("id",b).single();if(P=A,R=k,R&&console.error("[Login] Retry user fetch error:",R),P&&!R){S=P,O=null;break}j--}if(O||!S){d("Access denied: User not found."),await L.auth.signOut(),a(!1);return}}if(S.role!=="employee"){d("Access denied: Only employees can access this app."),await L.auth.signOut(),a(!1);return}a(!1),s(),t("/dashboard")}async function f(){a(!0),d(null),a(!1)}return e.jsx(m,{sx:{minHeight:"100dvh",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.body"},children:e.jsxs(ke,{sx:{minWidth:340,p:4},children:[e.jsx(g,{level:"h3",sx:{mb:2},children:"Sign in to Smartbuy"}),e.jsxs("form",{onSubmit:x,children:[e.jsx(q,{type:"email",placeholder:"Email",value:r,onChange:w=>n(w.target.value),sx:{mb:2},required:!0}),e.jsx(q,{type:"password",placeholder:"Password",value:i,onChange:w=>l(w.target.value),sx:{mb:2},required:!0}),e.jsx(F,{type:"submit",loading:o,fullWidth:!0,sx:{mb:1},children:"Sign In"})]}),e.jsx(F,{onClick:f,variant:"outlined",fullWidth:!0,sx:{mb:1},disabled:o,children:"Sign in with Google"}),c&&e.jsx(g,{color:"danger",sx:{mt:1},children:c})]})})}function ko(){return e.jsx(Ds,{children:e.jsx(be,{path:"*",element:e.jsx(vo,{onLogin:()=>{}})})})}const ce={fontSize:G.sizes.small},Co=()=>{const{isMobile:s}=Se();Wr();const[t,r]=u.useState([]),[n,i]=u.useState([]),[l,o]=u.useState(""),[a,c]=u.useState(!1),[d,x]=u.useState(!1),[f,w]=u.useState(""),[_,h]=u.useState(""),[b,S]=u.useState(""),[O,C]=u.useState(""),[j,P]=u.useState(null),[R,A]=u.useState(!1),[k,$]=u.useState(""),[se,Z]=u.useState(""),[le,T]=u.useState(!1),[v,I]=u.useState(!1),[E,N]=u.useState(""),[he,Oe]=u.useState("success"),re=(p,M="success")=>{N(p),Oe(M),I(!0)},ve=async()=>{try{const{data:p,error:M}=await L.from("stock_movements").select(`
                    *,
                    Products (
                        ProductName,
                        ProductID
                    )
                `).order("date",{ascending:!1});M?(console.error("Error fetching movements:",M),r([]),re("Failed to load movements","danger")):r(p||[])}catch(p){console.error("Unexpected error:",p),r([]),re("An unexpected error occurred","danger")}},Le=async()=>{try{const{data:p,error:M}=await L.from("Products").select("*").order("ProductName");M?(console.error("Error fetching products:",M),i([])):i(p||[])}catch(p){console.error("Unexpected error:",p),i([])}},Je=async p=>{if(!p){P(null);return}A(!0);try{const{data:M,error:Q}=await L.from("stock_movements").select("movement_type, quantity").eq("product_id",p);if(Q)console.error("Error fetching stock movements:",Q),P(null);else{const W=(M||[]).reduce((X,Y)=>{switch(Y.movement_type){case"incoming":return X+Y.quantity;case"outgoing":return X-Y.quantity;case"adjustment":return X+Y.quantity;default:return X}},0);P(W)}}catch(M){console.error("Error calculating stock:",M),P(null)}finally{A(!1)}};u.useEffect(()=>{O?Je(O):P(null)},[O]);const dt=async()=>{if(!O||k===""||j===null){re("Please select a product and enter a valid stock level","warning");return}const M=Number(k)-j;if(M===0){re("No adjustment needed - the stock level is already at the specified amount","warning");return}T(!0);try{const{error:Q}=await L.from("stock_movements").insert({product_id:O,movement_type:"adjustment",quantity:M,reason:`Manual adjustment: ${se||"Stock level correction"}`,date:new Date().toISOString()});Q?(console.error("Error creating adjustment:",Q),re("Failed to create adjustment: "+Q.message,"danger")):(C(""),$(""),Z(""),P(null),c(!1),ve(),re("Stock adjustment created successfully!","success"))}catch(Q){console.error("Unexpected error:",Q),re("An unexpected error occurred","danger")}finally{T(!1)}};u.useEffect(()=>{ve(),Le()},[]);const Be=t.filter(p=>{const M=l.toLowerCase(),Q=l===""||p.id.toLowerCase().includes(M)||p.product_id.toLowerCase().includes(M)||p.movement_type.toLowerCase().includes(M)||(p.reason?.toLowerCase().includes(M)??!1)||(p.Products?.ProductName?.toLowerCase().includes(M)??!1),W=f===""||p.movement_type===f,X=_===""||p.product_id===_,Y=b===""||(()=>{const pe=p.reason?.toLowerCase()||"";switch(b){case"manual":return pe.includes("manual")||pe.includes("adjustment")||pe.includes("correction");case"damage":return pe.includes("damage")||pe.includes("broken")||pe.includes("defect");case"loss":return pe.includes("loss")||pe.includes("lost")||pe.includes("missing");case"found":return pe.includes("found")||pe.includes("surplus")||pe.includes("extra");case"po":return pe.includes("po")||pe.includes("purchase")||pe.includes("receipt");default:return!0}})();return Q&&W&&X&&Y}),Ee=p=>{switch(p.movement_type){case"incoming":return"success";case"outgoing":return"danger";case"adjustment":return p.quantity>=0?"success":"danger";default:return"neutral"}},rt=p=>{switch(p.movement_type){case"incoming":return"↑";case"outgoing":return"↓";case"adjustment":return"⚖";default:return"•"}},nt=p=>{switch(p.movement_type){case"incoming":return`+${p.quantity}`;case"outgoing":return`-${p.quantity}`;case"adjustment":return p.quantity>=0?`+${p.quantity}`:`${p.quantity}`;default:return p.quantity}},it=()=>{w(""),h(""),S("")},D=f!==""||_!==""||b!=="",B=()=>e.jsxs(m,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(ge,{padding:"medium",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:G.sizes.xlarge},children:"Stock Movements"}),e.jsxs(m,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(q,{placeholder:"Search movements...",value:l,onChange:p=>o(p.target.value),startDecorator:e.jsx(me,{}),sx:{flex:1}}),e.jsx(ne,{variant:D?"solid":"soft",color:D?"primary":"neutral",size:"sm",onClick:()=>x(!0),children:e.jsx(Es,{})})]}),D&&e.jsxs(m,{sx:{mb:2,display:"flex",gap:1,flexWrap:"wrap"},children:[f&&e.jsxs(K,{size:"sm",variant:"soft",color:"primary",children:["Type: ",f]}),_&&e.jsxs(K,{size:"sm",variant:"soft",color:"primary",children:["Product: ",n.find(p=>p.uuid===_)?.ProductName||"Selected"]}),b&&e.jsxs(K,{size:"sm",variant:"soft",color:"primary",children:["Reason: ",b]})]})]}),e.jsx(m,{children:Be.length===0?e.jsx(m,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:"No stock movements found"})}):Be.map(p=>e.jsx(m,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(m,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${Ee(p)}.100`,color:`${Ee(p)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",flexShrink:0},children:rt(p)}),e.jsxs(m,{sx:{flex:1,minWidth:0},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:p.Products?.ProductName||"Unknown Product"}),e.jsx(K,{size:"sm",color:Ee(p),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content"},children:nt(p)})]}),e.jsxs(g,{level:"body-xs",color:"neutral",sx:{mb:.5},children:["ID: ",p.Products?.ProductID||"N/A"," • ",new Date(p.date).toLocaleDateString()]}),p.reason&&e.jsx(g,{level:"body-xs",color:"neutral",sx:{fontStyle:"italic",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:p.reason})]})]})},p.id))}),e.jsx(ne,{color:"primary",variant:"soft",size:"sm",sx:{position:"fixed",bottom:80,right:16,zIndex:1e3,borderRadius:"8px",width:40,height:40,boxShadow:"sm",bgcolor:"primary.100","&:hover":{bgcolor:"primary.200",boxShadow:"md"}},onClick:()=>c(!0),children:e.jsx(oe,{fontSize:"small"})})]}),xe=()=>e.jsxs(ge,{variant:"page",padding:"large",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:G.sizes.xlarge},children:"Stock Movements"}),e.jsxs(m,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(q,{placeholder:"Search movements...",sx:{flex:1,fontSize:G.sizes.small},value:l,onChange:p=>o(p.target.value),startDecorator:e.jsx(me,{})}),e.jsx(F,{variant:"solid",startDecorator:e.jsx(oe,{}),onClick:()=>c(!0),sx:{fontSize:G.sizes.small},children:"Adjust"})]}),e.jsx(ke,{children:e.jsxs($e,{"aria-label":"Stock Movements",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:ce,children:"ID"}),e.jsx("th",{style:ce,children:"Product"}),e.jsx("th",{style:ce,children:"Movement Type"}),e.jsx("th",{style:ce,children:"Quantity"}),e.jsx("th",{style:ce,children:"Reason"}),e.jsx("th",{style:ce,children:"Date"})]})}),e.jsxs("tbody",{children:[Be.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{textAlign:"center",color:"#888",...ce},children:"No stock movements found."})}),Be.map(p=>e.jsxs("tr",{style:{cursor:"pointer"},children:[e.jsxs("td",{style:ce,children:[p.id.substring(0,8),"..."]}),e.jsx("td",{style:ce,children:p.Products?e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:p.Products.ProductName}),e.jsxs("div",{style:{fontSize:"0.8em",color:"#666"},children:["ID: ",p.Products.ProductID]})]}):e.jsx("span",{style:{color:"#999",fontStyle:"italic"},children:"Unknown Product"})}),e.jsx("td",{style:ce,children:e.jsx(K,{size:"sm",variant:"soft",color:Ee(p),children:p.movement_type==="incoming"?"↑ Incoming":p.movement_type==="outgoing"?"↓ Outgoing":"⚖ Adjustment"})}),e.jsx("td",{style:ce,children:e.jsx("span",{style:{fontWeight:"bold",color:Ee(p)==="success"?"#059669":Ee(p)==="danger"?"#dc2626":"#666"},children:nt(p)})}),e.jsx("td",{style:ce,children:p.reason||"N/A"}),e.jsx("td",{style:ce,children:new Date(p.date).toLocaleString()})]},p.id))]})]})})]});return e.jsxs(Ue,{children:[s?e.jsx(B,{}):e.jsx(xe,{}),e.jsx($t,{open:a,onClose:()=>c(!1),title:"Manual Stock Adjustment",size:"medium",actions:e.jsxs(m,{sx:{display:"flex",gap:2},children:[e.jsx(F,{variant:"plain",onClick:()=>c(!1),sx:ce,children:"Cancel"}),e.jsx(F,{variant:"solid",onClick:dt,loading:le,disabled:!O||k===""||j===null||Number(k)===j,sx:ce,children:"Create Adjustment"})]}),children:e.jsxs(ie,{spacing:2,children:[e.jsxs(de,{children:[e.jsx(ue,{children:"Product"}),e.jsx(ee,{placeholder:"Select a product...",value:O,onChange:(p,M)=>C(M||""),children:n.map(p=>e.jsxs(z,{value:p.uuid,children:[p.ProductName," (ID: ",p.ProductID,")"]},p.uuid))})]}),O&&e.jsxs(de,{children:[e.jsx(ue,{children:"Current Stock Level"}),e.jsx(q,{value:R?"Loading...":j!==null?j:"N/A",readOnly:!0,sx:{bgcolor:"neutral.100",color:j!==null&&j<=0?"danger.500":"neutral.600"}}),j!==null&&j<=0&&e.jsx(g,{level:"body-sm",sx:{color:"danger.500",mt:.5},children:"⚠️ Warning: Product is at or below zero stock level"})]}),j!==null&&e.jsxs(de,{children:[e.jsx(ue,{children:"Actual Stock Level"}),e.jsx(q,{type:"number",placeholder:"Enter the actual stock level...",value:k,onChange:p=>$(p.target.value),sx:{...ce},slotProps:{input:{min:0,max:999999}}}),k!==""&&j!==null&&e.jsx(g,{level:"body-sm",sx:{mt:.5,color:Number(k)>j?"success.600":Number(k)<j?"danger.600":"neutral.600"},children:Number(k)>j?`+${Number(k)-j} (increase)`:Number(k)<j?`${Number(k)-j} (decrease)`:"No change needed"})]}),e.jsxs(de,{children:[e.jsx(ue,{children:"Reason for Adjustment"}),e.jsx(q,{placeholder:"e.g., damage, loss, found inventory, physical count correction...",value:se,onChange:p=>Z(p.target.value),sx:{...ce}})]})]})}),s&&e.jsx($t,{open:d,onClose:()=>x(!1),title:"Filter Movements",size:"medium",actions:e.jsxs(m,{sx:{display:"flex",gap:1,justifyContent:"space-between",width:"100%"},children:[e.jsx(F,{variant:"plain",color:"neutral",onClick:it,disabled:!D,children:"Clear All"}),e.jsx(F,{onClick:()=>x(!1),children:"Apply Filters"})]}),children:e.jsxs(ie,{spacing:2,children:[e.jsxs(de,{children:[e.jsx(ue,{children:"Movement Type"}),e.jsxs(ee,{placeholder:"All types",value:f,onChange:(p,M)=>w(M||""),children:[e.jsx(z,{value:"",children:"All Types"}),e.jsx(z,{value:"incoming",children:"Incoming"}),e.jsx(z,{value:"outgoing",children:"Outgoing"}),e.jsx(z,{value:"adjustment",children:"Adjustment"})]})]}),e.jsxs(de,{children:[e.jsx(ue,{children:"Product"}),e.jsxs(ee,{placeholder:"All products",value:_,onChange:(p,M)=>h(M||""),children:[e.jsx(z,{value:"",children:"All Products"}),n.map(p=>e.jsx(z,{value:p.uuid,children:p.ProductName},p.uuid))]})]}),e.jsxs(de,{children:[e.jsx(ue,{children:"Reason Category"}),e.jsxs(ee,{placeholder:"All reasons",value:b,onChange:(p,M)=>S(M||""),children:[e.jsx(z,{value:"",children:"All Reasons"}),e.jsx(z,{value:"manual",children:"Manual Adjustment"}),e.jsx(z,{value:"damage",children:"Damage/Defect"}),e.jsx(z,{value:"loss",children:"Loss/Missing"}),e.jsx(z,{value:"found",children:"Found/Surplus"}),e.jsx(z,{value:"po",children:"Purchase Order"})]})]})]})}),e.jsx(Qt,{open:v,onClose:()=>I(!1),autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{top:16,zIndex:2e3},children:e.jsx(Cs,{color:he,variant:"solid",sx:{width:"100%"},children:E})})]})};function Ms(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var st=Ms();function jn(s){st=s}var mt={exec:()=>null};function V(s,t=""){let r=typeof s=="string"?s:s.source,n={replace:(i,l)=>{let o=typeof l=="string"?l:l.source;return o=o.replace(we.caret,"$1"),r=r.replace(i,o),n},getRegex:()=>new RegExp(r,t)};return n}var we={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:s=>new RegExp(`^( {0,3}${s})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}#`),htmlBeginRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}<(?:[a-z].*>|!--)`,"i")},Ro=/^(?:[ \t]*(?:\n|$))+/,_o=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Po=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,wt=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Eo=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Fs=/(?:[*+-]|\d{1,9}[.)])/,bn=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,yn=V(bn).replace(/bull/g,Fs).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Ao=V(bn).replace(/bull/g,Fs).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),qs=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Oo=/^[^\n]+/,$s=/(?!\s*\])(?:\\.|[^\[\]\\])+/,Io=V(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",$s).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Do=V(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Fs).getRegex(),ns="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Us=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,To=V("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Us).replace("tag",ns).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),wn=V(qs).replace("hr",wt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ns).getRegex(),zo=V(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",wn).getRegex(),Bs={blockquote:zo,code:_o,def:Io,fences:Po,heading:Eo,hr:wt,html:To,lheading:yn,list:Do,newline:Ro,paragraph:wn,table:mt,text:Oo},kr=V("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",wt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ns).getRegex(),Lo={...Bs,lheading:Ao,table:kr,paragraph:V(qs).replace("hr",wt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",kr).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ns).getRegex()},No={...Bs,html:V(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Us).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:mt,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:V(qs).replace("hr",wt).replace("heading",` *#{1,6} *[^
]`).replace("lheading",yn).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Mo=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Fo=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Sn=/^( {2,}|\\)\n(?!\s*$)/,qo=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,is=/[\p{P}\p{S}]/u,Ws=/[\s\p{P}\p{S}]/u,vn=/[^\s\p{P}\p{S}]/u,$o=V(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Ws).getRegex(),kn=/(?!~)[\p{P}\p{S}]/u,Uo=/(?!~)[\s\p{P}\p{S}]/u,Bo=/(?:[^\s\p{P}\p{S}]|~)/u,Wo=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,Cn=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Ho=V(Cn,"u").replace(/punct/g,is).getRegex(),Vo=V(Cn,"u").replace(/punct/g,kn).getRegex(),Rn="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Jo=V(Rn,"gu").replace(/notPunctSpace/g,vn).replace(/punctSpace/g,Ws).replace(/punct/g,is).getRegex(),Go=V(Rn,"gu").replace(/notPunctSpace/g,Bo).replace(/punctSpace/g,Uo).replace(/punct/g,kn).getRegex(),Zo=V("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,vn).replace(/punctSpace/g,Ws).replace(/punct/g,is).getRegex(),Qo=V(/\\(punct)/,"gu").replace(/punct/g,is).getRegex(),Ko=V(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Xo=V(Us).replace("(?:-->|$)","-->").getRegex(),Yo=V("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Xo).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Wt=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,ea=V(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Wt).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),_n=V(/^!?\[(label)\]\[(ref)\]/).replace("label",Wt).replace("ref",$s).getRegex(),Pn=V(/^!?\[(ref)\](?:\[\])?/).replace("ref",$s).getRegex(),ta=V("reflink|nolink(?!\\()","g").replace("reflink",_n).replace("nolink",Pn).getRegex(),Hs={_backpedal:mt,anyPunctuation:Qo,autolink:Ko,blockSkip:Wo,br:Sn,code:Fo,del:mt,emStrongLDelim:Ho,emStrongRDelimAst:Jo,emStrongRDelimUnd:Zo,escape:Mo,link:ea,nolink:Pn,punctuation:$o,reflink:_n,reflinkSearch:ta,tag:Yo,text:qo,url:mt},sa={...Hs,link:V(/^!?\[(label)\]\((.*?)\)/).replace("label",Wt).getRegex(),reflink:V(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Wt).getRegex()},ws={...Hs,emStrongRDelimAst:Go,emStrongLDelim:Vo,url:V(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},ra={...ws,br:V(Sn).replace("{2,}","*").getRegex(),text:V(ws.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},_t={normal:Bs,gfm:Lo,pedantic:No},ht={normal:Hs,gfm:ws,breaks:ra,pedantic:sa},na={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Cr=s=>na[s];function ze(s,t){if(t){if(we.escapeTest.test(s))return s.replace(we.escapeReplace,Cr)}else if(we.escapeTestNoEncode.test(s))return s.replace(we.escapeReplaceNoEncode,Cr);return s}function Rr(s){try{s=encodeURI(s).replace(we.percentDecode,"%")}catch{return null}return s}function _r(s,t){let r=s.replace(we.findPipe,(l,o,a)=>{let c=!1,d=o;for(;--d>=0&&a[d]==="\\";)c=!c;return c?"|":" |"}),n=r.split(we.splitPipe),i=0;if(n[0].trim()||n.shift(),n.length>0&&!n.at(-1)?.trim()&&n.pop(),t)if(n.length>t)n.splice(t);else for(;n.length<t;)n.push("");for(;i<n.length;i++)n[i]=n[i].trim().replace(we.slashPipe,"|");return n}function xt(s,t,r){let n=s.length;if(n===0)return"";let i=0;for(;i<n&&s.charAt(n-i-1)===t;)i++;return s.slice(0,n-i)}function ia(s,t){if(s.indexOf(t[1])===-1)return-1;let r=0;for(let n=0;n<s.length;n++)if(s[n]==="\\")n++;else if(s[n]===t[0])r++;else if(s[n]===t[1]&&(r--,r<0))return n;return r>0?-2:-1}function Pr(s,t,r,n,i){let l=t.href,o=t.title||null,a=s[1].replace(i.other.outputLinkReplace,"$1");n.state.inLink=!0;let c={type:s[0].charAt(0)==="!"?"image":"link",raw:r,href:l,title:o,text:a,tokens:n.inlineTokens(a)};return n.state.inLink=!1,c}function la(s,t,r){let n=s.match(r.other.indentCodeCompensation);if(n===null)return t;let i=n[1];return t.split(`
`).map(l=>{let o=l.match(r.other.beginningSpace);if(o===null)return l;let[a]=o;return a.length>=i.length?l.slice(i.length):l}).join(`
`)}var Ht=class{options;rules;lexer;constructor(s){this.options=s||st}space(s){let t=this.rules.block.newline.exec(s);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(s){let t=this.rules.block.code.exec(s);if(t){let r=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?r:xt(r,`
`)}}}fences(s){let t=this.rules.block.fences.exec(s);if(t){let r=t[0],n=la(r,t[3]||"",this.rules);return{type:"code",raw:r,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:n}}}heading(s){let t=this.rules.block.heading.exec(s);if(t){let r=t[2].trim();if(this.rules.other.endingHash.test(r)){let n=xt(r,"#");(this.options.pedantic||!n||this.rules.other.endingSpaceChar.test(n))&&(r=n.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:r,tokens:this.lexer.inline(r)}}}hr(s){let t=this.rules.block.hr.exec(s);if(t)return{type:"hr",raw:xt(t[0],`
`)}}blockquote(s){let t=this.rules.block.blockquote.exec(s);if(t){let r=xt(t[0],`
`).split(`
`),n="",i="",l=[];for(;r.length>0;){let o=!1,a=[],c;for(c=0;c<r.length;c++)if(this.rules.other.blockquoteStart.test(r[c]))a.push(r[c]),o=!0;else if(!o)a.push(r[c]);else break;r=r.slice(c);let d=a.join(`
`),x=d.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}
${d}`:d,i=i?`${i}
${x}`:x;let f=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(x,l,!0),this.lexer.state.top=f,r.length===0)break;let w=l.at(-1);if(w?.type==="code")break;if(w?.type==="blockquote"){let _=w,h=_.raw+`
`+r.join(`
`),b=this.blockquote(h);l[l.length-1]=b,n=n.substring(0,n.length-_.raw.length)+b.raw,i=i.substring(0,i.length-_.text.length)+b.text;break}else if(w?.type==="list"){let _=w,h=_.raw+`
`+r.join(`
`),b=this.list(h);l[l.length-1]=b,n=n.substring(0,n.length-w.raw.length)+b.raw,i=i.substring(0,i.length-_.raw.length)+b.raw,r=h.substring(l.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:n,tokens:l,text:i}}}list(s){let t=this.rules.block.list.exec(s);if(t){let r=t[1].trim(),n=r.length>1,i={type:"list",raw:"",ordered:n,start:n?+r.slice(0,-1):"",loose:!1,items:[]};r=n?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=n?r:"[*+-]");let l=this.rules.other.listItemRegex(r),o=!1;for(;s;){let c=!1,d="",x="";if(!(t=l.exec(s))||this.rules.block.hr.test(s))break;d=t[0],s=s.substring(d.length);let f=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,O=>" ".repeat(3*O.length)),w=s.split(`
`,1)[0],_=!f.trim(),h=0;if(this.options.pedantic?(h=2,x=f.trimStart()):_?h=t[1].length+1:(h=t[2].search(this.rules.other.nonSpaceChar),h=h>4?1:h,x=f.slice(h),h+=t[1].length),_&&this.rules.other.blankLine.test(w)&&(d+=w+`
`,s=s.substring(w.length+1),c=!0),!c){let O=this.rules.other.nextBulletRegex(h),C=this.rules.other.hrRegex(h),j=this.rules.other.fencesBeginRegex(h),P=this.rules.other.headingBeginRegex(h),R=this.rules.other.htmlBeginRegex(h);for(;s;){let A=s.split(`
`,1)[0],k;if(w=A,this.options.pedantic?(w=w.replace(this.rules.other.listReplaceNesting,"  "),k=w):k=w.replace(this.rules.other.tabCharGlobal,"    "),j.test(w)||P.test(w)||R.test(w)||O.test(w)||C.test(w))break;if(k.search(this.rules.other.nonSpaceChar)>=h||!w.trim())x+=`
`+k.slice(h);else{if(_||f.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||j.test(f)||P.test(f)||C.test(f))break;x+=`
`+w}!_&&!w.trim()&&(_=!0),d+=A+`
`,s=s.substring(A.length+1),f=k.slice(h)}}i.loose||(o?i.loose=!0:this.rules.other.doubleBlankLine.test(d)&&(o=!0));let b=null,S;this.options.gfm&&(b=this.rules.other.listIsTask.exec(x),b&&(S=b[0]!=="[ ] ",x=x.replace(this.rules.other.listReplaceTask,""))),i.items.push({type:"list_item",raw:d,task:!!b,checked:S,loose:!1,text:x,tokens:[]}),i.raw+=d}let a=i.items.at(-1);if(a)a.raw=a.raw.trimEnd(),a.text=a.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let c=0;c<i.items.length;c++)if(this.lexer.state.top=!1,i.items[c].tokens=this.lexer.blockTokens(i.items[c].text,[]),!i.loose){let d=i.items[c].tokens.filter(f=>f.type==="space"),x=d.length>0&&d.some(f=>this.rules.other.anyLine.test(f.raw));i.loose=x}if(i.loose)for(let c=0;c<i.items.length;c++)i.items[c].loose=!0;return i}}html(s){let t=this.rules.block.html.exec(s);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(s){let t=this.rules.block.def.exec(s);if(t){let r=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:r,raw:t[0],href:n,title:i}}}table(s){let t=this.rules.block.table.exec(s);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let r=_r(t[1]),n=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],l={type:"table",raw:t[0],header:[],align:[],rows:[]};if(r.length===n.length){for(let o of n)this.rules.other.tableAlignRight.test(o)?l.align.push("right"):this.rules.other.tableAlignCenter.test(o)?l.align.push("center"):this.rules.other.tableAlignLeft.test(o)?l.align.push("left"):l.align.push(null);for(let o=0;o<r.length;o++)l.header.push({text:r[o],tokens:this.lexer.inline(r[o]),header:!0,align:l.align[o]});for(let o of i)l.rows.push(_r(o,l.header.length).map((a,c)=>({text:a,tokens:this.lexer.inline(a),header:!1,align:l.align[c]})));return l}}lheading(s){let t=this.rules.block.lheading.exec(s);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(s){let t=this.rules.block.paragraph.exec(s);if(t){let r=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:r,tokens:this.lexer.inline(r)}}}text(s){let t=this.rules.block.text.exec(s);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(s){let t=this.rules.inline.escape.exec(s);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(s){let t=this.rules.inline.tag.exec(s);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(s){let t=this.rules.inline.link.exec(s);if(t){let r=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(r)){if(!this.rules.other.endAngleBracket.test(r))return;let l=xt(r.slice(0,-1),"\\");if((r.length-l.length)%2===0)return}else{let l=ia(t[2],"()");if(l===-2)return;if(l>-1){let o=(t[0].indexOf("!")===0?5:4)+t[1].length+l;t[2]=t[2].substring(0,l),t[0]=t[0].substring(0,o).trim(),t[3]=""}}let n=t[2],i="";if(this.options.pedantic){let l=this.rules.other.pedanticHrefTitle.exec(n);l&&(n=l[1],i=l[3])}else i=t[3]?t[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(r)?n=n.slice(1):n=n.slice(1,-1)),Pr(t,{href:n&&n.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(s,t){let r;if((r=this.rules.inline.reflink.exec(s))||(r=this.rules.inline.nolink.exec(s))){let n=(r[2]||r[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=t[n.toLowerCase()];if(!i){let l=r[0].charAt(0);return{type:"text",raw:l,text:l}}return Pr(r,i,r[0],this.lexer,this.rules)}}emStrong(s,t,r=""){let n=this.rules.inline.emStrongLDelim.exec(s);if(!(!n||n[3]&&r.match(this.rules.other.unicodeAlphaNumeric))&&(!(n[1]||n[2])||!r||this.rules.inline.punctuation.exec(r))){let i=[...n[0]].length-1,l,o,a=i,c=0,d=n[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(d.lastIndex=0,t=t.slice(-1*s.length+i);(n=d.exec(t))!=null;){if(l=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!l)continue;if(o=[...l].length,n[3]||n[4]){a+=o;continue}else if((n[5]||n[6])&&i%3&&!((i+o)%3)){c+=o;continue}if(a-=o,a>0)continue;o=Math.min(o,o+a+c);let x=[...n[0]][0].length,f=s.slice(0,i+n.index+x+o);if(Math.min(i,o)%2){let _=f.slice(1,-1);return{type:"em",raw:f,text:_,tokens:this.lexer.inlineTokens(_)}}let w=f.slice(2,-2);return{type:"strong",raw:f,text:w,tokens:this.lexer.inlineTokens(w)}}}}codespan(s){let t=this.rules.inline.code.exec(s);if(t){let r=t[2].replace(this.rules.other.newLineCharGlobal," "),n=this.rules.other.nonSpaceChar.test(r),i=this.rules.other.startingSpaceChar.test(r)&&this.rules.other.endingSpaceChar.test(r);return n&&i&&(r=r.substring(1,r.length-1)),{type:"codespan",raw:t[0],text:r}}}br(s){let t=this.rules.inline.br.exec(s);if(t)return{type:"br",raw:t[0]}}del(s){let t=this.rules.inline.del.exec(s);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(s){let t=this.rules.inline.autolink.exec(s);if(t){let r,n;return t[2]==="@"?(r=t[1],n="mailto:"+r):(r=t[1],n=r),{type:"link",raw:t[0],text:r,href:n,tokens:[{type:"text",raw:r,text:r}]}}}url(s){let t;if(t=this.rules.inline.url.exec(s)){let r,n;if(t[2]==="@")r=t[0],n="mailto:"+r;else{let i;do i=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??"";while(i!==t[0]);r=t[0],t[1]==="www."?n="http://"+t[0]:n=t[0]}return{type:"link",raw:t[0],text:r,href:n,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(s){let t=this.rules.inline.text.exec(s);if(t){let r=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:r}}}},Fe=class Ss{tokens;options;state;tokenizer;inlineQueue;constructor(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||st,this.options.tokenizer=this.options.tokenizer||new Ht,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let r={other:we,block:_t.normal,inline:ht.normal};this.options.pedantic?(r.block=_t.pedantic,r.inline=ht.pedantic):this.options.gfm&&(r.block=_t.gfm,this.options.breaks?r.inline=ht.breaks:r.inline=ht.gfm),this.tokenizer.rules=r}static get rules(){return{block:_t,inline:ht}}static lex(t,r){return new Ss(r).lex(t)}static lexInline(t,r){return new Ss(r).inlineTokens(t)}lex(t){t=t.replace(we.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let r=0;r<this.inlineQueue.length;r++){let n=this.inlineQueue[r];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,r=[],n=!1){for(this.options.pedantic&&(t=t.replace(we.tabCharGlobal,"    ").replace(we.spaceLine,""));t;){let i;if(this.options.extensions?.block?.some(o=>(i=o.call({lexer:this},t,r))?(t=t.substring(i.raw.length),r.push(i),!0):!1))continue;if(i=this.tokenizer.space(t)){t=t.substring(i.raw.length);let o=r.at(-1);i.raw.length===1&&o!==void 0?o.raw+=`
`:r.push(i);continue}if(i=this.tokenizer.code(t)){t=t.substring(i.raw.length);let o=r.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=`
`+i.raw,o.text+=`
`+i.text,this.inlineQueue.at(-1).src=o.text):r.push(i);continue}if(i=this.tokenizer.fences(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.heading(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.hr(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.blockquote(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.list(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.html(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.def(t)){t=t.substring(i.raw.length);let o=r.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=`
`+i.raw,o.text+=`
`+i.raw,this.inlineQueue.at(-1).src=o.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title});continue}if(i=this.tokenizer.table(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.lheading(t)){t=t.substring(i.raw.length),r.push(i);continue}let l=t;if(this.options.extensions?.startBlock){let o=1/0,a=t.slice(1),c;this.options.extensions.startBlock.forEach(d=>{c=d.call({lexer:this},a),typeof c=="number"&&c>=0&&(o=Math.min(o,c))}),o<1/0&&o>=0&&(l=t.substring(0,o+1))}if(this.state.top&&(i=this.tokenizer.paragraph(l))){let o=r.at(-1);n&&o?.type==="paragraph"?(o.raw+=`
`+i.raw,o.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):r.push(i),n=l.length!==t.length,t=t.substring(i.raw.length);continue}if(i=this.tokenizer.text(t)){t=t.substring(i.raw.length);let o=r.at(-1);o?.type==="text"?(o.raw+=`
`+i.raw,o.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):r.push(i);continue}if(t){let o="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(o);break}else throw new Error(o)}}return this.state.top=!0,r}inline(t,r=[]){return this.inlineQueue.push({src:t,tokens:r}),r}inlineTokens(t,r=[]){let n=t,i=null;if(this.tokens.links){let a=Object.keys(this.tokens.links);if(a.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)a.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,i.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(i=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)n=n.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let l=!1,o="";for(;t;){l||(o=""),l=!1;let a;if(this.options.extensions?.inline?.some(d=>(a=d.call({lexer:this},t,r))?(t=t.substring(a.raw.length),r.push(a),!0):!1))continue;if(a=this.tokenizer.escape(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.tag(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.link(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(a.raw.length);let d=r.at(-1);a.type==="text"&&d?.type==="text"?(d.raw+=a.raw,d.text+=a.text):r.push(a);continue}if(a=this.tokenizer.emStrong(t,n,o)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.codespan(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.br(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.del(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.autolink(t)){t=t.substring(a.raw.length),r.push(a);continue}if(!this.state.inLink&&(a=this.tokenizer.url(t))){t=t.substring(a.raw.length),r.push(a);continue}let c=t;if(this.options.extensions?.startInline){let d=1/0,x=t.slice(1),f;this.options.extensions.startInline.forEach(w=>{f=w.call({lexer:this},x),typeof f=="number"&&f>=0&&(d=Math.min(d,f))}),d<1/0&&d>=0&&(c=t.substring(0,d+1))}if(a=this.tokenizer.inlineText(c)){t=t.substring(a.raw.length),a.raw.slice(-1)!=="_"&&(o=a.raw.slice(-1)),l=!0;let d=r.at(-1);d?.type==="text"?(d.raw+=a.raw,d.text+=a.text):r.push(a);continue}if(t){let d="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(d);break}else throw new Error(d)}}return r}},Vt=class{options;parser;constructor(s){this.options=s||st}space(s){return""}code({text:s,lang:t,escaped:r}){let n=(t||"").match(we.notSpaceStart)?.[0],i=s.replace(we.endingNewline,"")+`
`;return n?'<pre><code class="language-'+ze(n)+'">'+(r?i:ze(i,!0))+`</code></pre>
`:"<pre><code>"+(r?i:ze(i,!0))+`</code></pre>
`}blockquote({tokens:s}){return`<blockquote>
${this.parser.parse(s)}</blockquote>
`}html({text:s}){return s}heading({tokens:s,depth:t}){return`<h${t}>${this.parser.parseInline(s)}</h${t}>
`}hr(s){return`<hr>
`}list(s){let t=s.ordered,r=s.start,n="";for(let o=0;o<s.items.length;o++){let a=s.items[o];n+=this.listitem(a)}let i=t?"ol":"ul",l=t&&r!==1?' start="'+r+'"':"";return"<"+i+l+`>
`+n+"</"+i+`>
`}listitem(s){let t="";if(s.task){let r=this.checkbox({checked:!!s.checked});s.loose?s.tokens[0]?.type==="paragraph"?(s.tokens[0].text=r+" "+s.tokens[0].text,s.tokens[0].tokens&&s.tokens[0].tokens.length>0&&s.tokens[0].tokens[0].type==="text"&&(s.tokens[0].tokens[0].text=r+" "+ze(s.tokens[0].tokens[0].text),s.tokens[0].tokens[0].escaped=!0)):s.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):t+=r+" "}return t+=this.parser.parse(s.tokens,!!s.loose),`<li>${t}</li>
`}checkbox({checked:s}){return"<input "+(s?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:s}){return`<p>${this.parser.parseInline(s)}</p>
`}table(s){let t="",r="";for(let i=0;i<s.header.length;i++)r+=this.tablecell(s.header[i]);t+=this.tablerow({text:r});let n="";for(let i=0;i<s.rows.length;i++){let l=s.rows[i];r="";for(let o=0;o<l.length;o++)r+=this.tablecell(l[o]);n+=this.tablerow({text:r})}return n&&(n=`<tbody>${n}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+n+`</table>
`}tablerow({text:s}){return`<tr>
${s}</tr>
`}tablecell(s){let t=this.parser.parseInline(s.tokens),r=s.header?"th":"td";return(s.align?`<${r} align="${s.align}">`:`<${r}>`)+t+`</${r}>
`}strong({tokens:s}){return`<strong>${this.parser.parseInline(s)}</strong>`}em({tokens:s}){return`<em>${this.parser.parseInline(s)}</em>`}codespan({text:s}){return`<code>${ze(s,!0)}</code>`}br(s){return"<br>"}del({tokens:s}){return`<del>${this.parser.parseInline(s)}</del>`}link({href:s,title:t,tokens:r}){let n=this.parser.parseInline(r),i=Rr(s);if(i===null)return n;s=i;let l='<a href="'+s+'"';return t&&(l+=' title="'+ze(t)+'"'),l+=">"+n+"</a>",l}image({href:s,title:t,text:r,tokens:n}){n&&(r=this.parser.parseInline(n,this.parser.textRenderer));let i=Rr(s);if(i===null)return ze(r);s=i;let l=`<img src="${s}" alt="${r}"`;return t&&(l+=` title="${ze(t)}"`),l+=">",l}text(s){return"tokens"in s&&s.tokens?this.parser.parseInline(s.tokens):"escaped"in s&&s.escaped?s.text:ze(s.text)}},Vs=class{strong({text:s}){return s}em({text:s}){return s}codespan({text:s}){return s}del({text:s}){return s}html({text:s}){return s}text({text:s}){return s}link({text:s}){return""+s}image({text:s}){return""+s}br(){return""}},qe=class vs{options;renderer;textRenderer;constructor(t){this.options=t||st,this.options.renderer=this.options.renderer||new Vt,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Vs}static parse(t,r){return new vs(r).parse(t)}static parseInline(t,r){return new vs(r).parseInline(t)}parse(t,r=!0){let n="";for(let i=0;i<t.length;i++){let l=t[i];if(this.options.extensions?.renderers?.[l.type]){let a=l,c=this.options.extensions.renderers[a.type].call({parser:this},a);if(c!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(a.type)){n+=c||"";continue}}let o=l;switch(o.type){case"space":{n+=this.renderer.space(o);continue}case"hr":{n+=this.renderer.hr(o);continue}case"heading":{n+=this.renderer.heading(o);continue}case"code":{n+=this.renderer.code(o);continue}case"table":{n+=this.renderer.table(o);continue}case"blockquote":{n+=this.renderer.blockquote(o);continue}case"list":{n+=this.renderer.list(o);continue}case"html":{n+=this.renderer.html(o);continue}case"paragraph":{n+=this.renderer.paragraph(o);continue}case"text":{let a=o,c=this.renderer.text(a);for(;i+1<t.length&&t[i+1].type==="text";)a=t[++i],c+=`
`+this.renderer.text(a);r?n+=this.renderer.paragraph({type:"paragraph",raw:c,text:c,tokens:[{type:"text",raw:c,text:c,escaped:!0}]}):n+=c;continue}default:{let a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return n}parseInline(t,r=this.renderer){let n="";for(let i=0;i<t.length;i++){let l=t[i];if(this.options.extensions?.renderers?.[l.type]){let a=this.options.extensions.renderers[l.type].call({parser:this},l);if(a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(l.type)){n+=a||"";continue}}let o=l;switch(o.type){case"escape":{n+=r.text(o);break}case"html":{n+=r.html(o);break}case"link":{n+=r.link(o);break}case"image":{n+=r.image(o);break}case"strong":{n+=r.strong(o);break}case"em":{n+=r.em(o);break}case"codespan":{n+=r.codespan(o);break}case"br":{n+=r.br(o);break}case"del":{n+=r.del(o);break}case"text":{n+=r.text(o);break}default:{let a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return n}},Tt=class{options;block;constructor(s){this.options=s||st}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(s){return s}postprocess(s){return s}processAllTokens(s){return s}provideLexer(){return this.block?Fe.lex:Fe.lexInline}provideParser(){return this.block?qe.parse:qe.parseInline}},oa=class{defaults=Ms();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=qe;Renderer=Vt;TextRenderer=Vs;Lexer=Fe;Tokenizer=Ht;Hooks=Tt;constructor(...s){this.use(...s)}walkTokens(s,t){let r=[];for(let n of s)switch(r=r.concat(t.call(this,n)),n.type){case"table":{let i=n;for(let l of i.header)r=r.concat(this.walkTokens(l.tokens,t));for(let l of i.rows)for(let o of l)r=r.concat(this.walkTokens(o.tokens,t));break}case"list":{let i=n;r=r.concat(this.walkTokens(i.items,t));break}default:{let i=n;this.defaults.extensions?.childTokens?.[i.type]?this.defaults.extensions.childTokens[i.type].forEach(l=>{let o=i[l].flat(1/0);r=r.concat(this.walkTokens(o,t))}):i.tokens&&(r=r.concat(this.walkTokens(i.tokens,t)))}}return r}use(...s){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return s.forEach(r=>{let n={...r};if(n.async=this.defaults.async||n.async||!1,r.extensions&&(r.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){let l=t.renderers[i.name];l?t.renderers[i.name]=function(...o){let a=i.renderer.apply(this,o);return a===!1&&(a=l.apply(this,o)),a}:t.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let l=t[i.level];l?l.unshift(i.tokenizer):t[i.level]=[i.tokenizer],i.start&&(i.level==="block"?t.startBlock?t.startBlock.push(i.start):t.startBlock=[i.start]:i.level==="inline"&&(t.startInline?t.startInline.push(i.start):t.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(t.childTokens[i.name]=i.childTokens)}),n.extensions=t),r.renderer){let i=this.defaults.renderer||new Vt(this.defaults);for(let l in r.renderer){if(!(l in i))throw new Error(`renderer '${l}' does not exist`);if(["options","parser"].includes(l))continue;let o=l,a=r.renderer[o],c=i[o];i[o]=(...d)=>{let x=a.apply(i,d);return x===!1&&(x=c.apply(i,d)),x||""}}n.renderer=i}if(r.tokenizer){let i=this.defaults.tokenizer||new Ht(this.defaults);for(let l in r.tokenizer){if(!(l in i))throw new Error(`tokenizer '${l}' does not exist`);if(["options","rules","lexer"].includes(l))continue;let o=l,a=r.tokenizer[o],c=i[o];i[o]=(...d)=>{let x=a.apply(i,d);return x===!1&&(x=c.apply(i,d)),x}}n.tokenizer=i}if(r.hooks){let i=this.defaults.hooks||new Tt;for(let l in r.hooks){if(!(l in i))throw new Error(`hook '${l}' does not exist`);if(["options","block"].includes(l))continue;let o=l,a=r.hooks[o],c=i[o];Tt.passThroughHooks.has(l)?i[o]=d=>{if(this.defaults.async)return Promise.resolve(a.call(i,d)).then(f=>c.call(i,f));let x=a.call(i,d);return c.call(i,x)}:i[o]=(...d)=>{let x=a.apply(i,d);return x===!1&&(x=c.apply(i,d)),x}}n.hooks=i}if(r.walkTokens){let i=this.defaults.walkTokens,l=r.walkTokens;n.walkTokens=function(o){let a=[];return a.push(l.call(this,o)),i&&(a=a.concat(i.call(this,o))),a}}this.defaults={...this.defaults,...n}}),this}setOptions(s){return this.defaults={...this.defaults,...s},this}lexer(s,t){return Fe.lex(s,t??this.defaults)}parser(s,t){return qe.parse(s,t??this.defaults)}parseMarkdown(s){return(t,r)=>{let n={...r},i={...this.defaults,...n},l=this.onError(!!i.silent,!!i.async);if(this.defaults.async===!0&&n.async===!1)return l(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||t===null)return l(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return l(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));i.hooks&&(i.hooks.options=i,i.hooks.block=s);let o=i.hooks?i.hooks.provideLexer():s?Fe.lex:Fe.lexInline,a=i.hooks?i.hooks.provideParser():s?qe.parse:qe.parseInline;if(i.async)return Promise.resolve(i.hooks?i.hooks.preprocess(t):t).then(c=>o(c,i)).then(c=>i.hooks?i.hooks.processAllTokens(c):c).then(c=>i.walkTokens?Promise.all(this.walkTokens(c,i.walkTokens)).then(()=>c):c).then(c=>a(c,i)).then(c=>i.hooks?i.hooks.postprocess(c):c).catch(l);try{i.hooks&&(t=i.hooks.preprocess(t));let c=o(t,i);i.hooks&&(c=i.hooks.processAllTokens(c)),i.walkTokens&&this.walkTokens(c,i.walkTokens);let d=a(c,i);return i.hooks&&(d=i.hooks.postprocess(d)),d}catch(c){return l(c)}}}onError(s,t){return r=>{if(r.message+=`
Please report this to https://github.com/markedjs/marked.`,s){let n="<p>An error occurred:</p><pre>"+ze(r.message+"",!0)+"</pre>";return t?Promise.resolve(n):n}if(t)return Promise.reject(r);throw r}}},tt=new oa;function J(s,t){return tt.parse(s,t)}J.options=J.setOptions=function(s){return tt.setOptions(s),J.defaults=tt.defaults,jn(J.defaults),J};J.getDefaults=Ms;J.defaults=st;J.use=function(...s){return tt.use(...s),J.defaults=tt.defaults,jn(J.defaults),J};J.walkTokens=function(s,t){return tt.walkTokens(s,t)};J.parseInline=tt.parseInline;J.Parser=qe;J.parser=qe.parse;J.Renderer=Vt;J.TextRenderer=Vs;J.Lexer=Fe;J.lexer=Fe.lex;J.Tokenizer=Ht;J.Hooks=Tt;J.parse=J;J.options;J.setOptions;J.use;J.walkTokens;J.parseInline;qe.parse;Fe.lex;function Er(){const[s,t]=H.useState(""),[r,n]=H.useState(!0),[i,l]=H.useState(!1);return H.useEffect(()=>{fetch("/RELEASE_LOG.md").then(o=>{if(!o.ok)throw new Error("Failed to fetch release log");return o.text()}).then(o=>{t(o),l(!1)}).catch(o=>{console.error("Error fetching release log:",o),l(!0)}).finally(()=>n(!1))},[]),e.jsx(ke,{sx:{height:"100%",minHeight:{xs:200,md:300}},children:e.jsxs(zt,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(ui,{color:"primary"}),e.jsx(g,{level:"h4",children:"Release Log"})]}),e.jsxs(m,{sx:{flex:1,overflow:"auto",bgcolor:"background.level1",borderRadius:"var(--joy-radius-md)",border:"1px solid",borderColor:"divider",p:2},children:[r&&e.jsx(g,{level:"body-sm",color:"neutral",children:"Loading release log..."}),i&&e.jsx(g,{level:"body-sm",color:"danger",children:"Failed to load release log"}),!r&&!i&&e.jsx(m,{sx:{typography:"body-sm"},children:e.jsx("div",{dangerouslySetInnerHTML:{__html:J(s)}})})]})]})})}function Ar(){return Se(),e.jsx(ke,{sx:{height:"100%",minHeight:{xs:120,md:300}},children:e.jsxs(zt,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(ci,{color:"primary"}),e.jsx(g,{level:"h4",children:"Application Info"})]}),e.jsxs(ie,{spacing:1.5,sx:{flex:1},children:[e.jsx(g,{level:"title-md",sx:{fontWeight:"bold"},children:"Smartback Inventory System"}),e.jsxs(ie,{spacing:.5,children:[e.jsxs(g,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Environment:"})," ","production"]}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Version:"})," ","N/A"]}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Build:"})," ","N/A"]}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Date:"})," ",new Date().toLocaleDateString()]})]})]}),e.jsx(F,{component:"a",href:"https://nicklasfangerfisk.github.io/Testflow/",target:"_blank",rel:"noopener noreferrer",startDecorator:e.jsx(di,{}),variant:"outlined",color:"primary",sx:{mt:2,alignSelf:"flex-start"},children:"System Test"})]})})}const aa=()=>{const{isMobile:s}=Se(),t=()=>e.jsx(m,{sx:{width:"100%",minHeight:"100vh"},children:e.jsxs(ge,{padding:"medium",children:[e.jsx(g,{level:"h2",sx:{mb:3,fontSize:G.sizes.xlarge},children:"Settings"}),e.jsxs(ie,{spacing:3,children:[e.jsx(Ar,{}),e.jsx(Er,{})]})]})}),r=()=>e.jsxs(ge,{children:[e.jsx(g,{level:"h2",sx:{mb:3,fontSize:G.sizes.xlarge},children:"Settings"}),e.jsxs(m,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},alignItems:"start"},children:[e.jsx(Ar,{}),e.jsx(Er,{})]})]});return e.jsx(Ue,{children:s?e.jsx(t,{}):e.jsx(r,{})})};function ca(){const s=Is(),{isMobile:t}=Se(),r=Os(),[n,i]=u.useState("dashboard"),l=[{label:"Dashboard",icon:e.jsx(Rs,{}),value:"dashboard"},{label:"Orders",icon:e.jsx(_s,{}),value:"orders"},{label:"Users",icon:e.jsx(Ps,{}),value:"users"},{label:"Settings",icon:e.jsx(Nt,{}),value:"settings"}];return u.useEffect(()=>{i({"/":"dashboard","/dashboard":"dashboard","/orders":"orders","/products":"dashboard","/users":"users","/suppliers":"dashboard","/purchase-orders":"dashboard","/tickets":"dashboard","/sms-campaigns":"dashboard","/movements":"dashboard","/settings":"settings"}[s.pathname]||"dashboard")},[s.pathname]),console.log("isMobile:",t),e.jsxs(m,{sx:{display:"flex",height:"100vh",overflow:"hidden"},children:[s.pathname!=="/login"&&!t&&e.jsx(Si,{setView:o=>console.log(o),view:"home"}),e.jsxs(m,{component:"main",sx:{flexGrow:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0,overflowY:"auto",bgcolor:"background.default",p:s.pathname!=="/dashboard"&&s.pathname!=="/login"&&s.pathname!=="/tickets"&&s.pathname!=="/movements"?3:0,width:t?"100%":"calc(100% - var(--Sidebar-width, 240px))",marginBottom:t?"56px":0},children:[t&&s.pathname!=="/login"&&e.jsx(fo,{items:l,value:n,onChange:o=>{i(o),r(`/${o}`)},toggleSidebar:()=>console.log("Sidebar toggled")}),e.jsxs(Ds,{children:[e.jsx(be,{path:"/",element:e.jsx(qt,{to:"/dashboard",replace:!0})}),e.jsx(be,{path:"/orders",element:e.jsx(Te,{children:e.jsx(Ci,{})})}),e.jsx(be,{path:"/products",element:e.jsx(Te,{children:e.jsx(_i,{})})}),e.jsx(be,{path:"/users",element:e.jsx(Te,{children:e.jsx(Ei,{})})}),e.jsx(be,{path:"/suppliers",element:e.jsx(Te,{children:e.jsx(Oi,{})})}),e.jsx(be,{path:"/purchase-orders",element:e.jsx(Te,{children:e.jsx(po,{})})}),e.jsx(be,{path:"/tickets",element:e.jsx(Te,{children:e.jsx(jo,{})})}),e.jsx(be,{path:"/sms-campaigns",element:e.jsx(Te,{children:e.jsx(yo,{})})}),e.jsx(be,{path:"/dashboard",element:e.jsx(Te,{children:e.jsx(So,{})})}),e.jsx(be,{path:"/movements",element:e.jsx(Te,{children:e.jsx(Co,{})})}),e.jsx(be,{path:"/settings",element:e.jsx(Te,{children:e.jsx(aa,{})})}),e.jsx(be,{path:"*",element:e.jsx(qt,{to:"/",replace:!0})})]})]})]})}function da(){return e.jsx(Bn,{children:e.jsx(xi,{children:e.jsxs(Ds,{children:[e.jsx(be,{path:"/login/*",element:e.jsx(ko,{})}),e.jsx(be,{path:"/*",element:e.jsx(ca,{})})]})})})}console.log("Mounting React app...");const Or=document.getElementById("root");Or?(fi.createRoot(Or).render(e.jsx(da,{})),console.log("React app rendered!")):console.error("No #root element found in index.html!");

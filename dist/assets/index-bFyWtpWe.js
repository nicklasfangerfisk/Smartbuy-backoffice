import{b as $n,u as qr,r as h,j as e,I as ne,R as K,d as Un,e as It,B as u,G as $r,T as g,f as B,L as ps,h as fs,i as ms,k as jt,l as Ys,m as Bn,D as yt,A as de,M as Ee,n as Ae,o as Ge,p as Rs,q as Es,s as As,F as re,t as ee,S as ie,v as z,w as U,x as Ds,y as We,z as Y,C as Gt,E as Kt,H as te,J as De,K as ke,N as Ur,O as Br,P as Wr,Q as ot,U as lt,V as Ye,W as Wn,X as Hn,Y as Vn,Z as Jn,_ as Gn,$ as er,a0 as Kn,a1 as Zn,a2 as Qn,a3 as tr,a4 as gs,a5 as Xn,a6 as Hr,a7 as Yn,a8 as eo,a9 as to,aa as sr,ab as rr,ac as nr,ad as or}from"./mui-core-BVMuDfY9.js";import{D as Vr,L as so,H as ro,a as Os,S as Is,b as Jr,G as Ts,c as Gr,A as Kr,Q as Zr,d as Ft,P as vt,e as no,K as oo,f as wt,g as ue,h as ge,F as zs,i as qt,j as ir,I as lr,E as at,k as io,l as Qr,m as Xr,n as lo,C as ao,M as co,o as uo,p as ho,q as Ls,r as Yr,s as ar,t as xo,u as po,B as fo,v as mo,w as go,x as jo,y as bo,z as yo,J as wo,N as cr,O as So,U as en,R as vo,T as ko,V as Co,W as _o,X as Po}from"./mui-icons-B0DlgBzH.js";import{c as Ro}from"./supabase-CQnIwFJt.js";import{N as $t,u as Ns,a as Ms,R as Fs,b as Se,B as Eo}from"./router-D89MQL-m.js";import{f as os}from"./utils-CSQe5d3I.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=r(o);fetch(o.href,l)}})();var Rt={},dr;function Ao(){if(dr)return Rt;dr=1;var s=$n();return Rt.createRoot=s.createRoot,Rt.hydrateRoot=s.hydrateRoot,Rt}var Do=Ao();function Oo(s){const{onClick:t,sx:r,...n}=s,{mode:o,setMode:l}=qr(),[i,a]=h.useState(!1);return h.useEffect(()=>{a(!0)},[]),i?e.jsxs(ne,{"data-screenshot":"toggle-mode",size:"sm",variant:"outlined",color:"neutral",...n,onClick:c=>{l(o==="light"?"dark":"light"),t?.(c)},sx:[o==="dark"?{"& > *:first-of-type":{display:"none"}}:{"& > *:first-of-type":{display:"initial"}},o==="light"?{"& > *:last-of-type":{display:"none"}}:{"& > *:last-of-type":{display:"initial"}},...Array.isArray(r)?r:[r]],children:[e.jsx(Vr,{}),e.jsx(so,{})]}):e.jsx(ne,{size:"sm",variant:"outlined",color:"neutral",...n,sx:r,disabled:!0})}const tn="https://tfzvtzqybgbzxcxozdes.supabase.co",js="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRmenZ0enF5YmdienhjeG96ZGVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NTc2MDIsImV4cCI6MjA2MzQzMzYwMn0.hD2WdkvI8LY9N0IHP7HDQliyicQA0c-mspKjCJf0_Fc";console.log("[Supabase] URL:",tn);console.log("[Supabase] Anon Key:",js.slice(0,6)+"..."+js.slice(-6));const N=Ro(tn,js);N.auth.onAuthStateChange((s,t)=>{console.log("[Auth State Change]",s,t),s==="SIGNED_IN"?console.log("User signed in:",t?.user):s==="SIGNED_OUT"&&console.log("User signed out")});let is=!1;N.auth.onAuthStateChange((s,t)=>{is||(is=!0,console.log("[Auth State Change]",s,t),s==="SIGNED_IN"?console.log("User signed in:",t?.user):s==="SIGNED_OUT"&&(console.log("User signed out"),window.location.pathname!=="/login"&&(window.location.href="/login")),is=!1)});const qs=s=>t=>{const[r,n]=K.useState(null),[o,l]=K.useState(!0);return K.useEffect(()=>{async function i(){const{data:a}=await N.auth.getSession();n(a?.session||null),l(!1)}i()},[]),o?e.jsx("div",{children:"Loading..."}):r?e.jsx(s,{...t}):e.jsx($t,{to:"/login",replace:!0})},Io=[{label:"Home",icon:K.createElement(ro),value:"home",route:"/",showInMobile:!0},{label:"Dashboard",icon:K.createElement(Os),value:"dashboard",route:"/dashboard",showInMobile:!0},{label:"Orders",icon:K.createElement(Is),value:"orders",route:"/orders",showInMobile:!0},{label:"Products",icon:K.createElement(Jr),value:"products",route:"/products",showInMobile:!0},{label:"Users",icon:K.createElement(Ts),value:"users",route:"/users",showInMobile:!0},{label:"Suppliers",icon:K.createElement(Gr),value:"suppliers",route:"/suppliers",showInMobile:!0},{label:"Purchase Orders",icon:K.createElement(Kr),value:"purchaseorders",route:"/purchase-orders",showInMobile:!0},{label:"Tickets",icon:K.createElement(Zr),value:"tickets",route:"/tickets",showInMobile:!0},{label:"SMS Campaigns",icon:K.createElement(Ft),value:"smscampaigns",route:"/sms-campaigns",showInMobile:!0},{label:"Movements",icon:K.createElement(Ft),value:"movements",route:"/movements",showInMobile:!0},{label:"My Profile",icon:K.createElement(vt),value:"profile",route:"/settings",showInMobile:!0}],Tt={Sales:[{label:"Dashboard",icon:K.createElement(Os),value:"dashboard",route:"/dashboard",showInMobile:!0},{label:"Orders",icon:K.createElement(Is),value:"orders",route:"/orders",showInMobile:!0},{label:"Products",icon:K.createElement(Jr),value:"products",route:"/products",showInMobile:!0}],Support:[{label:"Tickets",icon:K.createElement(Zr),value:"tickets",route:"/tickets",showInMobile:!0},{label:"Users",icon:K.createElement(Ts),value:"users",route:"/users",showInMobile:!0},{label:"My Profile",icon:K.createElement(vt),value:"profile",route:"/settings",showInMobile:!0}],Marketing:[{label:"SMS Campaigns",icon:K.createElement(Ft),value:"smscampaigns",route:"/sms-campaigns",showInMobile:!0}],Operations:[{label:"Suppliers",icon:K.createElement(Gr),value:"suppliers",route:"/suppliers",showInMobile:!0},{label:"Purchase Orders",icon:K.createElement(Kr),value:"purchaseorders",route:"/purchase-orders",showInMobile:!0},{label:"Movements",icon:K.createElement(Ft),value:"movements",route:"/movements",showInMobile:!0}]};function Ce(){const s=Un(),t=It("(max-width:600px)"),r=It("(min-width:601px) and (max-width:1024px)"),n=It("(min-width:1025px)");return{isMobile:t,isTablet:r,isDesktop:n,isSmallScreen:t,isMediumScreen:r,isLargeScreen:n,breakpoints:{mobile:"600px",tablet:"1024px",desktop:"1025px"},theme:s}}function sn(){const{isMobile:s,isTablet:t}=Ce();return{containerPadding:s?1:t?2:3,sectionPadding:s?2:t?3:4,itemPadding:s?1:2,smallGap:s?1:2,mediumGap:s?2:3,largeGap:s?3:4,sectionMargin:s?2:3,itemMargin:s?1:2}}function To(){const{isMobile:s}=Ce();return{getModalSize:(r="medium")=>s?{width:"95vw",height:r==="fullscreen"?"95vh":"auto",maxHeight:"90vh",margin:1}:{small:{width:400,maxWidth:"90vw"},medium:{width:600,maxWidth:"90vw"},large:{width:800,maxWidth:"90vw"},fullscreen:{width:"90vw",height:"90vh"}}[r]}}function zo({setView:s,view:t}){const r=Ns(),n=Ms(),{isMobile:o,isTablet:l,isDesktop:i}=Ce(),[a,c]=h.useState(!1),[d,f]=h.useState([]),[p,w]=h.useState(null),[v,x]=h.useState(null);h.useEffect(()=>{async function m(){const{data:M,error:_}=await N.from("users").select("*");!_&&M&&f(M)}m();async function C(M){if(w(M),M){let{data:_}=await N.from("users").select("*").eq("id",M.id).single();_||(await N.from("users").upsert({id:M.id,email:M.email,name:M.user_metadata?.full_name||null,avatar_url:M.user_metadata?.avatar_url||null,role:"employee"}),_={...M,role:"employee"}),x(_)}else x(null)}N.auth.getUser().then(({data:M})=>C(M.user));const{data:T}=N.auth.onAuthStateChange((M,_)=>{C(_?.user??null)});return()=>{T?.subscription.unsubscribe()}},[]),h.useEffect(()=>{l&&c(!0)},[l,i]);const j=m=>{r(m.route),s(m.value),l&&c(!0)},y=()=>{c(!a)},D=(m,C)=>{j({value:C,route:m})},k=m=>n.pathname===m;return e.jsxs(u,{className:"Sidebar",sx:{display:o?"none":"flex",position:{xs:"fixed",md:"sticky"},transform:{xs:"translateX(calc(100% * (var(--SideNavigation-slideIn, 0) - 1)))",md:"none"},transition:"transform 0.4s, width 0.4s",zIndex:1e4,height:"100vh",maxHeight:"100vh",width:"var(--Sidebar-width)",top:0,p:2,flexShrink:0,flexDirection:"column",gap:2,borderRight:"1px solid",borderColor:"divider",background:"var(--joy-palette-background-surface, #fff)",overflow:"hidden"},children:[e.jsx($r,{styles:m=>({":root":{"--Sidebar-width":a?"60px":"220px",[m.breakpoints.up("lg")]:{"--Sidebar-width":a?"60px":"240px"}}})}),e.jsx(u,{className:"Sidebar-overlay",sx:{position:"fixed",zIndex:9998,top:0,left:0,width:"100vw",height:"100vh",opacity:"var(--SideNavigation-slideIn)",backgroundColor:"var(--joy-palette-background-backdrop)",transition:"opacity 0.4s",transform:{xs:"translateX(calc(100% * (var(--SideNavigation-slideIn, 0) - 1) + var(--SideNavigation-slideIn, 0) * var(--Sidebar-width, 0px)))",lg:"translateX(-100%)"}}}),e.jsxs(u,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(ne,{size:"sm",variant:"plain",onClick:y,sx:{p:.5,borderRadius:1,"&:hover":{bgcolor:"neutral.100"}},children:e.jsx("img",{src:"/favicon.svg",alt:"Logo",style:{width:28,height:28,borderRadius:6}})}),!a&&e.jsxs(e.Fragment,{children:[e.jsx(g,{level:"title-lg",children:"Smartbuy"}),e.jsx(Oo,{sx:{ml:"auto"}})]})]}),!a&&e.jsx(B,{size:"sm",startDecorator:e.jsx(no,{}),placeholder:"Search"}),e.jsx(u,{sx:{minHeight:0,overflowY:"auto",overflowX:"hidden",flex:1,display:"flex",flexDirection:"column",[`& .${Bn.root}`]:{gap:1.5}},children:e.jsx(ps,{size:"sm",sx:{gap:1,"--List-nestedInsetStart":"30px","--ListItem-radius":m=>m.vars.radius.sm},children:["Sales","Support","Operations","Marketing"].map(m=>e.jsx(fs,{nested:!0,children:e.jsx(Lo,{defaultExpanded:!a,renderToggle:({open:C,setOpen:T})=>a?e.jsx(ms,{title:m,placement:"right",arrow:!0,children:e.jsx(jt,{onClick:()=>T(!C),children:Tt[m][0]?.icon})}):e.jsxs(jt,{onClick:()=>T(!C),children:[Tt[m][0]?.icon,e.jsx(Ys,{children:e.jsx(g,{level:"title-sm",children:m})}),e.jsx(oo,{sx:[C?{transform:"rotate(180deg)"}:{transform:"none"}]})]}),children:e.jsx(ps,{sx:{gap:.5},children:Tt[m].map(C=>e.jsx(fs,{children:a?e.jsx(ms,{title:C.label,placement:"right",arrow:!0,children:e.jsx(jt,{selected:k(C.route),onClick:()=>D(C.route,C.value),sx:{justifyContent:"center",px:1,width:"100%"},children:C.icon})}):e.jsxs(jt,{selected:k(C.route),onClick:()=>D(C.route,C.value),sx:{justifyContent:"flex-start",px:2,width:"100%"},children:[C.icon,e.jsx(Ys,{children:e.jsx(g,{level:"body-sm",children:C.label})})]})},C.value))})})},m))})}),e.jsx(u,{sx:{flexShrink:0}}),e.jsx(yt,{}),e.jsxs(u,{sx:{display:"flex",gap:1,alignItems:"center",minHeight:48,cursor:"pointer",borderRadius:"sm","&:hover":{bgcolor:"neutral.50"}},onClick:()=>D("/settings","settings"),children:[e.jsx(de,{variant:"outlined",size:"sm",src:v?.avatar_url||p?.user_metadata?.avatar_url||void 0}),!a&&e.jsxs(u,{sx:{minWidth:0,flex:1},children:[e.jsx(g,{level:"title-sm",children:v?.name||p?.user_metadata?.full_name||p?.email||"Not signed in"}),e.jsx(g,{level:"body-xs",children:v?.email||p?.email||""})]})]})]})}function Lo({defaultExpanded:s=!1,renderToggle:t,children:r}){const[n,o]=h.useState(s);return e.jsxs(h.Fragment,{children:[t({open:n,setOpen:o}),e.jsx(u,{sx:{display:"grid",transition:"0.2s ease","& > *":{overflow:"hidden"},gridTemplateRows:n?"1fr":"0fr"},children:r})]})}const No=qs(zo);function je({children:s,variant:t="page",padding:r="medium",fullHeight:n=!1,className:o}){const{isMobile:l}=Ce(),i=sn(),a=()=>r==="none"?0:{small:i.itemPadding,medium:i.containerPadding,large:i.sectionPadding}[r]||i.containerPadding,c=()=>{const d={p:a(),boxSizing:"border-box"};switch(t){case"page":return{...d,height:n?"100%":"auto",overflow:"auto",width:"100%"};case"dialog":return{...d,height:"auto",overflow:"visible"};case"form":return{...d,display:"flex",flexDirection:"column",gap:i.mediumGap};case"card":return{...d,borderRadius:1,bgcolor:"background.surface"};case"table-page":return{width:"100%",overflow:"visible",pt:l?1:2,pl:l?1:2,pr:l?1:2,pb:l?1:2,boxSizing:"border-box"};default:return d}};return e.jsx(u,{sx:c(),className:o,children:s})}function Ut({open:s,onClose:t,children:r,title:n,size:o="medium",showCloseButton:l=!0,actions:i}){const{getModalSize:a}=To();return e.jsx(Ee,{open:s,onClose:t,children:e.jsxs(Ae,{sx:a(o),children:[l&&e.jsx(Ge,{}),n&&e.jsx(Rs,{children:n}),e.jsx(Es,{children:r}),i&&e.jsx(As,{children:i})]})})}const qe=({children:s})=>e.jsx(u,{sx:{display:"flex",flexDirection:"column",width:"100%",flex:1,bgcolor:"background.body"},children:s}),Mo=({open:s,creating:t,newOrder:r,setNewOrder:n,onClose:o,onCreate:l})=>{const[i,a]=h.useState([]),[c,d]=h.useState([{id:crypto.randomUUID(),product:null,quantity:1,unitprice:0,discount:0}]),[f,p]=h.useState(!1),[w,v]=h.useState(null),[x,j]=h.useState(null),[y,D]=h.useState(0),[k,m]=h.useState(!1),[C,T]=h.useState(null),[M,_]=h.useState(!1);h.useEffect(()=>{s&&(d([{id:crypto.randomUUID(),product:null,quantity:1,unitprice:0,discount:0}]),v(null),n($=>({...$,date:$.date||new Date().toISOString().slice(0,10)})))},[s]),h.useEffect(()=>{s&&(p(!0),j(null),N.from("Products").select("*").then(({data:$,error:S})=>{!S&&$?($.length===0&&j("No products available. Please add products first."),a($.map(R=>({id:R.uuid||R.id,ProductName:R.ProductName,SalesPrice:R.SalesPrice??0})))):j("Failed to load products. Please try again later."),p(!1)}))},[s]);const W=()=>{d($=>[...$,{id:crypto.randomUUID(),product:null,quantity:1,unitprice:0,discount:y}])},O=$=>{d(S=>S.filter((R,A)=>A!==$))},L=($,S,R)=>{d(A=>A.map((q,se)=>{if(se!==$)return q;if(S==="product"&&R){const he=i.find(ce=>ce.id===R.id);return{...q,product:R,unitprice:he?.SalesPrice??0}}return S==="product"&&!R?{...q,product:null,unitprice:0}:{...q,[S]:R}}))},F=$=>{$.preventDefault();const S=c.filter(R=>R.product&&R.product.id&&R.quantity>0).map(R=>({product_uuid:R.product.id,quantity:R.quantity,unitprice:R.unitprice,discount:R.discount}));if(S.length===0){v("Please add at least one valid order item.");return}v(null),l(S,y)};return e.jsx(Ee,{open:s,onClose:o,"aria-labelledby":"create-order-modal",children:e.jsxs(Ae,{"aria-labelledby":"create-order-modal",sx:{maxWidth:600,width:"100%",minWidth:{xs:300,sm:400}},children:[e.jsx(Ge,{}),e.jsx(g,{id:"create-order-modal",level:"h4",sx:{mb:2},children:"Create Order"}),e.jsxs("form",{onSubmit:F,children:[e.jsxs(re,{sx:{mb:2},required:!0,children:[e.jsx(ee,{children:"Date"}),e.jsx(B,{type:"date",value:r.date,onChange:$=>n(S=>({...S,date:$.target.value})),required:!0})]}),e.jsxs(re,{sx:{mb:2},required:!0,children:[e.jsx(ee,{children:"Status"}),e.jsxs(ie,{value:r.status,onChange:($,S)=>n(R=>({...R,status:S||"Paid"})),children:[e.jsx(z,{value:"Paid",children:"Paid"}),e.jsx(z,{value:"Refunded",children:"Refunded"}),e.jsx(z,{value:"Cancelled",children:"Cancelled"})]})]}),e.jsxs(re,{sx:{mb:2},required:!0,children:[e.jsx(ee,{children:"Customer Name"}),e.jsx(B,{value:r.customer_name,onChange:$=>n(S=>({...S,customer_name:$.target.value})),required:!0})]}),e.jsxs(re,{sx:{mb:2},required:!0,children:[e.jsx(ee,{children:"Customer Email"}),e.jsx(B,{type:"email",value:r.customer_email,onChange:$=>n(S=>({...S,customer_email:$.target.value})),required:!0})]}),e.jsxs(re,{sx:{mb:2},required:!0,children:[e.jsx(ee,{children:"Order Discount (%)"}),e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(B,{type:"number",value:y,disabled:c.length>0&&!(c.length===1&&!c[0].product),onChange:$=>{const S=Math.max(0,Math.min(100,Math.floor(Number($.target.value))));D(S),d(R=>R.map(A=>({...A,discount:S})))},slotProps:{input:{min:0,max:100,step:1}},required:!0,placeholder:"Order Discount %",sx:{flex:1}}),(c.length>1||c.length===1&&c[0].product)&&e.jsx(U,{size:"sm",variant:"outlined",onClick:()=>m(!0),children:"Edit"})]})]}),w&&e.jsx(g,{color:"danger",sx:{mb:1},children:w}),e.jsx(yt,{sx:{my:2}}),e.jsx(u,{sx:{mb:1,fontWeight:"lg",fontSize:"lg"},children:"Order Items"}),x&&e.jsx(g,{color:"danger",sx:{mb:1},children:x}),c.map(($,S)=>e.jsxs(u,{sx:{display:"flex",gap:1,alignItems:"center",mb:1},children:[e.jsx(Ds,{options:i,getOptionLabel:R=>R.ProductName,isOptionEqualToValue:(R,A)=>R.id===A.id,value:$.product,onChange:(R,A)=>L(S,"product",A),loading:f,placeholder:f?"Loading...":"Search product",sx:{minWidth:220},disabled:i.length===0,required:!0,renderOption:(R,A)=>e.jsx("li",{...R,children:A.ProductName})}),e.jsx(B,{type:"number",value:$.quantity,onChange:R=>L(S,"quantity",Math.max(1,Number(R.target.value))),sx:{width:80},required:!0,slotProps:{input:{min:1}}}),e.jsx(B,{type:"number",value:$.unitprice,onChange:R=>L(S,"unitprice",Math.max(0,Number(R.target.value))),sx:{width:100},required:!0,slotProps:{input:{min:0,step:.01}},placeholder:"Unit Price"}),e.jsx(B,{type:"number",value:$.discount,onChange:R=>L(S,"discount",Math.max(0,Math.min(100,Math.floor(Number(R.target.value))))),sx:{width:80},required:!0,slotProps:{input:{min:0,max:100,step:1}},placeholder:"Discount %"}),e.jsx(ne,{size:"sm",color:"danger",onClick:()=>O(S),disabled:c.length===1,children:e.jsx(wt,{})})]},$.id)),e.jsx(U,{startDecorator:e.jsx(ue,{}),variant:"soft",size:"sm",onClick:W,sx:{mb:2},disabled:!!x,children:"Add Item"}),e.jsx(Ee,{open:k,onClose:()=>m(!1),children:e.jsxs(Ae,{sx:{minWidth:350},children:[e.jsx(g,{level:"title-md",sx:{mb:1},children:"Change Order Discount"}),e.jsxs(re,{sx:{mb:2},required:!0,children:[e.jsx(ee,{children:"Change discount to (%)"}),e.jsx(B,{type:"number",value:C??y,onChange:$=>T(Math.max(0,Math.min(100,Math.floor(Number($.target.value))))),slotProps:{input:{min:0,max:100,step:1}},required:!0,autoFocus:!0})]}),e.jsx(g,{sx:{mb:2},children:"How do you want to apply the new order discount?"}),e.jsxs(u,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[e.jsx(U,{onClick:()=>{D(C),d($=>$.map(S=>({...S,discount:C}))),m(!1),T(null)},children:"Overwrite all"}),e.jsx(U,{onClick:()=>{D(C),d($=>$.map(S=>S.discount<C?{...S,discount:C}:S)),m(!1),T(null)},children:"Set discount on lower"}),e.jsx(U,{variant:"plain",onClick:()=>{m(!1),T(null)},children:"Cancel"})]})]})}),e.jsxs(u,{sx:{display:"flex",gap:2,mt:2},children:[e.jsx(U,{type:"submit",loading:t,color:"primary",disabled:!!x,children:"Create"}),e.jsx(U,{variant:"plain",onClick:o,disabled:t,children:"Cancel"})]})]})]})})},Re={currency:"DKK",locale:"da-DK",symbol:"kr"};function it(s){return s==null||isNaN(s)?"0,00 kr":new Intl.NumberFormat(Re.locale,{style:"currency",currency:Re.currency,minimumFractionDigits:2,maximumFractionDigits:2}).format(s)}function ct(s,t=!0){if(s==null||isNaN(s))return t?"0,00 kr":"kr 0,00";const r=new Intl.NumberFormat(Re.locale,{minimumFractionDigits:2,maximumFractionDigits:2}).format(s);return t?`${r} kr`:`kr ${r}`}function ur(s){return{...s,salesprice_currency:Re.currency,salesprice_exchrate:1,costprice_currency:Re.currency,costprice_exchrate:1}}function Fo(s){return{...s,order_total_currency:Re.currency,order_total_exchrate:1}}function qo(s){return{...s,unitprice_currency:Re.currency,unitprice_exchrate:1,price_currency:Re.currency,price_exchrate:1}}function $o(s){return{...s,unit_price_currency:Re.currency,unit_price_exchrate:1}}function Uo({open:s,onClose:t,selectedOrder:r,fetchOrderItems:n}){const[o,l]=h.useState([]),[i,a]=h.useState(!1);return h.useEffect(()=>{async function c(){if(r){a(!0);const d=await n(r.uuid);l(d),a(!1)}else l([])}s&&r?c():l([])},[s,r,n]),e.jsx(Ee,{open:s,onClose:t,"aria-labelledby":"order-details-modal",children:e.jsxs(Ae,{"aria-labelledby":"order-details-modal",sx:{maxWidth:600,width:"100%"},children:[e.jsx(Ge,{}),e.jsx(g,{id:"order-details-modal",level:"title-md",fontWeight:"lg",sx:{mb:2},children:"Order Details"}),r&&e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(g,{level:"body-sm",sx:{color:"text.secondary"},children:["Order ID: ",r.uuid]}),e.jsxs(g,{level:"body-sm",sx:{color:"text.secondary"},children:["Date: ",new Date(r.date).toLocaleString()]}),e.jsxs(g,{level:"body-sm",sx:{color:"text.secondary"},children:["Status: ",r.status]})]}),e.jsx(yt,{}),e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(g,{level:"body-sm",fontWeight:"md",children:"Customer Information"}),e.jsxs(g,{level:"body-sm",sx:{color:"text.secondary"},children:["Name: ",r.customer.name]}),e.jsxs(g,{level:"body-sm",sx:{color:"text.secondary"},children:["Email: ",r.customer.email]})]}),e.jsx(yt,{}),e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(g,{level:"body-sm",fontWeight:"md",children:"Ordered Items"}),i?e.jsx(g,{level:"body-sm",sx:{color:"text.secondary"},children:"Loading items..."}):e.jsxs(We,{size:"sm",sx:{minWidth:500},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{style:{textAlign:"right"},children:"Quantity"}),e.jsx("th",{style:{textAlign:"right"},children:"Unit Price"}),e.jsx("th",{style:{textAlign:"right"},children:"Discount (%)"}),e.jsx("th",{style:{textAlign:"right"},children:"Total Price"})]})}),e.jsx("tbody",{children:o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{textAlign:"center",padding:"16px"},children:e.jsx(g,{level:"body-sm",sx:{color:"text.secondary"},children:"No items found for this order."})})}):o.map(function(c){return e.jsxs("tr",{children:[e.jsx("td",{children:c.name||c.product_uuid}),e.jsx("td",{style:{textAlign:"right"},children:c.quantity??"-"}),e.jsx("td",{style:{textAlign:"right"},children:c.unitprice!=null?ct(c.unitprice):"-"}),e.jsx("td",{style:{textAlign:"right"},children:c.discount!=null?`${Number(c.discount).toFixed(2)}%`:"-"}),e.jsx("td",{style:{textAlign:"right"},children:c.price!=null?ct(c.price):"-"})]},c.uuid)})})]})]})]})]})})}const X={sizes:{small:"0.875rem",xlarge:"1.5rem"}},we={fontSize:X.sizes.small},Bo=()=>{const{isMobile:s}=Ce(),[t,r]=h.useState([]),[n,o]=h.useState(!1),[l,i]=h.useState(""),[a,c]=h.useState(""),[d,f]=h.useState(""),[p,w]=h.useState(""),[v,x]=h.useState(!1),[j,y]=h.useState(!1),[D,k]=h.useState(!1),[m,C]=h.useState(null),[T,M]=h.useState(!1),[_,W]=h.useState({date:new Date().toISOString().split("T")[0],status:"Paid",customer_name:"",customer_email:""}),[O,L]=h.useState(!1),[F,$]=h.useState(""),[S,R]=h.useState("success"),A=(E,P="success")=>{$(E),R(P),L(!0)},q=E=>{switch(E){case"Paid":return"success";case"Refunded":return"warning";case"Cancelled":return"danger";default:return"neutral"}},se=E=>{switch(E){case"Paid":return e.jsx(ir,{});case"Refunded":return e.jsx(ir,{});case"Cancelled":return e.jsx(qt,{});default:return e.jsx(qt,{})}},he=async()=>{o(!0);try{const{data:E,error:P}=await N.from("Orders").select("*");if(P){console.error("Error fetching orders:",P),A("Failed to fetch orders","danger");return}if(E){const H=E.map(J=>({uuid:J.uuid,date:J.date||J.created_at||J["Created at"]||"",status:J.status||"Paid",customer:J.customer||{initial:J.customer_initial||(J.customer_name?J.customer_name[0]:"?"),name:J.customer_name||"Unknown",email:J.customer_email||""},order_number_display:J.order_number_display,order_total:typeof J.order_total=="number"?J.order_total:0,created_by:J.created_by||"",created_by_name:J.created_by_name||"",created_by_email:J.created_by_email||"",category:J.category||"purchase"})).sort((J,be)=>{const ye=new Date(J.date||0);return new Date(be.date||0).getTime()-ye.getTime()});r(H)}}catch(E){console.error("Error fetching orders:",E),A("Failed to fetch orders","danger")}finally{o(!1)}},ce=async E=>{try{const{data:P,error:H}=await N.from("OrderItems").select("*, Products:product_uuid(ProductName)").eq("order_uuid",E);return H?(console.error("Error fetching order items:",H),[]):P?.map(J=>({...J,product_name:J.Products?.ProductName||J.product_uuid}))||[]}catch(P){return console.error("Error fetching order items:",P),[]}};h.useEffect(()=>{he()},[]);const ae=t.filter(E=>{const P=!l||E.order_number_display?.toString().toLowerCase().includes(l.toLowerCase())||E.customer.name.toLowerCase().includes(l.toLowerCase())||E.customer.email.toLowerCase().includes(l.toLowerCase()),H=!a||E.status===a,J=!d||E.category===d,be=!p||E.customer.name===p;return P&&H&&J&&be}),ze=Array.from(new Set(t.map(E=>E.status))),He=Array.from(new Set(t.map(E=>E.category||"purchase"))),ht=Array.from(new Set(t.map(E=>E.customer.name))),Le=E=>{const P=t.find(H=>H.uuid===E||H.order_number_display===E);P&&(C(P),k(!0))},Oe=()=>{y(!0)},xt=async(E,P)=>{M(!0);try{const H=E.reduce((Ie,oe)=>Ie+oe.quantity*oe.unitprice*(1-oe.discount/100),0)-P,J=Fo({date:_.date,status:_.status,customer_name:_.customer_name,customer_email:_.customer_email,order_total:H}),{data:be,error:ye}=await N.from("Orders").insert(J).select().single();if(ye){console.error("Error creating order:",ye),A("Failed to create order","danger");return}if(E.length>0){const Ie=E.map(Pt=>qo({order_uuid:be.uuid,product_uuid:Pt.product_uuid,quantity:Pt.quantity,unitprice:Pt.unitprice,discount_percent:Pt.discount})),{error:oe}=await N.from("OrderItems").insert(Ie);oe&&(console.error("Error creating order items:",oe),A("Order created but failed to add items","warning"))}A("Order created successfully","success"),y(!1),W({date:new Date().toISOString().split("T")[0],status:"Paid",customer_name:"",customer_email:""}),he()}catch(H){console.error("Error creating order:",H),A("Failed to create order","danger")}finally{M(!1)}},Ke=()=>{x(!1)},I=()=>{c(""),f(""),w("")},G=()=>e.jsxs(u,{sx:{pb:2},children:[e.jsxs(je,{variant:"page",padding:"medium",children:[e.jsxs(u,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(B,{placeholder:"Search orders...",value:l,onChange:E=>i(E.target.value),startDecorator:e.jsx(ge,{}),sx:{flex:1,fontSize:"16px"}}),e.jsx(ne,{variant:"soft",onClick:()=>x(!0),sx:{flexShrink:0},children:e.jsx(zs,{})})]}),(a||d||p)&&e.jsxs(u,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:[a&&e.jsxs(te,{size:"sm",variant:"soft",color:"primary",children:["Status: ",a]}),d&&e.jsxs(te,{size:"sm",variant:"soft",color:"primary",children:["Category: ",d]}),p&&e.jsxs(te,{size:"sm",variant:"soft",color:"primary",children:["Customer: ",p]})]}),n&&e.jsx(De,{sx:{mb:2}})]}),e.jsx(u,{children:ae.length===0?e.jsx(u,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:n?"Loading orders...":"No orders found"})}):ae.map(E=>e.jsx(u,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider",cursor:"pointer","&:hover":{bgcolor:"background.level1"}},onClick:()=>Le(E.uuid),children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(u,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${q(E.status)}.100`,color:`${q(E.status)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",flexShrink:0},children:se(E.status)}),e.jsxs(u,{sx:{flex:1,minWidth:0},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsxs(g,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:["Order #",E.order_number_display||E.uuid.substring(0,8)]}),e.jsx(te,{size:"sm",color:q(E.status),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content"},children:E.status})]}),e.jsxs(g,{level:"body-xs",color:"neutral",sx:{mb:.5},children:[E.customer.name," • ",new Date(E.date).toLocaleDateString()]}),E.order_total&&e.jsx(g,{level:"body-xs",sx:{fontWeight:"bold",color:"primary.600"},children:it(E.order_total)})]})]})},E.uuid))}),e.jsx(ne,{color:"primary",variant:"soft",size:"sm",sx:{position:"fixed",bottom:80,right:16,zIndex:1e3,borderRadius:"8px",width:40,height:40,boxShadow:"sm",bgcolor:"primary.100","&:hover":{bgcolor:"primary.200",boxShadow:"md"}},onClick:Oe,children:e.jsx(ue,{fontSize:"small"})})]}),xe=()=>e.jsxs(je,{variant:"table-page",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:X.sizes.xlarge},children:"Orders"}),e.jsxs(u,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(B,{placeholder:"Search orders...",sx:{flex:1,fontSize:X.sizes.small},value:l,onChange:E=>i(E.target.value),startDecorator:e.jsx(ge,{})}),e.jsxs(ie,{placeholder:"Filter status",value:a,onChange:(E,P)=>c(P||""),sx:{minWidth:160,fontSize:X.sizes.small},children:[e.jsx(z,{value:"",children:"All Statuses"}),ze.map(E=>e.jsx(z,{value:E,children:E},E))]}),e.jsx(U,{variant:"solid",startDecorator:e.jsx(ue,{}),onClick:Oe,sx:{fontSize:X.sizes.small},children:"Create Order"})]}),e.jsxs(ke,{sx:{overflow:"visible"},children:[n&&e.jsx(De,{}),e.jsxs(We,{"aria-label":"Orders",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:we,children:"Order #"}),e.jsx("th",{style:we,children:"Date"}),e.jsx("th",{style:we,children:"Customer"}),e.jsx("th",{style:we,children:"Status"}),e.jsx("th",{style:we,children:"Total"}),e.jsx("th",{style:we,children:"Actions"})]})}),e.jsxs("tbody",{children:[ae.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{textAlign:"center",color:"#888",...we},children:n?"Loading orders...":"No orders found."})}),ae.map(E=>e.jsxs("tr",{style:{cursor:"pointer"},children:[e.jsx("td",{style:we,children:E.order_number_display||E.uuid.substring(0,8)}),e.jsx("td",{style:we,children:new Date(E.date).toLocaleDateString()}),e.jsx("td",{style:we,children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(u,{sx:{width:24,height:24,borderRadius:"50%",bgcolor:"primary.100",color:"primary.600",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold"},children:E.customer.initial}),e.jsxs(u,{children:[e.jsx(g,{level:"body-sm",sx:{fontWeight:"bold"},children:E.customer.name}),e.jsx(g,{level:"body-xs",color:"neutral",children:E.customer.email})]})]})}),e.jsx("td",{style:we,children:e.jsx(te,{size:"sm",variant:"soft",color:q(E.status),children:E.status})}),e.jsx("td",{style:we,children:e.jsx(g,{level:"body-sm",sx:{fontWeight:"bold"},children:E.order_total?it(E.order_total):"N/A"})}),e.jsx("td",{style:we,children:e.jsx(U,{size:"sm",variant:"soft",onClick:()=>Le(E.uuid),children:"View"})})]},E.uuid))]})]})]})]});return e.jsxs(qe,{children:[s?e.jsx(G,{}):e.jsx(xe,{}),e.jsx(Mo,{open:j,creating:T,newOrder:_,setNewOrder:W,onClose:()=>y(!1),onCreate:xt}),e.jsx(Uo,{open:D,onClose:()=>k(!1),selectedOrder:m,fetchOrderItems:ce}),s&&e.jsx(Ut,{open:v,onClose:Ke,title:"Filter Orders",size:"medium",actions:e.jsxs(u,{sx:{display:"flex",gap:2},children:[e.jsx(U,{variant:"plain",onClick:I,sx:we,children:"Clear All"}),e.jsx(U,{variant:"solid",onClick:Ke,sx:we,children:"Apply"})]}),children:e.jsxs(Y,{spacing:2,children:[e.jsxs(re,{children:[e.jsx(ee,{children:"Status"}),e.jsxs(ie,{placeholder:"All statuses",value:a,onChange:(E,P)=>c(P||""),children:[e.jsx(z,{value:"",children:"All Statuses"}),ze.map(E=>e.jsx(z,{value:E,children:E},E))]})]}),e.jsxs(re,{children:[e.jsx(ee,{children:"Category"}),e.jsxs(ie,{placeholder:"All categories",value:d,onChange:(E,P)=>f(P||""),children:[e.jsx(z,{value:"",children:"All Categories"}),He.map(E=>e.jsx(z,{value:E,children:E},E))]})]}),e.jsxs(re,{children:[e.jsx(ee,{children:"Customer"}),e.jsxs(ie,{placeholder:"All customers",value:p,onChange:(E,P)=>w(P||""),children:[e.jsx(z,{value:"",children:"All Customers"}),ht.map(E=>e.jsx(z,{value:E,children:E},E))]})]})]})}),e.jsx(Gt,{open:O,onClose:()=>L(!1),autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{top:16,zIndex:2e3},children:e.jsx(Kt,{color:S,variant:"solid",sx:{width:"100%"},children:F})})]})};function Wo({open:s,onClose:t,product:r,onSave:n}){const[o,l]=h.useState({ProductName:r?.ProductName||"",SalesPrice:r?.SalesPrice?.toString()||"",CostPrice:r?.CostPrice?.toString()||""}),[i,a]=h.useState(!1);h.useEffect(()=>{l({ProductName:r?.ProductName||"",SalesPrice:r?.SalesPrice?.toString()||"",CostPrice:r?.CostPrice?.toString()||""})},[r]);const c=async()=>{a(!0),await n(o),a(!1)};return e.jsx(Ee,{open:s,onClose:t,"aria-labelledby":"product-table-form-title",children:e.jsxs(Ae,{children:[e.jsx(Rs,{id:"product-table-form-title",children:r?"Edit Product":"Add Product"}),e.jsxs(Es,{children:[e.jsx(B,{name:"ProductName",value:o.ProductName,onChange:d=>l({...o,ProductName:d.target.value}),placeholder:"Product Name",sx:{mb:2}}),e.jsx(B,{name:"SalesPrice",value:o.SalesPrice,onChange:d=>l({...o,SalesPrice:d.target.value}),placeholder:"Sales Price",type:"number",sx:{mb:2}}),e.jsx(B,{name:"CostPrice",value:o.CostPrice,onChange:d=>l({...o,CostPrice:d.target.value}),placeholder:"Cost Price",type:"number"})]}),e.jsxs(As,{children:[e.jsx(U,{onClick:t,variant:"plain",disabled:i,children:"Cancel"}),e.jsx(U,{onClick:c,variant:"solid",loading:i,disabled:i,children:"Save"})]})]})})}const hr=qs(Wo),pe={fontSize:X.sizes.small},Ho=()=>{const{isMobile:s}=Ce(),[t,r]=h.useState([]),[n,o]=h.useState({}),[l,i]=h.useState(!1),[a,c]=h.useState(!1),[d,f]=h.useState(!1),[p,w]=h.useState(""),[v,x]=h.useState(""),[j,y]=h.useState(!1),[D,k]=h.useState(!1),[m,C]=h.useState(!1),[T,M]=h.useState(null),[_,W]=h.useState(!1),[O,L]=h.useState(""),[F,$]=h.useState("success"),S=(I,G="success")=>{L(I),$(G),W(!0)},R=I=>I<=0?{status:"Out of Stock",color:"danger"}:I<=10?{status:"Low Stock",color:"warning"}:{status:"In Stock",color:"success"},A=I=>{const G=R(I);return e.jsx(u,{sx:{width:20,height:20,borderRadius:"50%",bgcolor:`${G.color}.100`,color:`${G.color}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold"},children:e.jsx(io,{sx:{fontSize:"12px"}})})},q=async()=>{i(!0);try{const{data:I,error:G}=await N.from("Products").select("*").order("CreatedAt",{ascending:!1});if(G){console.error("Error fetching products:",G),S("Failed to fetch products","danger");return}I&&(r(I),await se(I))}catch(I){console.error("Error fetching products:",I),S("Failed to fetch products","danger")}finally{i(!1)}},se=async I=>{c(!0);try{const{data:G,error:xe}=await N.from("stock_movements").select("product_id, movement_type, quantity");if(xe){console.error("Error fetching stock data:",xe);return}if(G){const E={};I.forEach(P=>{const J=G.filter(be=>be.product_id===P.uuid).reduce((be,ye)=>{switch(ye.movement_type){case"incoming":case"adjustment":return be+(ye.quantity||0);case"outgoing":return be-(ye.quantity||0);default:return be}},0);E[P.uuid]=J}),o(E)}}catch(G){console.error("Error fetching stock levels:",G)}finally{c(!1)}};h.useEffect(()=>{q()},[]);const he=t.filter(I=>{const G=!p||I.ProductName.toLowerCase().includes(p.toLowerCase())||I.ProductID?.toLowerCase().includes(p.toLowerCase()),xe=n[I.uuid]||0,E=!v||v==="in-stock"&&xe>10||v==="low-stock"&&xe>0&&xe<=10||v==="out-of-stock"&&xe<=0;return G&&E}),ce=()=>{k(!0)},ae=I=>{M(I),C(!0)},ze=async I=>{if(confirm("Are you sure you want to delete this product?")){f(!0);try{const{error:G}=await N.from("Products").delete().eq("uuid",I);if(G){console.error("Error deleting product:",G),S("Failed to delete product","danger");return}r(t.filter(xe=>xe.uuid!==I)),S("Product deleted successfully","success")}catch(G){console.error("Error deleting product:",G),S("Failed to delete product","danger")}finally{f(!1)}}},He=async I=>{f(!0);try{const G=ur({ProductName:I.ProductName,SalesPrice:parseFloat(I.SalesPrice),CostPrice:parseFloat(I.CostPrice),CreatedAt:new Date().toISOString()}),{data:xe,error:E}=await N.from("Products").insert([G]).select().single();if(E){console.error("Error adding product:",E),S("Failed to add product","danger");return}S("Product added successfully","success"),k(!1),q()}catch(G){console.error("Error adding product:",G),S("Failed to add product","danger")}finally{f(!1)}},ht=async I=>{if(T){f(!0);try{const G=ur({ProductName:I.ProductName,SalesPrice:parseFloat(I.SalesPrice),CostPrice:parseFloat(I.CostPrice)}),{error:xe}=await N.from("Products").update(G).eq("uuid",T.uuid);if(xe){console.error("Error updating product:",xe),S("Failed to update product","danger");return}S("Product updated successfully","success"),C(!1),M(null),q()}catch(G){console.error("Error updating product:",G),S("Failed to update product","danger")}finally{f(!1)}}},Le=()=>{y(!1)},Oe=()=>{x("")},xt=()=>e.jsxs(u,{sx:{pb:2},children:[e.jsxs(je,{variant:"page",padding:"medium",children:[e.jsxs(u,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(B,{placeholder:"Search products...",value:p,onChange:I=>w(I.target.value),startDecorator:e.jsx(ge,{}),sx:{flex:1,fontSize:"16px"}}),e.jsx(ne,{variant:"soft",onClick:()=>y(!0),sx:{flexShrink:0},children:e.jsx(zs,{})})]}),v&&e.jsx(u,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:e.jsxs(te,{size:"sm",variant:"soft",color:"primary",children:["Stock: ",v.replace("-"," ")]})}),l&&e.jsx(De,{sx:{mb:2}})]}),e.jsx(u,{children:he.length===0?e.jsx(u,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:l?"Loading products...":"No products found"})}):he.map(I=>e.jsx(u,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(u,{sx:{flexShrink:0},children:I.ImageUrl?e.jsx(de,{src:I.ImageUrl,sx:{width:48,height:48},alt:I.ProductName}):e.jsx(de,{sx:{width:48,height:48,bgcolor:"neutral.100"},children:e.jsx(lr,{})})}),e.jsxs(u,{sx:{flex:1,minWidth:0},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:I.ProductName}),e.jsx(u,{sx:{display:"flex",alignItems:"center",gap:1},children:a?e.jsx(g,{level:"body-xs",color:"neutral",children:"..."}):e.jsxs(e.Fragment,{children:[A(n[I.uuid]||0),e.jsx(te,{size:"sm",color:R(n[I.uuid]||0).color,variant:"soft",sx:{fontSize:"10px",minWidth:"fit-content"},children:n[I.uuid]||0})]})})]}),e.jsxs(g,{level:"body-xs",color:"neutral",sx:{mb:.5},children:["ID: ",I.ProductID||"N/A"," • ",new Date(I.CreatedAt).toLocaleDateString()]}),e.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(u,{children:[e.jsxs(g,{level:"body-xs",sx:{fontWeight:"bold",color:"success.600"},children:["Sale: ",it(I.SalesPrice)]}),e.jsxs(g,{level:"body-xs",color:"neutral",children:["Cost: ",it(I.CostPrice)]})]}),e.jsxs(u,{sx:{display:"flex",gap:.5},children:[e.jsx(ne,{size:"sm",variant:"soft",color:"primary",onClick:()=>ae(I),children:e.jsx(at,{})}),e.jsx(ne,{size:"sm",variant:"soft",color:"danger",onClick:()=>ze(I.uuid),disabled:d,children:e.jsx(wt,{})})]})]})]})]})},I.uuid))}),e.jsx(ne,{color:"primary",variant:"soft",size:"sm",sx:{position:"fixed",bottom:80,right:16,zIndex:1e3,borderRadius:"8px",width:40,height:40,boxShadow:"sm",bgcolor:"primary.100","&:hover":{bgcolor:"primary.200",boxShadow:"md"}},onClick:ce,children:e.jsx(ue,{fontSize:"small"})})]}),Ke=()=>e.jsxs(je,{variant:"table-page",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:X.sizes.xlarge},children:"Products"}),e.jsxs(u,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(B,{placeholder:"Search products...",sx:{flex:1,fontSize:X.sizes.small},value:p,onChange:I=>w(I.target.value),startDecorator:e.jsx(ge,{})}),e.jsxs(ie,{placeholder:"Filter by stock",value:v,onChange:(I,G)=>x(G||""),sx:{minWidth:160,fontSize:X.sizes.small},children:[e.jsx(z,{value:"",children:"All Stock Levels"}),e.jsx(z,{value:"in-stock",children:"In Stock"}),e.jsx(z,{value:"low-stock",children:"Low Stock"}),e.jsx(z,{value:"out-of-stock",children:"Out of Stock"})]}),e.jsx(U,{variant:"solid",startDecorator:e.jsx(ue,{}),onClick:ce,sx:{fontSize:X.sizes.small},children:"Add Product"})]}),e.jsxs(ke,{sx:{overflow:"visible"},children:[l&&e.jsx(De,{}),e.jsxs(We,{"aria-label":"Products",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:pe,children:"Image"}),e.jsx("th",{style:pe,children:"Name"}),e.jsx("th",{style:pe,children:"Stock"}),e.jsx("th",{style:pe,children:"Sales Price"}),e.jsx("th",{style:pe,children:"Cost Price"}),e.jsx("th",{style:pe,children:"Created"}),e.jsx("th",{style:pe,children:"Actions"})]})}),e.jsxs("tbody",{children:[he.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...pe},children:l?"Loading products...":"No products found."})}),he.map(I=>e.jsxs("tr",{children:[e.jsx("td",{style:pe,children:I.ImageUrl?e.jsx(de,{src:I.ImageUrl,sx:{width:32,height:32},alt:I.ProductName}):e.jsx(de,{sx:{width:32,height:32,bgcolor:"neutral.100"},children:e.jsx(lr,{sx:{fontSize:"16px"}})})}),e.jsx("td",{style:pe,children:e.jsxs(u,{children:[e.jsx(g,{level:"body-sm",sx:{fontWeight:"bold"},children:I.ProductName}),e.jsxs(g,{level:"body-xs",color:"neutral",children:["ID: ",I.ProductID||"N/A"]})]})}),e.jsx("td",{style:pe,children:a?e.jsx(g,{level:"body-sm",sx:{color:"neutral.500"},children:"Loading..."}):e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(te,{size:"sm",variant:"soft",color:R(n[I.uuid]||0).color,children:R(n[I.uuid]||0).status}),e.jsx(ms,{title:`Current stock level: ${n[I.uuid]||0} units`,arrow:!0,children:e.jsx(g,{level:"body-sm",sx:{fontWeight:"bold",color:R(n[I.uuid]||0).color==="danger"?"danger.500":R(n[I.uuid]||0).color==="warning"?"warning.600":"success.600"},children:n[I.uuid]||0})}),e.jsx(u,{sx:{width:40,height:4,bgcolor:"neutral.200",borderRadius:2,overflow:"hidden"},children:e.jsx(u,{sx:{width:`${Math.min(100,Math.max(0,(n[I.uuid]||0)/50*100))}%`,height:"100%",bgcolor:R(n[I.uuid]||0).color==="danger"?"danger.400":R(n[I.uuid]||0).color==="warning"?"warning.400":"success.400",borderRadius:2}})})]})}),e.jsx("td",{style:pe,children:e.jsx(g,{level:"body-sm",sx:{fontWeight:"bold",color:"success.600"},children:it(I.SalesPrice)})}),e.jsx("td",{style:pe,children:e.jsx(g,{level:"body-sm",color:"neutral",children:it(I.CostPrice)})}),e.jsx("td",{style:pe,children:new Date(I.CreatedAt).toLocaleDateString()}),e.jsx("td",{style:pe,children:e.jsxs(u,{sx:{display:"flex",gap:.5},children:[e.jsx(ne,{size:"sm",variant:"soft",color:"primary",onClick:()=>ae(I),children:e.jsx(at,{})}),e.jsx(ne,{size:"sm",variant:"soft",color:"danger",onClick:()=>ze(I.uuid),disabled:d,children:e.jsx(wt,{})})]})})]},I.uuid))]})]})]})]});return e.jsxs(qe,{children:[s?e.jsx(xt,{}):e.jsx(Ke,{}),e.jsx(hr,{open:D,onClose:()=>k(!1),product:null,onSave:He}),e.jsx(hr,{open:m,onClose:()=>{C(!1),M(null)},product:T,onSave:ht}),s&&e.jsx(Ut,{open:j,onClose:Le,title:"Filter Products",size:"medium",actions:e.jsxs(u,{sx:{display:"flex",gap:2},children:[e.jsx(U,{variant:"plain",onClick:Oe,sx:pe,children:"Clear All"}),e.jsx(U,{variant:"solid",onClick:Le,sx:pe,children:"Apply"})]}),children:e.jsx(Y,{spacing:2,children:e.jsxs(re,{children:[e.jsx(ee,{children:"Stock Level"}),e.jsxs(ie,{placeholder:"All stock levels",value:v,onChange:(I,G)=>x(G||""),children:[e.jsx(z,{value:"",children:"All Stock Levels"}),e.jsx(z,{value:"in-stock",children:"In Stock"}),e.jsx(z,{value:"low-stock",children:"Low Stock"}),e.jsx(z,{value:"out-of-stock",children:"Out of Stock"})]})]})})}),e.jsx(Gt,{open:_,onClose:()=>W(!1),autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{top:16,zIndex:2e3},children:e.jsx(Kt,{color:F,variant:"solid",sx:{width:"100%"},children:O})})]})},Ve={fontSize:X.sizes.small},Ze={...Ve,fontWeight:600,borderBottom:"1.5px solid #e0e0e0",background:"inherit"},xr=s=>{switch(s?.toLowerCase()){case"admin":return"danger";case"manager":return"warning";case"user":return"primary";case"staff":return"success";default:return"neutral"}},pr=(s,t)=>{const r=s||t;let n=0;for(let l=0;l<r.length;l++)n=r.charCodeAt(l)+((n<<5)-n);const o=["primary","success","warning","danger","neutral"];return o[Math.abs(n)%o.length]},fr=(s,t)=>{if(s){const r=s.split(" ");return r.length>=2?(r[0][0]+r[1][0]).toUpperCase():s.substring(0,2).toUpperCase()}return t.substring(0,2).toUpperCase()};function Vo(){return e.jsxs(Ur,{children:[e.jsx(Br,{slots:{root:ne},slotProps:{root:{variant:"plain",color:"neutral",size:"sm"}},children:e.jsx(co,{})}),e.jsxs(Wr,{size:"sm",sx:{minWidth:140},children:[e.jsx(ot,{children:"Edit"}),e.jsx(ot,{children:"Reset Password"}),e.jsx(ot,{children:"Disable"}),e.jsx(ot,{color:"danger",children:"Delete"})]})]})}const Jo=()=>{const{isMobile:s}=Ce(),[t,r]=h.useState([]),[n,o]=h.useState(!1),[l,i]=h.useState(null),[a,c]=h.useState(""),[d,f]=h.useState("all"),[p,w]=h.useState(!1),v=async()=>{o(!0),i(null);try{const{data:m,error:C}=await N.from("users").select("*");if(C)throw C;if(m){const T=m.map(M=>({id:M.id,name:M.name||null,email:M.email,role:M.role||null,created_at:M.created_at||null,last_login:M.last_login||null,phone:M.phone||null}));r(T)}}catch(m){console.error("Error fetching users:",m),i(m.message||"Failed to fetch users")}finally{o(!1)}},x=Array.from(new Set(t.map(m=>m.role).filter(Boolean))),y=[...t.filter(m=>{const C=m.name?.toLowerCase().includes(a.toLowerCase())||m.email.toLowerCase().includes(a.toLowerCase()),T=d==="all"||m.role===d;return C&&T})].sort((m,C)=>{const T=m.name||m.email,M=C.name||C.email;return T.localeCompare(M)});h.useEffect(()=>{v()},[]);const D=()=>e.jsxs(u,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(je,{padding:"medium",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:X.sizes.xlarge},children:"Users"}),e.jsxs(u,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(B,{placeholder:"Search users...",value:a,onChange:m=>c(m.target.value),startDecorator:e.jsx(ge,{}),sx:{flex:1}}),e.jsxs(ie,{placeholder:"Role",value:d,onChange:(m,C)=>f(C??"all"),sx:{minWidth:120},children:[e.jsx(z,{value:"all",children:"All"}),x.map(m=>e.jsx(z,{value:m,children:m},m))]})]}),e.jsx(U,{variant:"solid",startDecorator:e.jsx(ue,{}),onClick:()=>w(!0),sx:{width:"100%",mb:2},children:"Create User"})]}),n&&e.jsx(De,{}),l&&e.jsx(u,{sx:{p:2},children:e.jsxs(g,{color:"danger",children:["Error: ",l]})}),e.jsx(u,{children:y.length===0?e.jsx(u,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:"No users found"})}):y.map(m=>e.jsx(u,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(de,{size:"md",color:pr(m.name,m.email),sx:{flexShrink:0},children:fr(m.name,m.email)}),e.jsxs(u,{sx:{flex:1,minWidth:0},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:m.name||"Unnamed User"}),m.role&&e.jsx(te,{size:"sm",color:xr(m.role),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content",textTransform:"capitalize"},children:m.role})]}),e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(Qr,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsx(g,{level:"body-xs",color:"neutral",children:m.email})]}),e.jsxs(u,{sx:{display:"flex",gap:2,mb:.5},children:[m.phone&&e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Xr,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsx(g,{level:"body-xs",color:"neutral",children:m.phone})]}),m.last_login&&e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(lo,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsx(g,{level:"body-xs",color:"neutral",children:new Date(m.last_login).toLocaleDateString()})]})]}),m.created_at&&e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(ao,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsxs(g,{level:"body-xs",color:"neutral",children:["Joined ",new Date(m.created_at).toLocaleDateString()]})]})]})]})},m.id))})]}),k=()=>e.jsxs(je,{variant:"table-page",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:X.sizes.xlarge},children:"Users"}),e.jsxs(u,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(B,{placeholder:"Search users...",sx:{flex:1},value:a,onChange:m=>c(m.target.value),startDecorator:e.jsx(ge,{})}),e.jsxs(ie,{placeholder:"Filter role",value:d,onChange:(m,C)=>f(C??"all"),sx:{minWidth:160},children:[e.jsx(z,{value:"all",children:"All Roles"}),x.map(m=>e.jsx(z,{value:m,children:m},m))]}),e.jsx(U,{onClick:()=>w(!0),variant:"solid",startDecorator:e.jsx(ue,{}),children:"Create User"})]}),e.jsxs(ke,{sx:{overflow:"visible"},children:[n&&e.jsx(De,{}),l&&e.jsxs(g,{color:"danger",children:["Error: ",l]}),e.jsxs(We,{"aria-label":"Users",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:Ze,children:"Name"}),e.jsx("th",{style:Ze,children:"Email"}),e.jsx("th",{style:Ze,children:"Role"}),e.jsx("th",{style:Ze,children:"Created At"}),e.jsx("th",{style:Ze,children:"Last Login"}),e.jsx("th",{style:Ze,children:"Phone"}),e.jsx("th",{style:{width:120,...Ze},children:"Actions"})]})}),e.jsxs("tbody",{children:[y.length===0&&!n&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...Ve},children:"No users found."})}),y.map(m=>e.jsxs("tr",{style:{cursor:"pointer",height:48},children:[e.jsx("td",{style:Ve,children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(de,{size:"sm",color:pr(m.name,m.email),children:fr(m.name,m.email)}),e.jsx(g,{level:"body-sm",fontWeight:"md",children:m.name||"Unnamed User"})]})}),e.jsx("td",{style:Ve,children:m.email}),e.jsx("td",{style:Ve,children:m.role?e.jsx(te,{size:"sm",color:xr(m.role),variant:"soft",sx:{textTransform:"capitalize"},children:m.role}):"-"}),e.jsx("td",{style:Ve,children:m.created_at?new Date(m.created_at).toLocaleDateString():"-"}),e.jsx("td",{style:Ve,children:m.last_login?new Date(m.last_login).toLocaleDateString():"-"}),e.jsx("td",{style:Ve,children:m.phone||"-"}),e.jsx("td",{children:e.jsx(Vo,{})})]},m.id))]})]})]})]});return e.jsxs(qe,{children:[s?e.jsx(D,{}):e.jsx(k,{}),e.jsx(Ee,{open:p,onClose:()=>w(!1),"aria-labelledby":"create-user-modal",children:e.jsxs(Ae,{"aria-labelledby":"create-user-modal",sx:{maxWidth:600,width:"100%"},children:[e.jsx(Ge,{}),e.jsx(g,{id:"create-user-modal",level:"title-md",fontWeight:"lg",sx:{mb:2},children:"Create User"}),e.jsx(g,{level:"body-sm",sx:{mb:2},children:"User creation functionality will be implemented here."}),e.jsx(U,{onClick:()=>w(!1),variant:"outlined",children:"Close"})]})})]})};function rn({open:s,onClose:t,onSaved:r,mode:n="add",supplier:o}){const[l,i]=h.useState(o?.name||""),[a,c]=h.useState(o?.contact_name||""),[d,f]=h.useState(o?.email||""),[p,w]=h.useState(o?.phone||""),[v,x]=h.useState(o?.address||""),[j,y]=h.useState(!1),[D,k]=h.useState(null);h.useEffect(()=>{s&&n==="edit"&&o?(i(o.name||""),c(o.contact_name||""),f(o.email||""),w(o.phone||""),x(o.address||"")):s&&n==="add"&&(i(""),c(""),f(""),w(""),x(""))},[s,n,o]);const m=async()=>{y(!0),k(null);const C={name:l,contact_name:a,email:d,phone:p,address:v};let T;if(n==="add"){T=await N.from("Suppliers").insert([C]).select(),y(!1),T.error?k(T.error.message):r(T.data?.[0]?.id);return}else T=await N.from("Suppliers").update(C).eq("id",o?.id);y(!1),T.error?k(T.error.message):r()};return e.jsx(Ee,{open:s,onClose:t,children:e.jsxs(Ae,{sx:{minWidth:400},children:[e.jsx(Ge,{}),e.jsxs(g,{level:"title-md",sx:{mb:2},children:[n==="edit"?"Edit":"Add"," Supplier"]}),e.jsxs("form",{onSubmit:C=>{C.preventDefault(),C.stopPropagation(),m()},children:[e.jsx(B,{placeholder:"Name",value:l,onChange:C=>i(C.target.value),sx:{mb:2},required:!0}),e.jsx(B,{placeholder:"Contact Name",value:a,onChange:C=>c(C.target.value),sx:{mb:2}}),e.jsx(B,{placeholder:"Email",value:d,onChange:C=>f(C.target.value),sx:{mb:2},type:"email",required:!0}),e.jsx(B,{placeholder:"Phone",value:p,onChange:C=>w(C.target.value),sx:{mb:2},type:"tel"}),e.jsx(B,{placeholder:"Address",value:v,onChange:C=>x(C.target.value),sx:{mb:2}}),D&&e.jsx(g,{color:"danger",sx:{mb:1},children:D}),e.jsx(U,{type:"submit",loading:j,disabled:j,variant:"solid",children:"Save"})]})]})})}const mr=s=>{let t=0;for(let n=0;n<s.length;n++)t=s.charCodeAt(n)+((t<<5)-t);const r=["primary","success","warning","danger","neutral"];return r[Math.abs(t)%r.length]},gr=s=>{const t=s.split(" ");return t.length>=2?(t[0][0]+t[1][0]).toUpperCase():s.substring(0,2).toUpperCase()};function Go({supplier:s,onEdit:t,onDelete:r}){return e.jsxs(Ur,{children:[e.jsx(Br,{slots:{root:ne},slotProps:{root:{variant:"plain",color:"neutral",size:"sm"}},children:e.jsx(ho,{})}),e.jsxs(Wr,{size:"sm",sx:{minWidth:120},children:[e.jsxs(ot,{onClick:()=>t(s),children:[e.jsx(at,{sx:{mr:1},fontSize:"small"}),"Edit"]}),e.jsxs(ot,{color:"danger",onClick:()=>r(s.id),children:[e.jsx(wt,{sx:{mr:1},fontSize:"small"}),"Delete"]})]})]})}const Ko=()=>{const{isMobile:s}=Ce(),[t,r]=h.useState([]),[n,o]=h.useState(!1),[l,i]=h.useState(null),[a,c]=h.useState(""),[d,f]=h.useState(!1),[p,w]=h.useState(null),[v,x]=h.useState("view"),j=async()=>{o(!0),i(null);try{const{data:_,error:W}=await N.from("Suppliers").select("*");if(W)throw W;_&&r(_)}catch(_){console.error("Error fetching suppliers:",_),i(_.message||"Failed to fetch suppliers")}finally{o(!1)}},y=_=>{w(_),x("edit"),f(!0)},D=async _=>{if(confirm("Are you sure you want to delete this supplier?"))try{const{error:W}=await N.from("Suppliers").delete().eq("id",_);if(W)throw W;await j()}catch(W){console.error("Error deleting supplier:",W),i(W.message||"Failed to delete supplier")}},k=async()=>{f(!1),await j()},C=[...t.filter(_=>_.name?.toLowerCase().includes(a.toLowerCase())||_.contact_name?.toLowerCase().includes(a.toLowerCase())||_.email?.toLowerCase().includes(a.toLowerCase())||_.phone?.toLowerCase().includes(a.toLowerCase())||_.address?.toLowerCase().includes(a.toLowerCase()))].sort((_,W)=>_.name.localeCompare(W.name));h.useEffect(()=>{j()},[]);const T=()=>e.jsxs(u,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(je,{padding:"medium",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:X.sizes.xlarge},children:"Suppliers"}),e.jsx(u,{sx:{display:"flex",gap:1,mb:2},children:e.jsx(B,{placeholder:"Search suppliers...",value:a,onChange:_=>c(_.target.value),startDecorator:e.jsx(ge,{}),sx:{flex:1}})}),e.jsx(U,{variant:"solid",startDecorator:e.jsx(ue,{}),onClick:()=>{w(null),x("add"),f(!0)},sx:{width:"100%",mb:2},children:"Add Supplier"})]}),n&&e.jsx(De,{}),l&&e.jsx(u,{sx:{p:2},children:e.jsxs(g,{color:"danger",children:["Error: ",l]})}),e.jsx(u,{sx:{px:2},children:C.length===0?e.jsx(u,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:"No suppliers found"})}):C.map(_=>e.jsx(ke,{variant:"outlined",sx:{mb:2,"&:hover":{boxShadow:"sm"}},children:e.jsx(lt,{sx:{p:2},children:e.jsxs(u,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(de,{size:"md",color:mr(_.name),sx:{flexShrink:0},children:_.image_url?e.jsx("img",{src:_.image_url,alt:_.name}):gr(_.name)}),e.jsxs(u,{sx:{flex:1,minWidth:0},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",mb:1},children:[e.jsx(g,{level:"title-md",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"calc(100% - 40px)"},children:_.name}),e.jsx(Go,{supplier:_,onEdit:y,onDelete:D})]}),e.jsxs(Y,{spacing:.5,children:[_.contact_name&&e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(vt,{sx:{fontSize:16,color:"text.tertiary"}}),e.jsx(g,{level:"body-sm",color:"neutral",children:_.contact_name})]}),_.email&&e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Qr,{sx:{fontSize:16,color:"text.tertiary"}}),e.jsx(g,{level:"body-sm",color:"neutral",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:_.email})]}),_.phone&&e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Xr,{sx:{fontSize:16,color:"text.tertiary"}}),e.jsx(g,{level:"body-sm",color:"neutral",children:_.phone})]}),_.address&&e.jsxs(u,{sx:{display:"flex",alignItems:"flex-start",gap:1,mt:.5},children:[e.jsx(uo,{sx:{fontSize:16,color:"text.tertiary",mt:.25}}),e.jsx(g,{level:"body-sm",color:"neutral",sx:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.2},children:_.address})]})]})]})]})})},_.id))})]}),M=()=>e.jsxs(je,{variant:"table-page",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:X.sizes.xlarge},children:"Suppliers"}),e.jsxs(u,{sx:{display:"flex",gap:2,mb:3,alignItems:"center"},children:[e.jsx(B,{placeholder:"Search suppliers...",value:a,onChange:_=>c(_.target.value),startDecorator:e.jsx(ge,{}),sx:{flex:1}}),e.jsx(U,{variant:"solid",startDecorator:e.jsx(ue,{}),onClick:()=>{w(null),x("add"),f(!0)},sx:{minWidth:140},children:"Add Supplier"})]}),n&&e.jsx(De,{sx:{mb:2}}),l&&e.jsxs(g,{color:"danger",sx:{mb:2},children:["Error: ",l]}),e.jsx(Ye,{container:!0,spacing:2,children:C.length===0?e.jsx(Ye,{xs:12,children:e.jsx(u,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:"No suppliers found"})})}):C.map(_=>e.jsx(Ye,{xs:12,md:6,lg:4,children:e.jsx(ke,{variant:"outlined",sx:{height:"100%"},children:e.jsxs(lt,{children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(de,{size:"sm",color:mr(_.name),children:_.image_url?e.jsx("img",{src:_.image_url,alt:_.name}):gr(_.name)}),e.jsx(g,{level:"title-md",fontWeight:"bold",children:_.name})]}),e.jsxs(Y,{spacing:1,children:[e.jsxs(g,{level:"body-sm",children:[e.jsx("strong",{children:"Contact:"})," ",_.contact_name||"N/A"]}),e.jsxs(g,{level:"body-sm",children:[e.jsx("strong",{children:"Email:"})," ",_.email||"N/A"]}),e.jsxs(g,{level:"body-sm",children:[e.jsx("strong",{children:"Phone:"})," ",_.phone||"N/A"]}),e.jsxs(g,{level:"body-sm",children:[e.jsx("strong",{children:"Address:"})," ",_.address||"N/A"]})]}),e.jsxs(u,{sx:{display:"flex",gap:1,mt:2},children:[e.jsx(U,{size:"sm",variant:"outlined",startDecorator:e.jsx(at,{}),onClick:()=>y(_),children:"Edit"}),e.jsx(U,{size:"sm",variant:"outlined",color:"danger",startDecorator:e.jsx(wt,{}),onClick:()=>D(_.id),children:"Delete"})]})]})})},_.id))})]});return e.jsxs(qe,{children:[s?e.jsx(T,{}):e.jsx(M,{}),e.jsx(rn,{open:d,onClose:()=>f(!1),supplier:p,onSaved:k,mode:v==="edit"||v==="add"?v:void 0})]})};function Zo({orderId:s,editable:t,onItemsChange:r,initialItems:n=[]}){const[o,l]=h.useState(n),[i,a]=h.useState([]),[c,d]=h.useState(!1);h.useEffect(()=>{d(!0),N.from("Products").select("uuid, ProductName").then(({data:v,error:x})=>{x?console.error("Failed to fetch products:",x.message):a(v||[]),d(!1)})},[]);const f=(v,x,j)=>{l(y=>{const D=y.map((k,m)=>m===v?{...k,[x]:j}:k);return r&&r(D),D})},p=()=>{l(v=>{const x=[...v,{product_id:null,quantity_ordered:1,unit_price:0}];return r&&r(x),x})},w=v=>{l(x=>{const j=x.filter((y,D)=>D!==v);return r&&r(j),j})};return e.jsxs(u,{sx:{mt:2},children:[e.jsxs(We,{size:"sm",sx:{minWidth:500},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Quantity"}),e.jsx("th",{children:"Unit Price"}),e.jsx("th",{children:"Total"}),t&&e.jsx("th",{})]})}),e.jsx("tbody",{children:o.map((v,x)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(Ds,{options:i,getOptionLabel:j=>j.ProductName,value:i.find(j=>j.uuid===v.product_id)||null,onChange:(j,y)=>f(x,"product_id",y?y.uuid:null),disabled:!t,sx:{minWidth:180},isOptionEqualToValue:(j,y)=>j.uuid===y.uuid,required:!0})}),e.jsx("td",{children:e.jsx(B,{type:"number",value:v.quantity_ordered??1,onChange:j=>f(x,"quantity_ordered",Math.max(1,Number(j.target.value))),disabled:!t,sx:{width:80},required:!0})}),e.jsx("td",{children:e.jsx(B,{type:"number",value:v.unit_price??0,onChange:j=>f(x,"unit_price",Math.max(0,Number(j.target.value))),disabled:!t,sx:{width:100},required:!0})}),e.jsx("td",{children:ct(v.quantity_ordered*v.unit_price)}),t&&e.jsx("td",{children:e.jsx(U,{size:"sm",color:"danger",onClick:()=>w(x),children:"Remove"})})]},x))})]}),t&&e.jsx(U,{size:"sm",variant:"soft",onClick:p,sx:{mt:1},children:"Add Item"})]})}const Et=["Pending","Approved","Received","Cancelled"];function Qo({open:s,onClose:t,onCreated:r,mode:n="add",order:o}){const[l,i]=h.useState(o?.order_number||""),[a,c]=h.useState(o?.order_date||new Date().toISOString().slice(0,10)),[d,f]=h.useState(o?.status||"Pending"),[p,w]=h.useState(o?.total?String(o.total):""),[v,x]=h.useState(o?.notes||""),[j,y]=h.useState(o?.supplier_id||null),[D,k]=h.useState(!1),[m,C]=h.useState(null),[T,M]=h.useState([]),[_,W]=h.useState(""),[O,L]=h.useState(!1),[F,$]=h.useState([{product_id:null,quantity_ordered:1,unit_price:0}]);h.useRef(null),h.useEffect(()=>{s?(console.log("[PurchaseOrderForm] Modal opened"),N.from("Suppliers").select("id, name").then(({data:A})=>{M(A||[])}),n==="edit"&&o?.id?N.from("purchaseorderitems").select("*").eq("purchase_order_id",o.id).then(({data:A})=>{$(A||[])}):n==="add"&&$([{product_id:null,quantity_ordered:1,unit_price:0}])):console.log("[PurchaseOrderForm] Modal closed")},[s,n,o]);const S=async A=>{console.log("[PurchaseOrderForm] handleSupplierAdded called");const{data:q}=await N.from("Suppliers").select("id, name");M(q||[]),A&&(y(String(A)),console.log("[PurchaseOrderForm] New supplier set:",A)),L(!1),console.log("[PurchaseOrderForm] SupplierForm closed")},R=async()=>{console.log("[PurchaseOrderForm] handleSave called"),k(!0),C(null);const A={order_date:a,status:d,notes:v,supplier_id:j};n==="edit"&&(A.order_number=l),A.total=p?parseFloat(p):null;let q,se=o?.id;if(n==="add"?(q=await N.from("PurchaseOrders").insert([A]).select(),!q.error&&q.data&&q.data[0]&&(se=q.data[0].id)):o&&(q=await N.from("PurchaseOrders").update(A).eq("id",o.id)),q&&!q.error&&n==="add"&&se&&F.length>0){const he=F.filter(ae=>ae.product_id).map(ae=>$o({purchase_order_id:se,product_id:ae.product_id,quantity_ordered:ae.quantity_ordered,unit_price:ae.unit_price,notes:ae.notes||null}));if(he.length===0){C("Please select a product for each item before saving."),k(!1);return}const ce=await N.from("purchaseorderitems").insert(he);if(ce.error){C("Failed to save items: "+ce.error.message),k(!1);return}}k(!1),q?.error?(C(q.error.message),console.log("[PurchaseOrderForm] Save error:",q.error.message)):(r(),t(),i(""),c(new Date().toISOString().slice(0,10)),f("Pending"),w(""),x(""),y(null),W(""),console.log("[PurchaseOrderForm] Purchase order saved and modal closed"))};return e.jsx(Ee,{open:s,onClose:t,"aria-labelledby":"purchase-order-form-title",children:e.jsxs(Ae,{sx:{minWidth:400},children:[e.jsx(Ge,{}),e.jsxs(g,{id:"purchase-order-form-title",level:"title-md",sx:{mb:2},children:[n==="edit"?"Edit":"Add"," Purchase Order"]}),e.jsxs("form",{onSubmit:A=>{A.preventDefault(),R()},children:[e.jsx(B,{type:"date",value:a,onChange:A=>c(A.target.value),sx:{mb:2},required:!0}),e.jsx(ie,{value:d,onChange:(A,q)=>f(q??"Pending"),sx:{mb:2,display:"none"},required:!0,children:Et.map(A=>e.jsx(z,{value:A,children:A},A))}),n==="edit"&&e.jsx(u,{sx:{mb:2},children:e.jsx(te,{variant:"soft",color:d==="Approved"?"success":d==="Received"?"primary":d==="Cancelled"?"danger":"neutral",sx:{textTransform:"capitalize",fontWeight:600,fontSize:"md",px:1.5,py:.5},onClick:()=>{const A=Et.indexOf(d);f(Et[(A+1)%Et.length])},children:d})}),e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Ds,{options:T,getOptionLabel:A=>A.name,value:T.find(A=>A.id===j)||null,onChange:(A,q)=>y(q?q.id:null),inputValue:_,onInputChange:(A,q)=>W(q),placeholder:"Select supplier",sx:{flex:1,mb:0},isOptionEqualToValue:(A,q)=>A.id===q.id,required:!0}),e.jsx(ne,{color:"primary",sx:{ml:1},onClick:()=>L(!0),children:e.jsx(ue,{})})]}),e.jsx(rn,{open:O,onClose:()=>L(!1),onSaved:S,mode:"add"}),n==="edit"&&e.jsxs(e.Fragment,{children:[e.jsx(B,{placeholder:"Order Number",value:l,onChange:A=>i(A.target.value),sx:{mb:2}}),e.jsx(B,{placeholder:"Total",value:p,onChange:A=>w(A.target.value),sx:{mb:2},type:"number",readOnly:!0})]}),e.jsx(B,{placeholder:"Notes",value:v,onChange:A=>x(A.target.value),sx:{mb:2}}),e.jsx(Zo,{orderId:o?.id,editable:n==="add",onItemsChange:$,initialItems:F}),e.jsx(u,{sx:{height:16}}),m&&e.jsx(g,{color:"danger",sx:{mb:1},children:m}),e.jsx(U,{type:"submit",loading:D,disabled:D,variant:"solid",children:"Save"})]})]})})}function nn(s,t){return function(){return s.apply(t,arguments)}}const{toString:Xo}=Object.prototype,{getPrototypeOf:$s}=Object,{iterator:Zt,toStringTag:on}=Symbol,Qt=(s=>t=>{const r=Xo.call(t);return s[r]||(s[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),Te=s=>(s=s.toLowerCase(),t=>Qt(t)===s),Xt=s=>t=>typeof t===s,{isArray:dt}=Array,St=Xt("undefined");function Yo(s){return s!==null&&!St(s)&&s.constructor!==null&&!St(s.constructor)&&_e(s.constructor.isBuffer)&&s.constructor.isBuffer(s)}const ln=Te("ArrayBuffer");function ei(s){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(s):t=s&&s.buffer&&ln(s.buffer),t}const ti=Xt("string"),_e=Xt("function"),an=Xt("number"),Yt=s=>s!==null&&typeof s=="object",si=s=>s===!0||s===!1,zt=s=>{if(Qt(s)!=="object")return!1;const t=$s(s);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(on in s)&&!(Zt in s)},ri=Te("Date"),ni=Te("File"),oi=Te("Blob"),ii=Te("FileList"),li=s=>Yt(s)&&_e(s.pipe),ai=s=>{let t;return s&&(typeof FormData=="function"&&s instanceof FormData||_e(s.append)&&((t=Qt(s))==="formdata"||t==="object"&&_e(s.toString)&&s.toString()==="[object FormData]"))},ci=Te("URLSearchParams"),[di,ui,hi,xi]=["ReadableStream","Request","Response","Headers"].map(Te),pi=s=>s.trim?s.trim():s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function kt(s,t,{allOwnKeys:r=!1}={}){if(s===null||typeof s>"u")return;let n,o;if(typeof s!="object"&&(s=[s]),dt(s))for(n=0,o=s.length;n<o;n++)t.call(null,s[n],n,s);else{const l=r?Object.getOwnPropertyNames(s):Object.keys(s),i=l.length;let a;for(n=0;n<i;n++)a=l[n],t.call(null,s[a],a,s)}}function cn(s,t){t=t.toLowerCase();const r=Object.keys(s);let n=r.length,o;for(;n-- >0;)if(o=r[n],t===o.toLowerCase())return o;return null}const et=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,dn=s=>!St(s)&&s!==et;function bs(){const{caseless:s}=dn(this)&&this||{},t={},r=(n,o)=>{const l=s&&cn(t,o)||o;zt(t[l])&&zt(n)?t[l]=bs(t[l],n):zt(n)?t[l]=bs({},n):dt(n)?t[l]=n.slice():t[l]=n};for(let n=0,o=arguments.length;n<o;n++)arguments[n]&&kt(arguments[n],r);return t}const fi=(s,t,r,{allOwnKeys:n}={})=>(kt(t,(o,l)=>{r&&_e(o)?s[l]=nn(o,r):s[l]=o},{allOwnKeys:n}),s),mi=s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),gi=(s,t,r,n)=>{s.prototype=Object.create(t.prototype,n),s.prototype.constructor=s,Object.defineProperty(s,"super",{value:t.prototype}),r&&Object.assign(s.prototype,r)},ji=(s,t,r,n)=>{let o,l,i;const a={};if(t=t||{},s==null)return t;do{for(o=Object.getOwnPropertyNames(s),l=o.length;l-- >0;)i=o[l],(!n||n(i,s,t))&&!a[i]&&(t[i]=s[i],a[i]=!0);s=r!==!1&&$s(s)}while(s&&(!r||r(s,t))&&s!==Object.prototype);return t},bi=(s,t,r)=>{s=String(s),(r===void 0||r>s.length)&&(r=s.length),r-=t.length;const n=s.indexOf(t,r);return n!==-1&&n===r},yi=s=>{if(!s)return null;if(dt(s))return s;let t=s.length;if(!an(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=s[t];return r},wi=(s=>t=>s&&t instanceof s)(typeof Uint8Array<"u"&&$s(Uint8Array)),Si=(s,t)=>{const n=(s&&s[Zt]).call(s);let o;for(;(o=n.next())&&!o.done;){const l=o.value;t.call(s,l[0],l[1])}},vi=(s,t)=>{let r;const n=[];for(;(r=s.exec(t))!==null;)n.push(r);return n},ki=Te("HTMLFormElement"),Ci=s=>s.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,n,o){return n.toUpperCase()+o}),jr=(({hasOwnProperty:s})=>(t,r)=>s.call(t,r))(Object.prototype),_i=Te("RegExp"),un=(s,t)=>{const r=Object.getOwnPropertyDescriptors(s),n={};kt(r,(o,l)=>{let i;(i=t(o,l,s))!==!1&&(n[l]=i||o)}),Object.defineProperties(s,n)},Pi=s=>{un(s,(t,r)=>{if(_e(s)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const n=s[r];if(_e(n)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},Ri=(s,t)=>{const r={},n=o=>{o.forEach(l=>{r[l]=!0})};return dt(s)?n(s):n(String(s).split(t)),r},Ei=()=>{},Ai=(s,t)=>s!=null&&Number.isFinite(s=+s)?s:t;function Di(s){return!!(s&&_e(s.append)&&s[on]==="FormData"&&s[Zt])}const Oi=s=>{const t=new Array(10),r=(n,o)=>{if(Yt(n)){if(t.indexOf(n)>=0)return;if(!("toJSON"in n)){t[o]=n;const l=dt(n)?[]:{};return kt(n,(i,a)=>{const c=r(i,o+1);!St(c)&&(l[a]=c)}),t[o]=void 0,l}}return n};return r(s,0)},Ii=Te("AsyncFunction"),Ti=s=>s&&(Yt(s)||_e(s))&&_e(s.then)&&_e(s.catch),hn=((s,t)=>s?setImmediate:t?((r,n)=>(et.addEventListener("message",({source:o,data:l})=>{o===et&&l===r&&n.length&&n.shift()()},!1),o=>{n.push(o),et.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",_e(et.postMessage)),zi=typeof queueMicrotask<"u"?queueMicrotask.bind(et):typeof process<"u"&&process.nextTick||hn,Li=s=>s!=null&&_e(s[Zt]),b={isArray:dt,isArrayBuffer:ln,isBuffer:Yo,isFormData:ai,isArrayBufferView:ei,isString:ti,isNumber:an,isBoolean:si,isObject:Yt,isPlainObject:zt,isReadableStream:di,isRequest:ui,isResponse:hi,isHeaders:xi,isUndefined:St,isDate:ri,isFile:ni,isBlob:oi,isRegExp:_i,isFunction:_e,isStream:li,isURLSearchParams:ci,isTypedArray:wi,isFileList:ii,forEach:kt,merge:bs,extend:fi,trim:pi,stripBOM:mi,inherits:gi,toFlatObject:ji,kindOf:Qt,kindOfTest:Te,endsWith:bi,toArray:yi,forEachEntry:Si,matchAll:vi,isHTMLForm:ki,hasOwnProperty:jr,hasOwnProp:jr,reduceDescriptors:un,freezeMethods:Pi,toObjectSet:Ri,toCamelCase:Ci,noop:Ei,toFiniteNumber:Ai,findKey:cn,global:et,isContextDefined:dn,isSpecCompliantForm:Di,toJSONObject:Oi,isAsyncFn:Ii,isThenable:Ti,setImmediate:hn,asap:zi,isIterable:Li};function V(s,t,r,n,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=s,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),o&&(this.response=o,this.status=o.status?o.status:null)}b.inherits(V,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:b.toJSONObject(this.config),code:this.code,status:this.status}}});const xn=V.prototype,pn={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(s=>{pn[s]={value:s}});Object.defineProperties(V,pn);Object.defineProperty(xn,"isAxiosError",{value:!0});V.from=(s,t,r,n,o,l)=>{const i=Object.create(xn);return b.toFlatObject(s,i,function(c){return c!==Error.prototype},a=>a!=="isAxiosError"),V.call(i,s.message,t,r,n,o),i.cause=s,i.name=s.name,l&&Object.assign(i,l),i};const Ni=null;function ys(s){return b.isPlainObject(s)||b.isArray(s)}function fn(s){return b.endsWith(s,"[]")?s.slice(0,-2):s}function br(s,t,r){return s?s.concat(t).map(function(o,l){return o=fn(o),!r&&l?"["+o+"]":o}).join(r?".":""):t}function Mi(s){return b.isArray(s)&&!s.some(ys)}const Fi=b.toFlatObject(b,{},null,function(t){return/^is[A-Z]/.test(t)});function es(s,t,r){if(!b.isObject(s))throw new TypeError("target must be an object");t=t||new FormData,r=b.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(j,y){return!b.isUndefined(y[j])});const n=r.metaTokens,o=r.visitor||f,l=r.dots,i=r.indexes,c=(r.Blob||typeof Blob<"u"&&Blob)&&b.isSpecCompliantForm(t);if(!b.isFunction(o))throw new TypeError("visitor must be a function");function d(x){if(x===null)return"";if(b.isDate(x))return x.toISOString();if(b.isBoolean(x))return x.toString();if(!c&&b.isBlob(x))throw new V("Blob is not supported. Use a Buffer instead.");return b.isArrayBuffer(x)||b.isTypedArray(x)?c&&typeof Blob=="function"?new Blob([x]):Buffer.from(x):x}function f(x,j,y){let D=x;if(x&&!y&&typeof x=="object"){if(b.endsWith(j,"{}"))j=n?j:j.slice(0,-2),x=JSON.stringify(x);else if(b.isArray(x)&&Mi(x)||(b.isFileList(x)||b.endsWith(j,"[]"))&&(D=b.toArray(x)))return j=fn(j),D.forEach(function(m,C){!(b.isUndefined(m)||m===null)&&t.append(i===!0?br([j],C,l):i===null?j:j+"[]",d(m))}),!1}return ys(x)?!0:(t.append(br(y,j,l),d(x)),!1)}const p=[],w=Object.assign(Fi,{defaultVisitor:f,convertValue:d,isVisitable:ys});function v(x,j){if(!b.isUndefined(x)){if(p.indexOf(x)!==-1)throw Error("Circular reference detected in "+j.join("."));p.push(x),b.forEach(x,function(D,k){(!(b.isUndefined(D)||D===null)&&o.call(t,D,b.isString(k)?k.trim():k,j,w))===!0&&v(D,j?j.concat(k):[k])}),p.pop()}}if(!b.isObject(s))throw new TypeError("data must be an object");return v(s),t}function yr(s){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function Us(s,t){this._pairs=[],s&&es(s,this,t)}const mn=Us.prototype;mn.append=function(t,r){this._pairs.push([t,r])};mn.toString=function(t){const r=t?function(n){return t.call(this,n,yr)}:yr;return this._pairs.map(function(o){return r(o[0])+"="+r(o[1])},"").join("&")};function qi(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function gn(s,t,r){if(!t)return s;const n=r&&r.encode||qi;b.isFunction(r)&&(r={serialize:r});const o=r&&r.serialize;let l;if(o?l=o(t,r):l=b.isURLSearchParams(t)?t.toString():new Us(t,r).toString(n),l){const i=s.indexOf("#");i!==-1&&(s=s.slice(0,i)),s+=(s.indexOf("?")===-1?"?":"&")+l}return s}class wr{constructor(){this.handlers=[]}use(t,r,n){return this.handlers.push({fulfilled:t,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){b.forEach(this.handlers,function(n){n!==null&&t(n)})}}const jn={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},$i=typeof URLSearchParams<"u"?URLSearchParams:Us,Ui=typeof FormData<"u"?FormData:null,Bi=typeof Blob<"u"?Blob:null,Wi={isBrowser:!0,classes:{URLSearchParams:$i,FormData:Ui,Blob:Bi},protocols:["http","https","file","blob","url","data"]},Bs=typeof window<"u"&&typeof document<"u",ws=typeof navigator=="object"&&navigator||void 0,Hi=Bs&&(!ws||["ReactNative","NativeScript","NS"].indexOf(ws.product)<0),Vi=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Ji=Bs&&window.location.href||"http://localhost",Gi=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Bs,hasStandardBrowserEnv:Hi,hasStandardBrowserWebWorkerEnv:Vi,navigator:ws,origin:Ji},Symbol.toStringTag,{value:"Module"})),me={...Gi,...Wi};function Ki(s,t){return es(s,new me.classes.URLSearchParams,Object.assign({visitor:function(r,n,o,l){return me.isNode&&b.isBuffer(r)?(this.append(n,r.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},t))}function Zi(s){return b.matchAll(/\w+|\[(\w*)]/g,s).map(t=>t[0]==="[]"?"":t[1]||t[0])}function Qi(s){const t={},r=Object.keys(s);let n;const o=r.length;let l;for(n=0;n<o;n++)l=r[n],t[l]=s[l];return t}function bn(s){function t(r,n,o,l){let i=r[l++];if(i==="__proto__")return!0;const a=Number.isFinite(+i),c=l>=r.length;return i=!i&&b.isArray(o)?o.length:i,c?(b.hasOwnProp(o,i)?o[i]=[o[i],n]:o[i]=n,!a):((!o[i]||!b.isObject(o[i]))&&(o[i]=[]),t(r,n,o[i],l)&&b.isArray(o[i])&&(o[i]=Qi(o[i])),!a)}if(b.isFormData(s)&&b.isFunction(s.entries)){const r={};return b.forEachEntry(s,(n,o)=>{t(Zi(n),o,r,0)}),r}return null}function Xi(s,t,r){if(b.isString(s))try{return(t||JSON.parse)(s),b.trim(s)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(s)}const Ct={transitional:jn,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const n=r.getContentType()||"",o=n.indexOf("application/json")>-1,l=b.isObject(t);if(l&&b.isHTMLForm(t)&&(t=new FormData(t)),b.isFormData(t))return o?JSON.stringify(bn(t)):t;if(b.isArrayBuffer(t)||b.isBuffer(t)||b.isStream(t)||b.isFile(t)||b.isBlob(t)||b.isReadableStream(t))return t;if(b.isArrayBufferView(t))return t.buffer;if(b.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let a;if(l){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Ki(t,this.formSerializer).toString();if((a=b.isFileList(t))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return es(a?{"files[]":t}:t,c&&new c,this.formSerializer)}}return l||o?(r.setContentType("application/json",!1),Xi(t)):t}],transformResponse:[function(t){const r=this.transitional||Ct.transitional,n=r&&r.forcedJSONParsing,o=this.responseType==="json";if(b.isResponse(t)||b.isReadableStream(t))return t;if(t&&b.isString(t)&&(n&&!this.responseType||o)){const i=!(r&&r.silentJSONParsing)&&o;try{return JSON.parse(t)}catch(a){if(i)throw a.name==="SyntaxError"?V.from(a,V.ERR_BAD_RESPONSE,this,null,this.response):a}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:me.classes.FormData,Blob:me.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};b.forEach(["delete","get","head","post","put","patch"],s=>{Ct.headers[s]={}});const Yi=b.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),el=s=>{const t={};let r,n,o;return s&&s.split(`
`).forEach(function(i){o=i.indexOf(":"),r=i.substring(0,o).trim().toLowerCase(),n=i.substring(o+1).trim(),!(!r||t[r]&&Yi[r])&&(r==="set-cookie"?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t},Sr=Symbol("internals");function pt(s){return s&&String(s).trim().toLowerCase()}function Lt(s){return s===!1||s==null?s:b.isArray(s)?s.map(Lt):String(s)}function tl(s){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(s);)t[n[1]]=n[2];return t}const sl=s=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(s.trim());function ls(s,t,r,n,o){if(b.isFunction(n))return n.call(this,t,r);if(o&&(t=r),!!b.isString(t)){if(b.isString(n))return t.indexOf(n)!==-1;if(b.isRegExp(n))return n.test(t)}}function rl(s){return s.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,n)=>r.toUpperCase()+n)}function nl(s,t){const r=b.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(s,n+r,{value:function(o,l,i){return this[n].call(this,t,o,l,i)},configurable:!0})})}let Pe=class{constructor(t){t&&this.set(t)}set(t,r,n){const o=this;function l(a,c,d){const f=pt(c);if(!f)throw new Error("header name must be a non-empty string");const p=b.findKey(o,f);(!p||o[p]===void 0||d===!0||d===void 0&&o[p]!==!1)&&(o[p||c]=Lt(a))}const i=(a,c)=>b.forEach(a,(d,f)=>l(d,f,c));if(b.isPlainObject(t)||t instanceof this.constructor)i(t,r);else if(b.isString(t)&&(t=t.trim())&&!sl(t))i(el(t),r);else if(b.isObject(t)&&b.isIterable(t)){let a={},c,d;for(const f of t){if(!b.isArray(f))throw TypeError("Object iterator must return a key-value pair");a[d=f[0]]=(c=a[d])?b.isArray(c)?[...c,f[1]]:[c,f[1]]:f[1]}i(a,r)}else t!=null&&l(r,t,n);return this}get(t,r){if(t=pt(t),t){const n=b.findKey(this,t);if(n){const o=this[n];if(!r)return o;if(r===!0)return tl(o);if(b.isFunction(r))return r.call(this,o,n);if(b.isRegExp(r))return r.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=pt(t),t){const n=b.findKey(this,t);return!!(n&&this[n]!==void 0&&(!r||ls(this,this[n],n,r)))}return!1}delete(t,r){const n=this;let o=!1;function l(i){if(i=pt(i),i){const a=b.findKey(n,i);a&&(!r||ls(n,n[a],a,r))&&(delete n[a],o=!0)}}return b.isArray(t)?t.forEach(l):l(t),o}clear(t){const r=Object.keys(this);let n=r.length,o=!1;for(;n--;){const l=r[n];(!t||ls(this,this[l],l,t,!0))&&(delete this[l],o=!0)}return o}normalize(t){const r=this,n={};return b.forEach(this,(o,l)=>{const i=b.findKey(n,l);if(i){r[i]=Lt(o),delete r[l];return}const a=t?rl(l):String(l).trim();a!==l&&delete r[l],r[a]=Lt(o),n[a]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return b.forEach(this,(n,o)=>{n!=null&&n!==!1&&(r[o]=t&&b.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const n=new this(t);return r.forEach(o=>n.set(o)),n}static accessor(t){const n=(this[Sr]=this[Sr]={accessors:{}}).accessors,o=this.prototype;function l(i){const a=pt(i);n[a]||(nl(o,i),n[a]=!0)}return b.isArray(t)?t.forEach(l):l(t),this}};Pe.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);b.reduceDescriptors(Pe.prototype,({value:s},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>s,set(n){this[r]=n}}});b.freezeMethods(Pe);function as(s,t){const r=this||Ct,n=t||r,o=Pe.from(n.headers);let l=n.data;return b.forEach(s,function(a){l=a.call(r,l,o.normalize(),t?t.status:void 0)}),o.normalize(),l}function yn(s){return!!(s&&s.__CANCEL__)}function ut(s,t,r){V.call(this,s??"canceled",V.ERR_CANCELED,t,r),this.name="CanceledError"}b.inherits(ut,V,{__CANCEL__:!0});function wn(s,t,r){const n=r.config.validateStatus;!r.status||!n||n(r.status)?s(r):t(new V("Request failed with status code "+r.status,[V.ERR_BAD_REQUEST,V.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function ol(s){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return t&&t[1]||""}function il(s,t){s=s||10;const r=new Array(s),n=new Array(s);let o=0,l=0,i;return t=t!==void 0?t:1e3,function(c){const d=Date.now(),f=n[l];i||(i=d),r[o]=c,n[o]=d;let p=l,w=0;for(;p!==o;)w+=r[p++],p=p%s;if(o=(o+1)%s,o===l&&(l=(l+1)%s),d-i<t)return;const v=f&&d-f;return v?Math.round(w*1e3/v):void 0}}function ll(s,t){let r=0,n=1e3/t,o,l;const i=(d,f=Date.now())=>{r=f,o=null,l&&(clearTimeout(l),l=null),s.apply(null,d)};return[(...d)=>{const f=Date.now(),p=f-r;p>=n?i(d,f):(o=d,l||(l=setTimeout(()=>{l=null,i(o)},n-p)))},()=>o&&i(o)]}const Bt=(s,t,r=3)=>{let n=0;const o=il(50,250);return ll(l=>{const i=l.loaded,a=l.lengthComputable?l.total:void 0,c=i-n,d=o(c),f=i<=a;n=i;const p={loaded:i,total:a,progress:a?i/a:void 0,bytes:c,rate:d||void 0,estimated:d&&a&&f?(a-i)/d:void 0,event:l,lengthComputable:a!=null,[t?"download":"upload"]:!0};s(p)},r)},vr=(s,t)=>{const r=s!=null;return[n=>t[0]({lengthComputable:r,total:s,loaded:n}),t[1]]},kr=s=>(...t)=>b.asap(()=>s(...t)),al=me.hasStandardBrowserEnv?((s,t)=>r=>(r=new URL(r,me.origin),s.protocol===r.protocol&&s.host===r.host&&(t||s.port===r.port)))(new URL(me.origin),me.navigator&&/(msie|trident)/i.test(me.navigator.userAgent)):()=>!0,cl=me.hasStandardBrowserEnv?{write(s,t,r,n,o,l){const i=[s+"="+encodeURIComponent(t)];b.isNumber(r)&&i.push("expires="+new Date(r).toGMTString()),b.isString(n)&&i.push("path="+n),b.isString(o)&&i.push("domain="+o),l===!0&&i.push("secure"),document.cookie=i.join("; ")},read(s){const t=document.cookie.match(new RegExp("(^|;\\s*)("+s+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(s){this.write(s,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function dl(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}function ul(s,t){return t?s.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):s}function Sn(s,t,r){let n=!dl(t);return s&&(n||r==!1)?ul(s,t):t}const Cr=s=>s instanceof Pe?{...s}:s;function st(s,t){t=t||{};const r={};function n(d,f,p,w){return b.isPlainObject(d)&&b.isPlainObject(f)?b.merge.call({caseless:w},d,f):b.isPlainObject(f)?b.merge({},f):b.isArray(f)?f.slice():f}function o(d,f,p,w){if(b.isUndefined(f)){if(!b.isUndefined(d))return n(void 0,d,p,w)}else return n(d,f,p,w)}function l(d,f){if(!b.isUndefined(f))return n(void 0,f)}function i(d,f){if(b.isUndefined(f)){if(!b.isUndefined(d))return n(void 0,d)}else return n(void 0,f)}function a(d,f,p){if(p in t)return n(d,f);if(p in s)return n(void 0,d)}const c={url:l,method:l,data:l,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:a,headers:(d,f,p)=>o(Cr(d),Cr(f),p,!0)};return b.forEach(Object.keys(Object.assign({},s,t)),function(f){const p=c[f]||o,w=p(s[f],t[f],f);b.isUndefined(w)&&p!==a||(r[f]=w)}),r}const vn=s=>{const t=st({},s);let{data:r,withXSRFToken:n,xsrfHeaderName:o,xsrfCookieName:l,headers:i,auth:a}=t;t.headers=i=Pe.from(i),t.url=gn(Sn(t.baseURL,t.url,t.allowAbsoluteUrls),s.params,s.paramsSerializer),a&&i.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let c;if(b.isFormData(r)){if(me.hasStandardBrowserEnv||me.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if((c=i.getContentType())!==!1){const[d,...f]=c?c.split(";").map(p=>p.trim()).filter(Boolean):[];i.setContentType([d||"multipart/form-data",...f].join("; "))}}if(me.hasStandardBrowserEnv&&(n&&b.isFunction(n)&&(n=n(t)),n||n!==!1&&al(t.url))){const d=o&&l&&cl.read(l);d&&i.set(o,d)}return t},hl=typeof XMLHttpRequest<"u",xl=hl&&function(s){return new Promise(function(r,n){const o=vn(s);let l=o.data;const i=Pe.from(o.headers).normalize();let{responseType:a,onUploadProgress:c,onDownloadProgress:d}=o,f,p,w,v,x;function j(){v&&v(),x&&x(),o.cancelToken&&o.cancelToken.unsubscribe(f),o.signal&&o.signal.removeEventListener("abort",f)}let y=new XMLHttpRequest;y.open(o.method.toUpperCase(),o.url,!0),y.timeout=o.timeout;function D(){if(!y)return;const m=Pe.from("getAllResponseHeaders"in y&&y.getAllResponseHeaders()),T={data:!a||a==="text"||a==="json"?y.responseText:y.response,status:y.status,statusText:y.statusText,headers:m,config:s,request:y};wn(function(_){r(_),j()},function(_){n(_),j()},T),y=null}"onloadend"in y?y.onloadend=D:y.onreadystatechange=function(){!y||y.readyState!==4||y.status===0&&!(y.responseURL&&y.responseURL.indexOf("file:")===0)||setTimeout(D)},y.onabort=function(){y&&(n(new V("Request aborted",V.ECONNABORTED,s,y)),y=null)},y.onerror=function(){n(new V("Network Error",V.ERR_NETWORK,s,y)),y=null},y.ontimeout=function(){let C=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const T=o.transitional||jn;o.timeoutErrorMessage&&(C=o.timeoutErrorMessage),n(new V(C,T.clarifyTimeoutError?V.ETIMEDOUT:V.ECONNABORTED,s,y)),y=null},l===void 0&&i.setContentType(null),"setRequestHeader"in y&&b.forEach(i.toJSON(),function(C,T){y.setRequestHeader(T,C)}),b.isUndefined(o.withCredentials)||(y.withCredentials=!!o.withCredentials),a&&a!=="json"&&(y.responseType=o.responseType),d&&([w,x]=Bt(d,!0),y.addEventListener("progress",w)),c&&y.upload&&([p,v]=Bt(c),y.upload.addEventListener("progress",p),y.upload.addEventListener("loadend",v)),(o.cancelToken||o.signal)&&(f=m=>{y&&(n(!m||m.type?new ut(null,s,y):m),y.abort(),y=null)},o.cancelToken&&o.cancelToken.subscribe(f),o.signal&&(o.signal.aborted?f():o.signal.addEventListener("abort",f)));const k=ol(o.url);if(k&&me.protocols.indexOf(k)===-1){n(new V("Unsupported protocol "+k+":",V.ERR_BAD_REQUEST,s));return}y.send(l||null)})},pl=(s,t)=>{const{length:r}=s=s?s.filter(Boolean):[];if(t||r){let n=new AbortController,o;const l=function(d){if(!o){o=!0,a();const f=d instanceof Error?d:this.reason;n.abort(f instanceof V?f:new ut(f instanceof Error?f.message:f))}};let i=t&&setTimeout(()=>{i=null,l(new V(`timeout ${t} of ms exceeded`,V.ETIMEDOUT))},t);const a=()=>{s&&(i&&clearTimeout(i),i=null,s.forEach(d=>{d.unsubscribe?d.unsubscribe(l):d.removeEventListener("abort",l)}),s=null)};s.forEach(d=>d.addEventListener("abort",l));const{signal:c}=n;return c.unsubscribe=()=>b.asap(a),c}},fl=function*(s,t){let r=s.byteLength;if(r<t){yield s;return}let n=0,o;for(;n<r;)o=n+t,yield s.slice(n,o),n=o},ml=async function*(s,t){for await(const r of gl(s))yield*fl(r,t)},gl=async function*(s){if(s[Symbol.asyncIterator]){yield*s;return}const t=s.getReader();try{for(;;){const{done:r,value:n}=await t.read();if(r)break;yield n}}finally{await t.cancel()}},_r=(s,t,r,n)=>{const o=ml(s,t);let l=0,i,a=c=>{i||(i=!0,n&&n(c))};return new ReadableStream({async pull(c){try{const{done:d,value:f}=await o.next();if(d){a(),c.close();return}let p=f.byteLength;if(r){let w=l+=p;r(w)}c.enqueue(new Uint8Array(f))}catch(d){throw a(d),d}},cancel(c){return a(c),o.return()}},{highWaterMark:2})},ts=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",kn=ts&&typeof ReadableStream=="function",jl=ts&&(typeof TextEncoder=="function"?(s=>t=>s.encode(t))(new TextEncoder):async s=>new Uint8Array(await new Response(s).arrayBuffer())),Cn=(s,...t)=>{try{return!!s(...t)}catch{return!1}},bl=kn&&Cn(()=>{let s=!1;const t=new Request(me.origin,{body:new ReadableStream,method:"POST",get duplex(){return s=!0,"half"}}).headers.has("Content-Type");return s&&!t}),Pr=64*1024,Ss=kn&&Cn(()=>b.isReadableStream(new Response("").body)),Wt={stream:Ss&&(s=>s.body)};ts&&(s=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!Wt[t]&&(Wt[t]=b.isFunction(s[t])?r=>r[t]():(r,n)=>{throw new V(`Response type '${t}' is not supported`,V.ERR_NOT_SUPPORT,n)})})})(new Response);const yl=async s=>{if(s==null)return 0;if(b.isBlob(s))return s.size;if(b.isSpecCompliantForm(s))return(await new Request(me.origin,{method:"POST",body:s}).arrayBuffer()).byteLength;if(b.isArrayBufferView(s)||b.isArrayBuffer(s))return s.byteLength;if(b.isURLSearchParams(s)&&(s=s+""),b.isString(s))return(await jl(s)).byteLength},wl=async(s,t)=>{const r=b.toFiniteNumber(s.getContentLength());return r??yl(t)},Sl=ts&&(async s=>{let{url:t,method:r,data:n,signal:o,cancelToken:l,timeout:i,onDownloadProgress:a,onUploadProgress:c,responseType:d,headers:f,withCredentials:p="same-origin",fetchOptions:w}=vn(s);d=d?(d+"").toLowerCase():"text";let v=pl([o,l&&l.toAbortSignal()],i),x;const j=v&&v.unsubscribe&&(()=>{v.unsubscribe()});let y;try{if(c&&bl&&r!=="get"&&r!=="head"&&(y=await wl(f,n))!==0){let T=new Request(t,{method:"POST",body:n,duplex:"half"}),M;if(b.isFormData(n)&&(M=T.headers.get("content-type"))&&f.setContentType(M),T.body){const[_,W]=vr(y,Bt(kr(c)));n=_r(T.body,Pr,_,W)}}b.isString(p)||(p=p?"include":"omit");const D="credentials"in Request.prototype;x=new Request(t,{...w,signal:v,method:r.toUpperCase(),headers:f.normalize().toJSON(),body:n,duplex:"half",credentials:D?p:void 0});let k=await fetch(x,w);const m=Ss&&(d==="stream"||d==="response");if(Ss&&(a||m&&j)){const T={};["status","statusText","headers"].forEach(O=>{T[O]=k[O]});const M=b.toFiniteNumber(k.headers.get("content-length")),[_,W]=a&&vr(M,Bt(kr(a),!0))||[];k=new Response(_r(k.body,Pr,_,()=>{W&&W(),j&&j()}),T)}d=d||"text";let C=await Wt[b.findKey(Wt,d)||"text"](k,s);return!m&&j&&j(),await new Promise((T,M)=>{wn(T,M,{data:C,headers:Pe.from(k.headers),status:k.status,statusText:k.statusText,config:s,request:x})})}catch(D){throw j&&j(),D&&D.name==="TypeError"&&/Load failed|fetch/i.test(D.message)?Object.assign(new V("Network Error",V.ERR_NETWORK,s,x),{cause:D.cause||D}):V.from(D,D&&D.code,s,x)}}),vs={http:Ni,xhr:xl,fetch:Sl};b.forEach(vs,(s,t)=>{if(s){try{Object.defineProperty(s,"name",{value:t})}catch{}Object.defineProperty(s,"adapterName",{value:t})}});const Rr=s=>`- ${s}`,vl=s=>b.isFunction(s)||s===null||s===!1,_n={getAdapter:s=>{s=b.isArray(s)?s:[s];const{length:t}=s;let r,n;const o={};for(let l=0;l<t;l++){r=s[l];let i;if(n=r,!vl(r)&&(n=vs[(i=String(r)).toLowerCase()],n===void 0))throw new V(`Unknown adapter '${i}'`);if(n)break;o[i||"#"+l]=n}if(!n){const l=Object.entries(o).map(([a,c])=>`adapter ${a} `+(c===!1?"is not supported by the environment":"is not available in the build"));let i=t?l.length>1?`since :
`+l.map(Rr).join(`
`):" "+Rr(l[0]):"as no adapter specified";throw new V("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return n},adapters:vs};function cs(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new ut(null,s)}function Er(s){return cs(s),s.headers=Pe.from(s.headers),s.data=as.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),_n.getAdapter(s.adapter||Ct.adapter)(s).then(function(n){return cs(s),n.data=as.call(s,s.transformResponse,n),n.headers=Pe.from(n.headers),n},function(n){return yn(n)||(cs(s),n&&n.response&&(n.response.data=as.call(s,s.transformResponse,n.response),n.response.headers=Pe.from(n.response.headers))),Promise.reject(n)})}const Pn="1.10.0",ss={};["object","boolean","number","function","string","symbol"].forEach((s,t)=>{ss[s]=function(n){return typeof n===s||"a"+(t<1?"n ":" ")+s}});const Ar={};ss.transitional=function(t,r,n){function o(l,i){return"[Axios v"+Pn+"] Transitional option '"+l+"'"+i+(n?". "+n:"")}return(l,i,a)=>{if(t===!1)throw new V(o(i," has been removed"+(r?" in "+r:"")),V.ERR_DEPRECATED);return r&&!Ar[i]&&(Ar[i]=!0,console.warn(o(i," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(l,i,a):!0}};ss.spelling=function(t){return(r,n)=>(console.warn(`${n} is likely a misspelling of ${t}`),!0)};function kl(s,t,r){if(typeof s!="object")throw new V("options must be an object",V.ERR_BAD_OPTION_VALUE);const n=Object.keys(s);let o=n.length;for(;o-- >0;){const l=n[o],i=t[l];if(i){const a=s[l],c=a===void 0||i(a,l,s);if(c!==!0)throw new V("option "+l+" must be "+c,V.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new V("Unknown option "+l,V.ERR_BAD_OPTION)}}const Nt={assertOptions:kl,validators:ss},Ne=Nt.validators;let tt=class{constructor(t){this.defaults=t||{},this.interceptors={request:new wr,response:new wr}}async request(t,r){try{return await this._request(t,r)}catch(n){if(n instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const l=o.stack?o.stack.replace(/^.+\n/,""):"";try{n.stack?l&&!String(n.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+l):n.stack=l}catch{}}throw n}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=st(this.defaults,r);const{transitional:n,paramsSerializer:o,headers:l}=r;n!==void 0&&Nt.assertOptions(n,{silentJSONParsing:Ne.transitional(Ne.boolean),forcedJSONParsing:Ne.transitional(Ne.boolean),clarifyTimeoutError:Ne.transitional(Ne.boolean)},!1),o!=null&&(b.isFunction(o)?r.paramsSerializer={serialize:o}:Nt.assertOptions(o,{encode:Ne.function,serialize:Ne.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),Nt.assertOptions(r,{baseUrl:Ne.spelling("baseURL"),withXsrfToken:Ne.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let i=l&&b.merge(l.common,l[r.method]);l&&b.forEach(["delete","get","head","post","put","patch","common"],x=>{delete l[x]}),r.headers=Pe.concat(i,l);const a=[];let c=!0;this.interceptors.request.forEach(function(j){typeof j.runWhen=="function"&&j.runWhen(r)===!1||(c=c&&j.synchronous,a.unshift(j.fulfilled,j.rejected))});const d=[];this.interceptors.response.forEach(function(j){d.push(j.fulfilled,j.rejected)});let f,p=0,w;if(!c){const x=[Er.bind(this),void 0];for(x.unshift.apply(x,a),x.push.apply(x,d),w=x.length,f=Promise.resolve(r);p<w;)f=f.then(x[p++],x[p++]);return f}w=a.length;let v=r;for(p=0;p<w;){const x=a[p++],j=a[p++];try{v=x(v)}catch(y){j.call(this,y);break}}try{f=Er.call(this,v)}catch(x){return Promise.reject(x)}for(p=0,w=d.length;p<w;)f=f.then(d[p++],d[p++]);return f}getUri(t){t=st(this.defaults,t);const r=Sn(t.baseURL,t.url,t.allowAbsoluteUrls);return gn(r,t.params,t.paramsSerializer)}};b.forEach(["delete","get","head","options"],function(t){tt.prototype[t]=function(r,n){return this.request(st(n||{},{method:t,url:r,data:(n||{}).data}))}});b.forEach(["post","put","patch"],function(t){function r(n){return function(l,i,a){return this.request(st(a||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:l,data:i}))}}tt.prototype[t]=r(),tt.prototype[t+"Form"]=r(!0)});let Cl=class Rn{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(l){r=l});const n=this;this.promise.then(o=>{if(!n._listeners)return;let l=n._listeners.length;for(;l-- >0;)n._listeners[l](o);n._listeners=null}),this.promise.then=o=>{let l;const i=new Promise(a=>{n.subscribe(a),l=a}).then(o);return i.cancel=function(){n.unsubscribe(l)},i},t(function(l,i,a){n.reason||(n.reason=new ut(l,i,a),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=n=>{t.abort(n)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new Rn(function(o){t=o}),cancel:t}}};function _l(s){return function(r){return s.apply(null,r)}}function Pl(s){return b.isObject(s)&&s.isAxiosError===!0}const ks={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ks).forEach(([s,t])=>{ks[t]=s});function En(s){const t=new tt(s),r=nn(tt.prototype.request,t);return b.extend(r,tt.prototype,t,{allOwnKeys:!0}),b.extend(r,t,null,{allOwnKeys:!0}),r.create=function(o){return En(st(s,o))},r}const le=En(Ct);le.Axios=tt;le.CanceledError=ut;le.CancelToken=Cl;le.isCancel=yn;le.VERSION=Pn;le.toFormData=es;le.AxiosError=V;le.Cancel=le.CanceledError;le.all=function(t){return Promise.all(t)};le.spread=_l;le.isAxiosError=Pl;le.mergeConfig=st;le.AxiosHeaders=Pe;le.formToJSON=s=>bn(b.isHTMLForm(s)?new FormData(s):s);le.getAdapter=_n.getAdapter;le.HttpStatusCode=ks;le.default=le;const{Axios:Fa,AxiosError:qa,CanceledError:$a,isCancel:Ua,CancelToken:Ba,VERSION:Wa,all:Ha,Cancel:Va,isAxiosError:Ja,spread:Ga,toFormData:Ka,AxiosHeaders:Za,HttpStatusCode:Qa,formToJSON:Xa,getAdapter:Ya,mergeConfig:ec}=le;async function Rl(s,t){try{console.log("Sending to backend:",{purchaseOrderId:s,items:t});const r=await le.post("/api/receive-purchase-order",{purchaseOrderId:s,items:t});console.log("Purchase order received successfully:",r.data)}catch(r){throw console.error("Error receiving purchase order:",r),new Error("Failed to receive purchase order")}}const El=({open:s,onClose:t,poId:r,orderNumber:n,items:o,onConfirm:l})=>{const[i,a]=h.useState([]),[c,d]=h.useState(!0),[f,p]=h.useState(!1);h.useEffect(()=>{s&&(d(!0),a(o.map(x=>({id:x.id,product_id:x.product_id,ProductName:x.ProductName,quantity_ordered:x.quantity_ordered??0,quantity_received:x.quantity_received??x.quantity_ordered??0}))),d(!1))},[o,s]);const w=(x,j)=>{let y=0;if(j==="")y=0;else if(/^\d+$/.test(j))y=parseInt(j,10);else return;a(D=>D.map(k=>k.id===x?{...k,quantity_received:y}:k))},v=async()=>{try{const x=i.map(({product_id:j,quantity_received:y})=>({product_id:String(j),quantity_received:y}));await Rl(String(r),x),p(!0),t()}catch(x){console.error("Error receiving purchase order:",x),alert("Failed to receive purchase order. Please try again.")}};return e.jsxs(e.Fragment,{children:[e.jsx(Ee,{open:s,onClose:t,"aria-labelledby":"receive-po-dialog-title",children:e.jsxs(Ae,{sx:{minWidth:400},children:[e.jsx(Ge,{}),e.jsxs(g,{id:"receive-po-dialog-title",level:"h4",sx:{mb:2},children:["Receive Purchase Order #",n??r]}),c?e.jsx(g,{children:"Loading items..."}):i.length===0?e.jsx(g,{children:"No items found for this purchase order."}):e.jsxs(We,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Ordered"}),e.jsx("th",{children:"Received"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:i.map(x=>e.jsxs("tr",{children:[e.jsx("td",{children:x.ProductName}),e.jsx("td",{children:x.quantity_ordered}),e.jsx("td",{children:e.jsx(B,{type:"number",value:x.quantity_received===0&&i.find(j=>j.id===x.id)?.quantity_received===0?"0":x.quantity_received,onChange:j=>w(x.id,j.target.value),sx:{width:80},slotProps:{input:{min:0,max:x.quantity_ordered}}})}),e.jsx("td",{style:{textAlign:"center"},children:x.quantity_received===x.quantity_ordered?e.jsx(Ls,{sx:{color:"#2e7d32"},titleAccess:"Received in full"}):e.jsx(Yr,{sx:{color:"#d32f2f"},titleAccess:"Not fully received"})})]},x.id))})]}),e.jsxs(u,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:3},children:[e.jsx(U,{variant:"plain",onClick:t,children:"Cancel"}),e.jsx(U,{variant:"solid",onClick:v,children:"Receive"})]})]})}),e.jsx(Gt,{open:f,autoHideDuration:3e3,onClose:()=>p(!1),color:"success",variant:"soft",anchorOrigin:{vertical:"top",horizontal:"center"},children:"Purchase order received successfully!"})]})},Dr={Pending:0,Ordered:1,Approved:2,Received:3,Cancelled:4},Je={fontSize:X.sizes.small},Qe={...Je,fontWeight:600,borderBottom:"1.5px solid #e0e0e0",background:"inherit"},At=s=>{switch(s){case"Pending":return"warning";case"Ordered":return"primary";case"Approved":return"primary";case"Received":return"success";case"Cancelled":return"danger";default:return"neutral"}},Al=s=>{switch(s){case"Pending":return e.jsx(ar,{});case"Ordered":return e.jsx(qt,{});case"Approved":return e.jsx(qt,{});case"Received":return e.jsx(Ls,{});case"Cancelled":return e.jsx(Yr,{});default:return e.jsx(ar,{})}},Dl=()=>{const{isMobile:s}=Ce(),[t,r]=h.useState([]),[n,o]=h.useState(!1),[l,i]=h.useState(null),[a,c]=h.useState(""),[d,f]=h.useState(""),[p,w]=h.useState(!1),[v,x]=h.useState(!1),[j,y]=h.useState(null),[D,k]=h.useState([]),m=async()=>{o(!0),i(null);try{const{data:S,error:R}=await N.from("PurchaseOrders").select("id, order_number, order_date, status, total, notes, Suppliers(name)").order("order_date",{ascending:!1});if(R)throw R;if(S){const A=S.map(q=>({...q,supplier_name:q.Suppliers?.[0]?.name||"N/A",Suppliers:void 0}));r(A)}}catch(S){i(S.message||"Failed to fetch purchase orders")}finally{o(!1)}},C=async S=>{try{const{data:R,error:A}=await N.from("purchaseorderitems").select("id, product_id, Products(ProductName), quantity_ordered, quantity_received").eq("purchase_order_id",S);if(A)throw A;if(R){const q=R.map(se=>({...se,ProductName:se.Products?.[0]?.ProductName||"Unknown Product"}));k(q)}}catch(R){console.error("Error fetching PO items:",R)}},T=async()=>{await m()},M=async(S,R)=>{try{const{error:A}=await N.from("PurchaseOrders").update({status:R}).eq("id",S);if(A)throw A;await m()}catch(A){i(A.message||"Failed to update order status")}},_=async S=>{y(S),await C(S.id),x(!0)},W=async S=>{try{for(const R of S)await N.from("purchaseorderitems").update({quantity_received:R.quantity_received}).eq("id",R.id);j?.id&&await N.from("PurchaseOrders").update({status:"Received"}).eq("id",j.id),x(!1),y(null),await m()}catch(R){i(R.message||"Failed to receive order")}},L=[...t.filter(S=>{const R=S.order_number?.toString().toLowerCase().includes(a.toLowerCase())||S.supplier_name?.toLowerCase().includes(a.toLowerCase()),A=d?S.status===d:!0;return R&&A})].sort((S,R)=>{const A=Dr[S.status]??99,q=Dr[R.status]??99;return A!==q?A-q:new Date(R.order_date).getTime()-new Date(S.order_date).getTime()});h.useEffect(()=>{m()},[]);const F=()=>e.jsxs(u,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(je,{padding:"medium",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:X.sizes.xlarge},children:"Purchase Orders"}),e.jsxs(u,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(B,{placeholder:"Search orders...",value:a,onChange:S=>c(S.target.value),startDecorator:e.jsx(ge,{}),sx:{flex:1}}),e.jsxs(ie,{placeholder:"Status",value:d,onChange:(S,R)=>f(R??""),sx:{minWidth:120},children:[e.jsx(z,{value:"",children:"All"}),e.jsx(z,{value:"Pending",children:"Pending"}),e.jsx(z,{value:"Ordered",children:"Ordered"}),e.jsx(z,{value:"Approved",children:"Approved"}),e.jsx(z,{value:"Received",children:"Received"}),e.jsx(z,{value:"Cancelled",children:"Cancelled"})]})]}),e.jsx(U,{variant:"solid",startDecorator:e.jsx(ue,{}),onClick:()=>w(!0),sx:{width:"100%",mb:2},children:"Add Purchase Order"})]}),n&&e.jsx(De,{}),l&&e.jsx(u,{sx:{p:2},children:e.jsxs(g,{color:"danger",children:["Error: ",l]})}),e.jsx(u,{children:L.length===0?e.jsx(u,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:"No purchase orders found"})}):L.map(S=>e.jsx(u,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(u,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${At(S.status)}.100`,color:`${At(S.status)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",flexShrink:0},children:Al(S.status)}),e.jsxs(u,{sx:{flex:1,minWidth:0},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsxs(g,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:["Order #",S.order_number]}),e.jsx(te,{size:"sm",color:At(S.status),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content"},children:S.status})]}),e.jsxs(g,{level:"body-xs",color:"neutral",sx:{mb:.5},children:[S.supplier_name," • ",new Date(S.order_date).toLocaleDateString()]}),e.jsxs(g,{level:"body-sm",sx:{fontWeight:"bold",color:"text.primary"},children:["Total: ",ct(S.total||0)]}),e.jsx(u,{sx:{display:"flex",gap:1,mt:1},children:S.status==="Pending"?e.jsx(U,{size:"sm",variant:"outlined",onClick:()=>M(S.id,"Ordered"),children:"Order"}):e.jsx(U,{size:"sm",variant:"outlined",onClick:()=>_(S),disabled:S.status!=="Approved"&&S.status!=="Ordered",children:"Receive"})})]})]})},S.id))})]}),$=()=>e.jsxs(je,{variant:"table-page",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:X.sizes.xlarge},children:"Purchase Orders"}),e.jsxs(u,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(B,{placeholder:"Search purchase orders...",sx:{flex:1},value:a,onChange:S=>c(S.target.value),startDecorator:e.jsx(ge,{})}),e.jsxs(ie,{placeholder:"Filter status",value:d,onChange:(S,R)=>f(R??""),sx:{minWidth:160},children:[e.jsx(z,{value:"",children:"All Statuses"}),e.jsx(z,{value:"Pending",children:"Pending"}),e.jsx(z,{value:"Ordered",children:"Ordered"}),e.jsx(z,{value:"Approved",children:"Approved"}),e.jsx(z,{value:"Received",children:"Received"}),e.jsx(z,{value:"Cancelled",children:"Cancelled"})]}),e.jsx(U,{onClick:()=>w(!0),variant:"solid",startDecorator:e.jsx(ue,{}),children:"Add Purchase Order"})]}),e.jsxs(ke,{sx:{overflow:"visible"},children:[n&&e.jsx(De,{}),l&&e.jsxs(g,{color:"danger",children:["Error: ",l]}),e.jsxs(We,{"aria-label":"Purchase Orders",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:Qe,children:"Order Number"}),e.jsx("th",{style:Qe,children:"Order Date"}),e.jsx("th",{style:Qe,children:"Status"}),e.jsx("th",{style:Qe,children:"Total"}),e.jsx("th",{style:Qe,children:"Supplier"}),e.jsx("th",{style:Qe,children:"Notes"}),e.jsx("th",{style:{width:120,...Qe},children:"Actions"})]})}),e.jsxs("tbody",{children:[L.length===0&&!n&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...Je},children:"No purchase orders found."})}),L.map(S=>e.jsxs("tr",{style:{cursor:"pointer",height:48},children:[e.jsx("td",{style:Je,children:S.order_number}),e.jsx("td",{style:Je,children:new Date(S.order_date).toLocaleDateString()}),e.jsx("td",{style:Je,children:e.jsx(te,{size:"sm",color:At(S.status),variant:"soft",children:S.status})}),e.jsx("td",{style:Je,children:ct(S.total||0)}),e.jsx("td",{style:Je,children:S.supplier_name}),e.jsx("td",{style:Je,children:S.notes||"-"}),e.jsx("td",{children:S.status==="Pending"?e.jsx(U,{size:"sm",variant:"outlined",onClick:()=>M(S.id,"Ordered"),children:"Order"}):e.jsx(U,{size:"sm",variant:"outlined",onClick:()=>_(S),disabled:S.status!=="Approved"&&S.status!=="Ordered",children:"Receive"})})]},S.id))]})]})]})]});return e.jsxs(qe,{children:[s?e.jsx(F,{}):e.jsx($,{}),e.jsx(Qo,{open:p,onClose:()=>w(!1),onCreated:T,mode:"add",order:void 0}),e.jsx(El,{open:v&&!!j?.id,onClose:()=>{x(!1),y(null)},poId:j?.id||"",orderNumber:j?.order_number||"",items:D.filter(S=>!!S.id&&!!S.product_id),onConfirm:W})]})};function Ol({value:s,onChange:t,toggleSidebar:r}){const n=Ms(),[o,l]=h.useState(!1),[i,a]=h.useState("Sales");if(n.pathname==="/login")return null;const c=h.useMemo(()=>Wn({components:{MuiTableRow:{styleOverrides:{root:{"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}}}}}}),[]);Io.filter(p=>p.showInMobile);const d=i?Tt[i].filter(p=>p.showInMobile):[],f=async p=>{const{data:w}=await N.auth.getSession();if(!w&&["orders","products","users","suppliers","purchaseorders","tickets","smscampaigns","movements"].includes(p)){console.warn("Authentication required for this page"),t("home");return}t(p)};return e.jsxs(Hn,{theme:c,children:[e.jsxs(Vn,{open:o,onClose:()=>l(!1),children:[e.jsx(Jn,{children:"Select Area"}),e.jsx(Gn,{children:["Sales","Support","Marketing","Operations"].map(p=>e.jsx(er,{fullWidth:!0,variant:i===p?"contained":"outlined",onClick:()=>{a(p),l(!1)},sx:{my:1},children:p},p))}),e.jsx(Kn,{children:e.jsx(er,{onClick:()=>l(!1),children:"Close"})})]}),e.jsx(Zn,{sx:{position:"fixed",bottom:0,left:0,right:0,zIndex:9999,backgroundColor:"rgba(0, 0, 255, 0.2)",overflow:"hidden"},children:e.jsx("div",{style:{display:"flex",flexDirection:"row",overflowX:"auto"},children:e.jsxs(Qn,{showLabels:!0,value:s,onChange:(p,w)=>{f(w)},sx:{minWidth:"max-content",flex:1},children:[d.map(p=>e.jsx(tr,{label:p.label,icon:p.icon,value:p.value,onClick:()=>f(p.value)},p.value)),e.jsx(tr,{label:i||"",icon:e.jsx(xo,{}),onClick:p=>{p.stopPropagation(),l(!0)}})]})})})]})}function ds({open:s,onClose:t,onCreated:r}){const[n,o]=h.useState(""),[l,i]=h.useState(""),[a,c]=h.useState(!1),[d,f]=h.useState(null),p=async w=>{w.preventDefault(),c(!0),f(null);const v={subject:n,requester_name:l,status:"Open"};console.log("[DialogTicketCreate] Creating ticket with payload:",v);const{error:x,data:j}=await N.from("tickets").insert(v);x&&(f(x.message||JSON.stringify(x)),console.error("[DialogTicketCreate] Error creating ticket:",x)),c(!1),x||(o(""),i(""),t(),r&&r())};return e.jsx(Ee,{open:s,onClose:t,children:e.jsxs(Ae,{sx:{minWidth:400},children:[e.jsx(g,{level:"title-md",sx:{mb:2},children:"Create Ticket"}),e.jsxs("form",{onSubmit:p,children:[e.jsx(B,{placeholder:"Subject",value:n,onChange:w=>o(w.target.value),sx:{mb:2},required:!0}),e.jsx(B,{placeholder:"Requester Name",value:l,onChange:w=>i(w.target.value),sx:{mb:2},required:!0}),d&&e.jsx(g,{color:"danger",sx:{mb:1},children:d}),e.jsx(U,{type:"submit",loading:a,disabled:a||!n||!l,variant:"solid",children:"Create"})]})]})})}const Il=["Refund issued","Replacement sent","Order cancelled","Technical support provided","Information provided","Awaiting customer response","Other"],Tl=({open:s,onClose:t,onSubmit:r})=>{const[n,o]=K.useState(""),[l,i]=K.useState("");return K.useEffect(()=>{s||(o(""),i(""))},[s]),e.jsx(Ee,{open:s,onClose:t,children:e.jsxs(Ae,{children:[e.jsx(Rs,{children:"Resolve Ticket"}),e.jsxs(Es,{sx:{display:"flex",flexDirection:"column",gap:2,minWidth:320},children:[e.jsx(ie,{value:n,onChange:(a,c)=>o(c||""),placeholder:"Select resolution",required:!0,children:Il.map(a=>e.jsx(z,{value:a,children:a},a))}),e.jsx(gs,{minRows:3,placeholder:"Resolution comment to customer...",value:l,onChange:a=>i(a.target.value)})]}),e.jsxs(As,{children:[e.jsx(U,{variant:"plain",onClick:t,children:"Cancel"}),e.jsx(U,{variant:"solid",color:"primary",disabled:!n,onClick:()=>{try{r(n,l),t()}catch(a){console.error("Error during form submission:",a)}},children:"Submit"})]})]})})},us=qs(Tl),Or=s=>{if(!s)return"";const t=new Date(s),n=Math.floor((new Date().getTime()-t.getTime())/1e3);if(n<60)return"Just now";const o=Math.floor(n/60);if(o<60)return`${o} min ago`;const l=Math.floor(o/60);if(l<24)return`${l} hour${l>1?"s":""} ago`;const i=Math.floor(l/24);if(i<7)return`${i} day${i>1?"s":""} ago`;const a=Math.floor(i/7);if(a<4)return`${a} week${a>1?"s":""} ago`;const c=Math.floor(i/30);return`${c} month${c>1?"s":""} ago`},ft={Open:{color:"success",label:"Open"},Pending:{color:"warning",label:"Pending"},Closed:{color:"neutral",label:"Closed"}};function zl(){const{isMobile:s}=Ce(),[t,r]=h.useState([]),[n,o]=h.useState(null),[l,i]=h.useState([]),[a,c]=h.useState(""),[d,f]=h.useState(""),[p,w]=h.useState("Open"),[v,x]=h.useState(!1),[j,y]=h.useState(!1),[D,k]=h.useState(!1);h.useEffect(()=>{(async()=>{const{data:L,error:F}=await N.from("tickets").select("*").order("created_at",{ascending:!1});F||r(L||[])})()},[]),h.useEffect(()=>{if(!n){i([]);return}(async()=>{const{data:L,error:F}=await N.from("ticketactivities").select("*").eq("ticket_id",n).order("timestamp",{ascending:!0});F||i(L||[])})()},[n]);const m=async()=>{const{data:O,error:L}=await N.from("tickets").select("*").order("created_at",{ascending:!1});L||r(O||[])},C=async()=>{if(a.trim()&&n){console.log("Sending message:",{ticket_id:n,message:a,activity_type:"chat",sender_name:"You"});const{error:O,data:L}=await N.from("ticketactivities").insert({ticket_id:n,message:a,activity_type:"chat",sender_name:"You"}).select();if(O){console.error("Error sending message:",O),alert("Failed to send message: "+O.message);return}console.log("Message sent successfully:",L),c("");const{data:F,error:$}=await N.from("ticketactivities").select("*").eq("ticket_id",n).order("timestamp",{ascending:!0});$?console.error("Error fetching activities:",$):(console.log("Refreshed activities:",F),i(F||[]))}},T=async(O,L)=>{if(n)try{const{error:F}=await N.from("tickets").update({status:"Closed"}).eq("id",n);if(F){console.error("Error updating ticket status:",F),alert("Failed to resolve ticket: "+F.message);return}const{error:$}=await N.from("ticketactivities").insert({ticket_id:n,message:`Ticket resolved: ${O}${L?` - ${L}`:""}`,activity_type:"chat",sender_name:"You"});$&&console.error("Error adding resolution activity:",$),await m();const{data:S}=await N.from("ticketactivities").select("*").eq("ticket_id",n).order("timestamp",{ascending:!0});i(S||[])}catch(F){console.error("Error resolving ticket:",F),alert("Failed to resolve ticket")}},M=O=>{o(O),k(!0)},_=()=>{k(!1),o(null)},W=t.filter(O=>{if(p!=="All"&&O.status!==p)return!1;if(!d)return!0;const L=d.toLowerCase();return O.subject?.toLowerCase().includes(L)||O.requester_name?.toLowerCase().includes(L)||O.status?.toLowerCase().includes(L)});if(s){const O=t.length>0&&t.every(L=>L.status==="Closed")&&p==="Open";if(D&&n){const L=t.find(F=>F.id===n);return e.jsxs(qe,{children:[e.jsxs(u,{sx:{display:"flex",flexDirection:"column",height:"100vh"},children:[e.jsxs(u,{sx:{px:2,py:1.5,borderBottom:"1px solid",borderColor:"divider",display:"flex",alignItems:"center",gap:2,bgcolor:"background.surface"},children:[e.jsx(ne,{size:"sm",variant:"plain",onClick:_,children:e.jsx(po,{})}),e.jsx(de,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:L?.requester_name?.[0]?.toUpperCase()||"?"}),e.jsxs(u,{sx:{flex:1,minWidth:0},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:600,mb:.5},children:L?.subject||"Untitled"}),e.jsx(g,{level:"body-xs",color:"neutral",children:L?.requester_name})]}),e.jsx(te,{variant:"soft",size:"sm",color:ft[L?.status||"Open"]?.color,sx:{fontWeight:600},children:ft[L?.status||"Open"]?.label}),L?.status!=="Closed"&&e.jsx(U,{variant:"solid",color:"primary",size:"sm",onClick:()=>y(!0),children:"Resolve"})]}),e.jsx(u,{sx:{flex:1,overflowY:"auto",px:2,py:2},children:e.jsx(Y,{spacing:3,children:l.map((F,$)=>{const S=F.sender_name==="You";return e.jsxs(u,{children:[$===0||new Date(F.timestamp||"").toDateString()!==new Date(l[$-1]?.timestamp||"").toDateString()?e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(u,{sx:{flex:1,height:"1px",bgcolor:"divider"}}),e.jsx(g,{level:"body-xs",sx:{mx:2,color:"text.secondary"},children:F.timestamp?new Date(F.timestamp).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}):""}),e.jsx(u,{sx:{flex:1,height:"1px",bgcolor:"divider"}})]}):null,e.jsxs(Y,{direction:"row",spacing:1,sx:{alignItems:"flex-start"},children:[!S&&e.jsx(de,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:F.sender_name?.[0]?.toUpperCase()||"?"}),e.jsx(u,{sx:{flex:1,display:"flex",flexDirection:S?"row-reverse":"row"},children:e.jsxs(u,{sx:{maxWidth:"85%",bgcolor:S?"primary.500":"neutral.50",color:S?"white":"text.primary",borderRadius:S?"18px 18px 4px 18px":"18px 18px 18px 4px",px:2,py:1.5,position:"relative",boxShadow:"sm"},children:[!S&&e.jsx(g,{level:"body-xs",sx:{fontWeight:600,mb:.5,color:S?"white":"text.primary"},children:F.sender_name}),e.jsx(g,{level:"body-sm",sx:{lineHeight:1.4,color:S?"white":"text.primary"},children:F.message})]})}),S&&e.jsx(de,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:F.sender_name?.[0]?.toUpperCase()||"?"})]}),e.jsx(u,{sx:{display:"flex",justifyContent:S?"flex-end":"flex-start",mt:.5,ml:S?0:5},children:e.jsx(g,{level:"body-xs",sx:{color:"text.tertiary"},children:F.timestamp?new Date(F.timestamp).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):""})})]},F.id)})})}),e.jsx(u,{sx:{px:2,py:1.5,borderTop:"1px solid",borderColor:"divider",bgcolor:"background.surface"},children:e.jsxs(Y,{direction:"row",spacing:1,alignItems:"flex-end",children:[e.jsx(u,{sx:{flex:1},children:e.jsx(gs,{placeholder:"Type something here...",value:a,onChange:F=>c(F.target.value),minRows:1,maxRows:3,sx:{borderRadius:"20px",border:"1px solid",borderColor:"neutral.300","&:focus-within":{borderColor:"primary.500"},"& textarea":{border:"none",outline:"none",resize:"none",px:2,py:1}},onKeyDown:F=>{F.key==="Enter"&&!F.shiftKey&&(F.preventDefault(),C())}})}),e.jsx(U,{onClick:C,disabled:!a.trim(),variant:"solid",color:"primary",size:"sm",sx:{borderRadius:"20px",minWidth:50,height:36,fontWeight:600},children:"Send"})]})})]}),e.jsx(ds,{open:v,onClose:()=>x(!1),onCreated:m}),e.jsx(us,{open:j,onClose:()=>y(!1),onSubmit:T})]})}return e.jsxs(qe,{children:[e.jsxs(u,{sx:{p:2},children:[e.jsx(g,{level:"h2",sx:{mb:3,fontWeight:600},children:"Tickets"}),e.jsxs(Y,{spacing:2,sx:{mb:2},children:[e.jsxs(Y,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(B,{placeholder:"Search tickets...",startDecorator:e.jsx(ge,{}),value:d,onChange:L=>f(L.target.value),size:"sm",sx:{flex:1}}),e.jsx(ne,{size:"sm",variant:"soft",color:"primary",onClick:()=>x(!0),children:e.jsx(ue,{})})]}),e.jsxs(ie,{value:p,onChange:(L,F)=>w(F),size:"sm",placeholder:"Filter by status",children:[e.jsx(z,{value:"All",children:"All Tickets"}),e.jsx(z,{value:"Open",children:"Open"}),e.jsx(z,{value:"Pending",children:"Pending"}),e.jsx(z,{value:"Closed",children:"Closed"})]})]}),O?e.jsxs(u,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"60vh",gap:2},children:[e.jsx(fo,{sx:{fontSize:80,color:"primary.500"}}),e.jsx(g,{level:"h3",sx:{fontWeight:700,textAlign:"center"},children:"All done, you can now go to the beach"})]}):e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:0},children:[W.map((L,F)=>e.jsxs(h.Fragment,{children:[e.jsxs(u,{sx:{p:2,display:"flex",alignItems:"flex-start",gap:2,cursor:"pointer",background:"transparent",borderRadius:1,transition:"all 0.2s","&:hover":{bgcolor:"neutral.50"}},onClick:()=>M(L.id),children:[e.jsx(de,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600,mt:.5},children:L.requester_name?.[0]?.toUpperCase()||"?"}),e.jsxs(u,{sx:{flex:1,minWidth:0},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:600,mb:.5,wordBreak:"break-word"},children:L.subject||"Untitled"}),e.jsx(g,{level:"body-xs",color:"neutral",sx:{mb:.5,wordBreak:"break-word"},children:L.requester_name}),e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(g,{level:"body-xs",color:"neutral",children:Or(L.updated_at)}),e.jsx(g,{level:"body-xs",color:"neutral",children:"•"}),e.jsxs(g,{level:"body-xs",color:"neutral",sx:{wordBreak:"break-all"},children:[L.id?.slice(0,8),"..."]})]})]}),e.jsx(te,{variant:"soft",size:"sm",color:ft[L.status||"Open"]?.color,sx:{fontWeight:600,px:1.5,py:.5,ml:1},children:ft[L.status||"Open"]?.label})]}),F<W.length-1&&e.jsx(yt,{sx:{my:.5}})]},L.id)),W.length===0&&e.jsx(g,{color:"neutral",sx:{textAlign:"center",mt:4},children:"No tickets found."})]})]}),e.jsx(ds,{open:v,onClose:()=>x(!1),onCreated:m}),e.jsx(us,{open:j,onClose:()=>y(!1),onSubmit:T})]})}return e.jsxs(u,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[e.jsxs(u,{sx:{display:"flex",flex:1},children:[e.jsxs(u,{sx:{width:390,borderRight:"1px solid",borderColor:"divider",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs(u,{sx:{px:2,py:1,borderBottom:"1px solid",borderColor:"divider",flexShrink:0},children:[e.jsxs(Y,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[e.jsxs(Y,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(g,{level:"title-lg",children:"Messages"}),e.jsx(te,{size:"sm",variant:"soft",color:"neutral",children:W.length})]}),e.jsx(ne,{size:"sm",variant:"soft",color:"primary",onClick:()=>x(!0),children:e.jsx(ue,{})})]}),e.jsx(B,{placeholder:"Search",startDecorator:e.jsx(ge,{}),value:d,onChange:O=>f(O.target.value),size:"sm",sx:{width:"100%",mb:1}}),e.jsxs(ie,{value:p,onChange:(O,L)=>w(L),size:"sm",sx:{width:"100%"},placeholder:"Filter by status",children:[e.jsx(z,{value:"All",children:"All Tickets"}),e.jsx(z,{value:"Open",children:"Open"}),e.jsx(z,{value:"Pending",children:"Pending"}),e.jsx(z,{value:"Closed",children:"Closed"})]})]}),e.jsx(u,{sx:{flex:1,overflowY:"auto",overflowX:"hidden",pt:1},children:e.jsx(ps,{size:"sm",sx:{gap:0},children:W.map(O=>e.jsxs(h.Fragment,{children:[e.jsx(fs,{sx:{p:0},children:e.jsx(jt,{selected:n===O.id,onClick:()=>o(O.id),sx:{py:1,px:2},children:e.jsxs(Y,{direction:"row",spacing:1.5,alignItems:"flex-start",sx:{width:"100%"},children:[e.jsx(u,{sx:{position:"relative"},children:e.jsx(de,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:O.requester_name?.[0]?.toUpperCase()||"?"})}),e.jsxs(u,{sx:{flex:1,minWidth:0,pr:1},children:[e.jsxs(Y,{direction:"row",justifyContent:"space-between",alignItems:"flex-start",sx:{mb:.5},children:[e.jsx(g,{level:"body-md",noWrap:!0,sx:{flex:1,pr:1},children:O.subject||"Untitled"}),O.status&&e.jsx(te,{size:"sm",color:ft[O.status]?.color,variant:"soft",sx:{flexShrink:0},children:O.status})]}),e.jsx(g,{level:"body-sm",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",mb:.5},children:O.requester_name||""}),e.jsx(u,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(g,{level:"body-xs",sx:{color:"text.tertiary"},children:Or(O.updated_at)})})]})]})})}),e.jsx(Xn,{component:"li",sx:{margin:0}})]},O.id))})})]}),e.jsxs(u,{sx:{flex:1,display:"flex",flexDirection:"column"},children:[n&&e.jsx(u,{sx:{px:3,py:2,borderBottom:"1px solid",borderColor:"divider",flexShrink:0},children:e.jsxs(Y,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(de,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:t.find(O=>O.id===n)?.requester_name?.[0]?.toUpperCase()||"?"}),e.jsxs(u,{sx:{flex:1},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:600},children:t.find(O=>O.id===n)?.requester_name||"Unknown User"}),e.jsx(g,{level:"body-xs",sx:{color:"text.secondary"},children:t.find(O=>O.id===n)?.status||"Unknown Status"})]}),e.jsx(U,{variant:"outlined",size:"sm",sx:{borderRadius:"16px"},children:"View profile"}),t.find(O=>O.id===n)?.status!=="Closed"&&e.jsx(U,{variant:"solid",color:"primary",size:"sm",sx:{borderRadius:"16px"},onClick:()=>y(!0),children:"Resolve"})]})}),e.jsx(u,{sx:{flex:1,overflowY:"auto",px:3,py:2},children:n?e.jsx(Y,{spacing:3,children:l.map((O,L)=>{const F=O.sender_name==="You";return e.jsxs(u,{children:[L===0||new Date(O.timestamp||"").toDateString()!==new Date(l[L-1]?.timestamp||"").toDateString()?e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(u,{sx:{flex:1,height:"1px",bgcolor:"divider"}}),e.jsx(g,{level:"body-xs",sx:{mx:2,color:"text.secondary"},children:O.timestamp?new Date(O.timestamp).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}):""}),e.jsx(u,{sx:{flex:1,height:"1px",bgcolor:"divider"}})]}):null,e.jsxs(Y,{direction:"row",spacing:1,sx:{alignItems:"flex-start"},children:[!F&&e.jsx(de,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:O.sender_name?.[0]?.toUpperCase()||"?"}),e.jsx(u,{sx:{flex:1,display:"flex",flexDirection:F?"row-reverse":"row"},children:e.jsxs(u,{sx:{maxWidth:"70%",bgcolor:F?"primary.500":"neutral.50",color:F?"white":"text.primary",borderRadius:F?"18px 18px 4px 18px":"18px 18px 18px 4px",px:2,py:1.5,position:"relative",boxShadow:"sm"},children:[!F&&e.jsx(g,{level:"body-xs",sx:{fontWeight:600,mb:.5,color:F?"white":"text.primary"},children:O.sender_name}),e.jsx(g,{level:"body-sm",sx:{lineHeight:1.4,color:F?"white":"text.primary"},children:O.message})]})}),F&&e.jsx(de,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:O.sender_name?.[0]?.toUpperCase()||"?"})]}),e.jsx(u,{sx:{display:"flex",justifyContent:F?"flex-end":"flex-start",mt:.5,ml:F?0:5},children:e.jsx(g,{level:"body-xs",sx:{color:"text.tertiary"},children:O.timestamp?new Date(O.timestamp).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):""})})]},O.id)})}):e.jsx(u,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx(g,{level:"body-md",sx:{color:"text.secondary"},children:"Select a ticket to view messages"})})}),n&&e.jsx(u,{sx:{px:3,py:2,borderTop:"1px solid",borderColor:"divider",flexShrink:0},children:e.jsxs(Y,{direction:"row",spacing:1,alignItems:"flex-end",children:[e.jsx(u,{sx:{flex:1},children:e.jsx(gs,{placeholder:"Type something here...",value:a,onChange:O=>c(O.target.value),minRows:1,maxRows:4,sx:{borderRadius:"20px",border:"1px solid",borderColor:"neutral.300","&:focus-within":{borderColor:"primary.500"},"& textarea":{border:"none",outline:"none",resize:"none",px:2,py:1}},onKeyDown:O=>{O.key==="Enter"&&!O.shiftKey&&(O.preventDefault(),C())}})}),e.jsx(U,{onClick:C,disabled:!a.trim(),variant:"solid",color:"primary",sx:{borderRadius:"20px",minWidth:60,height:40,fontWeight:600},children:"Send"})]})})]})]}),e.jsx(ds,{open:v,onClose:()=>x(!1),onCreated:m}),e.jsx(us,{open:j,onClose:()=>y(!1),onSubmit:T})]})}const Ir={draft:0,scheduled:1,sent:2,failed:3},$e={fontSize:X.sizes.small},Xe={...$e,fontWeight:600,borderBottom:"1.5px solid #e0e0e0",background:"inherit"},Dt=s=>{switch(s){case"draft":return"neutral";case"scheduled":return"warning";case"sent":return"success";case"failed":return"danger";default:return"neutral"}},Ll=s=>{switch(s){case"draft":return e.jsx(bo,{});case"scheduled":return e.jsx(jo,{});case"sent":return e.jsx(Ls,{});case"failed":return e.jsx(go,{});default:return e.jsx(mo,{})}},Nl=()=>{const{isMobile:s}=Ce(),[t,r]=h.useState([]),[n,o]=h.useState(!1),[l,i]=h.useState(null),[a,c]=h.useState(""),[d,f]=h.useState(""),[p,w]=h.useState(!1),v=async()=>{o(!0),i(null);try{const{data:k,error:m}=await N.from("sms_campaigns").select("*").order("created_at",{ascending:!1});if(m)throw m;k&&r(k)}catch(k){console.error("Error fetching campaigns:",k),i(k.message||"Failed to fetch campaigns")}finally{o(!1)}},j=[...t.filter(k=>{const m=k.name.toLowerCase().includes(a.toLowerCase())||k.CampaignNumber?.toLowerCase().includes(a.toLowerCase()),C=d?k.status===d:!0;return m&&C})].sort((k,m)=>{const C=Ir[k.status]??99,T=Ir[m.status]??99;return C!==T?C-T:new Date(m.created_at).getTime()-new Date(k.created_at).getTime()});h.useEffect(()=>{v()},[]);const y=()=>e.jsxs(u,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(je,{padding:"medium",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:X.sizes.xlarge},children:"SMS Campaigns"}),e.jsxs(u,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(B,{placeholder:"Search campaigns...",value:a,onChange:k=>c(k.target.value),startDecorator:e.jsx(ge,{}),sx:{flex:1}}),e.jsxs(ie,{placeholder:"Status",value:d,onChange:(k,m)=>f(m??""),sx:{minWidth:120},children:[e.jsx(z,{value:"",children:"All"}),e.jsx(z,{value:"draft",children:"Draft"}),e.jsx(z,{value:"scheduled",children:"Scheduled"}),e.jsx(z,{value:"sent",children:"Sent"}),e.jsx(z,{value:"failed",children:"Failed"})]})]}),e.jsx(U,{variant:"solid",startDecorator:e.jsx(ue,{}),onClick:()=>w(!0),sx:{width:"100%",mb:2},children:"Create Campaign"})]}),n&&e.jsx(De,{}),l&&e.jsx(u,{sx:{p:2},children:e.jsxs(g,{color:"danger",children:["Error: ",l]})}),e.jsx(u,{children:j.length===0?e.jsx(u,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:"No SMS campaigns found"})}):j.map(k=>e.jsx(u,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(u,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${Dt(k.status)}.100`,color:`${Dt(k.status)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",flexShrink:0},children:Ll(k.status)}),e.jsxs(u,{sx:{flex:1,minWidth:0},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:k.name}),e.jsx(te,{size:"sm",color:Dt(k.status),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content",textTransform:"capitalize"},children:k.status})]}),e.jsxs(g,{level:"body-xs",color:"neutral",sx:{mb:.5},children:["Campaign #",k.CampaignNumber," • ",new Date(k.created_at).toLocaleDateString()]}),e.jsxs(u,{sx:{display:"flex",gap:2,mb:.5},children:[e.jsxs(g,{level:"body-xs",color:"neutral",children:["Recipients: ",k.recipients?.length??0]}),k.scheduled_at&&e.jsxs(g,{level:"body-xs",color:"neutral",children:["Scheduled: ",os(new Date(k.scheduled_at),"MMM dd, HH:mm")]})]}),k.message&&e.jsxs(g,{level:"body-xs",color:"neutral",sx:{fontStyle:"italic",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:['"',k.message,'"']})]})]})},k.id))})]}),D=()=>e.jsxs(je,{variant:"table-page",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:X.sizes.xlarge},children:"SMS Campaigns"}),e.jsxs(u,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(B,{placeholder:"Search campaigns...",sx:{flex:1},value:a,onChange:k=>c(k.target.value),startDecorator:e.jsx(ge,{})}),e.jsxs(ie,{placeholder:"Filter status",value:d,onChange:(k,m)=>f(m??""),sx:{minWidth:160},children:[e.jsx(z,{value:"",children:"All Statuses"}),e.jsx(z,{value:"draft",children:"Draft"}),e.jsx(z,{value:"scheduled",children:"Scheduled"}),e.jsx(z,{value:"sent",children:"Sent"}),e.jsx(z,{value:"failed",children:"Failed"})]}),e.jsx(U,{onClick:()=>w(!0),variant:"solid",startDecorator:e.jsx(ue,{}),children:"Create Campaign"})]}),e.jsxs(ke,{sx:{overflow:"visible"},children:[n&&e.jsx(De,{}),l&&e.jsxs(g,{color:"danger",children:["Error: ",l]}),e.jsxs(We,{"aria-label":"SMS Campaigns",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:Xe,children:"Campaign #"}),e.jsx("th",{style:Xe,children:"Name"}),e.jsx("th",{style:Xe,children:"Status"}),e.jsx("th",{style:Xe,children:"Scheduled"}),e.jsx("th",{style:Xe,children:"Sent"}),e.jsx("th",{style:Xe,children:"Recipients"}),e.jsx("th",{style:Xe,children:"Message"})]})}),e.jsxs("tbody",{children:[j.length===0&&!n&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...$e},children:"No campaigns found."})}),j.map(k=>e.jsxs("tr",{style:{cursor:"pointer",height:48},children:[e.jsx("td",{style:$e,children:k.CampaignNumber}),e.jsx("td",{style:$e,children:k.name}),e.jsx("td",{style:$e,children:e.jsx(te,{size:"sm",color:Dt(k.status),variant:"soft",sx:{textTransform:"capitalize"},children:k.status})}),e.jsx("td",{style:$e,children:k.scheduled_at?os(new Date(k.scheduled_at),"yyyy-MM-dd HH:mm"):"-"}),e.jsx("td",{style:$e,children:k.sent_at?os(new Date(k.sent_at),"yyyy-MM-dd HH:mm"):"-"}),e.jsx("td",{style:$e,children:k.recipients?.length??0}),e.jsx("td",{style:$e,children:e.jsx(g,{level:"body-sm",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:k.message||"-"})})]},k.id))]})]})]})]});return e.jsxs(qe,{children:[s?e.jsx(y,{}):e.jsx(D,{}),e.jsx(Ee,{open:p,onClose:()=>w(!1),children:e.jsxs(Ae,{children:[e.jsx(Ge,{}),e.jsx(g,{level:"h4",children:"Create New Campaign"}),e.jsx(g,{level:"body-sm",sx:{mt:1,mb:2},children:"Campaign creation functionality will be implemented here."}),e.jsx(U,{onClick:()=>w(!1),variant:"outlined",children:"Close"})]})})]})};function hs(s,t){return t===0?s>0?100:0:(s-t)/t*100}function xs(s){return s==null?"—":`${s>0?"+":s<0?"−":""}${Math.abs(Math.round(s))}%`}async function Ml(){const s=new Date,t=s.toISOString().slice(0,10),r=new Date(s.getTime()-30*24*60*60*1e3).toISOString().slice(0,10),n=new Date(s.getTime()-60*24*60*60*1e3).toISOString().slice(0,10),o=new Date(s.getTime()-30*24*60*60*1e3-1).toISOString().slice(0,10),l=await N.from("Orders").select("order_total, customer_email, date",{count:"exact"}).not("order_total","is",null);if(l.error||!l.data)throw new Error("Failed to fetch order stats");const i=l.data,a=i.filter(j=>j.date&&j.date>=r&&j.date<=t),c=i.filter(j=>j.date&&j.date>=n&&j.date<=o),d=a.reduce((j,y)=>j+(typeof y.order_total=="number"?y.order_total:0),0),f=c.reduce((j,y)=>j+(typeof y.order_total=="number"?y.order_total:0),0),p=a.length,w=c.length,v=new Set(a.map(j=>j.customer_email).filter(Boolean)),x=new Set(c.map(j=>j.customer_email).filter(Boolean));return{totalSales:d,orderCount:p,customerCount:v.size,salesChange:hs(d,f),ordersChange:hs(p,w),customersChange:hs(v.size,x.size)}}const Fl=()=>{const[s,t]=h.useState(null),[r,n]=h.useState(null),[o,l]=h.useState(null),[i,a]=h.useState(null),[c,d]=h.useState(null),[f,p]=h.useState(null),[w,v]=h.useState(!0),[x,j]=h.useState(null);return It("(max-width:600px)"),h.useEffect(()=>{let y=!0,D=!0;async function k(){D&&v(!0),j(null);try{const{totalSales:C,orderCount:T,customerCount:M,salesChange:_,ordersChange:W,customersChange:O}=await Ml();y&&(t(C),n(T),l(M),a(_),d(W),p(O))}catch(C){y&&j(C.message)}finally{D&&v(!1),D=!1}}k();const m=setInterval(k,1e4);return()=>{y=!1,clearInterval(m)}},[]),e.jsxs(u,{sx:{p:{xs:1,md:4},pt:{xs:0,md:4}},children:[e.jsx(g,{level:"h2",sx:{mb:2},children:"Dashboard"}),e.jsxs(Ye,{container:!0,spacing:2,children:[e.jsx(Ye,{xs:12,md:4,children:e.jsxs(ke,{variant:"outlined",children:[e.jsx(g,{level:"h4",children:"Total Sales"}),e.jsx(g,{level:"h2",color:"success",children:w?"Loading...":x?"—":ct(s)}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[w?"":xs(i)," from last 30 days"]})]})}),e.jsx(Ye,{xs:12,md:4,children:e.jsxs(ke,{variant:"outlined",children:[e.jsx(g,{level:"h4",children:"Orders"}),e.jsx(g,{level:"h2",color:"primary",children:w?"Loading...":x?"—":r?.toLocaleString()}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[w?"":xs(c)," from last 30 days"]})]})}),e.jsx(Ye,{xs:12,md:4,children:e.jsxs(ke,{variant:"outlined",children:[e.jsx(g,{level:"h4",children:"Customers"}),e.jsx(g,{level:"h2",color:"warning",children:w?"Loading...":x?"—":o?.toLocaleString()}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[w?"":xs(f)," new last 30 days"]})]})})]})]})},Me=({children:s})=>{const[t,r]=h.useState(null),[n,o]=h.useState(!0);return h.useEffect(()=>{async function l(){const{data:i}=await N.auth.getSession();r(i?.session||null),o(!1)}l()},[]),n?e.jsx("div",{children:"Loading..."}):t?e.jsx(e.Fragment,{children:s}):e.jsx($t,{to:"/",replace:!0})};function ql(s){const{onClick:t,...r}=s,{mode:n,setMode:o}=qr(),[l,i]=h.useState(!1);return h.useEffect(()=>i(!0),[]),e.jsx(ne,{"aria-label":"toggle light/dark mode",size:"sm",variant:"outlined",disabled:!l,onClick:a=>{o(n==="light"?"dark":"light"),t?.(a)},...r,children:n==="light"?e.jsx(Vr,{}):e.jsx(wo,{})})}function $l({onLogin:s}){const t=Ns(),[r,n]=h.useState(""),[o,l]=h.useState(""),[i,a]=h.useState(!1),[c,d]=h.useState(null);h.useEffect(()=>{if(window.location.pathname==="/login"){async function p(){const{data:w}=await N.auth.getSession();w?.session&&t("/dashboard")}p()}},[t]);async function f(p){p.preventDefault(),a(!0),d(null);const{data:w,error:v}=await N.auth.signInWithPassword({email:r,password:o});if(v){console.error("[Login] Auth error:",v),d(v.message),a(!1);return}const x=w.user?.id;if(!x){d("Login failed: No user ID."),a(!1);return}let{data:j,error:y}=await N.from("users").select("*").eq("id",x).single();if(y||!j){console.error("[Login] User fetch error:",y);const{error:D}=await N.from("users").upsert({id:x,email:w.user.email,name:w.user.user_metadata?.full_name||w.user.user_metadata?.name||"",role:"employee"});if(D){console.error("Upsert failed:",D),d("Upsert failed: "+D.message),a(!1);return}let k=3,m,C;for(;k>0;){await new Promise(_=>setTimeout(_,300));const{data:T,error:M}=await N.from("users").select("*").eq("id",x).single();if(m=T,C=M,C&&console.error("[Login] Retry user fetch error:",C),m&&!C){j=m,y=null;break}k--}if(y||!j){d("Access denied: User not found."),await N.auth.signOut(),a(!1);return}}if(j.role!=="employee"){d("Access denied: Only employees can access this app."),await N.auth.signOut(),a(!1);return}a(!1),s(),t("/dashboard")}return e.jsxs(Hr,{disableTransitionOnChange:!0,children:[e.jsx(Yn,{}),e.jsx($r,{styles:{":root":{"--Form-maxWidth":"800px","--Transition-duration":"0.4s"}}}),e.jsx(u,{sx:p=>({width:{xs:"100%",md:"50vw"},transition:"width var(--Transition-duration)",transitionDelay:"calc(var(--Transition-duration) + 0.1s)",position:"relative",zIndex:1,display:"flex",justifyContent:"flex-end",backdropFilter:"blur(12px)",backgroundColor:"rgba(255 255 255 / 0.2)",[p.getColorSchemeSelector("dark")]:{backgroundColor:"rgba(19 19 24 / 0.4)"}}),children:e.jsxs(u,{sx:{display:"flex",flexDirection:"column",minHeight:"100dvh",width:"100%",px:2},children:[e.jsxs(u,{component:"header",sx:{py:3,display:"flex",justifyContent:"space-between"},children:[e.jsxs(u,{sx:{gap:2,display:"flex",alignItems:"center"},children:[e.jsx(ne,{variant:"soft",color:"primary",size:"sm",children:e.jsx(yo,{})}),e.jsx(g,{level:"title-lg",children:"SmartBack"})]}),e.jsx(ql,{})]}),e.jsxs(u,{component:"main",sx:{my:"auto",py:2,pb:5,display:"flex",flexDirection:"column",gap:2,width:400,maxWidth:"100%",mx:"auto",borderRadius:"sm","& form":{display:"flex",flexDirection:"column",gap:2},"& .MuiFormLabel-asterisk":{visibility:"hidden"}},children:[e.jsx(Y,{sx:{gap:4,mb:2},children:e.jsxs(Y,{sx:{gap:1},children:[e.jsx(g,{component:"h1",level:"h3",children:"Sign in"}),e.jsx(g,{level:"body-sm",children:"Welcome back to SmartBack! Please sign in to continue."})]})}),e.jsx(Y,{sx:{gap:4,mt:2},children:e.jsxs("form",{onSubmit:f,children:[e.jsxs(re,{required:!0,children:[e.jsx(ee,{children:"Email"}),e.jsx(B,{type:"email",name:"email",value:r,onChange:p=>n(p.target.value),placeholder:"your@email.com",disabled:i})]}),e.jsxs(re,{required:!0,children:[e.jsx(ee,{children:"Password"}),e.jsx(B,{type:"password",name:"password",value:o,onChange:p=>l(p.target.value),placeholder:"••••••",disabled:i})]}),e.jsxs(Y,{sx:{gap:4,mt:2},children:[e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(eo,{size:"sm",label:"Remember me",name:"persistent"}),e.jsx(to,{level:"title-sm",href:"#forgot-password",children:"Forgot your password?"})]}),e.jsx(U,{type:"submit",fullWidth:!0,loading:i,children:"Sign in"})]})]})}),c&&e.jsx(u,{sx:{mt:2},children:e.jsx(g,{level:"body-sm",color:"danger",children:c})})]}),e.jsx(u,{component:"footer",sx:{py:3},children:e.jsxs(g,{level:"body-xs",sx:{textAlign:"center"},children:["© SmartBack ",new Date().getFullYear()]})})]})}),e.jsx(u,{sx:p=>({height:"100%",position:"fixed",right:0,top:0,bottom:0,left:{xs:0,md:"50vw"},transition:"background-image var(--Transition-duration), left var(--Transition-duration) !important",transitionDelay:"calc(var(--Transition-duration) + 0.1s)",backgroundColor:"background.level1",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundImage:"url(https://images.unsplash.com/photo-1527181152855-fc03fc7949c8?auto=format&w=1000&dpr=2)",[p.getColorSchemeSelector("dark")]:{backgroundImage:"url(https://images.unsplash.com/photo-1572072393749-3ca9c8ea0831?auto=format&w=1000&dpr=2)"}})})]})}function Ul(){return e.jsx(Fs,{children:e.jsx(Se,{path:"*",element:e.jsx($l,{onLogin:()=>{}})})})}const fe={fontSize:X.sizes.small},Bl=()=>{const{isMobile:s}=Ce();sn();const[t,r]=h.useState([]),[n,o]=h.useState([]),[l,i]=h.useState(""),[a,c]=h.useState(!1),[d,f]=h.useState(!1),[p,w]=h.useState(""),[v,x]=h.useState(""),[j,y]=h.useState(""),[D,k]=h.useState(""),[m,C]=h.useState(null),[T,M]=h.useState(!1),[_,W]=h.useState(""),[O,L]=h.useState(""),[F,$]=h.useState(!1),[S,R]=h.useState(!1),[A,q]=h.useState(""),[se,he]=h.useState("success"),ce=(P,H="success")=>{q(P),he(H),R(!0)},ae=async()=>{try{const{data:P,error:H}=await N.from("stock_movements").select(`
                    *,
                    Products (
                        ProductName,
                        ProductID
                    )
                `).order("date",{ascending:!1});H?(console.error("Error fetching movements:",H),r([]),ce("Failed to load movements","danger")):r(P||[])}catch(P){console.error("Unexpected error:",P),r([]),ce("An unexpected error occurred","danger")}},ze=async()=>{try{const{data:P,error:H}=await N.from("Products").select("*").order("ProductName");H?(console.error("Error fetching products:",H),o([])):o(P||[])}catch(P){console.error("Unexpected error:",P),o([])}},He=async P=>{if(!P){C(null);return}M(!0);try{const{data:H,error:J}=await N.from("stock_movements").select("movement_type, quantity").eq("product_id",P);if(J)console.error("Error fetching stock movements:",J),C(null);else{const be=(H||[]).reduce((ye,Ie)=>{switch(Ie.movement_type){case"incoming":return ye+Ie.quantity;case"outgoing":return ye-Ie.quantity;case"adjustment":return ye+Ie.quantity;default:return ye}},0);C(be)}}catch(H){console.error("Error calculating stock:",H),C(null)}finally{M(!1)}};h.useEffect(()=>{D?He(D):C(null)},[D]);const ht=async()=>{if(!D||_===""||m===null){ce("Please select a product and enter a valid stock level","warning");return}const H=Number(_)-m;if(H===0){ce("No adjustment needed - the stock level is already at the specified amount","warning");return}$(!0);try{const{error:J}=await N.from("stock_movements").insert({product_id:D,movement_type:"adjustment",quantity:H,reason:`Manual adjustment: ${O||"Stock level correction"}`,date:new Date().toISOString()});J?(console.error("Error creating adjustment:",J),ce("Failed to create adjustment: "+J.message,"danger")):(k(""),W(""),L(""),C(null),c(!1),ae(),ce("Stock adjustment created successfully!","success"))}catch(J){console.error("Unexpected error:",J),ce("An unexpected error occurred","danger")}finally{$(!1)}};h.useEffect(()=>{ae(),ze()},[]);const Le=t.filter(P=>{const H=l.toLowerCase(),J=l===""||P.id.toLowerCase().includes(H)||P.product_id.toLowerCase().includes(H)||P.movement_type.toLowerCase().includes(H)||(P.reason?.toLowerCase().includes(H)??!1)||(P.Products?.ProductName?.toLowerCase().includes(H)??!1),be=p===""||P.movement_type===p,ye=v===""||P.product_id===v,Ie=j===""||(()=>{const oe=P.reason?.toLowerCase()||"";switch(j){case"manual":return oe.includes("manual")||oe.includes("adjustment")||oe.includes("correction");case"damage":return oe.includes("damage")||oe.includes("broken")||oe.includes("defect");case"loss":return oe.includes("loss")||oe.includes("lost")||oe.includes("missing");case"found":return oe.includes("found")||oe.includes("surplus")||oe.includes("extra");case"po":return oe.includes("po")||oe.includes("purchase")||oe.includes("receipt");default:return!0}})();return J&&be&&ye&&Ie}),Oe=P=>{switch(P.movement_type){case"incoming":return"success";case"outgoing":return"danger";case"adjustment":return P.quantity>=0?"success":"danger";default:return"neutral"}},xt=P=>{switch(P.movement_type){case"incoming":return"↑";case"outgoing":return"↓";case"adjustment":return"⚖";default:return"•"}},Ke=P=>{switch(P.movement_type){case"incoming":return`+${P.quantity}`;case"outgoing":return`-${P.quantity}`;case"adjustment":return P.quantity>=0?`+${P.quantity}`:`${P.quantity}`;default:return P.quantity}},I=()=>{w(""),x(""),y("")},G=p!==""||v!==""||j!=="",xe=()=>e.jsxs(u,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(je,{padding:"medium",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:X.sizes.xlarge},children:"Stock Movements"}),e.jsxs(u,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(B,{placeholder:"Search movements...",value:l,onChange:P=>i(P.target.value),startDecorator:e.jsx(ge,{}),sx:{flex:1}}),e.jsx(ne,{variant:G?"solid":"soft",color:G?"primary":"neutral",size:"sm",onClick:()=>f(!0),children:e.jsx(zs,{})})]}),G&&e.jsxs(u,{sx:{mb:2,display:"flex",gap:1,flexWrap:"wrap"},children:[p&&e.jsxs(te,{size:"sm",variant:"soft",color:"primary",children:["Type: ",p]}),v&&e.jsxs(te,{size:"sm",variant:"soft",color:"primary",children:["Product: ",n.find(P=>P.uuid===v)?.ProductName||"Selected"]}),j&&e.jsxs(te,{size:"sm",variant:"soft",color:"primary",children:["Reason: ",j]})]})]}),e.jsx(u,{children:Le.length===0?e.jsx(u,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:"No stock movements found"})}):Le.map(P=>e.jsx(u,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(u,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${Oe(P)}.100`,color:`${Oe(P)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",flexShrink:0},children:xt(P)}),e.jsxs(u,{sx:{flex:1,minWidth:0},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:P.Products?.ProductName||"Unknown Product"}),e.jsx(te,{size:"sm",color:Oe(P),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content"},children:Ke(P)})]}),e.jsxs(g,{level:"body-xs",color:"neutral",sx:{mb:.5},children:["ID: ",P.Products?.ProductID||"N/A"," • ",new Date(P.date).toLocaleDateString()]}),P.reason&&e.jsx(g,{level:"body-xs",color:"neutral",sx:{fontStyle:"italic",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:P.reason})]})]})},P.id))}),e.jsx(ne,{color:"primary",variant:"soft",size:"sm",sx:{position:"fixed",bottom:80,right:16,zIndex:1e3,borderRadius:"8px",width:40,height:40,boxShadow:"sm",bgcolor:"primary.100","&:hover":{bgcolor:"primary.200",boxShadow:"md"}},onClick:()=>c(!0),children:e.jsx(ue,{fontSize:"small"})})]}),E=()=>e.jsxs(je,{variant:"table-page",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:X.sizes.xlarge},children:"Stock Movements"}),e.jsxs(u,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(B,{placeholder:"Search movements...",sx:{flex:1,fontSize:X.sizes.small},value:l,onChange:P=>i(P.target.value),startDecorator:e.jsx(ge,{})}),e.jsx(U,{variant:"solid",startDecorator:e.jsx(ue,{}),onClick:()=>c(!0),sx:{fontSize:X.sizes.small},children:"Adjust"})]}),e.jsx(ke,{sx:{overflow:"visible"},children:e.jsxs(We,{"aria-label":"Stock Movements",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:fe,children:"ID"}),e.jsx("th",{style:fe,children:"Product"}),e.jsx("th",{style:fe,children:"Movement Type"}),e.jsx("th",{style:fe,children:"Quantity"}),e.jsx("th",{style:fe,children:"Reason"}),e.jsx("th",{style:fe,children:"Date"})]})}),e.jsxs("tbody",{children:[Le.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{textAlign:"center",color:"#888",...fe},children:"No stock movements found."})}),Le.map(P=>e.jsxs("tr",{style:{cursor:"pointer"},children:[e.jsxs("td",{style:fe,children:[P.id.substring(0,8),"..."]}),e.jsx("td",{style:fe,children:P.Products?e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:P.Products.ProductName}),e.jsxs("div",{style:{fontSize:"0.8em",color:"#666"},children:["ID: ",P.Products.ProductID]})]}):e.jsx("span",{style:{color:"#999",fontStyle:"italic"},children:"Unknown Product"})}),e.jsx("td",{style:fe,children:e.jsx(te,{size:"sm",variant:"soft",color:Oe(P),children:P.movement_type==="incoming"?"↑ Incoming":P.movement_type==="outgoing"?"↓ Outgoing":"⚖ Adjustment"})}),e.jsx("td",{style:fe,children:e.jsx("span",{style:{fontWeight:"bold",color:Oe(P)==="success"?"#059669":Oe(P)==="danger"?"#dc2626":"#666"},children:Ke(P)})}),e.jsx("td",{style:fe,children:P.reason||"N/A"}),e.jsx("td",{style:fe,children:new Date(P.date).toLocaleString()})]},P.id))]})]})})]});return e.jsxs(qe,{children:[s?e.jsx(xe,{}):e.jsx(E,{}),e.jsx(Ut,{open:a,onClose:()=>c(!1),title:"Manual Stock Adjustment",size:"medium",actions:e.jsxs(u,{sx:{display:"flex",gap:2},children:[e.jsx(U,{variant:"plain",onClick:()=>c(!1),sx:fe,children:"Cancel"}),e.jsx(U,{variant:"solid",onClick:ht,loading:F,disabled:!D||_===""||m===null||Number(_)===m,sx:fe,children:"Create Adjustment"})]}),children:e.jsxs(Y,{spacing:2,children:[e.jsxs(re,{children:[e.jsx(ee,{children:"Product"}),e.jsx(ie,{placeholder:"Select a product...",value:D,onChange:(P,H)=>k(H||""),children:n.map(P=>e.jsxs(z,{value:P.uuid,children:[P.ProductName," (ID: ",P.ProductID,")"]},P.uuid))})]}),D&&e.jsxs(re,{children:[e.jsx(ee,{children:"Current Stock Level"}),e.jsx(B,{value:T?"Loading...":m!==null?m:"N/A",readOnly:!0,sx:{bgcolor:"neutral.100",color:m!==null&&m<=0?"danger.500":"neutral.600"}}),m!==null&&m<=0&&e.jsx(g,{level:"body-sm",sx:{color:"danger.500",mt:.5},children:"⚠️ Warning: Product is at or below zero stock level"})]}),m!==null&&e.jsxs(re,{children:[e.jsx(ee,{children:"Actual Stock Level"}),e.jsx(B,{type:"number",placeholder:"Enter the actual stock level...",value:_,onChange:P=>W(P.target.value),sx:{...fe},slotProps:{input:{min:0,max:999999}}}),_!==""&&m!==null&&e.jsx(g,{level:"body-sm",sx:{mt:.5,color:Number(_)>m?"success.600":Number(_)<m?"danger.600":"neutral.600"},children:Number(_)>m?`+${Number(_)-m} (increase)`:Number(_)<m?`${Number(_)-m} (decrease)`:"No change needed"})]}),e.jsxs(re,{children:[e.jsx(ee,{children:"Reason for Adjustment"}),e.jsx(B,{placeholder:"e.g., damage, loss, found inventory, physical count correction...",value:O,onChange:P=>L(P.target.value),sx:{...fe}})]})]})}),s&&e.jsx(Ut,{open:d,onClose:()=>f(!1),title:"Filter Movements",size:"medium",actions:e.jsxs(u,{sx:{display:"flex",gap:1,justifyContent:"space-between",width:"100%"},children:[e.jsx(U,{variant:"plain",color:"neutral",onClick:I,disabled:!G,children:"Clear All"}),e.jsx(U,{onClick:()=>f(!1),children:"Apply Filters"})]}),children:e.jsxs(Y,{spacing:2,children:[e.jsxs(re,{children:[e.jsx(ee,{children:"Movement Type"}),e.jsxs(ie,{placeholder:"All types",value:p,onChange:(P,H)=>w(H||""),children:[e.jsx(z,{value:"",children:"All Types"}),e.jsx(z,{value:"incoming",children:"Incoming"}),e.jsx(z,{value:"outgoing",children:"Outgoing"}),e.jsx(z,{value:"adjustment",children:"Adjustment"})]})]}),e.jsxs(re,{children:[e.jsx(ee,{children:"Product"}),e.jsxs(ie,{placeholder:"All products",value:v,onChange:(P,H)=>x(H||""),children:[e.jsx(z,{value:"",children:"All Products"}),n.map(P=>e.jsx(z,{value:P.uuid,children:P.ProductName},P.uuid))]})]}),e.jsxs(re,{children:[e.jsx(ee,{children:"Reason Category"}),e.jsxs(ie,{placeholder:"All reasons",value:j,onChange:(P,H)=>y(H||""),children:[e.jsx(z,{value:"",children:"All Reasons"}),e.jsx(z,{value:"manual",children:"Manual Adjustment"}),e.jsx(z,{value:"damage",children:"Damage/Defect"}),e.jsx(z,{value:"loss",children:"Loss/Missing"}),e.jsx(z,{value:"found",children:"Found/Surplus"}),e.jsx(z,{value:"po",children:"Purchase Order"})]})]})]})}),e.jsx(Gt,{open:S,onClose:()=>R(!1),autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{top:16,zIndex:2e3},children:e.jsx(Kt,{color:se,variant:"solid",sx:{width:"100%"},children:A})})]})};function Ws(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var nt=Ws();function An(s){nt=s}var bt={exec:()=>null};function Z(s,t=""){let r=typeof s=="string"?s:s.source,n={replace:(o,l)=>{let i=typeof l=="string"?l:l.source;return i=i.replace(ve.caret,"$1"),r=r.replace(o,i),n},getRegex:()=>new RegExp(r,t)};return n}var ve={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:s=>new RegExp(`^( {0,3}${s})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}#`),htmlBeginRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}<(?:[a-z].*>|!--)`,"i")},Wl=/^(?:[ \t]*(?:\n|$))+/,Hl=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Vl=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,_t=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Jl=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Hs=/(?:[*+-]|\d{1,9}[.)])/,Dn=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,On=Z(Dn).replace(/bull/g,Hs).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Gl=Z(Dn).replace(/bull/g,Hs).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Vs=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Kl=/^[^\n]+/,Js=/(?!\s*\])(?:\\.|[^\[\]\\])+/,Zl=Z(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Js).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Ql=Z(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Hs).getRegex(),rs="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Gs=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Xl=Z("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Gs).replace("tag",rs).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),In=Z(Vs).replace("hr",_t).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",rs).getRegex(),Yl=Z(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",In).getRegex(),Ks={blockquote:Yl,code:Hl,def:Zl,fences:Vl,heading:Jl,hr:_t,html:Xl,lheading:On,list:Ql,newline:Wl,paragraph:In,table:bt,text:Kl},Tr=Z("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",_t).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",rs).getRegex(),ea={...Ks,lheading:Gl,table:Tr,paragraph:Z(Vs).replace("hr",_t).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Tr).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",rs).getRegex()},ta={...Ks,html:Z(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Gs).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:bt,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Z(Vs).replace("hr",_t).replace("heading",` *#{1,6} *[^
]`).replace("lheading",On).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},sa=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,ra=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Tn=/^( {2,}|\\)\n(?!\s*$)/,na=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,ns=/[\p{P}\p{S}]/u,Zs=/[\s\p{P}\p{S}]/u,zn=/[^\s\p{P}\p{S}]/u,oa=Z(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Zs).getRegex(),Ln=/(?!~)[\p{P}\p{S}]/u,ia=/(?!~)[\s\p{P}\p{S}]/u,la=/(?:[^\s\p{P}\p{S}]|~)/u,aa=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,Nn=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,ca=Z(Nn,"u").replace(/punct/g,ns).getRegex(),da=Z(Nn,"u").replace(/punct/g,Ln).getRegex(),Mn="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",ua=Z(Mn,"gu").replace(/notPunctSpace/g,zn).replace(/punctSpace/g,Zs).replace(/punct/g,ns).getRegex(),ha=Z(Mn,"gu").replace(/notPunctSpace/g,la).replace(/punctSpace/g,ia).replace(/punct/g,Ln).getRegex(),xa=Z("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,zn).replace(/punctSpace/g,Zs).replace(/punct/g,ns).getRegex(),pa=Z(/\\(punct)/,"gu").replace(/punct/g,ns).getRegex(),fa=Z(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),ma=Z(Gs).replace("(?:-->|$)","-->").getRegex(),ga=Z("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",ma).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Ht=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,ja=Z(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Ht).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Fn=Z(/^!?\[(label)\]\[(ref)\]/).replace("label",Ht).replace("ref",Js).getRegex(),qn=Z(/^!?\[(ref)\](?:\[\])?/).replace("ref",Js).getRegex(),ba=Z("reflink|nolink(?!\\()","g").replace("reflink",Fn).replace("nolink",qn).getRegex(),Qs={_backpedal:bt,anyPunctuation:pa,autolink:fa,blockSkip:aa,br:Tn,code:ra,del:bt,emStrongLDelim:ca,emStrongRDelimAst:ua,emStrongRDelimUnd:xa,escape:sa,link:ja,nolink:qn,punctuation:oa,reflink:Fn,reflinkSearch:ba,tag:ga,text:na,url:bt},ya={...Qs,link:Z(/^!?\[(label)\]\((.*?)\)/).replace("label",Ht).getRegex(),reflink:Z(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Ht).getRegex()},Cs={...Qs,emStrongRDelimAst:ha,emStrongLDelim:da,url:Z(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},wa={...Cs,br:Z(Tn).replace("{2,}","*").getRegex(),text:Z(Cs.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Ot={normal:Ks,gfm:ea,pedantic:ta},mt={normal:Qs,gfm:Cs,breaks:wa,pedantic:ya},Sa={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},zr=s=>Sa[s];function Fe(s,t){if(t){if(ve.escapeTest.test(s))return s.replace(ve.escapeReplace,zr)}else if(ve.escapeTestNoEncode.test(s))return s.replace(ve.escapeReplaceNoEncode,zr);return s}function Lr(s){try{s=encodeURI(s).replace(ve.percentDecode,"%")}catch{return null}return s}function Nr(s,t){let r=s.replace(ve.findPipe,(l,i,a)=>{let c=!1,d=i;for(;--d>=0&&a[d]==="\\";)c=!c;return c?"|":" |"}),n=r.split(ve.splitPipe),o=0;if(n[0].trim()||n.shift(),n.length>0&&!n.at(-1)?.trim()&&n.pop(),t)if(n.length>t)n.splice(t);else for(;n.length<t;)n.push("");for(;o<n.length;o++)n[o]=n[o].trim().replace(ve.slashPipe,"|");return n}function gt(s,t,r){let n=s.length;if(n===0)return"";let o=0;for(;o<n&&s.charAt(n-o-1)===t;)o++;return s.slice(0,n-o)}function va(s,t){if(s.indexOf(t[1])===-1)return-1;let r=0;for(let n=0;n<s.length;n++)if(s[n]==="\\")n++;else if(s[n]===t[0])r++;else if(s[n]===t[1]&&(r--,r<0))return n;return r>0?-2:-1}function Mr(s,t,r,n,o){let l=t.href,i=t.title||null,a=s[1].replace(o.other.outputLinkReplace,"$1");n.state.inLink=!0;let c={type:s[0].charAt(0)==="!"?"image":"link",raw:r,href:l,title:i,text:a,tokens:n.inlineTokens(a)};return n.state.inLink=!1,c}function ka(s,t,r){let n=s.match(r.other.indentCodeCompensation);if(n===null)return t;let o=n[1];return t.split(`
`).map(l=>{let i=l.match(r.other.beginningSpace);if(i===null)return l;let[a]=i;return a.length>=o.length?l.slice(o.length):l}).join(`
`)}var Vt=class{options;rules;lexer;constructor(s){this.options=s||nt}space(s){let t=this.rules.block.newline.exec(s);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(s){let t=this.rules.block.code.exec(s);if(t){let r=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?r:gt(r,`
`)}}}fences(s){let t=this.rules.block.fences.exec(s);if(t){let r=t[0],n=ka(r,t[3]||"",this.rules);return{type:"code",raw:r,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:n}}}heading(s){let t=this.rules.block.heading.exec(s);if(t){let r=t[2].trim();if(this.rules.other.endingHash.test(r)){let n=gt(r,"#");(this.options.pedantic||!n||this.rules.other.endingSpaceChar.test(n))&&(r=n.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:r,tokens:this.lexer.inline(r)}}}hr(s){let t=this.rules.block.hr.exec(s);if(t)return{type:"hr",raw:gt(t[0],`
`)}}blockquote(s){let t=this.rules.block.blockquote.exec(s);if(t){let r=gt(t[0],`
`).split(`
`),n="",o="",l=[];for(;r.length>0;){let i=!1,a=[],c;for(c=0;c<r.length;c++)if(this.rules.other.blockquoteStart.test(r[c]))a.push(r[c]),i=!0;else if(!i)a.push(r[c]);else break;r=r.slice(c);let d=a.join(`
`),f=d.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}
${d}`:d,o=o?`${o}
${f}`:f;let p=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(f,l,!0),this.lexer.state.top=p,r.length===0)break;let w=l.at(-1);if(w?.type==="code")break;if(w?.type==="blockquote"){let v=w,x=v.raw+`
`+r.join(`
`),j=this.blockquote(x);l[l.length-1]=j,n=n.substring(0,n.length-v.raw.length)+j.raw,o=o.substring(0,o.length-v.text.length)+j.text;break}else if(w?.type==="list"){let v=w,x=v.raw+`
`+r.join(`
`),j=this.list(x);l[l.length-1]=j,n=n.substring(0,n.length-w.raw.length)+j.raw,o=o.substring(0,o.length-v.raw.length)+j.raw,r=x.substring(l.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:n,tokens:l,text:o}}}list(s){let t=this.rules.block.list.exec(s);if(t){let r=t[1].trim(),n=r.length>1,o={type:"list",raw:"",ordered:n,start:n?+r.slice(0,-1):"",loose:!1,items:[]};r=n?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=n?r:"[*+-]");let l=this.rules.other.listItemRegex(r),i=!1;for(;s;){let c=!1,d="",f="";if(!(t=l.exec(s))||this.rules.block.hr.test(s))break;d=t[0],s=s.substring(d.length);let p=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,D=>" ".repeat(3*D.length)),w=s.split(`
`,1)[0],v=!p.trim(),x=0;if(this.options.pedantic?(x=2,f=p.trimStart()):v?x=t[1].length+1:(x=t[2].search(this.rules.other.nonSpaceChar),x=x>4?1:x,f=p.slice(x),x+=t[1].length),v&&this.rules.other.blankLine.test(w)&&(d+=w+`
`,s=s.substring(w.length+1),c=!0),!c){let D=this.rules.other.nextBulletRegex(x),k=this.rules.other.hrRegex(x),m=this.rules.other.fencesBeginRegex(x),C=this.rules.other.headingBeginRegex(x),T=this.rules.other.htmlBeginRegex(x);for(;s;){let M=s.split(`
`,1)[0],_;if(w=M,this.options.pedantic?(w=w.replace(this.rules.other.listReplaceNesting,"  "),_=w):_=w.replace(this.rules.other.tabCharGlobal,"    "),m.test(w)||C.test(w)||T.test(w)||D.test(w)||k.test(w))break;if(_.search(this.rules.other.nonSpaceChar)>=x||!w.trim())f+=`
`+_.slice(x);else{if(v||p.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||m.test(p)||C.test(p)||k.test(p))break;f+=`
`+w}!v&&!w.trim()&&(v=!0),d+=M+`
`,s=s.substring(M.length+1),p=_.slice(x)}}o.loose||(i?o.loose=!0:this.rules.other.doubleBlankLine.test(d)&&(i=!0));let j=null,y;this.options.gfm&&(j=this.rules.other.listIsTask.exec(f),j&&(y=j[0]!=="[ ] ",f=f.replace(this.rules.other.listReplaceTask,""))),o.items.push({type:"list_item",raw:d,task:!!j,checked:y,loose:!1,text:f,tokens:[]}),o.raw+=d}let a=o.items.at(-1);if(a)a.raw=a.raw.trimEnd(),a.text=a.text.trimEnd();else return;o.raw=o.raw.trimEnd();for(let c=0;c<o.items.length;c++)if(this.lexer.state.top=!1,o.items[c].tokens=this.lexer.blockTokens(o.items[c].text,[]),!o.loose){let d=o.items[c].tokens.filter(p=>p.type==="space"),f=d.length>0&&d.some(p=>this.rules.other.anyLine.test(p.raw));o.loose=f}if(o.loose)for(let c=0;c<o.items.length;c++)o.items[c].loose=!0;return o}}html(s){let t=this.rules.block.html.exec(s);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(s){let t=this.rules.block.def.exec(s);if(t){let r=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",o=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:r,raw:t[0],href:n,title:o}}}table(s){let t=this.rules.block.table.exec(s);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let r=Nr(t[1]),n=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),o=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],l={type:"table",raw:t[0],header:[],align:[],rows:[]};if(r.length===n.length){for(let i of n)this.rules.other.tableAlignRight.test(i)?l.align.push("right"):this.rules.other.tableAlignCenter.test(i)?l.align.push("center"):this.rules.other.tableAlignLeft.test(i)?l.align.push("left"):l.align.push(null);for(let i=0;i<r.length;i++)l.header.push({text:r[i],tokens:this.lexer.inline(r[i]),header:!0,align:l.align[i]});for(let i of o)l.rows.push(Nr(i,l.header.length).map((a,c)=>({text:a,tokens:this.lexer.inline(a),header:!1,align:l.align[c]})));return l}}lheading(s){let t=this.rules.block.lheading.exec(s);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(s){let t=this.rules.block.paragraph.exec(s);if(t){let r=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:r,tokens:this.lexer.inline(r)}}}text(s){let t=this.rules.block.text.exec(s);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(s){let t=this.rules.inline.escape.exec(s);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(s){let t=this.rules.inline.tag.exec(s);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(s){let t=this.rules.inline.link.exec(s);if(t){let r=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(r)){if(!this.rules.other.endAngleBracket.test(r))return;let l=gt(r.slice(0,-1),"\\");if((r.length-l.length)%2===0)return}else{let l=va(t[2],"()");if(l===-2)return;if(l>-1){let i=(t[0].indexOf("!")===0?5:4)+t[1].length+l;t[2]=t[2].substring(0,l),t[0]=t[0].substring(0,i).trim(),t[3]=""}}let n=t[2],o="";if(this.options.pedantic){let l=this.rules.other.pedanticHrefTitle.exec(n);l&&(n=l[1],o=l[3])}else o=t[3]?t[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(r)?n=n.slice(1):n=n.slice(1,-1)),Mr(t,{href:n&&n.replace(this.rules.inline.anyPunctuation,"$1"),title:o&&o.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(s,t){let r;if((r=this.rules.inline.reflink.exec(s))||(r=this.rules.inline.nolink.exec(s))){let n=(r[2]||r[1]).replace(this.rules.other.multipleSpaceGlobal," "),o=t[n.toLowerCase()];if(!o){let l=r[0].charAt(0);return{type:"text",raw:l,text:l}}return Mr(r,o,r[0],this.lexer,this.rules)}}emStrong(s,t,r=""){let n=this.rules.inline.emStrongLDelim.exec(s);if(!(!n||n[3]&&r.match(this.rules.other.unicodeAlphaNumeric))&&(!(n[1]||n[2])||!r||this.rules.inline.punctuation.exec(r))){let o=[...n[0]].length-1,l,i,a=o,c=0,d=n[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(d.lastIndex=0,t=t.slice(-1*s.length+o);(n=d.exec(t))!=null;){if(l=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!l)continue;if(i=[...l].length,n[3]||n[4]){a+=i;continue}else if((n[5]||n[6])&&o%3&&!((o+i)%3)){c+=i;continue}if(a-=i,a>0)continue;i=Math.min(i,i+a+c);let f=[...n[0]][0].length,p=s.slice(0,o+n.index+f+i);if(Math.min(o,i)%2){let v=p.slice(1,-1);return{type:"em",raw:p,text:v,tokens:this.lexer.inlineTokens(v)}}let w=p.slice(2,-2);return{type:"strong",raw:p,text:w,tokens:this.lexer.inlineTokens(w)}}}}codespan(s){let t=this.rules.inline.code.exec(s);if(t){let r=t[2].replace(this.rules.other.newLineCharGlobal," "),n=this.rules.other.nonSpaceChar.test(r),o=this.rules.other.startingSpaceChar.test(r)&&this.rules.other.endingSpaceChar.test(r);return n&&o&&(r=r.substring(1,r.length-1)),{type:"codespan",raw:t[0],text:r}}}br(s){let t=this.rules.inline.br.exec(s);if(t)return{type:"br",raw:t[0]}}del(s){let t=this.rules.inline.del.exec(s);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(s){let t=this.rules.inline.autolink.exec(s);if(t){let r,n;return t[2]==="@"?(r=t[1],n="mailto:"+r):(r=t[1],n=r),{type:"link",raw:t[0],text:r,href:n,tokens:[{type:"text",raw:r,text:r}]}}}url(s){let t;if(t=this.rules.inline.url.exec(s)){let r,n;if(t[2]==="@")r=t[0],n="mailto:"+r;else{let o;do o=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??"";while(o!==t[0]);r=t[0],t[1]==="www."?n="http://"+t[0]:n=t[0]}return{type:"link",raw:t[0],text:r,href:n,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(s){let t=this.rules.inline.text.exec(s);if(t){let r=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:r}}}},Ue=class _s{tokens;options;state;tokenizer;inlineQueue;constructor(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||nt,this.options.tokenizer=this.options.tokenizer||new Vt,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let r={other:ve,block:Ot.normal,inline:mt.normal};this.options.pedantic?(r.block=Ot.pedantic,r.inline=mt.pedantic):this.options.gfm&&(r.block=Ot.gfm,this.options.breaks?r.inline=mt.breaks:r.inline=mt.gfm),this.tokenizer.rules=r}static get rules(){return{block:Ot,inline:mt}}static lex(t,r){return new _s(r).lex(t)}static lexInline(t,r){return new _s(r).inlineTokens(t)}lex(t){t=t.replace(ve.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let r=0;r<this.inlineQueue.length;r++){let n=this.inlineQueue[r];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,r=[],n=!1){for(this.options.pedantic&&(t=t.replace(ve.tabCharGlobal,"    ").replace(ve.spaceLine,""));t;){let o;if(this.options.extensions?.block?.some(i=>(o=i.call({lexer:this},t,r))?(t=t.substring(o.raw.length),r.push(o),!0):!1))continue;if(o=this.tokenizer.space(t)){t=t.substring(o.raw.length);let i=r.at(-1);o.raw.length===1&&i!==void 0?i.raw+=`
`:r.push(o);continue}if(o=this.tokenizer.code(t)){t=t.substring(o.raw.length);let i=r.at(-1);i?.type==="paragraph"||i?.type==="text"?(i.raw+=`
`+o.raw,i.text+=`
`+o.text,this.inlineQueue.at(-1).src=i.text):r.push(o);continue}if(o=this.tokenizer.fences(t)){t=t.substring(o.raw.length),r.push(o);continue}if(o=this.tokenizer.heading(t)){t=t.substring(o.raw.length),r.push(o);continue}if(o=this.tokenizer.hr(t)){t=t.substring(o.raw.length),r.push(o);continue}if(o=this.tokenizer.blockquote(t)){t=t.substring(o.raw.length),r.push(o);continue}if(o=this.tokenizer.list(t)){t=t.substring(o.raw.length),r.push(o);continue}if(o=this.tokenizer.html(t)){t=t.substring(o.raw.length),r.push(o);continue}if(o=this.tokenizer.def(t)){t=t.substring(o.raw.length);let i=r.at(-1);i?.type==="paragraph"||i?.type==="text"?(i.raw+=`
`+o.raw,i.text+=`
`+o.raw,this.inlineQueue.at(-1).src=i.text):this.tokens.links[o.tag]||(this.tokens.links[o.tag]={href:o.href,title:o.title});continue}if(o=this.tokenizer.table(t)){t=t.substring(o.raw.length),r.push(o);continue}if(o=this.tokenizer.lheading(t)){t=t.substring(o.raw.length),r.push(o);continue}let l=t;if(this.options.extensions?.startBlock){let i=1/0,a=t.slice(1),c;this.options.extensions.startBlock.forEach(d=>{c=d.call({lexer:this},a),typeof c=="number"&&c>=0&&(i=Math.min(i,c))}),i<1/0&&i>=0&&(l=t.substring(0,i+1))}if(this.state.top&&(o=this.tokenizer.paragraph(l))){let i=r.at(-1);n&&i?.type==="paragraph"?(i.raw+=`
`+o.raw,i.text+=`
`+o.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=i.text):r.push(o),n=l.length!==t.length,t=t.substring(o.raw.length);continue}if(o=this.tokenizer.text(t)){t=t.substring(o.raw.length);let i=r.at(-1);i?.type==="text"?(i.raw+=`
`+o.raw,i.text+=`
`+o.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=i.text):r.push(o);continue}if(t){let i="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(i);break}else throw new Error(i)}}return this.state.top=!0,r}inline(t,r=[]){return this.inlineQueue.push({src:t,tokens:r}),r}inlineTokens(t,r=[]){let n=t,o=null;if(this.tokens.links){let a=Object.keys(this.tokens.links);if(a.length>0)for(;(o=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)a.includes(o[0].slice(o[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,o.index)+"["+"a".repeat(o[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(o=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,o.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(o=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)n=n.slice(0,o.index)+"["+"a".repeat(o[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let l=!1,i="";for(;t;){l||(i=""),l=!1;let a;if(this.options.extensions?.inline?.some(d=>(a=d.call({lexer:this},t,r))?(t=t.substring(a.raw.length),r.push(a),!0):!1))continue;if(a=this.tokenizer.escape(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.tag(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.link(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(a.raw.length);let d=r.at(-1);a.type==="text"&&d?.type==="text"?(d.raw+=a.raw,d.text+=a.text):r.push(a);continue}if(a=this.tokenizer.emStrong(t,n,i)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.codespan(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.br(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.del(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.autolink(t)){t=t.substring(a.raw.length),r.push(a);continue}if(!this.state.inLink&&(a=this.tokenizer.url(t))){t=t.substring(a.raw.length),r.push(a);continue}let c=t;if(this.options.extensions?.startInline){let d=1/0,f=t.slice(1),p;this.options.extensions.startInline.forEach(w=>{p=w.call({lexer:this},f),typeof p=="number"&&p>=0&&(d=Math.min(d,p))}),d<1/0&&d>=0&&(c=t.substring(0,d+1))}if(a=this.tokenizer.inlineText(c)){t=t.substring(a.raw.length),a.raw.slice(-1)!=="_"&&(i=a.raw.slice(-1)),l=!0;let d=r.at(-1);d?.type==="text"?(d.raw+=a.raw,d.text+=a.text):r.push(a);continue}if(t){let d="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(d);break}else throw new Error(d)}}return r}},Jt=class{options;parser;constructor(s){this.options=s||nt}space(s){return""}code({text:s,lang:t,escaped:r}){let n=(t||"").match(ve.notSpaceStart)?.[0],o=s.replace(ve.endingNewline,"")+`
`;return n?'<pre><code class="language-'+Fe(n)+'">'+(r?o:Fe(o,!0))+`</code></pre>
`:"<pre><code>"+(r?o:Fe(o,!0))+`</code></pre>
`}blockquote({tokens:s}){return`<blockquote>
${this.parser.parse(s)}</blockquote>
`}html({text:s}){return s}heading({tokens:s,depth:t}){return`<h${t}>${this.parser.parseInline(s)}</h${t}>
`}hr(s){return`<hr>
`}list(s){let t=s.ordered,r=s.start,n="";for(let i=0;i<s.items.length;i++){let a=s.items[i];n+=this.listitem(a)}let o=t?"ol":"ul",l=t&&r!==1?' start="'+r+'"':"";return"<"+o+l+`>
`+n+"</"+o+`>
`}listitem(s){let t="";if(s.task){let r=this.checkbox({checked:!!s.checked});s.loose?s.tokens[0]?.type==="paragraph"?(s.tokens[0].text=r+" "+s.tokens[0].text,s.tokens[0].tokens&&s.tokens[0].tokens.length>0&&s.tokens[0].tokens[0].type==="text"&&(s.tokens[0].tokens[0].text=r+" "+Fe(s.tokens[0].tokens[0].text),s.tokens[0].tokens[0].escaped=!0)):s.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):t+=r+" "}return t+=this.parser.parse(s.tokens,!!s.loose),`<li>${t}</li>
`}checkbox({checked:s}){return"<input "+(s?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:s}){return`<p>${this.parser.parseInline(s)}</p>
`}table(s){let t="",r="";for(let o=0;o<s.header.length;o++)r+=this.tablecell(s.header[o]);t+=this.tablerow({text:r});let n="";for(let o=0;o<s.rows.length;o++){let l=s.rows[o];r="";for(let i=0;i<l.length;i++)r+=this.tablecell(l[i]);n+=this.tablerow({text:r})}return n&&(n=`<tbody>${n}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+n+`</table>
`}tablerow({text:s}){return`<tr>
${s}</tr>
`}tablecell(s){let t=this.parser.parseInline(s.tokens),r=s.header?"th":"td";return(s.align?`<${r} align="${s.align}">`:`<${r}>`)+t+`</${r}>
`}strong({tokens:s}){return`<strong>${this.parser.parseInline(s)}</strong>`}em({tokens:s}){return`<em>${this.parser.parseInline(s)}</em>`}codespan({text:s}){return`<code>${Fe(s,!0)}</code>`}br(s){return"<br>"}del({tokens:s}){return`<del>${this.parser.parseInline(s)}</del>`}link({href:s,title:t,tokens:r}){let n=this.parser.parseInline(r),o=Lr(s);if(o===null)return n;s=o;let l='<a href="'+s+'"';return t&&(l+=' title="'+Fe(t)+'"'),l+=">"+n+"</a>",l}image({href:s,title:t,text:r,tokens:n}){n&&(r=this.parser.parseInline(n,this.parser.textRenderer));let o=Lr(s);if(o===null)return Fe(r);s=o;let l=`<img src="${s}" alt="${r}"`;return t&&(l+=` title="${Fe(t)}"`),l+=">",l}text(s){return"tokens"in s&&s.tokens?this.parser.parseInline(s.tokens):"escaped"in s&&s.escaped?s.text:Fe(s.text)}},Xs=class{strong({text:s}){return s}em({text:s}){return s}codespan({text:s}){return s}del({text:s}){return s}html({text:s}){return s}text({text:s}){return s}link({text:s}){return""+s}image({text:s}){return""+s}br(){return""}},Be=class Ps{options;renderer;textRenderer;constructor(t){this.options=t||nt,this.options.renderer=this.options.renderer||new Jt,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Xs}static parse(t,r){return new Ps(r).parse(t)}static parseInline(t,r){return new Ps(r).parseInline(t)}parse(t,r=!0){let n="";for(let o=0;o<t.length;o++){let l=t[o];if(this.options.extensions?.renderers?.[l.type]){let a=l,c=this.options.extensions.renderers[a.type].call({parser:this},a);if(c!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(a.type)){n+=c||"";continue}}let i=l;switch(i.type){case"space":{n+=this.renderer.space(i);continue}case"hr":{n+=this.renderer.hr(i);continue}case"heading":{n+=this.renderer.heading(i);continue}case"code":{n+=this.renderer.code(i);continue}case"table":{n+=this.renderer.table(i);continue}case"blockquote":{n+=this.renderer.blockquote(i);continue}case"list":{n+=this.renderer.list(i);continue}case"html":{n+=this.renderer.html(i);continue}case"paragraph":{n+=this.renderer.paragraph(i);continue}case"text":{let a=i,c=this.renderer.text(a);for(;o+1<t.length&&t[o+1].type==="text";)a=t[++o],c+=`
`+this.renderer.text(a);r?n+=this.renderer.paragraph({type:"paragraph",raw:c,text:c,tokens:[{type:"text",raw:c,text:c,escaped:!0}]}):n+=c;continue}default:{let a='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return n}parseInline(t,r=this.renderer){let n="";for(let o=0;o<t.length;o++){let l=t[o];if(this.options.extensions?.renderers?.[l.type]){let a=this.options.extensions.renderers[l.type].call({parser:this},l);if(a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(l.type)){n+=a||"";continue}}let i=l;switch(i.type){case"escape":{n+=r.text(i);break}case"html":{n+=r.html(i);break}case"link":{n+=r.link(i);break}case"image":{n+=r.image(i);break}case"strong":{n+=r.strong(i);break}case"em":{n+=r.em(i);break}case"codespan":{n+=r.codespan(i);break}case"br":{n+=r.br(i);break}case"del":{n+=r.del(i);break}case"text":{n+=r.text(i);break}default:{let a='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return n}},Mt=class{options;block;constructor(s){this.options=s||nt}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(s){return s}postprocess(s){return s}processAllTokens(s){return s}provideLexer(){return this.block?Ue.lex:Ue.lexInline}provideParser(){return this.block?Be.parse:Be.parseInline}},Ca=class{defaults=Ws();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=Be;Renderer=Jt;TextRenderer=Xs;Lexer=Ue;Tokenizer=Vt;Hooks=Mt;constructor(...s){this.use(...s)}walkTokens(s,t){let r=[];for(let n of s)switch(r=r.concat(t.call(this,n)),n.type){case"table":{let o=n;for(let l of o.header)r=r.concat(this.walkTokens(l.tokens,t));for(let l of o.rows)for(let i of l)r=r.concat(this.walkTokens(i.tokens,t));break}case"list":{let o=n;r=r.concat(this.walkTokens(o.items,t));break}default:{let o=n;this.defaults.extensions?.childTokens?.[o.type]?this.defaults.extensions.childTokens[o.type].forEach(l=>{let i=o[l].flat(1/0);r=r.concat(this.walkTokens(i,t))}):o.tokens&&(r=r.concat(this.walkTokens(o.tokens,t)))}}return r}use(...s){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return s.forEach(r=>{let n={...r};if(n.async=this.defaults.async||n.async||!1,r.extensions&&(r.extensions.forEach(o=>{if(!o.name)throw new Error("extension name required");if("renderer"in o){let l=t.renderers[o.name];l?t.renderers[o.name]=function(...i){let a=o.renderer.apply(this,i);return a===!1&&(a=l.apply(this,i)),a}:t.renderers[o.name]=o.renderer}if("tokenizer"in o){if(!o.level||o.level!=="block"&&o.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let l=t[o.level];l?l.unshift(o.tokenizer):t[o.level]=[o.tokenizer],o.start&&(o.level==="block"?t.startBlock?t.startBlock.push(o.start):t.startBlock=[o.start]:o.level==="inline"&&(t.startInline?t.startInline.push(o.start):t.startInline=[o.start]))}"childTokens"in o&&o.childTokens&&(t.childTokens[o.name]=o.childTokens)}),n.extensions=t),r.renderer){let o=this.defaults.renderer||new Jt(this.defaults);for(let l in r.renderer){if(!(l in o))throw new Error(`renderer '${l}' does not exist`);if(["options","parser"].includes(l))continue;let i=l,a=r.renderer[i],c=o[i];o[i]=(...d)=>{let f=a.apply(o,d);return f===!1&&(f=c.apply(o,d)),f||""}}n.renderer=o}if(r.tokenizer){let o=this.defaults.tokenizer||new Vt(this.defaults);for(let l in r.tokenizer){if(!(l in o))throw new Error(`tokenizer '${l}' does not exist`);if(["options","rules","lexer"].includes(l))continue;let i=l,a=r.tokenizer[i],c=o[i];o[i]=(...d)=>{let f=a.apply(o,d);return f===!1&&(f=c.apply(o,d)),f}}n.tokenizer=o}if(r.hooks){let o=this.defaults.hooks||new Mt;for(let l in r.hooks){if(!(l in o))throw new Error(`hook '${l}' does not exist`);if(["options","block"].includes(l))continue;let i=l,a=r.hooks[i],c=o[i];Mt.passThroughHooks.has(l)?o[i]=d=>{if(this.defaults.async)return Promise.resolve(a.call(o,d)).then(p=>c.call(o,p));let f=a.call(o,d);return c.call(o,f)}:o[i]=(...d)=>{let f=a.apply(o,d);return f===!1&&(f=c.apply(o,d)),f}}n.hooks=o}if(r.walkTokens){let o=this.defaults.walkTokens,l=r.walkTokens;n.walkTokens=function(i){let a=[];return a.push(l.call(this,i)),o&&(a=a.concat(o.call(this,i))),a}}this.defaults={...this.defaults,...n}}),this}setOptions(s){return this.defaults={...this.defaults,...s},this}lexer(s,t){return Ue.lex(s,t??this.defaults)}parser(s,t){return Be.parse(s,t??this.defaults)}parseMarkdown(s){return(t,r)=>{let n={...r},o={...this.defaults,...n},l=this.onError(!!o.silent,!!o.async);if(this.defaults.async===!0&&n.async===!1)return l(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||t===null)return l(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return l(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));o.hooks&&(o.hooks.options=o,o.hooks.block=s);let i=o.hooks?o.hooks.provideLexer():s?Ue.lex:Ue.lexInline,a=o.hooks?o.hooks.provideParser():s?Be.parse:Be.parseInline;if(o.async)return Promise.resolve(o.hooks?o.hooks.preprocess(t):t).then(c=>i(c,o)).then(c=>o.hooks?o.hooks.processAllTokens(c):c).then(c=>o.walkTokens?Promise.all(this.walkTokens(c,o.walkTokens)).then(()=>c):c).then(c=>a(c,o)).then(c=>o.hooks?o.hooks.postprocess(c):c).catch(l);try{o.hooks&&(t=o.hooks.preprocess(t));let c=i(t,o);o.hooks&&(c=o.hooks.processAllTokens(c)),o.walkTokens&&this.walkTokens(c,o.walkTokens);let d=a(c,o);return o.hooks&&(d=o.hooks.postprocess(d)),d}catch(c){return l(c)}}}onError(s,t){return r=>{if(r.message+=`
Please report this to https://github.com/markedjs/marked.`,s){let n="<p>An error occurred:</p><pre>"+Fe(r.message+"",!0)+"</pre>";return t?Promise.resolve(n):n}if(t)return Promise.reject(r);throw r}}},rt=new Ca;function Q(s,t){return rt.parse(s,t)}Q.options=Q.setOptions=function(s){return rt.setOptions(s),Q.defaults=rt.defaults,An(Q.defaults),Q};Q.getDefaults=Ws;Q.defaults=nt;Q.use=function(...s){return rt.use(...s),Q.defaults=rt.defaults,An(Q.defaults),Q};Q.walkTokens=function(s,t){return rt.walkTokens(s,t)};Q.parseInline=rt.parseInline;Q.Parser=Be;Q.parser=Be.parse;Q.Renderer=Jt;Q.TextRenderer=Xs;Q.Lexer=Ue;Q.lexer=Ue.lex;Q.Tokenizer=Vt;Q.Hooks=Mt;Q.parse=Q;Q.options;Q.setOptions;Q.use;Q.walkTokens;Q.parseInline;Be.parse;Ue.lex;function _a(){const[s,t]=h.useState(null),[r,n]=h.useState(null),[o,l]=h.useState(!0),[i,a]=h.useState(!1),[c,d]=h.useState(!1),[f,p]=h.useState(!1),[w,v]=h.useState(null),[x,j]=h.useState(""),[y,D]=h.useState(""),[k,m]=h.useState(""),[C,T]=h.useState(""),[M,_]=h.useState(""),[W,O]=h.useState("");h.useEffect(()=>{L()},[]);const L=async()=>{try{l(!0);const{data:R}=await N.auth.getUser(),A=R.user;if(A){t(A),m(A.email||"");const{data:q}=await N.from("users").select("*").eq("id",A.id).single();if(q){n(q);const se=(q.name||"").split(" ");j(se[0]||""),D(se.slice(1).join(" ")||""),T(q.role||"UI Developer"),_(q.department||""),O(q.avatar_url||"")}}}catch(R){console.error("Error loading user data:",R),v({type:"danger",text:"Failed to load user data"})}finally{l(!1)}},F=async()=>{if(s)try{d(!0);const R=`${x} ${y}`.trim(),{error:A}=await N.from("users").update({name:R,role:C,department:M,avatar_url:W||null}).eq("id",s.id);if(A)throw A;await L(),a(!1),v({type:"success",text:"Profile updated successfully"}),setTimeout(()=>v(null),3e3)}catch(R){console.error("Error saving profile:",R),v({type:"danger",text:"Failed to save profile"})}finally{d(!1)}},$=async R=>{const A=R.target.files?.[0];if(!(!A||!s)){if(!A.type.startsWith("image/")){v({type:"danger",text:"Please select a valid image file"});return}if(A.size>5*1024*1024){v({type:"danger",text:"Image size must be less than 5MB"});return}try{p(!0),v(null);const q=A.name.split(".").pop(),he=`${s.id}-${Date.now()}.${q}`,{data:ce,error:ae}=await N.storage.from("avatars").upload(he,A,{cacheControl:"3600",upsert:!0});if(ae)throw new Error(`Upload failed: ${ae.message}`);const{data:{publicUrl:ze}}=N.storage.from("avatars").getPublicUrl(he);O(ze);const{error:He}=await N.from("users").update({avatar_url:ze}).eq("id",s.id);if(He)throw new Error(`Database update failed: ${He.message}`);await L(),v({type:"success",text:"Avatar uploaded successfully"}),setTimeout(()=>v(null),3e3)}catch(q){let se="Failed to upload avatar";q instanceof Error&&(q.message.includes("not found")?se="Storage bucket not configured. Please contact admin.":q.message.includes("permission")?se="Permission denied. Please contact admin.":se=`Upload failed: ${q.message}`),v({type:"danger",text:se})}finally{p(!1),R.target.value=""}}},S=()=>{const R=(r?.name||"").split(" ");j(R[0]||""),D(R.slice(1).join(" ")||""),T(r?.role||"UI Developer"),_(r?.department||""),O(r?.avatar_url||""),a(!1),v(null)};return o?e.jsx(ke,{children:e.jsx(lt,{children:e.jsx(g,{level:"body-sm",color:"neutral",children:"Loading profile..."})})}):e.jsx(ke,{children:e.jsxs(lt,{children:[e.jsx(g,{level:"h4",sx:{mb:1},children:"Personal info"}),e.jsx(g,{level:"body-sm",color:"neutral",sx:{mb:3},children:"Your profile information."}),w&&e.jsx(Kt,{color:w.type,sx:{mb:2},children:w.text}),e.jsxs(u,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:3,alignItems:{xs:"center",sm:"stretch"},width:"100%",maxWidth:"100%",overflow:"hidden"},children:[e.jsx(u,{sx:{flex:{xs:"none",sm:"1"},maxWidth:{xs:"100%",sm:"300px"},display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",position:"relative",minHeight:{xs:"auto",sm:"400px"},width:{xs:"100%",sm:"auto"}},children:e.jsxs(u,{sx:{position:"relative",display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsxs(de,{size:"lg",src:W||r?.avatar_url||s?.user_metadata?.avatar_url,sx:{width:160,height:160},children:[x?.[0],y?.[0]]},`avatar-${W}-${r?.avatar_url}`),i&&e.jsxs(u,{sx:{mt:2,display:"flex",flexDirection:"column",alignItems:"center",gap:1},children:[e.jsxs(ne,{component:"label",size:"sm",variant:"solid",color:"primary",loading:f,sx:{borderRadius:"8px",px:2,py:1},children:[e.jsx(at,{fontSize:"small",sx:{mr:1}}),"Upload Avatar",e.jsx("input",{type:"file",accept:"image/*",onChange:$,style:{display:"none"}})]}),e.jsx(g,{level:"body-xs",color:"neutral",sx:{textAlign:"center",maxWidth:180,lineHeight:1.4},children:"Max 5MB (JPG, PNG, GIF)"})]})]})}),e.jsxs(u,{sx:{flex:{xs:"none",sm:"2"},maxWidth:{xs:"100%",sm:"calc(100% - 300px - 24px)"},width:{xs:"100%",sm:"auto"},minWidth:0},children:[e.jsxs(Y,{spacing:2,children:[e.jsxs(u,{children:[e.jsx(ee,{sx:{mb:1},children:"Name"}),e.jsxs(u,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2},children:[e.jsx(B,{placeholder:"First name",value:x,onChange:R=>j(R.target.value),disabled:!i,sx:{flex:1}}),e.jsx(B,{placeholder:"Last name",value:y,onChange:R=>D(R.target.value),disabled:!i,sx:{flex:1}})]})]}),e.jsxs(u,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2},children:[e.jsxs(re,{sx:{flex:1},children:[e.jsx(ee,{children:"Role"}),e.jsx(B,{value:C,onChange:R=>T(R.target.value),disabled:!i})]}),e.jsxs(re,{sx:{flex:1},children:[e.jsx(ee,{children:"Department"}),e.jsx(B,{value:M,onChange:R=>_(R.target.value),disabled:!i,placeholder:"e.g., Engineering, Sales, Marketing"})]})]}),e.jsxs(re,{children:[e.jsx(ee,{children:"Email"}),e.jsx(B,{value:k,disabled:!0,startDecorator:"✉️"})]}),e.jsxs(re,{children:[e.jsx(ee,{children:"Avatar URL"}),e.jsx(B,{value:W,onChange:R=>O(R.target.value),disabled:!i,placeholder:"https://example.com/avatar.jpg",startDecorator:"🖼️"})]}),r&&e.jsxs(u,{sx:{mt:2,p:2,bgcolor:"background.level1",borderRadius:"sm"},children:[e.jsx(g,{level:"body-sm",color:"neutral",sx:{mb:1},children:"Account Information"}),e.jsxs(Y,{spacing:1,children:[r.created_at&&e.jsxs(g,{level:"body-sm",children:[e.jsx("strong",{children:"Member since:"})," ",new Date(r.created_at).toLocaleDateString()]}),r.last_login&&e.jsxs(g,{level:"body-sm",children:[e.jsx("strong",{children:"Last login:"})," ",new Date(r.last_login).toLocaleDateString()]}),e.jsxs(g,{level:"body-sm",children:[e.jsx("strong",{children:"User ID:"})," ",r.id]})]})]})]}),e.jsx(u,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:1,mt:3,justifyContent:{xs:"stretch",sm:"flex-end"}},children:i?e.jsxs(e.Fragment,{children:[e.jsx(U,{variant:"outlined",onClick:S,disabled:c,startDecorator:e.jsx(vo,{}),sx:{order:{xs:2,sm:1}},children:"Cancel"}),e.jsx(U,{variant:"solid",onClick:F,loading:c,startDecorator:e.jsx(ko,{}),sx:{order:{xs:1,sm:2}},children:"Save"})]}):e.jsx(U,{variant:"outlined",onClick:()=>a(!0),startDecorator:e.jsx(at,{}),children:"Edit Profile"})})]})]})]})})}function Pa(){const[s,t]=K.useState(""),[r,n]=K.useState(!0),[o,l]=K.useState(!1),i=`## Latest Release
**Version 2.1.2** - July 6, 2025

### Recent Updates
- Modern Login Page Redesign with Split Layout
- Glassmorphism effect with backdrop blur and semi-transparent backgrounds
- Dynamic mountain landscape background images that change with light/dark mode
- Dark/light mode toggle in login page header
- Company branding with SmartBack logo and name in header

### System Status
- All systems operational
- Database migrations up to date
- Authentication services active

*For complete release history, please check the development environment or contact support.*`;return K.useEffect(()=>{const a="/RELEASE_LOG.md";console.log("Fetching release log from:",a),fetch(a).then(c=>{if(console.log("Release log response status:",c.status,c.statusText),!c.ok)throw new Error(`Failed to fetch release log: ${c.status} ${c.statusText}`);return c.text()}).then(c=>{console.log("Release log loaded successfully, length:",c.length);const d=c.replace(/<!--[\s\S]*?-->/g,"").trim();t(d),l(!1)}).catch(c=>{console.error("Error fetching release log:",c),console.log("Using fallback content"),t(i),l(!1)}).finally(()=>n(!1))},[i]),e.jsx(ke,{sx:{height:"100%",minHeight:{xs:200,md:300}},children:e.jsxs(lt,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(en,{color:"primary"}),e.jsx(g,{level:"h4",children:"Release Log"})]}),e.jsxs(u,{sx:{flex:1,overflow:"auto"},children:[r&&e.jsx(g,{level:"body-sm",color:"neutral",children:"Loading release log..."}),!r&&e.jsx(u,{sx:{typography:"body-sm"},children:e.jsx("div",{dangerouslySetInnerHTML:{__html:Q(s)}})})]})]})})}function Ra(){return Ce(),e.jsx(ke,{sx:{height:"100%",minHeight:{xs:120,md:300}},children:e.jsxs(lt,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(Co,{color:"primary"}),e.jsx(g,{level:"h4",children:"Application Info"})]}),e.jsxs(Y,{spacing:1.5,sx:{flex:1},children:[e.jsxs(g,{level:"title-md",sx:{fontWeight:"bold"},children:["smartback".charAt(0).toUpperCase()+"smartback".slice(1)," business System"]}),e.jsxs(Y,{spacing:.5,children:[e.jsxs(g,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Environment:"})," ","production"]}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Version:"})," ","1.5.1"]}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Build Date:"})," ",new Date().toLocaleDateString()]}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Platform:"})," Web Application"]}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Currency:"})," ",Re.currency," (",Re.symbol,") - ",Re.locale]})]})]}),e.jsx(U,{component:"a",href:"https://nicklasfangerfisk.github.io/Testflow/",target:"_blank",rel:"noopener noreferrer",startDecorator:e.jsx(_o,{}),variant:"outlined",color:"primary",sx:{mt:2,alignSelf:"flex-start"},children:"System Test"})]})})}const Ea=()=>{const{isMobile:s}=Ce(),[t,r]=h.useState(0),n=async()=>{try{const{error:a}=await N.auth.signOut();a?console.error("Error signing out:",a):window.location.href="/login"}catch(a){console.error("Error during logout:",a)}},o=[{label:"User",icon:e.jsx(vt,{}),content:e.jsx(_a,{})},{label:"App",icon:e.jsx(So,{}),content:e.jsx(Ra,{})},{label:"Releases",icon:e.jsx(en,{}),content:e.jsx(Pa,{})}],l=()=>e.jsx(u,{sx:{width:"100%",minHeight:"100vh"},children:e.jsxs(je,{padding:"medium",children:[e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(g,{level:"h2",sx:{fontSize:X.sizes.xlarge},children:"My profile"}),e.jsx(U,{variant:"outlined",color:"danger",size:"sm",startDecorator:e.jsx(cr,{}),onClick:n,children:"Logout"})]}),e.jsxs(sr,{value:t,onChange:(a,c)=>r(typeof c=="number"?c:0),sx:{bgcolor:"transparent"},children:[e.jsx(rr,{sx:{bgcolor:"transparent"},children:o.map((a,c)=>e.jsx(nr,{value:c,sx:{bgcolor:"transparent"},children:a.label},c))}),o.map((a,c)=>e.jsx(or,{value:c,sx:{p:0,pt:3,bgcolor:"transparent"},children:a.content},c))]})]})}),i=()=>e.jsxs(je,{variant:"table-page",children:[e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(g,{level:"h2",sx:{fontSize:X.sizes.xlarge},children:"My profile"}),e.jsx(U,{variant:"outlined",color:"danger",startDecorator:e.jsx(cr,{}),onClick:n,children:"Logout"})]}),e.jsxs(sr,{value:t,onChange:(a,c)=>r(typeof c=="number"?c:0),sx:{bgcolor:"transparent"},children:[e.jsx(rr,{sx:{bgcolor:"transparent"},children:o.map((a,c)=>e.jsx(nr,{value:c,sx:{bgcolor:"transparent"},children:a.label},c))}),o.map((a,c)=>e.jsx(or,{value:c,sx:{p:0,pt:3,bgcolor:"transparent"},children:a.content},c))]})]});return e.jsx(qe,{children:s?e.jsx(l,{}):e.jsx(i,{})})};function Aa(){const s=Ms(),{isMobile:t}=Ce(),r=Ns(),[n,o]=h.useState("dashboard"),l=[{label:"Dashboard",icon:e.jsx(Os,{}),value:"dashboard"},{label:"Orders",icon:e.jsx(Is,{}),value:"orders"},{label:"Users",icon:e.jsx(Ts,{}),value:"users"},{label:"My Profile",icon:e.jsx(vt,{}),value:"profile"},{label:"Settings",icon:e.jsx(Po,{}),value:"settings"}];return h.useEffect(()=>{o({"/":"dashboard","/dashboard":"dashboard","/orders":"orders","/products":"dashboard","/users":"users","/suppliers":"dashboard","/purchase-orders":"dashboard","/tickets":"dashboard","/sms-campaigns":"dashboard","/movements":"dashboard","/settings":"profile"}[s.pathname]||"dashboard")},[s.pathname]),console.log("isMobile:",t),e.jsxs(u,{sx:{display:"flex",minHeight:"100vh"},children:[s.pathname!=="/login"&&!t&&e.jsx(No,{setView:i=>console.log(i),view:"home"}),e.jsxs(u,{component:"main",sx:{flexGrow:1,display:"flex",flexDirection:"column",minHeight:"100vh",bgcolor:"background.default",p:0,width:t?"100%":"calc(100% - var(--Sidebar-width, 240px))",marginBottom:t?"56px":0},children:[t&&s.pathname!=="/login"&&e.jsx(Ol,{items:l,value:n,onChange:i=>{o(i);const c={home:"/",dashboard:"/dashboard",orders:"/orders",products:"/products",users:"/users",suppliers:"/suppliers",purchaseorders:"/purchase-orders",tickets:"/tickets",smscampaigns:"/sms-campaigns",movements:"/movements",profile:"/settings",settings:"/settings"}[i]||`/${i}`;r(c)},toggleSidebar:()=>console.log("Sidebar toggled")}),e.jsxs(Fs,{children:[e.jsx(Se,{path:"/",element:e.jsx($t,{to:"/dashboard",replace:!0})}),e.jsx(Se,{path:"/orders",element:e.jsx(Me,{children:e.jsx(Bo,{})})}),e.jsx(Se,{path:"/products",element:e.jsx(Me,{children:e.jsx(Ho,{})})}),e.jsx(Se,{path:"/users",element:e.jsx(Me,{children:e.jsx(Jo,{})})}),e.jsx(Se,{path:"/suppliers",element:e.jsx(Me,{children:e.jsx(Ko,{})})}),e.jsx(Se,{path:"/purchase-orders",element:e.jsx(Me,{children:e.jsx(Dl,{})})}),e.jsx(Se,{path:"/tickets",element:e.jsx(Me,{children:e.jsx(zl,{})})}),e.jsx(Se,{path:"/sms-campaigns",element:e.jsx(Me,{children:e.jsx(Nl,{})})}),e.jsx(Se,{path:"/dashboard",element:e.jsx(Me,{children:e.jsx(Fl,{})})}),e.jsx(Se,{path:"/movements",element:e.jsx(Me,{children:e.jsx(Bl,{})})}),e.jsx(Se,{path:"/settings",element:e.jsx(Me,{children:e.jsx(Ea,{})})}),e.jsx(Se,{path:"*",element:e.jsx($t,{to:"/",replace:!0})})]})]})]})}function Da(){return e.jsx(Hr,{children:e.jsx(Eo,{children:e.jsxs(Fs,{children:[e.jsx(Se,{path:"/login/*",element:e.jsx(Ul,{})}),e.jsx(Se,{path:"/*",element:e.jsx(Aa,{})})]})})})}console.log("Mounting React app...");const Fr=document.getElementById("root");Fr?(Do.createRoot(Fr).render(e.jsx(Da,{})),console.log("React app rendered!")):console.error("No #root element found in index.html!");

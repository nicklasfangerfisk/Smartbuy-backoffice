import{b as Yr,u as Sr,r as u,j as e,I as pe,R as ae,d as Jr,e as At,B as i,G as Cr,T as a,f as N,L as is,h as as,i as os,k as ft,l as Ms,m as Kr,D as Ee,A as xe,M as Le,n as Te,o as Ue,p as wt,q as St,s as Ct,F as se,t as ee,S as je,v as F,w as q,x as Be,y as Nt,z as J,C as bt,E as we,H as ue,J as De,K as kr,N as jt,O as oe,P as cs,Q as Xr,U as el,V as tl,W as sl,X as Je,Y as Vt,Z as Ie,_ as ms,$ as gs,a0 as fs,a1 as We,a2 as $t,a3 as rl,a4 as ll,a5 as nl,a6 as il,a7 as al,a8 as ol,a9 as Ws,aa as cl,ab as dl,ac as ul,ad as qs,ae as hl,af as _r,ag as xl,ah as pl,ai as Fs,aj as Us,ak as Bs,al as Hs}from"./mui-core-jzIMPNSh.js";import{D as Dr,L as ml,H as gl,a as js,S as bs,b as Ir,G as ys,B as Pr,c as zr,A as Or,Q as Er,d as Mt,P as ot,E as Ve,W as Wt,e as fl,K as jl,f as be,g as xt,h as Gt,i as bl,j as yl,F as vl,C as Yt,k as kt,l as wl,m as Sl,n as Cl,o as kl,p as Se,q as vs,r as Vs,s as yt,t as Gs,u as _t,I as Ar,v as ct,w as Qs,x as dt,y as ws,M as Ss,z as Cs,J as Zs,N as ds,O as _l,R as Rr,T as Dl,U as Il,V as Ys,X as Pl,Y as zl,Z as Ol,_ as El,$ as Lr,a0 as Al,a1 as Rl,a2 as Ll,a3 as Tl,a4 as Nl,a5 as Js,a6 as $l,a7 as Tr,a8 as Ml,a9 as Wl,aa as ql,ab as Fl}from"./mui-icons-omvje8dW.js";import{c as Ul}from"./supabase-BGWZ6dh3.js";import{N as qt,u as ks,a as _s,R as Ds,b as _e,B as Bl}from"./router-C8FAV-pK.js";import{f as Jt}from"./utils-CSQe5d3I.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const d of s)if(d.type==="childList")for(const o of d.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const d={};return s.integrity&&(d.integrity=s.integrity),s.referrerPolicy&&(d.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?d.credentials="include":s.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function n(s){if(s.ep)return;s.ep=!0;const d=r(s);fetch(s.href,d)}})();var Pt={},Ks;function Hl(){if(Ks)return Pt;Ks=1;var l=Yr();return Pt.createRoot=l.createRoot,Pt.hydrateRoot=l.hydrateRoot,Pt}var Vl=Hl();function Gl(l){const{onClick:t,sx:r,...n}=l,{mode:s,setMode:d}=Sr(),[o,c]=u.useState(!1);return u.useEffect(()=>{c(!0)},[]),o?e.jsxs(pe,{"data-screenshot":"toggle-mode",size:"sm",variant:"outlined",color:"neutral",...n,onClick:x=>{d(s==="light"?"dark":"light"),t?.(x)},sx:[s==="dark"?{"& > *:first-of-type":{display:"none"}}:{"& > *:first-of-type":{display:"initial"}},s==="light"?{"& > *:last-of-type":{display:"none"}}:{"& > *:last-of-type":{display:"initial"}},...Array.isArray(r)?r:[r]],children:[e.jsx(Dr,{}),e.jsx(ml,{})]}):e.jsx(pe,{size:"sm",variant:"outlined",color:"neutral",...n,sx:r,disabled:!0})}const Nr="https://tfzvtzqybgbzxcxozdes.supabase.co",us="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRmenZ0enF5YmdienhjeG96ZGVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NTc2MDIsImV4cCI6MjA2MzQzMzYwMn0.hD2WdkvI8LY9N0IHP7HDQliyicQA0c-mspKjCJf0_Fc";console.log("[Supabase] URL:",Nr);console.log("[Supabase] Anon Key:",us.slice(0,6)+"..."+us.slice(-6));const $=Ul(Nr,us);$.auth.onAuthStateChange((l,t)=>{console.log("[Auth State Change]",l,t),l==="SIGNED_IN"?console.log("User signed in:",t?.user):l==="SIGNED_OUT"&&console.log("User signed out")});let Kt=!1;$.auth.onAuthStateChange((l,t)=>{Kt||(Kt=!0,console.log("[Auth State Change]",l,t),l==="SIGNED_IN"?console.log("User signed in:",t?.user):l==="SIGNED_OUT"&&(console.log("User signed out"),window.location.pathname!=="/login"&&(window.location.href="/login")),Kt=!1)});const Is=l=>t=>{const[r,n]=ae.useState(null),[s,d]=ae.useState(!0);return ae.useEffect(()=>{async function o(){const{data:c}=await $.auth.getSession();n(c?.session||null),d(!1)}o()},[]),s?e.jsx("div",{children:"Loading..."}):r?e.jsx(l,{...t}):e.jsx(qt,{to:"/login",replace:!0})},Ql=[{label:"Home",icon:ae.createElement(gl),value:"home",route:"/",showInMobile:!0},{label:"Dashboard",icon:ae.createElement(js),value:"dashboard",route:"/dashboard",showInMobile:!0},{label:"Orders",icon:ae.createElement(bs),value:"orders",route:"/orders",showInMobile:!0},{label:"Products",icon:ae.createElement(Ir),value:"products",route:"/products",showInMobile:!0},{label:"Customers",icon:ae.createElement(ys),value:"customers",route:"/customers",showInMobile:!0},{label:"Employees",icon:ae.createElement(Pr),value:"employees",route:"/employees",showInMobile:!0},{label:"Suppliers",icon:ae.createElement(zr),value:"suppliers",route:"/suppliers",showInMobile:!0},{label:"Purchase Orders",icon:ae.createElement(Or),value:"purchaseorders",route:"/purchase-orders",showInMobile:!0},{label:"Tickets",icon:ae.createElement(Er),value:"tickets",route:"/tickets",showInMobile:!0},{label:"SMS Campaigns",icon:ae.createElement(Mt),value:"smscampaigns",route:"/sms-campaigns",showInMobile:!0},{label:"Movements",icon:ae.createElement(Mt),value:"movements",route:"/movements",showInMobile:!0},{label:"My Profile",icon:ae.createElement(ot),value:"profile",route:"/settings",showInMobile:!0}],Rt={Sales:[{label:"Dashboard",icon:ae.createElement(js),value:"dashboard",route:"/dashboard",showInMobile:!0},{label:"Orders",icon:ae.createElement(bs),value:"orders",route:"/orders",showInMobile:!0},{label:"Storefronts",icon:ae.createElement(Wt),value:"storefronts",route:"/storefronts",showInMobile:!0},{label:"Customers",icon:ae.createElement(ys),value:"customers",route:"/customers",showInMobile:!0}],Support:[{label:"Tickets",icon:ae.createElement(Er),value:"tickets",route:"/tickets",showInMobile:!0}],Marketing:[{label:"Products",icon:ae.createElement(Ir),value:"products",route:"/products",showInMobile:!0},{label:"SMS Campaigns",icon:ae.createElement(Mt),value:"smscampaigns",route:"/sms-campaigns",showInMobile:!0}],Operations:[{label:"Suppliers",icon:ae.createElement(zr),value:"suppliers",route:"/suppliers",showInMobile:!0},{label:"Purchase Orders",icon:ae.createElement(Or),value:"purchaseorders",route:"/purchase-orders",showInMobile:!0},{label:"Movements",icon:ae.createElement(Mt),value:"movements",route:"/movements",showInMobile:!0}],Administration:[{label:"Employees",icon:ae.createElement(Pr),value:"employees",route:"/employees",showInMobile:!0},{label:"Email Settings",icon:ae.createElement(Ve),value:"emailsettings",route:"/email-settings",showInMobile:!0},{label:"My Profile",icon:ae.createElement(ot),value:"profile",route:"/settings",showInMobile:!0}]};function Pe(){const l=Jr(),t=At("(max-width:600px)"),r=At("(min-width:601px) and (max-width:1024px)"),n=At("(min-width:1025px)");return{isMobile:t,isTablet:r,isDesktop:n,isSmallScreen:t,isMediumScreen:r,isLargeScreen:n,breakpoints:{mobile:"600px",tablet:"1024px",desktop:"1025px"},theme:l}}function $r(){const{isMobile:l,isTablet:t}=Pe();return{containerPadding:l?1:t?2:3,sectionPadding:l?2:t?3:4,itemPadding:l?1:2,smallGap:l?1:2,mediumGap:l?2:3,largeGap:l?3:4,sectionMargin:l?2:3,itemMargin:l?1:2}}function Zl(){const{isMobile:l}=Pe();return{getModalSize:(r="medium")=>l?{width:"95vw",height:r==="fullscreen"?"95vh":"auto",maxHeight:"90vh",margin:1}:{small:{width:400,maxWidth:"90vw"},medium:{width:600,maxWidth:"90vw"},large:{width:800,maxWidth:"90vw"},fullscreen:{width:"90vw",height:"90vh"}}[r]}}function Yl({setView:l,view:t}){const r=ks(),n=_s(),{isMobile:s,isTablet:d,isDesktop:o}=Pe(),[c,x]=u.useState(!1),[m,y]=u.useState([]),[b,v]=u.useState(null),[S,f]=u.useState(null);u.useEffect(()=>{async function p(){const{data:O,error:B}=await $.from("users").select("*");!B&&O&&y(O)}p();async function k(O){if(v(O),O){let{data:B}=await $.from("users").select("*").eq("id",O.id).single();B||(await $.from("users").upsert({id:O.id,email:O.email,name:O.user_metadata?.full_name||null,avatar_url:O.user_metadata?.avatar_url||null,role:"employee"}),B={...O,role:"employee"}),f(B)}else f(null)}$.auth.getUser().then(({data:O})=>k(O.user));const{data:V}=$.auth.onAuthStateChange((O,B)=>{k(B?.user??null)});return()=>{V?.subscription.unsubscribe()}},[]),u.useEffect(()=>{d&&x(!0)},[d,o]);const w=p=>{r(p.route),l(p.value),d&&x(!0)},g=()=>{x(!c)},I=(p,k)=>{w({value:k,route:p})},C=p=>n.pathname===p;return e.jsxs(i,{className:"Sidebar",sx:{display:s?"none":"flex",position:{xs:"fixed",md:"sticky"},transform:{xs:"translateX(calc(100% * (var(--SideNavigation-slideIn, 0) - 1)))",md:"none"},transition:"transform 0.4s, width 0.4s",zIndex:1e4,height:"100vh",maxHeight:"100vh",minHeight:"100vh",width:"var(--Sidebar-width)",top:0,p:2,flexShrink:0,flexDirection:"column",gap:2,borderRight:"1px solid",borderColor:"divider",background:"var(--joy-palette-background-surface, #fff)",overflow:"hidden",boxSizing:"border-box"},children:[e.jsx(Cr,{styles:p=>({":root":{"--Sidebar-width":c?"60px":"220px",[p.breakpoints.up("lg")]:{"--Sidebar-width":c?"60px":"240px"}}})}),e.jsx(i,{className:"Sidebar-overlay",sx:{position:"fixed",zIndex:9998,top:0,left:0,width:"100vw",height:"100vh",opacity:"var(--SideNavigation-slideIn)",backgroundColor:"var(--joy-palette-background-backdrop)",transition:"opacity 0.4s",transform:{xs:"translateX(calc(100% * (var(--SideNavigation-slideIn, 0) - 1) + var(--SideNavigation-slideIn, 0) * var(--Sidebar-width, 0px)))",lg:"translateX(-100%)"}}}),e.jsxs(i,{sx:{display:"flex",gap:1,alignItems:"center",flexShrink:0},children:[e.jsx(pe,{size:"sm",variant:"plain",onClick:g,sx:{p:.5,borderRadius:1,"&:hover":{bgcolor:"neutral.100"}},children:e.jsx("img",{src:"/favicon.svg",alt:"Logo",style:{width:28,height:28,borderRadius:6}})}),!c&&e.jsxs(e.Fragment,{children:[e.jsx(a,{level:"title-lg",children:"Smartbuy"}),e.jsx(Gl,{sx:{ml:"auto"}})]})]}),!c&&e.jsx(i,{sx:{flexShrink:0},children:e.jsx(N,{size:"sm",startDecorator:e.jsx(fl,{}),placeholder:"Search"})}),e.jsx(i,{sx:{minHeight:0,overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",display:"flex",flexDirection:"column",[`& .${Kr.root}`]:{gap:1.5}},children:e.jsx(is,{size:"sm",sx:{gap:1,"--List-nestedInsetStart":"30px","--ListItem-radius":p=>p.vars.radius.sm},children:["Sales","Support","Operations","Marketing","Administration"].map(p=>e.jsx(as,{nested:!0,children:e.jsx(Jl,{defaultExpanded:!c,renderToggle:({open:k,setOpen:V})=>c?e.jsx(os,{title:p,placement:"right",arrow:!0,children:e.jsx(ft,{onClick:()=>V(!k),children:Rt[p][0]?.icon})}):e.jsxs(ft,{onClick:()=>V(!k),children:[Rt[p][0]?.icon,e.jsx(Ms,{children:e.jsx(a,{level:"title-sm",children:p})}),e.jsx(jl,{sx:[k?{transform:"rotate(180deg)"}:{transform:"none"}]})]}),children:e.jsx(is,{sx:{gap:.5},children:Rt[p].map(k=>e.jsx(as,{children:c?e.jsx(os,{title:k.label,placement:"right",arrow:!0,children:e.jsx(ft,{selected:C(k.route),onClick:()=>I(k.route,k.value),sx:{justifyContent:"center",px:1,width:"100%"},children:k.icon})}):e.jsxs(ft,{selected:C(k.route),onClick:()=>I(k.route,k.value),sx:{justifyContent:"flex-start",px:2,width:"100%"},children:[k.icon,e.jsx(Ms,{children:e.jsx(a,{level:"body-sm",children:k.label})})]})},k.value))})})},p))})}),e.jsx(i,{sx:{flexShrink:0}}),e.jsx(Ee,{sx:{flexShrink:0}}),e.jsxs(i,{sx:{display:"flex",gap:1,alignItems:"center",minHeight:48,flexShrink:0,cursor:"pointer",borderRadius:"sm","&:hover":{bgcolor:"neutral.50"}},onClick:()=>I("/settings","settings"),children:[e.jsx(xe,{variant:"outlined",size:"sm",src:S?.avatar_url||b?.user_metadata?.avatar_url||void 0,children:!S?.avatar_url&&!b?.user_metadata?.avatar_url&&(S?.first_name||S?.last_name?`${S.first_name?.[0]||""}${S.last_name?.[0]||""}`.toUpperCase():b?.user_metadata?.full_name?b.user_metadata.full_name.split(" ").map(p=>p[0]).slice(0,2).join("").toUpperCase():b?.email?b.email.substring(0,2).toUpperCase():"U")}),!c&&e.jsxs(i,{sx:{minWidth:0,flex:1},children:[e.jsx(a,{level:"title-sm",children:S?.first_name||S?.last_name?`${S.first_name||""} ${S.last_name||""}`.trim():b?.user_metadata?.full_name||b?.email||"Not signed in"}),e.jsx(a,{level:"body-xs",children:b?.email||""})]})]})]})}function Jl({defaultExpanded:l=!1,renderToggle:t,children:r}){const[n,s]=u.useState(l);return e.jsxs(u.Fragment,{children:[t({open:n,setOpen:s}),e.jsx(i,{sx:{display:"grid",transition:"0.2s ease","& > *":{overflow:"hidden"},gridTemplateRows:n?"1fr":"0fr"},children:r})]})}const Kl=Is(Yl);function ke({children:l,variant:t="page",padding:r="medium",fullHeight:n=!1,className:s}){const{isMobile:d}=Pe(),o=$r(),c=()=>r==="none"?0:{small:o.itemPadding,medium:o.containerPadding,large:o.sectionPadding}[r]||o.containerPadding,x=()=>{const m={p:c(),boxSizing:"border-box"};switch(t){case"page":return{...m,height:n?"100%":"auto",overflow:"auto",width:"100%"};case"dialog":return{...m,height:"auto",overflow:"visible"};case"form":return{...m,display:"flex",flexDirection:"column",gap:o.mediumGap};case"card":return{...m,borderRadius:1,bgcolor:"background.surface"};case"table-page":return{width:"100%",overflow:"visible",pt:d?1:2,pl:d?1:2,pr:d?1:2,pb:d?1:2,boxSizing:"border-box"};default:return m}};return e.jsx(i,{sx:x(),className:s,children:l})}function Ft({open:l,onClose:t,children:r,title:n,size:s="medium",showCloseButton:d=!0,actions:o}){const{getModalSize:c}=Zl();return e.jsx(Le,{open:l,onClose:t,children:e.jsxs(Te,{sx:c(s),children:[d&&e.jsx(Ue,{}),n&&e.jsx(wt,{children:n}),e.jsx(St,{children:r}),o&&e.jsx(Ct,{children:o})]})})}const Fe=({children:l})=>e.jsx(i,{sx:{display:"flex",flexDirection:"column",width:"100%",flex:1,bgcolor:"background.body"},children:l}),Ye={currency:"DKK",locale:"da-DK",symbol:"kr"};function qe(l){if(l==null||isNaN(l))return"0 kr";const t=l%1!==0;return new Intl.NumberFormat(Ye.locale,{style:"currency",currency:Ye.currency,minimumFractionDigits:t?2:0,maximumFractionDigits:2}).format(l)}function fe(l,t=!0){if(l==null||isNaN(l))return t?"0 kr":"kr 0";const r=l%1!==0,n=new Intl.NumberFormat(Ye.locale,{minimumFractionDigits:r?2:0,maximumFractionDigits:2}).format(l);return t?`${n} kr`:`kr ${n}`}function Xs(l){return{...l,salesprice_currency:Ye.currency,salesprice_exchrate:1,costprice_currency:Ye.currency,costprice_exchrate:1}}function Xl(l){return{...l,unit_price_currency:Ye.currency,unit_price_exchrate:1}}function en({open:l,onClose:t,order:r,mode:n="add",onSaved:s,fetchOrderItems:d}){const[o,c]=u.useState(""),[x,m]=u.useState(new Date().toISOString().slice(0,10)),[y,b]=u.useState("Draft"),[v,S]=u.useState(""),[f,w]=u.useState(""),[g,I]=u.useState(""),[C,p]=u.useState("0"),[k,V]=u.useState(0),[O,B]=u.useState(""),[j,z]=u.useState([{id:crypto.randomUUID(),product:null,quantity:1,unitprice:0,discount:0}]),[L,W]=u.useState([]),[Q,h]=u.useState([]),[A,H]=u.useState(!1),[E,P]=u.useState([]),[U,ne]=u.useState(!1),[he,ie]=u.useState(!1),[X,ce]=u.useState(!1),[Z,re]=u.useState(null),[T,K]=u.useState(null);u.useEffect(()=>{l&&r?(c(r.order_number||""),m(r.date||new Date().toISOString().slice(0,10)),b(r.status||"Draft"),w(r.customer_name||""),I(r.customer_email||""),p(r.total?String(r.total):"0"),V(r.discount||0),B(r.notes||""),S(r.storefront_id||"")):l&&n==="add"&&(c(ye()),m(new Date().toISOString().slice(0,10)),b("Draft"),w(""),I(""),p("0"),V(0),B(""),S(""),z([{id:crypto.randomUUID(),product:null,quantity:1,unitprice:0,discount:0}])),re(null)},[l,r,n]),u.useEffect(()=>{l&&(n==="edit"||n==="view")&&r?.uuid&&d&&(ce(!0),d(r.uuid).then(_=>{W(_)}).catch(_=>{console.error("Error loading order items:",_),re("Failed to load order items")}).finally(()=>ce(!1)))},[l,n,r,d]),u.useEffect(()=>{l&&(ne(!0),(async()=>{try{const{data:G,error:te}=await $.from("storefronts").select("id, name, is_online").eq("is_online",!0).order("name",{ascending:!0});!te&&G?P(G):console.error("Error loading storefronts:",te)}catch(G){console.error("Error loading storefronts:",G)}finally{ne(!1)}})())},[l]),u.useEffect(()=>{l&&(n==="add"||n==="edit")&&(H(!0),K(null),$.from("Products").select("*").then(({data:_,error:G})=>{!G&&_?(_.length===0&&K("No products available. Please add products first."),h(_.map(te=>({id:te.uuid||te.id,ProductName:te.ProductName,SalesPrice:te.SalesPrice??0})))):K("Failed to load products. Please try again later."),H(!1)}))},[l,n]);const ye=()=>{const _=new Date().toISOString().slice(0,10).replace(/-/g,""),G=Math.floor(1e3+Math.random()*9e3);return`ORD-${_}-${G}`},ve=()=>j.reduce((_,G)=>{const te=G.quantity*G.unitprice,$e=te*(G.discount/100);return _+(te-$e)},0);u.useEffect(()=>{if(n==="add"||n==="edit"){const _=ve(),G=_-_*(k/100);p(G.toFixed(2))}},[j,k,n]);const Ne=()=>{z([...j,{id:crypto.randomUUID(),product:null,quantity:1,unitprice:0,discount:0}])},Ke=_=>{j.length>1&&z(j.filter(G=>G.id!==_))},M=(_,G,te)=>{z(j.map($e=>$e.id===_?{...$e,[G]:te}:$e))},de=(_,G)=>{z(j.map(te=>te.id===_?{...te,product:G,unitprice:G?.SalesPrice||0}:te))},R=async()=>{if(!f.trim()||!g.trim()){re("Customer name and email are required");return}if(n==="add"&&j.filter(G=>G.product&&G.quantity>0).length===0){re("Please add at least one valid order item");return}ie(!0),re(null);try{const _={order_number:o,date:x,status:y,customer_name:f.trim(),customer_email:g.trim(),total:parseFloat(C),discount:k,notes:O.trim()||null,storefront_id:v||null};if(n==="edit"&&r?.id){const{error:G}=await $.from("Orders").update(_).eq("id",r.id);if(G)throw G}else if(n==="add"){const{data:G,error:te}=await $.from("Orders").insert([_]).select().single();if(te)throw te;if(G){const $e=j.filter(Ce=>Ce.product&&Ce.quantity>0).map(Ce=>({order_uuid:G.uuid,product_uuid:Ce.product.id,quantity:Ce.quantity,unitprice:Ce.unitprice,discount:Ce.discount,price:Ce.quantity*Ce.unitprice*(1-Ce.discount/100)}));if($e.length>0){const{error:Ce}=await $.from("OrderItems").insert($e);if(Ce)throw Ce}}}s&&s(),t()}catch(_){console.error("Error saving order:",_),re(_.message||"Failed to save order")}finally{ie(!1)}},Y=n==="view",D=n==="view";return e.jsx(Le,{open:l,onClose:t,children:e.jsxs(Te,{sx:{maxWidth:1200,width:"100%",maxHeight:"90vh",overflow:"auto"},children:[e.jsx(Ue,{}),e.jsx(a,{level:"title-lg",sx:{mb:2},children:n==="add"?"Create Order":n==="edit"?"Edit Order":"Order Details"}),e.jsxs(i,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:3,minHeight:"400px"},children:[e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(a,{level:"title-sm",children:"Order Information"}),e.jsxs(se,{children:[e.jsx(ee,{children:"Order Number"}),e.jsx(N,{value:o,onChange:_=>c(_.target.value),disabled:Y,placeholder:"Auto-generated"})]}),e.jsxs(se,{children:[e.jsx(ee,{children:"Date"}),e.jsx(N,{type:"date",value:x,onChange:_=>m(_.target.value),disabled:Y})]}),e.jsxs(se,{children:[e.jsx(ee,{children:"Status"}),e.jsxs(je,{value:y,onChange:(_,G)=>b(G),disabled:Y,children:[e.jsx(F,{value:"Draft",children:"Draft"}),e.jsx(F,{value:"Paid",children:"Paid"}),e.jsx(F,{value:"Refunded",children:"Refunded"}),e.jsx(F,{value:"Cancelled",children:"Cancelled"})]})]})]}),e.jsx(Ee,{}),e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(a,{level:"title-sm",children:"Customer Information"}),e.jsxs(se,{children:[e.jsx(ee,{children:"Customer Name"}),e.jsx(N,{value:f,onChange:_=>w(_.target.value),disabled:Y,placeholder:"Customer name",required:!0})]}),e.jsxs(se,{children:[e.jsx(ee,{children:"Customer Email"}),e.jsx(N,{type:"email",value:g,onChange:_=>I(_.target.value),disabled:Y,placeholder:"customer@example.com",required:!0})]}),e.jsxs(se,{children:[e.jsx(ee,{children:"Storefront"}),e.jsxs(je,{value:v,onChange:(_,G)=>S(G||""),disabled:Y||U,placeholder:"Select a storefront (optional)",children:[e.jsx(F,{value:"",children:"No specific storefront"}),E.map(_=>e.jsx(F,{value:_.id,children:_.name},_.id))]})]})]}),e.jsx(Ee,{}),e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(a,{level:"title-sm",children:"Order Summary"}),e.jsxs(se,{children:[e.jsx(ee,{children:"Order Discount (%)"}),e.jsx(N,{type:"number",value:k,onChange:_=>V(parseFloat(_.target.value)||0),disabled:Y,slotProps:{input:{min:0,max:100,step:.01}}})]}),e.jsxs(se,{children:[e.jsx(ee,{children:"Total Amount"}),e.jsx(N,{value:fe(parseFloat(C)),disabled:!0,sx:{fontWeight:"bold"}})]}),e.jsxs(se,{children:[e.jsx(ee,{children:"Notes"}),e.jsx(N,{value:O,onChange:_=>B(_.target.value),disabled:Y,placeholder:"Order notes (optional)"})]})]})]}),e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(a,{level:"title-sm",children:D?"Ordered Items":"Order Items"}),!Y&&e.jsx(q,{startDecorator:e.jsx(be,{}),onClick:Ne,size:"sm",variant:"outlined",children:"Add Item"})]}),D?X?e.jsx(a,{children:"Loading items..."}):e.jsxs(Be,{size:"sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{style:{textAlign:"right"},children:"Qty"}),e.jsx("th",{style:{textAlign:"right"},children:"Price"}),e.jsx("th",{style:{textAlign:"right"},children:"Disc %"}),e.jsx("th",{style:{textAlign:"right"},children:"Total"})]})}),e.jsx("tbody",{children:L.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{textAlign:"center",padding:"16px"},children:e.jsx(a,{level:"body-sm",color:"neutral",children:"No items found for this order."})})}):L.map((_,G)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(a,{level:"body-sm",sx:{fontWeight:"bold"},children:_.ProductName||_.name||_.product_uuid})}),e.jsx("td",{style:{textAlign:"right"},children:e.jsx(a,{level:"body-sm",children:_.quantity})}),e.jsx("td",{style:{textAlign:"right"},children:e.jsx(a,{level:"body-sm",children:typeof _.unitprice=="number"||typeof _.unitprice=="string"?fe(Number(_.unitprice)):"-"})}),e.jsx("td",{style:{textAlign:"right"},children:e.jsx(a,{level:"body-sm",children:typeof _.discount=="number"||typeof _.discount=="string"?`${Number(_.discount).toFixed(1)}%`:"-"})}),e.jsx("td",{style:{textAlign:"right"},children:e.jsx(a,{level:"body-sm",sx:{fontWeight:"bold"},children:typeof _.price=="number"||typeof _.price=="string"?fe(Number(_.price)):"-"})})]},_.id||_.uuid||G))})]}):e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2},children:[T&&e.jsx(a,{color:"warning",level:"body-sm",children:T}),e.jsx(i,{sx:{display:"flex",flexDirection:"column",gap:1,maxHeight:"400px",overflowY:"auto"},children:j.map(_=>e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:1,p:2,border:"1px solid",borderColor:"divider",borderRadius:"sm",bgcolor:"background.surface"},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(a,{level:"body-sm",sx:{fontWeight:"bold"},children:["Item ",j.indexOf(_)+1]}),e.jsx(pe,{onClick:()=>Ke(_.id),disabled:j.length===1,color:"danger",size:"sm",children:e.jsx(xt,{})})]}),e.jsx(Nt,{placeholder:"Select product",options:Q,getOptionLabel:G=>G.ProductName,value:_.product,onChange:(G,te)=>de(_.id,te),loading:A,size:"sm"}),e.jsxs(i,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:1},children:[e.jsxs(i,{children:[e.jsx(ee,{sx:{fontSize:"xs"},children:"Quantity"}),e.jsx(N,{type:"number",value:_.quantity,onChange:G=>M(_.id,"quantity",parseInt(G.target.value)||0),size:"sm",slotProps:{input:{min:1}}})]}),e.jsxs(i,{children:[e.jsx(ee,{sx:{fontSize:"xs"},children:"Unit Price"}),e.jsx(N,{type:"number",value:_.unitprice,onChange:G=>M(_.id,"unitprice",parseFloat(G.target.value)||0),size:"sm",slotProps:{input:{min:0,step:.01}}})]}),e.jsxs(i,{children:[e.jsx(ee,{sx:{fontSize:"xs"},children:"Discount %"}),e.jsx(N,{type:"number",value:_.discount,onChange:G=>M(_.id,"discount",parseFloat(G.target.value)||0),size:"sm",slotProps:{input:{min:0,max:100,step:.01}}})]})]}),_.product&&_.quantity>0&&e.jsx(i,{sx:{textAlign:"right",pt:1,borderTop:"1px solid",borderColor:"divider"},children:e.jsxs(a,{level:"body-sm",sx:{fontWeight:"bold"},children:["Item Total: ",fe(_.quantity*_.unitprice*(1-_.discount/100))]})})]},_.id))})]})]})]}),Z&&e.jsx(i,{sx:{mt:2},children:e.jsx(a,{color:"danger",level:"body-sm",children:Z})}),e.jsxs(i,{sx:{display:"flex",gap:2,justifyContent:"flex-end",mt:3,pt:2,borderTop:"1px solid",borderColor:"divider"},children:[e.jsx(q,{variant:"plain",onClick:t,disabled:he,children:Y?"Close":"Cancel"}),r&&r.status==="Paid"&&r.customer_email&&e.jsx(q,{variant:"outlined",color:"primary",onClick:async()=>{try{const G=await(await fetch("/api/resend-order-confirmation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderUuid:r.uuid,resendEmail:!0})})).json();G.success?alert("Confirmation email sent successfully!"):alert("Failed to send email: "+G.error)}catch(_){alert("Error sending email: "+_.message)}},disabled:he,children:"Resend Email"}),!Y&&e.jsx(q,{onClick:R,loading:he,disabled:!f.trim()||!g.trim(),children:n==="edit"?"Update Order":"Create Order"})]})]})})}function tn({customerInfo:l,onChange:t,onLogin:r}){const n=d=>o=>{t({...l,[d]:o.target.value})},s=()=>{r?r():console.log("Login functionality not available in this app")};return e.jsx(i,{sx:{width:"100%"},children:e.jsxs(J,{spacing:3,sx:{width:"100%"},children:[e.jsxs(i,{sx:{textAlign:"center"},children:[e.jsx(a,{level:"body-sm",color:"neutral",sx:{mb:2},children:"Already have an account? Sign in to auto-fill your information"}),e.jsx(q,{variant:"outlined",startDecorator:e.jsx(Gt,{}),onClick:s,disabled:!r,sx:{minWidth:150},children:"Login"})]}),e.jsx(Ee,{sx:{my:1},children:e.jsx(a,{level:"body-xs",color:"neutral",children:"or continue as guest"})}),e.jsxs(i,{children:[e.jsx(a,{level:"h4",sx:{mb:3},children:"Contact"}),e.jsxs(J,{spacing:2,children:[e.jsxs(se,{required:!0,children:[e.jsx(ee,{children:"Email *"}),e.jsx(N,{type:"email",value:l.email,onChange:n("email"),placeholder:"Enter email",variant:"outlined"})]}),e.jsxs(se,{children:[e.jsx(ee,{children:"Phone Number *"}),e.jsx(N,{value:l.phone||"",onChange:n("phone"),placeholder:"Enter phone number",variant:"outlined"})]}),e.jsx(bt,{checked:l.newsletter||!1,onChange:d=>t({...l,newsletter:d.target.checked}),label:"I would like to receive newsletters",sx:{mt:1}})]})]}),e.jsxs(i,{children:[e.jsx(a,{level:"h4",sx:{mb:3},children:"Address"}),e.jsxs(J,{spacing:2,children:[e.jsxs(we,{container:!0,spacing:2,sx:{width:"100%",m:0},children:[e.jsx(we,{xs:12,md:6,children:e.jsxs(se,{required:!0,children:[e.jsx(ee,{children:"First Name *"}),e.jsx(N,{value:l.firstName||"",onChange:n("firstName"),placeholder:"Enter first name",variant:"outlined"})]})}),e.jsx(we,{xs:12,md:6,children:e.jsxs(se,{required:!0,children:[e.jsx(ee,{children:"Last Name *"}),e.jsx(N,{value:l.lastName||"",onChange:n("lastName"),placeholder:"Enter last name",variant:"outlined"})]})})]}),e.jsx(we,{container:!0,spacing:2,sx:{width:"100%",m:0},children:e.jsx(we,{xs:12,children:e.jsxs(se,{required:!0,children:[e.jsx(ee,{children:"Address*"}),e.jsx(N,{value:l.address||"",onChange:n("address"),placeholder:"Enter address and house number",variant:"outlined"})]})})}),e.jsxs(we,{container:!0,spacing:2,sx:{width:"100%",m:0},children:[e.jsx(we,{xs:12,md:4,children:e.jsxs(se,{required:!0,children:[e.jsx(ee,{children:"Postal Code *"}),e.jsx(N,{value:l.postalCode||"",onChange:n("postalCode"),placeholder:"Enter postal code",variant:"outlined"})]})}),e.jsx(we,{xs:12,md:8,children:e.jsxs(se,{required:!0,children:[e.jsx(ee,{children:"City *"}),e.jsx(N,{value:l.city||"",onChange:n("city"),placeholder:"Enter city",variant:"outlined"})]})})]}),e.jsxs(se,{children:[e.jsx(ee,{children:"Reference"}),e.jsx(N,{value:l.reference||"",onChange:n("reference"),placeholder:"Reference/employee number",variant:"outlined"})]}),e.jsxs(J,{spacing:1,sx:{mt:2},children:[e.jsx(bt,{label:"Log me in so I can easily shop again",sx:{fontSize:"sm"}}),e.jsx(bt,{label:"The addess is not my home address",sx:{fontSize:"sm"}})]})]})]})]})})}const er=[{value:"standard",label:"Standard Delivery",description:"5-7 business days",cost:99,icon:e.jsx(bl,{})},{value:"express",label:"Express Delivery",description:"2-3 business days",cost:199,icon:e.jsx(yl,{})},{value:"overnight",label:"Overnight Delivery",description:"Next business day",cost:349,icon:e.jsx(vl,{})}];function sn({deliveryInfo:l,onChange:t,subtotal:r=0}){const s=r>=1e3,d=(c,x)=>x==="standard"&&s?0:c,o=c=>{const x=er.find(y=>y.value===c),m=d(x?.cost||0,c);t({...l,method:c,cost:m,estimatedDays:c==="overnight"?1:c==="express"?3:6})};return e.jsx(ue,{variant:"outlined",children:e.jsxs(De,{children:[e.jsx(a,{level:"h4",sx:{mb:2},children:"Delivery Method"}),(()=>{const c=Math.max(0,1e3-r),x=Math.min(100,r/1e3*100);return r<1e3?e.jsxs(i,{sx:{mb:3,p:2,backgroundColor:"neutral.50",borderRadius:"sm"},children:[e.jsxs(a,{level:"body-sm",sx:{mb:1,fontWeight:600},children:["ðŸšš Spend ",fe(c)," more for free standard shipping"]}),e.jsx(i,{sx:{position:"relative",width:"100%",height:8,backgroundColor:"#e5e5e5",borderRadius:4,overflow:"hidden",border:"1px solid #d4d4d8"},children:e.jsx(i,{sx:{position:"absolute",top:0,left:0,width:`${x}%`,height:"100%",backgroundColor:"#22c55e",borderRadius:3,transition:"width 0.3s ease-in-out"}})}),e.jsxs(a,{level:"body-xs",color:"neutral",sx:{mt:.5},children:[fe(r)," of ",fe(1e3)]})]}):e.jsx(i,{sx:{mb:3,p:2,backgroundColor:"success.50",borderRadius:"sm"},children:e.jsx(a,{level:"body-sm",color:"success",sx:{fontWeight:600},children:"ðŸŽ‰ You qualify for free standard shipping!"})})})(),e.jsx(kr,{value:l.method,onChange:c=>o(c.target.value),children:e.jsx(J,{spacing:2,children:er.map(c=>e.jsx(ue,{variant:l.method===c.value?"soft":"outlined",sx:{cursor:"pointer",transition:"all 0.2s","&:hover":{boxShadow:"sm"}},onClick:()=>o(c.value),children:e.jsxs(De,{children:[e.jsx(jt,{value:c.value,sx:{display:"none"}}),e.jsxs(J,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(i,{sx:{color:"primary.500"},children:c.icon}),e.jsxs(i,{sx:{flex:1},children:[e.jsx(a,{level:"title-md",children:c.label}),e.jsx(a,{level:"body-sm",sx:{color:"text.secondary"},children:c.description})]}),e.jsx(i,{children:(()=>{const x=d(c.cost,c.value),m=c.cost;return x===0&&m>0?e.jsxs(J,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(oe,{variant:"soft",color:"success",children:"Free"}),e.jsx(a,{level:"body-xs",sx:{textDecoration:"line-through",color:"text.secondary"},children:qe(m)})]}):x>0?e.jsx(oe,{variant:"soft",color:"primary",children:qe(x)}):e.jsx(oe,{variant:"soft",color:"success",children:"Free"})})()})]})]})},c.value))})})]})})}const rn=({sx:l})=>e.jsx(i,{component:"img",src:"/mobilepay-icon.svg",alt:"MobilePay",sx:{width:24,height:24,...l}});function ln({paymentInfo:l,onChange:t}){const r=s=>{t({...l,method:s,cardNumber:s==="card"?l.cardNumber:"",cardHolder:s==="card"?l.cardHolder:"",expiryDate:s==="card"?l.expiryDate:"",cvv:s==="card"?l.cvv:"",bankAccount:"",routingNumber:""})},n=s=>d=>{let o=d.target.value;s==="cardNumber"&&(o=o.replace(/\s/g,"").replace(/(\d{4})/g,"$1 ").trim(),o.length>19&&(o=o.substring(0,19))),s==="expiryDate"&&(o=o.replace(/\D/g,""),o.length>=2&&(o=o.substring(0,2)+"/"+o.substring(2,4)),o.length>5&&(o=o.substring(0,5))),s==="cvv"&&(o=o.replace(/\D/g,"").substring(0,3)),t({...l,[s]:o})};return e.jsx(i,{sx:{width:"100%"},children:e.jsxs(J,{spacing:3,sx:{width:"100%"},children:[e.jsxs(se,{children:[e.jsx(ee,{children:"Select Payment Method"}),e.jsx(kr,{value:l.method,onChange:s=>r(s.target.value),children:e.jsxs(J,{spacing:2,children:[e.jsx(ue,{variant:l.method==="card"?"solid":"outlined",color:l.method==="card"?"primary":"neutral",sx:{cursor:"pointer"},onClick:()=>r("card"),children:e.jsx(De,{children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(jt,{value:"card"}),e.jsxs(i,{children:[e.jsx(a,{level:"title-sm",children:"Cards"}),e.jsx(i,{sx:{display:"flex",justifyContent:"center",mt:1},children:e.jsx(Yt,{sx:{fontSize:32}})})]})]})})}),e.jsx(ue,{variant:l.method==="mobilepay"?"solid":"outlined",color:l.method==="mobilepay"?"primary":"neutral",sx:{cursor:"pointer"},onClick:()=>r("mobilepay"),children:e.jsx(De,{children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(jt,{value:"mobilepay"}),e.jsxs(i,{children:[e.jsx(a,{level:"title-sm",children:"MobilePay"}),e.jsx(i,{sx:{display:"flex",justifyContent:"center",mt:1},children:e.jsx(rn,{sx:{width:32,height:32}})})]})]})})}),e.jsx(ue,{variant:l.method==="viabill"?"solid":"outlined",color:l.method==="viabill"?"primary":"neutral",sx:{cursor:"pointer"},onClick:()=>r("viabill"),children:e.jsx(De,{children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(jt,{value:"viabill"}),e.jsxs(i,{children:[e.jsx(a,{level:"title-sm",children:"Apple Pay / Google Pay"}),e.jsxs(i,{sx:{display:"flex",justifyContent:"center",gap:2,mt:1},children:[e.jsx(i,{component:"span",sx:{fontWeight:700,fontSize:18,color:"#000",px:1,borderRadius:1,background:"#fff",border:"1px solid #eee"},children:"ï£¿ Pay"}),e.jsx(i,{component:"span",sx:{fontWeight:700,fontSize:18,color:"#4285F4",px:1,borderRadius:1,background:"#fff",border:"1px solid #eee"},children:"G Pay"})]})]})]})})}),e.jsx(ue,{variant:l.method==="international"?"solid":"outlined",color:l.method==="international"?"primary":"neutral",sx:{cursor:"pointer"},onClick:()=>r("international"),children:e.jsx(De,{children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(jt,{value:"international"}),e.jsxs(i,{children:[e.jsx(a,{level:"title-sm",children:"International Credit Cards"}),e.jsx(i,{sx:{display:"flex",justifyContent:"center",mt:1},children:e.jsx(Yt,{sx:{fontSize:32}})})]})]})})})]})})]}),l.method==="card"&&e.jsx(ue,{variant:"outlined",children:e.jsx(De,{children:e.jsxs(J,{spacing:2,children:[e.jsxs(se,{required:!0,children:[e.jsx(ee,{children:"Card Number"}),e.jsx(N,{value:l.cardNumber||"",onChange:n("cardNumber"),placeholder:"1234 5678 9012 3456",startDecorator:e.jsx(Yt,{})})]}),e.jsxs(se,{required:!0,children:[e.jsx(ee,{children:"Cardholder Name"}),e.jsx(N,{value:l.cardHolder||"",onChange:n("cardHolder"),placeholder:"John Doe"})]}),e.jsxs(we,{container:!0,spacing:2,sx:{width:"100%",m:0},children:[e.jsx(we,{xs:8,children:e.jsxs(se,{required:!0,children:[e.jsx(ee,{children:"Expiry Date"}),e.jsx(N,{value:l.expiryDate||"",onChange:n("expiryDate"),placeholder:"MM/YY"})]})}),e.jsx(we,{xs:4,children:e.jsxs(se,{required:!0,children:[e.jsx(ee,{children:"CVV"}),e.jsx(N,{value:l.cvv||"",onChange:n("cvv"),placeholder:"123",type:"password"})]})})]})]})})})]})})}async function nn(l,t){const r=await fetch("/api/send-order-confirmation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderUuid:l,storefront_id:t})});if(!r.ok){const n=await r.json().catch(()=>({}));throw new Error(n.error||`HTTP error! status: ${r.status}`)}}async function an(l,t){try{const{data:r,error:n}=await $.from("Orders").select("*").eq("uuid",l).single();if(n||!r)return{success:!1,error:"Order not found"};const s={status:"Paid"};t?.name&&(s.customer_name=t.name),t?.email&&(s.customer_email=t.email);const{error:d}=await $.from("Orders").update(s).eq("uuid",l);if(d)return{success:!1,error:d.message};const{data:o,error:c}=await $.from("OrderItems").select("product_uuid, quantity").eq("order_uuid",l);if(!c&&o&&o.length>0){const m=o.filter(y=>y.product_uuid).map(y=>({product_id:y.product_uuid,movement_type:"outgoing",quantity:y.quantity,date:new Date().toISOString(),reason:"Order Fulfillment",referenceuuid:l}));if(m.length>0){const{error:y}=await $.from("stock_movements").insert(m);y&&console.warn("Failed to create stock movements:",y)}}if(t?.email||r.customer_email)try{await nn(l,r.storefront_id)}catch(m){console.warn("Failed to send confirmation email:",m)}return{success:!0}}catch(r){return console.error("Error completing order:",r),{success:!1,error:r.message}}}const Xt=[{label:"Contact"},{label:"Delivery"},{label:"Payment"}];function on({open:l,onClose:t,order:r,onSuccess:n}){const[s,d]=u.useState(0),[o,c]=u.useState([]),[x,m]=u.useState(!1),[y,b]=u.useState({name:r?.customer_name||"",email:r?.customer_email||"",phone:"",address:"",city:"",postalCode:"",country:"USA",firstName:"",lastName:"",newsletter:!1,reference:""}),[v,S]=u.useState({method:"standard"}),[f,w]=u.useState({method:"card",cardNumber:"",cardHolder:"",expiryDate:"",cvv:""}),[g,I]=u.useState(!1),[C,p]=u.useState(null),[k,V]=u.useState(!1);u.useEffect(()=>{l&&r&&(O(),d(0),V(!1),p(null),b(A=>{const H=r.customer_name||A.name,E=H.split(" ");return{...A,name:H,firstName:E[0]||"",lastName:E.slice(1).join(" ")||"",email:r.customer_email||A.email}}))},[l,r]);const O=async()=>{if(r){I(!0);try{const{data:A,error:H}=await $.from("OrderItems").select(`
          uuid,
          product_uuid,
          quantity,
          unitprice,
          discount,
          Products:product_uuid(ProductName)
        `).eq("order_uuid",r.uuid);if(H)throw H;const E=A?.map(P=>({...P,ProductName:P.Products?.ProductName||"Unknown Product"}))||[];c(E)}catch(A){p(A.message||"Failed to load order items")}finally{I(!1)}}},B=()=>{s<Xt.length-1?d(s+1):z()},j=()=>{d(s-1)},z=async()=>{if(r){I(!0),p(null);try{const A=y.firstName&&y.lastName?`${y.firstName} ${y.lastName}`:y.name||"",H=await an(r.uuid,{name:A,email:y.email});if(!H.success)throw new Error(H.error||"Failed to complete order");V(!0),setTimeout(()=>{n(),t()},2e3)}catch(A){p(A.message||"Failed to complete order")}finally{I(!1)}}},L=A=>{switch(A){case 0:return!!(y.email?.trim()&&y.phone?.trim()&&y.firstName?.trim()&&y.lastName?.trim()&&y.address?.trim()&&y.city?.trim()&&y.postalCode?.trim());case 1:return!0;case 2:return f.method==="card"?!!(f.cardNumber?.replace(/\s/g,"").length===16&&f.cardHolder?.trim()&&f.expiryDate?.length===5&&f.cvv?.length===3):!0;default:return!1}},W=A=>{switch(A){case 0:return e.jsx(tn,{customerInfo:y,onChange:b});case 1:return e.jsx(sn,{deliveryInfo:v,onChange:S,subtotal:Q()});case 2:return e.jsx(ln,{paymentInfo:f,onChange:w});default:return null}},Q=()=>{const A=o.reduce((E,P)=>{const U=(P.unitprice||0)*P.quantity,ne=(P.discount||0)*P.quantity;return E+U-ne},0),H=r?.discount||0;return A-H},h=()=>{const A=Q(),H=v.cost||0;return A+H};return r?e.jsx(Le,{open:l,onClose:t,sx:{display:"flex",justifyContent:"center",alignItems:"center",p:{xs:0,md:2},zIndex:10001},children:e.jsxs(Te,{size:"lg",sx:{width:{xs:"100vw",md:"90vw"},maxWidth:{xs:"none",md:1e3},height:{xs:"100vh",md:"90vh"},maxHeight:{xs:"none",md:750},overflow:"hidden",display:"flex",flexDirection:"column",m:0,borderRadius:{xs:0,md:"md"},p:0},children:[e.jsx(i,{sx:{display:{xs:"none",md:"flex"},justifyContent:"flex-end",alignItems:"center",p:2,borderBottom:"1px solid",borderColor:"divider"},children:e.jsx(Ue,{})}),e.jsx(i,{sx:{display:{xs:"flex",md:"none"},justifyContent:"flex-end",alignItems:"center",p:1,position:"absolute",top:0,right:0,zIndex:1e3,backgroundColor:"background.surface"},children:e.jsx(Ue,{})}),k?e.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",gap:2,p:3},children:[e.jsx(kt,{sx:{fontSize:80,color:"success.main"}}),e.jsx(a,{level:"h2",children:"Order Completed!"}),e.jsxs(a,{level:"body-lg",textAlign:"center",color:"neutral",children:["Thank you for your order! Order #",r.order_number_display," has been processed successfully."]})]}):e.jsxs(i,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},height:"100%",overflow:"hidden"},children:[e.jsxs(i,{sx:{display:{xs:"block",md:"none"},borderBottom:"1px solid",borderColor:"divider"},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:2,pr:6},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(a,{level:"title-md",children:"Order Summary"}),e.jsx(a,{level:"body-sm",color:"primary",children:fe(h())})]}),e.jsx(q,{variant:"plain",size:"sm",onClick:()=>m(!x),sx:{minWidth:"auto",p:1},children:x?e.jsx(wl,{}):e.jsx(Sl,{})})]}),x&&e.jsxs(i,{sx:{p:2,backgroundColor:"background.level1",animation:"fadeIn 0.2s ease-in-out","@keyframes fadeIn":{from:{opacity:0,transform:"translateY(-10px)"},to:{opacity:1,transform:"translateY(0)"}}},children:[e.jsxs(a,{level:"body-sm",color:"neutral",sx:{mb:2},children:["Order #",r.order_number_display]}),g?e.jsx(i,{sx:{display:"flex",justifyContent:"center",my:2},children:e.jsx(cs,{size:"sm"})}):e.jsx(J,{spacing:1,sx:{mb:2},children:o.map(A=>e.jsxs(i,{sx:{py:.5},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",mb:.5},children:[e.jsx(a,{level:"body-sm",sx:{fontWeight:600},children:A.ProductName}),e.jsx(a,{level:"body-sm",sx:{fontWeight:600},children:fe((A.unitprice||0)*A.quantity-(A.discount||0)*A.quantity)})]}),e.jsxs(a,{level:"body-xs",color:"neutral",children:["Qty: ",A.quantity," Ã— ",fe(A.unitprice||0)]})]},A.uuid))}),e.jsx(Ee,{sx:{my:1}}),e.jsxs(J,{spacing:.5,children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(a,{level:"body-xs",children:"Shipping"}),e.jsx(a,{level:"body-xs",children:fe(v.cost||0)})]}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(a,{level:"body-xs",children:"VAT included"}),e.jsx(a,{level:"body-xs",children:fe(o.reduce((A,H)=>A+(H.unitprice||0)*H.quantity,0)*.2)})]})]}),e.jsx(Ee,{sx:{my:1}}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(a,{level:"title-sm",sx:{fontWeight:700},children:"Total:"}),e.jsx(a,{level:"title-sm",sx:{fontWeight:700,color:"primary.main"},children:fe(h())})]})]})]}),e.jsxs(i,{sx:{display:{xs:"none",md:"block"},width:{md:"350px"},borderRight:"1px solid",borderColor:"divider",p:3,overflow:"auto"},children:[e.jsx(a,{level:"h4",sx:{mb:2},children:"Summary"}),e.jsxs(a,{level:"body-sm",color:"neutral",sx:{mb:2},children:["Order #",r.order_number_display]}),g?e.jsx(i,{sx:{display:"flex",justifyContent:"center",my:3},children:e.jsx(cs,{})}):e.jsx(J,{spacing:1,sx:{mb:3},children:o.map(A=>e.jsxs(i,{sx:{py:1},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",mb:.5},children:[e.jsx(a,{level:"body-sm",sx:{fontWeight:600},children:A.ProductName}),e.jsx(a,{level:"body-sm",sx:{fontWeight:600},children:fe((A.unitprice||0)*A.quantity-(A.discount||0)*A.quantity)})]}),e.jsxs(a,{level:"body-xs",color:"neutral",children:["Qty: ",A.quantity," Ã— ",fe(A.unitprice||0),(A.discount||0)>0&&e.jsxs(i,{component:"span",sx:{color:"warning.main",ml:1},children:["(",A.discount,"% off)"]})]})]},A.uuid))}),e.jsx(Ee,{sx:{my:2}}),e.jsxs(J,{spacing:.5,children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(a,{level:"body-sm",children:"Shipping: Delivery to your door"}),e.jsx(a,{level:"body-sm",children:fe(v.cost||0)})]}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(a,{level:"body-sm",children:"Subtotal:"}),e.jsx(a,{level:"body-sm",children:fe(o.reduce((A,H)=>A+(H.unitprice||0)*H.quantity,0))})]}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(a,{level:"body-sm",children:"VAT included:"}),e.jsx(a,{level:"body-sm",children:fe(o.reduce((A,H)=>A+(H.unitprice||0)*H.quantity,0)*.2)})]})]}),e.jsx(Ee,{sx:{my:1}}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(a,{level:"title-md",sx:{fontWeight:700},children:"Total:"}),e.jsx(a,{level:"title-md",sx:{fontWeight:700,color:"primary.main"},children:fe(h())})]})]}),e.jsxs(i,{sx:{flex:1,display:"flex",flexDirection:"column",minHeight:0,overflow:"hidden"},children:[e.jsx(i,{sx:{p:{xs:1,md:3},pb:{xs:1,md:2},borderBottom:"1px solid",borderColor:"divider",flexShrink:0},children:e.jsx(Xr,{sx:{mb:0},children:Xt.map((A,H)=>e.jsx(el,{indicator:e.jsx(sl,{variant:s===H||s>H?"solid":"outlined",color:s>H?"success":"primary",sx:{width:{xs:8,md:12},height:{xs:8,md:12},minWidth:{xs:8,md:12},fontSize:0,"--StepIndicator-size":{xs:"8px",md:"12px"}}}),children:e.jsx(tl,{onClick:()=>d(H),children:e.jsx(a,{level:"body-sm",sx:{fontSize:{xs:"0.75rem",md:"0.875rem"}},children:A.label})})},A.label))})}),C&&e.jsx(i,{sx:{p:{xs:1,md:3},pt:0,flexShrink:0},children:e.jsx(Je,{color:"danger",children:C})}),e.jsx(i,{sx:{flex:1,overflow:"auto",p:{xs:1,md:3},pt:{xs:2,md:3},minHeight:0},children:W(s)}),e.jsxs(i,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},justifyContent:{xs:"stretch",md:s===0?"flex-end":"space-between"},p:{xs:1,md:3},borderTop:"1px solid",borderColor:"divider",gap:{xs:1,md:2},backgroundColor:"background.surface",flexShrink:0,position:{xs:"sticky",md:"static"},bottom:0,zIndex:1e4},children:[e.jsx(q,{variant:"solid",endDecorator:e.jsx(Cl,{}),onClick:B,loading:g,disabled:!L(s)||g,size:"lg",sx:{width:{xs:"100%",md:"auto"},minHeight:"48px",order:{xs:1,md:2},fontWeight:600},children:s===Xt.length-1?"Approve and pay":"Next"}),s>0&&e.jsx(q,{variant:"outlined",startDecorator:e.jsx(kl,{}),onClick:j,size:"lg",sx:{width:{xs:"100%",md:"auto"},minHeight:"48px",order:{xs:2,md:1}},children:"Back"})]})]})]})]})}):null}const le={sizes:{small:"0.875rem",xlarge:"1.5rem"}},Ae={fontSize:le.sizes.small},cn=()=>{const{isMobile:l}=Pe(),[t,r]=u.useState([]),[n,s]=u.useState(!1),[d,o]=u.useState(""),[c,x]=u.useState(""),[m,y]=u.useState(""),[b,v]=u.useState(""),[S,f]=u.useState(!1),[w,g]=u.useState(!1),[I,C]=u.useState(!1),[p,k]=u.useState(null),[V,O]=u.useState("add"),[B,j]=u.useState(!1),[z,L]=u.useState(!1),[W,Q]=u.useState(""),[h,A]=u.useState("success"),H=(D,_="success")=>{Q(D),A(_),L(!0)},E=D=>{switch(D){case"Draft":return"neutral";case"Paid":return"success";case"Refunded":return"warning";case"Cancelled":return"danger";default:return"neutral"}},P=D=>{switch(D){case"Draft":return e.jsx(yt,{});case"Paid":return e.jsx(Gs,{});case"Refunded":return e.jsx(Gs,{});case"Cancelled":return e.jsx(yt,{});default:return e.jsx(yt,{})}},U=async()=>{s(!0);try{const{data:D,error:_}=await $.from("Orders").select("*");if(_){console.error("Error fetching orders:",_),H("Failed to fetch orders","danger");return}if(D){const G=D.map(te=>({uuid:te.uuid,date:te.date||te.created_at||te["Created at"]||"",status:te.status||"Paid",customer:te.customer||{initial:te.customer_initial||(te.customer_name?te.customer_name[0]:"?"),name:te.customer_name||"Unknown",email:te.customer_email||""},order_number_display:te.order_number_display,order_total:typeof te.order_total=="number"?te.order_total:0,created_by:te.created_by||"",created_by_name:te.created_by_name||"",created_by_email:te.created_by_email||"",category:te.category||"purchase"})).sort((te,$e)=>{const Ce=new Date(te.date||0);return new Date($e.date||0).getTime()-Ce.getTime()});r(G)}}catch(D){console.error("Error fetching orders:",D),H("Failed to fetch orders","danger")}finally{s(!1)}},ne=async D=>{try{const{data:_,error:G}=await $.from("OrderItems").select("*, Products:product_uuid(ProductName)").eq("order_uuid",D);return G?(console.error("Error fetching order items:",G),[]):_?.map(te=>({...te,product_name:te.Products?.ProductName||te.product_uuid}))||[]}catch(_){return console.error("Error fetching order items:",_),[]}};u.useEffect(()=>{U()},[]);const he=t.filter(D=>{const _=!d||D.order_number_display?.toString().toLowerCase().includes(d.toLowerCase())||D.customer.name.toLowerCase().includes(d.toLowerCase())||D.customer.email.toLowerCase().includes(d.toLowerCase()),G=!c||D.status===c,te=!m||D.category===m,$e=!b||D.customer.name===b;return _&&G&&te&&$e}),ie=Array.from(new Set(t.map(D=>D.status))),X=Array.from(new Set(t.map(D=>D.category||"purchase"))),ce=Array.from(new Set(t.map(D=>D.customer.name))),Z=()=>{k(null),O("add"),g(!0)},re=D=>{k(D),O("view"),g(!0)},T=()=>{g(!1),k(null)},K=()=>{U()},ye=D=>({id:D.uuid,uuid:D.uuid,order_number:D.order_number_display,date:D.date,status:D.status,customer_name:D.customer.name,customer_email:D.customer.email,total:D.order_total}),ve=D=>{const _=t.find(G=>G.uuid===D||G.order_number_display===D);_&&re(_)},Ne=D=>{k(D),C(!0)},Ke=()=>{Z()},M=()=>{f(!1)},de=()=>{x(""),y(""),v("")},R=()=>e.jsxs(i,{sx:{pb:2},children:[e.jsxs(ke,{variant:"page",padding:"medium",children:[e.jsxs(i,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(N,{placeholder:"Search orders...",value:d,onChange:D=>o(D.target.value),startDecorator:e.jsx(Se,{}),sx:{flex:1,fontSize:"16px"}}),e.jsx(pe,{variant:"soft",onClick:()=>f(!0),sx:{flexShrink:0},children:e.jsx(vs,{})})]}),(c||m||b)&&e.jsxs(i,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:[c&&e.jsxs(oe,{size:"sm",variant:"soft",color:"primary",children:["Status: ",c]}),m&&e.jsxs(oe,{size:"sm",variant:"soft",color:"primary",children:["Category: ",m]}),b&&e.jsxs(oe,{size:"sm",variant:"soft",color:"primary",children:["Customer: ",b]})]}),n&&e.jsx(Ie,{sx:{mb:2}})]}),e.jsx(i,{children:he.length===0?e.jsx(i,{sx:{textAlign:"center",py:6},children:e.jsx(a,{color:"neutral",children:n?"Loading orders...":"No orders found"})}):he.map(D=>e.jsxs(i,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider",cursor:"pointer","&:hover":{bgcolor:"background.level1"}},onClick:()=>ve(D.uuid),children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(i,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${E(D.status)}.100`,color:`${E(D.status)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",flexShrink:0},children:P(D.status)}),e.jsxs(i,{sx:{flex:1,minWidth:0},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsxs(a,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:["Order #",D.order_number_display||D.uuid.substring(0,8)]}),e.jsx(oe,{size:"sm",color:E(D.status),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content"},children:D.status})]}),e.jsxs(a,{level:"body-xs",color:"neutral",sx:{mb:.5},children:[D.customer.name," â€¢ ",new Date(D.date).toLocaleDateString()]}),D.order_total&&e.jsx(a,{level:"body-xs",sx:{fontWeight:"bold",color:"primary.600"},children:qe(D.order_total)})]})]}),e.jsx(i,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:D.status==="Draft"&&e.jsx(q,{size:"sm",variant:"solid",color:"primary",onClick:_=>{_.stopPropagation(),Ne(D)},startDecorator:e.jsx(Vs,{}),children:"Checkout"})})]},D.uuid))}),e.jsx(pe,{color:"primary",variant:"soft",size:"sm",sx:{position:"fixed",bottom:80,right:16,zIndex:1e3,borderRadius:"8px",width:40,height:40,boxShadow:"sm",bgcolor:"primary.100","&:hover":{bgcolor:"primary.200",boxShadow:"md"}},onClick:Ke,children:e.jsx(be,{fontSize:"small"})})]}),Y=()=>e.jsxs(ke,{variant:"table-page",children:[e.jsx(a,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Orders"}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(N,{placeholder:"Search orders...",sx:{flex:1,fontSize:le.sizes.small},value:d,onChange:D=>o(D.target.value),startDecorator:e.jsx(Se,{})}),e.jsxs(je,{placeholder:"Filter status",value:c,onChange:(D,_)=>x(_||""),sx:{minWidth:160,fontSize:le.sizes.small},children:[e.jsx(F,{value:"",children:"All Statuses"}),ie.map(D=>e.jsx(F,{value:D,children:D},D))]}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(be,{}),onClick:Ke,sx:{fontSize:le.sizes.small},children:"Create Order"})]}),e.jsxs(ue,{sx:{overflow:"visible"},children:[n&&e.jsx(Ie,{}),e.jsxs(Be,{"aria-label":"Orders",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:Ae,children:"Order #"}),e.jsx("th",{style:Ae,children:"Date"}),e.jsx("th",{style:Ae,children:"Customer"}),e.jsx("th",{style:Ae,children:"Status"}),e.jsx("th",{style:Ae,children:"Total"}),e.jsx("th",{style:Ae,children:"Actions"})]})}),e.jsxs("tbody",{children:[he.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{textAlign:"center",color:"#888",...Ae},children:n?"Loading orders...":"No orders found."})}),he.map(D=>e.jsxs("tr",{style:{cursor:"pointer"},onClick:()=>ve(D.uuid),children:[e.jsx("td",{style:Ae,children:D.order_number_display||D.uuid.substring(0,8)}),e.jsx("td",{style:Ae,children:new Date(D.date).toLocaleDateString()}),e.jsx("td",{style:Ae,children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(i,{sx:{width:24,height:24,borderRadius:"50%",bgcolor:"primary.100",color:"primary.600",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold"},children:D.customer.initial}),e.jsxs(i,{children:[e.jsx(a,{level:"body-sm",sx:{fontWeight:"bold"},children:D.customer.name}),e.jsx(a,{level:"body-xs",color:"neutral",children:D.customer.email})]})]})}),e.jsx("td",{style:Ae,children:e.jsx(oe,{size:"sm",variant:"soft",color:E(D.status),children:D.status})}),e.jsx("td",{style:Ae,children:e.jsx(a,{level:"body-sm",sx:{fontWeight:"bold"},children:D.order_total?qe(D.order_total):"N/A"})}),e.jsx("td",{style:Ae,children:e.jsx(i,{sx:{display:"flex",gap:1},children:D.status==="Draft"&&e.jsx(q,{size:"sm",variant:"solid",color:"primary",onClick:_=>{_.stopPropagation(),Ne(D)},startDecorator:e.jsx(Vs,{}),children:"Checkout"})})})]},D.uuid))]})]})]})]});return e.jsxs(Fe,{children:[l?e.jsx(R,{}):e.jsx(Y,{}),e.jsx(en,{open:w,onClose:T,order:p?ye(p):void 0,mode:V,onSaved:K,fetchOrderItems:ne}),e.jsx(on,{open:I,onClose:()=>C(!1),order:p?{uuid:p.uuid,order_number_display:p.order_number_display,order_total:p.order_total,customer_name:p.customer.name,customer_email:p.customer.email}:null,onSuccess:()=>{C(!1),U(),H("Order completed successfully!","success")}}),l&&e.jsx(Ft,{open:S,onClose:M,title:"Filter Orders",size:"medium",actions:e.jsxs(i,{sx:{display:"flex",gap:2},children:[e.jsx(q,{variant:"plain",onClick:de,sx:Ae,children:"Clear All"}),e.jsx(q,{variant:"solid",onClick:M,sx:Ae,children:"Apply"})]}),children:e.jsxs(J,{spacing:2,children:[e.jsxs(se,{children:[e.jsx(ee,{children:"Status"}),e.jsxs(je,{placeholder:"All statuses",value:c,onChange:(D,_)=>x(_||""),children:[e.jsx(F,{value:"",children:"All Statuses"}),ie.map(D=>e.jsx(F,{value:D,children:D},D))]})]}),e.jsxs(se,{children:[e.jsx(ee,{children:"Category"}),e.jsxs(je,{placeholder:"All categories",value:m,onChange:(D,_)=>y(_||""),children:[e.jsx(F,{value:"",children:"All Categories"}),X.map(D=>e.jsx(F,{value:D,children:D},D))]})]}),e.jsxs(se,{children:[e.jsx(ee,{children:"Customer"}),e.jsxs(je,{placeholder:"All customers",value:b,onChange:(D,_)=>v(_||""),children:[e.jsx(F,{value:"",children:"All Customers"}),ce.map(D=>e.jsx(F,{value:D,children:D},D))]})]})]})}),e.jsx(Vt,{open:z,onClose:()=>L(!1),autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{top:16,zIndex:2e3},children:e.jsx(Je,{color:h,variant:"solid",sx:{width:"100%"},children:W})})]})};function dn({open:l,onClose:t,product:r,onSave:n,mode:s="add",onEdit:d}){const[o,c]=u.useState({ProductName:r?.ProductName||"",SalesPrice:r?.SalesPrice?.toString()||"",CostPrice:r?.CostPrice?.toString()||"",image_url:r?.image_url||"",min_stock:r?.min_stock?.toString()||"",max_stock:r?.max_stock?.toString()||"",reorder_amount:r?.reorder_amount?.toString()||""}),[x,m]=u.useState(!1),[y,b]=u.useState(!1),v=u.useRef(null);u.useEffect(()=>{c({ProductName:r?.ProductName||"",SalesPrice:r?.SalesPrice?.toString()||"",CostPrice:r?.CostPrice?.toString()||"",image_url:r?.image_url||"",min_stock:r?.min_stock?.toString()||"",max_stock:r?.max_stock?.toString()||"",reorder_amount:r?.reorder_amount?.toString()||""})},[r]);const S=async g=>{const I=g.target.files?.[0];if(I){if(!I.type.startsWith("image/")){alert("Please select a valid image file");return}if(I.size>5*1024*1024){alert("Image size must be less than 5MB");return}try{b(!0);const C=I.name.split(".").pop(),k=`products/${`product-${Date.now()}.${C}`}`,{data:V,error:O}=await $.storage.from("productimages").upload(k,I,{cacheControl:"3600",upsert:!0});if(O)throw new Error(`Upload failed: ${O.message}`);const{data:{publicUrl:B}}=$.storage.from("productimages").getPublicUrl(k);c(j=>({...j,image_url:B}))}catch(C){console.error("Image upload failed:",C),alert("Failed to upload image. Please try again.")}finally{b(!1),g.target&&(g.target.value="")}}},f=()=>{c(g=>({...g,image_url:""}))},w=async()=>{m(!0),await n(o),m(!1)};return e.jsx(Le,{open:l,onClose:t,"aria-labelledby":"dialog-products-title",children:e.jsxs(Te,{sx:{minWidth:{xs:"90vw",sm:500}},children:[e.jsx(wt,{id:"dialog-products-title",children:s==="view"?"Product Details":r?"Edit Product":"Add Product"}),e.jsx(St,{children:e.jsxs(J,{spacing:2,children:[e.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:1},children:[e.jsx(a,{level:"body-sm",sx:{alignSelf:"flex-start"},children:"Product Image"}),o.image_url?e.jsxs(i,{sx:{position:"relative"},children:[e.jsx(xe,{src:o.image_url,alt:"Product",variant:"soft",sx:{width:120,height:120,borderRadius:2,border:"2px solid",borderColor:"neutral.300"}}),s!=="view"&&e.jsx(pe,{size:"sm",variant:"solid",color:"danger",onClick:f,sx:{position:"absolute",top:-8,right:-8,minHeight:24,minWidth:24},children:e.jsx(xt,{fontSize:"small"})})]}):e.jsx(i,{sx:{width:120,height:120,borderRadius:2,border:"2px dashed",borderColor:"neutral.300",display:"flex",alignItems:"center",justifyContent:"center",cursor:s==="view"?"default":"pointer","&:hover":s==="view"?{}:{borderColor:"primary.500",backgroundColor:"primary.50"}},onClick:s==="view"?void 0:()=>v.current?.click(),children:e.jsx(_t,{sx:{fontSize:32,color:"neutral.400"}})}),e.jsx("input",{ref:v,type:"file",accept:"image/*",onChange:S,style:{display:"none"},disabled:s==="view"}),s!=="view"&&e.jsxs(J,{direction:"row",spacing:1,children:[e.jsx(q,{size:"sm",variant:"outlined",onClick:()=>v.current?.click(),loading:y,disabled:y,children:o.image_url?"Change Image":"Upload Image"}),o.image_url&&e.jsx(q,{size:"sm",variant:"plain",color:"danger",onClick:f,children:"Remove"})]})]}),e.jsx(N,{name:"ProductName",value:o.ProductName,onChange:g=>c({...o,ProductName:g.target.value}),placeholder:"Product Name",readOnly:s==="view"}),e.jsx(N,{name:"SalesPrice",value:o.SalesPrice,onChange:g=>c({...o,SalesPrice:g.target.value}),placeholder:"Sales Price",type:"number",readOnly:s==="view"}),e.jsx(N,{name:"CostPrice",value:o.CostPrice,onChange:g=>c({...o,CostPrice:g.target.value}),placeholder:"Cost Price",type:"number",readOnly:s==="view"}),e.jsxs(i,{sx:{mt:3,mb:2},children:[e.jsxs(a,{level:"title-md",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ar,{}),"Inventory Management"]}),e.jsxs(J,{spacing:2,children:[e.jsx(N,{name:"min_stock",value:o.min_stock,onChange:g=>c({...o,min_stock:g.target.value}),placeholder:"Minimum Stock Level",type:"number",startDecorator:e.jsx(a,{level:"body-sm",children:"Min:"}),readOnly:s==="view"}),e.jsx(N,{name:"max_stock",value:o.max_stock,onChange:g=>c({...o,max_stock:g.target.value}),placeholder:"Maximum Stock Level",type:"number",startDecorator:e.jsx(a,{level:"body-sm",children:"Max:"}),readOnly:s==="view"}),e.jsx(N,{name:"reorder_amount",value:o.reorder_amount,onChange:g=>c({...o,reorder_amount:g.target.value}),placeholder:"Reorder Amount",type:"number",startDecorator:e.jsx(a,{level:"body-sm",children:"Reorder:"}),readOnly:s==="view"})]})]})]})}),e.jsxs(Ct,{children:[e.jsx(q,{onClick:t,variant:"plain",disabled:x||y,children:s==="view"?"Close":"Cancel"}),s==="view"?d&&e.jsx(q,{onClick:d,variant:"solid",startDecorator:e.jsx(ct,{}),children:"Edit"}):e.jsx(q,{onClick:w,variant:"solid",loading:x,disabled:x||y,children:"Save"})]})]})})}const es=Is(dn),ze={fontSize:le.sizes.small},un=()=>{const{isMobile:l}=Pe(),[t,r]=u.useState([]),[n,s]=u.useState({}),[d,o]=u.useState(!1),[c,x]=u.useState(!1),[m,y]=u.useState(!1),[b,v]=u.useState(""),[S,f]=u.useState(""),[w,g]=u.useState(!1),[I,C]=u.useState(!1),[p,k]=u.useState(!1),[V,O]=u.useState(!1),[B,j]=u.useState(null),[z,L]=u.useState(null),[W,Q]=u.useState(!1),[h,A]=u.useState(""),[H,E]=u.useState("success"),P=(R,Y="success")=>{A(R),E(Y),Q(!0)},U=R=>R<=0?{status:"Out of Stock",color:"danger"}:R<=10?{status:"Low Stock",color:"warning"}:{status:"In Stock",color:"success"},ne=R=>{const Y=U(R);return e.jsx(i,{sx:{width:20,height:20,borderRadius:"50%",bgcolor:`${Y.color}.100`,color:`${Y.color}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold"},children:e.jsx(Ar,{sx:{fontSize:"12px"}})})},he=async()=>{o(!0);try{const{data:R,error:Y}=await $.from("Products").select("*").order("CreatedAt",{ascending:!1});if(Y){console.error("Error fetching products:",Y),P("Failed to fetch products","danger");return}R&&(r(R),await ie(R))}catch(R){console.error("Error fetching products:",R),P("Failed to fetch products","danger")}finally{o(!1)}},ie=async R=>{x(!0);try{const{data:Y,error:D}=await $.from("stock_movements").select("product_id, movement_type, quantity");if(D){console.error("Error fetching stock data:",D);return}if(Y){const _={};R.forEach(G=>{const $e=Y.filter(Ce=>Ce.product_id===G.uuid).reduce((Ce,It)=>{switch(It.movement_type){case"incoming":case"adjustment":return Ce+(It.quantity||0);case"outgoing":return Ce-(It.quantity||0);default:return Ce}},0);_[G.uuid]=$e}),s(_)}}catch(Y){console.error("Error fetching stock levels:",Y)}finally{x(!1)}};u.useEffect(()=>{he()},[]);const X=t.filter(R=>{const Y=!b||R.ProductName.toLowerCase().includes(b.toLowerCase())||R.ProductID?.toLowerCase().includes(b.toLowerCase()),D=n[R.uuid]||0,_=!S||S==="in-stock"&&D>10||S==="low-stock"&&D>0&&D<=10||S==="out-of-stock"&&D<=0;return Y&&_}),ce=()=>{C(!0)},Z=R=>{j(R),k(!0)},re=R=>{L(R),O(!0)},T=()=>{z&&(j(z),O(!1),L(null),k(!0))},K=async R=>{if(confirm("Are you sure you want to delete this product?")){y(!0);try{const{error:Y}=await $.from("Products").delete().eq("uuid",R);if(Y){console.error("Error deleting product:",Y),P("Failed to delete product","danger");return}r(t.filter(D=>D.uuid!==R)),P("Product deleted successfully","success")}catch(Y){console.error("Error deleting product:",Y),P("Failed to delete product","danger")}finally{y(!1)}}},ye=async R=>{y(!0);try{const Y=Xs({ProductName:R.ProductName,SalesPrice:parseFloat(R.SalesPrice),CostPrice:parseFloat(R.CostPrice),image_url:R.image_url||null,min_stock:R.min_stock?parseInt(R.min_stock):null,max_stock:R.max_stock?parseInt(R.max_stock):null,reorder_amount:R.reorder_amount?parseInt(R.reorder_amount):null,CreatedAt:new Date().toISOString()}),{data:D,error:_}=await $.from("Products").insert([Y]).select().single();if(_){console.error("Error adding product:",_),P("Failed to add product","danger");return}P("Product added successfully","success"),C(!1),he()}catch(Y){console.error("Error adding product:",Y),P("Failed to add product","danger")}finally{y(!1)}},ve=async R=>{if(B){y(!0);try{const Y=Xs({ProductName:R.ProductName,SalesPrice:parseFloat(R.SalesPrice),CostPrice:parseFloat(R.CostPrice),image_url:R.image_url||null,min_stock:R.min_stock?parseInt(R.min_stock):null,max_stock:R.max_stock?parseInt(R.max_stock):null,reorder_amount:R.reorder_amount?parseInt(R.reorder_amount):null}),{error:D}=await $.from("Products").update(Y).eq("uuid",B.uuid);if(D){console.error("Error updating product:",D),P("Failed to update product","danger");return}P("Product updated successfully","success"),k(!1),j(null),he()}catch(Y){console.error("Error updating product:",Y),P("Failed to update product","danger")}finally{y(!1)}}},Ne=()=>{g(!1)},Ke=()=>{f("")},M=()=>e.jsxs(i,{sx:{pb:2},children:[e.jsxs(ke,{variant:"page",padding:"medium",children:[e.jsxs(i,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(N,{placeholder:"Search products...",value:b,onChange:R=>v(R.target.value),startDecorator:e.jsx(Se,{}),sx:{flex:1,fontSize:"16px"}}),e.jsx(pe,{variant:"soft",onClick:()=>g(!0),sx:{flexShrink:0},children:e.jsx(vs,{})})]}),S&&e.jsx(i,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:e.jsxs(oe,{size:"sm",variant:"soft",color:"primary",children:["Stock: ",S.replace("-"," ")]})}),d&&e.jsx(Ie,{sx:{mb:2}})]}),e.jsx(i,{children:X.length===0?e.jsx(i,{sx:{textAlign:"center",py:6},children:e.jsx(a,{color:"neutral",children:d?"Loading products...":"No products found"})}):X.map(R=>e.jsx(i,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider",cursor:"pointer","&:hover":{bgcolor:"background.level1"}},onClick:()=>re(R),children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(i,{sx:{flexShrink:0},children:R.image_url?e.jsx(xe,{src:R.image_url,sx:{width:48,height:48},alt:R.ProductName}):e.jsx(xe,{sx:{width:48,height:48,bgcolor:"neutral.100"},children:e.jsx(Qs,{})})}),e.jsxs(i,{sx:{flex:1,minWidth:0},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(a,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:R.ProductName}),e.jsx(i,{sx:{display:"flex",alignItems:"center",gap:1},children:c?e.jsx(a,{level:"body-xs",color:"neutral",children:"..."}):e.jsxs(e.Fragment,{children:[ne(n[R.uuid]||0),e.jsx(oe,{size:"sm",color:U(n[R.uuid]||0).color,variant:"soft",sx:{fontSize:"10px",minWidth:"fit-content"},children:n[R.uuid]||0})]})})]}),e.jsxs(a,{level:"body-xs",color:"neutral",sx:{mb:.5},children:["ID: ",R.ProductID||"N/A"," â€¢ ",new Date(R.CreatedAt).toLocaleDateString()]}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(i,{children:[e.jsxs(a,{level:"body-xs",sx:{fontWeight:"bold",color:"success.600"},children:["Sale: ",qe(R.SalesPrice)]}),e.jsxs(a,{level:"body-xs",color:"neutral",children:["Cost: ",qe(R.CostPrice)]})]}),e.jsxs(i,{sx:{display:"flex",gap:.5},children:[e.jsx(pe,{size:"sm",variant:"soft",color:"primary",onClick:Y=>{Y.stopPropagation(),Z(R)},children:e.jsx(ct,{})}),e.jsx(pe,{size:"sm",variant:"soft",color:"danger",onClick:Y=>{Y.stopPropagation(),K(R.uuid)},disabled:m,children:e.jsx(xt,{})})]})]})]})]})},R.uuid))}),e.jsx(pe,{color:"primary",variant:"soft",size:"sm",sx:{position:"fixed",bottom:80,right:16,zIndex:1e3,borderRadius:"8px",width:40,height:40,boxShadow:"sm",bgcolor:"primary.100","&:hover":{bgcolor:"primary.200",boxShadow:"md"}},onClick:ce,children:e.jsx(be,{fontSize:"small"})})]}),de=()=>e.jsxs(ke,{variant:"table-page",children:[e.jsx(a,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Products"}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(N,{placeholder:"Search products...",sx:{flex:1,fontSize:le.sizes.small},value:b,onChange:R=>v(R.target.value),startDecorator:e.jsx(Se,{})}),e.jsxs(je,{placeholder:"Filter by stock",value:S,onChange:(R,Y)=>f(Y||""),sx:{minWidth:160,fontSize:le.sizes.small},children:[e.jsx(F,{value:"",children:"All Stock Levels"}),e.jsx(F,{value:"in-stock",children:"In Stock"}),e.jsx(F,{value:"low-stock",children:"Low Stock"}),e.jsx(F,{value:"out-of-stock",children:"Out of Stock"})]}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(be,{}),onClick:ce,sx:{fontSize:le.sizes.small},children:"Add Product"})]}),e.jsxs(ue,{sx:{overflow:"visible"},children:[d&&e.jsx(Ie,{}),e.jsxs(Be,{"aria-label":"Products",sx:{tableLayout:"auto","& tbody tr":{cursor:"pointer","&:hover":{backgroundColor:"background.level1"}}},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:ze,children:"Image"}),e.jsx("th",{style:ze,children:"Name"}),e.jsx("th",{style:ze,children:"Stock"}),e.jsx("th",{style:ze,children:"Sales Price"}),e.jsx("th",{style:ze,children:"Cost Price"}),e.jsx("th",{style:ze,children:"Created"}),e.jsx("th",{style:ze,children:"Actions"})]})}),e.jsxs("tbody",{children:[X.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...ze},children:d?"Loading products...":"No products found."})}),X.map(R=>e.jsxs("tr",{onClick:()=>re(R),children:[e.jsx("td",{style:ze,children:R.image_url?e.jsx(xe,{src:R.image_url,sx:{width:32,height:32},alt:R.ProductName}):e.jsx(xe,{sx:{width:32,height:32,bgcolor:"neutral.100"},children:e.jsx(Qs,{sx:{fontSize:"16px"}})})}),e.jsx("td",{style:ze,children:e.jsxs(i,{children:[e.jsx(a,{level:"body-sm",sx:{fontWeight:"bold"},children:R.ProductName}),e.jsxs(a,{level:"body-xs",color:"neutral",children:["ID: ",R.ProductID||"N/A"]})]})}),e.jsx("td",{style:ze,children:c?e.jsx(a,{level:"body-sm",sx:{color:"neutral.500"},children:"Loading..."}):e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(oe,{size:"sm",variant:"soft",color:U(n[R.uuid]||0).color,children:U(n[R.uuid]||0).status}),e.jsx(os,{title:`Current stock level: ${n[R.uuid]||0} units`,arrow:!0,children:e.jsx(a,{level:"body-sm",sx:{fontWeight:"bold",color:U(n[R.uuid]||0).color==="danger"?"danger.500":U(n[R.uuid]||0).color==="warning"?"warning.600":"success.600"},children:n[R.uuid]||0})}),e.jsx(i,{sx:{width:40,height:4,bgcolor:"neutral.200",borderRadius:2,overflow:"hidden"},children:e.jsx(i,{sx:{width:`${Math.min(100,Math.max(0,(n[R.uuid]||0)/50*100))}%`,height:"100%",bgcolor:U(n[R.uuid]||0).color==="danger"?"danger.400":U(n[R.uuid]||0).color==="warning"?"warning.400":"success.400",borderRadius:2}})})]})}),e.jsx("td",{style:ze,children:e.jsx(a,{level:"body-sm",sx:{fontWeight:"bold",color:"success.600"},children:qe(R.SalesPrice)})}),e.jsx("td",{style:ze,children:e.jsx(a,{level:"body-sm",color:"neutral",children:qe(R.CostPrice)})}),e.jsx("td",{style:ze,children:new Date(R.CreatedAt).toLocaleDateString()}),e.jsx("td",{style:ze,children:e.jsxs(i,{sx:{display:"flex",gap:.5},children:[e.jsx(pe,{size:"sm",variant:"soft",color:"primary",onClick:Y=>{Y.stopPropagation(),Z(R)},children:e.jsx(ct,{})}),e.jsx(pe,{size:"sm",variant:"soft",color:"danger",onClick:Y=>{Y.stopPropagation(),K(R.uuid)},disabled:m,children:e.jsx(xt,{})})]})})]},R.uuid))]})]})]})]});return e.jsxs(Fe,{children:[l?e.jsx(M,{}):e.jsx(de,{}),e.jsx(es,{open:I,onClose:()=>C(!1),product:null,mode:"add",onSave:ye}),e.jsx(es,{open:p,onClose:()=>{k(!1),j(null)},product:B,mode:"edit",onSave:ve}),e.jsx(es,{open:V,onClose:()=>{O(!1),L(null)},product:z,mode:"view",onSave:()=>{},onEdit:T}),l&&e.jsx(Ft,{open:w,onClose:Ne,title:"Filter Products",size:"medium",actions:e.jsxs(i,{sx:{display:"flex",gap:2},children:[e.jsx(q,{variant:"plain",onClick:Ke,sx:ze,children:"Clear All"}),e.jsx(q,{variant:"solid",onClick:Ne,sx:ze,children:"Apply"})]}),children:e.jsx(J,{spacing:2,children:e.jsxs(se,{children:[e.jsx(ee,{children:"Stock Level"}),e.jsxs(je,{placeholder:"All stock levels",value:S,onChange:(R,Y)=>f(Y||""),children:[e.jsx(F,{value:"",children:"All Stock Levels"}),e.jsx(F,{value:"in-stock",children:"In Stock"}),e.jsx(F,{value:"low-stock",children:"Low Stock"}),e.jsx(F,{value:"out-of-stock",children:"Out of Stock"})]})]})})}),e.jsx(Vt,{open:W,onClose:()=>Q(!1),autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{top:16,zIndex:2e3},children:e.jsx(Je,{color:H,variant:"solid",sx:{width:"100%"},children:h})})]})},Xe={fontSize:le.sizes.small},rt={...Xe,fontWeight:600,borderBottom:"1.5px solid #e0e0e0",background:"inherit"},tr=l=>{switch(l?.toLowerCase()){case"admin":return"danger";case"manager":return"warning";case"user":return"primary";case"staff":return"success";default:return"neutral"}},sr=(l,t,r)=>{const s=`${l||""} ${t||""}`.trim()||r;let d=0;for(let c=0;c<s.length;c++)d=s.charCodeAt(c)+((d<<5)-d);const o=["primary","success","warning","danger","neutral"];return o[Math.abs(d)%o.length]},rr=(l,t,r)=>{if(l||t){const n=l?.[0]||"",s=t?.[0]||"";return(n+s).toUpperCase()}return r.substring(0,2).toUpperCase()};function hn(){return e.jsxs(ms,{children:[e.jsx(gs,{slots:{root:pe},slotProps:{root:{variant:"plain",color:"neutral",size:"sm"}},children:e.jsx(Ss,{})}),e.jsxs(fs,{size:"sm",sx:{minWidth:140},children:[e.jsx(We,{children:"Edit"}),e.jsx(We,{children:"Reset Password"}),e.jsx(We,{children:"Disable"}),e.jsx(We,{color:"danger",children:"Delete"})]})]})}const xn=()=>{const{isMobile:l}=Pe(),[t,r]=u.useState([]),[n,s]=u.useState(!1),[d,o]=u.useState(null),[c,x]=u.useState(""),[m,y]=u.useState("all"),[b,v]=u.useState(!1),S=async()=>{s(!0),o(null);try{const{data:p,error:k}=await $.from("users").select("*");if(k)throw k;if(p){const V=p.map(O=>({id:O.id,first_name:O.first_name||null,last_name:O.last_name||null,email:O.email,role:O.role||null,created_at:O.created_at||null,last_login:O.last_login||null,phone_number:O.phone_number||null,avatar_url:O.avatar_url||null}));console.log("User avatar URLs:",V.map(O=>({email:O.email,avatar_url:O.avatar_url}))),r(V)}}catch(p){console.error("Error fetching users:",p),o(p.message||"Failed to fetch users")}finally{s(!1)}},f=Array.from(new Set(t.map(p=>p.role).filter(Boolean))),g=[...t.filter(p=>{const V=`${p.first_name||""} ${p.last_name||""}`.trim().toLowerCase().includes(c.toLowerCase())||p.email.toLowerCase().includes(c.toLowerCase()),O=m==="all"||p.role===m;return V&&O})].sort((p,k)=>{const V=`${p.first_name||""} ${p.last_name||""}`.trim()||p.email,O=`${k.first_name||""} ${k.last_name||""}`.trim()||k.email;return V.localeCompare(O)});u.useEffect(()=>{S()},[]);const I=()=>e.jsxs(i,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(ke,{padding:"medium",children:[e.jsx(a,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Users"}),e.jsxs(i,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(N,{placeholder:"Search users...",value:c,onChange:p=>x(p.target.value),startDecorator:e.jsx(Se,{}),sx:{flex:1}}),e.jsxs(je,{placeholder:"Role",value:m,onChange:(p,k)=>y(k??"all"),sx:{minWidth:120},children:[e.jsx(F,{value:"all",children:"All"}),f.map(p=>e.jsx(F,{value:p,children:p},p))]})]}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(be,{}),onClick:()=>v(!0),sx:{width:"100%",mb:2},children:"Create User"})]}),n&&e.jsx(Ie,{}),d&&e.jsx(i,{sx:{p:2},children:e.jsxs(a,{color:"danger",children:["Error: ",d]})}),e.jsx(i,{children:g.length===0?e.jsx(i,{sx:{textAlign:"center",py:6},children:e.jsx(a,{color:"neutral",children:"No users found"})}):g.map(p=>e.jsx(i,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(xe,{size:"md",src:p.avatar_url||void 0,color:sr(p.first_name,p.last_name,p.email),sx:{flexShrink:0},children:!p.avatar_url&&rr(p.first_name,p.last_name,p.email)}),e.jsxs(i,{sx:{flex:1,minWidth:0},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(a,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:`${p.first_name||""} ${p.last_name||""}`.trim()||"Unnamed User"}),p.role&&e.jsx(oe,{size:"sm",color:tr(p.role),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content",textTransform:"capitalize"},children:p.role})]}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(Ve,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsx(a,{level:"body-xs",color:"neutral",children:p.email})]}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:.5},children:[p.phone_number&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(dt,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsx(a,{level:"body-xs",color:"neutral",children:p.phone_number})]}),p.last_login&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Gt,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsx(a,{level:"body-xs",color:"neutral",children:new Date(p.last_login).toLocaleDateString()})]})]}),p.created_at&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(ws,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsxs(a,{level:"body-xs",color:"neutral",children:["Joined ",new Date(p.created_at).toLocaleDateString()]})]})]})]})},p.id))})]}),C=()=>e.jsxs(ke,{variant:"table-page",children:[e.jsx(a,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Users"}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(N,{placeholder:"Search users...",sx:{flex:1},value:c,onChange:p=>x(p.target.value),startDecorator:e.jsx(Se,{})}),e.jsxs(je,{placeholder:"Filter role",value:m,onChange:(p,k)=>y(k??"all"),sx:{minWidth:160},children:[e.jsx(F,{value:"all",children:"All Roles"}),f.map(p=>e.jsx(F,{value:p,children:p},p))]}),e.jsx(q,{onClick:()=>v(!0),variant:"solid",startDecorator:e.jsx(be,{}),children:"Create User"})]}),e.jsxs(ue,{sx:{overflow:"visible"},children:[n&&e.jsx(Ie,{}),d&&e.jsxs(a,{color:"danger",children:["Error: ",d]}),e.jsxs(Be,{"aria-label":"Users",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:rt,children:"Name"}),e.jsx("th",{style:rt,children:"Email"}),e.jsx("th",{style:rt,children:"Role"}),e.jsx("th",{style:rt,children:"Created At"}),e.jsx("th",{style:rt,children:"Last Login"}),e.jsx("th",{style:rt,children:"Phone"}),e.jsx("th",{style:{width:120,...rt},children:"Actions"})]})}),e.jsxs("tbody",{children:[g.length===0&&!n&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...Xe},children:"No users found."})}),g.map(p=>e.jsxs("tr",{style:{cursor:"pointer",height:48},children:[e.jsx("td",{style:Xe,children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:["                ",e.jsx(xe,{size:"sm",src:p.avatar_url||void 0,color:sr(p.first_name,p.last_name,p.email),children:!p.avatar_url&&rr(p.first_name,p.last_name,p.email)}),e.jsx(a,{level:"body-sm",fontWeight:"md",children:`${p.first_name||""} ${p.last_name||""}`.trim()||"Unnamed User"})]})}),e.jsx("td",{style:Xe,children:p.email}),e.jsx("td",{style:Xe,children:p.role?e.jsx(oe,{size:"sm",color:tr(p.role),variant:"soft",sx:{textTransform:"capitalize"},children:p.role}):"-"}),e.jsx("td",{style:Xe,children:p.created_at?new Date(p.created_at).toLocaleDateString():"-"}),e.jsx("td",{style:Xe,children:p.last_login?new Date(p.last_login).toLocaleDateString():"-"}),e.jsx("td",{style:Xe,children:p.phone_number||"-"}),e.jsx("td",{children:e.jsx(hn,{})})]},p.id))]})]})]})]});return e.jsxs(Fe,{children:[l?e.jsx(I,{}):e.jsx(C,{}),e.jsx(Le,{open:b,onClose:()=>v(!1),"aria-labelledby":"create-user-modal",children:e.jsxs(Te,{"aria-labelledby":"create-user-modal",sx:{maxWidth:600,width:"100%"},children:[e.jsx(Ue,{}),e.jsx(a,{id:"create-user-modal",level:"title-md",fontWeight:"lg",sx:{mb:2},children:"Create User"}),e.jsx(a,{level:"body-sm",sx:{mb:2},children:"User creation functionality will be implemented here."}),e.jsx(q,{onClick:()=>v(!1),variant:"outlined",children:"Close"})]})})]})};function pn({open:l,onClose:t,customer:r,mode:n="add",onSaved:s}){const[d,o]=u.useState(r?.first_name||""),[c,x]=u.useState(r?.last_name||""),[m,y]=u.useState(r?.email||""),[b,v]=u.useState(r?.phone_number||""),[S,f]=u.useState(r?.role||"customer"),[w,g]=u.useState(r?.address||""),[I,C]=u.useState(r?.city||""),[p,k]=u.useState(r?.postal_code||""),[V,O]=u.useState(r?.country||""),[B,j]=u.useState(r?.notes||""),[z,L]=u.useState(r?.avatar_url||""),[W,Q]=u.useState(!1),[h,A]=u.useState(!1),[H,E]=u.useState(null),P=u.useRef(null);u.useEffect(()=>{l&&r?(o(r.first_name||""),x(r.last_name||""),y(r.email||""),v(r.phone_number||""),f(r.role||"customer"),g(r.address||""),C(r.city||""),k(r.postal_code||""),O(r.country||""),j(r.notes||""),L(r.avatar_url||"")):l&&n==="add"&&(o(""),x(""),y(""),v(""),f("customer"),g(""),C(""),k(""),O(""),j(""),L("")),E(null)},[l,r,n]);const U=async X=>{const ce=X.target.files?.[0];if(ce){if(!ce.type.startsWith("image/")){E("Please select a valid image file");return}if(ce.size>5*1024*1024){E("Image size must be less than 5MB");return}A(!0),E(null);try{const Z=ce.name.split(".").pop()?.replace(/\./,"")||"png",re=`avatars/customer_${Date.now()}.${Z}`,T=await $.storage.from("avatars").upload(re,ce,{upsert:!0,contentType:ce.type});if(T.error)throw T.error;const{data:{publicUrl:K}}=$.storage.from("avatars").getPublicUrl(re);K&&L(K)}catch(Z){E("Failed to upload avatar. Please try again."),console.error("Avatar upload failed:",Z)}finally{A(!1)}}},ne=async()=>{if(!d.trim()||!c.trim()||!m.trim()){E("First name, last name, and email are required");return}Q(!0),E(null);try{const X={first_name:d.trim(),last_name:c.trim(),email:m.trim(),phone_number:b.trim()||null,role:S,address:w.trim()||null,city:I.trim()||null,postal_code:p.trim()||null,country:V.trim()||null,notes:B.trim()||null,avatar_url:z||null};if(n==="edit"&&r?.id){const{error:ce}=await $.from("users").update(X).eq("id",r.id);if(ce)throw ce}else{const{error:ce}=await $.from("users").insert([X]);if(ce)throw ce}s&&s(),t()}catch(X){console.error("Error saving customer:",X),E(X.message||"Failed to save customer")}finally{Q(!1)}},he=`${d} ${c}`.trim()||"Customer",ie=n==="view";return e.jsx(Le,{open:l,onClose:t,children:e.jsxs(Te,{sx:{maxWidth:700,width:"100%",maxHeight:"90vh",overflow:"auto"},children:[e.jsx(wt,{children:n==="add"?"Add Customer":n==="edit"?"Edit Customer":"Customer Details"}),e.jsxs(St,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(i,{sx:{display:"flex",flexDirection:"row",gap:3,alignItems:"flex-start"},children:[e.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:110},children:[e.jsx(xe,{src:z,alt:he,sx:{width:96,height:96,mb:1},children:!z&&he.substring(0,2).toUpperCase()}),!ie&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},ref:P,onChange:U,disabled:h}),e.jsx(pe,{component:"span",onClick:()=>P.current?.click(),disabled:h,title:"Upload avatar",size:"sm",sx:{mt:1},children:e.jsx(_t,{})})]}),r?.last_login&&e.jsxs(a,{level:"body-xs",sx:{mt:1,textAlign:"center"},children:["Last login:",e.jsx("br",{}),new Date(r.last_login).toLocaleString()]})]}),e.jsx(Ee,{orientation:"vertical",sx:{mx:1,alignSelf:"stretch"}}),e.jsxs(i,{sx:{flex:1,display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(i,{sx:{display:"flex",gap:2},children:[e.jsxs(i,{sx:{flex:1},children:[e.jsx(a,{level:"body-sm",sx:{mb:1},children:"First Name"}),e.jsx(N,{placeholder:"First name",value:d,onChange:X=>o(X.target.value),disabled:ie,required:!0})]}),e.jsxs(i,{sx:{flex:1},children:[e.jsx(a,{level:"body-sm",sx:{mb:1},children:"Last Name"}),e.jsx(N,{placeholder:"Last name",value:c,onChange:X=>x(X.target.value),disabled:ie,required:!0})]})]}),e.jsxs(i,{children:[e.jsx(a,{level:"body-sm",sx:{mb:1},children:"Email"}),e.jsx(N,{placeholder:"Email address",type:"email",value:m,onChange:X=>y(X.target.value),disabled:ie,required:!0})]}),e.jsxs(i,{sx:{display:"flex",gap:2},children:[e.jsxs(i,{sx:{flex:1},children:[e.jsx(a,{level:"body-sm",sx:{mb:1},children:"Phone Number"}),e.jsx(N,{placeholder:"Phone number",type:"tel",value:b,onChange:X=>v(X.target.value),disabled:ie})]}),e.jsxs(i,{sx:{flex:1},children:[e.jsx(a,{level:"body-sm",sx:{mb:1},children:"Customer Tier"}),e.jsxs(je,{value:S,onChange:(X,ce)=>f(ce),disabled:ie,children:[e.jsx(F,{value:"customer",children:"Customer"}),e.jsx(F,{value:"vip",children:"VIP"}),e.jsx(F,{value:"premium",children:"Premium"})]})]})]})]})]}),e.jsxs(i,{children:[e.jsx(a,{level:"title-sm",sx:{mb:2},children:"Address Information"}),e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(i,{children:[e.jsx(a,{level:"body-sm",sx:{mb:1},children:"Street Address"}),e.jsx(N,{placeholder:"Street address",value:w,onChange:X=>g(X.target.value),disabled:ie})]}),e.jsxs(i,{sx:{display:"flex",gap:2},children:[e.jsxs(i,{sx:{flex:1},children:[e.jsx(a,{level:"body-sm",sx:{mb:1},children:"City"}),e.jsx(N,{placeholder:"City",value:I,onChange:X=>C(X.target.value),disabled:ie})]}),e.jsxs(i,{sx:{flex:1},children:[e.jsx(a,{level:"body-sm",sx:{mb:1},children:"Postal Code"}),e.jsx(N,{placeholder:"Postal code",value:p,onChange:X=>k(X.target.value),disabled:ie})]}),e.jsxs(i,{sx:{flex:1},children:[e.jsx(a,{level:"body-sm",sx:{mb:1},children:"Country"}),e.jsx(N,{placeholder:"Country",value:V,onChange:X=>O(X.target.value),disabled:ie})]})]})]})]}),e.jsxs(i,{children:[e.jsx(a,{level:"title-sm",sx:{mb:2},children:"Additional Information"}),e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(i,{children:[e.jsx(a,{level:"body-sm",sx:{mb:1},children:"Avatar URL"}),e.jsx(N,{placeholder:"Avatar image URL",value:z,onChange:X=>L(X.target.value),disabled:ie})]}),e.jsxs(i,{children:[e.jsx(a,{level:"body-sm",sx:{mb:1},children:"Notes"}),e.jsx($t,{placeholder:"Customer notes or special instructions...",value:B,onChange:X=>j(X.target.value),disabled:ie,minRows:3})]})]})]}),H&&e.jsx(a,{color:"danger",sx:{mt:1},children:H})]}),e.jsxs(Ct,{children:[e.jsx(q,{variant:"plain",onClick:t,disabled:W||h,children:"Cancel"}),!ie&&e.jsxs(q,{onClick:ne,disabled:W||h||!d.trim()||!c.trim()||!m.trim(),loading:W,children:[n==="edit"?"Update":"Create"," Customer"]})]})]})})}const et={fontSize:le.sizes.small},lt={...et,fontWeight:600,borderBottom:"1.5px solid #e0e0e0",background:"inherit"},lr=l=>{switch(l?.toLowerCase()){case"customer":return"primary";case"vip":return"warning";case"premium":return"success";default:return"neutral"}},nr=(l,t,r)=>{const s=`${l||""} ${t||""}`.trim()||r;let d=0;for(let c=0;c<s.length;c++)d=s.charCodeAt(c)+((d<<5)-d);const o=["primary","success","warning","danger","neutral"];return o[Math.abs(d)%o.length]},ir=(l,t,r)=>{if(l||t){const n=l?.[0]||"",s=t?.[0]||"";return(n+s).toUpperCase()}return r.substring(0,2).toUpperCase()};function mn({onEdit:l,onView:t}){return e.jsxs(ms,{children:[e.jsx(gs,{slots:{root:pe},slotProps:{root:{variant:"plain",color:"neutral",size:"sm"}},children:e.jsx(Ss,{})}),e.jsxs(fs,{size:"sm",sx:{minWidth:140},children:[e.jsx(We,{onClick:t,children:"View Orders"}),e.jsx(We,{onClick:l,children:"Edit Customer"}),e.jsx(We,{children:"Send Message"}),e.jsx(We,{color:"danger",children:"Deactivate"})]})]})}const gn=()=>{const{isMobile:l}=Pe(),[t,r]=u.useState([]),[n,s]=u.useState(!1),[d,o]=u.useState(null),[c,x]=u.useState(""),[m,y]=u.useState("all"),[b,v]=u.useState(!1),[S,f]=u.useState(),[w,g]=u.useState("add"),I=async()=>{s(!0),o(null);try{const{data:h,error:A}=await $.from("users").select("*").in("role",["customer","vip","premium",null]);if(A)throw A;if(h){const H=h.map(E=>({id:E.id,first_name:E.first_name||null,last_name:E.last_name||null,email:E.email,role:E.role||"customer",created_at:E.created_at||null,last_login:E.last_login||null,phone_number:E.phone_number||null,avatar_url:E.avatar_url||null}));r(H)}}catch(h){console.error("Error fetching customers:",h),o(h.message||"Failed to fetch customers")}finally{s(!1)}},C=()=>{f(void 0),g("add"),v(!0)},p=h=>{f(h),g("edit"),v(!0)},k=h=>{f(h),g("view"),v(!0)},V=()=>{v(!1),f(void 0)},O=()=>{I()},B=h=>({id:h.id,first_name:h.first_name||void 0,last_name:h.last_name||void 0,email:h.email,role:h.role,avatar_url:h.avatar_url||void 0,last_login:h.last_login||void 0,phone_number:h.phone_number||void 0}),j=Array.from(new Set(t.map(h=>h.role).filter(Boolean))),L=[...t.filter(h=>{const H=`${h.first_name||""} ${h.last_name||""}`.trim().toLowerCase().includes(c.toLowerCase())||h.email.toLowerCase().includes(c.toLowerCase()),E=m==="all"||h.role===m;return H&&E})].sort((h,A)=>{const H=`${h.first_name||""} ${h.last_name||""}`.trim()||h.email,E=`${A.first_name||""} ${A.last_name||""}`.trim()||A.email;return H.localeCompare(E)});u.useEffect(()=>{I()},[]);const W=()=>e.jsxs(i,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(ke,{padding:"medium",children:[e.jsx(a,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Customers"}),e.jsxs(i,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(N,{placeholder:"Search customers...",value:c,onChange:h=>x(h.target.value),startDecorator:e.jsx(Se,{}),sx:{flex:1}}),e.jsxs(je,{placeholder:"Type",value:m,onChange:(h,A)=>y(A??"all"),sx:{minWidth:120},children:[e.jsx(F,{value:"all",children:"All"}),j.map(h=>e.jsx(F,{value:h,children:h},h))]})]}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(be,{}),onClick:C,sx:{width:"100%",mb:2},children:"Add Customer"})]}),n&&e.jsx(Ie,{}),d&&e.jsx(i,{sx:{p:2},children:e.jsxs(a,{color:"danger",children:["Error: ",d]})}),e.jsx(i,{children:L.length===0?e.jsx(i,{sx:{textAlign:"center",py:6},children:e.jsx(a,{color:"neutral",children:"No customers found"})}):L.map(h=>e.jsx(i,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(xe,{size:"md",src:h.avatar_url||void 0,color:nr(h.first_name,h.last_name,h.email),sx:{flexShrink:0},children:!h.avatar_url&&ir(h.first_name,h.last_name,h.email)}),e.jsxs(i,{sx:{flex:1,minWidth:0},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(a,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:`${h.first_name||""} ${h.last_name||""}`.trim()||"Unnamed Customer"}),h.role&&e.jsx(oe,{size:"sm",color:lr(h.role),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content",textTransform:"capitalize"},children:h.role})]}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(Ve,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsx(a,{level:"body-xs",color:"neutral",children:h.email})]}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:.5},children:[h.phone_number&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(dt,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsx(a,{level:"body-xs",color:"neutral",children:h.phone_number})]}),h.last_login&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Gt,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsx(a,{level:"body-xs",color:"neutral",children:new Date(h.last_login).toLocaleDateString()})]})]}),h.created_at&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(ws,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsxs(a,{level:"body-xs",color:"neutral",children:["Joined ",new Date(h.created_at).toLocaleDateString()]})]})]})]})},h.id))})]}),Q=()=>e.jsxs(ke,{variant:"table-page",children:[e.jsx(a,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Customers"}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(N,{placeholder:"Search customers...",sx:{flex:1},value:c,onChange:h=>x(h.target.value),startDecorator:e.jsx(Se,{})}),e.jsxs(je,{placeholder:"Filter type",value:m,onChange:(h,A)=>y(A??"all"),sx:{minWidth:160},children:[e.jsx(F,{value:"all",children:"All Types"}),j.map(h=>e.jsx(F,{value:h,children:h},h))]}),e.jsx(q,{onClick:C,variant:"solid",startDecorator:e.jsx(be,{}),children:"Add Customer"})]}),e.jsxs(ue,{sx:{overflow:"visible"},children:[n&&e.jsx(Ie,{}),d&&e.jsxs(a,{color:"danger",children:["Error: ",d]}),e.jsxs(Be,{"aria-label":"Customers",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:lt,children:"Name"}),e.jsx("th",{style:lt,children:"Email"}),e.jsx("th",{style:lt,children:"Type"}),e.jsx("th",{style:lt,children:"Joined"}),e.jsx("th",{style:lt,children:"Last Login"}),e.jsx("th",{style:lt,children:"Phone"}),e.jsx("th",{style:{width:120,...lt},children:"Actions"})]})}),e.jsxs("tbody",{children:[L.length===0&&!n&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...et},children:"No customers found."})}),L.map(h=>e.jsxs("tr",{style:{cursor:"pointer",height:48},children:[e.jsx("td",{style:et,children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(xe,{size:"sm",src:h.avatar_url||void 0,color:nr(h.first_name,h.last_name,h.email),children:!h.avatar_url&&ir(h.first_name,h.last_name,h.email)}),e.jsx(a,{level:"body-sm",fontWeight:"md",children:`${h.first_name||""} ${h.last_name||""}`.trim()||"Unnamed Customer"})]})}),e.jsx("td",{style:et,children:h.email}),e.jsx("td",{style:et,children:h.role?e.jsx(oe,{size:"sm",color:lr(h.role),variant:"soft",sx:{textTransform:"capitalize"},children:h.role}):"-"}),e.jsx("td",{style:et,children:h.created_at?new Date(h.created_at).toLocaleDateString():"-"}),e.jsx("td",{style:et,children:h.last_login?new Date(h.last_login).toLocaleDateString():"-"}),e.jsx("td",{style:et,children:h.phone_number||"-"}),e.jsx("td",{children:e.jsx(mn,{onEdit:()=>p(h),onView:()=>k(h)})})]},h.id))]})]})]})]});return e.jsxs(Fe,{children:[l?e.jsx(W,{}):e.jsx(Q,{}),e.jsx(pn,{open:b,onClose:V,customer:S?B(S):void 0,mode:w,onSaved:O})]})};function fn({open:l,onClose:t,employee:r,mode:n="add",onSaved:s}){const[d,o]=u.useState(r?.first_name||""),[c,x]=u.useState(r?.last_name||""),[m,y]=u.useState(r?.email||""),[b,v]=u.useState(r?.phone_number||""),[S,f]=u.useState(r?.role||"employee"),[w,g]=u.useState(r?.department||""),[I,C]=u.useState(r?.position||""),[p,k]=u.useState(r?.avatar_url||""),[V,O]=u.useState(!1),[B,j]=u.useState(!1),[z,L]=u.useState(null),W=u.useRef(null);u.useEffect(()=>{l&&r?(o(r.first_name||""),x(r.last_name||""),y(r.email||""),v(r.phone_number||""),f(r.role||"employee"),g(r.department||""),C(r.position||""),k(r.avatar_url||"")):l&&n==="add"&&(o(""),x(""),y(""),v(""),f("employee"),g(""),C(""),k("")),L(null)},[l,r,n]);const Q=async E=>{const P=E.target.files?.[0];if(P){if(!P.type.startsWith("image/")){L("Please select a valid image file");return}if(P.size>5*1024*1024){L("Image size must be less than 5MB");return}j(!0),L(null);try{const U=P.name.split(".").pop()?.replace(/\./,"")||"png",ne=`avatars/employee_${Date.now()}.${U}`,he=await $.storage.from("avatars").upload(ne,P,{upsert:!0,contentType:P.type});if(he.error)throw he.error;const{data:{publicUrl:ie}}=$.storage.from("avatars").getPublicUrl(ne);ie&&k(ie)}catch(U){L("Failed to upload avatar. Please try again."),console.error("Avatar upload failed:",U)}finally{j(!1)}}},h=async()=>{if(!d.trim()||!c.trim()||!m.trim()){L("First name, last name, and email are required");return}O(!0),L(null);try{const E={first_name:d.trim(),last_name:c.trim(),email:m.trim(),phone_number:b.trim()||null,role:S,department:w.trim()||null,position:I.trim()||null,avatar_url:p||null};if(n==="edit"&&r?.id){const{error:P}=await $.from("users").update(E).eq("id",r.id);if(P)throw P}else{const{error:P}=await $.from("users").insert([E]);if(P)throw P}s&&s(),t()}catch(E){console.error("Error saving employee:",E),L(E.message||"Failed to save employee")}finally{O(!1)}},A=`${d} ${c}`.trim()||"Employee",H=n==="view";return e.jsx(Le,{open:l,onClose:t,children:e.jsxs(Te,{sx:{maxWidth:600,width:"100%"},children:[e.jsx(wt,{children:n==="add"?"Add Employee":n==="edit"?"Edit Employee":"Employee Details"}),e.jsxs(St,{sx:{display:"flex",flexDirection:"row",gap:3,alignItems:"flex-start"},children:[e.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:110},children:[e.jsx(xe,{src:p,alt:A,sx:{width:96,height:96,mb:1},children:!p&&A.substring(0,2).toUpperCase()}),!H&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},ref:W,onChange:Q,disabled:B}),e.jsx(pe,{component:"span",onClick:()=>W.current?.click(),disabled:B,title:"Upload avatar",size:"sm",sx:{mt:1},children:e.jsx(_t,{})})]}),r?.last_login&&e.jsxs(a,{level:"body-xs",sx:{mt:1,textAlign:"center"},children:["Last login:",e.jsx("br",{}),new Date(r.last_login).toLocaleString()]})]}),e.jsx(Ee,{orientation:"vertical",sx:{mx:1,alignSelf:"stretch"}}),e.jsxs(i,{sx:{flex:1,display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(i,{sx:{display:"flex",gap:2},children:[e.jsxs(i,{sx:{flex:1},children:[e.jsx(a,{level:"body-sm",sx:{mb:1},children:"First Name"}),e.jsx(N,{placeholder:"First name",value:d,onChange:E=>o(E.target.value),disabled:H,required:!0})]}),e.jsxs(i,{sx:{flex:1},children:[e.jsx(a,{level:"body-sm",sx:{mb:1},children:"Last Name"}),e.jsx(N,{placeholder:"Last name",value:c,onChange:E=>x(E.target.value),disabled:H,required:!0})]})]}),e.jsxs(i,{children:[e.jsx(a,{level:"body-sm",sx:{mb:1},children:"Email"}),e.jsx(N,{placeholder:"Email address",type:"email",value:m,onChange:E=>y(E.target.value),disabled:H,required:!0})]}),e.jsxs(i,{children:[e.jsx(a,{level:"body-sm",sx:{mb:1},children:"Phone Number"}),e.jsx(N,{placeholder:"Phone number",type:"tel",value:b,onChange:E=>v(E.target.value),disabled:H})]}),e.jsxs(i,{sx:{display:"flex",gap:2},children:[e.jsxs(i,{sx:{flex:1},children:[e.jsx(a,{level:"body-sm",sx:{mb:1},children:"Role"}),e.jsxs(je,{value:S,onChange:(E,P)=>f(P),disabled:H,children:[e.jsx(F,{value:"employee",children:"Employee"}),e.jsx(F,{value:"staff",children:"Staff"}),e.jsx(F,{value:"manager",children:"Manager"}),e.jsx(F,{value:"admin",children:"Admin"})]})]}),e.jsxs(i,{sx:{flex:1},children:[e.jsx(a,{level:"body-sm",sx:{mb:1},children:"Department"}),e.jsx(N,{placeholder:"Department",value:w,onChange:E=>g(E.target.value),disabled:H})]})]}),e.jsxs(i,{children:[e.jsx(a,{level:"body-sm",sx:{mb:1},children:"Position"}),e.jsx(N,{placeholder:"Job position",value:I,onChange:E=>C(E.target.value),disabled:H})]}),e.jsxs(i,{children:[e.jsx(a,{level:"body-sm",sx:{mb:1},children:"Avatar URL"}),e.jsx(N,{placeholder:"Avatar image URL",value:p,onChange:E=>k(E.target.value),disabled:H})]}),z&&e.jsx(a,{color:"danger",sx:{mt:1},children:z})]})]}),e.jsxs(Ct,{children:[e.jsx(q,{variant:"plain",onClick:t,disabled:V||B,children:"Cancel"}),!H&&e.jsxs(q,{onClick:h,disabled:V||B||!d.trim()||!c.trim()||!m.trim(),loading:V,children:[n==="edit"?"Update":"Create"," Employee"]})]})]})})}const tt={fontSize:le.sizes.small},nt={...tt,fontWeight:600,borderBottom:"1.5px solid #e0e0e0",background:"inherit"},ar=l=>{switch(l?.toLowerCase()){case"admin":return"danger";case"manager":return"warning";case"staff":return"success";case"employee":return"primary";case"user":return"neutral";default:return"neutral"}},or=(l,t,r)=>{const s=`${l||""} ${t||""}`.trim()||r;let d=0;for(let c=0;c<s.length;c++)d=s.charCodeAt(c)+((d<<5)-d);const o=["primary","success","warning","danger","neutral"];return o[Math.abs(d)%o.length]},cr=(l,t,r)=>{if(l||t){const n=l?.[0]||"",s=t?.[0]||"";return(n+s).toUpperCase()}return r.substring(0,2).toUpperCase()};function jn({employee:l,onEdit:t,onView:r}){return e.jsxs(ms,{children:[e.jsx(gs,{slots:{root:pe},slotProps:{root:{variant:"plain",color:"neutral",size:"sm"}},children:e.jsx(Ss,{})}),e.jsxs(fs,{size:"sm",sx:{minWidth:140},children:[e.jsx(We,{onClick:()=>t(l),children:"Edit Employee"}),e.jsx(We,{onClick:()=>r(l),children:"View Details"}),e.jsx(We,{children:"Change Role"}),e.jsx(We,{children:"Reset Password"}),e.jsx(We,{children:"Deactivate"}),e.jsx(We,{color:"danger",children:"Remove"})]})]})}const bn=()=>{const{isMobile:l}=Pe(),[t,r]=u.useState([]),[n,s]=u.useState(!1),[d,o]=u.useState(null),[c,x]=u.useState(""),[m,y]=u.useState("all"),[b,v]=u.useState(!1),[S,f]=u.useState(),[w,g]=u.useState("add"),I=async()=>{s(!0),o(null);try{const{data:h,error:A}=await $.from("users").select("*").in("role",["admin","manager","staff","employee","user"]);if(A)throw A;if(h){const H=h.map(E=>({id:E.id,first_name:E.first_name||null,last_name:E.last_name||null,email:E.email,role:E.role||"employee",created_at:E.created_at||null,last_login:E.last_login||null,phone_number:E.phone_number||null,avatar_url:E.avatar_url||null}));r(H)}}catch(h){console.error("Error fetching employees:",h),o(h.message||"Failed to fetch employees")}finally{s(!1)}},C=()=>{f(void 0),g("add"),v(!0)},p=h=>{f(h),g("edit"),v(!0)},k=h=>{f(h),g("view"),v(!0)},V=()=>{v(!1),f(void 0)},O=()=>{I()},B=h=>({id:h.id,first_name:h.first_name||void 0,last_name:h.last_name||void 0,email:h.email,role:h.role,avatar_url:h.avatar_url||void 0,last_login:h.last_login||void 0,phone_number:h.phone_number||void 0}),j=Array.from(new Set(t.map(h=>h.role).filter(Boolean))),L=[...t.filter(h=>{const H=`${h.first_name||""} ${h.last_name||""}`.trim().toLowerCase().includes(c.toLowerCase())||h.email.toLowerCase().includes(c.toLowerCase()),E=m==="all"||h.role===m;return H&&E})].sort((h,A)=>{const H=`${h.first_name||""} ${h.last_name||""}`.trim()||h.email,E=`${A.first_name||""} ${A.last_name||""}`.trim()||A.email;return H.localeCompare(E)});u.useEffect(()=>{I()},[]);const W=()=>e.jsxs(i,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(ke,{padding:"medium",children:[e.jsx(a,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Employees"}),e.jsxs(i,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(N,{placeholder:"Search employees...",value:c,onChange:h=>x(h.target.value),startDecorator:e.jsx(Se,{}),sx:{flex:1}}),e.jsxs(je,{placeholder:"Role",value:m,onChange:(h,A)=>y(A??"all"),sx:{minWidth:120},children:[e.jsx(F,{value:"all",children:"All"}),j.map(h=>e.jsx(F,{value:h,children:h},h))]})]}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(be,{}),onClick:C,sx:{width:"100%",mb:2},children:"Add Employee"})]}),n&&e.jsx(Ie,{}),d&&e.jsx(i,{sx:{p:2},children:e.jsxs(a,{color:"danger",children:["Error: ",d]})}),e.jsx(i,{children:L.length===0?e.jsx(i,{sx:{textAlign:"center",py:6},children:e.jsx(a,{color:"neutral",children:"No employees found"})}):L.map(h=>e.jsx(i,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(xe,{size:"md",src:h.avatar_url||void 0,color:or(h.first_name,h.last_name,h.email),sx:{flexShrink:0},children:!h.avatar_url&&cr(h.first_name,h.last_name,h.email)}),e.jsxs(i,{sx:{flex:1,minWidth:0},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(a,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:`${h.first_name||""} ${h.last_name||""}`.trim()||"Unnamed Employee"}),h.role&&e.jsx(oe,{size:"sm",color:ar(h.role),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content",textTransform:"capitalize"},children:h.role})]}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(Ve,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsx(a,{level:"body-xs",color:"neutral",children:h.email})]}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:.5},children:[h.phone_number&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(dt,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsx(a,{level:"body-xs",color:"neutral",children:h.phone_number})]}),h.last_login&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Gt,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsx(a,{level:"body-xs",color:"neutral",children:new Date(h.last_login).toLocaleDateString()})]})]}),h.created_at&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(ws,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsxs(a,{level:"body-xs",color:"neutral",children:["Hired ",new Date(h.created_at).toLocaleDateString()]})]})]})]})},h.id))})]}),Q=()=>e.jsxs(ke,{variant:"table-page",children:[e.jsx(a,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Employees"}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(N,{placeholder:"Search employees...",sx:{flex:1},value:c,onChange:h=>x(h.target.value),startDecorator:e.jsx(Se,{})}),e.jsxs(je,{placeholder:"Filter role",value:m,onChange:(h,A)=>y(A??"all"),sx:{minWidth:160},children:[e.jsx(F,{value:"all",children:"All Roles"}),j.map(h=>e.jsx(F,{value:h,children:h},h))]}),e.jsx(q,{onClick:C,variant:"solid",startDecorator:e.jsx(be,{}),children:"Add Employee"})]}),e.jsxs(ue,{sx:{overflow:"visible"},children:[n&&e.jsx(Ie,{}),d&&e.jsxs(a,{color:"danger",children:["Error: ",d]}),e.jsxs(Be,{"aria-label":"Employees",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:nt,children:"Name"}),e.jsx("th",{style:nt,children:"Email"}),e.jsx("th",{style:nt,children:"Role"}),e.jsx("th",{style:nt,children:"Hired"}),e.jsx("th",{style:nt,children:"Last Login"}),e.jsx("th",{style:nt,children:"Phone"}),e.jsx("th",{style:{width:120,...nt},children:"Actions"})]})}),e.jsxs("tbody",{children:[L.length===0&&!n&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...tt},children:"No employees found."})}),L.map(h=>e.jsxs("tr",{style:{cursor:"pointer",height:48},children:[e.jsx("td",{style:tt,children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(xe,{size:"sm",src:h.avatar_url||void 0,color:or(h.first_name,h.last_name,h.email),children:!h.avatar_url&&cr(h.first_name,h.last_name,h.email)}),e.jsx(a,{level:"body-sm",fontWeight:"md",children:`${h.first_name||""} ${h.last_name||""}`.trim()||"Unnamed Employee"})]})}),e.jsx("td",{style:tt,children:h.email}),e.jsx("td",{style:tt,children:h.role?e.jsx(oe,{size:"sm",color:ar(h.role),variant:"soft",sx:{textTransform:"capitalize"},children:h.role}):"-"}),e.jsx("td",{style:tt,children:h.created_at?new Date(h.created_at).toLocaleDateString():"-"}),e.jsx("td",{style:tt,children:h.last_login?new Date(h.last_login).toLocaleDateString():"-"}),e.jsx("td",{style:tt,children:h.phone_number||"-"}),e.jsx("td",{children:e.jsx(jn,{employee:h,onEdit:p,onView:k})})]},h.id))]})]})]})]});return e.jsxs(Fe,{children:[l?e.jsx(W,{}):e.jsx(Q,{}),e.jsx(fn,{open:b,onClose:V,employee:S?B(S):void 0,mode:w,onSaved:O})]})};function yn({orderId:l,editable:t,onItemsChange:r,initialItems:n=[]}){const[s,d]=u.useState(n),[o,c]=u.useState([]),[x,m]=u.useState(!1);u.useEffect(()=>{m(!0),$.from("Products").select("uuid, ProductName").then(({data:f,error:w})=>{w?console.error("Failed to fetch products:",w.message):c(f||[]),m(!1)})},[]);const y=(f,w,g)=>{d(I=>{const C=I.map((p,k)=>k===f?{...p,[w]:g}:p);return r&&r(C),C})},b=()=>{d(f=>{const w=[...f,{product_id:null,quantity_ordered:1,unit_price:0}];return r&&r(w),w})},v=f=>{d(w=>{const g=w.filter((I,C)=>C!==f);return r&&r(g),g})},S=()=>s.reduce((f,w)=>f+w.quantity_ordered*w.unit_price,0);return e.jsxs(i,{sx:{mt:0},children:[e.jsxs(i,{sx:{display:{xs:"block",md:"none"}},children:[s.length===0?e.jsx(a,{color:"neutral",textAlign:"center",sx:{py:4},children:"No items added yet"}):s.map((f,w)=>e.jsxs(i,{sx:{mb:2,p:2,border:"1px solid",borderColor:"divider",borderRadius:"md"},children:[e.jsxs(i,{sx:{mb:2},children:[e.jsx(a,{level:"body-sm",sx:{mb:1},children:"Product:"}),e.jsx(Nt,{options:o,getOptionLabel:g=>g.ProductName,value:o.find(g=>g.uuid===f.product_id)||null,onChange:(g,I)=>y(w,"product_id",I?I.uuid:null),disabled:!t,sx:{width:"100%"},isOptionEqualToValue:(g,I)=>g.uuid===I.uuid,required:!0})]}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:2},children:[e.jsxs(i,{sx:{flex:1},children:[e.jsx(a,{level:"body-sm",sx:{mb:1},children:"Quantity:"}),e.jsx(N,{type:"number",value:f.quantity_ordered??1,onChange:g=>y(w,"quantity_ordered",Math.max(1,Number(g.target.value))),disabled:!t,sx:{width:"100%"},required:!0})]}),e.jsxs(i,{sx:{flex:1},children:[e.jsx(a,{level:"body-sm",sx:{mb:1},children:"Unit Price:"}),e.jsx(N,{type:"number",value:f.unit_price??0,onChange:g=>y(w,"unit_price",Math.max(0,Number(g.target.value))),disabled:!t,sx:{width:"100%"},required:!0})]})]}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(i,{children:[e.jsx(a,{level:"body-sm",color:"neutral",children:"Total:"}),e.jsx(a,{level:"title-sm",children:fe(f.quantity_ordered*f.unit_price)})]}),t&&e.jsx(q,{size:"sm",color:"danger",onClick:()=>v(w),children:"Remove"})]})]},w)),s.length>0&&e.jsx(i,{sx:{mt:2,p:2,backgroundColor:"background.level1",borderRadius:"md",border:"1px solid",borderColor:"divider"},children:e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(a,{level:"title-sm",sx:{fontWeight:600},children:"Total:"}),e.jsx(a,{level:"title-sm",sx:{fontWeight:600,color:"primary.main"},children:fe(S())})]})}),t&&e.jsx(q,{size:"sm",variant:"soft",onClick:b,sx:{mt:1},fullWidth:!0,children:"Add Item"})]}),e.jsxs(i,{sx:{display:{xs:"none",md:"block"}},children:[e.jsxs(Be,{size:"sm",sx:{minWidth:500,"& th":{padding:"12px 8px",fontSize:"0.875rem",fontWeight:600,borderBottom:"2px solid",borderColor:"divider"},"& td":{padding:"8px",verticalAlign:"middle"}},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"40%"},children:"Product"}),e.jsx("th",{style:{width:"15%",textAlign:"center"},children:"Qty"}),e.jsx("th",{style:{width:"20%",textAlign:"center"},children:"Unit Price"}),e.jsx("th",{style:{width:"15%",textAlign:"right"},children:"Total"}),t&&e.jsx("th",{style:{width:"10%",textAlign:"center"}})]})}),e.jsx("tbody",{children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:t?5:4,style:{textAlign:"center",padding:"2rem",color:"#888"},children:"No items added yet"})}):s.map((f,w)=>e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"8px"},children:e.jsx(Nt,{options:o,getOptionLabel:g=>g.ProductName,value:o.find(g=>g.uuid===f.product_id)||null,onChange:(g,I)=>y(w,"product_id",I?I.uuid:null),disabled:!t,sx:{width:"100%"},isOptionEqualToValue:(g,I)=>g.uuid===I.uuid,required:!0})}),e.jsx("td",{style:{padding:"8px",textAlign:"center"},children:e.jsx(N,{type:"number",value:f.quantity_ordered??1,onChange:g=>y(w,"quantity_ordered",Math.max(1,Number(g.target.value))),disabled:!t,sx:{width:"100%",maxWidth:100},required:!0})}),e.jsx("td",{style:{padding:"8px",textAlign:"center"},children:e.jsx(N,{type:"number",value:f.unit_price??0,onChange:g=>y(w,"unit_price",Math.max(0,Number(g.target.value))),disabled:!t,sx:{width:"100%",maxWidth:120},required:!0})}),e.jsx("td",{style:{padding:"8px",textAlign:"right",fontWeight:500},children:fe(f.quantity_ordered*f.unit_price)}),t&&e.jsx("td",{style:{padding:"8px",textAlign:"center"},children:e.jsx(q,{size:"sm",color:"danger",onClick:()=>v(w),children:"Remove"})})]},w))})]}),t&&e.jsx(q,{size:"sm",variant:"soft",onClick:b,sx:{mt:2},children:"Add Item"})]})]})}const ts=["Pending","Approved","Received","Cancelled"];function Lt({open:l,onClose:t,onCreated:r,mode:n="add",order:s}){const[d,o]=u.useState(s?.order_number||""),[c,x]=u.useState(s?.order_date||new Date().toISOString().slice(0,10)),[m,y]=u.useState(s?.status||"Pending"),[b,v]=u.useState(s?.total?String(s.total):""),[S,f]=u.useState(s?.notes||""),[w,g]=u.useState(s?.supplier_id||null),[I,C]=u.useState(!1),[p,k]=u.useState(null),[V,O]=u.useState([]),[B,j]=u.useState(""),[z,L]=u.useState(!1),[W,Q]=u.useState([{product_id:null,quantity_ordered:1,unit_price:0}]);u.useRef(null),u.useEffect(()=>{l?(console.log("[DialogPurchaseOrder] Modal opened"),$.from("Suppliers").select("id, name").then(({data:P})=>{O(P||[])}),(n==="edit"||n==="view")&&s?.id?$.from("purchaseorderitems").select("*").eq("purchase_order_id",s.id).then(({data:P})=>{Q(P||[])}):n==="add"&&Q([{product_id:null,quantity_ordered:1,unit_price:0}])):console.log("[DialogPurchaseOrder] Modal closed")},[l,n,s]),u.useEffect(()=>{l&&s?(o(s.order_number||""),x(s.order_date||new Date().toISOString().slice(0,10)),y(s.status||"Pending"),v(s.total?String(s.total):""),f(s.notes||""),g(s.supplier_id||null)):l&&n==="add"&&(o(""),x(new Date().toISOString().slice(0,10)),y("Pending"),v(""),f(""),g(null),j(""))},[l,s,n]);const h=async P=>{console.log("[DialogPurchaseOrder] handleSupplierAdded called");const{data:U}=await $.from("Suppliers").select("id, name");O(U||[]),P&&(g(String(P)),console.log("[DialogPurchaseOrder] New supplier set:",P)),L(!1),console.log("[DialogPurchaseOrder] DialogSupplier closed")},A=()=>{const P=new Date().toISOString().slice(0,10).replace(/-/g,""),U=Math.floor(1e3+Math.random()*9e3);return`PO-${P}-${U}`},H=()=>W.reduce((P,U)=>P+U.quantity_ordered*U.unit_price,0);u.useEffect(()=>{const P=H();v(P.toString())},[W]);const E=async()=>{console.log("[DialogPurchaseOrder] handleSave called"),C(!0),k(null);const P={order_date:c,status:m,notes:S,supplier_id:w,total:b?parseFloat(b):null};n==="edit"?P.order_number=d:n==="add"&&(P.order_number=A());let U,ne=s?.id;if(n==="add"?(U=await $.from("PurchaseOrders").insert([P]).select(),!U.error&&U.data&&U.data[0]&&(ne=U.data[0].id)):s&&(U=await $.from("PurchaseOrders").update(P).eq("id",s.id)),U&&!U.error&&n==="add"&&ne&&W.length>0){const he=W.filter(X=>X.product_id).map(X=>Xl({purchase_order_id:ne,product_id:X.product_id,quantity_ordered:X.quantity_ordered,unit_price:X.unit_price,notes:X.notes||null}));if(he.length===0){k("Please select a product for each item before saving."),C(!1);return}const ie=await $.from("purchaseorderitems").insert(he);if(ie.error){k("Failed to save items: "+ie.error.message),C(!1);return}}C(!1),U?.error?(k(U.error.message),console.log("[DialogPurchaseOrder] Save error:",U.error.message)):(r(),t(),o(""),x(new Date().toISOString().slice(0,10)),y("Pending"),v(""),f(""),g(null),j(""),console.log("[DialogPurchaseOrder] Purchase order saved and modal closed"))};return e.jsx(Le,{open:l,onClose:t,"aria-labelledby":"purchase-order-form-title",children:e.jsxs(Te,{size:"lg",sx:{width:{xs:"100vw",md:"90vw"},maxWidth:{xs:"none",md:1200},height:{xs:"100vh",md:"90vh"},maxHeight:{xs:"none",md:800},overflow:"hidden",display:"flex",flexDirection:"column",m:0,borderRadius:{xs:0,md:"md"},p:0},children:[e.jsxs(i,{sx:{display:{xs:"none",md:"flex"},justifyContent:"space-between",alignItems:"center",p:2,borderBottom:"1px solid",borderColor:"divider"},children:[e.jsxs(a,{id:"purchase-order-form-title",level:"title-md",children:[n==="edit"?"Edit":n==="view"?"View":"Add"," Purchase Order"]}),e.jsx(Ue,{})]}),e.jsxs(i,{sx:{display:{xs:"flex",md:"none"},justifyContent:"space-between",alignItems:"center",p:2,borderBottom:"1px solid",borderColor:"divider"},children:[e.jsxs(a,{id:"purchase-order-form-title",level:"title-md",children:[n==="edit"?"Edit":n==="view"?"View":"Add"," Purchase Order"]}),e.jsx(Ue,{})]}),e.jsxs(i,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},height:"100%",overflow:"hidden"},children:[e.jsxs(i,{sx:{width:{xs:"100%",md:"400px"},borderRight:{xs:"none",md:"1px solid"},borderBottom:{xs:"1px solid",md:"none"},borderColor:"divider",p:3,overflow:"auto",flexShrink:0},children:[e.jsx(a,{level:"title-sm",sx:{mb:2},children:"Order Information"}),e.jsxs("form",{onSubmit:P=>{P.preventDefault(),n!=="view"&&E()},children:[e.jsx(N,{type:"date",value:c,onChange:P=>x(P.target.value),sx:{mb:2},required:!0,readOnly:n==="view",startDecorator:e.jsx(a,{level:"body-sm",sx:{minWidth:80},children:"Date:"})}),(n==="edit"||n==="view")&&e.jsxs(i,{sx:{mb:2},children:[e.jsx(a,{level:"body-sm",sx:{mb:1},children:"Status:"}),e.jsx(oe,{variant:"soft",color:m==="Approved"?"success":m==="Received"?"primary":m==="Cancelled"?"danger":"neutral",sx:{textTransform:"capitalize",fontWeight:600,fontSize:"md",px:1.5,py:.5},onClick:n==="view"?void 0:()=>{const P=ts.indexOf(m);y(ts[(P+1)%ts.length])},children:m})]}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(a,{level:"body-sm",sx:{mb:1},children:"Supplier:"}),e.jsxs(i,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Nt,{options:V,getOptionLabel:P=>P.name,value:V.find(P=>P.id===w)||null,onChange:(P,U)=>g(U?U.id:null),inputValue:B,onInputChange:(P,U)=>j(U),placeholder:"Select supplier",sx:{flex:1,mb:0},isOptionEqualToValue:(P,U)=>P.id===U.id,required:!0,readOnly:n==="view"}),n!=="view"&&e.jsx(pe,{color:"primary",sx:{ml:1},onClick:()=>L(!0),children:e.jsx(be,{})})]})]}),(n==="edit"||n==="view")&&e.jsxs(e.Fragment,{children:[e.jsx(N,{placeholder:"Order Number",value:d,onChange:P=>o(P.target.value),sx:{mb:2},readOnly:n==="view",startDecorator:e.jsx(a,{level:"body-sm",sx:{minWidth:80},children:"Number:"})}),e.jsx(N,{placeholder:"Total",value:b,onChange:P=>v(P.target.value),sx:{mb:2},type:"number",readOnly:!0,startDecorator:e.jsx(a,{level:"body-sm",sx:{minWidth:80},children:"Total:"})})]}),e.jsx(N,{placeholder:"Notes",value:S,onChange:P=>f(P.target.value),sx:{mb:2},readOnly:n==="view",startDecorator:e.jsx(a,{level:"body-sm",sx:{minWidth:80},children:"Notes:"})}),n!=="view"&&e.jsxs(i,{sx:{mt:3},children:[p&&e.jsx(a,{color:"danger",sx:{mb:2},children:p}),e.jsx(q,{type:"submit",loading:I,disabled:I,variant:"solid",fullWidth:!0,children:"Save Purchase Order"})]})]}),e.jsx(Ps,{open:z,onClose:()=>L(!1),onSaved:h,mode:"add"})]}),e.jsxs(i,{sx:{flex:1,display:"flex",flexDirection:"column",minHeight:0,overflow:"hidden"},children:[e.jsx(i,{sx:{p:1,borderBottom:"0px solid",borderColor:"divider",flexShrink:0},children:e.jsx(a,{level:"title-sm",children:"Order Items"})}),e.jsx(i,{sx:{flex:1,overflow:"auto",p:2,paddingBottom:0},children:e.jsx(yn,{orderId:s?.id,editable:n==="add"||n==="edit",onItemsChange:Q,initialItems:W})}),e.jsx(i,{sx:{borderTop:"1px solid",borderColor:"divider",p:3,flexShrink:0,backgroundColor:"background.level1"},children:e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",maxWidth:{xs:"100%",md:"400px"},ml:"auto"},children:[e.jsx(a,{level:"title-md",sx:{fontWeight:600},children:"Total:"}),e.jsx(a,{level:"title-md",sx:{fontWeight:600,color:"primary.main"},children:fe(H())})]})})]})]})]})})}function Ps({open:l,onClose:t,onSaved:r,mode:n="add",supplier:s,onDelete:d,onEdit:o}){const[c,x]=u.useState(s?.name||""),[m,y]=u.useState(s?.contact_name||""),[b,v]=u.useState(s?.email||""),[S,f]=u.useState(s?.phone||""),[w,g]=u.useState(s?.address||""),[I,C]=u.useState(s?.image_url||""),[p,k]=u.useState(!1),[V,O]=u.useState(!1),[B,j]=u.useState(null),z=u.useRef(null),[L,W]=u.useState([]),[Q,h]=u.useState(!1),[A,H]=u.useState(null),[E,P]=u.useState(!1);u.useEffect(()=>{l&&(n==="edit"||n==="view")&&s?(x(s.name||""),y(s.contact_name||""),v(s.email||""),f(s.phone||""),g(s.address||""),C(s.image_url||""),n==="view"&&U()):l&&n==="add"&&(x(""),y(""),v(""),f(""),g(""),C(""))},[l,n,s]);const U=async()=>{if(s?.id){h(!0),H(null);try{const{data:Z,error:re}=await $.from("PurchaseOrders").select("id, order_number, order_date, status, total, notes").eq("supplier_id",s.id).order("order_date",{ascending:!1});if(re)throw re;Z&&W(Z)}catch(Z){console.error("Error fetching purchase orders:",Z),H(Z.message||"Failed to fetch purchase orders")}finally{h(!1)}}},ne=()=>{P(!1),n==="view"&&U()},he=async Z=>{const re=Z.target.files?.[0];if(re){if(!re.type.startsWith("image/")){j("Please select a valid image file");return}if(re.size>5*1024*1024){j("Image size must be less than 5MB");return}try{O(!0),j(null);const T=re.name.split(".").pop(),K=`${Date.now()}-${Math.random().toString(36).substring(2)}.${T}`,{data:ye,error:ve}=await $.storage.from("supplierimages").upload(K,re);if(ve)throw ve;const{data:{publicUrl:Ne}}=$.storage.from("supplierimages").getPublicUrl(K);C(Ne)}catch(T){console.error("Error uploading image:",T),j(T.message||"Failed to upload image")}finally{O(!1)}}},ie=async()=>{if(I)try{O(!0);const Z=I.split("/").pop();Z&&await $.storage.from("supplierimages").remove([Z]),C("")}catch(Z){console.error("Error removing image:",Z),j(Z.message||"Failed to remove image")}finally{O(!1)}},X=async()=>{if(!c.trim()||!b.trim()){j("Name and email are required");return}try{k(!0),j(null);const Z={name:c.trim(),contact_name:m.trim()||null,email:b.trim(),phone:S.trim()||null,address:w.trim()||null,image_url:I||null};if(n==="edit"&&s?.id){const{error:re}=await $.from("Suppliers").update(Z).eq("id",s.id);if(re)throw re}else{const{data:re,error:T}=await $.from("Suppliers").insert([Z]).select();if(T)throw T;re?.[0]&&r(re[0].id)}r(),t()}catch(Z){console.error("Error saving supplier:",Z),j(Z.message||"Failed to save supplier")}finally{k(!1)}},ce=async()=>{if(!(!s?.id||!d)&&confirm("Are you sure you want to delete this supplier?"))try{const{error:Z}=await $.from("Suppliers").delete().eq("id",s.id);if(Z)throw Z;d(s.id),t()}catch(Z){j(Z.message||"Failed to delete supplier")}};return e.jsxs(e.Fragment,{children:[e.jsx(Le,{open:l,onClose:t,children:e.jsxs(Te,{sx:{minWidth:n==="view"?{xs:"90vw",sm:"80vw",md:"1000px"}:400,maxWidth:n==="view"?{xs:"95vw",sm:"90vw",md:"1200px"}:500,minHeight:n==="view"?"70vh":"auto",maxHeight:"90vh",overflow:"hidden"},children:[e.jsx(Ue,{}),e.jsxs(a,{level:"title-md",sx:{mb:2},children:[n==="view"?"Supplier Details":n==="edit"?"Edit":"Add",n!=="view"?" Supplier":""]}),n==="view"?e.jsxs(i,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:3,height:"100%",overflow:"hidden"},children:[e.jsxs(i,{sx:{flex:1,display:"flex",flexDirection:"column",gap:3,minWidth:{xs:"100%",md:"340px"},maxWidth:{xs:"100%",md:"420px"},borderRight:{md:"1px solid"},borderColor:"divider",pr:{md:3}},children:[e.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[e.jsx(xe,{size:"lg",src:I,sx:{width:80,height:80},children:!I&&c&&c.substring(0,2).toUpperCase()}),e.jsx(a,{level:"h3",textAlign:"center",children:c})]}),e.jsxs(ue,{variant:"soft",children:[e.jsx(a,{level:"h4",sx:{mb:0},children:"Company"}),e.jsx(Ee,{sx:{mb:0}}),e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(a,{level:"body-md",children:[e.jsx("strong",{children:"Name:"})," ",c]}),e.jsxs(a,{level:"body-md",children:[e.jsx("strong",{children:"Address:"})," ",w||"N/A"]})]})]}),e.jsxs(ue,{variant:"soft",children:[e.jsx(a,{level:"h4",sx:{mb:0},children:"Contact"}),e.jsx(Ee,{sx:{mb:0}}),e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(a,{level:"body-md",children:[e.jsx("strong",{children:"Contact Name:"})," ",m||"N/A"]}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:1},children:[e.jsxs(a,{level:"body-md",sx:{flex:1,minWidth:0},children:[e.jsx("strong",{children:"Email:"})," ",b||"N/A"]}),b&&e.jsx(q,{size:"sm",variant:"outlined",startDecorator:e.jsx(Ve,{}),onClick:()=>window.open(`mailto:${b}`,"_self"),sx:{flexShrink:0},children:"Email"})]}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:1},children:[e.jsxs(a,{level:"body-md",sx:{flex:1,minWidth:0},children:[e.jsx("strong",{children:"Phone:"})," ",S||"N/A"]}),S&&e.jsx(q,{size:"sm",variant:"outlined",startDecorator:e.jsx(dt,{}),onClick:()=>window.open(`tel:${S}`,"_self"),sx:{flexShrink:0},children:"Call"})]})]})]}),e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2,mt:"auto"},children:[e.jsx(q,{variant:"solid",startDecorator:e.jsx(be,{}),onClick:()=>P(!0),sx:{width:"100%"},children:"Add Purchase Order"}),e.jsx(q,{variant:"outlined",startDecorator:e.jsx(ct,{}),onClick:o,sx:{width:"100%"},children:"Edit Supplier"})]})]}),e.jsxs(i,{sx:{flex:2,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(a,{level:"h3",sx:{mb:2},children:"Purchase Orders"}),Q&&e.jsx(a,{children:"Loading purchase orders..."}),A&&e.jsxs(a,{color:"danger",children:["Error: ",A]}),e.jsx(i,{sx:{flex:1,overflow:"auto"},children:e.jsxs(Be,{stickyHeader:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Order #"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Notes"})]})}),e.jsxs("tbody",{children:[L.map(Z=>e.jsxs("tr",{children:[e.jsx("td",{children:Z.order_number}),e.jsx("td",{children:Z.order_date}),e.jsx("td",{children:Z.status}),e.jsx("td",{children:Z.total!=null?fe(Z.total):"â€”"}),e.jsx("td",{children:Z.notes||""})]},Z.id)),L.length===0&&!Q&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{textAlign:"center",color:"#888"},children:"No purchase orders for this supplier."})})]})]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:3,gap:2},children:[e.jsx(a,{level:"body-sm",children:"Supplier Avatar"}),e.jsxs(i,{sx:{position:"relative"},children:[e.jsx(xe,{size:"lg",src:I,sx:{width:80,height:80},children:!I&&c&&c.substring(0,2).toUpperCase()}),I&&e.jsx(pe,{size:"sm",variant:"solid",color:"danger",sx:{position:"absolute",top:-8,right:-8,width:24,height:24},onClick:ie,children:e.jsx(Cs,{sx:{fontSize:14}})})]}),e.jsxs(i,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx("input",{type:"file",accept:"image/*",onChange:he,style:{display:"none"},ref:z,disabled:V}),e.jsx(q,{variant:"outlined",size:"sm",loading:V,onClick:()=>z.current?.click(),startDecorator:e.jsx(_t,{}),children:I?"Change Image":"Upload Image"})]}),e.jsx(a,{level:"body-xs",color:"neutral",sx:{textAlign:"center"},children:"Max 5MB (JPG, PNG, GIF)"})]}),e.jsxs("form",{onSubmit:Z=>{Z.preventDefault(),Z.stopPropagation(),X()},children:[e.jsx(N,{placeholder:"Name",value:c,onChange:Z=>x(Z.target.value),sx:{mb:2},required:!0}),e.jsx(N,{placeholder:"Contact Name",value:m,onChange:Z=>y(Z.target.value),sx:{mb:2}}),e.jsx(N,{placeholder:"Email",value:b,onChange:Z=>v(Z.target.value),sx:{mb:2},type:"email",required:!0}),e.jsx(N,{placeholder:"Phone",value:S,onChange:Z=>f(Z.target.value),sx:{mb:2},type:"tel"}),e.jsx(N,{placeholder:"Address",value:w,onChange:Z=>g(Z.target.value),sx:{mb:2}}),B&&e.jsx(a,{color:"danger",sx:{mb:1},children:B}),e.jsxs(i,{sx:{display:"flex",gap:1,justifyContent:"space-between"},children:[e.jsx(q,{type:"submit",loading:p,disabled:p,variant:"solid",sx:{flex:1},children:n==="edit"?"Update":"Save"}),n==="edit"&&s?.id&&d&&e.jsx(q,{variant:"outlined",color:"danger",startDecorator:e.jsx(xt,{}),onClick:ce,disabled:p,children:"Delete"})]})]})]})]})}),e.jsx(Lt,{open:E,onClose:()=>P(!1),onCreated:ne,mode:"add",order:s?.id?{id:"",order_number:"",order_date:"",status:"",total:0,notes:"",supplier_id:s.id.toString()}:void 0})]})}const dr=l=>{let t=0;for(let n=0;n<l.length;n++)t=l.charCodeAt(n)+((t<<5)-t);const r=["primary","success","warning","danger","neutral"];return r[Math.abs(t)%r.length]},ur=l=>{const t=l.split(" ");return t.length>=2?(t[0][0]+t[1][0]).toUpperCase():l.substring(0,2).toUpperCase()},vn=()=>{const{isMobile:l}=Pe(),[t,r]=u.useState([]),[n,s]=u.useState(!1),[d,o]=u.useState(null),[c,x]=u.useState(""),[m,y]=u.useState(!1),[b,v]=u.useState(null),[S,f]=u.useState("view"),w=async()=>{s(!0),o(null);try{const{data:j,error:z}=await $.from("Suppliers").select("*");if(z)throw z;j&&r(j)}catch(j){console.error("Error fetching suppliers:",j),o(j.message||"Failed to fetch suppliers")}finally{s(!1)}},g=j=>{v(j),f("view"),y(!0)},I=()=>{f("edit")},C=async j=>{await w()},p=async()=>{y(!1),await w()},V=[...t.filter(j=>j.name?.toLowerCase().includes(c.toLowerCase())||j.contact_name?.toLowerCase().includes(c.toLowerCase())||j.email?.toLowerCase().includes(c.toLowerCase())||j.phone?.toLowerCase().includes(c.toLowerCase())||j.address?.toLowerCase().includes(c.toLowerCase()))].sort((j,z)=>j.name.localeCompare(z.name));u.useEffect(()=>{w()},[]);const O=()=>e.jsxs(i,{sx:{pb:2},children:[e.jsxs(ke,{padding:"medium",children:[e.jsx(a,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Suppliers"}),e.jsx(i,{sx:{display:"flex",gap:1,mb:2},children:e.jsx(N,{placeholder:"Search suppliers...",value:c,onChange:j=>x(j.target.value),startDecorator:e.jsx(Se,{}),sx:{flex:1}})}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(be,{}),onClick:()=>{v(null),f("add"),y(!0)},sx:{width:"100%",mb:2},children:"Add Supplier"})]}),n&&e.jsx(Ie,{}),d&&e.jsx(i,{sx:{p:2},children:e.jsxs(a,{color:"danger",children:["Error: ",d]})}),e.jsx(i,{children:V.length===0?e.jsx(i,{sx:{textAlign:"center",py:6},children:e.jsx(a,{color:"neutral",children:"No suppliers found"})}):V.map(j=>e.jsx(ue,{variant:"outlined",sx:{mx:2,mb:2,cursor:"pointer","&:hover":{boxShadow:"md",transform:"translateY(-2px)",transition:"all 0.2s ease-in-out"}},onClick:()=>g(j),children:e.jsx(De,{sx:{p:2},children:e.jsxs(i,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(xe,{size:"md",src:j.image_url,color:dr(j.name),sx:{flexShrink:0},children:!j.image_url&&ur(j.name)}),e.jsxs(i,{sx:{flex:1,minWidth:0},children:[e.jsx(i,{sx:{mb:1},children:e.jsx(a,{level:"title-md",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:j.name})}),e.jsxs(J,{spacing:.5,children:[j.contact_name&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ot,{sx:{fontSize:16,color:"text.tertiary"}}),e.jsx(a,{level:"body-sm",color:"neutral",children:j.contact_name})]}),j.email&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ve,{sx:{fontSize:16,color:"text.tertiary"}}),e.jsx(a,{level:"body-sm",color:"neutral",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:j.email})]}),j.phone&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(dt,{sx:{fontSize:16,color:"text.tertiary"}}),e.jsx(a,{level:"body-sm",color:"neutral",children:j.phone})]}),j.address&&e.jsxs(i,{sx:{display:"flex",alignItems:"flex-start",gap:1,mt:.5},children:[e.jsx(Zs,{sx:{fontSize:16,color:"text.tertiary",mt:.25}}),e.jsx(a,{level:"body-sm",color:"neutral",sx:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.2},children:j.address})]})]})]})]})})},j.id))})]}),B=()=>e.jsxs(ke,{variant:"table-page",children:[e.jsx(a,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Suppliers"}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:2,alignItems:"center"},children:[e.jsx(N,{placeholder:"Search suppliers...",value:c,onChange:j=>x(j.target.value),startDecorator:e.jsx(Se,{}),sx:{flex:1}}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(be,{}),onClick:()=>{v(null),f("add"),y(!0)},sx:{minWidth:140,flexShrink:0},children:"Add Supplier"})]}),n&&e.jsx(Ie,{sx:{mb:2}}),d&&e.jsxs(a,{color:"danger",sx:{mb:2},children:["Error: ",d]}),e.jsx(we,{container:!0,spacing:2,sx:{width:"calc(100% + 16px)",ml:"-8px",mt:"-8px"},children:V.length===0?e.jsx(we,{xs:12,sx:{width:"100%"},children:e.jsx(i,{sx:{textAlign:"center",py:6},children:e.jsx(a,{color:"neutral",children:"No suppliers found"})})}):V.map(j=>e.jsx(we,{xs:12,sm:6,lg:4,xl:3,sx:{display:"flex",width:"100%"},children:e.jsx(ue,{variant:"outlined",sx:{width:"100%",minHeight:"200px",cursor:"pointer",display:"flex",flexDirection:"column","&:hover":{boxShadow:"md",transform:"translateY(-2px)",transition:"all 0.2s ease-in-out"}},onClick:()=>g(j),children:e.jsxs(De,{sx:{flex:1,display:"flex",flexDirection:"column",p:2},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(xe,{size:"md",src:j.image_url,color:dr(j.name),sx:{flexShrink:0},children:!j.image_url&&ur(j.name)}),e.jsx(a,{level:"title-md",fontWeight:"bold",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1,minWidth:0},children:j.name})]}),e.jsxs(J,{spacing:1.5,sx:{flex:1},children:[j.contact_name&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(ot,{sx:{fontSize:16,color:"text.tertiary",flexShrink:0}}),e.jsx(a,{level:"body-sm",color:"neutral",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1,minWidth:0},children:j.contact_name})]}),j.email&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(Ve,{sx:{fontSize:16,color:"text.tertiary",flexShrink:0}}),e.jsx(a,{level:"body-sm",color:"neutral",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1,minWidth:0},children:j.email})]}),j.phone&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(dt,{sx:{fontSize:16,color:"text.tertiary",flexShrink:0}}),e.jsx(a,{level:"body-sm",color:"neutral",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1,minWidth:0},children:j.phone})]}),j.address&&e.jsxs(i,{sx:{display:"flex",alignItems:"flex-start",gap:1.5},children:[e.jsx(Zs,{sx:{fontSize:16,color:"text.tertiary",flexShrink:0,mt:.25}}),e.jsx(a,{level:"body-sm",color:"neutral",sx:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.3,flex:1,minWidth:0},children:j.address})]})]})]})})},j.id))})]});return e.jsxs(Fe,{children:[l?e.jsx(O,{}):e.jsx(B,{}),e.jsx(Ps,{open:m,onClose:()=>y(!1),supplier:b,onSaved:p,mode:S==="edit"||S==="add"||S==="view"?S:void 0,onDelete:S==="edit"?C:void 0,onEdit:I})]})};function wn({open:l,onClose:t,onSaved:r,mode:n="add",storefront:s,onDelete:d,onEdit:o}){const[c,x]=u.useState(s?.name||""),[m,y]=u.useState(s?.url||""),[b,v]=u.useState(s?.logo_url||""),[S,f]=u.useState(s?.is_online||!1),[w,g]=u.useState(!1),[I,C]=u.useState(!1),[p,k]=u.useState(null),V=u.useRef(null);u.useEffect(()=>{l&&(n==="edit"||n==="view")&&s?(x(s.name||""),y(s.url||""),v(s.logo_url||""),f(s.is_online||!1)):l&&n==="add"&&(x(""),y(""),v(""),f(!1)),k(null)},[l,n,s]);const O=async Q=>{const h=Q.target.files?.[0];if(h){if(!h.type.startsWith("image/")){k("Please select a valid image file");return}if(h.size>5*1024*1024){k("Image size must be less than 5MB");return}try{C(!0),k(null);const A=h.name.split(".").pop(),H=`${Date.now()}-${Math.random().toString(36).substring(2)}.${A}`,{data:E,error:P}=await $.storage.from("storefrontlogos").upload(H,h);if(P)throw P;const{data:{publicUrl:U}}=$.storage.from("storefrontlogos").getPublicUrl(H);v(U)}catch(A){console.error("Error uploading logo:",A),k(A.message||"Failed to upload logo")}finally{C(!1)}}},B=async()=>{if(b)try{C(!0);const Q=b.split("/").pop();Q&&await $.storage.from("storefrontlogos").remove([Q]),v("")}catch(Q){console.error("Error removing logo:",Q),k(Q.message||"Failed to remove logo")}finally{C(!1)}},j=async()=>{if(!c.trim()){k("Name is required");return}try{g(!0),k(null);const Q={name:c.trim(),url:m.trim()||null,logo_url:b||null,is_online:S};if(n==="edit"&&s?.id){const{error:h}=await $.from("storefronts").update(Q).eq("id",s.id);if(h)throw h}else{const{data:h,error:A}=await $.from("storefronts").insert([Q]).select();if(A)throw A;h?.[0]&&r(h[0].id)}r(),t()}catch(Q){console.error("Error saving storefront:",Q),k(Q.message||"Failed to save storefront")}finally{g(!1)}},z=async()=>{if(!(!s?.id||!d)&&confirm("Are you sure you want to delete this storefront?"))try{const{error:Q}=await $.from("storefronts").delete().eq("id",s.id);if(Q)throw Q;d(s.id),t()}catch(Q){k(Q.message||"Failed to delete storefront")}},L=Q=>Q.split(" ").map(h=>h.charAt(0)).join("").toUpperCase().substring(0,2),W=Q=>{const h=["primary","danger","success","warning","neutral"],A=Q.split("").reduce((H,E)=>E.charCodeAt(0)+H,0);return h[A%h.length]};return e.jsx(Le,{open:l,onClose:t,children:e.jsxs(Te,{sx:{minWidth:n==="view"?{xs:"90vw",sm:"600px"}:400,maxWidth:n==="view"?{xs:"95vw",sm:"800px"}:500,maxHeight:"90vh",overflow:"auto"},children:[e.jsx(Ue,{}),e.jsxs(a,{level:"title-md",sx:{mb:2},children:[n==="view"?"Storefront Details":n==="edit"?"Edit":"Add",n!=="view"?" Storefront":""]}),n==="view"?e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:3},children:[e.jsx(xe,{size:"lg",src:b,color:W(c),sx:{width:80,height:80},children:!b&&L(c)}),e.jsxs(i,{sx:{flex:1},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:[e.jsx(a,{level:"title-lg",fontWeight:"bold",children:c}),e.jsx(oe,{size:"sm",color:S?"success":"neutral",startDecorator:e.jsx(ds,{sx:{fontSize:12}}),children:S?"Online":"Offline"})]}),m&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(Wt,{sx:{fontSize:16,color:"text.tertiary"}}),e.jsx(a,{level:"body-sm",color:"neutral",component:"a",href:m.startsWith("http")?m:`https://${m}`,target:"_blank",rel:"noopener noreferrer",sx:{textDecoration:"none","&:hover":{textDecoration:"underline"}},children:m}),e.jsx(pe,{size:"sm",variant:"plain",component:"a",href:m.startsWith("http")?m:`https://${m}`,target:"_blank",rel:"noopener noreferrer",children:e.jsx(_l,{sx:{fontSize:16}})})]})]})]}),e.jsx(Ee,{}),e.jsxs(i,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[o&&e.jsx(q,{variant:"outlined",startDecorator:e.jsx(ct,{}),onClick:o,children:"Edit"}),d&&e.jsx(q,{variant:"outlined",color:"danger",startDecorator:e.jsx(xt,{}),onClick:z,children:"Delete"})]})]}):e.jsxs(J,{spacing:2,children:[e.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[e.jsx(xe,{size:"lg",src:b,color:c?W(c):"neutral",sx:{width:80,height:80},children:!b&&c&&L(c)}),e.jsxs(i,{sx:{display:"flex",gap:1},children:[e.jsx("input",{type:"file",accept:"image/*",onChange:O,style:{display:"none"},ref:V}),e.jsx(q,{size:"sm",variant:"outlined",startDecorator:e.jsx(_t,{}),onClick:()=>V.current?.click(),disabled:I,loading:I,children:"Upload Logo"}),b&&e.jsx(pe,{size:"sm",variant:"outlined",color:"danger",onClick:B,disabled:I,children:e.jsx(Cs,{})})]})]}),e.jsxs(se,{required:!0,children:[e.jsx(ee,{children:"Name"}),e.jsx(N,{value:c,onChange:Q=>x(Q.target.value),placeholder:"Enter storefront name"})]}),e.jsxs(se,{children:[e.jsx(ee,{children:"Website URL"}),e.jsx(N,{value:m,onChange:Q=>y(Q.target.value),placeholder:"https://example.com"})]}),e.jsxs(se,{children:[e.jsx(ee,{children:"Status"}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(rl,{checked:S,onChange:Q=>f(Q.target.checked)}),e.jsx(a,{level:"body-sm",children:S?"Online":"Offline"})]})]}),p&&e.jsx(a,{color:"danger",level:"body-sm",children:p}),e.jsxs(i,{sx:{display:"flex",gap:2,justifyContent:"flex-end",mt:2},children:[e.jsx(q,{variant:"outlined",onClick:t,children:"Cancel"}),e.jsxs(q,{variant:"solid",onClick:j,loading:w,disabled:!c.trim(),children:[n==="edit"?"Update":"Add"," Storefront"]})]})]})]})})}const hr=l=>{const t=["primary","danger","success","warning","neutral"],r=l.split("").reduce((n,s)=>s.charCodeAt(0)+n,0);return t[r%t.length]},xr=l=>l.split(" ").map(t=>t.charAt(0)).join("").toUpperCase().substring(0,2),Sn=()=>{const[l,t]=u.useState([]),[r,n]=u.useState(!0),[s,d]=u.useState(null),[o,c]=u.useState(""),[x,m]=u.useState(!1),[y,b]=u.useState(null),[v,S]=u.useState("add"),{isMobile:f}=Pe(),w=async()=>{try{n(!0);const{data:j,error:z}=await $.from("storefronts").select("*").order("name",{ascending:!0});if(z)throw z;t(j||[])}catch(j){d(j.message)}finally{n(!1)}};u.useEffect(()=>{w()},[]);const I=[...l.filter(j=>j.name.toLowerCase().includes(o.toLowerCase())||j.url&&j.url.toLowerCase().includes(o.toLowerCase()))].sort((j,z)=>j.is_online!==z.is_online?j.is_online?-1:1:j.name.localeCompare(z.name)),C=j=>{b(j),S("view"),m(!0)},p=()=>{S("edit")},k=()=>{w(),m(!1)},V=()=>{w(),m(!1)},O=()=>e.jsxs(i,{sx:{p:2},children:[e.jsx(a,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Storefronts"}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:2,alignItems:"center"},children:[e.jsx(N,{placeholder:"Search storefronts...",value:o,onChange:j=>c(j.target.value),startDecorator:e.jsx(Se,{}),sx:{flex:1}}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(be,{}),onClick:()=>{b(null),S("add"),m(!0)},sx:{minWidth:100,flexShrink:0},children:"Add"})]}),r&&e.jsx(Ie,{sx:{mb:2}}),s&&e.jsxs(a,{color:"danger",sx:{mb:2},children:["Error: ",s]}),e.jsx(i,{children:I.length===0?e.jsx(i,{sx:{textAlign:"center",py:6},children:e.jsx(a,{color:"neutral",children:"No storefronts found"})}):I.map(j=>e.jsx(ue,{variant:"outlined",sx:{mx:2,mb:2,cursor:"pointer","&:hover":{boxShadow:"md",transform:"translateY(-2px)",transition:"all 0.2s ease-in-out"}},onClick:()=>C(j),children:e.jsx(De,{sx:{p:2},children:e.jsxs(i,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(xe,{size:"md",src:j.logo_url,color:hr(j.name),sx:{flexShrink:0},children:!j.logo_url&&xr(j.name)}),e.jsxs(i,{sx:{flex:1,minWidth:0},children:[e.jsxs(i,{sx:{mb:1,display:"flex",alignItems:"center",gap:1},children:[e.jsx(a,{level:"title-md",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1},children:j.name}),e.jsx(oe,{size:"sm",color:j.is_online?"success":"neutral",startDecorator:e.jsx(ds,{sx:{fontSize:12}}),children:j.is_online?"Online":"Offline"})]}),e.jsx(J,{spacing:.5,children:j.url&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Wt,{sx:{fontSize:16,color:"text.tertiary"}}),e.jsx(a,{level:"body-sm",color:"neutral",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:j.url})]})})]})]})})},j.id))})]}),B=()=>e.jsxs(ke,{variant:"table-page",children:[e.jsx(a,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Storefronts"}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:2,alignItems:"center"},children:[e.jsx(N,{placeholder:"Search storefronts...",value:o,onChange:j=>c(j.target.value),startDecorator:e.jsx(Se,{}),sx:{flex:1}}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(be,{}),onClick:()=>{b(null),S("add"),m(!0)},sx:{minWidth:140,flexShrink:0},children:"Add Storefront"})]}),r&&e.jsx(Ie,{sx:{mb:2}}),s&&e.jsxs(a,{color:"danger",sx:{mb:2},children:["Error: ",s]}),e.jsx(we,{container:!0,spacing:2,sx:{width:"calc(100% + 16px)",ml:"-8px",mt:"-8px"},children:I.length===0?e.jsx(we,{xs:12,sx:{width:"100%"},children:e.jsx(i,{sx:{textAlign:"center",py:6},children:e.jsx(a,{color:"neutral",children:"No storefronts found"})})}):I.map(j=>e.jsx(we,{xs:12,sm:6,lg:4,xl:3,sx:{display:"flex",width:"100%"},children:e.jsx(ue,{variant:"outlined",sx:{width:"100%",minHeight:"160px",cursor:"pointer",display:"flex",flexDirection:"column","&:hover":{boxShadow:"md",transform:"translateY(-2px)",transition:"all 0.2s ease-in-out"}},onClick:()=>C(j),children:e.jsxs(De,{sx:{flex:1,display:"flex",flexDirection:"column",p:2},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(xe,{size:"md",src:j.logo_url,color:hr(j.name),sx:{flexShrink:0},children:!j.logo_url&&xr(j.name)}),e.jsx(a,{level:"title-md",fontWeight:"bold",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1,minWidth:0},children:j.name})]}),e.jsxs(J,{spacing:1.5,sx:{flex:1},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(ds,{sx:{fontSize:16,color:j.is_online?"success.main":"neutral.main",flexShrink:0}}),e.jsx(oe,{size:"sm",color:j.is_online?"success":"neutral",children:j.is_online?"Online":"Offline"})]}),j.url&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(Wt,{sx:{fontSize:16,color:"text.tertiary",flexShrink:0}}),e.jsx(a,{level:"body-sm",color:"neutral",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1,minWidth:0},children:j.url})]})]})]})})},j.id))})]});return e.jsxs(Fe,{children:[f?e.jsx(O,{}):e.jsx(B,{}),e.jsx(wn,{open:x,onClose:()=>m(!1),storefront:y,onSaved:k,mode:v==="edit"||v==="add"||v==="view"?v:void 0,onDelete:v==="edit"?V:void 0,onEdit:p})]})},Cn=({open:l,onClose:t,poId:r,orderNumber:n,items:s,onConfirm:d})=>{const[o,c]=u.useState([]),[x,m]=u.useState(!0),[y,b]=u.useState(!1);u.useEffect(()=>{l&&(m(!0),c(s.map(f=>({id:f.id,product_id:f.product_id,ProductName:f.ProductName,quantity_ordered:f.quantity_ordered??0,quantity_received:f.quantity_received??f.quantity_ordered??0}))),m(!1))},[s,l]);const v=(f,w)=>{let g=0;if(w==="")g=0;else if(/^\d+$/.test(w))g=parseInt(w,10);else return;c(I=>I.map(C=>C.id===f?{...C,quantity_received:g}:C))},S=async()=>{try{const f=o.map(({product_id:g,quantity_received:I})=>({product_id:String(g),quantity_received:I})),w=await fetch("/api/receive-purchase-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({purchaseOrderId:String(r),items:f})});if(!w.ok)throw new Error(`HTTP ${w.status}: ${w.statusText}`);d(o.map(g=>({id:g.id,quantity_received:g.quantity_received}))),b(!0),t()}catch(f){console.error("Error receiving purchase order:",f),alert("Failed to receive purchase order. Please try again.")}};return e.jsxs(e.Fragment,{children:[e.jsx(Le,{open:l,onClose:t,"aria-labelledby":"receive-po-dialog-title",children:e.jsxs(Te,{sx:{minWidth:400},children:[e.jsx(Ue,{}),e.jsxs(a,{id:"receive-po-dialog-title",level:"h4",sx:{mb:2},children:["Receive Purchase Order #",n??r]}),x?e.jsx(a,{children:"Loading items..."}):o.length===0?e.jsx(a,{children:"No items found for this purchase order."}):e.jsxs(Be,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Ordered"}),e.jsx("th",{children:"Received"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:o.map(f=>e.jsxs("tr",{children:[e.jsx("td",{children:f.ProductName}),e.jsx("td",{children:f.quantity_ordered}),e.jsx("td",{children:e.jsx(N,{type:"number",value:f.quantity_received===0&&o.find(w=>w.id===f.id)?.quantity_received===0?"0":f.quantity_received,onChange:w=>v(f.id,w.target.value),sx:{width:80},slotProps:{input:{min:0,max:f.quantity_ordered}}})}),e.jsx("td",{style:{textAlign:"center"},children:f.quantity_received===f.quantity_ordered?e.jsx(kt,{sx:{color:"#2e7d32"},titleAccess:"Received in full"}):e.jsx(Rr,{sx:{color:"#d32f2f"},titleAccess:"Not fully received"})})]},f.id))})]}),e.jsxs(i,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:3},children:[e.jsx(q,{variant:"plain",onClick:t,children:"Cancel"}),e.jsx(q,{variant:"solid",onClick:S,children:"Receive"})]})]})}),e.jsx(Vt,{open:y,autoHideDuration:3e3,onClose:()=>b(!1),color:"success",variant:"soft",anchorOrigin:{vertical:"top",horizontal:"center"},children:"Purchase order received successfully!"})]})};function kn({open:l,onClose:t,order:r,onConfirm:n}){const[s,d]=u.useState(null),[o,c]=u.useState(!1),[x,m]=u.useState(!1),[y,b]=u.useState(null),[v,S]=u.useState(!1),[f,w]=u.useState(""),[g,I]=u.useState("");u.useEffect(()=>{l&&r?.supplier_id&&C()},[l,r]);const C=async()=>{if(r?.supplier_id){c(!0),b(null);try{const{data:O,error:B}=await $.from("Suppliers").select("*").eq("id",r.supplier_id).single();if(B)throw B;d(O);const{data:{user:j}}=await $.auth.getUser();j?.email&&I(j.email)}catch(O){console.error("Error fetching data:",O),b(O.message||"Failed to fetch supplier information")}finally{c(!1)}}},p=async()=>{if(!(!r||!s)){m(!0),b(null);try{const{error:O}=await $.from("PurchaseOrders").update({status:"Ordered"}).eq("id",r.id);if(O)throw O;console.log("Purchase order would be emailed to:",{to:s.email,cc:k(),subject:`Purchase Order ${r.order_number}`,orderDetails:r}),n(),t()}catch(O){console.error("Error submitting order:",O),b(O.message||"Failed to submit purchase order")}finally{m(!1)}}},k=()=>{const O=[];if(v&&g&&O.push(g),f.trim()){const B=f.split(",").map(j=>j.trim()).filter(j=>j.length>0);O.push(...B)}return O},V=()=>{S(!1),w(""),d(null),b(null),t()};return r?e.jsx(Le,{open:l,onClose:V,children:e.jsxs(Te,{size:"md",sx:{maxWidth:600,width:"100%"},children:[e.jsx(Ue,{}),e.jsx(a,{level:"h3",sx:{mb:2},children:"Submit Purchase Order"}),o?e.jsx(i,{sx:{p:3,textAlign:"center"},children:e.jsx(a,{children:"Loading supplier information..."})}):e.jsxs(J,{spacing:3,children:[e.jsxs(Je,{startDecorator:e.jsx(Dl,{}),variant:"soft",color:"warning",children:[e.jsx(a,{level:"title-sm",children:"Email Submission"}),e.jsx(a,{level:"body-sm",children:"This will submit the purchase order via email to the supplier. Make sure all order details are correct before proceeding."})]}),s&&e.jsxs(ue,{variant:"soft",children:[e.jsx(a,{level:"title-md",sx:{mb:2},children:"Supplier Information"}),e.jsxs(J,{spacing:2,children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Il,{sx:{color:"text.tertiary"}}),e.jsxs(i,{children:[e.jsx(a,{level:"body-sm",color:"neutral",children:"Company"}),e.jsx(a,{level:"title-sm",children:s.name})]})]}),s.contact_name&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ot,{sx:{color:"text.tertiary"}}),e.jsxs(i,{children:[e.jsx(a,{level:"body-sm",color:"neutral",children:"Contact Person"}),e.jsx(a,{level:"title-sm",children:s.contact_name})]})]}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Ve,{sx:{color:"text.tertiary"}}),e.jsxs(i,{children:[e.jsx(a,{level:"body-sm",color:"neutral",children:"Email"}),e.jsx(a,{level:"title-sm",color:s.email?void 0:"danger",children:s.email||"No email address on file"})]})]}),s.phone&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(dt,{sx:{color:"text.tertiary"}}),e.jsxs(i,{children:[e.jsx(a,{level:"body-sm",color:"neutral",children:"Phone"}),e.jsx(a,{level:"title-sm",children:s.phone})]})]})]})]}),e.jsx(Ee,{}),e.jsxs(i,{children:[e.jsx(a,{level:"title-md",sx:{mb:2},children:"Order Details"}),e.jsxs(J,{spacing:1,children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(a,{level:"body-sm",color:"neutral",children:"Order Number:"}),e.jsx(a,{level:"body-sm",children:r.order_number})]}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(a,{level:"body-sm",color:"neutral",children:"Order Date:"}),e.jsx(a,{level:"body-sm",children:new Date(r.order_date).toLocaleDateString()})]}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(a,{level:"body-sm",color:"neutral",children:"Total:"}),e.jsx(a,{level:"body-sm",sx:{fontWeight:"bold"},children:fe(r.total)})]})]})]}),e.jsx(Ee,{}),e.jsxs(i,{children:[e.jsx(a,{level:"title-md",sx:{mb:2},children:"Email Options"}),e.jsxs(J,{spacing:2,children:[g&&e.jsx(bt,{checked:v,onChange:O=>S(O.target.checked),label:`CC me (${g})`}),e.jsxs(se,{children:[e.jsx(ee,{children:"Additional CC Recipients"}),e.jsx(N,{placeholder:"email1@example.com, email2@example.com",value:f,onChange:O=>w(O.target.value),sx:{width:"100%"}}),e.jsx(a,{level:"body-xs",color:"neutral",sx:{mt:.5},children:"Separate multiple email addresses with commas"})]})]})]}),y&&e.jsx(Je,{variant:"soft",color:"danger",children:e.jsx(a,{level:"body-sm",children:y})}),e.jsxs(i,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx(q,{variant:"plain",onClick:V,disabled:x,children:"Cancel"}),e.jsx(q,{variant:"solid",color:"primary",onClick:p,loading:x,disabled:x||!s?.email,startDecorator:e.jsx(Ve,{}),children:"Submit Order"})]})]})]})}):null}const pr={Pending:0,Ordered:1,Approved:2,Received:3,Cancelled:4},st={fontSize:le.sizes.small},it={...st,fontWeight:600,borderBottom:"1.5px solid #e0e0e0",background:"inherit"},zt=l=>{switch(l){case"Pending":return"warning";case"Ordered":return"primary";case"Approved":return"primary";case"Received":return"success";case"Cancelled":return"danger";default:return"neutral"}},_n=l=>{switch(l){case"Pending":return e.jsx(Ys,{});case"Ordered":return e.jsx(yt,{});case"Approved":return e.jsx(yt,{});case"Received":return e.jsx(kt,{});case"Cancelled":return e.jsx(Rr,{});default:return e.jsx(Ys,{})}},Dn=()=>{const{isMobile:l}=Pe(),[t,r]=u.useState([]),[n,s]=u.useState(!1),[d,o]=u.useState(null),[c,x]=u.useState(""),[m,y]=u.useState(""),[b,v]=u.useState(!1),[S,f]=u.useState(!1),[w,g]=u.useState(!1),[I,C]=u.useState(!1),[p,k]=u.useState(null),[V,O]=u.useState([]),[B,j]=u.useState(!1),[z,L]=u.useState(null),[W,Q]=u.useState(!1),h=async()=>{s(!0),o(null);try{const{data:T,error:K}=await $.from("PurchaseOrders").select(`
          id, 
          order_number, 
          order_date, 
          status, 
          total, 
          notes,
          supplier_id,
          Suppliers(name)
        `).order("order_date",{ascending:!1});if(K)throw K;if(T){const ye=T.map(ve=>({...ve,supplier_name:ve.Suppliers?.name||"N/A",Suppliers:void 0}));r(ye)}}catch(T){o(T.message||"Failed to fetch purchase orders")}finally{s(!1)}},A=async T=>{try{const{data:K,error:ye}=await $.from("purchaseorderitems").select("id, product_id, Products(ProductName), quantity_ordered, quantity_received").eq("purchase_order_id",T);if(ye)throw ye;if(K){const ve=K.map(Ne=>({...Ne,ProductName:Ne.Products?.ProductName||"Unknown Product"}));O(ve)}}catch(K){console.error("Error fetching PO items:",K)}},H=async()=>{await h()},E=async(T,K)=>{{const ye=t.find(ve=>ve.id===T);ye&&(k(ye),Q(!0))}},P=async()=>{await h()},U=async T=>{k(T),await A(T.id),g(!0)},ne=async T=>{try{g(!1),k(null),await h()}catch(K){o(K.message||"Failed to receive order")}},he=async T=>{if(T)try{const{data:K,error:ye}=await $.from("Suppliers").select("*").eq("id",T).single();if(ye)throw ye;K&&(L(K),j(!0))}catch(K){console.error("Error fetching supplier:",K),o(K.message||"Failed to fetch supplier details")}},ie=T=>{k(T),T.status==="Pending"?f(!0):C(!0)},ce=[...t.filter(T=>{const K=T.order_number?.toString().toLowerCase().includes(c.toLowerCase())||T.supplier_name?.toLowerCase().includes(c.toLowerCase()),ye=m?T.status===m:!0;return K&&ye})].sort((T,K)=>{const ye=pr[T.status]??99,ve=pr[K.status]??99;return ye!==ve?ye-ve:new Date(K.order_date).getTime()-new Date(T.order_date).getTime()});u.useEffect(()=>{h()},[]);const Z=()=>e.jsxs(i,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(ke,{padding:"medium",children:[e.jsx(a,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Purchase Orders"}),e.jsxs(i,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(N,{placeholder:"Search orders...",value:c,onChange:T=>x(T.target.value),startDecorator:e.jsx(Se,{}),sx:{flex:1}}),e.jsxs(je,{placeholder:"Status",value:m,onChange:(T,K)=>y(K??""),sx:{minWidth:120},children:[e.jsx(F,{value:"",children:"All"}),e.jsx(F,{value:"Pending",children:"Pending"}),e.jsx(F,{value:"Ordered",children:"Ordered"}),e.jsx(F,{value:"Approved",children:"Approved"}),e.jsx(F,{value:"Received",children:"Received"}),e.jsx(F,{value:"Cancelled",children:"Cancelled"})]})]}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(be,{}),onClick:()=>v(!0),sx:{width:"100%",mb:2},children:"Add Purchase Order"})]}),n&&e.jsx(Ie,{}),d&&e.jsx(i,{sx:{p:2},children:e.jsxs(a,{color:"danger",children:["Error: ",d]})}),e.jsx(i,{children:ce.length===0?e.jsx(i,{sx:{textAlign:"center",py:6},children:e.jsx(a,{color:"neutral",children:"No purchase orders found"})}):ce.map(T=>e.jsx(i,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},onClick:()=>ie(T),title:T.status==="Pending"?"Tap to edit (pending orders are editable)":"Tap to view details",children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(i,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${zt(T.status)}.100`,color:`${zt(T.status)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",flexShrink:0},children:_n(T.status)}),e.jsxs(i,{sx:{flex:1,minWidth:0},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(a,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:T.order_number?`Order #${T.order_number}`:e.jsx(a,{component:"span",sx:{color:"neutral.400",fontStyle:"italic"},children:"No order number"})}),e.jsx(oe,{size:"sm",color:zt(T.status),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content"},children:T.status})]}),e.jsxs(a,{level:"body-xs",color:"neutral",sx:{mb:.5},children:[e.jsx(a,{component:"span",sx:{cursor:T.supplier_id?"pointer":"default",color:T.supplier_id?"primary.600":"inherit",textDecoration:T.supplier_id?"underline":"none","&:hover":T.supplier_id?{color:"primary.800"}:{}},onClick:K=>{T.supplier_id&&(K.stopPropagation(),he(T.supplier_id))},children:T.supplier_name})," â€¢ ",new Date(T.order_date).toLocaleDateString()]}),e.jsxs(a,{level:"body-sm",sx:{fontWeight:"bold",color:"text.primary"},children:["Total: ",fe(T.total||0)]}),e.jsx(i,{sx:{display:"flex",gap:1,mt:1},children:T.status==="Pending"?e.jsx(q,{size:"sm",variant:"outlined",onClick:K=>{K.stopPropagation(),E(T.id)},children:"Order"}):e.jsx(q,{size:"sm",variant:"outlined",onClick:K=>{K.stopPropagation(),U(T)},disabled:T.status!=="Approved"&&T.status!=="Ordered",children:"Receive"})})]})]})},T.id))})]}),re=()=>e.jsxs(ke,{variant:"table-page",children:[e.jsx(a,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Purchase Orders"}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(N,{placeholder:"Search purchase orders...",sx:{flex:1},value:c,onChange:T=>x(T.target.value),startDecorator:e.jsx(Se,{})}),e.jsxs(je,{placeholder:"Filter status",value:m,onChange:(T,K)=>y(K??""),sx:{minWidth:160},children:[e.jsx(F,{value:"",children:"All Statuses"}),e.jsx(F,{value:"Pending",children:"Pending"}),e.jsx(F,{value:"Ordered",children:"Ordered"}),e.jsx(F,{value:"Approved",children:"Approved"}),e.jsx(F,{value:"Received",children:"Received"}),e.jsx(F,{value:"Cancelled",children:"Cancelled"})]}),e.jsx(q,{onClick:()=>v(!0),variant:"solid",startDecorator:e.jsx(be,{}),children:"Add Purchase Order"})]}),e.jsxs(ue,{sx:{overflow:"visible"},children:[n&&e.jsx(Ie,{}),d&&e.jsxs(a,{color:"danger",children:["Error: ",d]}),e.jsxs(Be,{"aria-label":"Purchase Orders",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:it,children:"Order Number"}),e.jsx("th",{style:it,children:"Order Date"}),e.jsx("th",{style:it,children:"Status"}),e.jsx("th",{style:it,children:"Total"}),e.jsx("th",{style:it,children:"Supplier"}),e.jsx("th",{style:it,children:"Notes"}),e.jsx("th",{style:{width:120,...it},children:"Actions"})]})}),e.jsxs("tbody",{children:[ce.length===0&&!n&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...st},children:"No purchase orders found."})}),ce.map(T=>e.jsxs("tr",{style:{cursor:"pointer",height:48},onClick:()=>ie(T),title:T.status==="Pending"?"Click to edit (pending orders are editable)":"Click to view details",children:[e.jsx("td",{style:st,children:T.order_number||e.jsx(a,{component:"span",sx:{color:"neutral.400",fontStyle:"italic"},children:"No order number"})}),e.jsx("td",{style:st,children:new Date(T.order_date).toLocaleDateString()}),e.jsx("td",{style:st,children:e.jsx(oe,{size:"sm",color:zt(T.status),variant:"soft",children:T.status})}),e.jsx("td",{style:st,children:fe(T.total||0)}),e.jsx("td",{style:st,children:e.jsx(a,{component:"span",sx:{cursor:T.supplier_id?"pointer":"default",color:T.supplier_id?"primary.600":"inherit",textDecoration:T.supplier_id?"underline":"none",fontSize:le.sizes.small,"&:hover":T.supplier_id?{color:"primary.800"}:{}},onClick:K=>{T.supplier_id&&(K.stopPropagation(),he(T.supplier_id))},children:T.supplier_name})}),e.jsx("td",{style:st,children:T.notes||"-"}),e.jsx("td",{children:T.status==="Pending"?e.jsx(q,{size:"sm",variant:"outlined",onClick:K=>{K.stopPropagation(),E(T.id)},children:"Order"}):e.jsx(q,{size:"sm",variant:"outlined",onClick:K=>{K.stopPropagation(),U(T)},disabled:T.status!=="Approved"&&T.status!=="Ordered",children:"Receive"})})]},T.id))]})]})]})]});return e.jsxs(Fe,{children:[l?e.jsx(Z,{}):e.jsx(re,{}),e.jsx(Lt,{open:b,onClose:()=>v(!1),onCreated:H,mode:"add",order:void 0}),e.jsx(Lt,{open:S,onClose:()=>{f(!1),k(null)},onCreated:H,mode:"edit",order:p?{id:p.id,order_number:p.order_number,order_date:p.order_date,status:p.status,total:p.total,notes:p.notes||"",supplier_id:p.supplier_id||""}:void 0}),e.jsx(Lt,{open:I,onClose:()=>{C(!1),k(null)},onCreated:()=>{},mode:"view",order:p?{id:p.id,order_number:p.order_number,order_date:p.order_date,status:p.status,total:p.total,notes:p.notes||"",supplier_id:p.supplier_id||""}:void 0}),e.jsx(Cn,{open:w&&!!p?.id,onClose:()=>{g(!1),k(null)},poId:p?.id||"",orderNumber:p?.order_number||"",items:V.filter(T=>!!T.id&&!!T.product_id),onConfirm:ne}),e.jsx(Ps,{open:B,onClose:()=>{j(!1),L(null)},supplier:z,onSaved:()=>{},mode:"view",onEdit:()=>{}}),e.jsx(kn,{open:W,onClose:()=>{Q(!1),k(null)},order:p?{id:p.id,order_number:p.order_number,supplier_id:p.supplier_id||"",order_date:p.order_date,total:p.total||0}:null,onConfirm:P})]})};function In({value:l,onChange:t,toggleSidebar:r}){const n=_s(),[s,d]=u.useState(!1),[o,c]=u.useState("Sales");if(n.pathname==="/login")return null;const x=u.useMemo(()=>ll({components:{MuiTableRow:{styleOverrides:{root:{"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}}}}}}),[]);Ql.filter(b=>b.showInMobile);const m=o?Rt[o].filter(b=>b.showInMobile):[],y=async b=>{const{data:v}=await $.auth.getSession();if(!v&&["orders","products","users","suppliers","purchaseorders","tickets","smscampaigns","movements"].includes(b)){console.warn("Authentication required for this page"),t("home");return}t(b)};return e.jsxs(nl,{theme:x,children:[e.jsxs(il,{open:s,onClose:()=>d(!1),children:[e.jsx(al,{children:"Select Area"}),e.jsx(ol,{children:["Sales","Support","Marketing","Operations"].map(b=>e.jsx(Ws,{fullWidth:!0,variant:o===b?"contained":"outlined",onClick:()=>{c(b),d(!1)},sx:{my:1},children:b},b))}),e.jsx(cl,{children:e.jsx(Ws,{onClick:()=>d(!1),children:"Close"})})]}),e.jsx(dl,{sx:{position:"fixed",bottom:0,left:0,right:0,zIndex:9999,backgroundColor:"rgba(0, 0, 255, 0.2)",overflow:"hidden"},children:e.jsx("div",{style:{display:"flex",flexDirection:"row",overflowX:"auto"},children:e.jsxs(ul,{showLabels:!0,value:l,onChange:(b,v)=>{y(v)},sx:{minWidth:"max-content",flex:1},children:[m.map(b=>e.jsx(qs,{label:b.label,icon:b.icon,value:b.value,onClick:()=>y(b.value)},b.value)),e.jsx(qs,{label:o||"",icon:e.jsx(Pl,{}),onClick:b=>{b.stopPropagation(),d(!0)}})]})})})]})}function ss({open:l,onClose:t,onCreated:r}){const[n,s]=u.useState(""),[d,o]=u.useState(""),[c,x]=u.useState(!1),[m,y]=u.useState(null),b=async v=>{v.preventDefault(),x(!0),y(null);const S={subject:n,requester_name:d,status:"Open"};console.log("[ActionDialogTicketCreate] Creating ticket with payload:",S);const{error:f,data:w}=await $.from("tickets").insert(S);f&&(y(f.message||JSON.stringify(f)),console.error("[ActionDialogTicketCreate] Error creating ticket:",f)),x(!1),f||(s(""),o(""),t(),r&&r())};return e.jsx(Le,{open:l,onClose:t,children:e.jsxs(Te,{sx:{minWidth:400},children:[e.jsx(a,{level:"title-md",sx:{mb:2},children:"Create Ticket"}),e.jsxs("form",{onSubmit:b,children:[e.jsx(N,{placeholder:"Subject",value:n,onChange:v=>s(v.target.value),sx:{mb:2},required:!0}),e.jsx(N,{placeholder:"Requester Name",value:d,onChange:v=>o(v.target.value),sx:{mb:2},required:!0}),m&&e.jsx(a,{color:"danger",sx:{mb:1},children:m}),e.jsx(q,{type:"submit",loading:c,disabled:c||!n||!d,variant:"solid",children:"Create"})]})]})})}const Pn=["Refund issued","Replacement sent","Order cancelled","Technical support provided","Information provided","Awaiting customer response","Other"],zn=({open:l,onClose:t,onSubmit:r})=>{const[n,s]=ae.useState(""),[d,o]=ae.useState("");return ae.useEffect(()=>{l||(s(""),o(""))},[l]),e.jsx(Le,{open:l,onClose:t,children:e.jsxs(Te,{children:[e.jsx(wt,{children:"Resolve Ticket"}),e.jsxs(St,{sx:{display:"flex",flexDirection:"column",gap:2,minWidth:320},children:[e.jsx(je,{value:n,onChange:(c,x)=>s(x||""),placeholder:"Select resolution",required:!0,children:Pn.map(c=>e.jsx(F,{value:c,children:c},c))}),e.jsx($t,{minRows:3,placeholder:"Resolution comment to customer...",value:d,onChange:c=>o(c.target.value)})]}),e.jsxs(Ct,{children:[e.jsx(q,{variant:"plain",onClick:t,children:"Cancel"}),e.jsx(q,{variant:"solid",color:"primary",disabled:!n,onClick:()=>{try{r(n,d),t()}catch(c){console.error("Error during form submission:",c)}},children:"Submit"})]})]})})},rs=Is(zn),mr=l=>{if(!l)return"";const t=new Date(l),n=Math.floor((new Date().getTime()-t.getTime())/1e3);if(n<60)return"Just now";const s=Math.floor(n/60);if(s<60)return`${s} min ago`;const d=Math.floor(s/60);if(d<24)return`${d} hour${d>1?"s":""} ago`;const o=Math.floor(d/24);if(o<7)return`${o} day${o>1?"s":""} ago`;const c=Math.floor(o/7);if(c<4)return`${c} week${c>1?"s":""} ago`;const x=Math.floor(o/30);return`${x} month${x>1?"s":""} ago`},pt={Open:{color:"success",label:"Open"},Pending:{color:"warning",label:"Pending"},Closed:{color:"neutral",label:"Closed"}};function On(){const{isMobile:l}=Pe(),[t,r]=u.useState([]),[n,s]=u.useState(null),[d,o]=u.useState([]),[c,x]=u.useState(""),[m,y]=u.useState(""),[b,v]=u.useState("Open"),[S,f]=u.useState(!1),[w,g]=u.useState(!1),[I,C]=u.useState(!1);u.useEffect(()=>{(async()=>{const{data:L,error:W}=await $.from("tickets").select("*").order("created_at",{ascending:!1});W||r(L||[])})()},[]),u.useEffect(()=>{if(!n){o([]);return}(async()=>{const{data:L,error:W}=await $.from("ticketactivities").select("*").eq("ticket_id",n).order("timestamp",{ascending:!0});W||o(L||[])})()},[n]);const p=async()=>{const{data:z,error:L}=await $.from("tickets").select("*").order("created_at",{ascending:!1});L||r(z||[])},k=async()=>{if(c.trim()&&n){console.log("Sending message:",{ticket_id:n,message:c,activity_type:"chat",sender_name:"You"});const{error:z,data:L}=await $.from("ticketactivities").insert({ticket_id:n,message:c,activity_type:"chat",sender_name:"You"}).select();if(z){console.error("Error sending message:",z),alert("Failed to send message: "+z.message);return}console.log("Message sent successfully:",L),x("");const{data:W,error:Q}=await $.from("ticketactivities").select("*").eq("ticket_id",n).order("timestamp",{ascending:!0});Q?console.error("Error fetching activities:",Q):(console.log("Refreshed activities:",W),o(W||[]))}},V=async(z,L)=>{if(n)try{const{error:W}=await $.from("tickets").update({status:"Closed"}).eq("id",n);if(W){console.error("Error updating ticket status:",W),alert("Failed to resolve ticket: "+W.message);return}const{error:Q}=await $.from("ticketactivities").insert({ticket_id:n,message:`Ticket resolved: ${z}${L?` - ${L}`:""}`,activity_type:"chat",sender_name:"You"});Q&&console.error("Error adding resolution activity:",Q),await p();const{data:h}=await $.from("ticketactivities").select("*").eq("ticket_id",n).order("timestamp",{ascending:!0});o(h||[])}catch(W){console.error("Error resolving ticket:",W),alert("Failed to resolve ticket")}},O=z=>{s(z),C(!0)},B=()=>{C(!1),s(null)},j=t.filter(z=>{if(b!=="All"&&z.status!==b)return!1;if(!m)return!0;const L=m.toLowerCase();return z.subject?.toLowerCase().includes(L)||z.requester_name?.toLowerCase().includes(L)||z.status?.toLowerCase().includes(L)});if(l){const z=t.length>0&&t.every(L=>L.status==="Closed")&&b==="Open";if(I&&n){const L=t.find(W=>W.id===n);return e.jsxs(Fe,{children:[e.jsxs(i,{sx:{display:"flex",flexDirection:"column",height:"100vh"},children:[e.jsxs(i,{sx:{px:2,py:1.5,borderBottom:"1px solid",borderColor:"divider",display:"flex",alignItems:"center",gap:2,bgcolor:"background.surface"},children:[e.jsx(pe,{size:"sm",variant:"plain",onClick:B,children:e.jsx(zl,{})}),e.jsx(xe,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:L?.requester_name?.[0]?.toUpperCase()||"?"}),e.jsxs(i,{sx:{flex:1,minWidth:0},children:[e.jsx(a,{level:"title-sm",sx:{fontWeight:600,mb:.5},children:L?.subject||"Untitled"}),e.jsx(a,{level:"body-xs",color:"neutral",children:L?.requester_name})]}),e.jsx(oe,{variant:"soft",size:"sm",color:pt[L?.status||"Open"]?.color,sx:{fontWeight:600},children:pt[L?.status||"Open"]?.label}),L?.status!=="Closed"&&e.jsx(q,{variant:"solid",color:"primary",size:"sm",onClick:()=>g(!0),children:"Resolve"})]}),e.jsx(i,{sx:{flex:1,overflowY:"auto",px:2,py:2},children:e.jsx(J,{spacing:3,children:d.map((W,Q)=>{const h=W.sender_name==="You";return e.jsxs(i,{children:[Q===0||new Date(W.timestamp||"").toDateString()!==new Date(d[Q-1]?.timestamp||"").toDateString()?e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(i,{sx:{flex:1,height:"1px",bgcolor:"divider"}}),e.jsx(a,{level:"body-xs",sx:{mx:2,color:"text.secondary"},children:W.timestamp?new Date(W.timestamp).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}):""}),e.jsx(i,{sx:{flex:1,height:"1px",bgcolor:"divider"}})]}):null,e.jsxs(J,{direction:"row",spacing:1,sx:{alignItems:"flex-start"},children:[!h&&e.jsx(xe,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:W.sender_name?.[0]?.toUpperCase()||"?"}),e.jsx(i,{sx:{flex:1,display:"flex",flexDirection:h?"row-reverse":"row"},children:e.jsxs(i,{sx:{maxWidth:"85%",bgcolor:h?"primary.500":"neutral.50",color:h?"white":"text.primary",borderRadius:h?"18px 18px 4px 18px":"18px 18px 18px 4px",px:2,py:1.5,position:"relative",boxShadow:"sm"},children:[!h&&e.jsx(a,{level:"body-xs",sx:{fontWeight:600,mb:.5,color:h?"white":"text.primary"},children:W.sender_name}),e.jsx(a,{level:"body-sm",sx:{lineHeight:1.4,color:h?"white":"text.primary"},children:W.message})]})}),h&&e.jsx(xe,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:W.sender_name?.[0]?.toUpperCase()||"?"})]}),e.jsx(i,{sx:{display:"flex",justifyContent:h?"flex-end":"flex-start",mt:.5,ml:h?0:5},children:e.jsx(a,{level:"body-xs",sx:{color:"text.tertiary"},children:W.timestamp?new Date(W.timestamp).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):""})})]},W.id)})})}),e.jsx(i,{sx:{px:2,py:1.5,borderTop:"1px solid",borderColor:"divider",bgcolor:"background.surface"},children:e.jsxs(J,{direction:"row",spacing:1,alignItems:"flex-end",children:[e.jsx(i,{sx:{flex:1},children:e.jsx($t,{placeholder:"Type something here...",value:c,onChange:W=>x(W.target.value),minRows:1,maxRows:3,sx:{borderRadius:"20px",border:"1px solid",borderColor:"neutral.300","&:focus-within":{borderColor:"primary.500"},"& textarea":{border:"none",outline:"none",resize:"none",px:2,py:1}},onKeyDown:W=>{W.key==="Enter"&&!W.shiftKey&&(W.preventDefault(),k())}})}),e.jsx(q,{onClick:k,disabled:!c.trim(),variant:"solid",color:"primary",size:"sm",sx:{borderRadius:"20px",minWidth:50,height:36,fontWeight:600},children:"Send"})]})})]}),e.jsx(ss,{open:S,onClose:()=>f(!1),onCreated:p}),e.jsx(rs,{open:w,onClose:()=>g(!1),onSubmit:V})]})}return e.jsxs(Fe,{children:[e.jsxs(i,{sx:{p:2},children:[e.jsx(a,{level:"h2",sx:{mb:3,fontWeight:600},children:"Tickets"}),e.jsxs(J,{spacing:2,sx:{mb:2},children:[e.jsxs(J,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(N,{placeholder:"Search tickets...",startDecorator:e.jsx(Se,{}),value:m,onChange:L=>y(L.target.value),size:"sm",sx:{flex:1}}),e.jsx(pe,{size:"sm",variant:"soft",color:"primary",onClick:()=>f(!0),children:e.jsx(be,{})})]}),e.jsxs(je,{value:b,onChange:(L,W)=>v(W),size:"sm",placeholder:"Filter by status",children:[e.jsx(F,{value:"All",children:"All Tickets"}),e.jsx(F,{value:"Open",children:"Open"}),e.jsx(F,{value:"Pending",children:"Pending"}),e.jsx(F,{value:"Closed",children:"Closed"})]})]}),z?e.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"60vh",gap:2},children:[e.jsx(Ol,{sx:{fontSize:80,color:"primary.500"}}),e.jsx(a,{level:"h3",sx:{fontWeight:700,textAlign:"center"},children:"All done, you can now go to the beach"})]}):e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:0},children:[j.map((L,W)=>e.jsxs(u.Fragment,{children:[e.jsxs(i,{sx:{p:2,display:"flex",alignItems:"flex-start",gap:2,cursor:"pointer",background:"transparent",borderRadius:1,transition:"all 0.2s","&:hover":{bgcolor:"neutral.50"}},onClick:()=>O(L.id),children:[e.jsx(xe,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600,mt:.5},children:L.requester_name?.[0]?.toUpperCase()||"?"}),e.jsxs(i,{sx:{flex:1,minWidth:0},children:[e.jsx(a,{level:"title-sm",sx:{fontWeight:600,mb:.5,wordBreak:"break-word"},children:L.subject||"Untitled"}),e.jsx(a,{level:"body-xs",color:"neutral",sx:{mb:.5,wordBreak:"break-word"},children:L.requester_name}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(a,{level:"body-xs",color:"neutral",children:mr(L.updated_at)}),e.jsx(a,{level:"body-xs",color:"neutral",children:"â€¢"}),e.jsxs(a,{level:"body-xs",color:"neutral",sx:{wordBreak:"break-all"},children:[L.id?.slice(0,8),"..."]})]})]}),e.jsx(oe,{variant:"soft",size:"sm",color:pt[L.status||"Open"]?.color,sx:{fontWeight:600,px:1.5,py:.5,ml:1},children:pt[L.status||"Open"]?.label})]}),W<j.length-1&&e.jsx(Ee,{sx:{my:.5}})]},L.id)),j.length===0&&e.jsx(a,{color:"neutral",sx:{textAlign:"center",mt:4},children:"No tickets found."})]})]}),e.jsx(ss,{open:S,onClose:()=>f(!1),onCreated:p}),e.jsx(rs,{open:w,onClose:()=>g(!1),onSubmit:V})]})}return e.jsxs(i,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[e.jsxs(i,{sx:{display:"flex",flex:1},children:[e.jsxs(i,{sx:{width:390,borderRight:"1px solid",borderColor:"divider",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs(i,{sx:{px:2,py:1,borderBottom:"1px solid",borderColor:"divider",flexShrink:0},children:[e.jsxs(J,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[e.jsxs(J,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(a,{level:"title-lg",children:"Messages"}),e.jsx(oe,{size:"sm",variant:"soft",color:"neutral",children:j.length})]}),e.jsx(pe,{size:"sm",variant:"soft",color:"primary",onClick:()=>f(!0),children:e.jsx(be,{})})]}),e.jsx(N,{placeholder:"Search",startDecorator:e.jsx(Se,{}),value:m,onChange:z=>y(z.target.value),size:"sm",sx:{width:"100%",mb:1}}),e.jsxs(je,{value:b,onChange:(z,L)=>v(L),size:"sm",sx:{width:"100%"},placeholder:"Filter by status",children:[e.jsx(F,{value:"All",children:"All Tickets"}),e.jsx(F,{value:"Open",children:"Open"}),e.jsx(F,{value:"Pending",children:"Pending"}),e.jsx(F,{value:"Closed",children:"Closed"})]})]}),e.jsx(i,{sx:{flex:1,overflowY:"auto",overflowX:"hidden",pt:1},children:e.jsx(is,{size:"sm",sx:{gap:0},children:j.map(z=>e.jsxs(u.Fragment,{children:[e.jsx(as,{sx:{p:0},children:e.jsx(ft,{selected:n===z.id,onClick:()=>s(z.id),sx:{py:1,px:2},children:e.jsxs(J,{direction:"row",spacing:1.5,alignItems:"flex-start",sx:{width:"100%"},children:[e.jsx(i,{sx:{position:"relative"},children:e.jsx(xe,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:z.requester_name?.[0]?.toUpperCase()||"?"})}),e.jsxs(i,{sx:{flex:1,minWidth:0,pr:1},children:[e.jsxs(J,{direction:"row",justifyContent:"space-between",alignItems:"flex-start",sx:{mb:.5},children:[e.jsx(a,{level:"body-md",noWrap:!0,sx:{flex:1,pr:1},children:z.subject||"Untitled"}),z.status&&e.jsx(oe,{size:"sm",color:pt[z.status]?.color,variant:"soft",sx:{flexShrink:0},children:z.status})]}),e.jsx(a,{level:"body-sm",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",mb:.5},children:z.requester_name||""}),e.jsx(i,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(a,{level:"body-xs",sx:{color:"text.tertiary"},children:mr(z.updated_at)})})]})]})})}),e.jsx(hl,{component:"li",sx:{margin:0}})]},z.id))})})]}),e.jsxs(i,{sx:{flex:1,display:"flex",flexDirection:"column"},children:[n&&e.jsx(i,{sx:{px:3,py:2,borderBottom:"1px solid",borderColor:"divider",flexShrink:0},children:e.jsxs(J,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(xe,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:t.find(z=>z.id===n)?.requester_name?.[0]?.toUpperCase()||"?"}),e.jsxs(i,{sx:{flex:1},children:[e.jsx(a,{level:"title-sm",sx:{fontWeight:600},children:t.find(z=>z.id===n)?.requester_name||"Unknown User"}),e.jsx(a,{level:"body-xs",sx:{color:"text.secondary"},children:t.find(z=>z.id===n)?.status||"Unknown Status"})]}),e.jsx(q,{variant:"outlined",size:"sm",sx:{borderRadius:"16px"},children:"View profile"}),t.find(z=>z.id===n)?.status!=="Closed"&&e.jsx(q,{variant:"solid",color:"primary",size:"sm",sx:{borderRadius:"16px"},onClick:()=>g(!0),children:"Resolve"})]})}),e.jsx(i,{sx:{flex:1,overflowY:"auto",px:3,py:2},children:n?e.jsx(J,{spacing:3,children:d.map((z,L)=>{const W=z.sender_name==="You";return e.jsxs(i,{children:[L===0||new Date(z.timestamp||"").toDateString()!==new Date(d[L-1]?.timestamp||"").toDateString()?e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(i,{sx:{flex:1,height:"1px",bgcolor:"divider"}}),e.jsx(a,{level:"body-xs",sx:{mx:2,color:"text.secondary"},children:z.timestamp?new Date(z.timestamp).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}):""}),e.jsx(i,{sx:{flex:1,height:"1px",bgcolor:"divider"}})]}):null,e.jsxs(J,{direction:"row",spacing:1,sx:{alignItems:"flex-start"},children:[!W&&e.jsx(xe,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:z.sender_name?.[0]?.toUpperCase()||"?"}),e.jsx(i,{sx:{flex:1,display:"flex",flexDirection:W?"row-reverse":"row"},children:e.jsxs(i,{sx:{maxWidth:"70%",bgcolor:W?"primary.500":"neutral.50",color:W?"white":"text.primary",borderRadius:W?"18px 18px 4px 18px":"18px 18px 18px 4px",px:2,py:1.5,position:"relative",boxShadow:"sm"},children:[!W&&e.jsx(a,{level:"body-xs",sx:{fontWeight:600,mb:.5,color:W?"white":"text.primary"},children:z.sender_name}),e.jsx(a,{level:"body-sm",sx:{lineHeight:1.4,color:W?"white":"text.primary"},children:z.message})]})}),W&&e.jsx(xe,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:z.sender_name?.[0]?.toUpperCase()||"?"})]}),e.jsx(i,{sx:{display:"flex",justifyContent:W?"flex-end":"flex-start",mt:.5,ml:W?0:5},children:e.jsx(a,{level:"body-xs",sx:{color:"text.tertiary"},children:z.timestamp?new Date(z.timestamp).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):""})})]},z.id)})}):e.jsx(i,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx(a,{level:"body-md",sx:{color:"text.secondary"},children:"Select a ticket to view messages"})})}),n&&e.jsx(i,{sx:{px:3,py:2,borderTop:"1px solid",borderColor:"divider",flexShrink:0},children:e.jsxs(J,{direction:"row",spacing:1,alignItems:"flex-end",children:[e.jsx(i,{sx:{flex:1},children:e.jsx($t,{placeholder:"Type something here...",value:c,onChange:z=>x(z.target.value),minRows:1,maxRows:4,sx:{borderRadius:"20px",border:"1px solid",borderColor:"neutral.300","&:focus-within":{borderColor:"primary.500"},"& textarea":{border:"none",outline:"none",resize:"none",px:2,py:1}},onKeyDown:z=>{z.key==="Enter"&&!z.shiftKey&&(z.preventDefault(),k())}})}),e.jsx(q,{onClick:k,disabled:!c.trim(),variant:"solid",color:"primary",sx:{borderRadius:"20px",minWidth:60,height:40,fontWeight:600},children:"Send"})]})})]})]}),e.jsx(ss,{open:S,onClose:()=>f(!1),onCreated:p}),e.jsx(rs,{open:w,onClose:()=>g(!1),onSubmit:V})]})}const gr={draft:0,scheduled:1,sent:2,failed:3},Ge={fontSize:le.sizes.small},at={...Ge,fontWeight:600,borderBottom:"1.5px solid #e0e0e0",background:"inherit"},Ot=l=>{switch(l){case"draft":return"neutral";case"scheduled":return"warning";case"sent":return"success";case"failed":return"danger";default:return"neutral"}},En=l=>{switch(l){case"draft":return e.jsx(Rl,{});case"scheduled":return e.jsx(Al,{});case"sent":return e.jsx(kt,{});case"failed":return e.jsx(Lr,{});default:return e.jsx(El,{})}},An=()=>{const{isMobile:l}=Pe(),[t,r]=u.useState([]),[n,s]=u.useState(!1),[d,o]=u.useState(null),[c,x]=u.useState(""),[m,y]=u.useState(""),[b,v]=u.useState(!1),S=async()=>{s(!0),o(null);try{const{data:C,error:p}=await $.from("sms_campaigns").select("*").order("created_at",{ascending:!1});if(p)throw p;C&&r(C)}catch(C){console.error("Error fetching campaigns:",C),o(C.message||"Failed to fetch campaigns")}finally{s(!1)}},w=[...t.filter(C=>{const p=C.name.toLowerCase().includes(c.toLowerCase())||C.CampaignNumber?.toLowerCase().includes(c.toLowerCase()),k=m?C.status===m:!0;return p&&k})].sort((C,p)=>{const k=gr[C.status]??99,V=gr[p.status]??99;return k!==V?k-V:new Date(p.created_at).getTime()-new Date(C.created_at).getTime()});u.useEffect(()=>{S()},[]);const g=()=>e.jsxs(i,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(ke,{padding:"medium",children:[e.jsx(a,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"SMS Campaigns"}),e.jsxs(i,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(N,{placeholder:"Search campaigns...",value:c,onChange:C=>x(C.target.value),startDecorator:e.jsx(Se,{}),sx:{flex:1}}),e.jsxs(je,{placeholder:"Status",value:m,onChange:(C,p)=>y(p??""),sx:{minWidth:120},children:[e.jsx(F,{value:"",children:"All"}),e.jsx(F,{value:"draft",children:"Draft"}),e.jsx(F,{value:"scheduled",children:"Scheduled"}),e.jsx(F,{value:"sent",children:"Sent"}),e.jsx(F,{value:"failed",children:"Failed"})]})]}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(be,{}),onClick:()=>v(!0),sx:{width:"100%",mb:2},children:"Create Campaign"})]}),n&&e.jsx(Ie,{}),d&&e.jsx(i,{sx:{p:2},children:e.jsxs(a,{color:"danger",children:["Error: ",d]})}),e.jsx(i,{children:w.length===0?e.jsx(i,{sx:{textAlign:"center",py:6},children:e.jsx(a,{color:"neutral",children:"No SMS campaigns found"})}):w.map(C=>e.jsx(i,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(i,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${Ot(C.status)}.100`,color:`${Ot(C.status)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",flexShrink:0},children:En(C.status)}),e.jsxs(i,{sx:{flex:1,minWidth:0},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(a,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:C.name}),e.jsx(oe,{size:"sm",color:Ot(C.status),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content",textTransform:"capitalize"},children:C.status})]}),e.jsxs(a,{level:"body-xs",color:"neutral",sx:{mb:.5},children:["Campaign #",C.CampaignNumber," â€¢ ",new Date(C.created_at).toLocaleDateString()]}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:.5},children:[e.jsxs(a,{level:"body-xs",color:"neutral",children:["Recipients: ",C.recipients?.length??0]}),C.scheduled_at&&e.jsxs(a,{level:"body-xs",color:"neutral",children:["Scheduled: ",Jt(new Date(C.scheduled_at),"MMM dd, HH:mm")]})]}),C.message&&e.jsxs(a,{level:"body-xs",color:"neutral",sx:{fontStyle:"italic",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:['"',C.message,'"']})]})]})},C.id))})]}),I=()=>e.jsxs(ke,{variant:"table-page",children:[e.jsx(a,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"SMS Campaigns"}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(N,{placeholder:"Search campaigns...",sx:{flex:1},value:c,onChange:C=>x(C.target.value),startDecorator:e.jsx(Se,{})}),e.jsxs(je,{placeholder:"Filter status",value:m,onChange:(C,p)=>y(p??""),sx:{minWidth:160},children:[e.jsx(F,{value:"",children:"All Statuses"}),e.jsx(F,{value:"draft",children:"Draft"}),e.jsx(F,{value:"scheduled",children:"Scheduled"}),e.jsx(F,{value:"sent",children:"Sent"}),e.jsx(F,{value:"failed",children:"Failed"})]}),e.jsx(q,{onClick:()=>v(!0),variant:"solid",startDecorator:e.jsx(be,{}),children:"Create Campaign"})]}),e.jsxs(ue,{sx:{overflow:"visible"},children:[n&&e.jsx(Ie,{}),d&&e.jsxs(a,{color:"danger",children:["Error: ",d]}),e.jsxs(Be,{"aria-label":"SMS Campaigns",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:at,children:"Campaign #"}),e.jsx("th",{style:at,children:"Name"}),e.jsx("th",{style:at,children:"Status"}),e.jsx("th",{style:at,children:"Scheduled"}),e.jsx("th",{style:at,children:"Sent"}),e.jsx("th",{style:at,children:"Recipients"}),e.jsx("th",{style:at,children:"Message"})]})}),e.jsxs("tbody",{children:[w.length===0&&!n&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...Ge},children:"No campaigns found."})}),w.map(C=>e.jsxs("tr",{style:{cursor:"pointer",height:48},children:[e.jsx("td",{style:Ge,children:C.CampaignNumber}),e.jsx("td",{style:Ge,children:C.name}),e.jsx("td",{style:Ge,children:e.jsx(oe,{size:"sm",color:Ot(C.status),variant:"soft",sx:{textTransform:"capitalize"},children:C.status})}),e.jsx("td",{style:Ge,children:C.scheduled_at?Jt(new Date(C.scheduled_at),"yyyy-MM-dd HH:mm"):"-"}),e.jsx("td",{style:Ge,children:C.sent_at?Jt(new Date(C.sent_at),"yyyy-MM-dd HH:mm"):"-"}),e.jsx("td",{style:Ge,children:C.recipients?.length??0}),e.jsx("td",{style:Ge,children:e.jsx(a,{level:"body-sm",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:C.message||"-"})})]},C.id))]})]})]})]});return e.jsxs(Fe,{children:[l?e.jsx(g,{}):e.jsx(I,{}),e.jsx(Le,{open:b,onClose:()=>v(!1),children:e.jsxs(Te,{children:[e.jsx(Ue,{}),e.jsx(a,{level:"h4",children:"Create New Campaign"}),e.jsx(a,{level:"body-sm",sx:{mt:1,mb:2},children:"Campaign creation functionality will be implemented here."}),e.jsx(q,{onClick:()=>v(!1),variant:"outlined",children:"Close"})]})})]})};function ls(l,t){return t===0?l>0?100:0:(l-t)/t*100}function ns(l){return l==null?"â€”":`${l>0?"+":l<0?"âˆ’":""}${Math.abs(Math.round(l))}%`}async function Rn(){const l=new Date,t=l.toISOString().slice(0,10),r=new Date(l.getTime()-30*24*60*60*1e3).toISOString().slice(0,10),n=new Date(l.getTime()-60*24*60*60*1e3).toISOString().slice(0,10),s=new Date(l.getTime()-30*24*60*60*1e3-1).toISOString().slice(0,10),d=await $.from("Orders").select("order_total, customer_email, date",{count:"exact"}).not("order_total","is",null);if(d.error||!d.data)throw new Error("Failed to fetch order stats");const o=d.data,c=o.filter(w=>w.date&&w.date>=r&&w.date<=t),x=o.filter(w=>w.date&&w.date>=n&&w.date<=s),m=c.reduce((w,g)=>w+(typeof g.order_total=="number"?g.order_total:0),0),y=x.reduce((w,g)=>w+(typeof g.order_total=="number"?g.order_total:0),0),b=c.length,v=x.length,S=new Set(c.map(w=>w.customer_email).filter(Boolean)),f=new Set(x.map(w=>w.customer_email).filter(Boolean));return{totalSales:m,orderCount:b,customerCount:S.size,salesChange:ls(m,y),ordersChange:ls(b,v),customersChange:ls(S.size,f.size)}}const Ln=()=>{const[l,t]=u.useState(null),[r,n]=u.useState(null),[s,d]=u.useState(null),[o,c]=u.useState(null),[x,m]=u.useState(null),[y,b]=u.useState(null),[v,S]=u.useState(!0),[f,w]=u.useState(null);return At("(max-width:600px)"),u.useEffect(()=>{let g=!0,I=!0;async function C(){I&&S(!0),w(null);try{const{totalSales:k,orderCount:V,customerCount:O,salesChange:B,ordersChange:j,customersChange:z}=await Rn();g&&(t(k),n(V),d(O),c(B),m(j),b(z))}catch(k){g&&w(k.message)}finally{I&&S(!1),I=!1}}C();const p=setInterval(C,1e4);return()=>{g=!1,clearInterval(p)}},[]),e.jsxs(i,{sx:{p:{xs:2,md:3},pt:{xs:2,md:3},height:"100%",overflow:"auto"},children:[e.jsx(a,{level:"h2",sx:{mb:2},children:"Dashboard"}),e.jsxs(we,{container:!0,spacing:2,children:[e.jsx(we,{xs:12,md:4,children:e.jsxs(ue,{variant:"outlined",children:[e.jsx(a,{level:"h4",children:"Total Sales"}),e.jsx(a,{level:"h2",color:"success",children:v?"Loading...":f?"â€”":fe(l)}),e.jsxs(a,{level:"body-sm",color:"neutral",children:[v?"":ns(o)," from last 30 days"]})]})}),e.jsx(we,{xs:12,md:4,children:e.jsxs(ue,{variant:"outlined",children:[e.jsx(a,{level:"h4",children:"Orders"}),e.jsx(a,{level:"h2",color:"primary",children:v?"Loading...":f?"â€”":r?.toLocaleString()}),e.jsxs(a,{level:"body-sm",color:"neutral",children:[v?"":ns(x)," from last 30 days"]})]})}),e.jsx(we,{xs:12,md:4,children:e.jsxs(ue,{variant:"outlined",children:[e.jsx(a,{level:"h4",children:"Customers"}),e.jsx(a,{level:"h2",color:"warning",children:v?"Loading...":f?"â€”":s?.toLocaleString()}),e.jsxs(a,{level:"body-sm",color:"neutral",children:[v?"":ns(y)," new last 30 days"]})]})})]})]})},Me=({children:l})=>{const[t,r]=u.useState(null),[n,s]=u.useState(!0);return u.useEffect(()=>{async function d(){const{data:o}=await $.auth.getSession();r(o?.session||null),s(!1)}d()},[]),n?e.jsx("div",{children:"Loading..."}):t?e.jsx(e.Fragment,{children:l}):e.jsx(qt,{to:"/",replace:!0})};function Tn(l){const{onClick:t,...r}=l,{mode:n,setMode:s}=Sr(),[d,o]=u.useState(!1);return u.useEffect(()=>o(!0),[]),e.jsx(pe,{"aria-label":"toggle light/dark mode",size:"sm",variant:"outlined",disabled:!d,onClick:c=>{s(n==="light"?"dark":"light"),t?.(c)},...r,children:n==="light"?e.jsx(Dr,{}):e.jsx(Tl,{})})}function Nn({onLogin:l}){const t=ks(),[r,n]=u.useState(""),[s,d]=u.useState(""),[o,c]=u.useState(!1),[x,m]=u.useState(null);u.useEffect(()=>{if(window.location.pathname==="/login"){async function b(){const{data:v}=await $.auth.getSession();v?.session&&t("/dashboard")}b()}},[t]);async function y(b){b.preventDefault(),c(!0),m(null);const{data:v,error:S}=await $.auth.signInWithPassword({email:r,password:s});if(S){console.error("[Login] Auth error:",S),m(S.message),c(!1);return}const f=v.user?.id;if(!f){m("Login failed: No user ID."),c(!1);return}let{data:w,error:g}=await $.from("users").select("*").eq("id",f).single();if(g||!w){console.error("[Login] User fetch error:",g);const C=(v.user.user_metadata?.full_name||v.user.user_metadata?.name||"").split(" "),{error:p}=await $.from("users").upsert({id:f,email:v.user.email,first_name:C[0]||"",last_name:C.slice(1).join(" ")||null,role:"employee"});if(p){console.error("Upsert failed:",p),m("Upsert failed: "+p.message),c(!1);return}let k=3,V,O;for(;k>0;){await new Promise(z=>setTimeout(z,300));const{data:B,error:j}=await $.from("users").select("*").eq("id",f).single();if(V=B,O=j,O&&console.error("[Login] Retry user fetch error:",O),V&&!O){w=V,g=null;break}k--}if(g||!w){m("Access denied: User not found."),await $.auth.signOut(),c(!1);return}}if(w.role!=="employee"){m("Access denied: Only employees can access this app."),await $.auth.signOut(),c(!1);return}c(!1),l(),t("/dashboard")}return e.jsxs(_r,{disableTransitionOnChange:!0,children:[e.jsx(xl,{}),e.jsx(Cr,{styles:{":root":{"--Form-maxWidth":"800px","--Transition-duration":"0.4s"}}}),e.jsx(i,{sx:b=>({width:{xs:"100%",md:"50vw"},transition:"width var(--Transition-duration)",transitionDelay:"calc(var(--Transition-duration) + 0.1s)",position:"relative",zIndex:1,display:"flex",justifyContent:"flex-end",backdropFilter:"blur(12px)",backgroundColor:"rgba(255 255 255 / 0.2)",[b.getColorSchemeSelector("dark")]:{backgroundColor:"rgba(19 19 24 / 0.4)"}}),children:e.jsxs(i,{sx:{display:"flex",flexDirection:"column",minHeight:"100dvh",width:"100%",px:2},children:[e.jsxs(i,{component:"header",sx:{py:3,display:"flex",justifyContent:"space-between"},children:[e.jsxs(i,{sx:{gap:2,display:"flex",alignItems:"center"},children:[e.jsx(pe,{variant:"soft",color:"primary",size:"sm",children:e.jsx(Ll,{})}),e.jsx(a,{level:"title-lg",children:"SmartBack"})]}),e.jsx(Tn,{})]}),e.jsxs(i,{component:"main",sx:{my:"auto",py:2,pb:5,display:"flex",flexDirection:"column",gap:2,width:400,maxWidth:"100%",mx:"auto",borderRadius:"sm","& form":{display:"flex",flexDirection:"column",gap:2},"& .MuiFormLabel-asterisk":{visibility:"hidden"}},children:[e.jsx(J,{sx:{gap:4,mb:2},children:e.jsxs(J,{sx:{gap:1},children:[e.jsx(a,{component:"h1",level:"h3",children:"Sign in"}),e.jsx(a,{level:"body-sm",children:"Welcome back to SmartBack! Please sign in to continue."})]})}),e.jsx(J,{sx:{gap:4,mt:2},children:e.jsxs("form",{onSubmit:y,children:[e.jsxs(se,{required:!0,children:[e.jsx(ee,{children:"Email"}),e.jsx(N,{type:"email",name:"email",value:r,onChange:b=>n(b.target.value),placeholder:"your@email.com",disabled:o})]}),e.jsxs(se,{required:!0,children:[e.jsx(ee,{children:"Password"}),e.jsx(N,{type:"password",name:"password",value:s,onChange:b=>d(b.target.value),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢",disabled:o})]}),e.jsxs(J,{sx:{gap:4,mt:2},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(bt,{size:"sm",label:"Remember me",name:"persistent"}),e.jsx(pl,{level:"title-sm",href:"#forgot-password",children:"Forgot your password?"})]}),e.jsx(q,{type:"submit",fullWidth:!0,loading:o,children:"Sign in"})]})]})}),x&&e.jsx(i,{sx:{mt:2},children:e.jsx(a,{level:"body-sm",color:"danger",children:x})})]}),e.jsx(i,{component:"footer",sx:{py:3},children:e.jsxs(a,{level:"body-xs",sx:{textAlign:"center"},children:["Â© SmartBack ",new Date().getFullYear()]})})]})}),e.jsx(i,{sx:b=>({height:"100%",position:"fixed",right:0,top:0,bottom:0,left:{xs:0,md:"50vw"},transition:"background-image var(--Transition-duration), left var(--Transition-duration) !important",transitionDelay:"calc(var(--Transition-duration) + 0.1s)",backgroundColor:"background.level1",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundImage:"url(https://images.unsplash.com/photo-1527181152855-fc03fc7949c8?auto=format&w=1000&dpr=2)",[b.getColorSchemeSelector("dark")]:{backgroundImage:"url(https://images.unsplash.com/photo-1572072393749-3ca9c8ea0831?auto=format&w=1000&dpr=2)"}})})]})}function $n(){return e.jsx(Ds,{children:e.jsx(_e,{path:"*",element:e.jsx(Nn,{onLogin:()=>{}})})})}const Oe={fontSize:le.sizes.small},Mn=()=>{const{isMobile:l}=Pe();$r();const[t,r]=u.useState([]),[n,s]=u.useState([]),[d,o]=u.useState(""),[c,x]=u.useState(!1),[m,y]=u.useState(!1),[b,v]=u.useState(""),[S,f]=u.useState(""),[w,g]=u.useState(""),[I,C]=u.useState(""),[p,k]=u.useState(null),[V,O]=u.useState(!1),[B,j]=u.useState(""),[z,L]=u.useState(""),[W,Q]=u.useState(!1),[h,A]=u.useState(!1),[H,E]=u.useState(""),[P,U]=u.useState("success"),ne=(M,de="success")=>{E(M),U(de),A(!0)},he=async()=>{try{const{data:M,error:de}=await $.from("stock_movements").select(`
                    *,
                    Products (
                        ProductName,
                        ProductID
                    )
                `).order("date",{ascending:!1});de?(console.error("Error fetching movements:",de),r([]),ne("Failed to load movements","danger")):r(M||[])}catch(M){console.error("Unexpected error:",M),r([]),ne("An unexpected error occurred","danger")}},ie=async()=>{try{const{data:M,error:de}=await $.from("Products").select("*").order("ProductName");de?(console.error("Error fetching products:",de),s([])):s(M||[])}catch(M){console.error("Unexpected error:",M),s([])}},X=async M=>{if(!M){k(null);return}O(!0);try{const{data:de,error:R}=await $.from("stock_movements").select("movement_type, quantity").eq("product_id",M);if(R)console.error("Error fetching stock movements:",R),k(null);else{const Y=(de||[]).reduce((D,_)=>{switch(_.movement_type){case"incoming":return D+_.quantity;case"outgoing":return D-_.quantity;case"adjustment":return D+_.quantity;default:return D}},0);k(Y)}}catch(de){console.error("Error calculating stock:",de),k(null)}finally{O(!1)}};u.useEffect(()=>{I?X(I):k(null)},[I]);const ce=async()=>{if(!I||B===""||p===null){ne("Please select a product and enter a valid stock level","warning");return}const de=Number(B)-p;if(de===0){ne("No adjustment needed - the stock level is already at the specified amount","warning");return}Q(!0);try{const{error:R}=await $.from("stock_movements").insert({product_id:I,movement_type:"adjustment",quantity:de,reason:`Manual adjustment: ${z||"Stock level correction"}`,date:new Date().toISOString()});R?(console.error("Error creating adjustment:",R),ne("Failed to create adjustment: "+R.message,"danger")):(C(""),j(""),L(""),k(null),x(!1),he(),ne("Stock adjustment created successfully!","success"))}catch(R){console.error("Unexpected error:",R),ne("An unexpected error occurred","danger")}finally{Q(!1)}};u.useEffect(()=>{he(),ie()},[]);const Z=t.filter(M=>{const de=d.toLowerCase(),R=d===""||M.id.toLowerCase().includes(de)||M.product_id.toLowerCase().includes(de)||M.movement_type.toLowerCase().includes(de)||(M.reason?.toLowerCase().includes(de)??!1)||(M.Products?.ProductName?.toLowerCase().includes(de)??!1),Y=b===""||M.movement_type===b,D=S===""||M.product_id===S,_=w===""||(()=>{const G=M.reason?.toLowerCase()||"";switch(w){case"manual":return G.includes("manual")||G.includes("adjustment")||G.includes("correction");case"damage":return G.includes("damage")||G.includes("broken")||G.includes("defect");case"loss":return G.includes("loss")||G.includes("lost")||G.includes("missing");case"found":return G.includes("found")||G.includes("surplus")||G.includes("extra");case"po":return G.includes("po")||G.includes("purchase")||G.includes("receipt");default:return!0}})();return R&&Y&&D&&_}),re=M=>{switch(M.movement_type){case"incoming":return"success";case"outgoing":return"danger";case"adjustment":return M.quantity>=0?"success":"danger";default:return"neutral"}},T=M=>{switch(M.movement_type){case"incoming":return"â†‘";case"outgoing":return"â†“";case"adjustment":return"âš–";default:return"â€¢"}},K=M=>{switch(M.movement_type){case"incoming":return`+${M.quantity}`;case"outgoing":return`-${M.quantity}`;case"adjustment":return M.quantity>=0?`+${M.quantity}`:`${M.quantity}`;default:return M.quantity}},ye=()=>{v(""),f(""),g("")},ve=b!==""||S!==""||w!=="",Ne=()=>e.jsxs(i,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(ke,{padding:"medium",children:[e.jsx(a,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Stock Movements"}),e.jsxs(i,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(N,{placeholder:"Search movements...",value:d,onChange:M=>o(M.target.value),startDecorator:e.jsx(Se,{}),sx:{flex:1}}),e.jsx(pe,{variant:ve?"solid":"soft",color:ve?"primary":"neutral",size:"sm",onClick:()=>y(!0),children:e.jsx(vs,{})})]}),ve&&e.jsxs(i,{sx:{mb:2,display:"flex",gap:1,flexWrap:"wrap"},children:[b&&e.jsxs(oe,{size:"sm",variant:"soft",color:"primary",children:["Type: ",b]}),S&&e.jsxs(oe,{size:"sm",variant:"soft",color:"primary",children:["Product: ",n.find(M=>M.uuid===S)?.ProductName||"Selected"]}),w&&e.jsxs(oe,{size:"sm",variant:"soft",color:"primary",children:["Reason: ",w]})]})]}),e.jsx(i,{children:Z.length===0?e.jsx(i,{sx:{textAlign:"center",py:6},children:e.jsx(a,{color:"neutral",children:"No stock movements found"})}):Z.map(M=>e.jsx(i,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(i,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${re(M)}.100`,color:`${re(M)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",flexShrink:0},children:T(M)}),e.jsxs(i,{sx:{flex:1,minWidth:0},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(a,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:M.Products?.ProductName||"Unknown Product"}),e.jsx(oe,{size:"sm",color:re(M),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content"},children:K(M)})]}),e.jsxs(a,{level:"body-xs",color:"neutral",sx:{mb:.5},children:["ID: ",M.Products?.ProductID||"N/A"," â€¢ ",new Date(M.date).toLocaleDateString()]}),M.reason&&e.jsx(a,{level:"body-xs",color:"neutral",sx:{fontStyle:"italic",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:M.reason})]})]})},M.id))}),e.jsx(pe,{color:"primary",variant:"soft",size:"sm",sx:{position:"fixed",bottom:80,right:16,zIndex:1e3,borderRadius:"8px",width:40,height:40,boxShadow:"sm",bgcolor:"primary.100","&:hover":{bgcolor:"primary.200",boxShadow:"md"}},onClick:()=>x(!0),children:e.jsx(be,{fontSize:"small"})})]}),Ke=()=>e.jsxs(ke,{variant:"table-page",children:[e.jsx(a,{level:"h2",sx:{mb:2,fontSize:le.sizes.xlarge},children:"Stock Movements"}),e.jsxs(i,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(N,{placeholder:"Search movements...",sx:{flex:1,fontSize:le.sizes.small},value:d,onChange:M=>o(M.target.value),startDecorator:e.jsx(Se,{})}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(be,{}),onClick:()=>x(!0),sx:{fontSize:le.sizes.small},children:"Adjust"})]}),e.jsx(ue,{sx:{overflow:"visible"},children:e.jsxs(Be,{"aria-label":"Stock Movements",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:Oe,children:"ID"}),e.jsx("th",{style:Oe,children:"Product"}),e.jsx("th",{style:Oe,children:"Movement Type"}),e.jsx("th",{style:Oe,children:"Quantity"}),e.jsx("th",{style:Oe,children:"Reason"}),e.jsx("th",{style:Oe,children:"Date"})]})}),e.jsxs("tbody",{children:[Z.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{textAlign:"center",color:"#888",...Oe},children:"No stock movements found."})}),Z.map(M=>e.jsxs("tr",{style:{cursor:"pointer"},children:[e.jsxs("td",{style:Oe,children:[M.id.substring(0,8),"..."]}),e.jsx("td",{style:Oe,children:M.Products?e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:M.Products.ProductName}),e.jsxs("div",{style:{fontSize:"0.8em",color:"#666"},children:["ID: ",M.Products.ProductID]})]}):e.jsx("span",{style:{color:"#999",fontStyle:"italic"},children:"Unknown Product"})}),e.jsx("td",{style:Oe,children:e.jsx(oe,{size:"sm",variant:"soft",color:re(M),children:M.movement_type==="incoming"?"â†‘ Incoming":M.movement_type==="outgoing"?"â†“ Outgoing":"âš– Adjustment"})}),e.jsx("td",{style:Oe,children:e.jsx("span",{style:{fontWeight:"bold",color:re(M)==="success"?"#059669":re(M)==="danger"?"#dc2626":"#666"},children:K(M)})}),e.jsx("td",{style:Oe,children:M.reason||"N/A"}),e.jsx("td",{style:Oe,children:new Date(M.date).toLocaleString()})]},M.id))]})]})})]});return e.jsxs(Fe,{children:[l?e.jsx(Ne,{}):e.jsx(Ke,{}),e.jsx(Ft,{open:c,onClose:()=>x(!1),title:"Manual Stock Adjustment",size:"medium",actions:e.jsxs(i,{sx:{display:"flex",gap:2},children:[e.jsx(q,{variant:"plain",onClick:()=>x(!1),sx:Oe,children:"Cancel"}),e.jsx(q,{variant:"solid",onClick:ce,loading:W,disabled:!I||B===""||p===null||Number(B)===p,sx:Oe,children:"Create Adjustment"})]}),children:e.jsxs(J,{spacing:2,children:[e.jsxs(se,{children:[e.jsx(ee,{children:"Product"}),e.jsx(je,{placeholder:"Select a product...",value:I,onChange:(M,de)=>C(de||""),children:n.map(M=>e.jsxs(F,{value:M.uuid,children:[M.ProductName," (ID: ",M.ProductID,")"]},M.uuid))})]}),I&&e.jsxs(se,{children:[e.jsx(ee,{children:"Current Stock Level"}),e.jsx(N,{value:V?"Loading...":p!==null?p:"N/A",readOnly:!0,sx:{bgcolor:"neutral.100",color:p!==null&&p<=0?"danger.500":"neutral.600"}}),p!==null&&p<=0&&e.jsx(a,{level:"body-sm",sx:{color:"danger.500",mt:.5},children:"âš ï¸ Warning: Product is at or below zero stock level"})]}),p!==null&&e.jsxs(se,{children:[e.jsx(ee,{children:"Actual Stock Level"}),e.jsx(N,{type:"number",placeholder:"Enter the actual stock level...",value:B,onChange:M=>j(M.target.value),sx:{...Oe},slotProps:{input:{min:0,max:999999}}}),B!==""&&p!==null&&e.jsx(a,{level:"body-sm",sx:{mt:.5,color:Number(B)>p?"success.600":Number(B)<p?"danger.600":"neutral.600"},children:Number(B)>p?`+${Number(B)-p} (increase)`:Number(B)<p?`${Number(B)-p} (decrease)`:"No change needed"})]}),e.jsxs(se,{children:[e.jsx(ee,{children:"Reason for Adjustment"}),e.jsx(N,{placeholder:"e.g., damage, loss, found inventory, physical count correction...",value:z,onChange:M=>L(M.target.value),sx:{...Oe}})]})]})}),l&&e.jsx(Ft,{open:m,onClose:()=>y(!1),title:"Filter Movements",size:"medium",actions:e.jsxs(i,{sx:{display:"flex",gap:1,justifyContent:"space-between",width:"100%"},children:[e.jsx(q,{variant:"plain",color:"neutral",onClick:ye,disabled:!ve,children:"Clear All"}),e.jsx(q,{onClick:()=>y(!1),children:"Apply Filters"})]}),children:e.jsxs(J,{spacing:2,children:[e.jsxs(se,{children:[e.jsx(ee,{children:"Movement Type"}),e.jsxs(je,{placeholder:"All types",value:b,onChange:(M,de)=>v(de||""),children:[e.jsx(F,{value:"",children:"All Types"}),e.jsx(F,{value:"incoming",children:"Incoming"}),e.jsx(F,{value:"outgoing",children:"Outgoing"}),e.jsx(F,{value:"adjustment",children:"Adjustment"})]})]}),e.jsxs(se,{children:[e.jsx(ee,{children:"Product"}),e.jsxs(je,{placeholder:"All products",value:S,onChange:(M,de)=>f(de||""),children:[e.jsx(F,{value:"",children:"All Products"}),n.map(M=>e.jsx(F,{value:M.uuid,children:M.ProductName},M.uuid))]})]}),e.jsxs(se,{children:[e.jsx(ee,{children:"Reason Category"}),e.jsxs(je,{placeholder:"All reasons",value:w,onChange:(M,de)=>g(de||""),children:[e.jsx(F,{value:"",children:"All Reasons"}),e.jsx(F,{value:"manual",children:"Manual Adjustment"}),e.jsx(F,{value:"damage",children:"Damage/Defect"}),e.jsx(F,{value:"loss",children:"Loss/Missing"}),e.jsx(F,{value:"found",children:"Found/Surplus"}),e.jsx(F,{value:"po",children:"Purchase Order"})]})]})]})}),e.jsx(Vt,{open:h,onClose:()=>A(!1),autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{top:16,zIndex:2e3},children:e.jsx(Je,{color:P,variant:"solid",sx:{width:"100%"},children:H})})]})};function Wn(){const[l,t]=u.useState([]),[r,n]=u.useState(""),[s,d]=u.useState(""),[o,c]=u.useState(!1),[x,m]=u.useState(null),[y,b]=u.useState(!1);u.useEffect(()=>{v(),S()},[]);const v=async()=>{try{const{data:g,error:I}=await $.from("storefronts").select("*").order("name",{ascending:!0});if(I)throw I;t(g||[]),g&&g.length>0&&n(g[0].id)}catch(g){console.error("Error fetching storefronts:",g)}},S=async()=>{try{const g=await fetch("/api/check-sendgrid-config");if(g.ok){const I=await g.json();b(I.configured)}else b(!0)}catch(g){console.error("Error checking SendGrid config:",g),b(!0)}},f=async()=>{if(!s.trim()){m({success:!1,message:"Please enter a test email address",timestamp:new Date});return}c(!0),m(null);try{const g=await fetch("/api/send-order-confirmation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({testEmail:s.trim(),storefrontId:r||null})});if(!g.ok)throw new Error(`HTTP ${g.status}: ${g.statusText}`);const I=await g.json();m({success:I.success,message:I.message||(I.success?"Test email sent successfully!":"Failed to send test email"),timestamp:new Date})}catch(g){m({success:!1,message:g.message||"Error sending test email",timestamp:new Date})}finally{c(!1)}},w=l.find(g=>g.id===r);return e.jsxs(i,{sx:{p:3,maxWidth:"1000px",mx:"auto"},children:[e.jsxs(a,{level:"h2",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ve,{}),"Email Configuration & Testing"]}),e.jsxs(J,{spacing:4,children:[e.jsx(ue,{variant:"outlined",children:e.jsxs(De,{children:[e.jsx(a,{level:"title-md",sx:{mb:2},children:"SendGrid Configuration"}),e.jsx(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:e.jsx(oe,{color:y?"success":"warning",variant:"soft",startDecorator:y?e.jsx(kt,{}):e.jsx(Lr,{}),children:y?"Ready for Testing":"Development Mode"})}),!y&&e.jsx(Je,{color:"neutral",sx:{mb:2},children:e.jsxs("div",{children:[e.jsx(a,{level:"title-sm",children:"Development Mode"}),e.jsx(a,{level:"body-sm",children:"Configuration check unavailable in development. To test emails, ensure these environment variables are set:"}),e.jsxs("ul",{style:{margin:"8px 0",paddingLeft:"20px"},children:[e.jsxs("li",{children:[e.jsx("code",{children:"SENDGRID_API_KEY"})," - Your SendGrid API key"]}),e.jsxs("li",{children:[e.jsx("code",{children:"SENDGRID_FROM_EMAIL"})," - The sender email address"]})]}),e.jsx(a,{level:"body-sm",sx:{mt:1},children:"Try sending a test email below to verify your configuration."})]})}),e.jsx(a,{level:"body-sm",color:"neutral",children:"Order confirmation emails are automatically sent when customers complete their checkout process. Each storefront can have its own branding in the email template."})]})}),e.jsx(ue,{variant:"outlined",children:e.jsxs(De,{children:[e.jsx(a,{level:"title-md",sx:{mb:3},children:"Test Order Confirmation Email"}),e.jsxs(we,{container:!0,spacing:3,children:[e.jsx(we,{xs:12,md:6,children:e.jsxs(J,{spacing:2,children:[e.jsxs(se,{children:[e.jsx(ee,{children:"Select Storefront"}),e.jsxs("select",{value:r,onChange:g=>n(g.target.value),style:{padding:"8px 12px",borderRadius:"6px",border:"1px solid #ccc",fontSize:"14px"},children:[e.jsx("option",{value:"",children:"Default (No Storefront)"}),l.map(g=>e.jsx("option",{value:g.id,children:g.name},g.id))]})]}),e.jsxs(se,{children:[e.jsx(ee,{children:"Test Email Address"}),e.jsx(N,{type:"email",placeholder:"test@example.com",value:s,onChange:g=>d(g.target.value)})]}),e.jsx(q,{variant:"solid",startDecorator:o?e.jsx(cs,{size:"sm"}):e.jsx(Nl,{}),onClick:f,disabled:o||!y,sx:{mt:1},children:o?"Sending...":"Send Test Email"})]})}),e.jsx(we,{xs:12,md:6,children:w&&e.jsx(ue,{variant:"soft",children:e.jsxs(De,{children:[e.jsx(a,{level:"title-sm",sx:{mb:2},children:"Selected Storefront Preview"}),e.jsxs(J,{spacing:1,children:[e.jsxs(a,{level:"body-sm",children:[e.jsx("strong",{children:"Name:"})," ",w.name]}),w.url&&e.jsxs(a,{level:"body-sm",children:[e.jsx("strong",{children:"URL:"})," ",w.url]}),w.logo_url&&e.jsxs(a,{level:"body-sm",children:[e.jsx("strong",{children:"Logo:"})," Configured"]}),e.jsxs(a,{level:"body-sm",children:[e.jsx("strong",{children:"Status:"})," ",w.is_online?"Online":"Offline"]})]})]})})})]}),x&&e.jsx(Je,{color:x.success?"success":"danger",sx:{mt:3},children:e.jsxs("div",{children:[e.jsx(a,{level:"title-sm",children:x.success?"Success!":"Error"}),e.jsx(a,{level:"body-sm",children:x.message}),e.jsx(a,{level:"body-xs",sx:{mt:1,opacity:.7},children:x.timestamp.toLocaleString()})]})})]})}),e.jsx(ue,{variant:"outlined",children:e.jsxs(De,{children:[e.jsx(a,{level:"title-md",sx:{mb:2},children:"Email Template Features"}),e.jsxs(J,{spacing:2,children:[e.jsx(a,{level:"body-sm",children:"Order confirmation emails include the following storefront-specific customizations:"}),e.jsxs(i,{component:"ul",sx:{pl:3,m:0},children:[e.jsx("li",{children:e.jsxs(a,{level:"body-sm",children:[e.jsx("strong",{children:"Storefront Logo:"})," Displays the storefront's logo at the top of the email"]})}),e.jsx("li",{children:e.jsxs(a,{level:"body-sm",children:[e.jsx("strong",{children:"Storefront Name:"})," Used as the sender name and throughout the email"]})}),e.jsx("li",{children:e.jsxs(a,{level:"body-sm",children:[e.jsx("strong",{children:"Store Link:"}),' Includes a "Visit Our Store" button if URL is configured']})}),e.jsx("li",{children:e.jsxs(a,{level:"body-sm",children:[e.jsx("strong",{children:"Order Details:"})," Complete order summary with itemized pricing"]})}),e.jsx("li",{children:e.jsxs(a,{level:"body-sm",children:[e.jsx("strong",{children:"Responsive Design:"})," Mobile-friendly layout that works on all devices"]})})]}),e.jsx(Ee,{sx:{my:2}}),e.jsxs(a,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Note:"})," Emails are sent automatically when orders are completed through the checkout process. This test functionality is for development and verification purposes only."]})]})]})})]})]})}function zs(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var ht=zs();function Mr(l){ht=l}var vt={exec:()=>null};function me(l,t=""){let r=typeof l=="string"?l:l.source,n={replace:(s,d)=>{let o=typeof d=="string"?d:d.source;return o=o.replace(Re.caret,"$1"),r=r.replace(s,o),n},getRegex:()=>new RegExp(r,t)};return n}var Re={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:l=>new RegExp(`^( {0,3}${l})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:l=>new RegExp(`^ {0,${Math.min(3,l-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:l=>new RegExp(`^ {0,${Math.min(3,l-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:l=>new RegExp(`^ {0,${Math.min(3,l-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:l=>new RegExp(`^ {0,${Math.min(3,l-1)}}#`),htmlBeginRegex:l=>new RegExp(`^ {0,${Math.min(3,l-1)}}<(?:[a-z].*>|!--)`,"i")},qn=/^(?:[ \t]*(?:\n|$))+/,Fn=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Un=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Dt=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Bn=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Os=/(?:[*+-]|\d{1,9}[.)])/,Wr=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,qr=me(Wr).replace(/bull/g,Os).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Hn=me(Wr).replace(/bull/g,Os).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Es=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Vn=/^[^\n]+/,As=/(?!\s*\])(?:\\.|[^\[\]\\])+/,Gn=me(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",As).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Qn=me(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Os).getRegex(),Qt="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Rs=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Zn=me("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Rs).replace("tag",Qt).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Fr=me(Es).replace("hr",Dt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Qt).getRegex(),Yn=me(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Fr).getRegex(),Ls={blockquote:Yn,code:Fn,def:Gn,fences:Un,heading:Bn,hr:Dt,html:Zn,lheading:qr,list:Qn,newline:qn,paragraph:Fr,table:vt,text:Vn},fr=me("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Dt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Qt).getRegex(),Jn={...Ls,lheading:Hn,table:fr,paragraph:me(Es).replace("hr",Dt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",fr).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Qt).getRegex()},Kn={...Ls,html:me(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Rs).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:vt,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:me(Es).replace("hr",Dt).replace("heading",` *#{1,6} *[^
]`).replace("lheading",qr).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Xn=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,ei=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Ur=/^( {2,}|\\)\n(?!\s*$)/,ti=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Zt=/[\p{P}\p{S}]/u,Ts=/[\s\p{P}\p{S}]/u,Br=/[^\s\p{P}\p{S}]/u,si=me(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Ts).getRegex(),Hr=/(?!~)[\p{P}\p{S}]/u,ri=/(?!~)[\s\p{P}\p{S}]/u,li=/(?:[^\s\p{P}\p{S}]|~)/u,ni=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,Vr=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,ii=me(Vr,"u").replace(/punct/g,Zt).getRegex(),ai=me(Vr,"u").replace(/punct/g,Hr).getRegex(),Gr="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",oi=me(Gr,"gu").replace(/notPunctSpace/g,Br).replace(/punctSpace/g,Ts).replace(/punct/g,Zt).getRegex(),ci=me(Gr,"gu").replace(/notPunctSpace/g,li).replace(/punctSpace/g,ri).replace(/punct/g,Hr).getRegex(),di=me("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Br).replace(/punctSpace/g,Ts).replace(/punct/g,Zt).getRegex(),ui=me(/\\(punct)/,"gu").replace(/punct/g,Zt).getRegex(),hi=me(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),xi=me(Rs).replace("(?:-->|$)","-->").getRegex(),pi=me("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",xi).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Ut=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,mi=me(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Ut).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Qr=me(/^!?\[(label)\]\[(ref)\]/).replace("label",Ut).replace("ref",As).getRegex(),Zr=me(/^!?\[(ref)\](?:\[\])?/).replace("ref",As).getRegex(),gi=me("reflink|nolink(?!\\()","g").replace("reflink",Qr).replace("nolink",Zr).getRegex(),Ns={_backpedal:vt,anyPunctuation:ui,autolink:hi,blockSkip:ni,br:Ur,code:ei,del:vt,emStrongLDelim:ii,emStrongRDelimAst:oi,emStrongRDelimUnd:di,escape:Xn,link:mi,nolink:Zr,punctuation:si,reflink:Qr,reflinkSearch:gi,tag:pi,text:ti,url:vt},fi={...Ns,link:me(/^!?\[(label)\]\((.*?)\)/).replace("label",Ut).getRegex(),reflink:me(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Ut).getRegex()},hs={...Ns,emStrongRDelimAst:ci,emStrongLDelim:ai,url:me(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},ji={...hs,br:me(Ur).replace("{2,}","*").getRegex(),text:me(hs.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Et={normal:Ls,gfm:Jn,pedantic:Kn},mt={normal:Ns,gfm:hs,breaks:ji,pedantic:fi},bi={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},jr=l=>bi[l];function He(l,t){if(t){if(Re.escapeTest.test(l))return l.replace(Re.escapeReplace,jr)}else if(Re.escapeTestNoEncode.test(l))return l.replace(Re.escapeReplaceNoEncode,jr);return l}function br(l){try{l=encodeURI(l).replace(Re.percentDecode,"%")}catch{return null}return l}function yr(l,t){let r=l.replace(Re.findPipe,(d,o,c)=>{let x=!1,m=o;for(;--m>=0&&c[m]==="\\";)x=!x;return x?"|":" |"}),n=r.split(Re.splitPipe),s=0;if(n[0].trim()||n.shift(),n.length>0&&!n.at(-1)?.trim()&&n.pop(),t)if(n.length>t)n.splice(t);else for(;n.length<t;)n.push("");for(;s<n.length;s++)n[s]=n[s].trim().replace(Re.slashPipe,"|");return n}function gt(l,t,r){let n=l.length;if(n===0)return"";let s=0;for(;s<n&&l.charAt(n-s-1)===t;)s++;return l.slice(0,n-s)}function yi(l,t){if(l.indexOf(t[1])===-1)return-1;let r=0;for(let n=0;n<l.length;n++)if(l[n]==="\\")n++;else if(l[n]===t[0])r++;else if(l[n]===t[1]&&(r--,r<0))return n;return r>0?-2:-1}function vr(l,t,r,n,s){let d=t.href,o=t.title||null,c=l[1].replace(s.other.outputLinkReplace,"$1");n.state.inLink=!0;let x={type:l[0].charAt(0)==="!"?"image":"link",raw:r,href:d,title:o,text:c,tokens:n.inlineTokens(c)};return n.state.inLink=!1,x}function vi(l,t,r){let n=l.match(r.other.indentCodeCompensation);if(n===null)return t;let s=n[1];return t.split(`
`).map(d=>{let o=d.match(r.other.beginningSpace);if(o===null)return d;let[c]=o;return c.length>=s.length?d.slice(s.length):d}).join(`
`)}var Bt=class{options;rules;lexer;constructor(l){this.options=l||ht}space(l){let t=this.rules.block.newline.exec(l);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(l){let t=this.rules.block.code.exec(l);if(t){let r=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?r:gt(r,`
`)}}}fences(l){let t=this.rules.block.fences.exec(l);if(t){let r=t[0],n=vi(r,t[3]||"",this.rules);return{type:"code",raw:r,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:n}}}heading(l){let t=this.rules.block.heading.exec(l);if(t){let r=t[2].trim();if(this.rules.other.endingHash.test(r)){let n=gt(r,"#");(this.options.pedantic||!n||this.rules.other.endingSpaceChar.test(n))&&(r=n.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:r,tokens:this.lexer.inline(r)}}}hr(l){let t=this.rules.block.hr.exec(l);if(t)return{type:"hr",raw:gt(t[0],`
`)}}blockquote(l){let t=this.rules.block.blockquote.exec(l);if(t){let r=gt(t[0],`
`).split(`
`),n="",s="",d=[];for(;r.length>0;){let o=!1,c=[],x;for(x=0;x<r.length;x++)if(this.rules.other.blockquoteStart.test(r[x]))c.push(r[x]),o=!0;else if(!o)c.push(r[x]);else break;r=r.slice(x);let m=c.join(`
`),y=m.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}
${m}`:m,s=s?`${s}
${y}`:y;let b=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(y,d,!0),this.lexer.state.top=b,r.length===0)break;let v=d.at(-1);if(v?.type==="code")break;if(v?.type==="blockquote"){let S=v,f=S.raw+`
`+r.join(`
`),w=this.blockquote(f);d[d.length-1]=w,n=n.substring(0,n.length-S.raw.length)+w.raw,s=s.substring(0,s.length-S.text.length)+w.text;break}else if(v?.type==="list"){let S=v,f=S.raw+`
`+r.join(`
`),w=this.list(f);d[d.length-1]=w,n=n.substring(0,n.length-v.raw.length)+w.raw,s=s.substring(0,s.length-S.raw.length)+w.raw,r=f.substring(d.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:n,tokens:d,text:s}}}list(l){let t=this.rules.block.list.exec(l);if(t){let r=t[1].trim(),n=r.length>1,s={type:"list",raw:"",ordered:n,start:n?+r.slice(0,-1):"",loose:!1,items:[]};r=n?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=n?r:"[*+-]");let d=this.rules.other.listItemRegex(r),o=!1;for(;l;){let x=!1,m="",y="";if(!(t=d.exec(l))||this.rules.block.hr.test(l))break;m=t[0],l=l.substring(m.length);let b=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,I=>" ".repeat(3*I.length)),v=l.split(`
`,1)[0],S=!b.trim(),f=0;if(this.options.pedantic?(f=2,y=b.trimStart()):S?f=t[1].length+1:(f=t[2].search(this.rules.other.nonSpaceChar),f=f>4?1:f,y=b.slice(f),f+=t[1].length),S&&this.rules.other.blankLine.test(v)&&(m+=v+`
`,l=l.substring(v.length+1),x=!0),!x){let I=this.rules.other.nextBulletRegex(f),C=this.rules.other.hrRegex(f),p=this.rules.other.fencesBeginRegex(f),k=this.rules.other.headingBeginRegex(f),V=this.rules.other.htmlBeginRegex(f);for(;l;){let O=l.split(`
`,1)[0],B;if(v=O,this.options.pedantic?(v=v.replace(this.rules.other.listReplaceNesting,"  "),B=v):B=v.replace(this.rules.other.tabCharGlobal,"    "),p.test(v)||k.test(v)||V.test(v)||I.test(v)||C.test(v))break;if(B.search(this.rules.other.nonSpaceChar)>=f||!v.trim())y+=`
`+B.slice(f);else{if(S||b.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||p.test(b)||k.test(b)||C.test(b))break;y+=`
`+v}!S&&!v.trim()&&(S=!0),m+=O+`
`,l=l.substring(O.length+1),b=B.slice(f)}}s.loose||(o?s.loose=!0:this.rules.other.doubleBlankLine.test(m)&&(o=!0));let w=null,g;this.options.gfm&&(w=this.rules.other.listIsTask.exec(y),w&&(g=w[0]!=="[ ] ",y=y.replace(this.rules.other.listReplaceTask,""))),s.items.push({type:"list_item",raw:m,task:!!w,checked:g,loose:!1,text:y,tokens:[]}),s.raw+=m}let c=s.items.at(-1);if(c)c.raw=c.raw.trimEnd(),c.text=c.text.trimEnd();else return;s.raw=s.raw.trimEnd();for(let x=0;x<s.items.length;x++)if(this.lexer.state.top=!1,s.items[x].tokens=this.lexer.blockTokens(s.items[x].text,[]),!s.loose){let m=s.items[x].tokens.filter(b=>b.type==="space"),y=m.length>0&&m.some(b=>this.rules.other.anyLine.test(b.raw));s.loose=y}if(s.loose)for(let x=0;x<s.items.length;x++)s.items[x].loose=!0;return s}}html(l){let t=this.rules.block.html.exec(l);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(l){let t=this.rules.block.def.exec(l);if(t){let r=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",s=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:r,raw:t[0],href:n,title:s}}}table(l){let t=this.rules.block.table.exec(l);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let r=yr(t[1]),n=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),s=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],d={type:"table",raw:t[0],header:[],align:[],rows:[]};if(r.length===n.length){for(let o of n)this.rules.other.tableAlignRight.test(o)?d.align.push("right"):this.rules.other.tableAlignCenter.test(o)?d.align.push("center"):this.rules.other.tableAlignLeft.test(o)?d.align.push("left"):d.align.push(null);for(let o=0;o<r.length;o++)d.header.push({text:r[o],tokens:this.lexer.inline(r[o]),header:!0,align:d.align[o]});for(let o of s)d.rows.push(yr(o,d.header.length).map((c,x)=>({text:c,tokens:this.lexer.inline(c),header:!1,align:d.align[x]})));return d}}lheading(l){let t=this.rules.block.lheading.exec(l);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(l){let t=this.rules.block.paragraph.exec(l);if(t){let r=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:r,tokens:this.lexer.inline(r)}}}text(l){let t=this.rules.block.text.exec(l);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(l){let t=this.rules.inline.escape.exec(l);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(l){let t=this.rules.inline.tag.exec(l);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(l){let t=this.rules.inline.link.exec(l);if(t){let r=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(r)){if(!this.rules.other.endAngleBracket.test(r))return;let d=gt(r.slice(0,-1),"\\");if((r.length-d.length)%2===0)return}else{let d=yi(t[2],"()");if(d===-2)return;if(d>-1){let o=(t[0].indexOf("!")===0?5:4)+t[1].length+d;t[2]=t[2].substring(0,d),t[0]=t[0].substring(0,o).trim(),t[3]=""}}let n=t[2],s="";if(this.options.pedantic){let d=this.rules.other.pedanticHrefTitle.exec(n);d&&(n=d[1],s=d[3])}else s=t[3]?t[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(r)?n=n.slice(1):n=n.slice(1,-1)),vr(t,{href:n&&n.replace(this.rules.inline.anyPunctuation,"$1"),title:s&&s.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(l,t){let r;if((r=this.rules.inline.reflink.exec(l))||(r=this.rules.inline.nolink.exec(l))){let n=(r[2]||r[1]).replace(this.rules.other.multipleSpaceGlobal," "),s=t[n.toLowerCase()];if(!s){let d=r[0].charAt(0);return{type:"text",raw:d,text:d}}return vr(r,s,r[0],this.lexer,this.rules)}}emStrong(l,t,r=""){let n=this.rules.inline.emStrongLDelim.exec(l);if(!(!n||n[3]&&r.match(this.rules.other.unicodeAlphaNumeric))&&(!(n[1]||n[2])||!r||this.rules.inline.punctuation.exec(r))){let s=[...n[0]].length-1,d,o,c=s,x=0,m=n[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(m.lastIndex=0,t=t.slice(-1*l.length+s);(n=m.exec(t))!=null;){if(d=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!d)continue;if(o=[...d].length,n[3]||n[4]){c+=o;continue}else if((n[5]||n[6])&&s%3&&!((s+o)%3)){x+=o;continue}if(c-=o,c>0)continue;o=Math.min(o,o+c+x);let y=[...n[0]][0].length,b=l.slice(0,s+n.index+y+o);if(Math.min(s,o)%2){let S=b.slice(1,-1);return{type:"em",raw:b,text:S,tokens:this.lexer.inlineTokens(S)}}let v=b.slice(2,-2);return{type:"strong",raw:b,text:v,tokens:this.lexer.inlineTokens(v)}}}}codespan(l){let t=this.rules.inline.code.exec(l);if(t){let r=t[2].replace(this.rules.other.newLineCharGlobal," "),n=this.rules.other.nonSpaceChar.test(r),s=this.rules.other.startingSpaceChar.test(r)&&this.rules.other.endingSpaceChar.test(r);return n&&s&&(r=r.substring(1,r.length-1)),{type:"codespan",raw:t[0],text:r}}}br(l){let t=this.rules.inline.br.exec(l);if(t)return{type:"br",raw:t[0]}}del(l){let t=this.rules.inline.del.exec(l);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(l){let t=this.rules.inline.autolink.exec(l);if(t){let r,n;return t[2]==="@"?(r=t[1],n="mailto:"+r):(r=t[1],n=r),{type:"link",raw:t[0],text:r,href:n,tokens:[{type:"text",raw:r,text:r}]}}}url(l){let t;if(t=this.rules.inline.url.exec(l)){let r,n;if(t[2]==="@")r=t[0],n="mailto:"+r;else{let s;do s=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??"";while(s!==t[0]);r=t[0],t[1]==="www."?n="http://"+t[0]:n=t[0]}return{type:"link",raw:t[0],text:r,href:n,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(l){let t=this.rules.inline.text.exec(l);if(t){let r=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:r}}}},Qe=class xs{tokens;options;state;tokenizer;inlineQueue;constructor(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||ht,this.options.tokenizer=this.options.tokenizer||new Bt,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let r={other:Re,block:Et.normal,inline:mt.normal};this.options.pedantic?(r.block=Et.pedantic,r.inline=mt.pedantic):this.options.gfm&&(r.block=Et.gfm,this.options.breaks?r.inline=mt.breaks:r.inline=mt.gfm),this.tokenizer.rules=r}static get rules(){return{block:Et,inline:mt}}static lex(t,r){return new xs(r).lex(t)}static lexInline(t,r){return new xs(r).inlineTokens(t)}lex(t){t=t.replace(Re.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let r=0;r<this.inlineQueue.length;r++){let n=this.inlineQueue[r];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,r=[],n=!1){for(this.options.pedantic&&(t=t.replace(Re.tabCharGlobal,"    ").replace(Re.spaceLine,""));t;){let s;if(this.options.extensions?.block?.some(o=>(s=o.call({lexer:this},t,r))?(t=t.substring(s.raw.length),r.push(s),!0):!1))continue;if(s=this.tokenizer.space(t)){t=t.substring(s.raw.length);let o=r.at(-1);s.raw.length===1&&o!==void 0?o.raw+=`
`:r.push(s);continue}if(s=this.tokenizer.code(t)){t=t.substring(s.raw.length);let o=r.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=`
`+s.raw,o.text+=`
`+s.text,this.inlineQueue.at(-1).src=o.text):r.push(s);continue}if(s=this.tokenizer.fences(t)){t=t.substring(s.raw.length),r.push(s);continue}if(s=this.tokenizer.heading(t)){t=t.substring(s.raw.length),r.push(s);continue}if(s=this.tokenizer.hr(t)){t=t.substring(s.raw.length),r.push(s);continue}if(s=this.tokenizer.blockquote(t)){t=t.substring(s.raw.length),r.push(s);continue}if(s=this.tokenizer.list(t)){t=t.substring(s.raw.length),r.push(s);continue}if(s=this.tokenizer.html(t)){t=t.substring(s.raw.length),r.push(s);continue}if(s=this.tokenizer.def(t)){t=t.substring(s.raw.length);let o=r.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=`
`+s.raw,o.text+=`
`+s.raw,this.inlineQueue.at(-1).src=o.text):this.tokens.links[s.tag]||(this.tokens.links[s.tag]={href:s.href,title:s.title});continue}if(s=this.tokenizer.table(t)){t=t.substring(s.raw.length),r.push(s);continue}if(s=this.tokenizer.lheading(t)){t=t.substring(s.raw.length),r.push(s);continue}let d=t;if(this.options.extensions?.startBlock){let o=1/0,c=t.slice(1),x;this.options.extensions.startBlock.forEach(m=>{x=m.call({lexer:this},c),typeof x=="number"&&x>=0&&(o=Math.min(o,x))}),o<1/0&&o>=0&&(d=t.substring(0,o+1))}if(this.state.top&&(s=this.tokenizer.paragraph(d))){let o=r.at(-1);n&&o?.type==="paragraph"?(o.raw+=`
`+s.raw,o.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):r.push(s),n=d.length!==t.length,t=t.substring(s.raw.length);continue}if(s=this.tokenizer.text(t)){t=t.substring(s.raw.length);let o=r.at(-1);o?.type==="text"?(o.raw+=`
`+s.raw,o.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):r.push(s);continue}if(t){let o="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(o);break}else throw new Error(o)}}return this.state.top=!0,r}inline(t,r=[]){return this.inlineQueue.push({src:t,tokens:r}),r}inlineTokens(t,r=[]){let n=t,s=null;if(this.tokens.links){let c=Object.keys(this.tokens.links);if(c.length>0)for(;(s=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)c.includes(s[0].slice(s[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(s=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,s.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(s=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)n=n.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let d=!1,o="";for(;t;){d||(o=""),d=!1;let c;if(this.options.extensions?.inline?.some(m=>(c=m.call({lexer:this},t,r))?(t=t.substring(c.raw.length),r.push(c),!0):!1))continue;if(c=this.tokenizer.escape(t)){t=t.substring(c.raw.length),r.push(c);continue}if(c=this.tokenizer.tag(t)){t=t.substring(c.raw.length),r.push(c);continue}if(c=this.tokenizer.link(t)){t=t.substring(c.raw.length),r.push(c);continue}if(c=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(c.raw.length);let m=r.at(-1);c.type==="text"&&m?.type==="text"?(m.raw+=c.raw,m.text+=c.text):r.push(c);continue}if(c=this.tokenizer.emStrong(t,n,o)){t=t.substring(c.raw.length),r.push(c);continue}if(c=this.tokenizer.codespan(t)){t=t.substring(c.raw.length),r.push(c);continue}if(c=this.tokenizer.br(t)){t=t.substring(c.raw.length),r.push(c);continue}if(c=this.tokenizer.del(t)){t=t.substring(c.raw.length),r.push(c);continue}if(c=this.tokenizer.autolink(t)){t=t.substring(c.raw.length),r.push(c);continue}if(!this.state.inLink&&(c=this.tokenizer.url(t))){t=t.substring(c.raw.length),r.push(c);continue}let x=t;if(this.options.extensions?.startInline){let m=1/0,y=t.slice(1),b;this.options.extensions.startInline.forEach(v=>{b=v.call({lexer:this},y),typeof b=="number"&&b>=0&&(m=Math.min(m,b))}),m<1/0&&m>=0&&(x=t.substring(0,m+1))}if(c=this.tokenizer.inlineText(x)){t=t.substring(c.raw.length),c.raw.slice(-1)!=="_"&&(o=c.raw.slice(-1)),d=!0;let m=r.at(-1);m?.type==="text"?(m.raw+=c.raw,m.text+=c.text):r.push(c);continue}if(t){let m="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(m);break}else throw new Error(m)}}return r}},Ht=class{options;parser;constructor(l){this.options=l||ht}space(l){return""}code({text:l,lang:t,escaped:r}){let n=(t||"").match(Re.notSpaceStart)?.[0],s=l.replace(Re.endingNewline,"")+`
`;return n?'<pre><code class="language-'+He(n)+'">'+(r?s:He(s,!0))+`</code></pre>
`:"<pre><code>"+(r?s:He(s,!0))+`</code></pre>
`}blockquote({tokens:l}){return`<blockquote>
${this.parser.parse(l)}</blockquote>
`}html({text:l}){return l}heading({tokens:l,depth:t}){return`<h${t}>${this.parser.parseInline(l)}</h${t}>
`}hr(l){return`<hr>
`}list(l){let t=l.ordered,r=l.start,n="";for(let o=0;o<l.items.length;o++){let c=l.items[o];n+=this.listitem(c)}let s=t?"ol":"ul",d=t&&r!==1?' start="'+r+'"':"";return"<"+s+d+`>
`+n+"</"+s+`>
`}listitem(l){let t="";if(l.task){let r=this.checkbox({checked:!!l.checked});l.loose?l.tokens[0]?.type==="paragraph"?(l.tokens[0].text=r+" "+l.tokens[0].text,l.tokens[0].tokens&&l.tokens[0].tokens.length>0&&l.tokens[0].tokens[0].type==="text"&&(l.tokens[0].tokens[0].text=r+" "+He(l.tokens[0].tokens[0].text),l.tokens[0].tokens[0].escaped=!0)):l.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):t+=r+" "}return t+=this.parser.parse(l.tokens,!!l.loose),`<li>${t}</li>
`}checkbox({checked:l}){return"<input "+(l?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:l}){return`<p>${this.parser.parseInline(l)}</p>
`}table(l){let t="",r="";for(let s=0;s<l.header.length;s++)r+=this.tablecell(l.header[s]);t+=this.tablerow({text:r});let n="";for(let s=0;s<l.rows.length;s++){let d=l.rows[s];r="";for(let o=0;o<d.length;o++)r+=this.tablecell(d[o]);n+=this.tablerow({text:r})}return n&&(n=`<tbody>${n}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+n+`</table>
`}tablerow({text:l}){return`<tr>
${l}</tr>
`}tablecell(l){let t=this.parser.parseInline(l.tokens),r=l.header?"th":"td";return(l.align?`<${r} align="${l.align}">`:`<${r}>`)+t+`</${r}>
`}strong({tokens:l}){return`<strong>${this.parser.parseInline(l)}</strong>`}em({tokens:l}){return`<em>${this.parser.parseInline(l)}</em>`}codespan({text:l}){return`<code>${He(l,!0)}</code>`}br(l){return"<br>"}del({tokens:l}){return`<del>${this.parser.parseInline(l)}</del>`}link({href:l,title:t,tokens:r}){let n=this.parser.parseInline(r),s=br(l);if(s===null)return n;l=s;let d='<a href="'+l+'"';return t&&(d+=' title="'+He(t)+'"'),d+=">"+n+"</a>",d}image({href:l,title:t,text:r,tokens:n}){n&&(r=this.parser.parseInline(n,this.parser.textRenderer));let s=br(l);if(s===null)return He(r);l=s;let d=`<img src="${l}" alt="${r}"`;return t&&(d+=` title="${He(t)}"`),d+=">",d}text(l){return"tokens"in l&&l.tokens?this.parser.parseInline(l.tokens):"escaped"in l&&l.escaped?l.text:He(l.text)}},$s=class{strong({text:l}){return l}em({text:l}){return l}codespan({text:l}){return l}del({text:l}){return l}html({text:l}){return l}text({text:l}){return l}link({text:l}){return""+l}image({text:l}){return""+l}br(){return""}},Ze=class ps{options;renderer;textRenderer;constructor(t){this.options=t||ht,this.options.renderer=this.options.renderer||new Ht,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new $s}static parse(t,r){return new ps(r).parse(t)}static parseInline(t,r){return new ps(r).parseInline(t)}parse(t,r=!0){let n="";for(let s=0;s<t.length;s++){let d=t[s];if(this.options.extensions?.renderers?.[d.type]){let c=d,x=this.options.extensions.renderers[c.type].call({parser:this},c);if(x!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(c.type)){n+=x||"";continue}}let o=d;switch(o.type){case"space":{n+=this.renderer.space(o);continue}case"hr":{n+=this.renderer.hr(o);continue}case"heading":{n+=this.renderer.heading(o);continue}case"code":{n+=this.renderer.code(o);continue}case"table":{n+=this.renderer.table(o);continue}case"blockquote":{n+=this.renderer.blockquote(o);continue}case"list":{n+=this.renderer.list(o);continue}case"html":{n+=this.renderer.html(o);continue}case"paragraph":{n+=this.renderer.paragraph(o);continue}case"text":{let c=o,x=this.renderer.text(c);for(;s+1<t.length&&t[s+1].type==="text";)c=t[++s],x+=`
`+this.renderer.text(c);r?n+=this.renderer.paragraph({type:"paragraph",raw:x,text:x,tokens:[{type:"text",raw:x,text:x,escaped:!0}]}):n+=x;continue}default:{let c='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(c),"";throw new Error(c)}}}return n}parseInline(t,r=this.renderer){let n="";for(let s=0;s<t.length;s++){let d=t[s];if(this.options.extensions?.renderers?.[d.type]){let c=this.options.extensions.renderers[d.type].call({parser:this},d);if(c!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(d.type)){n+=c||"";continue}}let o=d;switch(o.type){case"escape":{n+=r.text(o);break}case"html":{n+=r.html(o);break}case"link":{n+=r.link(o);break}case"image":{n+=r.image(o);break}case"strong":{n+=r.strong(o);break}case"em":{n+=r.em(o);break}case"codespan":{n+=r.codespan(o);break}case"br":{n+=r.br(o);break}case"del":{n+=r.del(o);break}case"text":{n+=r.text(o);break}default:{let c='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(c),"";throw new Error(c)}}}return n}},Tt=class{options;block;constructor(l){this.options=l||ht}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(l){return l}postprocess(l){return l}processAllTokens(l){return l}provideLexer(){return this.block?Qe.lex:Qe.lexInline}provideParser(){return this.block?Ze.parse:Ze.parseInline}},wi=class{defaults=zs();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=Ze;Renderer=Ht;TextRenderer=$s;Lexer=Qe;Tokenizer=Bt;Hooks=Tt;constructor(...l){this.use(...l)}walkTokens(l,t){let r=[];for(let n of l)switch(r=r.concat(t.call(this,n)),n.type){case"table":{let s=n;for(let d of s.header)r=r.concat(this.walkTokens(d.tokens,t));for(let d of s.rows)for(let o of d)r=r.concat(this.walkTokens(o.tokens,t));break}case"list":{let s=n;r=r.concat(this.walkTokens(s.items,t));break}default:{let s=n;this.defaults.extensions?.childTokens?.[s.type]?this.defaults.extensions.childTokens[s.type].forEach(d=>{let o=s[d].flat(1/0);r=r.concat(this.walkTokens(o,t))}):s.tokens&&(r=r.concat(this.walkTokens(s.tokens,t)))}}return r}use(...l){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return l.forEach(r=>{let n={...r};if(n.async=this.defaults.async||n.async||!1,r.extensions&&(r.extensions.forEach(s=>{if(!s.name)throw new Error("extension name required");if("renderer"in s){let d=t.renderers[s.name];d?t.renderers[s.name]=function(...o){let c=s.renderer.apply(this,o);return c===!1&&(c=d.apply(this,o)),c}:t.renderers[s.name]=s.renderer}if("tokenizer"in s){if(!s.level||s.level!=="block"&&s.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let d=t[s.level];d?d.unshift(s.tokenizer):t[s.level]=[s.tokenizer],s.start&&(s.level==="block"?t.startBlock?t.startBlock.push(s.start):t.startBlock=[s.start]:s.level==="inline"&&(t.startInline?t.startInline.push(s.start):t.startInline=[s.start]))}"childTokens"in s&&s.childTokens&&(t.childTokens[s.name]=s.childTokens)}),n.extensions=t),r.renderer){let s=this.defaults.renderer||new Ht(this.defaults);for(let d in r.renderer){if(!(d in s))throw new Error(`renderer '${d}' does not exist`);if(["options","parser"].includes(d))continue;let o=d,c=r.renderer[o],x=s[o];s[o]=(...m)=>{let y=c.apply(s,m);return y===!1&&(y=x.apply(s,m)),y||""}}n.renderer=s}if(r.tokenizer){let s=this.defaults.tokenizer||new Bt(this.defaults);for(let d in r.tokenizer){if(!(d in s))throw new Error(`tokenizer '${d}' does not exist`);if(["options","rules","lexer"].includes(d))continue;let o=d,c=r.tokenizer[o],x=s[o];s[o]=(...m)=>{let y=c.apply(s,m);return y===!1&&(y=x.apply(s,m)),y}}n.tokenizer=s}if(r.hooks){let s=this.defaults.hooks||new Tt;for(let d in r.hooks){if(!(d in s))throw new Error(`hook '${d}' does not exist`);if(["options","block"].includes(d))continue;let o=d,c=r.hooks[o],x=s[o];Tt.passThroughHooks.has(d)?s[o]=m=>{if(this.defaults.async)return Promise.resolve(c.call(s,m)).then(b=>x.call(s,b));let y=c.call(s,m);return x.call(s,y)}:s[o]=(...m)=>{let y=c.apply(s,m);return y===!1&&(y=x.apply(s,m)),y}}n.hooks=s}if(r.walkTokens){let s=this.defaults.walkTokens,d=r.walkTokens;n.walkTokens=function(o){let c=[];return c.push(d.call(this,o)),s&&(c=c.concat(s.call(this,o))),c}}this.defaults={...this.defaults,...n}}),this}setOptions(l){return this.defaults={...this.defaults,...l},this}lexer(l,t){return Qe.lex(l,t??this.defaults)}parser(l,t){return Ze.parse(l,t??this.defaults)}parseMarkdown(l){return(t,r)=>{let n={...r},s={...this.defaults,...n},d=this.onError(!!s.silent,!!s.async);if(this.defaults.async===!0&&n.async===!1)return d(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||t===null)return d(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return d(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));s.hooks&&(s.hooks.options=s,s.hooks.block=l);let o=s.hooks?s.hooks.provideLexer():l?Qe.lex:Qe.lexInline,c=s.hooks?s.hooks.provideParser():l?Ze.parse:Ze.parseInline;if(s.async)return Promise.resolve(s.hooks?s.hooks.preprocess(t):t).then(x=>o(x,s)).then(x=>s.hooks?s.hooks.processAllTokens(x):x).then(x=>s.walkTokens?Promise.all(this.walkTokens(x,s.walkTokens)).then(()=>x):x).then(x=>c(x,s)).then(x=>s.hooks?s.hooks.postprocess(x):x).catch(d);try{s.hooks&&(t=s.hooks.preprocess(t));let x=o(t,s);s.hooks&&(x=s.hooks.processAllTokens(x)),s.walkTokens&&this.walkTokens(x,s.walkTokens);let m=c(x,s);return s.hooks&&(m=s.hooks.postprocess(m)),m}catch(x){return d(x)}}}onError(l,t){return r=>{if(r.message+=`
Please report this to https://github.com/markedjs/marked.`,l){let n="<p>An error occurred:</p><pre>"+He(r.message+"",!0)+"</pre>";return t?Promise.resolve(n):n}if(t)return Promise.reject(r);throw r}}},ut=new wi;function ge(l,t){return ut.parse(l,t)}ge.options=ge.setOptions=function(l){return ut.setOptions(l),ge.defaults=ut.defaults,Mr(ge.defaults),ge};ge.getDefaults=zs;ge.defaults=ht;ge.use=function(...l){return ut.use(...l),ge.defaults=ut.defaults,Mr(ge.defaults),ge};ge.walkTokens=function(l,t){return ut.walkTokens(l,t)};ge.parseInline=ut.parseInline;ge.Parser=Ze;ge.parser=Ze.parse;ge.Renderer=Ht;ge.TextRenderer=$s;ge.Lexer=Qe;ge.lexer=Qe.lex;ge.Tokenizer=Bt;ge.Hooks=Tt;ge.parse=ge;ge.options;ge.setOptions;ge.use;ge.walkTokens;ge.parseInline;Ze.parse;Qe.lex;function Si(){const[l,t]=u.useState(null),[r,n]=u.useState(null),[s,d]=u.useState(!0),[o,c]=u.useState(!1),[x,m]=u.useState(!1),[y,b]=u.useState(!1),[v,S]=u.useState(null),[f,w]=u.useState(""),[g,I]=u.useState(""),[C,p]=u.useState(""),[k,V]=u.useState(""),[O,B]=u.useState(""),[j,z]=u.useState(""),[L,W]=u.useState("");u.useEffect(()=>{Q()},[]);const Q=async()=>{try{d(!0);const{data:E}=await $.auth.getUser(),P=E.user;if(P){t(P),p(P.email||"");const{data:U}=await $.from("users").select("*").eq("id",P.id).single();U&&(n(U),w(U.first_name||""),I(U.last_name||""),V(U.role||"UI Developer"),B(U.department||""),z(U.avatar_url||""),W(U.phone_number||"")),!U?.phone_number&&P.user_metadata?.phone_number&&W(P.user_metadata.phone_number),P.user_metadata&&(!U?.first_name&&P.user_metadata.first_name&&w(P.user_metadata.first_name),!U?.last_name&&P.user_metadata.last_name&&I(P.user_metadata.last_name))}}catch(E){console.error("Error loading user data:",E),S({type:"danger",text:"Failed to load user data"})}finally{d(!1)}},h=async()=>{if(!l)return;if(L&&!/^\+[1-9]\d{7,}$/.test(L)){S({type:"danger",text:"Phone number must include country code and be valid (e.g., +4512345678, +1234567890)"});return}if(!f.trim()){S({type:"danger",text:"First name is required"});return}try{m(!0);const{error:P}=await $.from("users").update({role:k.trim()||null,department:O.trim()||null,avatar_url:j.trim()||null,phone_number:L.trim()||null,first_name:f.trim(),last_name:g.trim()||null}).eq("id",l.id);if(P)throw P;const{error:U}=await $.auth.updateUser({data:{first_name:f.trim(),last_name:g.trim()||null,full_name:`${f.trim()} ${g.trim()}`.trim(),phone_number:L.trim()||null}});U&&console.warn("Failed to update auth.users metadata:",U),await Q(),c(!1),S({type:"success",text:"Profile updated successfully"}),setTimeout(()=>S(null),3e3)}catch(P){console.error("Error saving profile:",P);let U="Failed to save profile";P instanceof Error&&(P.message.includes("phone_number_format_check")?U="Phone number format is invalid. Please use international format with country code (e.g., +4512345678)":U=`Failed to save profile: ${P.message}`),S({type:"danger",text:U})}finally{m(!1)}},A=async E=>{const P=E.target.files?.[0];if(!(!P||!l)){if(!P.type.startsWith("image/")){S({type:"danger",text:"Please select a valid image file"});return}if(P.size>5*1024*1024){S({type:"danger",text:"Image size must be less than 5MB"});return}try{b(!0),S(null);const U=P.name.split(".").pop(),he=`${l.id}-${Date.now()}.${U}`,{data:ie,error:X}=await $.storage.from("avatars").upload(he,P,{cacheControl:"3600",upsert:!0});if(X)throw new Error(`Upload failed: ${X.message}`);const{data:{publicUrl:ce}}=$.storage.from("avatars").getPublicUrl(he);z(ce);const{error:Z}=await $.from("users").update({avatar_url:ce}).eq("id",l.id);if(Z)throw new Error(`Database update failed: ${Z.message}`);await Q(),S({type:"success",text:"Avatar uploaded successfully"}),setTimeout(()=>S(null),3e3)}catch(U){let ne="Failed to upload avatar";U instanceof Error&&(U.message.includes("not found")?ne="Storage bucket not configured. Please contact admin.":U.message.includes("permission")?ne="Permission denied. Please contact admin.":ne=`Upload failed: ${U.message}`),S({type:"danger",text:ne})}finally{b(!1),E.target.value=""}}},H=()=>{w(r?.first_name||""),I(r?.last_name||""),V(r?.role||"UI Developer"),B(r?.department||""),z(r?.avatar_url||""),W(r?.phone_number||""),c(!1),S(null)};return s?e.jsx(ue,{children:e.jsx(De,{children:e.jsx(a,{level:"body-sm",color:"neutral",children:"Loading profile..."})})}):e.jsx(ue,{children:e.jsxs(De,{children:[e.jsx(a,{level:"h4",sx:{mb:1},children:"Personal info"}),e.jsx(a,{level:"body-sm",color:"neutral",sx:{mb:3},children:"Your profile information."}),v&&e.jsx(Je,{color:v.type,sx:{mb:2},children:v.text}),e.jsxs(i,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:3,alignItems:{xs:"center",sm:"stretch"},width:"100%",maxWidth:"100%",overflow:"hidden"},children:[e.jsx(i,{sx:{flex:{xs:"none",sm:"1"},maxWidth:{xs:"100%",sm:"300px"},display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",position:"relative",minHeight:{xs:"auto",sm:"400px"},width:{xs:"100%",sm:"auto"}},children:e.jsxs(i,{sx:{position:"relative",display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsxs(xe,{size:"lg",src:j||r?.avatar_url||l?.user_metadata?.avatar_url,sx:{width:160,height:160},children:[f?.[0],g?.[0]]},`avatar-${j}-${r?.avatar_url}`),o&&e.jsxs(i,{sx:{mt:2,display:"flex",flexDirection:"column",alignItems:"center",gap:1},children:[e.jsxs(pe,{component:"label",size:"sm",variant:"solid",color:"primary",loading:y,sx:{borderRadius:"8px",px:2,py:1},children:[e.jsx(ct,{fontSize:"small",sx:{mr:1}}),"Upload Avatar",e.jsx("input",{type:"file",accept:"image/*",onChange:A,style:{display:"none"}})]}),e.jsx(a,{level:"body-xs",color:"neutral",sx:{textAlign:"center",maxWidth:180,lineHeight:1.4},children:"Max 5MB (JPG, PNG, GIF)"})]})]})}),e.jsxs(i,{sx:{flex:{xs:"none",sm:"2"},maxWidth:{xs:"100%",sm:"calc(100% - 300px - 24px)"},width:{xs:"100%",sm:"auto"},minWidth:0},children:[e.jsxs(J,{spacing:2,children:[e.jsxs(i,{children:[e.jsx(ee,{sx:{mb:1},children:"Name"}),e.jsxs(i,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2},children:[e.jsx(N,{placeholder:"First name",value:f,onChange:E=>w(E.target.value),disabled:!o,sx:{flex:1}}),e.jsx(N,{placeholder:"Last name",value:g,onChange:E=>I(E.target.value),disabled:!o,sx:{flex:1}})]})]}),e.jsxs(se,{children:[e.jsx(ee,{children:"Phone Number"}),e.jsx(N,{value:L,onChange:E=>W(E.target.value),disabled:!o,placeholder:"e.g., +4512345678, +1234567890",startDecorator:"ðŸ“ž"}),o&&e.jsx(a,{level:"body-xs",color:"neutral",sx:{mt:.5},children:"Include country code (e.g., +45 for Denmark, +1 for US/Canada)"})]}),e.jsxs(i,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2},children:[e.jsxs(se,{sx:{flex:1},children:[e.jsx(ee,{children:"Role"}),e.jsx(N,{value:k,onChange:E=>V(E.target.value),disabled:!o})]}),e.jsxs(se,{sx:{flex:1},children:[e.jsx(ee,{children:"Department"}),e.jsx(N,{value:O,onChange:E=>B(E.target.value),disabled:!o,placeholder:"e.g., Engineering, Sales, Marketing"})]})]}),e.jsxs(se,{children:[e.jsx(ee,{children:"Email"}),e.jsx(N,{value:C,disabled:!0,startDecorator:"âœ‰ï¸"})]}),e.jsxs(se,{children:[e.jsx(ee,{children:"Avatar URL"}),e.jsx(N,{value:j,onChange:E=>z(E.target.value),disabled:!o,placeholder:"https://example.com/avatar.jpg",startDecorator:"ðŸ–¼ï¸"})]}),r&&e.jsxs(i,{sx:{mt:2,p:2,bgcolor:"background.level1",borderRadius:"sm"},children:[e.jsx(a,{level:"body-sm",color:"neutral",sx:{mb:1},children:"Account Information"}),e.jsxs(J,{spacing:1,children:[r.created_at&&e.jsxs(a,{level:"body-sm",children:[e.jsx("strong",{children:"Member since:"})," ",new Date(r.created_at).toLocaleDateString()]}),r.last_login&&e.jsxs(a,{level:"body-sm",children:[e.jsx("strong",{children:"Last login:"})," ",new Date(r.last_login).toLocaleDateString()]}),(r.phone_number||L)&&e.jsxs(a,{level:"body-sm",children:[e.jsx("strong",{children:"Phone (stored):"})," ",r.phone_number||L]}),e.jsxs(a,{level:"body-sm",children:[e.jsx("strong",{children:"User ID:"})," ",r.id]})]})]})]}),e.jsx(i,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:1,mt:3,justifyContent:{xs:"stretch",sm:"flex-end"}},children:o?e.jsxs(e.Fragment,{children:[e.jsx(q,{variant:"outlined",onClick:H,disabled:x,startDecorator:e.jsx(Cs,{}),sx:{order:{xs:2,sm:1}},children:"Cancel"}),e.jsx(q,{variant:"solid",onClick:h,loading:x,startDecorator:e.jsx(Ml,{}),sx:{order:{xs:1,sm:2}},children:"Save"})]}):e.jsx(q,{variant:"outlined",onClick:()=>c(!0),startDecorator:e.jsx(ct,{}),children:"Edit Profile"})})]})]})]})})}function Ci(){const[l,t]=ae.useState(""),[r,n]=ae.useState(!0),[s,d]=ae.useState(!1),o=`## Latest Release
**Version 2.1.2** - July 6, 2025

### Recent Updates
- Modern Login Page Redesign with Split Layout
- Glassmorphism effect with backdrop blur and semi-transparent backgrounds
- Dynamic mountain landscape background images that change with light/dark mode
- Dark/light mode toggle in login page header
- Company branding with SmartBack logo and name in header

### System Status
- All systems operational
- Database migrations up to date
- Authentication services active

*For complete release history, please check the development environment or contact support.*`;return ae.useEffect(()=>{const c="/RELEASE_LOG.md";console.log("Fetching release log from:",c),fetch(c).then(x=>{if(console.log("Release log response status:",x.status,x.statusText),!x.ok)throw new Error(`Failed to fetch release log: ${x.status} ${x.statusText}`);return x.text()}).then(x=>{console.log("Release log loaded successfully, length:",x.length);const m=x.replace(/<!--[\s\S]*?-->/g,"").trim();t(m),d(!1)}).catch(x=>{console.error("Error fetching release log:",x),console.log("Using fallback content"),t(o),d(!1)}).finally(()=>n(!1))},[o]),e.jsx(ue,{sx:{height:"100%",minHeight:{xs:200,md:300}},children:e.jsxs(De,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(Tr,{color:"primary"}),e.jsx(a,{level:"h4",children:"Release Log"})]}),e.jsxs(i,{sx:{flex:1,overflow:"auto"},children:[r&&e.jsx(a,{level:"body-sm",color:"neutral",children:"Loading release log..."}),!r&&e.jsx(i,{sx:{typography:"body-sm"},children:e.jsx("div",{dangerouslySetInnerHTML:{__html:ge(l)}})})]})]})})}function ki(){return Pe(),e.jsx(ue,{sx:{height:"100%",minHeight:{xs:120,md:300}},children:e.jsxs(De,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(Wl,{color:"primary"}),e.jsx(a,{level:"h4",children:"Application Info"})]}),e.jsxs(J,{spacing:1.5,sx:{flex:1},children:[e.jsxs(a,{level:"title-md",sx:{fontWeight:"bold"},children:["smartback".charAt(0).toUpperCase()+"smartback".slice(1)," business System"]}),e.jsxs(J,{spacing:.5,children:[e.jsxs(a,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Environment:"})," ","production"]}),e.jsxs(a,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Version:"})," ","3.2.18"]}),e.jsxs(a,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Build Date:"})," ",new Date().toLocaleDateString()]}),e.jsxs(a,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Platform:"})," Web Application"]}),e.jsxs(a,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Language:"})," English (US)"]}),e.jsxs(a,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Currency:"})," ",Ye.currency," (",Ye.symbol,") - ",Ye.locale]}),e.jsxs(a,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Currency Precision:"})," Smart formatting (0-2 decimal places)"]})]})]}),e.jsxs(i,{sx:{mt:3,p:2,backgroundColor:"neutral.50",borderRadius:"md"},children:[e.jsx(a,{level:"title-sm",sx:{mb:1},children:"Currency Formatting Examples"}),e.jsxs(J,{spacing:.5,children:[e.jsxs(a,{level:"body-xs",color:"neutral",children:[e.jsx("strong",{children:"Whole numbers:"})," ",qe(100)," â€¢ ",qe(1500)," â€¢ ",qe(25e3)]}),e.jsxs(a,{level:"body-xs",color:"neutral",children:[e.jsx("strong",{children:"With decimals:"})," ",qe(99.5)," â€¢ ",qe(1234.56)," â€¢ ",qe(15.25)]})]})]}),e.jsx(q,{component:"a",href:"https://nicklasfangerfisk.github.io/Testflow/",target:"_blank",rel:"noopener noreferrer",startDecorator:e.jsx(ql,{}),variant:"outlined",color:"primary",sx:{mt:2,alignSelf:"flex-start"},children:"System Test"})]})})}const _i=()=>{const{isMobile:l}=Pe(),[t,r]=u.useState(0),n=async()=>{try{const{error:c}=await $.auth.signOut();c?console.error("Error signing out:",c):window.location.href="/login"}catch(c){console.error("Error during logout:",c)}},s=[{label:"User",icon:e.jsx(ot,{}),content:e.jsx(Si,{})},{label:"App",icon:e.jsx($l,{}),content:e.jsx(ki,{})},{label:"Releases",icon:e.jsx(Tr,{}),content:e.jsx(Ci,{})}],d=()=>e.jsx(i,{sx:{width:"100%",minHeight:"100vh"},children:e.jsxs(ke,{padding:"medium",children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(a,{level:"h2",sx:{fontSize:le.sizes.xlarge},children:"My profile"}),e.jsx(q,{variant:"outlined",color:"danger",size:"sm",startDecorator:e.jsx(Js,{}),onClick:n,children:"Logout"})]}),e.jsxs(Fs,{value:t,onChange:(c,x)=>r(typeof x=="number"?x:0),sx:{bgcolor:"transparent"},children:[e.jsx(Us,{sx:{bgcolor:"transparent"},children:s.map((c,x)=>e.jsx(Bs,{value:x,sx:{bgcolor:"transparent"},children:c.label},x))}),s.map((c,x)=>e.jsx(Hs,{value:x,sx:{p:0,pt:3,bgcolor:"transparent"},children:c.content},x))]})]})}),o=()=>e.jsxs(ke,{variant:"table-page",children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(a,{level:"h2",sx:{fontSize:le.sizes.xlarge},children:"My profile"}),e.jsx(q,{variant:"outlined",color:"danger",startDecorator:e.jsx(Js,{}),onClick:n,children:"Logout"})]}),e.jsxs(Fs,{value:t,onChange:(c,x)=>r(typeof x=="number"?x:0),sx:{bgcolor:"transparent"},children:[e.jsx(Us,{sx:{bgcolor:"transparent"},children:s.map((c,x)=>e.jsx(Bs,{value:x,sx:{bgcolor:"transparent"},children:c.label},x))}),s.map((c,x)=>e.jsx(Hs,{value:x,sx:{p:0,pt:3,bgcolor:"transparent"},children:c.content},x))]})]});return e.jsx(Fe,{children:l?e.jsx(d,{}):e.jsx(o,{})})};function Di(){const l=_s(),{isMobile:t}=Pe(),r=ks(),[n,s]=u.useState("dashboard"),d=[{label:"Dashboard",icon:e.jsx(js,{}),value:"dashboard"},{label:"Orders",icon:e.jsx(bs,{}),value:"orders"},{label:"Customers",icon:e.jsx(ys,{}),value:"customers"},{label:"My Profile",icon:e.jsx(ot,{}),value:"profile"},{label:"Settings",icon:e.jsx(Fl,{}),value:"settings"}];return u.useEffect(()=>{s({"/":"dashboard","/dashboard":"dashboard","/orders":"orders","/products":"dashboard","/users":"users","/suppliers":"dashboard","/purchase-orders":"dashboard","/tickets":"dashboard","/sms-campaigns":"dashboard","/movements":"dashboard","/settings":"profile","/email-settings":"profile"}[l.pathname]||"dashboard")},[l.pathname]),console.log("isMobile:",t),e.jsxs(i,{sx:{display:"flex",height:"100vh",overflow:"hidden"},children:[l.pathname!=="/login"&&!t&&e.jsx(Kl,{setView:o=>console.log(o),view:"home"}),e.jsxs(i,{component:"main",sx:{flexGrow:1,display:"flex",flexDirection:"column",height:"100%",bgcolor:"background.default",p:0,width:t?"100%":"calc(100% - var(--Sidebar-width, 240px))",marginBottom:t?"56px":0,overflow:"auto"},children:[t&&l.pathname!=="/login"&&e.jsx(In,{items:d,value:n,onChange:o=>{s(o);const x={home:"/",dashboard:"/dashboard",orders:"/orders",products:"/products",users:"/users",customers:"/customers",employees:"/employees",suppliers:"/suppliers",purchaseorders:"/purchase-orders",tickets:"/tickets",smscampaigns:"/sms-campaigns",movements:"/movements",profile:"/settings",settings:"/settings",emailsettings:"/email-settings"}[o]||`/${o}`;r(x)},toggleSidebar:()=>console.log("Sidebar toggled")}),e.jsxs(Ds,{children:[e.jsx(_e,{path:"/",element:e.jsx(qt,{to:"/dashboard",replace:!0})}),e.jsx(_e,{path:"/orders",element:e.jsx(Me,{children:e.jsx(cn,{})})}),e.jsx(_e,{path:"/products",element:e.jsx(Me,{children:e.jsx(un,{})})}),e.jsx(_e,{path:"/users",element:e.jsx(Me,{children:e.jsx(xn,{})})}),e.jsx(_e,{path:"/customers",element:e.jsx(Me,{children:e.jsx(gn,{})})}),e.jsx(_e,{path:"/employees",element:e.jsx(Me,{children:e.jsx(bn,{})})}),e.jsx(_e,{path:"/suppliers",element:e.jsx(Me,{children:e.jsx(vn,{})})}),e.jsx(_e,{path:"/storefronts",element:e.jsx(Me,{children:e.jsx(Sn,{})})}),e.jsx(_e,{path:"/purchase-orders",element:e.jsx(Me,{children:e.jsx(Dn,{})})}),e.jsx(_e,{path:"/tickets",element:e.jsx(Me,{children:e.jsx(On,{})})}),e.jsx(_e,{path:"/sms-campaigns",element:e.jsx(Me,{children:e.jsx(An,{})})}),e.jsx(_e,{path:"/dashboard",element:e.jsx(Me,{children:e.jsx(Ln,{})})}),e.jsx(_e,{path:"/movements",element:e.jsx(Me,{children:e.jsx(Mn,{})})}),e.jsx(_e,{path:"/settings",element:e.jsx(Me,{children:e.jsx(_i,{})})}),e.jsx(_e,{path:"/email-settings",element:e.jsx(Me,{children:e.jsx(Wn,{})})}),e.jsx(_e,{path:"*",element:e.jsx(qt,{to:"/",replace:!0})})]})]})]})}function Ii(){return e.jsx(_r,{children:e.jsx(Bl,{children:e.jsxs(Ds,{children:[e.jsx(_e,{path:"/login/*",element:e.jsx($n,{})}),e.jsx(_e,{path:"/*",element:e.jsx(Di,{})})]})})})}console.log("Mounting React app...");const wr=document.getElementById("root");wr?(Vl.createRoot(wr).render(e.jsx(Ii,{})),console.log("React app rendered!")):console.error("No #root element found in index.html!");

import{b as En,u as An,r as u,j as e,I as re,M as _e,d as Pe,D as Gt,e as Zt,B as x,A as oe,T as g,f as ot,h as B,i as Qt,k as q,R as G,l as On,m as Et,G as In,L as At,n as ft,o as mt,p as Me,q as vt,s as Dn,t as Ve,F as ue,v as he,S as ne,w as z,x as _s,y as Ue,z as ee,C as Kt,E as Ps,H as Y,J as Ae,K as ke,N as Dr,O as Tr,P as zr,Q as lt,U as Lt,V as Ke,W as Tn,X as zn,Y as Ln,Z as Nn,_ as Mn,$ as Qs,a0 as Fn,a1 as qn,a2 as $n,a3 as Ks,a4 as ms,a5 as Un,a6 as Bn}from"./mui-core-BlyZvqL8.js";import{D as Wn,L as Hn,P as Vn,H as Jn,a as Es,S as As,b as Lr,G as Os,c as Nr,A as Mr,Q as Fr,d as Nt,e as Mt,f as Gn,K as Zn,g as Xs,h as jt,i as ae,j as ge,F as Is,k as Ft,l as Ys,I as er,E as qt,m as Qn,n as qr,o as $r,p as Kn,C as Xn,M as Yn,q as ei,r as ti,s as si,t as Ds,u as Ur,v as tr,w as ri,x as ni,B as ii,y as li,z as oi,J as ai,N as ci,O as di,R as ui,U as hi}from"./mui-icons-vsQByKBf.js";import{c as xi}from"./supabase-BxkNBt-5.js";import{N as $t,u as Ts,a as zs,R as Ls,b as ye,B as pi}from"./router-CnZFtCWX.js";import{f as os}from"./utils-CSQe5d3I.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(i){if(i.ep)return;i.ep=!0;const l=r(i);fetch(i.href,l)}})();var kt={},sr;function fi(){if(sr)return kt;sr=1;var s=En();return kt.createRoot=s.createRoot,kt.hydrateRoot=s.hydrateRoot,kt}var mi=fi();function gi(s){const{onClick:t,sx:r,...n}=s,{mode:i,setMode:l}=An(),[o,a]=u.useState(!1);return u.useEffect(()=>{a(!0)},[]),o?e.jsxs(re,{"data-screenshot":"toggle-mode",size:"sm",variant:"outlined",color:"neutral",...n,onClick:c=>{l(i==="light"?"dark":"light"),t?.(c)},sx:[i==="dark"?{"& > *:first-of-type":{display:"none"}}:{"& > *:first-of-type":{display:"initial"}},i==="light"?{"& > *:last-of-type":{display:"none"}}:{"& > *:last-of-type":{display:"initial"}},...Array.isArray(r)?r:[r]],children:[e.jsx(Wn,{}),e.jsx(Hn,{})]}):e.jsx(re,{size:"sm",variant:"outlined",color:"neutral",...n,sx:r,disabled:!0})}const Br="https://tfzvtzqybgbzxcxozdes.supabase.co",gs="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRmenZ0enF5YmdienhjeG96ZGVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NTc2MDIsImV4cCI6MjA2MzQzMzYwMn0.hD2WdkvI8LY9N0IHP7HDQliyicQA0c-mspKjCJf0_Fc";console.log("[Supabase] URL:",Br);console.log("[Supabase] Anon Key:",gs.slice(0,6)+"..."+gs.slice(-6));const M=xi(Br,gs);M.auth.onAuthStateChange((s,t)=>{console.log("[Auth State Change]",s,t),s==="SIGNED_IN"?console.log("User signed in:",t?.user):s==="SIGNED_OUT"&&console.log("User signed out")});let as=!1;M.auth.onAuthStateChange((s,t)=>{as||(as=!0,console.log("[Auth State Change]",s,t),s==="SIGNED_IN"?console.log("User signed in:",t?.user):s==="SIGNED_OUT"&&(console.log("User signed out"),window.location.pathname!=="/login"&&(window.location.href="/login")),as=!1)});function ji({open:s,onClose:t,userProfile:r,editName:n,setEditName:i,editAvatar:l,setEditAvatar:o,onSave:a}){const[c,d]=u.useState(!1),[p,m]=u.useState(null),v=u.useRef(null);async function C(h){const b=h.target.files&&h.target.files[0];if(!(!b||!r?.id)){d(!0),m(null);try{const S=b.name.split(".").pop()?.replace(/\./,"")||"png",O=`avatars/${r.id}_${Date.now()}.${S}`,k=await M.storage.from("avatars").upload(O,b,{upsert:!0,contentType:b.type});if(k.error)throw k.error;const{publicUrl:j}=M.storage.from("avatars").getPublicUrl(O).data;j&&o(j)}catch(S){m("Failed to upload avatar. Please try again."),console.error("Avatar upload failed",S)}d(!1)}}return e.jsx(_e,{open:s,onClose:t,children:e.jsxs(Pe,{children:[e.jsx(Gt,{children:"Edit Profile"}),e.jsxs(Zt,{sx:{display:"flex",flexDirection:"row",gap:3,alignItems:"flex-start"},children:[e.jsxs(x,{sx:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:110},children:[e.jsx(oe,{src:l||r?.avatar_url||"",alt:n||r?.name||"Avatar",sx:{width:96,height:96,mb:1}}),e.jsxs(g,{level:"body-xs",sx:{mt:1,textAlign:"center"},children:["Last login:",e.jsx("br",{}),r?.last_login?new Date(r.last_login).toLocaleString():"Never"]})]}),e.jsx(ot,{orientation:"vertical",sx:{mx:1,alignSelf:"stretch"}}),e.jsxs(x,{sx:{flex:1,display:"flex",flexDirection:"column",gap:2},children:[e.jsx(g,{level:"body-sm",children:"Name"}),e.jsx(B,{placeholder:"Your name",value:n,onChange:h=>i(h.target.value),sx:{mb:1},required:!0}),e.jsx(g,{level:"body-sm",children:"Avatar URL"}),e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(B,{placeholder:"Avatar image URL",value:l,onChange:h=>o(h.target.value),sx:{flex:1}}),e.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},ref:v,onChange:C,disabled:c}),e.jsx(re,{component:"span",onClick:()=>v.current?.click(),disabled:c,title:"Upload from device",children:e.jsx(Vn,{})})]}),p&&e.jsx(g,{color:"danger",sx:{mt:1},children:p})]})]}),e.jsxs(Qt,{children:[e.jsx(q,{variant:"plain",onClick:t,disabled:c,children:"Cancel"}),e.jsx(q,{onClick:()=>{a(),t()},disabled:c||!n,children:"Save"})]})]})})}const Ns=s=>t=>{const[r,n]=G.useState(null),[i,l]=G.useState(!0);return G.useEffect(()=>{async function o(){const{data:a}=await M.auth.getSession();n(a?.session||null),l(!1)}o()},[]),i?e.jsx("div",{children:"Loading..."}):r?e.jsx(s,{...t}):e.jsx($t,{to:"/login",replace:!0})},bi=[{label:"Home",icon:G.createElement(Jn),value:"home",route:"/",showInMobile:!0},{label:"Dashboard",icon:G.createElement(Es),value:"dashboard",route:"/dashboard",showInMobile:!0},{label:"Orders",icon:G.createElement(As),value:"orders",route:"/orders",showInMobile:!0},{label:"Products",icon:G.createElement(Lr),value:"products",route:"/products",showInMobile:!0},{label:"Users",icon:G.createElement(Os),value:"users",route:"/users",showInMobile:!0},{label:"Suppliers",icon:G.createElement(Nr),value:"suppliers",route:"/suppliers",showInMobile:!0},{label:"Purchase Orders",icon:G.createElement(Mr),value:"purchaseorders",route:"/purchase-orders",showInMobile:!0},{label:"Tickets",icon:G.createElement(Fr),value:"tickets",route:"/tickets",showInMobile:!0},{label:"SMS Campaigns",icon:G.createElement(Nt),value:"smscampaigns",route:"/sms-campaigns",showInMobile:!0},{label:"Movements",icon:G.createElement(Nt),value:"movements",route:"/movements",showInMobile:!0},{label:"Settings",icon:G.createElement(Mt),value:"settings",route:"/settings",showInMobile:!1}],Ot={Sales:[{label:"Dashboard",icon:G.createElement(Es),value:"dashboard",route:"/dashboard",showInMobile:!0},{label:"Orders",icon:G.createElement(As),value:"orders",route:"/orders",showInMobile:!0},{label:"Products",icon:G.createElement(Lr),value:"products",route:"/products",showInMobile:!0}],Support:[{label:"Tickets",icon:G.createElement(Fr),value:"tickets",route:"/tickets",showInMobile:!0},{label:"Users",icon:G.createElement(Os),value:"users",route:"/users",showInMobile:!0}],Marketing:[{label:"SMS Campaigns",icon:G.createElement(Nt),value:"smscampaigns",route:"/sms-campaigns",showInMobile:!0}],Operations:[{label:"Suppliers",icon:G.createElement(Nr),value:"suppliers",route:"/suppliers",showInMobile:!0},{label:"Purchase Orders",icon:G.createElement(Mr),value:"purchaseorders",route:"/purchase-orders",showInMobile:!0},{label:"Movements",icon:G.createElement(Nt),value:"movements",route:"/movements",showInMobile:!0}]};function Se(){const s=On(),t=Et("(max-width:600px)"),r=Et("(min-width:601px) and (max-width:1024px)"),n=Et("(min-width:1025px)");return{isMobile:t,isTablet:r,isDesktop:n,isSmallScreen:t,isMediumScreen:r,isLargeScreen:n,breakpoints:{mobile:"600px",tablet:"1024px",desktop:"1025px"},theme:s}}function Wr(){const{isMobile:s,isTablet:t}=Se();return{containerPadding:s?1:t?2:3,sectionPadding:s?2:t?3:4,itemPadding:s?1:2,smallGap:s?1:2,mediumGap:s?2:3,largeGap:s?3:4,sectionMargin:s?2:3,itemMargin:s?1:2}}function yi(){const{isMobile:s}=Se();return{getModalSize:(r="medium")=>s?{width:"95vw",height:r==="fullscreen"?"95vh":"auto",maxHeight:"90vh",margin:1}:{small:{width:400,maxWidth:"90vw"},medium:{width:600,maxWidth:"90vw"},large:{width:800,maxWidth:"90vw"},fullscreen:{width:"90vw",height:"90vh"}}[r]}}function wi({setView:s,view:t}){const r=Ts(),n=zs(),{isMobile:i,isTablet:l,isDesktop:o}=Se(),[a,c]=u.useState(!1),[d,p]=u.useState([]),[m,v]=u.useState(null),[C,h]=u.useState(null),[b,S]=u.useState(!1),[O,k]=u.useState(""),[j,_]=u.useState(""),[N,U]=u.useState(!1);u.useEffect(()=>{async function I(){const{data:P,error:F}=await M.from("users").select("*");!F&&P&&p(P)}I();async function y(P){if(v(P),P){let{data:F}=await M.from("users").select("*").eq("id",P.id).single();F||(await M.from("users").upsert({id:P.id,email:P.email,name:P.user_metadata?.full_name||null,avatar_url:P.user_metadata?.avatar_url||null,role:"employee"}),F={...P,role:"employee"}),h(F),k(F.name||""),_(F.avatar_url||"")}else h(null),k(""),_("")}M.auth.getUser().then(({data:P})=>y(P.user));const{data:E}=M.auth.onAuthStateChange((P,F)=>{y(F?.user??null)});return()=>{E?.subscription.unsubscribe()}},[]);const R=async()=>{if(!m)return;await M.from("users").update({name:O,avatar_url:j}).eq("id",m.id);const{data:I}=await M.from("users").select("*").eq("id",m.id).single();h(I||null),S(!1)};u.useEffect(()=>{l&&c(!0)},[l,o]);const W=I=>{r(I.route),s(I.value),l&&c(!0)},D=()=>{c(!a)},T=(I,y)=>{W({value:y,route:I})},L=I=>n.pathname===I;return e.jsxs(x,{className:"Sidebar",sx:{display:i?"none":"flex",position:{xs:"fixed",md:"sticky"},transform:{xs:"translateX(calc(100% * (var(--SideNavigation-slideIn, 0) - 1)))",md:"none"},transition:"transform 0.4s, width 0.4s",zIndex:1e4,height:"100dvh",width:"var(--Sidebar-width)",top:0,p:2,flexShrink:0,flexDirection:"column",gap:2,borderRight:"1px solid",borderColor:"divider",background:"var(--joy-palette-background-surface, #fff)"},children:[e.jsx(In,{styles:I=>({":root":{"--Sidebar-width":a?"60px":"220px",[I.breakpoints.up("lg")]:{"--Sidebar-width":a?"60px":"240px"}}})}),e.jsx(x,{className:"Sidebar-overlay",sx:{position:"fixed",zIndex:9998,top:0,left:0,width:"100vw",height:"100vh",opacity:"var(--SideNavigation-slideIn)",backgroundColor:"var(--joy-palette-background-backdrop)",transition:"opacity 0.4s",transform:{xs:"translateX(calc(100% * (var(--SideNavigation-slideIn, 0) - 1) + var(--SideNavigation-slideIn, 0) * var(--Sidebar-width, 0px)))",lg:"translateX(-100%)"}}}),e.jsxs(x,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(re,{size:"sm",variant:"plain",onClick:D,sx:{p:.5,borderRadius:1,"&:hover":{bgcolor:"neutral.100"}},children:e.jsx("img",{src:"/favicon.svg",alt:"Logo",style:{width:28,height:28,borderRadius:6}})}),!a&&e.jsxs(e.Fragment,{children:[e.jsx(g,{level:"title-lg",children:"Smartbuy"}),e.jsx(gi,{sx:{ml:"auto"}})]})]}),!a&&e.jsx(B,{size:"sm",startDecorator:e.jsx(Gn,{}),placeholder:"Search"}),e.jsx(x,{sx:{minHeight:0,overflowY:"auto",overflowX:"hidden",flex:"0 0 auto",display:"flex",flexDirection:"column",[`& .${Dn.root}`]:{gap:1.5}},children:e.jsx(At,{size:"sm",sx:{gap:1,"--List-nestedInsetStart":"30px","--ListItem-radius":I=>I.vars.radius.sm},children:["Sales","Support","Operations","Marketing"].map(I=>e.jsx(ft,{nested:!0,children:e.jsx(Si,{defaultExpanded:!a,renderToggle:({open:y,setOpen:E})=>a?e.jsx(mt,{title:I,placement:"right",arrow:!0,children:e.jsx(Me,{onClick:()=>E(!y),children:Ot[I][0]?.icon})}):e.jsxs(Me,{onClick:()=>E(!y),children:[Ot[I][0]?.icon,e.jsx(vt,{children:e.jsx(g,{level:"title-sm",children:I})}),e.jsx(Zn,{sx:[y?{transform:"rotate(180deg)"}:{transform:"none"}]})]}),children:e.jsx(At,{sx:{gap:.5},children:Ot[I].map(y=>e.jsx(ft,{children:a?e.jsx(mt,{title:y.label,placement:"right",arrow:!0,children:e.jsx(Me,{selected:L(y.route),onClick:()=>T(y.route,y.value),sx:{justifyContent:"center",px:1,width:"100%"},children:y.icon})}):e.jsxs(Me,{selected:L(y.route),onClick:()=>T(y.route,y.value),sx:{justifyContent:"flex-start",px:2,width:"100%"},children:[y.icon,e.jsx(vt,{children:e.jsx(g,{level:"body-sm",children:y.label})})]})},y.value))})})},I))})}),e.jsx(x,{sx:{mt:"auto",mb:2},children:e.jsxs(At,{sx:{p:0},children:[e.jsx(ft,{sx:{p:0,alignItems:"stretch"},children:a?e.jsx(mt,{title:"Settings",placement:"right",arrow:!0,children:e.jsx(Me,{selected:L("/settings"),onClick:()=>T("/settings","settings"),sx:{width:"100%",alignItems:"center",minHeight:40,justifyContent:"center",px:1},children:e.jsx(Mt,{})})}):e.jsxs(Me,{selected:L("/settings"),onClick:()=>T("/settings","settings"),sx:{width:"100%",alignItems:"center",minHeight:40,justifyContent:"flex-start",px:2},children:[e.jsx(Mt,{sx:{mr:1}}),e.jsx(vt,{sx:{display:"flex",alignItems:"center",p:0},children:e.jsx(g,{level:"body-sm",children:"Settings"})})]})}),e.jsx(ft,{sx:{p:0,alignItems:"stretch"},children:a?e.jsx(mt,{title:"Logout",placement:"right",arrow:!0,children:e.jsx(Me,{onClick:async()=>{await M.auth.signOut(),window.location.href="/login"},sx:{width:"100%",alignItems:"center",minHeight:40,justifyContent:"center",px:1},children:e.jsx(Xs,{})})}):e.jsxs(Me,{onClick:async()=>{await M.auth.signOut(),window.location.href="/login"},sx:{width:"100%",alignItems:"center",minHeight:40,justifyContent:"flex-start",px:2},children:[e.jsx(Xs,{sx:{mr:1}}),e.jsx(vt,{sx:{display:"flex",alignItems:"center",p:0},children:e.jsx(g,{level:"body-sm",children:"Logout"})})]})})]})}),e.jsx(ot,{}),e.jsxs(x,{sx:{display:"flex",gap:1,alignItems:"center",minHeight:48},children:[e.jsx(oe,{variant:"outlined",size:"sm",src:C?.avatar_url||m?.user_metadata?.avatar_url||void 0,onClick:()=>U(!0),sx:{cursor:"pointer"}}),e.jsxs(x,{sx:{minWidth:0,flex:1,cursor:"pointer"},onClick:()=>U(!0),children:[e.jsx(g,{level:"title-sm",children:C?.name||m?.user_metadata?.full_name||m?.email||"Not signed in"}),e.jsx(g,{level:"body-xs",children:C?.email||m?.email||""})]})]}),e.jsx(ji,{open:N,onClose:()=>U(!1),userProfile:C,editName:O,setEditName:k,editAvatar:j,setEditAvatar:_,onSave:R})]})}function Si({defaultExpanded:s=!1,renderToggle:t,children:r}){const[n,i]=u.useState(s);return e.jsxs(u.Fragment,{children:[t({open:n,setOpen:i}),e.jsx(x,{sx:{display:"grid",transition:"0.2s ease","& > *":{overflow:"hidden"},gridTemplateRows:n?"1fr":"0fr"},children:r})]})}const vi=Ns(wi);function je({children:s,variant:t="page",padding:r="medium",fullHeight:n=!1,className:i}){Se();const l=Wr(),o=()=>r==="none"?0:{small:l.itemPadding,medium:l.containerPadding,large:l.sectionPadding}[r]||l.containerPadding,a=()=>{const c={p:o(),boxSizing:"border-box"};switch(t){case"page":return{...c,height:n?"100%":"auto",overflow:"auto",width:"100%"};case"dialog":return{...c,height:"auto",overflow:"visible"};case"form":return{...c,display:"flex",flexDirection:"column",gap:l.mediumGap};case"card":return{...c,borderRadius:1,bgcolor:"background.surface"};default:return c}};return e.jsx(x,{sx:a(),className:i,children:s})}function Ut({open:s,onClose:t,children:r,title:n,size:i="medium",showCloseButton:l=!0,actions:o}){const{getModalSize:a}=yi();return e.jsx(_e,{open:s,onClose:t,children:e.jsxs(Pe,{sx:a(i),children:[l&&e.jsx(Ve,{}),n&&e.jsx(Gt,{children:n}),e.jsx(Zt,{children:r}),o&&e.jsx(Qt,{children:o})]})})}const Le=({children:s})=>e.jsx(x,{sx:{display:"flex",flexDirection:"column",pl:"16px",pr:"6px",pt:"6px",width:"100%",flex:1,minHeight:0,height:"100%",overflow:"hidden",bgcolor:"background.body"},children:s}),ki=({open:s,creating:t,newOrder:r,setNewOrder:n,onClose:i,onCreate:l})=>{const[o,a]=u.useState([]),[c,d]=u.useState([{id:crypto.randomUUID(),product:null,quantity:1,unitprice:0,discount:0}]),[p,m]=u.useState(!1),[v,C]=u.useState(null),[h,b]=u.useState(null),[S,O]=u.useState(0),[k,j]=u.useState(!1),[_,N]=u.useState(null),[U,R]=u.useState(!1);u.useEffect(()=>{s&&(d([{id:crypto.randomUUID(),product:null,quantity:1,unitprice:0,discount:0}]),C(null),n(I=>({...I,date:I.date||new Date().toISOString().slice(0,10)})))},[s]),u.useEffect(()=>{s&&(m(!0),b(null),M.from("Products").select("*").then(({data:I,error:y})=>{!y&&I?(I.length===0&&b("No products available. Please add products first."),a(I.map(E=>({id:E.uuid||E.id,ProductName:E.ProductName,SalesPrice:E.SalesPrice??0})))):b("Failed to load products. Please try again later."),m(!1)}))},[s]);const W=()=>{d(I=>[...I,{id:crypto.randomUUID(),product:null,quantity:1,unitprice:0,discount:S}])},D=I=>{d(y=>y.filter((E,P)=>P!==I))},T=(I,y,E)=>{d(P=>P.map((F,xe)=>{if(xe!==I)return F;if(y==="product"&&E){const Oe=o.find(le=>le.id===E.id);return{...F,product:E,unitprice:Oe?.SalesPrice??0}}return y==="product"&&!E?{...F,product:null,unitprice:0}:{...F,[y]:E}}))},L=I=>{I.preventDefault();const y=c.filter(E=>E.product&&E.product.id&&E.quantity>0).map(E=>({product_uuid:E.product.id,quantity:E.quantity,unitprice:E.unitprice,discount:E.discount}));if(y.length===0){C("Please add at least one valid order item.");return}C(null),l(y,S)};return e.jsx(_e,{open:s,onClose:i,"aria-labelledby":"create-order-modal",children:e.jsxs(Pe,{"aria-labelledby":"create-order-modal",sx:{maxWidth:600,width:"100%",minWidth:{xs:300,sm:400}},children:[e.jsx(Ve,{}),e.jsx(g,{id:"create-order-modal",level:"h4",sx:{mb:2},children:"Create Order"}),e.jsxs("form",{onSubmit:L,children:[e.jsxs(ue,{sx:{mb:2},required:!0,children:[e.jsx(he,{children:"Date"}),e.jsx(B,{type:"date",value:r.date,onChange:I=>n(y=>({...y,date:I.target.value})),required:!0})]}),e.jsxs(ue,{sx:{mb:2},required:!0,children:[e.jsx(he,{children:"Status"}),e.jsxs(ne,{value:r.status,onChange:(I,y)=>n(E=>({...E,status:y||"Paid"})),children:[e.jsx(z,{value:"Paid",children:"Paid"}),e.jsx(z,{value:"Refunded",children:"Refunded"}),e.jsx(z,{value:"Cancelled",children:"Cancelled"})]})]}),e.jsxs(ue,{sx:{mb:2},required:!0,children:[e.jsx(he,{children:"Customer Name"}),e.jsx(B,{value:r.customer_name,onChange:I=>n(y=>({...y,customer_name:I.target.value})),required:!0})]}),e.jsxs(ue,{sx:{mb:2},required:!0,children:[e.jsx(he,{children:"Customer Email"}),e.jsx(B,{type:"email",value:r.customer_email,onChange:I=>n(y=>({...y,customer_email:I.target.value})),required:!0})]}),e.jsxs(ue,{sx:{mb:2},required:!0,children:[e.jsx(he,{children:"Order Discount (%)"}),e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(B,{type:"number",value:S,disabled:c.length>0&&!(c.length===1&&!c[0].product),onChange:I=>{const y=Math.max(0,Math.min(100,Math.floor(Number(I.target.value))));O(y),d(E=>E.map(P=>({...P,discount:y})))},slotProps:{input:{min:0,max:100,step:1}},required:!0,placeholder:"Order Discount %",sx:{flex:1}}),(c.length>1||c.length===1&&c[0].product)&&e.jsx(q,{size:"sm",variant:"outlined",onClick:()=>j(!0),children:"Edit"})]})]}),v&&e.jsx(g,{color:"danger",sx:{mb:1},children:v}),e.jsx(ot,{sx:{my:2}}),e.jsx(x,{sx:{mb:1,fontWeight:"lg",fontSize:"lg"},children:"Order Items"}),h&&e.jsx(g,{color:"danger",sx:{mb:1},children:h}),c.map((I,y)=>e.jsxs(x,{sx:{display:"flex",gap:1,alignItems:"center",mb:1},children:[e.jsx(_s,{options:o,getOptionLabel:E=>E.ProductName,isOptionEqualToValue:(E,P)=>E.id===P.id,value:I.product,onChange:(E,P)=>T(y,"product",P),loading:p,placeholder:p?"Loading...":"Search product",sx:{minWidth:220},disabled:o.length===0,required:!0,renderOption:(E,P)=>e.jsx("li",{...E,children:P.ProductName})}),e.jsx(B,{type:"number",value:I.quantity,onChange:E=>T(y,"quantity",Math.max(1,Number(E.target.value))),sx:{width:80},required:!0,slotProps:{input:{min:1}}}),e.jsx(B,{type:"number",value:I.unitprice,onChange:E=>T(y,"unitprice",Math.max(0,Number(E.target.value))),sx:{width:100},required:!0,slotProps:{input:{min:0,step:.01}},placeholder:"Unit Price"}),e.jsx(B,{type:"number",value:I.discount,onChange:E=>T(y,"discount",Math.max(0,Math.min(100,Math.floor(Number(E.target.value))))),sx:{width:80},required:!0,slotProps:{input:{min:0,max:100,step:1}},placeholder:"Discount %"}),e.jsx(re,{size:"sm",color:"danger",onClick:()=>D(y),disabled:c.length===1,children:e.jsx(jt,{})})]},I.id)),e.jsx(q,{startDecorator:e.jsx(ae,{}),variant:"soft",size:"sm",onClick:W,sx:{mb:2},disabled:!!h,children:"Add Item"}),e.jsx(_e,{open:k,onClose:()=>j(!1),children:e.jsxs(Pe,{sx:{minWidth:350},children:[e.jsx(g,{level:"title-md",sx:{mb:1},children:"Change Order Discount"}),e.jsxs(ue,{sx:{mb:2},required:!0,children:[e.jsx(he,{children:"Change discount to (%)"}),e.jsx(B,{type:"number",value:_??S,onChange:I=>N(Math.max(0,Math.min(100,Math.floor(Number(I.target.value))))),slotProps:{input:{min:0,max:100,step:1}},required:!0,autoFocus:!0})]}),e.jsx(g,{sx:{mb:2},children:"How do you want to apply the new order discount?"}),e.jsxs(x,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[e.jsx(q,{onClick:()=>{O(_),d(I=>I.map(y=>({...y,discount:_}))),j(!1),N(null)},children:"Overwrite all"}),e.jsx(q,{onClick:()=>{O(_),d(I=>I.map(y=>y.discount<_?{...y,discount:_}:y)),j(!1),N(null)},children:"Set discount on lower"}),e.jsx(q,{variant:"plain",onClick:()=>{j(!1),N(null)},children:"Cancel"})]})]})}),e.jsxs(x,{sx:{display:"flex",gap:2,mt:2},children:[e.jsx(q,{type:"submit",loading:t,color:"primary",disabled:!!h,children:"Create"}),e.jsx(q,{variant:"plain",onClick:i,disabled:t,children:"Cancel"})]})]})]})})};function Ci({open:s,onClose:t,selectedOrder:r,fetchOrderItems:n}){const[i,l]=u.useState([]),[o,a]=u.useState(!1);return u.useEffect(()=>{async function c(){if(r){a(!0);const d=await n(r.uuid);l(d),a(!1)}else l([])}s&&r?c():l([])},[s,r,n]),e.jsx(_e,{open:s,onClose:t,"aria-labelledby":"order-details-modal",children:e.jsxs(Pe,{"aria-labelledby":"order-details-modal",sx:{maxWidth:600,width:"100%"},children:[e.jsx(Ve,{}),e.jsx(g,{id:"order-details-modal",level:"title-md",fontWeight:"lg",sx:{mb:2},children:"Order Details"}),r&&e.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(g,{level:"body-sm",sx:{color:"text.secondary"},children:["Order ID: ",r.uuid]}),e.jsxs(g,{level:"body-sm",sx:{color:"text.secondary"},children:["Date: ",new Date(r.date).toLocaleString()]}),e.jsxs(g,{level:"body-sm",sx:{color:"text.secondary"},children:["Status: ",r.status]})]}),e.jsx(ot,{}),e.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(g,{level:"body-sm",fontWeight:"md",children:"Customer Information"}),e.jsxs(g,{level:"body-sm",sx:{color:"text.secondary"},children:["Name: ",r.customer.name]}),e.jsxs(g,{level:"body-sm",sx:{color:"text.secondary"},children:["Email: ",r.customer.email]})]}),e.jsx(ot,{}),e.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(g,{level:"body-sm",fontWeight:"md",children:"Ordered Items"}),o?e.jsx(g,{level:"body-sm",sx:{color:"text.secondary"},children:"Loading items..."}):e.jsxs(Ue,{size:"sm",sx:{minWidth:500},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{style:{textAlign:"right"},children:"Quantity"}),e.jsx("th",{style:{textAlign:"right"},children:"Unit Price"}),e.jsx("th",{style:{textAlign:"right"},children:"Discount (%)"}),e.jsx("th",{style:{textAlign:"right"},children:"Total Price"})]})}),e.jsx("tbody",{children:i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{textAlign:"center",padding:"16px"},children:e.jsx(g,{level:"body-sm",sx:{color:"text.secondary"},children:"No items found for this order."})})}):i.map(function(c){return e.jsxs("tr",{children:[e.jsx("td",{children:c.name||c.product_uuid}),e.jsx("td",{style:{textAlign:"right"},children:c.quantity??"-"}),e.jsx("td",{style:{textAlign:"right"},children:c.unitprice!=null?`$${Number(c.unitprice).toFixed(2)}`:"-"}),e.jsx("td",{style:{textAlign:"right"},children:c.discount!=null?`${Number(c.discount).toFixed(2)}%`:"-"}),e.jsx("td",{style:{textAlign:"right"},children:c.price!=null?`$${Number(c.price).toFixed(2)}`:"-"})]},c.uuid)})})]})]})]})]})})}const K={sizes:{small:"0.875rem",xlarge:"1.5rem"}},be={fontSize:K.sizes.small},Ri=()=>{const{isMobile:s}=Se(),[t,r]=u.useState([]),[n,i]=u.useState(!1),[l,o]=u.useState(""),[a,c]=u.useState(""),[d,p]=u.useState(""),[m,v]=u.useState(""),[C,h]=u.useState(!1),[b,S]=u.useState(!1),[O,k]=u.useState(!1),[j,_]=u.useState(null),[N,U]=u.useState(!1),[R,W]=u.useState({date:new Date().toISOString().split("T")[0],status:"Paid",customer_name:"",customer_email:""}),[D,T]=u.useState(!1),[L,I]=u.useState(""),[y,E]=u.useState("success"),P=(f,$="success")=>{I(f),E($),T(!0)},F=f=>{switch(f){case"Paid":return"success";case"Refunded":return"warning";case"Cancelled":return"danger";default:return"neutral"}},xe=f=>{switch(f){case"Paid":return e.jsx(Ys,{});case"Refunded":return e.jsx(Ys,{});case"Cancelled":return e.jsx(Ft,{});default:return e.jsx(Ft,{})}},Oe=f=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(f),le=async()=>{i(!0);try{const{data:f,error:$}=await M.from("Orders").select("*");if($){console.error("Error fetching orders:",$),P("Failed to fetch orders","danger");return}if(f){const X=f.map(J=>({uuid:J.uuid,date:J.date||J.created_at||J["Created at"]||"",status:J.status||"Paid",customer:J.customer||{initial:J.customer_initial||(J.customer_name?J.customer_name[0]:"?"),name:J.customer_name||"Unknown",email:J.customer_email||""},order_number_display:J.order_number_display,order_total:typeof J.order_total=="number"?J.order_total:0,created_by:J.created_by||"",created_by_name:J.created_by_name||"",created_by_email:J.created_by_email||"",category:J.category||"purchase"})).sort((J,te)=>{const se=new Date(J.date||0);return new Date(te.date||0).getTime()-se.getTime()});r(X)}}catch(f){console.error("Error fetching orders:",f),P("Failed to fetch orders","danger")}finally{i(!1)}},ve=async f=>{try{const{data:$,error:X}=await M.from("OrderItems").select("*, Products:product_uuid(ProductName)").eq("order_uuid",f);return X?(console.error("Error fetching order items:",X),[]):$?.map(J=>({...J,product_name:J.Products?.ProductName||J.product_uuid}))||[]}catch($){return console.error("Error fetching order items:",$),[]}};u.useEffect(()=>{le()},[]);const Ne=t.filter(f=>{const $=!l||f.order_number_display?.toString().toLowerCase().includes(l.toLowerCase())||f.customer.name.toLowerCase().includes(l.toLowerCase())||f.customer.email.toLowerCase().includes(l.toLowerCase()),X=!a||f.status===a,J=!d||f.category===d,te=!m||f.customer.name===m;return $&&X&&J&&te}),Je=Array.from(new Set(t.map(f=>f.status))),dt=Array.from(new Set(t.map(f=>f.category||"purchase"))),Be=Array.from(new Set(t.map(f=>f.customer.name))),Ee=f=>{const $=t.find(X=>X.uuid===f||X.order_number_display===f);$&&(_($),k(!0))},rt=()=>{S(!0)},nt=async(f,$)=>{U(!0);try{const{data:X,error:J}=await M.from("Orders").insert({date:R.date,status:R.status,customer_name:R.customer_name,customer_email:R.customer_email,order_total:f.reduce((te,se)=>te+se.quantity*se.unitprice*(1-se.discount/100),0)-$}).select().single();if(J){console.error("Error creating order:",J),P("Failed to create order","danger");return}if(f.length>0){const{error:te}=await M.from("OrderItems").insert(f.map(se=>({order_uuid:X.uuid,product_uuid:se.product_uuid,quantity:se.quantity,unitprice:se.unitprice,discount_percent:se.discount})));te&&(console.error("Error creating order items:",te),P("Order created but failed to add items","warning"))}P("Order created successfully","success"),S(!1),W({date:new Date().toISOString().split("T")[0],status:"Paid",customer_name:"",customer_email:""}),le()}catch(X){console.error("Error creating order:",X),P("Failed to create order","danger")}finally{U(!1)}},it=()=>{h(!1)},A=()=>{c(""),p(""),v("")},V=()=>e.jsxs(x,{sx:{pb:2},children:[e.jsxs(je,{variant:"page",padding:"medium",children:[e.jsxs(x,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(B,{placeholder:"Search orders...",value:l,onChange:f=>o(f.target.value),startDecorator:e.jsx(ge,{}),sx:{flex:1,fontSize:"16px"}}),e.jsx(re,{variant:"soft",onClick:()=>h(!0),sx:{flexShrink:0},children:e.jsx(Is,{})})]}),(a||d||m)&&e.jsxs(x,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:[a&&e.jsxs(Y,{size:"sm",variant:"soft",color:"primary",children:["Status: ",a]}),d&&e.jsxs(Y,{size:"sm",variant:"soft",color:"primary",children:["Category: ",d]}),m&&e.jsxs(Y,{size:"sm",variant:"soft",color:"primary",children:["Customer: ",m]})]}),n&&e.jsx(Ae,{sx:{mb:2}})]}),e.jsx(x,{children:Ne.length===0?e.jsx(x,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:n?"Loading orders...":"No orders found"})}):Ne.map(f=>e.jsx(x,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider",cursor:"pointer","&:hover":{bgcolor:"background.level1"}},onClick:()=>Ee(f.uuid),children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(x,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${F(f.status)}.100`,color:`${F(f.status)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",flexShrink:0},children:xe(f.status)}),e.jsxs(x,{sx:{flex:1,minWidth:0},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsxs(g,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:["Order #",f.order_number_display||f.uuid.substring(0,8)]}),e.jsx(Y,{size:"sm",color:F(f.status),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content"},children:f.status})]}),e.jsxs(g,{level:"body-xs",color:"neutral",sx:{mb:.5},children:[f.customer.name," • ",new Date(f.date).toLocaleDateString()]}),f.order_total&&e.jsx(g,{level:"body-xs",sx:{fontWeight:"bold",color:"primary.600"},children:Oe(f.order_total)})]})]})},f.uuid))}),e.jsx(re,{color:"primary",variant:"soft",size:"sm",sx:{position:"fixed",bottom:80,right:16,zIndex:1e3,borderRadius:"8px",width:40,height:40,boxShadow:"sm",bgcolor:"primary.100","&:hover":{bgcolor:"primary.200",boxShadow:"md"}},onClick:rt,children:e.jsx(ae,{fontSize:"small"})})]}),pe=()=>e.jsxs(je,{variant:"page",padding:"large",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:K.sizes.xlarge},children:"Orders"}),e.jsxs(x,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(B,{placeholder:"Search orders...",sx:{flex:1,fontSize:K.sizes.small},value:l,onChange:f=>o(f.target.value),startDecorator:e.jsx(ge,{})}),e.jsxs(ne,{placeholder:"Filter status",value:a,onChange:(f,$)=>c($||""),sx:{minWidth:160,fontSize:K.sizes.small},children:[e.jsx(z,{value:"",children:"All Statuses"}),Je.map(f=>e.jsx(z,{value:f,children:f},f))]}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(ae,{}),onClick:rt,sx:{fontSize:K.sizes.small},children:"Create Order"})]}),e.jsxs(ke,{children:[n&&e.jsx(Ae,{}),e.jsxs(Ue,{"aria-label":"Orders",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:be,children:"Order #"}),e.jsx("th",{style:be,children:"Date"}),e.jsx("th",{style:be,children:"Customer"}),e.jsx("th",{style:be,children:"Status"}),e.jsx("th",{style:be,children:"Total"}),e.jsx("th",{style:be,children:"Actions"})]})}),e.jsxs("tbody",{children:[Ne.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{textAlign:"center",color:"#888",...be},children:n?"Loading orders...":"No orders found."})}),Ne.map(f=>e.jsxs("tr",{style:{cursor:"pointer"},children:[e.jsx("td",{style:be,children:f.order_number_display||f.uuid.substring(0,8)}),e.jsx("td",{style:be,children:new Date(f.date).toLocaleDateString()}),e.jsx("td",{style:be,children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(x,{sx:{width:24,height:24,borderRadius:"50%",bgcolor:"primary.100",color:"primary.600",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold"},children:f.customer.initial}),e.jsxs(x,{children:[e.jsx(g,{level:"body-sm",sx:{fontWeight:"bold"},children:f.customer.name}),e.jsx(g,{level:"body-xs",color:"neutral",children:f.customer.email})]})]})}),e.jsx("td",{style:be,children:e.jsx(Y,{size:"sm",variant:"soft",color:F(f.status),children:f.status})}),e.jsx("td",{style:be,children:e.jsx(g,{level:"body-sm",sx:{fontWeight:"bold"},children:f.order_total?Oe(f.order_total):"N/A"})}),e.jsx("td",{style:be,children:e.jsx(q,{size:"sm",variant:"soft",onClick:()=>Ee(f.uuid),children:"View"})})]},f.uuid))]})]})]})]});return e.jsxs(Le,{children:[s?e.jsx(V,{}):e.jsx(pe,{}),e.jsx(ki,{open:b,creating:N,newOrder:R,setNewOrder:W,onClose:()=>S(!1),onCreate:nt}),e.jsx(Ci,{open:O,onClose:()=>k(!1),selectedOrder:j,fetchOrderItems:ve}),s&&e.jsx(Ut,{open:C,onClose:it,title:"Filter Orders",size:"medium",actions:e.jsxs(x,{sx:{display:"flex",gap:2},children:[e.jsx(q,{variant:"plain",onClick:A,sx:be,children:"Clear All"}),e.jsx(q,{variant:"solid",onClick:it,sx:be,children:"Apply"})]}),children:e.jsxs(ee,{spacing:2,children:[e.jsxs(ue,{children:[e.jsx(he,{children:"Status"}),e.jsxs(ne,{placeholder:"All statuses",value:a,onChange:(f,$)=>c($||""),children:[e.jsx(z,{value:"",children:"All Statuses"}),Je.map(f=>e.jsx(z,{value:f,children:f},f))]})]}),e.jsxs(ue,{children:[e.jsx(he,{children:"Category"}),e.jsxs(ne,{placeholder:"All categories",value:d,onChange:(f,$)=>p($||""),children:[e.jsx(z,{value:"",children:"All Categories"}),dt.map(f=>e.jsx(z,{value:f,children:f},f))]})]}),e.jsxs(ue,{children:[e.jsx(he,{children:"Customer"}),e.jsxs(ne,{placeholder:"All customers",value:m,onChange:(f,$)=>v($||""),children:[e.jsx(z,{value:"",children:"All Customers"}),Be.map(f=>e.jsx(z,{value:f,children:f},f))]})]})]})}),e.jsx(Kt,{open:D,onClose:()=>T(!1),autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{top:16,zIndex:2e3},children:e.jsx(Ps,{color:y,variant:"solid",sx:{width:"100%"},children:L})})]})};function _i({open:s,onClose:t,product:r,onSave:n}){const[i,l]=u.useState({ProductName:r?.ProductName||"",SalesPrice:r?.SalesPrice?.toString()||"",CostPrice:r?.CostPrice?.toString()||""}),[o,a]=u.useState(!1);u.useEffect(()=>{l({ProductName:r?.ProductName||"",SalesPrice:r?.SalesPrice?.toString()||"",CostPrice:r?.CostPrice?.toString()||""})},[r]);const c=async()=>{a(!0),await n(i),a(!1)};return e.jsx(_e,{open:s,onClose:t,"aria-labelledby":"product-table-form-title",children:e.jsxs(Pe,{children:[e.jsx(Gt,{id:"product-table-form-title",children:r?"Edit Product":"Add Product"}),e.jsxs(Zt,{children:[e.jsx(B,{name:"ProductName",value:i.ProductName,onChange:d=>l({...i,ProductName:d.target.value}),placeholder:"Product Name",sx:{mb:2}}),e.jsx(B,{name:"SalesPrice",value:i.SalesPrice,onChange:d=>l({...i,SalesPrice:d.target.value}),placeholder:"Sales Price",type:"number",sx:{mb:2}}),e.jsx(B,{name:"CostPrice",value:i.CostPrice,onChange:d=>l({...i,CostPrice:d.target.value}),placeholder:"Cost Price",type:"number"})]}),e.jsxs(Qt,{children:[e.jsx(q,{onClick:t,variant:"plain",disabled:o,children:"Cancel"}),e.jsx(q,{onClick:c,variant:"solid",loading:o,disabled:o,children:"Save"})]})]})})}const rr=Ns(_i),ce={fontSize:K.sizes.small},Pi=()=>{const{isMobile:s}=Se(),[t,r]=u.useState([]),[n,i]=u.useState({}),[l,o]=u.useState(!1),[a,c]=u.useState(!1),[d,p]=u.useState(!1),[m,v]=u.useState(""),[C,h]=u.useState(""),[b,S]=u.useState(!1),[O,k]=u.useState(!1),[j,_]=u.useState(!1),[N,U]=u.useState(null),[R,W]=u.useState(!1),[D,T]=u.useState(""),[L,I]=u.useState("success"),y=(A,V="success")=>{T(A),I(V),W(!0)},E=A=>A<=0?{status:"Out of Stock",color:"danger"}:A<=10?{status:"Low Stock",color:"warning"}:{status:"In Stock",color:"success"},P=A=>{const V=E(A);return e.jsx(x,{sx:{width:20,height:20,borderRadius:"50%",bgcolor:`${V.color}.100`,color:`${V.color}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold"},children:e.jsx(Qn,{sx:{fontSize:"12px"}})})},F=A=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(A),xe=async()=>{o(!0);try{const{data:A,error:V}=await M.from("Products").select("*").order("CreatedAt",{ascending:!1});if(V){console.error("Error fetching products:",V),y("Failed to fetch products","danger");return}A&&(r(A),await Oe(A))}catch(A){console.error("Error fetching products:",A),y("Failed to fetch products","danger")}finally{o(!1)}},Oe=async A=>{c(!0);try{const{data:V,error:pe}=await M.from("stock_movements").select("product_id, movement_type, quantity");if(pe){console.error("Error fetching stock data:",pe);return}if(V){const f={};A.forEach($=>{const J=V.filter(te=>te.product_id===$.uuid).reduce((te,se)=>{switch(se.movement_type){case"incoming":case"adjustment":return te+(se.quantity||0);case"outgoing":return te-(se.quantity||0);default:return te}},0);f[$.uuid]=J}),i(f)}}catch(V){console.error("Error fetching stock levels:",V)}finally{c(!1)}};u.useEffect(()=>{xe()},[]);const le=t.filter(A=>{const V=!m||A.ProductName.toLowerCase().includes(m.toLowerCase())||A.ProductID?.toLowerCase().includes(m.toLowerCase()),pe=n[A.uuid]||0,f=!C||C==="in-stock"&&pe>10||C==="low-stock"&&pe>0&&pe<=10||C==="out-of-stock"&&pe<=0;return V&&f}),ve=()=>{k(!0)},Ne=A=>{U(A),_(!0)},Je=async A=>{if(confirm("Are you sure you want to delete this product?")){p(!0);try{const{error:V}=await M.from("Products").delete().eq("uuid",A);if(V){console.error("Error deleting product:",V),y("Failed to delete product","danger");return}r(t.filter(pe=>pe.uuid!==A)),y("Product deleted successfully","success")}catch(V){console.error("Error deleting product:",V),y("Failed to delete product","danger")}finally{p(!1)}}},dt=async A=>{p(!0);try{const{data:V,error:pe}=await M.from("Products").insert([{ProductName:A.ProductName,SalesPrice:parseFloat(A.SalesPrice),CostPrice:parseFloat(A.CostPrice),CreatedAt:new Date().toISOString()}]).select().single();if(pe){console.error("Error adding product:",pe),y("Failed to add product","danger");return}y("Product added successfully","success"),k(!1),xe()}catch(V){console.error("Error adding product:",V),y("Failed to add product","danger")}finally{p(!1)}},Be=async A=>{if(N){p(!0);try{const{error:V}=await M.from("Products").update({ProductName:A.ProductName,SalesPrice:parseFloat(A.SalesPrice),CostPrice:parseFloat(A.CostPrice)}).eq("uuid",N.uuid);if(V){console.error("Error updating product:",V),y("Failed to update product","danger");return}y("Product updated successfully","success"),_(!1),U(null),xe()}catch(V){console.error("Error updating product:",V),y("Failed to update product","danger")}finally{p(!1)}}},Ee=()=>{S(!1)},rt=()=>{h("")},nt=()=>e.jsxs(x,{sx:{pb:2},children:[e.jsxs(je,{variant:"page",padding:"medium",children:[e.jsxs(x,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(B,{placeholder:"Search products...",value:m,onChange:A=>v(A.target.value),startDecorator:e.jsx(ge,{}),sx:{flex:1,fontSize:"16px"}}),e.jsx(re,{variant:"soft",onClick:()=>S(!0),sx:{flexShrink:0},children:e.jsx(Is,{})})]}),C&&e.jsx(x,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:e.jsxs(Y,{size:"sm",variant:"soft",color:"primary",children:["Stock: ",C.replace("-"," ")]})}),l&&e.jsx(Ae,{sx:{mb:2}})]}),e.jsx(x,{children:le.length===0?e.jsx(x,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:l?"Loading products...":"No products found"})}):le.map(A=>e.jsx(x,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(x,{sx:{flexShrink:0},children:A.ImageUrl?e.jsx(oe,{src:A.ImageUrl,sx:{width:48,height:48},alt:A.ProductName}):e.jsx(oe,{sx:{width:48,height:48,bgcolor:"neutral.100"},children:e.jsx(er,{})})}),e.jsxs(x,{sx:{flex:1,minWidth:0},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:A.ProductName}),e.jsx(x,{sx:{display:"flex",alignItems:"center",gap:1},children:a?e.jsx(g,{level:"body-xs",color:"neutral",children:"..."}):e.jsxs(e.Fragment,{children:[P(n[A.uuid]||0),e.jsx(Y,{size:"sm",color:E(n[A.uuid]||0).color,variant:"soft",sx:{fontSize:"10px",minWidth:"fit-content"},children:n[A.uuid]||0})]})})]}),e.jsxs(g,{level:"body-xs",color:"neutral",sx:{mb:.5},children:["ID: ",A.ProductID||"N/A"," • ",new Date(A.CreatedAt).toLocaleDateString()]}),e.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(x,{children:[e.jsxs(g,{level:"body-xs",sx:{fontWeight:"bold",color:"success.600"},children:["Sale: ",F(A.SalesPrice)]}),e.jsxs(g,{level:"body-xs",color:"neutral",children:["Cost: ",F(A.CostPrice)]})]}),e.jsxs(x,{sx:{display:"flex",gap:.5},children:[e.jsx(re,{size:"sm",variant:"soft",color:"primary",onClick:()=>Ne(A),children:e.jsx(qt,{})}),e.jsx(re,{size:"sm",variant:"soft",color:"danger",onClick:()=>Je(A.uuid),disabled:d,children:e.jsx(jt,{})})]})]})]})]})},A.uuid))}),e.jsx(re,{color:"primary",variant:"soft",size:"sm",sx:{position:"fixed",bottom:80,right:16,zIndex:1e3,borderRadius:"8px",width:40,height:40,boxShadow:"sm",bgcolor:"primary.100","&:hover":{bgcolor:"primary.200",boxShadow:"md"}},onClick:ve,children:e.jsx(ae,{fontSize:"small"})})]}),it=()=>e.jsxs(je,{variant:"page",padding:"large",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:K.sizes.xlarge},children:"Products"}),e.jsxs(x,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(B,{placeholder:"Search products...",sx:{flex:1,fontSize:K.sizes.small},value:m,onChange:A=>v(A.target.value),startDecorator:e.jsx(ge,{})}),e.jsxs(ne,{placeholder:"Filter by stock",value:C,onChange:(A,V)=>h(V||""),sx:{minWidth:160,fontSize:K.sizes.small},children:[e.jsx(z,{value:"",children:"All Stock Levels"}),e.jsx(z,{value:"in-stock",children:"In Stock"}),e.jsx(z,{value:"low-stock",children:"Low Stock"}),e.jsx(z,{value:"out-of-stock",children:"Out of Stock"})]}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(ae,{}),onClick:ve,sx:{fontSize:K.sizes.small},children:"Add Product"})]}),e.jsxs(ke,{children:[l&&e.jsx(Ae,{}),e.jsxs(Ue,{"aria-label":"Products",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:ce,children:"Image"}),e.jsx("th",{style:ce,children:"Name"}),e.jsx("th",{style:ce,children:"Stock"}),e.jsx("th",{style:ce,children:"Sales Price"}),e.jsx("th",{style:ce,children:"Cost Price"}),e.jsx("th",{style:ce,children:"Created"}),e.jsx("th",{style:ce,children:"Actions"})]})}),e.jsxs("tbody",{children:[le.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...ce},children:l?"Loading products...":"No products found."})}),le.map(A=>e.jsxs("tr",{children:[e.jsx("td",{style:ce,children:A.ImageUrl?e.jsx(oe,{src:A.ImageUrl,sx:{width:32,height:32},alt:A.ProductName}):e.jsx(oe,{sx:{width:32,height:32,bgcolor:"neutral.100"},children:e.jsx(er,{sx:{fontSize:"16px"}})})}),e.jsx("td",{style:ce,children:e.jsxs(x,{children:[e.jsx(g,{level:"body-sm",sx:{fontWeight:"bold"},children:A.ProductName}),e.jsxs(g,{level:"body-xs",color:"neutral",children:["ID: ",A.ProductID||"N/A"]})]})}),e.jsx("td",{style:ce,children:a?e.jsx(g,{level:"body-sm",sx:{color:"neutral.500"},children:"Loading..."}):e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Y,{size:"sm",variant:"soft",color:E(n[A.uuid]||0).color,children:E(n[A.uuid]||0).status}),e.jsx(mt,{title:`Current stock level: ${n[A.uuid]||0} units`,arrow:!0,children:e.jsx(g,{level:"body-sm",sx:{fontWeight:"bold",color:E(n[A.uuid]||0).color==="danger"?"danger.500":E(n[A.uuid]||0).color==="warning"?"warning.600":"success.600"},children:n[A.uuid]||0})}),e.jsx(x,{sx:{width:40,height:4,bgcolor:"neutral.200",borderRadius:2,overflow:"hidden"},children:e.jsx(x,{sx:{width:`${Math.min(100,Math.max(0,(n[A.uuid]||0)/50*100))}%`,height:"100%",bgcolor:E(n[A.uuid]||0).color==="danger"?"danger.400":E(n[A.uuid]||0).color==="warning"?"warning.400":"success.400",borderRadius:2}})})]})}),e.jsx("td",{style:ce,children:e.jsx(g,{level:"body-sm",sx:{fontWeight:"bold",color:"success.600"},children:F(A.SalesPrice)})}),e.jsx("td",{style:ce,children:e.jsx(g,{level:"body-sm",color:"neutral",children:F(A.CostPrice)})}),e.jsx("td",{style:ce,children:new Date(A.CreatedAt).toLocaleDateString()}),e.jsx("td",{style:ce,children:e.jsxs(x,{sx:{display:"flex",gap:.5},children:[e.jsx(re,{size:"sm",variant:"soft",color:"primary",onClick:()=>Ne(A),children:e.jsx(qt,{})}),e.jsx(re,{size:"sm",variant:"soft",color:"danger",onClick:()=>Je(A.uuid),disabled:d,children:e.jsx(jt,{})})]})})]},A.uuid))]})]})]})]});return e.jsxs(Le,{children:[s?e.jsx(nt,{}):e.jsx(it,{}),e.jsx(rr,{open:O,onClose:()=>k(!1),product:null,onSave:dt}),e.jsx(rr,{open:j,onClose:()=>{_(!1),U(null)},product:N,onSave:Be}),s&&e.jsx(Ut,{open:b,onClose:Ee,title:"Filter Products",size:"medium",actions:e.jsxs(x,{sx:{display:"flex",gap:2},children:[e.jsx(q,{variant:"plain",onClick:rt,sx:ce,children:"Clear All"}),e.jsx(q,{variant:"solid",onClick:Ee,sx:ce,children:"Apply"})]}),children:e.jsx(ee,{spacing:2,children:e.jsxs(ue,{children:[e.jsx(he,{children:"Stock Level"}),e.jsxs(ne,{placeholder:"All stock levels",value:C,onChange:(A,V)=>h(V||""),children:[e.jsx(z,{value:"",children:"All Stock Levels"}),e.jsx(z,{value:"in-stock",children:"In Stock"}),e.jsx(z,{value:"low-stock",children:"Low Stock"}),e.jsx(z,{value:"out-of-stock",children:"Out of Stock"})]})]})})}),e.jsx(Kt,{open:R,onClose:()=>W(!1),autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{top:16,zIndex:2e3},children:e.jsx(Ps,{color:L,variant:"solid",sx:{width:"100%"},children:D})})]})},We={fontSize:K.sizes.small},Ge={...We,fontWeight:600,borderBottom:"1.5px solid #e0e0e0",background:"inherit"},nr=s=>{switch(s?.toLowerCase()){case"admin":return"danger";case"manager":return"warning";case"user":return"primary";case"staff":return"success";default:return"neutral"}},ir=(s,t)=>{const r=s||t;let n=0;for(let l=0;l<r.length;l++)n=r.charCodeAt(l)+((n<<5)-n);const i=["primary","success","warning","danger","neutral"];return i[Math.abs(n)%i.length]},lr=(s,t)=>{if(s){const r=s.split(" ");return r.length>=2?(r[0][0]+r[1][0]).toUpperCase():s.substring(0,2).toUpperCase()}return t.substring(0,2).toUpperCase()};function Ei(){return e.jsxs(Dr,{children:[e.jsx(Tr,{slots:{root:re},slotProps:{root:{variant:"plain",color:"neutral",size:"sm"}},children:e.jsx(Yn,{})}),e.jsxs(zr,{size:"sm",sx:{minWidth:140},children:[e.jsx(lt,{children:"Edit"}),e.jsx(lt,{children:"Reset Password"}),e.jsx(lt,{children:"Disable"}),e.jsx(lt,{color:"danger",children:"Delete"})]})]})}const Ai=()=>{const{isMobile:s}=Se(),[t,r]=u.useState([]),[n,i]=u.useState(!1),[l,o]=u.useState(null),[a,c]=u.useState(""),[d,p]=u.useState("all"),[m,v]=u.useState(!1),C=async()=>{i(!0),o(null);try{const{data:j,error:_}=await M.from("users").select("*");if(_)throw _;if(j){const N=j.map(U=>({id:U.id,name:U.name||null,email:U.email,role:U.role||null,created_at:U.created_at||null,last_login:U.last_login||null,phone:U.phone||null}));r(N)}}catch(j){console.error("Error fetching users:",j),o(j.message||"Failed to fetch users")}finally{i(!1)}},h=Array.from(new Set(t.map(j=>j.role).filter(Boolean))),S=[...t.filter(j=>{const _=j.name?.toLowerCase().includes(a.toLowerCase())||j.email.toLowerCase().includes(a.toLowerCase()),N=d==="all"||j.role===d;return _&&N})].sort((j,_)=>{const N=j.name||j.email,U=_.name||_.email;return N.localeCompare(U)});u.useEffect(()=>{C()},[]);const O=()=>e.jsxs(x,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(je,{padding:"medium",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:K.sizes.xlarge},children:"Users"}),e.jsxs(x,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(B,{placeholder:"Search users...",value:a,onChange:j=>c(j.target.value),startDecorator:e.jsx(ge,{}),sx:{flex:1}}),e.jsxs(ne,{placeholder:"Role",value:d,onChange:(j,_)=>p(_??"all"),sx:{minWidth:120},children:[e.jsx(z,{value:"all",children:"All"}),h.map(j=>e.jsx(z,{value:j,children:j},j))]})]}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(ae,{}),onClick:()=>v(!0),sx:{width:"100%",mb:2},children:"Create User"})]}),n&&e.jsx(Ae,{}),l&&e.jsx(x,{sx:{p:2},children:e.jsxs(g,{color:"danger",children:["Error: ",l]})}),e.jsx(x,{children:S.length===0?e.jsx(x,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:"No users found"})}):S.map(j=>e.jsx(x,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(oe,{size:"md",color:ir(j.name,j.email),sx:{flexShrink:0},children:lr(j.name,j.email)}),e.jsxs(x,{sx:{flex:1,minWidth:0},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:j.name||"Unnamed User"}),j.role&&e.jsx(Y,{size:"sm",color:nr(j.role),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content",textTransform:"capitalize"},children:j.role})]}),e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(qr,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsx(g,{level:"body-xs",color:"neutral",children:j.email})]}),e.jsxs(x,{sx:{display:"flex",gap:2,mb:.5},children:[j.phone&&e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx($r,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsx(g,{level:"body-xs",color:"neutral",children:j.phone})]}),j.last_login&&e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Kn,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsx(g,{level:"body-xs",color:"neutral",children:new Date(j.last_login).toLocaleDateString()})]})]}),j.created_at&&e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Xn,{sx:{fontSize:14,color:"text.tertiary"}}),e.jsxs(g,{level:"body-xs",color:"neutral",children:["Joined ",new Date(j.created_at).toLocaleDateString()]})]})]})]})},j.id))})]}),k=()=>e.jsxs(je,{children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:K.sizes.xlarge},children:"Users"}),e.jsxs(x,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(B,{placeholder:"Search users...",sx:{flex:1},value:a,onChange:j=>c(j.target.value),startDecorator:e.jsx(ge,{})}),e.jsxs(ne,{placeholder:"Filter role",value:d,onChange:(j,_)=>p(_??"all"),sx:{minWidth:160},children:[e.jsx(z,{value:"all",children:"All Roles"}),h.map(j=>e.jsx(z,{value:j,children:j},j))]}),e.jsx(q,{onClick:()=>v(!0),variant:"solid",startDecorator:e.jsx(ae,{}),children:"Create User"})]}),e.jsxs(ke,{children:[n&&e.jsx(Ae,{}),l&&e.jsxs(g,{color:"danger",children:["Error: ",l]}),e.jsxs(Ue,{"aria-label":"Users",sx:{minWidth:800},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:Ge,children:"Name"}),e.jsx("th",{style:Ge,children:"Email"}),e.jsx("th",{style:Ge,children:"Role"}),e.jsx("th",{style:Ge,children:"Created At"}),e.jsx("th",{style:Ge,children:"Last Login"}),e.jsx("th",{style:Ge,children:"Phone"}),e.jsx("th",{style:{width:120,...Ge},children:"Actions"})]})}),e.jsxs("tbody",{children:[S.length===0&&!n&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...We},children:"No users found."})}),S.map(j=>e.jsxs("tr",{style:{cursor:"pointer",height:48},children:[e.jsx("td",{style:We,children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(oe,{size:"sm",color:ir(j.name,j.email),children:lr(j.name,j.email)}),e.jsx(g,{level:"body-sm",fontWeight:"md",children:j.name||"Unnamed User"})]})}),e.jsx("td",{style:We,children:j.email}),e.jsx("td",{style:We,children:j.role?e.jsx(Y,{size:"sm",color:nr(j.role),variant:"soft",sx:{textTransform:"capitalize"},children:j.role}):"-"}),e.jsx("td",{style:We,children:j.created_at?new Date(j.created_at).toLocaleDateString():"-"}),e.jsx("td",{style:We,children:j.last_login?new Date(j.last_login).toLocaleDateString():"-"}),e.jsx("td",{style:We,children:j.phone||"-"}),e.jsx("td",{children:e.jsx(Ei,{})})]},j.id))]})]})]})]});return e.jsxs(Le,{children:[s?e.jsx(O,{}):e.jsx(k,{}),e.jsx(_e,{open:m,onClose:()=>v(!1),"aria-labelledby":"create-user-modal",children:e.jsxs(Pe,{"aria-labelledby":"create-user-modal",sx:{maxWidth:600,width:"100%"},children:[e.jsx(Ve,{}),e.jsx(g,{id:"create-user-modal",level:"title-md",fontWeight:"lg",sx:{mb:2},children:"Create User"}),e.jsx(g,{level:"body-sm",sx:{mb:2},children:"User creation functionality will be implemented here."}),e.jsx(q,{onClick:()=>v(!1),variant:"outlined",children:"Close"})]})})]})};function Hr({open:s,onClose:t,onSaved:r,mode:n="add",supplier:i}){const[l,o]=u.useState(i?.name||""),[a,c]=u.useState(i?.contact_name||""),[d,p]=u.useState(i?.email||""),[m,v]=u.useState(i?.phone||""),[C,h]=u.useState(i?.address||""),[b,S]=u.useState(!1),[O,k]=u.useState(null);u.useEffect(()=>{s&&n==="edit"&&i?(o(i.name||""),c(i.contact_name||""),p(i.email||""),v(i.phone||""),h(i.address||"")):s&&n==="add"&&(o(""),c(""),p(""),v(""),h(""))},[s,n,i]);const j=async()=>{S(!0),k(null);const _={name:l,contact_name:a,email:d,phone:m,address:C};let N;if(n==="add"){N=await M.from("Suppliers").insert([_]).select(),S(!1),N.error?k(N.error.message):r(N.data?.[0]?.id);return}else N=await M.from("Suppliers").update(_).eq("id",i?.id);S(!1),N.error?k(N.error.message):r()};return e.jsx(_e,{open:s,onClose:t,children:e.jsxs(Pe,{sx:{minWidth:400},children:[e.jsx(Ve,{}),e.jsxs(g,{level:"title-md",sx:{mb:2},children:[n==="edit"?"Edit":"Add"," Supplier"]}),e.jsxs("form",{onSubmit:_=>{_.preventDefault(),_.stopPropagation(),j()},children:[e.jsx(B,{placeholder:"Name",value:l,onChange:_=>o(_.target.value),sx:{mb:2},required:!0}),e.jsx(B,{placeholder:"Contact Name",value:a,onChange:_=>c(_.target.value),sx:{mb:2}}),e.jsx(B,{placeholder:"Email",value:d,onChange:_=>p(_.target.value),sx:{mb:2},type:"email",required:!0}),e.jsx(B,{placeholder:"Phone",value:m,onChange:_=>v(_.target.value),sx:{mb:2},type:"tel"}),e.jsx(B,{placeholder:"Address",value:C,onChange:_=>h(_.target.value),sx:{mb:2}}),O&&e.jsx(g,{color:"danger",sx:{mb:1},children:O}),e.jsx(q,{type:"submit",loading:b,disabled:b,variant:"solid",children:"Save"})]})]})})}const or=s=>{let t=0;for(let n=0;n<s.length;n++)t=s.charCodeAt(n)+((t<<5)-t);const r=["primary","success","warning","danger","neutral"];return r[Math.abs(t)%r.length]},ar=s=>{const t=s.split(" ");return t.length>=2?(t[0][0]+t[1][0]).toUpperCase():s.substring(0,2).toUpperCase()};function Oi({supplier:s,onEdit:t,onDelete:r}){return e.jsxs(Dr,{children:[e.jsx(Tr,{slots:{root:re},slotProps:{root:{variant:"plain",color:"neutral",size:"sm"}},children:e.jsx(si,{})}),e.jsxs(zr,{size:"sm",sx:{minWidth:120},children:[e.jsxs(lt,{onClick:()=>t(s),children:[e.jsx(qt,{sx:{mr:1},fontSize:"small"}),"Edit"]}),e.jsxs(lt,{color:"danger",onClick:()=>r(s.id),children:[e.jsx(jt,{sx:{mr:1},fontSize:"small"}),"Delete"]})]})]})}const Ii=()=>{const{isMobile:s}=Se(),[t,r]=u.useState([]),[n,i]=u.useState(!1),[l,o]=u.useState(null),[a,c]=u.useState(""),[d,p]=u.useState(!1),[m,v]=u.useState(null),[C,h]=u.useState("view"),b=async()=>{i(!0),o(null);try{const{data:R,error:W}=await M.from("Suppliers").select("*");if(W)throw W;R&&r(R)}catch(R){console.error("Error fetching suppliers:",R),o(R.message||"Failed to fetch suppliers")}finally{i(!1)}},S=R=>{v(R),h("edit"),p(!0)},O=async R=>{if(confirm("Are you sure you want to delete this supplier?"))try{const{error:W}=await M.from("Suppliers").delete().eq("id",R);if(W)throw W;await b()}catch(W){console.error("Error deleting supplier:",W),o(W.message||"Failed to delete supplier")}},k=async()=>{p(!1),await b()},_=[...t.filter(R=>R.name?.toLowerCase().includes(a.toLowerCase())||R.contact_name?.toLowerCase().includes(a.toLowerCase())||R.email?.toLowerCase().includes(a.toLowerCase())||R.phone?.toLowerCase().includes(a.toLowerCase())||R.address?.toLowerCase().includes(a.toLowerCase()))].sort((R,W)=>R.name.localeCompare(W.name));u.useEffect(()=>{b()},[]);const N=()=>e.jsxs(x,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(je,{padding:"medium",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:K.sizes.xlarge},children:"Suppliers"}),e.jsx(x,{sx:{display:"flex",gap:1,mb:2},children:e.jsx(B,{placeholder:"Search suppliers...",value:a,onChange:R=>c(R.target.value),startDecorator:e.jsx(ge,{}),sx:{flex:1}})}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(ae,{}),onClick:()=>{v(null),h("add"),p(!0)},sx:{width:"100%",mb:2},children:"Add Supplier"})]}),n&&e.jsx(Ae,{}),l&&e.jsx(x,{sx:{p:2},children:e.jsxs(g,{color:"danger",children:["Error: ",l]})}),e.jsx(x,{sx:{px:2},children:_.length===0?e.jsx(x,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:"No suppliers found"})}):_.map(R=>e.jsx(ke,{variant:"outlined",sx:{mb:2,"&:hover":{boxShadow:"sm"}},children:e.jsx(Lt,{sx:{p:2},children:e.jsxs(x,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(oe,{size:"md",color:or(R.name),sx:{flexShrink:0},children:R.image_url?e.jsx("img",{src:R.image_url,alt:R.name}):ar(R.name)}),e.jsxs(x,{sx:{flex:1,minWidth:0},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",mb:1},children:[e.jsx(g,{level:"title-md",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"calc(100% - 40px)"},children:R.name}),e.jsx(Oi,{supplier:R,onEdit:S,onDelete:O})]}),e.jsxs(ee,{spacing:.5,children:[R.contact_name&&e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ei,{sx:{fontSize:16,color:"text.tertiary"}}),e.jsx(g,{level:"body-sm",color:"neutral",children:R.contact_name})]}),R.email&&e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(qr,{sx:{fontSize:16,color:"text.tertiary"}}),e.jsx(g,{level:"body-sm",color:"neutral",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:R.email})]}),R.phone&&e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx($r,{sx:{fontSize:16,color:"text.tertiary"}}),e.jsx(g,{level:"body-sm",color:"neutral",children:R.phone})]}),R.address&&e.jsxs(x,{sx:{display:"flex",alignItems:"flex-start",gap:1,mt:.5},children:[e.jsx(ti,{sx:{fontSize:16,color:"text.tertiary",mt:.25}}),e.jsx(g,{level:"body-sm",color:"neutral",sx:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.2},children:R.address})]})]})]})]})})},R.id))})]}),U=()=>e.jsxs(je,{children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:K.sizes.xlarge},children:"Suppliers"}),e.jsxs(x,{sx:{display:"flex",gap:2,mb:3,alignItems:"center"},children:[e.jsx(B,{placeholder:"Search suppliers...",value:a,onChange:R=>c(R.target.value),startDecorator:e.jsx(ge,{}),sx:{flex:1}}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(ae,{}),onClick:()=>{v(null),h("add"),p(!0)},sx:{minWidth:140},children:"Add Supplier"})]}),n&&e.jsx(Ae,{sx:{mb:2}}),l&&e.jsxs(g,{color:"danger",sx:{mb:2},children:["Error: ",l]}),e.jsx(Ke,{container:!0,spacing:2,children:_.length===0?e.jsx(Ke,{xs:12,children:e.jsx(x,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:"No suppliers found"})})}):_.map(R=>e.jsx(Ke,{xs:12,md:6,lg:4,children:e.jsx(ke,{variant:"outlined",sx:{height:"100%"},children:e.jsxs(Lt,{children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(oe,{size:"sm",color:or(R.name),children:R.image_url?e.jsx("img",{src:R.image_url,alt:R.name}):ar(R.name)}),e.jsx(g,{level:"title-md",fontWeight:"bold",children:R.name})]}),e.jsxs(ee,{spacing:1,children:[e.jsxs(g,{level:"body-sm",children:[e.jsx("strong",{children:"Contact:"})," ",R.contact_name||"N/A"]}),e.jsxs(g,{level:"body-sm",children:[e.jsx("strong",{children:"Email:"})," ",R.email||"N/A"]}),e.jsxs(g,{level:"body-sm",children:[e.jsx("strong",{children:"Phone:"})," ",R.phone||"N/A"]}),e.jsxs(g,{level:"body-sm",children:[e.jsx("strong",{children:"Address:"})," ",R.address||"N/A"]})]}),e.jsxs(x,{sx:{display:"flex",gap:1,mt:2},children:[e.jsx(q,{size:"sm",variant:"outlined",startDecorator:e.jsx(qt,{}),onClick:()=>S(R),children:"Edit"}),e.jsx(q,{size:"sm",variant:"outlined",color:"danger",startDecorator:e.jsx(jt,{}),onClick:()=>O(R.id),children:"Delete"})]})]})})},R.id))})]});return e.jsxs(Le,{children:[s?e.jsx(N,{}):e.jsx(U,{}),e.jsx(Hr,{open:d,onClose:()=>p(!1),supplier:m,onSaved:k,mode:C==="edit"||C==="add"?C:void 0})]})};function Di({orderId:s,editable:t,onItemsChange:r,initialItems:n=[]}){const[i,l]=u.useState(n),[o,a]=u.useState([]),[c,d]=u.useState(!1);u.useEffect(()=>{d(!0),M.from("Products").select("uuid, ProductName").then(({data:C,error:h})=>{h?console.error("Failed to fetch products:",h.message):a(C||[]),d(!1)})},[]);const p=(C,h,b)=>{l(S=>{const O=S.map((k,j)=>j===C?{...k,[h]:b}:k);return r&&r(O),O})},m=()=>{l(C=>{const h=[...C,{product_id:null,quantity_ordered:1,unit_price:0}];return r&&r(h),h})},v=C=>{l(h=>{const b=h.filter((S,O)=>O!==C);return r&&r(b),b})};return e.jsxs(x,{sx:{mt:2},children:[e.jsxs(Ue,{size:"sm",sx:{minWidth:500},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Quantity"}),e.jsx("th",{children:"Unit Price"}),e.jsx("th",{children:"Total"}),t&&e.jsx("th",{})]})}),e.jsx("tbody",{children:i.map((C,h)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(_s,{options:o,getOptionLabel:b=>b.ProductName,value:o.find(b=>b.uuid===C.product_id)||null,onChange:(b,S)=>p(h,"product_id",S?S.uuid:null),disabled:!t,sx:{minWidth:180},isOptionEqualToValue:(b,S)=>b.uuid===S.uuid,required:!0})}),e.jsx("td",{children:e.jsx(B,{type:"number",value:C.quantity_ordered??1,onChange:b=>p(h,"quantity_ordered",Math.max(1,Number(b.target.value))),disabled:!t,sx:{width:80},required:!0})}),e.jsx("td",{children:e.jsx(B,{type:"number",value:C.unit_price??0,onChange:b=>p(h,"unit_price",Math.max(0,Number(b.target.value))),disabled:!t,sx:{width:100},required:!0})}),e.jsx("td",{children:(C.quantity_ordered*C.unit_price).toFixed(2)}),t&&e.jsx("td",{children:e.jsx(q,{size:"sm",color:"danger",onClick:()=>v(h),children:"Remove"})})]},h))})]}),t&&e.jsx(q,{size:"sm",variant:"soft",onClick:m,sx:{mt:1},children:"Add Item"})]})}const Ct=["Pending","Approved","Received","Cancelled"];function Ti({open:s,onClose:t,onCreated:r,mode:n="add",order:i}){const[l,o]=u.useState(i?.order_number||""),[a,c]=u.useState(i?.order_date||new Date().toISOString().slice(0,10)),[d,p]=u.useState(i?.status||"Pending"),[m,v]=u.useState(i?.total?String(i.total):""),[C,h]=u.useState(i?.notes||""),[b,S]=u.useState(i?.supplier_id||null),[O,k]=u.useState(!1),[j,_]=u.useState(null),[N,U]=u.useState([]),[R,W]=u.useState(""),[D,T]=u.useState(!1),[L,I]=u.useState([{product_id:null,quantity_ordered:1,unit_price:0}]);u.useRef(null),u.useEffect(()=>{s?(console.log("[PurchaseOrderForm] Modal opened"),M.from("Suppliers").select("id, name").then(({data:P})=>{U(P||[])}),n==="edit"&&i?.id?M.from("purchaseorderitems").select("*").eq("purchase_order_id",i.id).then(({data:P})=>{I(P||[])}):n==="add"&&I([{product_id:null,quantity_ordered:1,unit_price:0}])):console.log("[PurchaseOrderForm] Modal closed")},[s,n,i]);const y=async P=>{console.log("[PurchaseOrderForm] handleSupplierAdded called");const{data:F}=await M.from("Suppliers").select("id, name");U(F||[]),P&&(S(String(P)),console.log("[PurchaseOrderForm] New supplier set:",P)),T(!1),console.log("[PurchaseOrderForm] SupplierForm closed")},E=async()=>{console.log("[PurchaseOrderForm] handleSave called"),k(!0),_(null);const P={order_date:a,status:d,notes:C,supplier_id:b};n==="edit"&&(P.order_number=l),P.total=m?parseFloat(m):null;let F,xe=i?.id;if(n==="add"?(F=await M.from("PurchaseOrders").insert([P]).select(),!F.error&&F.data&&F.data[0]&&(xe=F.data[0].id)):i&&(F=await M.from("PurchaseOrders").update(P).eq("id",i.id)),F&&!F.error&&n==="add"&&xe&&L.length>0){const Oe=L.filter(ve=>ve.product_id).map(ve=>({purchase_order_id:xe,product_id:ve.product_id,quantity_ordered:ve.quantity_ordered,unit_price:ve.unit_price,notes:ve.notes||null}));if(Oe.length===0){_("Please select a product for each item before saving."),k(!1);return}const le=await M.from("purchaseorderitems").insert(Oe);if(le.error){_("Failed to save items: "+le.error.message),k(!1);return}}k(!1),F?.error?(_(F.error.message),console.log("[PurchaseOrderForm] Save error:",F.error.message)):(r(),t(),o(""),c(new Date().toISOString().slice(0,10)),p("Pending"),v(""),h(""),S(null),W(""),console.log("[PurchaseOrderForm] Purchase order saved and modal closed"))};return e.jsx(_e,{open:s,onClose:t,"aria-labelledby":"purchase-order-form-title",children:e.jsxs(Pe,{sx:{minWidth:400},children:[e.jsx(Ve,{}),e.jsxs(g,{id:"purchase-order-form-title",level:"title-md",sx:{mb:2},children:[n==="edit"?"Edit":"Add"," Purchase Order"]}),e.jsxs("form",{onSubmit:P=>{P.preventDefault(),E()},children:[e.jsx(B,{type:"date",value:a,onChange:P=>c(P.target.value),sx:{mb:2},required:!0}),e.jsx(ne,{value:d,onChange:(P,F)=>p(F??"Pending"),sx:{mb:2,display:"none"},required:!0,children:Ct.map(P=>e.jsx(z,{value:P,children:P},P))}),n==="edit"&&e.jsx(x,{sx:{mb:2},children:e.jsx(Y,{variant:"soft",color:d==="Approved"?"success":d==="Received"?"primary":d==="Cancelled"?"danger":"neutral",sx:{textTransform:"capitalize",fontWeight:600,fontSize:"md",px:1.5,py:.5},onClick:()=>{const P=Ct.indexOf(d);p(Ct[(P+1)%Ct.length])},children:d})}),e.jsxs(x,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(_s,{options:N,getOptionLabel:P=>P.name,value:N.find(P=>P.id===b)||null,onChange:(P,F)=>S(F?F.id:null),inputValue:R,onInputChange:(P,F)=>W(F),placeholder:"Select supplier",sx:{flex:1,mb:0},isOptionEqualToValue:(P,F)=>P.id===F.id,required:!0}),e.jsx(re,{color:"primary",sx:{ml:1},onClick:()=>T(!0),children:e.jsx(ae,{})})]}),e.jsx(Hr,{open:D,onClose:()=>T(!1),onSaved:y,mode:"add"}),n==="edit"&&e.jsxs(e.Fragment,{children:[e.jsx(B,{placeholder:"Order Number",value:l,onChange:P=>o(P.target.value),sx:{mb:2}}),e.jsx(B,{placeholder:"Total",value:m,onChange:P=>v(P.target.value),sx:{mb:2},type:"number",readOnly:!0})]}),e.jsx(B,{placeholder:"Notes",value:C,onChange:P=>h(P.target.value),sx:{mb:2}}),e.jsx(Di,{orderId:i?.id,editable:n==="add",onItemsChange:I,initialItems:L}),e.jsx(x,{sx:{height:16}}),j&&e.jsx(g,{color:"danger",sx:{mb:1},children:j}),e.jsx(q,{type:"submit",loading:O,disabled:O,variant:"solid",children:"Save"})]})]})})}function Vr(s,t){return function(){return s.apply(t,arguments)}}const{toString:zi}=Object.prototype,{getPrototypeOf:Ms}=Object,{iterator:Xt,toStringTag:Jr}=Symbol,Yt=(s=>t=>{const r=zi.call(t);return s[r]||(s[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),Ie=s=>(s=s.toLowerCase(),t=>Yt(t)===s),es=s=>t=>typeof t===s,{isArray:at}=Array,bt=es("undefined");function Li(s){return s!==null&&!bt(s)&&s.constructor!==null&&!bt(s.constructor)&&Ce(s.constructor.isBuffer)&&s.constructor.isBuffer(s)}const Gr=Ie("ArrayBuffer");function Ni(s){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(s):t=s&&s.buffer&&Gr(s.buffer),t}const Mi=es("string"),Ce=es("function"),Zr=es("number"),ts=s=>s!==null&&typeof s=="object",Fi=s=>s===!0||s===!1,It=s=>{if(Yt(s)!=="object")return!1;const t=Ms(s);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Jr in s)&&!(Xt in s)},qi=Ie("Date"),$i=Ie("File"),Ui=Ie("Blob"),Bi=Ie("FileList"),Wi=s=>ts(s)&&Ce(s.pipe),Hi=s=>{let t;return s&&(typeof FormData=="function"&&s instanceof FormData||Ce(s.append)&&((t=Yt(s))==="formdata"||t==="object"&&Ce(s.toString)&&s.toString()==="[object FormData]"))},Vi=Ie("URLSearchParams"),[Ji,Gi,Zi,Qi]=["ReadableStream","Request","Response","Headers"].map(Ie),Ki=s=>s.trim?s.trim():s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function yt(s,t,{allOwnKeys:r=!1}={}){if(s===null||typeof s>"u")return;let n,i;if(typeof s!="object"&&(s=[s]),at(s))for(n=0,i=s.length;n<i;n++)t.call(null,s[n],n,s);else{const l=r?Object.getOwnPropertyNames(s):Object.keys(s),o=l.length;let a;for(n=0;n<o;n++)a=l[n],t.call(null,s[a],a,s)}}function Qr(s,t){t=t.toLowerCase();const r=Object.keys(s);let n=r.length,i;for(;n-- >0;)if(i=r[n],t===i.toLowerCase())return i;return null}const Xe=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Kr=s=>!bt(s)&&s!==Xe;function js(){const{caseless:s}=Kr(this)&&this||{},t={},r=(n,i)=>{const l=s&&Qr(t,i)||i;It(t[l])&&It(n)?t[l]=js(t[l],n):It(n)?t[l]=js({},n):at(n)?t[l]=n.slice():t[l]=n};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&yt(arguments[n],r);return t}const Xi=(s,t,r,{allOwnKeys:n}={})=>(yt(t,(i,l)=>{r&&Ce(i)?s[l]=Vr(i,r):s[l]=i},{allOwnKeys:n}),s),Yi=s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),el=(s,t,r,n)=>{s.prototype=Object.create(t.prototype,n),s.prototype.constructor=s,Object.defineProperty(s,"super",{value:t.prototype}),r&&Object.assign(s.prototype,r)},tl=(s,t,r,n)=>{let i,l,o;const a={};if(t=t||{},s==null)return t;do{for(i=Object.getOwnPropertyNames(s),l=i.length;l-- >0;)o=i[l],(!n||n(o,s,t))&&!a[o]&&(t[o]=s[o],a[o]=!0);s=r!==!1&&Ms(s)}while(s&&(!r||r(s,t))&&s!==Object.prototype);return t},sl=(s,t,r)=>{s=String(s),(r===void 0||r>s.length)&&(r=s.length),r-=t.length;const n=s.indexOf(t,r);return n!==-1&&n===r},rl=s=>{if(!s)return null;if(at(s))return s;let t=s.length;if(!Zr(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=s[t];return r},nl=(s=>t=>s&&t instanceof s)(typeof Uint8Array<"u"&&Ms(Uint8Array)),il=(s,t)=>{const n=(s&&s[Xt]).call(s);let i;for(;(i=n.next())&&!i.done;){const l=i.value;t.call(s,l[0],l[1])}},ll=(s,t)=>{let r;const n=[];for(;(r=s.exec(t))!==null;)n.push(r);return n},ol=Ie("HTMLFormElement"),al=s=>s.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,n,i){return n.toUpperCase()+i}),cr=(({hasOwnProperty:s})=>(t,r)=>s.call(t,r))(Object.prototype),cl=Ie("RegExp"),Xr=(s,t)=>{const r=Object.getOwnPropertyDescriptors(s),n={};yt(r,(i,l)=>{let o;(o=t(i,l,s))!==!1&&(n[l]=o||i)}),Object.defineProperties(s,n)},dl=s=>{Xr(s,(t,r)=>{if(Ce(s)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const n=s[r];if(Ce(n)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},ul=(s,t)=>{const r={},n=i=>{i.forEach(l=>{r[l]=!0})};return at(s)?n(s):n(String(s).split(t)),r},hl=()=>{},xl=(s,t)=>s!=null&&Number.isFinite(s=+s)?s:t;function pl(s){return!!(s&&Ce(s.append)&&s[Jr]==="FormData"&&s[Xt])}const fl=s=>{const t=new Array(10),r=(n,i)=>{if(ts(n)){if(t.indexOf(n)>=0)return;if(!("toJSON"in n)){t[i]=n;const l=at(n)?[]:{};return yt(n,(o,a)=>{const c=r(o,i+1);!bt(c)&&(l[a]=c)}),t[i]=void 0,l}}return n};return r(s,0)},ml=Ie("AsyncFunction"),gl=s=>s&&(ts(s)||Ce(s))&&Ce(s.then)&&Ce(s.catch),Yr=((s,t)=>s?setImmediate:t?((r,n)=>(Xe.addEventListener("message",({source:i,data:l})=>{i===Xe&&l===r&&n.length&&n.shift()()},!1),i=>{n.push(i),Xe.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",Ce(Xe.postMessage)),jl=typeof queueMicrotask<"u"?queueMicrotask.bind(Xe):typeof process<"u"&&process.nextTick||Yr,bl=s=>s!=null&&Ce(s[Xt]),w={isArray:at,isArrayBuffer:Gr,isBuffer:Li,isFormData:Hi,isArrayBufferView:Ni,isString:Mi,isNumber:Zr,isBoolean:Fi,isObject:ts,isPlainObject:It,isReadableStream:Ji,isRequest:Gi,isResponse:Zi,isHeaders:Qi,isUndefined:bt,isDate:qi,isFile:$i,isBlob:Ui,isRegExp:cl,isFunction:Ce,isStream:Wi,isURLSearchParams:Vi,isTypedArray:nl,isFileList:Bi,forEach:yt,merge:js,extend:Xi,trim:Ki,stripBOM:Yi,inherits:el,toFlatObject:tl,kindOf:Yt,kindOfTest:Ie,endsWith:sl,toArray:rl,forEachEntry:il,matchAll:ll,isHTMLForm:ol,hasOwnProperty:cr,hasOwnProp:cr,reduceDescriptors:Xr,freezeMethods:dl,toObjectSet:ul,toCamelCase:al,noop:hl,toFiniteNumber:xl,findKey:Qr,global:Xe,isContextDefined:Kr,isSpecCompliantForm:pl,toJSONObject:fl,isAsyncFn:ml,isThenable:gl,setImmediate:Yr,asap:jl,isIterable:bl};function H(s,t,r,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=s,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}w.inherits(H,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:w.toJSONObject(this.config),code:this.code,status:this.status}}});const en=H.prototype,tn={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(s=>{tn[s]={value:s}});Object.defineProperties(H,tn);Object.defineProperty(en,"isAxiosError",{value:!0});H.from=(s,t,r,n,i,l)=>{const o=Object.create(en);return w.toFlatObject(s,o,function(c){return c!==Error.prototype},a=>a!=="isAxiosError"),H.call(o,s.message,t,r,n,i),o.cause=s,o.name=s.name,l&&Object.assign(o,l),o};const yl=null;function bs(s){return w.isPlainObject(s)||w.isArray(s)}function sn(s){return w.endsWith(s,"[]")?s.slice(0,-2):s}function dr(s,t,r){return s?s.concat(t).map(function(i,l){return i=sn(i),!r&&l?"["+i+"]":i}).join(r?".":""):t}function wl(s){return w.isArray(s)&&!s.some(bs)}const Sl=w.toFlatObject(w,{},null,function(t){return/^is[A-Z]/.test(t)});function ss(s,t,r){if(!w.isObject(s))throw new TypeError("target must be an object");t=t||new FormData,r=w.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(b,S){return!w.isUndefined(S[b])});const n=r.metaTokens,i=r.visitor||p,l=r.dots,o=r.indexes,c=(r.Blob||typeof Blob<"u"&&Blob)&&w.isSpecCompliantForm(t);if(!w.isFunction(i))throw new TypeError("visitor must be a function");function d(h){if(h===null)return"";if(w.isDate(h))return h.toISOString();if(w.isBoolean(h))return h.toString();if(!c&&w.isBlob(h))throw new H("Blob is not supported. Use a Buffer instead.");return w.isArrayBuffer(h)||w.isTypedArray(h)?c&&typeof Blob=="function"?new Blob([h]):Buffer.from(h):h}function p(h,b,S){let O=h;if(h&&!S&&typeof h=="object"){if(w.endsWith(b,"{}"))b=n?b:b.slice(0,-2),h=JSON.stringify(h);else if(w.isArray(h)&&wl(h)||(w.isFileList(h)||w.endsWith(b,"[]"))&&(O=w.toArray(h)))return b=sn(b),O.forEach(function(j,_){!(w.isUndefined(j)||j===null)&&t.append(o===!0?dr([b],_,l):o===null?b:b+"[]",d(j))}),!1}return bs(h)?!0:(t.append(dr(S,b,l),d(h)),!1)}const m=[],v=Object.assign(Sl,{defaultVisitor:p,convertValue:d,isVisitable:bs});function C(h,b){if(!w.isUndefined(h)){if(m.indexOf(h)!==-1)throw Error("Circular reference detected in "+b.join("."));m.push(h),w.forEach(h,function(O,k){(!(w.isUndefined(O)||O===null)&&i.call(t,O,w.isString(k)?k.trim():k,b,v))===!0&&C(O,b?b.concat(k):[k])}),m.pop()}}if(!w.isObject(s))throw new TypeError("data must be an object");return C(s),t}function ur(s){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function Fs(s,t){this._pairs=[],s&&ss(s,this,t)}const rn=Fs.prototype;rn.append=function(t,r){this._pairs.push([t,r])};rn.toString=function(t){const r=t?function(n){return t.call(this,n,ur)}:ur;return this._pairs.map(function(i){return r(i[0])+"="+r(i[1])},"").join("&")};function vl(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function nn(s,t,r){if(!t)return s;const n=r&&r.encode||vl;w.isFunction(r)&&(r={serialize:r});const i=r&&r.serialize;let l;if(i?l=i(t,r):l=w.isURLSearchParams(t)?t.toString():new Fs(t,r).toString(n),l){const o=s.indexOf("#");o!==-1&&(s=s.slice(0,o)),s+=(s.indexOf("?")===-1?"?":"&")+l}return s}class hr{constructor(){this.handlers=[]}use(t,r,n){return this.handlers.push({fulfilled:t,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){w.forEach(this.handlers,function(n){n!==null&&t(n)})}}const ln={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},kl=typeof URLSearchParams<"u"?URLSearchParams:Fs,Cl=typeof FormData<"u"?FormData:null,Rl=typeof Blob<"u"?Blob:null,_l={isBrowser:!0,classes:{URLSearchParams:kl,FormData:Cl,Blob:Rl},protocols:["http","https","file","blob","url","data"]},qs=typeof window<"u"&&typeof document<"u",ys=typeof navigator=="object"&&navigator||void 0,Pl=qs&&(!ys||["ReactNative","NativeScript","NS"].indexOf(ys.product)<0),El=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Al=qs&&window.location.href||"http://localhost",Ol=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:qs,hasStandardBrowserEnv:Pl,hasStandardBrowserWebWorkerEnv:El,navigator:ys,origin:Al},Symbol.toStringTag,{value:"Module"})),me={...Ol,..._l};function Il(s,t){return ss(s,new me.classes.URLSearchParams,Object.assign({visitor:function(r,n,i,l){return me.isNode&&w.isBuffer(r)?(this.append(n,r.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},t))}function Dl(s){return w.matchAll(/\w+|\[(\w*)]/g,s).map(t=>t[0]==="[]"?"":t[1]||t[0])}function Tl(s){const t={},r=Object.keys(s);let n;const i=r.length;let l;for(n=0;n<i;n++)l=r[n],t[l]=s[l];return t}function on(s){function t(r,n,i,l){let o=r[l++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),c=l>=r.length;return o=!o&&w.isArray(i)?i.length:o,c?(w.hasOwnProp(i,o)?i[o]=[i[o],n]:i[o]=n,!a):((!i[o]||!w.isObject(i[o]))&&(i[o]=[]),t(r,n,i[o],l)&&w.isArray(i[o])&&(i[o]=Tl(i[o])),!a)}if(w.isFormData(s)&&w.isFunction(s.entries)){const r={};return w.forEachEntry(s,(n,i)=>{t(Dl(n),i,r,0)}),r}return null}function zl(s,t,r){if(w.isString(s))try{return(t||JSON.parse)(s),w.trim(s)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(s)}const wt={transitional:ln,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const n=r.getContentType()||"",i=n.indexOf("application/json")>-1,l=w.isObject(t);if(l&&w.isHTMLForm(t)&&(t=new FormData(t)),w.isFormData(t))return i?JSON.stringify(on(t)):t;if(w.isArrayBuffer(t)||w.isBuffer(t)||w.isStream(t)||w.isFile(t)||w.isBlob(t)||w.isReadableStream(t))return t;if(w.isArrayBufferView(t))return t.buffer;if(w.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let a;if(l){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Il(t,this.formSerializer).toString();if((a=w.isFileList(t))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return ss(a?{"files[]":t}:t,c&&new c,this.formSerializer)}}return l||i?(r.setContentType("application/json",!1),zl(t)):t}],transformResponse:[function(t){const r=this.transitional||wt.transitional,n=r&&r.forcedJSONParsing,i=this.responseType==="json";if(w.isResponse(t)||w.isReadableStream(t))return t;if(t&&w.isString(t)&&(n&&!this.responseType||i)){const o=!(r&&r.silentJSONParsing)&&i;try{return JSON.parse(t)}catch(a){if(o)throw a.name==="SyntaxError"?H.from(a,H.ERR_BAD_RESPONSE,this,null,this.response):a}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:me.classes.FormData,Blob:me.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};w.forEach(["delete","get","head","post","put","patch"],s=>{wt.headers[s]={}});const Ll=w.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Nl=s=>{const t={};let r,n,i;return s&&s.split(`
`).forEach(function(o){i=o.indexOf(":"),r=o.substring(0,i).trim().toLowerCase(),n=o.substring(i+1).trim(),!(!r||t[r]&&Ll[r])&&(r==="set-cookie"?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t},xr=Symbol("internals");function ut(s){return s&&String(s).trim().toLowerCase()}function Dt(s){return s===!1||s==null?s:w.isArray(s)?s.map(Dt):String(s)}function Ml(s){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(s);)t[n[1]]=n[2];return t}const Fl=s=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(s.trim());function cs(s,t,r,n,i){if(w.isFunction(n))return n.call(this,t,r);if(i&&(t=r),!!w.isString(t)){if(w.isString(n))return t.indexOf(n)!==-1;if(w.isRegExp(n))return n.test(t)}}function ql(s){return s.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,n)=>r.toUpperCase()+n)}function $l(s,t){const r=w.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(s,n+r,{value:function(i,l,o){return this[n].call(this,t,i,l,o)},configurable:!0})})}let Re=class{constructor(t){t&&this.set(t)}set(t,r,n){const i=this;function l(a,c,d){const p=ut(c);if(!p)throw new Error("header name must be a non-empty string");const m=w.findKey(i,p);(!m||i[m]===void 0||d===!0||d===void 0&&i[m]!==!1)&&(i[m||c]=Dt(a))}const o=(a,c)=>w.forEach(a,(d,p)=>l(d,p,c));if(w.isPlainObject(t)||t instanceof this.constructor)o(t,r);else if(w.isString(t)&&(t=t.trim())&&!Fl(t))o(Nl(t),r);else if(w.isObject(t)&&w.isIterable(t)){let a={},c,d;for(const p of t){if(!w.isArray(p))throw TypeError("Object iterator must return a key-value pair");a[d=p[0]]=(c=a[d])?w.isArray(c)?[...c,p[1]]:[c,p[1]]:p[1]}o(a,r)}else t!=null&&l(r,t,n);return this}get(t,r){if(t=ut(t),t){const n=w.findKey(this,t);if(n){const i=this[n];if(!r)return i;if(r===!0)return Ml(i);if(w.isFunction(r))return r.call(this,i,n);if(w.isRegExp(r))return r.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=ut(t),t){const n=w.findKey(this,t);return!!(n&&this[n]!==void 0&&(!r||cs(this,this[n],n,r)))}return!1}delete(t,r){const n=this;let i=!1;function l(o){if(o=ut(o),o){const a=w.findKey(n,o);a&&(!r||cs(n,n[a],a,r))&&(delete n[a],i=!0)}}return w.isArray(t)?t.forEach(l):l(t),i}clear(t){const r=Object.keys(this);let n=r.length,i=!1;for(;n--;){const l=r[n];(!t||cs(this,this[l],l,t,!0))&&(delete this[l],i=!0)}return i}normalize(t){const r=this,n={};return w.forEach(this,(i,l)=>{const o=w.findKey(n,l);if(o){r[o]=Dt(i),delete r[l];return}const a=t?ql(l):String(l).trim();a!==l&&delete r[l],r[a]=Dt(i),n[a]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return w.forEach(this,(n,i)=>{n!=null&&n!==!1&&(r[i]=t&&w.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const n=new this(t);return r.forEach(i=>n.set(i)),n}static accessor(t){const n=(this[xr]=this[xr]={accessors:{}}).accessors,i=this.prototype;function l(o){const a=ut(o);n[a]||($l(i,o),n[a]=!0)}return w.isArray(t)?t.forEach(l):l(t),this}};Re.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);w.reduceDescriptors(Re.prototype,({value:s},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>s,set(n){this[r]=n}}});w.freezeMethods(Re);function ds(s,t){const r=this||wt,n=t||r,i=Re.from(n.headers);let l=n.data;return w.forEach(s,function(a){l=a.call(r,l,i.normalize(),t?t.status:void 0)}),i.normalize(),l}function an(s){return!!(s&&s.__CANCEL__)}function ct(s,t,r){H.call(this,s??"canceled",H.ERR_CANCELED,t,r),this.name="CanceledError"}w.inherits(ct,H,{__CANCEL__:!0});function cn(s,t,r){const n=r.config.validateStatus;!r.status||!n||n(r.status)?s(r):t(new H("Request failed with status code "+r.status,[H.ERR_BAD_REQUEST,H.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function Ul(s){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return t&&t[1]||""}function Bl(s,t){s=s||10;const r=new Array(s),n=new Array(s);let i=0,l=0,o;return t=t!==void 0?t:1e3,function(c){const d=Date.now(),p=n[l];o||(o=d),r[i]=c,n[i]=d;let m=l,v=0;for(;m!==i;)v+=r[m++],m=m%s;if(i=(i+1)%s,i===l&&(l=(l+1)%s),d-o<t)return;const C=p&&d-p;return C?Math.round(v*1e3/C):void 0}}function Wl(s,t){let r=0,n=1e3/t,i,l;const o=(d,p=Date.now())=>{r=p,i=null,l&&(clearTimeout(l),l=null),s.apply(null,d)};return[(...d)=>{const p=Date.now(),m=p-r;m>=n?o(d,p):(i=d,l||(l=setTimeout(()=>{l=null,o(i)},n-m)))},()=>i&&o(i)]}const Bt=(s,t,r=3)=>{let n=0;const i=Bl(50,250);return Wl(l=>{const o=l.loaded,a=l.lengthComputable?l.total:void 0,c=o-n,d=i(c),p=o<=a;n=o;const m={loaded:o,total:a,progress:a?o/a:void 0,bytes:c,rate:d||void 0,estimated:d&&a&&p?(a-o)/d:void 0,event:l,lengthComputable:a!=null,[t?"download":"upload"]:!0};s(m)},r)},pr=(s,t)=>{const r=s!=null;return[n=>t[0]({lengthComputable:r,total:s,loaded:n}),t[1]]},fr=s=>(...t)=>w.asap(()=>s(...t)),Hl=me.hasStandardBrowserEnv?((s,t)=>r=>(r=new URL(r,me.origin),s.protocol===r.protocol&&s.host===r.host&&(t||s.port===r.port)))(new URL(me.origin),me.navigator&&/(msie|trident)/i.test(me.navigator.userAgent)):()=>!0,Vl=me.hasStandardBrowserEnv?{write(s,t,r,n,i,l){const o=[s+"="+encodeURIComponent(t)];w.isNumber(r)&&o.push("expires="+new Date(r).toGMTString()),w.isString(n)&&o.push("path="+n),w.isString(i)&&o.push("domain="+i),l===!0&&o.push("secure"),document.cookie=o.join("; ")},read(s){const t=document.cookie.match(new RegExp("(^|;\\s*)("+s+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(s){this.write(s,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Jl(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}function Gl(s,t){return t?s.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):s}function dn(s,t,r){let n=!Jl(t);return s&&(n||r==!1)?Gl(s,t):t}const mr=s=>s instanceof Re?{...s}:s;function et(s,t){t=t||{};const r={};function n(d,p,m,v){return w.isPlainObject(d)&&w.isPlainObject(p)?w.merge.call({caseless:v},d,p):w.isPlainObject(p)?w.merge({},p):w.isArray(p)?p.slice():p}function i(d,p,m,v){if(w.isUndefined(p)){if(!w.isUndefined(d))return n(void 0,d,m,v)}else return n(d,p,m,v)}function l(d,p){if(!w.isUndefined(p))return n(void 0,p)}function o(d,p){if(w.isUndefined(p)){if(!w.isUndefined(d))return n(void 0,d)}else return n(void 0,p)}function a(d,p,m){if(m in t)return n(d,p);if(m in s)return n(void 0,d)}const c={url:l,method:l,data:l,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(d,p,m)=>i(mr(d),mr(p),m,!0)};return w.forEach(Object.keys(Object.assign({},s,t)),function(p){const m=c[p]||i,v=m(s[p],t[p],p);w.isUndefined(v)&&m!==a||(r[p]=v)}),r}const un=s=>{const t=et({},s);let{data:r,withXSRFToken:n,xsrfHeaderName:i,xsrfCookieName:l,headers:o,auth:a}=t;t.headers=o=Re.from(o),t.url=nn(dn(t.baseURL,t.url,t.allowAbsoluteUrls),s.params,s.paramsSerializer),a&&o.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let c;if(w.isFormData(r)){if(me.hasStandardBrowserEnv||me.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((c=o.getContentType())!==!1){const[d,...p]=c?c.split(";").map(m=>m.trim()).filter(Boolean):[];o.setContentType([d||"multipart/form-data",...p].join("; "))}}if(me.hasStandardBrowserEnv&&(n&&w.isFunction(n)&&(n=n(t)),n||n!==!1&&Hl(t.url))){const d=i&&l&&Vl.read(l);d&&o.set(i,d)}return t},Zl=typeof XMLHttpRequest<"u",Ql=Zl&&function(s){return new Promise(function(r,n){const i=un(s);let l=i.data;const o=Re.from(i.headers).normalize();let{responseType:a,onUploadProgress:c,onDownloadProgress:d}=i,p,m,v,C,h;function b(){C&&C(),h&&h(),i.cancelToken&&i.cancelToken.unsubscribe(p),i.signal&&i.signal.removeEventListener("abort",p)}let S=new XMLHttpRequest;S.open(i.method.toUpperCase(),i.url,!0),S.timeout=i.timeout;function O(){if(!S)return;const j=Re.from("getAllResponseHeaders"in S&&S.getAllResponseHeaders()),N={data:!a||a==="text"||a==="json"?S.responseText:S.response,status:S.status,statusText:S.statusText,headers:j,config:s,request:S};cn(function(R){r(R),b()},function(R){n(R),b()},N),S=null}"onloadend"in S?S.onloadend=O:S.onreadystatechange=function(){!S||S.readyState!==4||S.status===0&&!(S.responseURL&&S.responseURL.indexOf("file:")===0)||setTimeout(O)},S.onabort=function(){S&&(n(new H("Request aborted",H.ECONNABORTED,s,S)),S=null)},S.onerror=function(){n(new H("Network Error",H.ERR_NETWORK,s,S)),S=null},S.ontimeout=function(){let _=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const N=i.transitional||ln;i.timeoutErrorMessage&&(_=i.timeoutErrorMessage),n(new H(_,N.clarifyTimeoutError?H.ETIMEDOUT:H.ECONNABORTED,s,S)),S=null},l===void 0&&o.setContentType(null),"setRequestHeader"in S&&w.forEach(o.toJSON(),function(_,N){S.setRequestHeader(N,_)}),w.isUndefined(i.withCredentials)||(S.withCredentials=!!i.withCredentials),a&&a!=="json"&&(S.responseType=i.responseType),d&&([v,h]=Bt(d,!0),S.addEventListener("progress",v)),c&&S.upload&&([m,C]=Bt(c),S.upload.addEventListener("progress",m),S.upload.addEventListener("loadend",C)),(i.cancelToken||i.signal)&&(p=j=>{S&&(n(!j||j.type?new ct(null,s,S):j),S.abort(),S=null)},i.cancelToken&&i.cancelToken.subscribe(p),i.signal&&(i.signal.aborted?p():i.signal.addEventListener("abort",p)));const k=Ul(i.url);if(k&&me.protocols.indexOf(k)===-1){n(new H("Unsupported protocol "+k+":",H.ERR_BAD_REQUEST,s));return}S.send(l||null)})},Kl=(s,t)=>{const{length:r}=s=s?s.filter(Boolean):[];if(t||r){let n=new AbortController,i;const l=function(d){if(!i){i=!0,a();const p=d instanceof Error?d:this.reason;n.abort(p instanceof H?p:new ct(p instanceof Error?p.message:p))}};let o=t&&setTimeout(()=>{o=null,l(new H(`timeout ${t} of ms exceeded`,H.ETIMEDOUT))},t);const a=()=>{s&&(o&&clearTimeout(o),o=null,s.forEach(d=>{d.unsubscribe?d.unsubscribe(l):d.removeEventListener("abort",l)}),s=null)};s.forEach(d=>d.addEventListener("abort",l));const{signal:c}=n;return c.unsubscribe=()=>w.asap(a),c}},Xl=function*(s,t){let r=s.byteLength;if(r<t){yield s;return}let n=0,i;for(;n<r;)i=n+t,yield s.slice(n,i),n=i},Yl=async function*(s,t){for await(const r of eo(s))yield*Xl(r,t)},eo=async function*(s){if(s[Symbol.asyncIterator]){yield*s;return}const t=s.getReader();try{for(;;){const{done:r,value:n}=await t.read();if(r)break;yield n}}finally{await t.cancel()}},gr=(s,t,r,n)=>{const i=Yl(s,t);let l=0,o,a=c=>{o||(o=!0,n&&n(c))};return new ReadableStream({async pull(c){try{const{done:d,value:p}=await i.next();if(d){a(),c.close();return}let m=p.byteLength;if(r){let v=l+=m;r(v)}c.enqueue(new Uint8Array(p))}catch(d){throw a(d),d}},cancel(c){return a(c),i.return()}},{highWaterMark:2})},rs=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",hn=rs&&typeof ReadableStream=="function",to=rs&&(typeof TextEncoder=="function"?(s=>t=>s.encode(t))(new TextEncoder):async s=>new Uint8Array(await new Response(s).arrayBuffer())),xn=(s,...t)=>{try{return!!s(...t)}catch{return!1}},so=hn&&xn(()=>{let s=!1;const t=new Request(me.origin,{body:new ReadableStream,method:"POST",get duplex(){return s=!0,"half"}}).headers.has("Content-Type");return s&&!t}),jr=64*1024,ws=hn&&xn(()=>w.isReadableStream(new Response("").body)),Wt={stream:ws&&(s=>s.body)};rs&&(s=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!Wt[t]&&(Wt[t]=w.isFunction(s[t])?r=>r[t]():(r,n)=>{throw new H(`Response type '${t}' is not supported`,H.ERR_NOT_SUPPORT,n)})})})(new Response);const ro=async s=>{if(s==null)return 0;if(w.isBlob(s))return s.size;if(w.isSpecCompliantForm(s))return(await new Request(me.origin,{method:"POST",body:s}).arrayBuffer()).byteLength;if(w.isArrayBufferView(s)||w.isArrayBuffer(s))return s.byteLength;if(w.isURLSearchParams(s)&&(s=s+""),w.isString(s))return(await to(s)).byteLength},no=async(s,t)=>{const r=w.toFiniteNumber(s.getContentLength());return r??ro(t)},io=rs&&(async s=>{let{url:t,method:r,data:n,signal:i,cancelToken:l,timeout:o,onDownloadProgress:a,onUploadProgress:c,responseType:d,headers:p,withCredentials:m="same-origin",fetchOptions:v}=un(s);d=d?(d+"").toLowerCase():"text";let C=Kl([i,l&&l.toAbortSignal()],o),h;const b=C&&C.unsubscribe&&(()=>{C.unsubscribe()});let S;try{if(c&&so&&r!=="get"&&r!=="head"&&(S=await no(p,n))!==0){let N=new Request(t,{method:"POST",body:n,duplex:"half"}),U;if(w.isFormData(n)&&(U=N.headers.get("content-type"))&&p.setContentType(U),N.body){const[R,W]=pr(S,Bt(fr(c)));n=gr(N.body,jr,R,W)}}w.isString(m)||(m=m?"include":"omit");const O="credentials"in Request.prototype;h=new Request(t,{...v,signal:C,method:r.toUpperCase(),headers:p.normalize().toJSON(),body:n,duplex:"half",credentials:O?m:void 0});let k=await fetch(h,v);const j=ws&&(d==="stream"||d==="response");if(ws&&(a||j&&b)){const N={};["status","statusText","headers"].forEach(D=>{N[D]=k[D]});const U=w.toFiniteNumber(k.headers.get("content-length")),[R,W]=a&&pr(U,Bt(fr(a),!0))||[];k=new Response(gr(k.body,jr,R,()=>{W&&W(),b&&b()}),N)}d=d||"text";let _=await Wt[w.findKey(Wt,d)||"text"](k,s);return!j&&b&&b(),await new Promise((N,U)=>{cn(N,U,{data:_,headers:Re.from(k.headers),status:k.status,statusText:k.statusText,config:s,request:h})})}catch(O){throw b&&b(),O&&O.name==="TypeError"&&/Load failed|fetch/i.test(O.message)?Object.assign(new H("Network Error",H.ERR_NETWORK,s,h),{cause:O.cause||O}):H.from(O,O&&O.code,s,h)}}),Ss={http:yl,xhr:Ql,fetch:io};w.forEach(Ss,(s,t)=>{if(s){try{Object.defineProperty(s,"name",{value:t})}catch{}Object.defineProperty(s,"adapterName",{value:t})}});const br=s=>`- ${s}`,lo=s=>w.isFunction(s)||s===null||s===!1,pn={getAdapter:s=>{s=w.isArray(s)?s:[s];const{length:t}=s;let r,n;const i={};for(let l=0;l<t;l++){r=s[l];let o;if(n=r,!lo(r)&&(n=Ss[(o=String(r)).toLowerCase()],n===void 0))throw new H(`Unknown adapter '${o}'`);if(n)break;i[o||"#"+l]=n}if(!n){const l=Object.entries(i).map(([a,c])=>`adapter ${a} `+(c===!1?"is not supported by the environment":"is not available in the build"));let o=t?l.length>1?`since :
`+l.map(br).join(`
`):" "+br(l[0]):"as no adapter specified";throw new H("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return n},adapters:Ss};function us(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new ct(null,s)}function yr(s){return us(s),s.headers=Re.from(s.headers),s.data=ds.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),pn.getAdapter(s.adapter||wt.adapter)(s).then(function(n){return us(s),n.data=ds.call(s,s.transformResponse,n),n.headers=Re.from(n.headers),n},function(n){return an(n)||(us(s),n&&n.response&&(n.response.data=ds.call(s,s.transformResponse,n.response),n.response.headers=Re.from(n.response.headers))),Promise.reject(n)})}const fn="1.10.0",ns={};["object","boolean","number","function","string","symbol"].forEach((s,t)=>{ns[s]=function(n){return typeof n===s||"a"+(t<1?"n ":" ")+s}});const wr={};ns.transitional=function(t,r,n){function i(l,o){return"[Axios v"+fn+"] Transitional option '"+l+"'"+o+(n?". "+n:"")}return(l,o,a)=>{if(t===!1)throw new H(i(o," has been removed"+(r?" in "+r:"")),H.ERR_DEPRECATED);return r&&!wr[o]&&(wr[o]=!0,console.warn(i(o," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(l,o,a):!0}};ns.spelling=function(t){return(r,n)=>(console.warn(`${n} is likely a misspelling of ${t}`),!0)};function oo(s,t,r){if(typeof s!="object")throw new H("options must be an object",H.ERR_BAD_OPTION_VALUE);const n=Object.keys(s);let i=n.length;for(;i-- >0;){const l=n[i],o=t[l];if(o){const a=s[l],c=a===void 0||o(a,l,s);if(c!==!0)throw new H("option "+l+" must be "+c,H.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new H("Unknown option "+l,H.ERR_BAD_OPTION)}}const Tt={assertOptions:oo,validators:ns},De=Tt.validators;let Ye=class{constructor(t){this.defaults=t||{},this.interceptors={request:new hr,response:new hr}}async request(t,r){try{return await this._request(t,r)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const l=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?l&&!String(n.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+l):n.stack=l}catch{}}throw n}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=et(this.defaults,r);const{transitional:n,paramsSerializer:i,headers:l}=r;n!==void 0&&Tt.assertOptions(n,{silentJSONParsing:De.transitional(De.boolean),forcedJSONParsing:De.transitional(De.boolean),clarifyTimeoutError:De.transitional(De.boolean)},!1),i!=null&&(w.isFunction(i)?r.paramsSerializer={serialize:i}:Tt.assertOptions(i,{encode:De.function,serialize:De.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),Tt.assertOptions(r,{baseUrl:De.spelling("baseURL"),withXsrfToken:De.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let o=l&&w.merge(l.common,l[r.method]);l&&w.forEach(["delete","get","head","post","put","patch","common"],h=>{delete l[h]}),r.headers=Re.concat(o,l);const a=[];let c=!0;this.interceptors.request.forEach(function(b){typeof b.runWhen=="function"&&b.runWhen(r)===!1||(c=c&&b.synchronous,a.unshift(b.fulfilled,b.rejected))});const d=[];this.interceptors.response.forEach(function(b){d.push(b.fulfilled,b.rejected)});let p,m=0,v;if(!c){const h=[yr.bind(this),void 0];for(h.unshift.apply(h,a),h.push.apply(h,d),v=h.length,p=Promise.resolve(r);m<v;)p=p.then(h[m++],h[m++]);return p}v=a.length;let C=r;for(m=0;m<v;){const h=a[m++],b=a[m++];try{C=h(C)}catch(S){b.call(this,S);break}}try{p=yr.call(this,C)}catch(h){return Promise.reject(h)}for(m=0,v=d.length;m<v;)p=p.then(d[m++],d[m++]);return p}getUri(t){t=et(this.defaults,t);const r=dn(t.baseURL,t.url,t.allowAbsoluteUrls);return nn(r,t.params,t.paramsSerializer)}};w.forEach(["delete","get","head","options"],function(t){Ye.prototype[t]=function(r,n){return this.request(et(n||{},{method:t,url:r,data:(n||{}).data}))}});w.forEach(["post","put","patch"],function(t){function r(n){return function(l,o,a){return this.request(et(a||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:l,data:o}))}}Ye.prototype[t]=r(),Ye.prototype[t+"Form"]=r(!0)});let ao=class mn{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(l){r=l});const n=this;this.promise.then(i=>{if(!n._listeners)return;let l=n._listeners.length;for(;l-- >0;)n._listeners[l](i);n._listeners=null}),this.promise.then=i=>{let l;const o=new Promise(a=>{n.subscribe(a),l=a}).then(i);return o.cancel=function(){n.unsubscribe(l)},o},t(function(l,o,a){n.reason||(n.reason=new ct(l,o,a),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=n=>{t.abort(n)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new mn(function(i){t=i}),cancel:t}}};function co(s){return function(r){return s.apply(null,r)}}function uo(s){return w.isObject(s)&&s.isAxiosError===!0}const vs={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(vs).forEach(([s,t])=>{vs[t]=s});function gn(s){const t=new Ye(s),r=Vr(Ye.prototype.request,t);return w.extend(r,Ye.prototype,t,{allOwnKeys:!0}),w.extend(r,t,null,{allOwnKeys:!0}),r.create=function(i){return gn(et(s,i))},r}const ie=gn(wt);ie.Axios=Ye;ie.CanceledError=ct;ie.CancelToken=ao;ie.isCancel=an;ie.VERSION=fn;ie.toFormData=ss;ie.AxiosError=H;ie.Cancel=ie.CanceledError;ie.all=function(t){return Promise.all(t)};ie.spread=co;ie.isAxiosError=uo;ie.mergeConfig=et;ie.AxiosHeaders=Re;ie.formToJSON=s=>on(w.isHTMLForm(s)?new FormData(s):s);ie.getAdapter=pn.getAdapter;ie.HttpStatusCode=vs;ie.default=ie;const{Axios:ba,AxiosError:ya,CanceledError:wa,isCancel:Sa,CancelToken:va,VERSION:ka,all:Ca,Cancel:Ra,isAxiosError:_a,spread:Pa,toFormData:Ea,AxiosHeaders:Aa,HttpStatusCode:Oa,formToJSON:Ia,getAdapter:Da,mergeConfig:Ta}=ie;async function ho(s,t){try{console.log("Sending to backend:",{purchaseOrderId:s,items:t});const r=await ie.post("/api/receive-purchase-order",{purchaseOrderId:s,items:t});console.log("Purchase order received successfully:",r.data)}catch(r){throw console.error("Error receiving purchase order:",r),new Error("Failed to receive purchase order")}}const xo=({open:s,onClose:t,poId:r,orderNumber:n,items:i,onConfirm:l})=>{const[o,a]=u.useState([]),[c,d]=u.useState(!0),[p,m]=u.useState(!1);u.useEffect(()=>{s&&(d(!0),a(i.map(h=>({id:h.id,product_id:h.product_id,ProductName:h.ProductName,quantity_ordered:h.quantity_ordered??0,quantity_received:h.quantity_received??h.quantity_ordered??0}))),d(!1))},[i,s]);const v=(h,b)=>{let S=0;if(b==="")S=0;else if(/^\d+$/.test(b))S=parseInt(b,10);else return;a(O=>O.map(k=>k.id===h?{...k,quantity_received:S}:k))},C=async()=>{try{const h=o.map(({product_id:b,quantity_received:S})=>({product_id:String(b),quantity_received:S}));await ho(String(r),h),m(!0),t()}catch(h){console.error("Error receiving purchase order:",h),alert("Failed to receive purchase order. Please try again.")}};return e.jsxs(e.Fragment,{children:[e.jsx(_e,{open:s,onClose:t,"aria-labelledby":"receive-po-dialog-title",children:e.jsxs(Pe,{sx:{minWidth:400},children:[e.jsx(Ve,{}),e.jsxs(g,{id:"receive-po-dialog-title",level:"h4",sx:{mb:2},children:["Receive Purchase Order #",n??r]}),c?e.jsx(g,{children:"Loading items..."}):o.length===0?e.jsx(g,{children:"No items found for this purchase order."}):e.jsxs(Ue,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Ordered"}),e.jsx("th",{children:"Received"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:o.map(h=>e.jsxs("tr",{children:[e.jsx("td",{children:h.ProductName}),e.jsx("td",{children:h.quantity_ordered}),e.jsx("td",{children:e.jsx(B,{type:"number",value:h.quantity_received===0&&o.find(b=>b.id===h.id)?.quantity_received===0?"0":h.quantity_received,onChange:b=>v(h.id,b.target.value),sx:{width:80},slotProps:{input:{min:0,max:h.quantity_ordered}}})}),e.jsx("td",{style:{textAlign:"center"},children:h.quantity_received===h.quantity_ordered?e.jsx(Ds,{sx:{color:"#2e7d32"},titleAccess:"Received in full"}):e.jsx(Ur,{sx:{color:"#d32f2f"},titleAccess:"Not fully received"})})]},h.id))})]}),e.jsxs(x,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:3},children:[e.jsx(q,{variant:"plain",onClick:t,children:"Cancel"}),e.jsx(q,{variant:"solid",onClick:C,children:"Receive"})]})]})}),e.jsx(Kt,{open:p,autoHideDuration:3e3,onClose:()=>m(!1),color:"success",variant:"soft",anchorOrigin:{vertical:"top",horizontal:"center"},children:"Purchase order received successfully!"})]})},Sr={Pending:0,Ordered:1,Approved:2,Received:3,Cancelled:4},He={fontSize:K.sizes.small},Ze={...He,fontWeight:600,borderBottom:"1.5px solid #e0e0e0",background:"inherit"},Rt=s=>{switch(s){case"Pending":return"warning";case"Ordered":return"primary";case"Approved":return"primary";case"Received":return"success";case"Cancelled":return"danger";default:return"neutral"}},po=s=>{switch(s){case"Pending":return e.jsx(tr,{});case"Ordered":return e.jsx(Ft,{});case"Approved":return e.jsx(Ft,{});case"Received":return e.jsx(Ds,{});case"Cancelled":return e.jsx(Ur,{});default:return e.jsx(tr,{})}},fo=()=>{const{isMobile:s}=Se(),[t,r]=u.useState([]),[n,i]=u.useState(!1),[l,o]=u.useState(null),[a,c]=u.useState(""),[d,p]=u.useState(""),[m,v]=u.useState(!1),[C,h]=u.useState(!1),[b,S]=u.useState(null),[O,k]=u.useState([]),j=async()=>{i(!0),o(null);try{const{data:y,error:E}=await M.from("PurchaseOrders").select("id, order_number, order_date, status, total, notes, Suppliers(name)").order("order_date",{ascending:!1});if(E)throw E;if(y){const P=y.map(F=>({...F,supplier_name:F.Suppliers?.[0]?.name||"N/A",Suppliers:void 0}));r(P)}}catch(y){o(y.message||"Failed to fetch purchase orders")}finally{i(!1)}},_=async y=>{try{const{data:E,error:P}=await M.from("purchaseorderitems").select("id, product_id, Products(ProductName), quantity_ordered, quantity_received").eq("purchase_order_id",y);if(P)throw P;if(E){const F=E.map(xe=>({...xe,ProductName:xe.Products?.[0]?.ProductName||"Unknown Product"}));k(F)}}catch(E){console.error("Error fetching PO items:",E)}},N=async()=>{await j()},U=async(y,E)=>{try{const{error:P}=await M.from("PurchaseOrders").update({status:E}).eq("id",y);if(P)throw P;await j()}catch(P){o(P.message||"Failed to update order status")}},R=async y=>{S(y),await _(y.id),h(!0)},W=async y=>{try{for(const E of y)await M.from("purchaseorderitems").update({quantity_received:E.quantity_received}).eq("id",E.id);b?.id&&await M.from("PurchaseOrders").update({status:"Received"}).eq("id",b.id),h(!1),S(null),await j()}catch(E){o(E.message||"Failed to receive order")}},T=[...t.filter(y=>{const E=y.order_number?.toString().toLowerCase().includes(a.toLowerCase())||y.supplier_name?.toLowerCase().includes(a.toLowerCase()),P=d?y.status===d:!0;return E&&P})].sort((y,E)=>{const P=Sr[y.status]??99,F=Sr[E.status]??99;return P!==F?P-F:new Date(E.order_date).getTime()-new Date(y.order_date).getTime()});u.useEffect(()=>{j()},[]);const L=()=>e.jsxs(x,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(je,{padding:"medium",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:K.sizes.xlarge},children:"Purchase Orders"}),e.jsxs(x,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(B,{placeholder:"Search orders...",value:a,onChange:y=>c(y.target.value),startDecorator:e.jsx(ge,{}),sx:{flex:1}}),e.jsxs(ne,{placeholder:"Status",value:d,onChange:(y,E)=>p(E??""),sx:{minWidth:120},children:[e.jsx(z,{value:"",children:"All"}),e.jsx(z,{value:"Pending",children:"Pending"}),e.jsx(z,{value:"Ordered",children:"Ordered"}),e.jsx(z,{value:"Approved",children:"Approved"}),e.jsx(z,{value:"Received",children:"Received"}),e.jsx(z,{value:"Cancelled",children:"Cancelled"})]})]}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(ae,{}),onClick:()=>v(!0),sx:{width:"100%",mb:2},children:"Add Purchase Order"})]}),n&&e.jsx(Ae,{}),l&&e.jsx(x,{sx:{p:2},children:e.jsxs(g,{color:"danger",children:["Error: ",l]})}),e.jsx(x,{children:T.length===0?e.jsx(x,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:"No purchase orders found"})}):T.map(y=>e.jsx(x,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(x,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${Rt(y.status)}.100`,color:`${Rt(y.status)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",flexShrink:0},children:po(y.status)}),e.jsxs(x,{sx:{flex:1,minWidth:0},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsxs(g,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:["Order #",y.order_number]}),e.jsx(Y,{size:"sm",color:Rt(y.status),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content"},children:y.status})]}),e.jsxs(g,{level:"body-xs",color:"neutral",sx:{mb:.5},children:[y.supplier_name," • ",new Date(y.order_date).toLocaleDateString()]}),e.jsxs(g,{level:"body-sm",sx:{fontWeight:"bold",color:"text.primary"},children:["Total: $",y.total?.toFixed(2)||"0.00"]}),e.jsx(x,{sx:{display:"flex",gap:1,mt:1},children:y.status==="Pending"?e.jsx(q,{size:"sm",variant:"outlined",onClick:()=>U(y.id,"Ordered"),children:"Order"}):e.jsx(q,{size:"sm",variant:"outlined",onClick:()=>R(y),disabled:y.status!=="Approved"&&y.status!=="Ordered",children:"Receive"})})]})]})},y.id))})]}),I=()=>e.jsxs(je,{children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:K.sizes.xlarge},children:"Purchase Orders"}),e.jsxs(x,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(B,{placeholder:"Search purchase orders...",sx:{flex:1},value:a,onChange:y=>c(y.target.value),startDecorator:e.jsx(ge,{})}),e.jsxs(ne,{placeholder:"Filter status",value:d,onChange:(y,E)=>p(E??""),sx:{minWidth:160},children:[e.jsx(z,{value:"",children:"All Statuses"}),e.jsx(z,{value:"Pending",children:"Pending"}),e.jsx(z,{value:"Ordered",children:"Ordered"}),e.jsx(z,{value:"Approved",children:"Approved"}),e.jsx(z,{value:"Received",children:"Received"}),e.jsx(z,{value:"Cancelled",children:"Cancelled"})]}),e.jsx(q,{onClick:()=>v(!0),variant:"solid",startDecorator:e.jsx(ae,{}),children:"Add Purchase Order"})]}),e.jsxs(ke,{children:[n&&e.jsx(Ae,{}),l&&e.jsxs(g,{color:"danger",children:["Error: ",l]}),e.jsxs(Ue,{"aria-label":"Purchase Orders",sx:{minWidth:800},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:Ze,children:"Order Number"}),e.jsx("th",{style:Ze,children:"Order Date"}),e.jsx("th",{style:Ze,children:"Status"}),e.jsx("th",{style:Ze,children:"Total"}),e.jsx("th",{style:Ze,children:"Supplier"}),e.jsx("th",{style:Ze,children:"Notes"}),e.jsx("th",{style:{width:120,...Ze},children:"Actions"})]})}),e.jsxs("tbody",{children:[T.length===0&&!n&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...He},children:"No purchase orders found."})}),T.map(y=>e.jsxs("tr",{style:{cursor:"pointer",height:48},children:[e.jsx("td",{style:He,children:y.order_number}),e.jsx("td",{style:He,children:new Date(y.order_date).toLocaleDateString()}),e.jsx("td",{style:He,children:e.jsx(Y,{size:"sm",color:Rt(y.status),variant:"soft",children:y.status})}),e.jsxs("td",{style:He,children:["$",y.total?.toFixed(2)||"0.00"]}),e.jsx("td",{style:He,children:y.supplier_name}),e.jsx("td",{style:He,children:y.notes||"-"}),e.jsx("td",{children:y.status==="Pending"?e.jsx(q,{size:"sm",variant:"outlined",onClick:()=>U(y.id,"Ordered"),children:"Order"}):e.jsx(q,{size:"sm",variant:"outlined",onClick:()=>R(y),disabled:y.status!=="Approved"&&y.status!=="Ordered",children:"Receive"})})]},y.id))]})]})]})]});return e.jsxs(Le,{children:[s?e.jsx(L,{}):e.jsx(I,{}),e.jsx(Ti,{open:m,onClose:()=>v(!1),onCreated:N,mode:"add",order:void 0}),e.jsx(xo,{open:C&&!!b?.id,onClose:()=>{h(!1),S(null)},poId:b?.id||"",orderNumber:b?.order_number||"",items:O.filter(y=>!!y.id&&!!y.product_id),onConfirm:W})]})};function mo({value:s,onChange:t,toggleSidebar:r}){const n=zs(),[i,l]=u.useState(!1),[o,a]=u.useState("Sales");if(n.pathname==="/login")return null;const c=u.useMemo(()=>Tn({components:{MuiTableRow:{styleOverrides:{root:{"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}}}}}}),[]);bi.filter(m=>m.showInMobile);const d=o?Ot[o].filter(m=>m.showInMobile):[],p=async m=>{const{data:v}=await M.auth.getSession();if(!v&&["orders","products","users","suppliers","purchaseorders","tickets","smscampaigns","movements"].includes(m)){console.warn("Authentication required for this page"),t("home");return}t(m)};return e.jsxs(zn,{theme:c,children:[e.jsxs(Ln,{open:i,onClose:()=>l(!1),children:[e.jsx(Nn,{children:"Select Area"}),e.jsx(Mn,{children:["Sales","Support","Marketing","Operations"].map(m=>e.jsx(Qs,{fullWidth:!0,variant:o===m?"contained":"outlined",onClick:()=>{a(m),l(!1)},sx:{my:1},children:m},m))}),e.jsx(Fn,{children:e.jsx(Qs,{onClick:()=>l(!1),children:"Close"})})]}),e.jsx(qn,{sx:{position:"fixed",bottom:0,left:0,right:0,zIndex:9999,backgroundColor:"rgba(0, 0, 255, 0.2)",overflow:"hidden"},children:e.jsx("div",{style:{display:"flex",flexDirection:"row",overflowX:"auto"},children:e.jsxs($n,{showLabels:!0,value:s,onChange:(m,v)=>{p(v)},sx:{minWidth:"max-content",flex:1},children:[d.map(m=>e.jsx(Ks,{label:m.label,icon:m.icon,value:m.value,onClick:()=>p(m.value)},m.value)),e.jsx(Ks,{label:o||"",icon:e.jsx(ri,{}),onClick:m=>{m.stopPropagation(),l(!0)}})]})})})]})}function hs({open:s,onClose:t,onCreated:r}){const[n,i]=u.useState(""),[l,o]=u.useState(""),[a,c]=u.useState(!1),[d,p]=u.useState(null),m=async v=>{v.preventDefault(),c(!0),p(null);const C={subject:n,requester_name:l,status:"Open"};console.log("[DialogTicketCreate] Creating ticket with payload:",C);const{error:h,data:b}=await M.from("tickets").insert(C);h&&(p(h.message||JSON.stringify(h)),console.error("[DialogTicketCreate] Error creating ticket:",h)),c(!1),h||(i(""),o(""),t(),r&&r())};return e.jsx(_e,{open:s,onClose:t,children:e.jsxs(Pe,{sx:{minWidth:400},children:[e.jsx(g,{level:"title-md",sx:{mb:2},children:"Create Ticket"}),e.jsxs("form",{onSubmit:m,children:[e.jsx(B,{placeholder:"Subject",value:n,onChange:v=>i(v.target.value),sx:{mb:2},required:!0}),e.jsx(B,{placeholder:"Requester Name",value:l,onChange:v=>o(v.target.value),sx:{mb:2},required:!0}),d&&e.jsx(g,{color:"danger",sx:{mb:1},children:d}),e.jsx(q,{type:"submit",loading:a,disabled:a||!n||!l,variant:"solid",children:"Create"})]})]})})}const go=["Refund issued","Replacement sent","Order cancelled","Technical support provided","Information provided","Awaiting customer response","Other"],jo=({open:s,onClose:t,onSubmit:r})=>{const[n,i]=G.useState(""),[l,o]=G.useState("");return G.useEffect(()=>{s||(i(""),o(""))},[s]),e.jsx(_e,{open:s,onClose:t,children:e.jsxs(Pe,{children:[e.jsx(Gt,{children:"Resolve Ticket"}),e.jsxs(Zt,{sx:{display:"flex",flexDirection:"column",gap:2,minWidth:320},children:[e.jsx(ne,{value:n,onChange:(a,c)=>i(c||""),placeholder:"Select resolution",required:!0,children:go.map(a=>e.jsx(z,{value:a,children:a},a))}),e.jsx(ms,{minRows:3,placeholder:"Resolution comment to customer...",value:l,onChange:a=>o(a.target.value)})]}),e.jsxs(Qt,{children:[e.jsx(q,{variant:"plain",onClick:t,children:"Cancel"}),e.jsx(q,{variant:"solid",color:"primary",disabled:!n,onClick:()=>{try{r(n,l),t()}catch(a){console.error("Error during form submission:",a)}},children:"Submit"})]})]})})},xs=Ns(jo),vr=s=>{if(!s)return"";const t=new Date(s),n=Math.floor((new Date().getTime()-t.getTime())/1e3);if(n<60)return"Just now";const i=Math.floor(n/60);if(i<60)return`${i} min ago`;const l=Math.floor(i/60);if(l<24)return`${l} hour${l>1?"s":""} ago`;const o=Math.floor(l/24);if(o<7)return`${o} day${o>1?"s":""} ago`;const a=Math.floor(o/7);if(a<4)return`${a} week${a>1?"s":""} ago`;const c=Math.floor(o/30);return`${c} month${c>1?"s":""} ago`},ht={Open:{color:"success",label:"Open"},Pending:{color:"warning",label:"Pending"},Closed:{color:"neutral",label:"Closed"}};function bo(){const{isMobile:s}=Se(),[t,r]=u.useState([]),[n,i]=u.useState(null),[l,o]=u.useState([]),[a,c]=u.useState(""),[d,p]=u.useState(""),[m,v]=u.useState("Open"),[C,h]=u.useState(!1),[b,S]=u.useState(!1),[O,k]=u.useState(!1);u.useEffect(()=>{(async()=>{const{data:T,error:L}=await M.from("tickets").select("*").order("created_at",{ascending:!1});L||r(T||[])})()},[]),u.useEffect(()=>{if(!n){o([]);return}(async()=>{const{data:T,error:L}=await M.from("ticketactivities").select("*").eq("ticket_id",n).order("timestamp",{ascending:!0});L||o(T||[])})()},[n]);const j=async()=>{const{data:D,error:T}=await M.from("tickets").select("*").order("created_at",{ascending:!1});T||r(D||[])},_=async()=>{if(a.trim()&&n){console.log("Sending message:",{ticket_id:n,message:a,activity_type:"chat",sender_name:"You"});const{error:D,data:T}=await M.from("ticketactivities").insert({ticket_id:n,message:a,activity_type:"chat",sender_name:"You"}).select();if(D){console.error("Error sending message:",D),alert("Failed to send message: "+D.message);return}console.log("Message sent successfully:",T),c("");const{data:L,error:I}=await M.from("ticketactivities").select("*").eq("ticket_id",n).order("timestamp",{ascending:!0});I?console.error("Error fetching activities:",I):(console.log("Refreshed activities:",L),o(L||[]))}},N=async(D,T)=>{if(n)try{const{error:L}=await M.from("tickets").update({status:"Closed"}).eq("id",n);if(L){console.error("Error updating ticket status:",L),alert("Failed to resolve ticket: "+L.message);return}const{error:I}=await M.from("ticketactivities").insert({ticket_id:n,message:`Ticket resolved: ${D}${T?` - ${T}`:""}`,activity_type:"chat",sender_name:"You"});I&&console.error("Error adding resolution activity:",I),await j();const{data:y}=await M.from("ticketactivities").select("*").eq("ticket_id",n).order("timestamp",{ascending:!0});o(y||[])}catch(L){console.error("Error resolving ticket:",L),alert("Failed to resolve ticket")}},U=D=>{i(D),k(!0)},R=()=>{k(!1),i(null)},W=t.filter(D=>{if(m!=="All"&&D.status!==m)return!1;if(!d)return!0;const T=d.toLowerCase();return D.subject?.toLowerCase().includes(T)||D.requester_name?.toLowerCase().includes(T)||D.status?.toLowerCase().includes(T)});if(s){const D=t.length>0&&t.every(T=>T.status==="Closed")&&m==="Open";if(O&&n){const T=t.find(L=>L.id===n);return e.jsxs(Le,{children:[e.jsxs(x,{sx:{display:"flex",flexDirection:"column",height:"100vh"},children:[e.jsxs(x,{sx:{px:2,py:1.5,borderBottom:"1px solid",borderColor:"divider",display:"flex",alignItems:"center",gap:2,bgcolor:"background.surface"},children:[e.jsx(re,{size:"sm",variant:"plain",onClick:R,children:e.jsx(ni,{})}),e.jsx(oe,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:T?.requester_name?.[0]?.toUpperCase()||"?"}),e.jsxs(x,{sx:{flex:1,minWidth:0},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:600,mb:.5},children:T?.subject||"Untitled"}),e.jsx(g,{level:"body-xs",color:"neutral",children:T?.requester_name})]}),e.jsx(Y,{variant:"soft",size:"sm",color:ht[T?.status||"Open"]?.color,sx:{fontWeight:600},children:ht[T?.status||"Open"]?.label}),T?.status!=="Closed"&&e.jsx(q,{variant:"solid",color:"primary",size:"sm",onClick:()=>S(!0),children:"Resolve"})]}),e.jsx(x,{sx:{flex:1,overflowY:"auto",px:2,py:2},children:e.jsx(ee,{spacing:3,children:l.map((L,I)=>{const y=L.sender_name==="You";return e.jsxs(x,{children:[I===0||new Date(L.timestamp||"").toDateString()!==new Date(l[I-1]?.timestamp||"").toDateString()?e.jsxs(x,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(x,{sx:{flex:1,height:"1px",bgcolor:"divider"}}),e.jsx(g,{level:"body-xs",sx:{mx:2,color:"text.secondary"},children:L.timestamp?new Date(L.timestamp).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}):""}),e.jsx(x,{sx:{flex:1,height:"1px",bgcolor:"divider"}})]}):null,e.jsxs(ee,{direction:"row",spacing:1,sx:{alignItems:"flex-start"},children:[!y&&e.jsx(oe,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:L.sender_name?.[0]?.toUpperCase()||"?"}),e.jsx(x,{sx:{flex:1,display:"flex",flexDirection:y?"row-reverse":"row"},children:e.jsxs(x,{sx:{maxWidth:"85%",bgcolor:y?"primary.500":"neutral.50",color:y?"white":"text.primary",borderRadius:y?"18px 18px 4px 18px":"18px 18px 18px 4px",px:2,py:1.5,position:"relative",boxShadow:"sm"},children:[!y&&e.jsx(g,{level:"body-xs",sx:{fontWeight:600,mb:.5,color:y?"white":"text.primary"},children:L.sender_name}),e.jsx(g,{level:"body-sm",sx:{lineHeight:1.4,color:y?"white":"text.primary"},children:L.message})]})}),y&&e.jsx(oe,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:L.sender_name?.[0]?.toUpperCase()||"?"})]}),e.jsx(x,{sx:{display:"flex",justifyContent:y?"flex-end":"flex-start",mt:.5,ml:y?0:5},children:e.jsx(g,{level:"body-xs",sx:{color:"text.tertiary"},children:L.timestamp?new Date(L.timestamp).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):""})})]},L.id)})})}),e.jsx(x,{sx:{px:2,py:1.5,borderTop:"1px solid",borderColor:"divider",bgcolor:"background.surface"},children:e.jsxs(ee,{direction:"row",spacing:1,alignItems:"flex-end",children:[e.jsx(x,{sx:{flex:1},children:e.jsx(ms,{placeholder:"Type something here...",value:a,onChange:L=>c(L.target.value),minRows:1,maxRows:3,sx:{borderRadius:"20px",border:"1px solid",borderColor:"neutral.300","&:focus-within":{borderColor:"primary.500"},"& textarea":{border:"none",outline:"none",resize:"none",px:2,py:1}},onKeyDown:L=>{L.key==="Enter"&&!L.shiftKey&&(L.preventDefault(),_())}})}),e.jsx(q,{onClick:_,disabled:!a.trim(),variant:"solid",color:"primary",size:"sm",sx:{borderRadius:"20px",minWidth:50,height:36,fontWeight:600},children:"Send"})]})})]}),e.jsx(hs,{open:C,onClose:()=>h(!1),onCreated:j}),e.jsx(xs,{open:b,onClose:()=>S(!1),onSubmit:N})]})}return e.jsxs(Le,{children:[e.jsxs(x,{sx:{p:2},children:[e.jsx(g,{level:"h2",sx:{mb:3,fontWeight:600},children:"Tickets"}),e.jsxs(ee,{spacing:2,sx:{mb:2},children:[e.jsxs(ee,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(B,{placeholder:"Search tickets...",startDecorator:e.jsx(ge,{}),value:d,onChange:T=>p(T.target.value),size:"sm",sx:{flex:1}}),e.jsx(re,{size:"sm",variant:"soft",color:"primary",onClick:()=>h(!0),children:e.jsx(ae,{})})]}),e.jsxs(ne,{value:m,onChange:(T,L)=>v(L),size:"sm",placeholder:"Filter by status",children:[e.jsx(z,{value:"All",children:"All Tickets"}),e.jsx(z,{value:"Open",children:"Open"}),e.jsx(z,{value:"Pending",children:"Pending"}),e.jsx(z,{value:"Closed",children:"Closed"})]})]}),D?e.jsxs(x,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"60vh",gap:2},children:[e.jsx(ii,{sx:{fontSize:80,color:"primary.500"}}),e.jsx(g,{level:"h3",sx:{fontWeight:700,textAlign:"center"},children:"All done, you can now go to the beach"})]}):e.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:0},children:[W.map((T,L)=>e.jsxs(u.Fragment,{children:[e.jsxs(x,{sx:{p:2,display:"flex",alignItems:"flex-start",gap:2,cursor:"pointer",background:"transparent",borderRadius:1,transition:"all 0.2s","&:hover":{bgcolor:"neutral.50"}},onClick:()=>U(T.id),children:[e.jsx(oe,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600,mt:.5},children:T.requester_name?.[0]?.toUpperCase()||"?"}),e.jsxs(x,{sx:{flex:1,minWidth:0},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:600,mb:.5,wordBreak:"break-word"},children:T.subject||"Untitled"}),e.jsx(g,{level:"body-xs",color:"neutral",sx:{mb:.5,wordBreak:"break-word"},children:T.requester_name}),e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(g,{level:"body-xs",color:"neutral",children:vr(T.updated_at)}),e.jsx(g,{level:"body-xs",color:"neutral",children:"•"}),e.jsxs(g,{level:"body-xs",color:"neutral",sx:{wordBreak:"break-all"},children:[T.id?.slice(0,8),"..."]})]})]}),e.jsx(Y,{variant:"soft",size:"sm",color:ht[T.status||"Open"]?.color,sx:{fontWeight:600,px:1.5,py:.5,ml:1},children:ht[T.status||"Open"]?.label})]}),L<W.length-1&&e.jsx(ot,{sx:{my:.5}})]},T.id)),W.length===0&&e.jsx(g,{color:"neutral",sx:{textAlign:"center",mt:4},children:"No tickets found."})]})]}),e.jsx(hs,{open:C,onClose:()=>h(!1),onCreated:j}),e.jsx(xs,{open:b,onClose:()=>S(!1),onSubmit:N})]})}return e.jsxs(x,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[e.jsxs(x,{sx:{display:"flex",flex:1},children:[e.jsxs(x,{sx:{width:390,borderRight:"1px solid",borderColor:"divider",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs(x,{sx:{px:2,py:1,borderBottom:"1px solid",borderColor:"divider",flexShrink:0},children:[e.jsxs(ee,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[e.jsxs(ee,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(g,{level:"title-lg",children:"Messages"}),e.jsx(Y,{size:"sm",variant:"soft",color:"neutral",children:W.length})]}),e.jsx(re,{size:"sm",variant:"soft",color:"primary",onClick:()=>h(!0),children:e.jsx(ae,{})})]}),e.jsx(B,{placeholder:"Search",startDecorator:e.jsx(ge,{}),value:d,onChange:D=>p(D.target.value),size:"sm",sx:{width:"100%",mb:1}}),e.jsxs(ne,{value:m,onChange:(D,T)=>v(T),size:"sm",sx:{width:"100%"},placeholder:"Filter by status",children:[e.jsx(z,{value:"All",children:"All Tickets"}),e.jsx(z,{value:"Open",children:"Open"}),e.jsx(z,{value:"Pending",children:"Pending"}),e.jsx(z,{value:"Closed",children:"Closed"})]})]}),e.jsx(x,{sx:{flex:1,overflowY:"auto",overflowX:"hidden",pt:1},children:e.jsx(At,{size:"sm",sx:{gap:0},children:W.map(D=>e.jsxs(u.Fragment,{children:[e.jsx(ft,{sx:{p:0},children:e.jsx(Me,{selected:n===D.id,onClick:()=>i(D.id),sx:{py:1,px:2},children:e.jsxs(ee,{direction:"row",spacing:1.5,alignItems:"flex-start",sx:{width:"100%"},children:[e.jsx(x,{sx:{position:"relative"},children:e.jsx(oe,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:D.requester_name?.[0]?.toUpperCase()||"?"})}),e.jsxs(x,{sx:{flex:1,minWidth:0,pr:1},children:[e.jsxs(ee,{direction:"row",justifyContent:"space-between",alignItems:"flex-start",sx:{mb:.5},children:[e.jsx(g,{level:"body-md",noWrap:!0,sx:{flex:1,pr:1},children:D.subject||"Untitled"}),D.status&&e.jsx(Y,{size:"sm",color:ht[D.status]?.color,variant:"soft",sx:{flexShrink:0},children:D.status})]}),e.jsx(g,{level:"body-sm",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",mb:.5},children:D.requester_name||""}),e.jsx(x,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(g,{level:"body-xs",sx:{color:"text.tertiary"},children:vr(D.updated_at)})})]})]})})}),e.jsx(Un,{component:"li",sx:{margin:0}})]},D.id))})})]}),e.jsxs(x,{sx:{flex:1,display:"flex",flexDirection:"column"},children:[n&&e.jsx(x,{sx:{px:3,py:2,borderBottom:"1px solid",borderColor:"divider",flexShrink:0},children:e.jsxs(ee,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(oe,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:t.find(D=>D.id===n)?.requester_name?.[0]?.toUpperCase()||"?"}),e.jsxs(x,{sx:{flex:1},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:600},children:t.find(D=>D.id===n)?.requester_name||"Unknown User"}),e.jsx(g,{level:"body-xs",sx:{color:"text.secondary"},children:t.find(D=>D.id===n)?.status||"Unknown Status"})]}),e.jsx(q,{variant:"outlined",size:"sm",sx:{borderRadius:"16px"},children:"View profile"}),t.find(D=>D.id===n)?.status!=="Closed"&&e.jsx(q,{variant:"solid",color:"primary",size:"sm",sx:{borderRadius:"16px"},onClick:()=>S(!0),children:"Resolve"})]})}),e.jsx(x,{sx:{flex:1,overflowY:"auto",px:3,py:2},children:n?e.jsx(ee,{spacing:3,children:l.map((D,T)=>{const L=D.sender_name==="You";return e.jsxs(x,{children:[T===0||new Date(D.timestamp||"").toDateString()!==new Date(l[T-1]?.timestamp||"").toDateString()?e.jsxs(x,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(x,{sx:{flex:1,height:"1px",bgcolor:"divider"}}),e.jsx(g,{level:"body-xs",sx:{mx:2,color:"text.secondary"},children:D.timestamp?new Date(D.timestamp).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}):""}),e.jsx(x,{sx:{flex:1,height:"1px",bgcolor:"divider"}})]}):null,e.jsxs(ee,{direction:"row",spacing:1,sx:{alignItems:"flex-start"},children:[!L&&e.jsx(oe,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:D.sender_name?.[0]?.toUpperCase()||"?"}),e.jsx(x,{sx:{flex:1,display:"flex",flexDirection:L?"row-reverse":"row"},children:e.jsxs(x,{sx:{maxWidth:"70%",bgcolor:L?"primary.500":"neutral.50",color:L?"white":"text.primary",borderRadius:L?"18px 18px 4px 18px":"18px 18px 18px 4px",px:2,py:1.5,position:"relative",boxShadow:"sm"},children:[!L&&e.jsx(g,{level:"body-xs",sx:{fontWeight:600,mb:.5,color:L?"white":"text.primary"},children:D.sender_name}),e.jsx(g,{level:"body-sm",sx:{lineHeight:1.4,color:L?"white":"text.primary"},children:D.message})]})}),L&&e.jsx(oe,{size:"sm",sx:{bgcolor:"primary.100",color:"primary.700",fontWeight:600},children:D.sender_name?.[0]?.toUpperCase()||"?"})]}),e.jsx(x,{sx:{display:"flex",justifyContent:L?"flex-end":"flex-start",mt:.5,ml:L?0:5},children:e.jsx(g,{level:"body-xs",sx:{color:"text.tertiary"},children:D.timestamp?new Date(D.timestamp).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):""})})]},D.id)})}):e.jsx(x,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx(g,{level:"body-md",sx:{color:"text.secondary"},children:"Select a ticket to view messages"})})}),n&&e.jsx(x,{sx:{px:3,py:2,borderTop:"1px solid",borderColor:"divider",flexShrink:0},children:e.jsxs(ee,{direction:"row",spacing:1,alignItems:"flex-end",children:[e.jsx(x,{sx:{flex:1},children:e.jsx(ms,{placeholder:"Type something here...",value:a,onChange:D=>c(D.target.value),minRows:1,maxRows:4,sx:{borderRadius:"20px",border:"1px solid",borderColor:"neutral.300","&:focus-within":{borderColor:"primary.500"},"& textarea":{border:"none",outline:"none",resize:"none",px:2,py:1}},onKeyDown:D=>{D.key==="Enter"&&!D.shiftKey&&(D.preventDefault(),_())}})}),e.jsx(q,{onClick:_,disabled:!a.trim(),variant:"solid",color:"primary",sx:{borderRadius:"20px",minWidth:60,height:40,fontWeight:600},children:"Send"})]})})]})]}),e.jsx(hs,{open:C,onClose:()=>h(!1),onCreated:j}),e.jsx(xs,{open:b,onClose:()=>S(!1),onSubmit:N})]})}const kr={draft:0,scheduled:1,sent:2,failed:3},Fe={fontSize:K.sizes.small},Qe={...Fe,fontWeight:600,borderBottom:"1.5px solid #e0e0e0",background:"inherit"},_t=s=>{switch(s){case"draft":return"neutral";case"scheduled":return"warning";case"sent":return"success";case"failed":return"danger";default:return"neutral"}},yo=s=>{switch(s){case"draft":return e.jsx(ci,{});case"scheduled":return e.jsx(ai,{});case"sent":return e.jsx(Ds,{});case"failed":return e.jsx(oi,{});default:return e.jsx(li,{})}},wo=()=>{const{isMobile:s}=Se(),[t,r]=u.useState([]),[n,i]=u.useState(!1),[l,o]=u.useState(null),[a,c]=u.useState(""),[d,p]=u.useState(""),[m,v]=u.useState(!1),C=async()=>{i(!0),o(null);try{const{data:k,error:j}=await M.from("sms_campaigns").select("*").order("created_at",{ascending:!1});if(j)throw j;k&&r(k)}catch(k){console.error("Error fetching campaigns:",k),o(k.message||"Failed to fetch campaigns")}finally{i(!1)}},b=[...t.filter(k=>{const j=k.name.toLowerCase().includes(a.toLowerCase())||k.CampaignNumber?.toLowerCase().includes(a.toLowerCase()),_=d?k.status===d:!0;return j&&_})].sort((k,j)=>{const _=kr[k.status]??99,N=kr[j.status]??99;return _!==N?_-N:new Date(j.created_at).getTime()-new Date(k.created_at).getTime()});u.useEffect(()=>{C()},[]);const S=()=>e.jsxs(x,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(je,{padding:"medium",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:K.sizes.xlarge},children:"SMS Campaigns"}),e.jsxs(x,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(B,{placeholder:"Search campaigns...",value:a,onChange:k=>c(k.target.value),startDecorator:e.jsx(ge,{}),sx:{flex:1}}),e.jsxs(ne,{placeholder:"Status",value:d,onChange:(k,j)=>p(j??""),sx:{minWidth:120},children:[e.jsx(z,{value:"",children:"All"}),e.jsx(z,{value:"draft",children:"Draft"}),e.jsx(z,{value:"scheduled",children:"Scheduled"}),e.jsx(z,{value:"sent",children:"Sent"}),e.jsx(z,{value:"failed",children:"Failed"})]})]}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(ae,{}),onClick:()=>v(!0),sx:{width:"100%",mb:2},children:"Create Campaign"})]}),n&&e.jsx(Ae,{}),l&&e.jsx(x,{sx:{p:2},children:e.jsxs(g,{color:"danger",children:["Error: ",l]})}),e.jsx(x,{children:b.length===0?e.jsx(x,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:"No SMS campaigns found"})}):b.map(k=>e.jsx(x,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(x,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${_t(k.status)}.100`,color:`${_t(k.status)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",flexShrink:0},children:yo(k.status)}),e.jsxs(x,{sx:{flex:1,minWidth:0},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:k.name}),e.jsx(Y,{size:"sm",color:_t(k.status),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content",textTransform:"capitalize"},children:k.status})]}),e.jsxs(g,{level:"body-xs",color:"neutral",sx:{mb:.5},children:["Campaign #",k.CampaignNumber," • ",new Date(k.created_at).toLocaleDateString()]}),e.jsxs(x,{sx:{display:"flex",gap:2,mb:.5},children:[e.jsxs(g,{level:"body-xs",color:"neutral",children:["Recipients: ",k.recipients?.length??0]}),k.scheduled_at&&e.jsxs(g,{level:"body-xs",color:"neutral",children:["Scheduled: ",os(new Date(k.scheduled_at),"MMM dd, HH:mm")]})]}),k.message&&e.jsxs(g,{level:"body-xs",color:"neutral",sx:{fontStyle:"italic",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:['"',k.message,'"']})]})]})},k.id))})]}),O=()=>e.jsxs(je,{children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:K.sizes.xlarge},children:"SMS Campaigns"}),e.jsxs(x,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(B,{placeholder:"Search campaigns...",sx:{flex:1},value:a,onChange:k=>c(k.target.value),startDecorator:e.jsx(ge,{})}),e.jsxs(ne,{placeholder:"Filter status",value:d,onChange:(k,j)=>p(j??""),sx:{minWidth:160},children:[e.jsx(z,{value:"",children:"All Statuses"}),e.jsx(z,{value:"draft",children:"Draft"}),e.jsx(z,{value:"scheduled",children:"Scheduled"}),e.jsx(z,{value:"sent",children:"Sent"}),e.jsx(z,{value:"failed",children:"Failed"})]}),e.jsx(q,{onClick:()=>v(!0),variant:"solid",startDecorator:e.jsx(ae,{}),children:"Create Campaign"})]}),e.jsxs(ke,{children:[n&&e.jsx(Ae,{}),l&&e.jsxs(g,{color:"danger",children:["Error: ",l]}),e.jsxs(Ue,{"aria-label":"SMS Campaigns",sx:{minWidth:800},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:Qe,children:"Campaign #"}),e.jsx("th",{style:Qe,children:"Name"}),e.jsx("th",{style:Qe,children:"Status"}),e.jsx("th",{style:Qe,children:"Scheduled"}),e.jsx("th",{style:Qe,children:"Sent"}),e.jsx("th",{style:Qe,children:"Recipients"}),e.jsx("th",{style:Qe,children:"Message"})]})}),e.jsxs("tbody",{children:[b.length===0&&!n&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#888",...Fe},children:"No campaigns found."})}),b.map(k=>e.jsxs("tr",{style:{cursor:"pointer",height:48},children:[e.jsx("td",{style:Fe,children:k.CampaignNumber}),e.jsx("td",{style:Fe,children:k.name}),e.jsx("td",{style:Fe,children:e.jsx(Y,{size:"sm",color:_t(k.status),variant:"soft",sx:{textTransform:"capitalize"},children:k.status})}),e.jsx("td",{style:Fe,children:k.scheduled_at?os(new Date(k.scheduled_at),"yyyy-MM-dd HH:mm"):"-"}),e.jsx("td",{style:Fe,children:k.sent_at?os(new Date(k.sent_at),"yyyy-MM-dd HH:mm"):"-"}),e.jsx("td",{style:Fe,children:k.recipients?.length??0}),e.jsx("td",{style:Fe,children:e.jsx(g,{level:"body-sm",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:k.message||"-"})})]},k.id))]})]})]})]});return e.jsxs(Le,{children:[s?e.jsx(S,{}):e.jsx(O,{}),e.jsx(_e,{open:m,onClose:()=>v(!1),children:e.jsxs(Pe,{children:[e.jsx(Ve,{}),e.jsx(g,{level:"h4",children:"Create New Campaign"}),e.jsx(g,{level:"body-sm",sx:{mt:1,mb:2},children:"Campaign creation functionality will be implemented here."}),e.jsx(q,{onClick:()=>v(!1),variant:"outlined",children:"Close"})]})})]})};function ps(s,t){return t===0?s>0?100:0:(s-t)/t*100}function fs(s){return s==null?"—":`${s>0?"+":s<0?"−":""}${Math.abs(Math.round(s))}%`}async function So(){const s=new Date,t=s.toISOString().slice(0,10),r=new Date(s.getTime()-30*24*60*60*1e3).toISOString().slice(0,10),n=new Date(s.getTime()-60*24*60*60*1e3).toISOString().slice(0,10),i=new Date(s.getTime()-30*24*60*60*1e3-1).toISOString().slice(0,10),l=await M.from("Orders").select("order_total, customer_email, date",{count:"exact"}).not("order_total","is",null);if(l.error||!l.data)throw new Error("Failed to fetch order stats");const o=l.data,a=o.filter(b=>b.date&&b.date>=r&&b.date<=t),c=o.filter(b=>b.date&&b.date>=n&&b.date<=i),d=a.reduce((b,S)=>b+(typeof S.order_total=="number"?S.order_total:0),0),p=c.reduce((b,S)=>b+(typeof S.order_total=="number"?S.order_total:0),0),m=a.length,v=c.length,C=new Set(a.map(b=>b.customer_email).filter(Boolean)),h=new Set(c.map(b=>b.customer_email).filter(Boolean));return{totalSales:d,orderCount:m,customerCount:C.size,salesChange:ps(d,p),ordersChange:ps(m,v),customersChange:ps(C.size,h.size)}}const vo=()=>{const[s,t]=u.useState(null),[r,n]=u.useState(null),[i,l]=u.useState(null),[o,a]=u.useState(null),[c,d]=u.useState(null),[p,m]=u.useState(null),[v,C]=u.useState(!0),[h,b]=u.useState(null);return Et("(max-width:600px)"),u.useEffect(()=>{let S=!0,O=!0;async function k(){O&&C(!0),b(null);try{const{totalSales:_,orderCount:N,customerCount:U,salesChange:R,ordersChange:W,customersChange:D}=await So();S&&(t(_),n(N),l(U),a(R),d(W),m(D))}catch(_){S&&b(_.message)}finally{O&&C(!1),O=!1}}k();const j=setInterval(k,1e4);return()=>{S=!1,clearInterval(j)}},[]),e.jsxs(x,{sx:{p:{xs:1,md:4},pt:{xs:0,md:4}},children:[e.jsx(g,{level:"h2",sx:{mb:2},children:"Dashboard"}),e.jsxs(Ke,{container:!0,spacing:2,children:[e.jsx(Ke,{xs:12,md:4,children:e.jsxs(ke,{variant:"outlined",children:[e.jsx(g,{level:"h4",children:"Total Sales"}),e.jsx(g,{level:"h2",color:"success",children:v?"Loading...":h?"—":`$${s?.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[v?"":fs(o)," from last 30 days"]})]})}),e.jsx(Ke,{xs:12,md:4,children:e.jsxs(ke,{variant:"outlined",children:[e.jsx(g,{level:"h4",children:"Orders"}),e.jsx(g,{level:"h2",color:"primary",children:v?"Loading...":h?"—":r?.toLocaleString()}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[v?"":fs(c)," from last 30 days"]})]})}),e.jsx(Ke,{xs:12,md:4,children:e.jsxs(ke,{variant:"outlined",children:[e.jsx(g,{level:"h4",children:"Customers"}),e.jsx(g,{level:"h2",color:"warning",children:v?"Loading...":h?"—":i?.toLocaleString()}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[v?"":fs(p)," new last 30 days"]})]})})]})]})},Te=({children:s})=>{const[t,r]=u.useState(null),[n,i]=u.useState(!0);return u.useEffect(()=>{async function l(){const{data:o}=await M.auth.getSession();r(o?.session||null),i(!1)}l()},[]),n?e.jsx("div",{children:"Loading..."}):t?e.jsx(e.Fragment,{children:s}):e.jsx($t,{to:"/",replace:!0})};function ko({onLogin:s}){const t=Ts(),[r,n]=u.useState(""),[i,l]=u.useState(""),[o,a]=u.useState(!1),[c,d]=u.useState(null);u.useEffect(()=>{if(window.location.pathname==="/login"){async function v(){const{data:C}=await M.auth.getSession();C?.session&&t("/dashboard")}v()}},[t]);async function p(v){v.preventDefault(),a(!0),d(null);const{data:C,error:h}=await M.auth.signInWithPassword({email:r,password:i});if(h){console.error("[Login] Auth error:",h),d(h.message),a(!1);return}const b=C.user?.id;if(!b){d("Login failed: No user ID."),a(!1);return}let{data:S,error:O}=await M.from("users").select("*").eq("id",b).single();if(O||!S){console.error("[Login] User fetch error:",O);const{error:k}=await M.from("users").upsert({id:b,email:C.user.email,name:C.user.user_metadata?.full_name||C.user.user_metadata?.name||"",role:"employee"});if(k){console.error("Upsert failed:",k),d("Upsert failed: "+k.message),a(!1);return}let j=3,_,N;for(;j>0;){await new Promise(W=>setTimeout(W,300));const{data:U,error:R}=await M.from("users").select("*").eq("id",b).single();if(_=U,N=R,N&&console.error("[Login] Retry user fetch error:",N),_&&!N){S=_,O=null;break}j--}if(O||!S){d("Access denied: User not found."),await M.auth.signOut(),a(!1);return}}if(S.role!=="employee"){d("Access denied: Only employees can access this app."),await M.auth.signOut(),a(!1);return}a(!1),s(),t("/dashboard")}async function m(){a(!0),d(null),a(!1)}return e.jsx(x,{sx:{minHeight:"100dvh",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.body"},children:e.jsxs(ke,{sx:{minWidth:340,p:4},children:[e.jsx(g,{level:"h3",sx:{mb:2},children:"Sign in to Smartbuy"}),e.jsxs("form",{onSubmit:p,children:[e.jsx(B,{type:"email",placeholder:"Email",value:r,onChange:v=>n(v.target.value),sx:{mb:2},required:!0}),e.jsx(B,{type:"password",placeholder:"Password",value:i,onChange:v=>l(v.target.value),sx:{mb:2},required:!0}),e.jsx(q,{type:"submit",loading:o,fullWidth:!0,sx:{mb:1},children:"Sign In"})]}),e.jsx(q,{onClick:m,variant:"outlined",fullWidth:!0,sx:{mb:1},disabled:o,children:"Sign in with Google"}),c&&e.jsx(g,{color:"danger",sx:{mt:1},children:c})]})})}function Co(){return e.jsx(Ls,{children:e.jsx(ye,{path:"*",element:e.jsx(ko,{onLogin:()=>{}})})})}const de={fontSize:K.sizes.small},Ro=()=>{const{isMobile:s}=Se();Wr();const[t,r]=u.useState([]),[n,i]=u.useState([]),[l,o]=u.useState(""),[a,c]=u.useState(!1),[d,p]=u.useState(!1),[m,v]=u.useState(""),[C,h]=u.useState(""),[b,S]=u.useState(""),[O,k]=u.useState(""),[j,_]=u.useState(null),[N,U]=u.useState(!1),[R,W]=u.useState(""),[D,T]=u.useState(""),[L,I]=u.useState(!1),[y,E]=u.useState(!1),[P,F]=u.useState(""),[xe,Oe]=u.useState("success"),le=(f,$="success")=>{F(f),Oe($),E(!0)},ve=async()=>{try{const{data:f,error:$}=await M.from("stock_movements").select(`
                    *,
                    Products (
                        ProductName,
                        ProductID
                    )
                `).order("date",{ascending:!1});$?(console.error("Error fetching movements:",$),r([]),le("Failed to load movements","danger")):r(f||[])}catch(f){console.error("Unexpected error:",f),r([]),le("An unexpected error occurred","danger")}},Ne=async()=>{try{const{data:f,error:$}=await M.from("Products").select("*").order("ProductName");$?(console.error("Error fetching products:",$),i([])):i(f||[])}catch(f){console.error("Unexpected error:",f),i([])}},Je=async f=>{if(!f){_(null);return}U(!0);try{const{data:$,error:X}=await M.from("stock_movements").select("movement_type, quantity").eq("product_id",f);if(X)console.error("Error fetching stock movements:",X),_(null);else{const J=($||[]).reduce((te,se)=>{switch(se.movement_type){case"incoming":return te+se.quantity;case"outgoing":return te-se.quantity;case"adjustment":return te+se.quantity;default:return te}},0);_(J)}}catch($){console.error("Error calculating stock:",$),_(null)}finally{U(!1)}};u.useEffect(()=>{O?Je(O):_(null)},[O]);const dt=async()=>{if(!O||R===""||j===null){le("Please select a product and enter a valid stock level","warning");return}const $=Number(R)-j;if($===0){le("No adjustment needed - the stock level is already at the specified amount","warning");return}I(!0);try{const{error:X}=await M.from("stock_movements").insert({product_id:O,movement_type:"adjustment",quantity:$,reason:`Manual adjustment: ${D||"Stock level correction"}`,date:new Date().toISOString()});X?(console.error("Error creating adjustment:",X),le("Failed to create adjustment: "+X.message,"danger")):(k(""),W(""),T(""),_(null),c(!1),ve(),le("Stock adjustment created successfully!","success"))}catch(X){console.error("Unexpected error:",X),le("An unexpected error occurred","danger")}finally{I(!1)}};u.useEffect(()=>{ve(),Ne()},[]);const Be=t.filter(f=>{const $=l.toLowerCase(),X=l===""||f.id.toLowerCase().includes($)||f.product_id.toLowerCase().includes($)||f.movement_type.toLowerCase().includes($)||(f.reason?.toLowerCase().includes($)??!1)||(f.Products?.ProductName?.toLowerCase().includes($)??!1),J=m===""||f.movement_type===m,te=C===""||f.product_id===C,se=b===""||(()=>{const fe=f.reason?.toLowerCase()||"";switch(b){case"manual":return fe.includes("manual")||fe.includes("adjustment")||fe.includes("correction");case"damage":return fe.includes("damage")||fe.includes("broken")||fe.includes("defect");case"loss":return fe.includes("loss")||fe.includes("lost")||fe.includes("missing");case"found":return fe.includes("found")||fe.includes("surplus")||fe.includes("extra");case"po":return fe.includes("po")||fe.includes("purchase")||fe.includes("receipt");default:return!0}})();return X&&J&&te&&se}),Ee=f=>{switch(f.movement_type){case"incoming":return"success";case"outgoing":return"danger";case"adjustment":return f.quantity>=0?"success":"danger";default:return"neutral"}},rt=f=>{switch(f.movement_type){case"incoming":return"↑";case"outgoing":return"↓";case"adjustment":return"⚖";default:return"•"}},nt=f=>{switch(f.movement_type){case"incoming":return`+${f.quantity}`;case"outgoing":return`-${f.quantity}`;case"adjustment":return f.quantity>=0?`+${f.quantity}`:`${f.quantity}`;default:return f.quantity}},it=()=>{v(""),h(""),S("")},A=m!==""||C!==""||b!=="",V=()=>e.jsxs(x,{sx:{width:"100%",minHeight:"100vh"},children:[e.jsxs(je,{padding:"medium",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:K.sizes.xlarge},children:"Stock Movements"}),e.jsxs(x,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(B,{placeholder:"Search movements...",value:l,onChange:f=>o(f.target.value),startDecorator:e.jsx(ge,{}),sx:{flex:1}}),e.jsx(re,{variant:A?"solid":"soft",color:A?"primary":"neutral",size:"sm",onClick:()=>p(!0),children:e.jsx(Is,{})})]}),A&&e.jsxs(x,{sx:{mb:2,display:"flex",gap:1,flexWrap:"wrap"},children:[m&&e.jsxs(Y,{size:"sm",variant:"soft",color:"primary",children:["Type: ",m]}),C&&e.jsxs(Y,{size:"sm",variant:"soft",color:"primary",children:["Product: ",n.find(f=>f.uuid===C)?.ProductName||"Selected"]}),b&&e.jsxs(Y,{size:"sm",variant:"soft",color:"primary",children:["Reason: ",b]})]})]}),e.jsx(x,{children:Be.length===0?e.jsx(x,{sx:{textAlign:"center",py:6},children:e.jsx(g,{color:"neutral",children:"No stock movements found"})}):Be.map(f=>e.jsx(x,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider","&:hover":{bgcolor:"background.level1"}},children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(x,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:`${Ee(f)}.100`,color:`${Ee(f)}.600`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",flexShrink:0},children:rt(f)}),e.jsxs(x,{sx:{flex:1,minWidth:0},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[e.jsx(g,{level:"title-sm",sx:{fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"60%"},children:f.Products?.ProductName||"Unknown Product"}),e.jsx(Y,{size:"sm",color:Ee(f),variant:"soft",sx:{fontWeight:"bold",minWidth:"fit-content"},children:nt(f)})]}),e.jsxs(g,{level:"body-xs",color:"neutral",sx:{mb:.5},children:["ID: ",f.Products?.ProductID||"N/A"," • ",new Date(f.date).toLocaleDateString()]}),f.reason&&e.jsx(g,{level:"body-xs",color:"neutral",sx:{fontStyle:"italic",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:f.reason})]})]})},f.id))}),e.jsx(re,{color:"primary",variant:"soft",size:"sm",sx:{position:"fixed",bottom:80,right:16,zIndex:1e3,borderRadius:"8px",width:40,height:40,boxShadow:"sm",bgcolor:"primary.100","&:hover":{bgcolor:"primary.200",boxShadow:"md"}},onClick:()=>c(!0),children:e.jsx(ae,{fontSize:"small"})})]}),pe=()=>e.jsxs(je,{variant:"page",padding:"large",children:[e.jsx(g,{level:"h2",sx:{mb:2,fontSize:K.sizes.xlarge},children:"Stock Movements"}),e.jsxs(x,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(B,{placeholder:"Search movements...",sx:{flex:1,fontSize:K.sizes.small},value:l,onChange:f=>o(f.target.value),startDecorator:e.jsx(ge,{})}),e.jsx(q,{variant:"solid",startDecorator:e.jsx(ae,{}),onClick:()=>c(!0),sx:{fontSize:K.sizes.small},children:"Adjust"})]}),e.jsx(ke,{children:e.jsxs(Ue,{"aria-label":"Stock Movements",sx:{tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:de,children:"ID"}),e.jsx("th",{style:de,children:"Product"}),e.jsx("th",{style:de,children:"Movement Type"}),e.jsx("th",{style:de,children:"Quantity"}),e.jsx("th",{style:de,children:"Reason"}),e.jsx("th",{style:de,children:"Date"})]})}),e.jsxs("tbody",{children:[Be.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{textAlign:"center",color:"#888",...de},children:"No stock movements found."})}),Be.map(f=>e.jsxs("tr",{style:{cursor:"pointer"},children:[e.jsxs("td",{style:de,children:[f.id.substring(0,8),"..."]}),e.jsx("td",{style:de,children:f.Products?e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:f.Products.ProductName}),e.jsxs("div",{style:{fontSize:"0.8em",color:"#666"},children:["ID: ",f.Products.ProductID]})]}):e.jsx("span",{style:{color:"#999",fontStyle:"italic"},children:"Unknown Product"})}),e.jsx("td",{style:de,children:e.jsx(Y,{size:"sm",variant:"soft",color:Ee(f),children:f.movement_type==="incoming"?"↑ Incoming":f.movement_type==="outgoing"?"↓ Outgoing":"⚖ Adjustment"})}),e.jsx("td",{style:de,children:e.jsx("span",{style:{fontWeight:"bold",color:Ee(f)==="success"?"#059669":Ee(f)==="danger"?"#dc2626":"#666"},children:nt(f)})}),e.jsx("td",{style:de,children:f.reason||"N/A"}),e.jsx("td",{style:de,children:new Date(f.date).toLocaleString()})]},f.id))]})]})})]});return e.jsxs(Le,{children:[s?e.jsx(V,{}):e.jsx(pe,{}),e.jsx(Ut,{open:a,onClose:()=>c(!1),title:"Manual Stock Adjustment",size:"medium",actions:e.jsxs(x,{sx:{display:"flex",gap:2},children:[e.jsx(q,{variant:"plain",onClick:()=>c(!1),sx:de,children:"Cancel"}),e.jsx(q,{variant:"solid",onClick:dt,loading:L,disabled:!O||R===""||j===null||Number(R)===j,sx:de,children:"Create Adjustment"})]}),children:e.jsxs(ee,{spacing:2,children:[e.jsxs(ue,{children:[e.jsx(he,{children:"Product"}),e.jsx(ne,{placeholder:"Select a product...",value:O,onChange:(f,$)=>k($||""),children:n.map(f=>e.jsxs(z,{value:f.uuid,children:[f.ProductName," (ID: ",f.ProductID,")"]},f.uuid))})]}),O&&e.jsxs(ue,{children:[e.jsx(he,{children:"Current Stock Level"}),e.jsx(B,{value:N?"Loading...":j!==null?j:"N/A",readOnly:!0,sx:{bgcolor:"neutral.100",color:j!==null&&j<=0?"danger.500":"neutral.600"}}),j!==null&&j<=0&&e.jsx(g,{level:"body-sm",sx:{color:"danger.500",mt:.5},children:"⚠️ Warning: Product is at or below zero stock level"})]}),j!==null&&e.jsxs(ue,{children:[e.jsx(he,{children:"Actual Stock Level"}),e.jsx(B,{type:"number",placeholder:"Enter the actual stock level...",value:R,onChange:f=>W(f.target.value),sx:{...de},slotProps:{input:{min:0,max:999999}}}),R!==""&&j!==null&&e.jsx(g,{level:"body-sm",sx:{mt:.5,color:Number(R)>j?"success.600":Number(R)<j?"danger.600":"neutral.600"},children:Number(R)>j?`+${Number(R)-j} (increase)`:Number(R)<j?`${Number(R)-j} (decrease)`:"No change needed"})]}),e.jsxs(ue,{children:[e.jsx(he,{children:"Reason for Adjustment"}),e.jsx(B,{placeholder:"e.g., damage, loss, found inventory, physical count correction...",value:D,onChange:f=>T(f.target.value),sx:{...de}})]})]})}),s&&e.jsx(Ut,{open:d,onClose:()=>p(!1),title:"Filter Movements",size:"medium",actions:e.jsxs(x,{sx:{display:"flex",gap:1,justifyContent:"space-between",width:"100%"},children:[e.jsx(q,{variant:"plain",color:"neutral",onClick:it,disabled:!A,children:"Clear All"}),e.jsx(q,{onClick:()=>p(!1),children:"Apply Filters"})]}),children:e.jsxs(ee,{spacing:2,children:[e.jsxs(ue,{children:[e.jsx(he,{children:"Movement Type"}),e.jsxs(ne,{placeholder:"All types",value:m,onChange:(f,$)=>v($||""),children:[e.jsx(z,{value:"",children:"All Types"}),e.jsx(z,{value:"incoming",children:"Incoming"}),e.jsx(z,{value:"outgoing",children:"Outgoing"}),e.jsx(z,{value:"adjustment",children:"Adjustment"})]})]}),e.jsxs(ue,{children:[e.jsx(he,{children:"Product"}),e.jsxs(ne,{placeholder:"All products",value:C,onChange:(f,$)=>h($||""),children:[e.jsx(z,{value:"",children:"All Products"}),n.map(f=>e.jsx(z,{value:f.uuid,children:f.ProductName},f.uuid))]})]}),e.jsxs(ue,{children:[e.jsx(he,{children:"Reason Category"}),e.jsxs(ne,{placeholder:"All reasons",value:b,onChange:(f,$)=>S($||""),children:[e.jsx(z,{value:"",children:"All Reasons"}),e.jsx(z,{value:"manual",children:"Manual Adjustment"}),e.jsx(z,{value:"damage",children:"Damage/Defect"}),e.jsx(z,{value:"loss",children:"Loss/Missing"}),e.jsx(z,{value:"found",children:"Found/Surplus"}),e.jsx(z,{value:"po",children:"Purchase Order"})]})]})]})}),e.jsx(Kt,{open:y,onClose:()=>E(!1),autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{top:16,zIndex:2e3},children:e.jsx(Ps,{color:xe,variant:"solid",sx:{width:"100%"},children:P})})]})};function $s(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var st=$s();function jn(s){st=s}var gt={exec:()=>null};function Z(s,t=""){let r=typeof s=="string"?s:s.source,n={replace:(i,l)=>{let o=typeof l=="string"?l:l.source;return o=o.replace(we.caret,"$1"),r=r.replace(i,o),n},getRegex:()=>new RegExp(r,t)};return n}var we={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:s=>new RegExp(`^( {0,3}${s})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}#`),htmlBeginRegex:s=>new RegExp(`^ {0,${Math.min(3,s-1)}}<(?:[a-z].*>|!--)`,"i")},_o=/^(?:[ \t]*(?:\n|$))+/,Po=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Eo=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,St=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Ao=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Us=/(?:[*+-]|\d{1,9}[.)])/,bn=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,yn=Z(bn).replace(/bull/g,Us).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Oo=Z(bn).replace(/bull/g,Us).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Bs=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Io=/^[^\n]+/,Ws=/(?!\s*\])(?:\\.|[^\[\]\\])+/,Do=Z(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Ws).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),To=Z(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Us).getRegex(),is="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Hs=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,zo=Z("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Hs).replace("tag",is).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),wn=Z(Bs).replace("hr",St).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",is).getRegex(),Lo=Z(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",wn).getRegex(),Vs={blockquote:Lo,code:Po,def:Do,fences:Eo,heading:Ao,hr:St,html:zo,lheading:yn,list:To,newline:_o,paragraph:wn,table:gt,text:Io},Cr=Z("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",St).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",is).getRegex(),No={...Vs,lheading:Oo,table:Cr,paragraph:Z(Bs).replace("hr",St).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Cr).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",is).getRegex()},Mo={...Vs,html:Z(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Hs).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:gt,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Z(Bs).replace("hr",St).replace("heading",` *#{1,6} *[^
]`).replace("lheading",yn).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Fo=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,qo=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Sn=/^( {2,}|\\)\n(?!\s*$)/,$o=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,ls=/[\p{P}\p{S}]/u,Js=/[\s\p{P}\p{S}]/u,vn=/[^\s\p{P}\p{S}]/u,Uo=Z(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Js).getRegex(),kn=/(?!~)[\p{P}\p{S}]/u,Bo=/(?!~)[\s\p{P}\p{S}]/u,Wo=/(?:[^\s\p{P}\p{S}]|~)/u,Ho=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,Cn=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Vo=Z(Cn,"u").replace(/punct/g,ls).getRegex(),Jo=Z(Cn,"u").replace(/punct/g,kn).getRegex(),Rn="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Go=Z(Rn,"gu").replace(/notPunctSpace/g,vn).replace(/punctSpace/g,Js).replace(/punct/g,ls).getRegex(),Zo=Z(Rn,"gu").replace(/notPunctSpace/g,Wo).replace(/punctSpace/g,Bo).replace(/punct/g,kn).getRegex(),Qo=Z("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,vn).replace(/punctSpace/g,Js).replace(/punct/g,ls).getRegex(),Ko=Z(/\\(punct)/,"gu").replace(/punct/g,ls).getRegex(),Xo=Z(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Yo=Z(Hs).replace("(?:-->|$)","-->").getRegex(),ea=Z("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Yo).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Ht=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,ta=Z(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Ht).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),_n=Z(/^!?\[(label)\]\[(ref)\]/).replace("label",Ht).replace("ref",Ws).getRegex(),Pn=Z(/^!?\[(ref)\](?:\[\])?/).replace("ref",Ws).getRegex(),sa=Z("reflink|nolink(?!\\()","g").replace("reflink",_n).replace("nolink",Pn).getRegex(),Gs={_backpedal:gt,anyPunctuation:Ko,autolink:Xo,blockSkip:Ho,br:Sn,code:qo,del:gt,emStrongLDelim:Vo,emStrongRDelimAst:Go,emStrongRDelimUnd:Qo,escape:Fo,link:ta,nolink:Pn,punctuation:Uo,reflink:_n,reflinkSearch:sa,tag:ea,text:$o,url:gt},ra={...Gs,link:Z(/^!?\[(label)\]\((.*?)\)/).replace("label",Ht).getRegex(),reflink:Z(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Ht).getRegex()},ks={...Gs,emStrongRDelimAst:Zo,emStrongLDelim:Jo,url:Z(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},na={...ks,br:Z(Sn).replace("{2,}","*").getRegex(),text:Z(ks.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Pt={normal:Vs,gfm:No,pedantic:Mo},xt={normal:Gs,gfm:ks,breaks:na,pedantic:ra},ia={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Rr=s=>ia[s];function ze(s,t){if(t){if(we.escapeTest.test(s))return s.replace(we.escapeReplace,Rr)}else if(we.escapeTestNoEncode.test(s))return s.replace(we.escapeReplaceNoEncode,Rr);return s}function _r(s){try{s=encodeURI(s).replace(we.percentDecode,"%")}catch{return null}return s}function Pr(s,t){let r=s.replace(we.findPipe,(l,o,a)=>{let c=!1,d=o;for(;--d>=0&&a[d]==="\\";)c=!c;return c?"|":" |"}),n=r.split(we.splitPipe),i=0;if(n[0].trim()||n.shift(),n.length>0&&!n.at(-1)?.trim()&&n.pop(),t)if(n.length>t)n.splice(t);else for(;n.length<t;)n.push("");for(;i<n.length;i++)n[i]=n[i].trim().replace(we.slashPipe,"|");return n}function pt(s,t,r){let n=s.length;if(n===0)return"";let i=0;for(;i<n&&s.charAt(n-i-1)===t;)i++;return s.slice(0,n-i)}function la(s,t){if(s.indexOf(t[1])===-1)return-1;let r=0;for(let n=0;n<s.length;n++)if(s[n]==="\\")n++;else if(s[n]===t[0])r++;else if(s[n]===t[1]&&(r--,r<0))return n;return r>0?-2:-1}function Er(s,t,r,n,i){let l=t.href,o=t.title||null,a=s[1].replace(i.other.outputLinkReplace,"$1");n.state.inLink=!0;let c={type:s[0].charAt(0)==="!"?"image":"link",raw:r,href:l,title:o,text:a,tokens:n.inlineTokens(a)};return n.state.inLink=!1,c}function oa(s,t,r){let n=s.match(r.other.indentCodeCompensation);if(n===null)return t;let i=n[1];return t.split(`
`).map(l=>{let o=l.match(r.other.beginningSpace);if(o===null)return l;let[a]=o;return a.length>=i.length?l.slice(i.length):l}).join(`
`)}var Vt=class{options;rules;lexer;constructor(s){this.options=s||st}space(s){let t=this.rules.block.newline.exec(s);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(s){let t=this.rules.block.code.exec(s);if(t){let r=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?r:pt(r,`
`)}}}fences(s){let t=this.rules.block.fences.exec(s);if(t){let r=t[0],n=oa(r,t[3]||"",this.rules);return{type:"code",raw:r,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:n}}}heading(s){let t=this.rules.block.heading.exec(s);if(t){let r=t[2].trim();if(this.rules.other.endingHash.test(r)){let n=pt(r,"#");(this.options.pedantic||!n||this.rules.other.endingSpaceChar.test(n))&&(r=n.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:r,tokens:this.lexer.inline(r)}}}hr(s){let t=this.rules.block.hr.exec(s);if(t)return{type:"hr",raw:pt(t[0],`
`)}}blockquote(s){let t=this.rules.block.blockquote.exec(s);if(t){let r=pt(t[0],`
`).split(`
`),n="",i="",l=[];for(;r.length>0;){let o=!1,a=[],c;for(c=0;c<r.length;c++)if(this.rules.other.blockquoteStart.test(r[c]))a.push(r[c]),o=!0;else if(!o)a.push(r[c]);else break;r=r.slice(c);let d=a.join(`
`),p=d.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}
${d}`:d,i=i?`${i}
${p}`:p;let m=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(p,l,!0),this.lexer.state.top=m,r.length===0)break;let v=l.at(-1);if(v?.type==="code")break;if(v?.type==="blockquote"){let C=v,h=C.raw+`
`+r.join(`
`),b=this.blockquote(h);l[l.length-1]=b,n=n.substring(0,n.length-C.raw.length)+b.raw,i=i.substring(0,i.length-C.text.length)+b.text;break}else if(v?.type==="list"){let C=v,h=C.raw+`
`+r.join(`
`),b=this.list(h);l[l.length-1]=b,n=n.substring(0,n.length-v.raw.length)+b.raw,i=i.substring(0,i.length-C.raw.length)+b.raw,r=h.substring(l.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:n,tokens:l,text:i}}}list(s){let t=this.rules.block.list.exec(s);if(t){let r=t[1].trim(),n=r.length>1,i={type:"list",raw:"",ordered:n,start:n?+r.slice(0,-1):"",loose:!1,items:[]};r=n?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=n?r:"[*+-]");let l=this.rules.other.listItemRegex(r),o=!1;for(;s;){let c=!1,d="",p="";if(!(t=l.exec(s))||this.rules.block.hr.test(s))break;d=t[0],s=s.substring(d.length);let m=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,O=>" ".repeat(3*O.length)),v=s.split(`
`,1)[0],C=!m.trim(),h=0;if(this.options.pedantic?(h=2,p=m.trimStart()):C?h=t[1].length+1:(h=t[2].search(this.rules.other.nonSpaceChar),h=h>4?1:h,p=m.slice(h),h+=t[1].length),C&&this.rules.other.blankLine.test(v)&&(d+=v+`
`,s=s.substring(v.length+1),c=!0),!c){let O=this.rules.other.nextBulletRegex(h),k=this.rules.other.hrRegex(h),j=this.rules.other.fencesBeginRegex(h),_=this.rules.other.headingBeginRegex(h),N=this.rules.other.htmlBeginRegex(h);for(;s;){let U=s.split(`
`,1)[0],R;if(v=U,this.options.pedantic?(v=v.replace(this.rules.other.listReplaceNesting,"  "),R=v):R=v.replace(this.rules.other.tabCharGlobal,"    "),j.test(v)||_.test(v)||N.test(v)||O.test(v)||k.test(v))break;if(R.search(this.rules.other.nonSpaceChar)>=h||!v.trim())p+=`
`+R.slice(h);else{if(C||m.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||j.test(m)||_.test(m)||k.test(m))break;p+=`
`+v}!C&&!v.trim()&&(C=!0),d+=U+`
`,s=s.substring(U.length+1),m=R.slice(h)}}i.loose||(o?i.loose=!0:this.rules.other.doubleBlankLine.test(d)&&(o=!0));let b=null,S;this.options.gfm&&(b=this.rules.other.listIsTask.exec(p),b&&(S=b[0]!=="[ ] ",p=p.replace(this.rules.other.listReplaceTask,""))),i.items.push({type:"list_item",raw:d,task:!!b,checked:S,loose:!1,text:p,tokens:[]}),i.raw+=d}let a=i.items.at(-1);if(a)a.raw=a.raw.trimEnd(),a.text=a.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let c=0;c<i.items.length;c++)if(this.lexer.state.top=!1,i.items[c].tokens=this.lexer.blockTokens(i.items[c].text,[]),!i.loose){let d=i.items[c].tokens.filter(m=>m.type==="space"),p=d.length>0&&d.some(m=>this.rules.other.anyLine.test(m.raw));i.loose=p}if(i.loose)for(let c=0;c<i.items.length;c++)i.items[c].loose=!0;return i}}html(s){let t=this.rules.block.html.exec(s);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(s){let t=this.rules.block.def.exec(s);if(t){let r=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:r,raw:t[0],href:n,title:i}}}table(s){let t=this.rules.block.table.exec(s);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let r=Pr(t[1]),n=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],l={type:"table",raw:t[0],header:[],align:[],rows:[]};if(r.length===n.length){for(let o of n)this.rules.other.tableAlignRight.test(o)?l.align.push("right"):this.rules.other.tableAlignCenter.test(o)?l.align.push("center"):this.rules.other.tableAlignLeft.test(o)?l.align.push("left"):l.align.push(null);for(let o=0;o<r.length;o++)l.header.push({text:r[o],tokens:this.lexer.inline(r[o]),header:!0,align:l.align[o]});for(let o of i)l.rows.push(Pr(o,l.header.length).map((a,c)=>({text:a,tokens:this.lexer.inline(a),header:!1,align:l.align[c]})));return l}}lheading(s){let t=this.rules.block.lheading.exec(s);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(s){let t=this.rules.block.paragraph.exec(s);if(t){let r=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:r,tokens:this.lexer.inline(r)}}}text(s){let t=this.rules.block.text.exec(s);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(s){let t=this.rules.inline.escape.exec(s);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(s){let t=this.rules.inline.tag.exec(s);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(s){let t=this.rules.inline.link.exec(s);if(t){let r=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(r)){if(!this.rules.other.endAngleBracket.test(r))return;let l=pt(r.slice(0,-1),"\\");if((r.length-l.length)%2===0)return}else{let l=la(t[2],"()");if(l===-2)return;if(l>-1){let o=(t[0].indexOf("!")===0?5:4)+t[1].length+l;t[2]=t[2].substring(0,l),t[0]=t[0].substring(0,o).trim(),t[3]=""}}let n=t[2],i="";if(this.options.pedantic){let l=this.rules.other.pedanticHrefTitle.exec(n);l&&(n=l[1],i=l[3])}else i=t[3]?t[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(r)?n=n.slice(1):n=n.slice(1,-1)),Er(t,{href:n&&n.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(s,t){let r;if((r=this.rules.inline.reflink.exec(s))||(r=this.rules.inline.nolink.exec(s))){let n=(r[2]||r[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=t[n.toLowerCase()];if(!i){let l=r[0].charAt(0);return{type:"text",raw:l,text:l}}return Er(r,i,r[0],this.lexer,this.rules)}}emStrong(s,t,r=""){let n=this.rules.inline.emStrongLDelim.exec(s);if(!(!n||n[3]&&r.match(this.rules.other.unicodeAlphaNumeric))&&(!(n[1]||n[2])||!r||this.rules.inline.punctuation.exec(r))){let i=[...n[0]].length-1,l,o,a=i,c=0,d=n[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(d.lastIndex=0,t=t.slice(-1*s.length+i);(n=d.exec(t))!=null;){if(l=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!l)continue;if(o=[...l].length,n[3]||n[4]){a+=o;continue}else if((n[5]||n[6])&&i%3&&!((i+o)%3)){c+=o;continue}if(a-=o,a>0)continue;o=Math.min(o,o+a+c);let p=[...n[0]][0].length,m=s.slice(0,i+n.index+p+o);if(Math.min(i,o)%2){let C=m.slice(1,-1);return{type:"em",raw:m,text:C,tokens:this.lexer.inlineTokens(C)}}let v=m.slice(2,-2);return{type:"strong",raw:m,text:v,tokens:this.lexer.inlineTokens(v)}}}}codespan(s){let t=this.rules.inline.code.exec(s);if(t){let r=t[2].replace(this.rules.other.newLineCharGlobal," "),n=this.rules.other.nonSpaceChar.test(r),i=this.rules.other.startingSpaceChar.test(r)&&this.rules.other.endingSpaceChar.test(r);return n&&i&&(r=r.substring(1,r.length-1)),{type:"codespan",raw:t[0],text:r}}}br(s){let t=this.rules.inline.br.exec(s);if(t)return{type:"br",raw:t[0]}}del(s){let t=this.rules.inline.del.exec(s);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(s){let t=this.rules.inline.autolink.exec(s);if(t){let r,n;return t[2]==="@"?(r=t[1],n="mailto:"+r):(r=t[1],n=r),{type:"link",raw:t[0],text:r,href:n,tokens:[{type:"text",raw:r,text:r}]}}}url(s){let t;if(t=this.rules.inline.url.exec(s)){let r,n;if(t[2]==="@")r=t[0],n="mailto:"+r;else{let i;do i=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??"";while(i!==t[0]);r=t[0],t[1]==="www."?n="http://"+t[0]:n=t[0]}return{type:"link",raw:t[0],text:r,href:n,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(s){let t=this.rules.inline.text.exec(s);if(t){let r=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:r}}}},qe=class Cs{tokens;options;state;tokenizer;inlineQueue;constructor(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||st,this.options.tokenizer=this.options.tokenizer||new Vt,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let r={other:we,block:Pt.normal,inline:xt.normal};this.options.pedantic?(r.block=Pt.pedantic,r.inline=xt.pedantic):this.options.gfm&&(r.block=Pt.gfm,this.options.breaks?r.inline=xt.breaks:r.inline=xt.gfm),this.tokenizer.rules=r}static get rules(){return{block:Pt,inline:xt}}static lex(t,r){return new Cs(r).lex(t)}static lexInline(t,r){return new Cs(r).inlineTokens(t)}lex(t){t=t.replace(we.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let r=0;r<this.inlineQueue.length;r++){let n=this.inlineQueue[r];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,r=[],n=!1){for(this.options.pedantic&&(t=t.replace(we.tabCharGlobal,"    ").replace(we.spaceLine,""));t;){let i;if(this.options.extensions?.block?.some(o=>(i=o.call({lexer:this},t,r))?(t=t.substring(i.raw.length),r.push(i),!0):!1))continue;if(i=this.tokenizer.space(t)){t=t.substring(i.raw.length);let o=r.at(-1);i.raw.length===1&&o!==void 0?o.raw+=`
`:r.push(i);continue}if(i=this.tokenizer.code(t)){t=t.substring(i.raw.length);let o=r.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=`
`+i.raw,o.text+=`
`+i.text,this.inlineQueue.at(-1).src=o.text):r.push(i);continue}if(i=this.tokenizer.fences(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.heading(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.hr(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.blockquote(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.list(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.html(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.def(t)){t=t.substring(i.raw.length);let o=r.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=`
`+i.raw,o.text+=`
`+i.raw,this.inlineQueue.at(-1).src=o.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title});continue}if(i=this.tokenizer.table(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.lheading(t)){t=t.substring(i.raw.length),r.push(i);continue}let l=t;if(this.options.extensions?.startBlock){let o=1/0,a=t.slice(1),c;this.options.extensions.startBlock.forEach(d=>{c=d.call({lexer:this},a),typeof c=="number"&&c>=0&&(o=Math.min(o,c))}),o<1/0&&o>=0&&(l=t.substring(0,o+1))}if(this.state.top&&(i=this.tokenizer.paragraph(l))){let o=r.at(-1);n&&o?.type==="paragraph"?(o.raw+=`
`+i.raw,o.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):r.push(i),n=l.length!==t.length,t=t.substring(i.raw.length);continue}if(i=this.tokenizer.text(t)){t=t.substring(i.raw.length);let o=r.at(-1);o?.type==="text"?(o.raw+=`
`+i.raw,o.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):r.push(i);continue}if(t){let o="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(o);break}else throw new Error(o)}}return this.state.top=!0,r}inline(t,r=[]){return this.inlineQueue.push({src:t,tokens:r}),r}inlineTokens(t,r=[]){let n=t,i=null;if(this.tokens.links){let a=Object.keys(this.tokens.links);if(a.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)a.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,i.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(i=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)n=n.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let l=!1,o="";for(;t;){l||(o=""),l=!1;let a;if(this.options.extensions?.inline?.some(d=>(a=d.call({lexer:this},t,r))?(t=t.substring(a.raw.length),r.push(a),!0):!1))continue;if(a=this.tokenizer.escape(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.tag(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.link(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(a.raw.length);let d=r.at(-1);a.type==="text"&&d?.type==="text"?(d.raw+=a.raw,d.text+=a.text):r.push(a);continue}if(a=this.tokenizer.emStrong(t,n,o)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.codespan(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.br(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.del(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.autolink(t)){t=t.substring(a.raw.length),r.push(a);continue}if(!this.state.inLink&&(a=this.tokenizer.url(t))){t=t.substring(a.raw.length),r.push(a);continue}let c=t;if(this.options.extensions?.startInline){let d=1/0,p=t.slice(1),m;this.options.extensions.startInline.forEach(v=>{m=v.call({lexer:this},p),typeof m=="number"&&m>=0&&(d=Math.min(d,m))}),d<1/0&&d>=0&&(c=t.substring(0,d+1))}if(a=this.tokenizer.inlineText(c)){t=t.substring(a.raw.length),a.raw.slice(-1)!=="_"&&(o=a.raw.slice(-1)),l=!0;let d=r.at(-1);d?.type==="text"?(d.raw+=a.raw,d.text+=a.text):r.push(a);continue}if(t){let d="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(d);break}else throw new Error(d)}}return r}},Jt=class{options;parser;constructor(s){this.options=s||st}space(s){return""}code({text:s,lang:t,escaped:r}){let n=(t||"").match(we.notSpaceStart)?.[0],i=s.replace(we.endingNewline,"")+`
`;return n?'<pre><code class="language-'+ze(n)+'">'+(r?i:ze(i,!0))+`</code></pre>
`:"<pre><code>"+(r?i:ze(i,!0))+`</code></pre>
`}blockquote({tokens:s}){return`<blockquote>
${this.parser.parse(s)}</blockquote>
`}html({text:s}){return s}heading({tokens:s,depth:t}){return`<h${t}>${this.parser.parseInline(s)}</h${t}>
`}hr(s){return`<hr>
`}list(s){let t=s.ordered,r=s.start,n="";for(let o=0;o<s.items.length;o++){let a=s.items[o];n+=this.listitem(a)}let i=t?"ol":"ul",l=t&&r!==1?' start="'+r+'"':"";return"<"+i+l+`>
`+n+"</"+i+`>
`}listitem(s){let t="";if(s.task){let r=this.checkbox({checked:!!s.checked});s.loose?s.tokens[0]?.type==="paragraph"?(s.tokens[0].text=r+" "+s.tokens[0].text,s.tokens[0].tokens&&s.tokens[0].tokens.length>0&&s.tokens[0].tokens[0].type==="text"&&(s.tokens[0].tokens[0].text=r+" "+ze(s.tokens[0].tokens[0].text),s.tokens[0].tokens[0].escaped=!0)):s.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):t+=r+" "}return t+=this.parser.parse(s.tokens,!!s.loose),`<li>${t}</li>
`}checkbox({checked:s}){return"<input "+(s?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:s}){return`<p>${this.parser.parseInline(s)}</p>
`}table(s){let t="",r="";for(let i=0;i<s.header.length;i++)r+=this.tablecell(s.header[i]);t+=this.tablerow({text:r});let n="";for(let i=0;i<s.rows.length;i++){let l=s.rows[i];r="";for(let o=0;o<l.length;o++)r+=this.tablecell(l[o]);n+=this.tablerow({text:r})}return n&&(n=`<tbody>${n}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+n+`</table>
`}tablerow({text:s}){return`<tr>
${s}</tr>
`}tablecell(s){let t=this.parser.parseInline(s.tokens),r=s.header?"th":"td";return(s.align?`<${r} align="${s.align}">`:`<${r}>`)+t+`</${r}>
`}strong({tokens:s}){return`<strong>${this.parser.parseInline(s)}</strong>`}em({tokens:s}){return`<em>${this.parser.parseInline(s)}</em>`}codespan({text:s}){return`<code>${ze(s,!0)}</code>`}br(s){return"<br>"}del({tokens:s}){return`<del>${this.parser.parseInline(s)}</del>`}link({href:s,title:t,tokens:r}){let n=this.parser.parseInline(r),i=_r(s);if(i===null)return n;s=i;let l='<a href="'+s+'"';return t&&(l+=' title="'+ze(t)+'"'),l+=">"+n+"</a>",l}image({href:s,title:t,text:r,tokens:n}){n&&(r=this.parser.parseInline(n,this.parser.textRenderer));let i=_r(s);if(i===null)return ze(r);s=i;let l=`<img src="${s}" alt="${r}"`;return t&&(l+=` title="${ze(t)}"`),l+=">",l}text(s){return"tokens"in s&&s.tokens?this.parser.parseInline(s.tokens):"escaped"in s&&s.escaped?s.text:ze(s.text)}},Zs=class{strong({text:s}){return s}em({text:s}){return s}codespan({text:s}){return s}del({text:s}){return s}html({text:s}){return s}text({text:s}){return s}link({text:s}){return""+s}image({text:s}){return""+s}br(){return""}},$e=class Rs{options;renderer;textRenderer;constructor(t){this.options=t||st,this.options.renderer=this.options.renderer||new Jt,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Zs}static parse(t,r){return new Rs(r).parse(t)}static parseInline(t,r){return new Rs(r).parseInline(t)}parse(t,r=!0){let n="";for(let i=0;i<t.length;i++){let l=t[i];if(this.options.extensions?.renderers?.[l.type]){let a=l,c=this.options.extensions.renderers[a.type].call({parser:this},a);if(c!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(a.type)){n+=c||"";continue}}let o=l;switch(o.type){case"space":{n+=this.renderer.space(o);continue}case"hr":{n+=this.renderer.hr(o);continue}case"heading":{n+=this.renderer.heading(o);continue}case"code":{n+=this.renderer.code(o);continue}case"table":{n+=this.renderer.table(o);continue}case"blockquote":{n+=this.renderer.blockquote(o);continue}case"list":{n+=this.renderer.list(o);continue}case"html":{n+=this.renderer.html(o);continue}case"paragraph":{n+=this.renderer.paragraph(o);continue}case"text":{let a=o,c=this.renderer.text(a);for(;i+1<t.length&&t[i+1].type==="text";)a=t[++i],c+=`
`+this.renderer.text(a);r?n+=this.renderer.paragraph({type:"paragraph",raw:c,text:c,tokens:[{type:"text",raw:c,text:c,escaped:!0}]}):n+=c;continue}default:{let a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return n}parseInline(t,r=this.renderer){let n="";for(let i=0;i<t.length;i++){let l=t[i];if(this.options.extensions?.renderers?.[l.type]){let a=this.options.extensions.renderers[l.type].call({parser:this},l);if(a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(l.type)){n+=a||"";continue}}let o=l;switch(o.type){case"escape":{n+=r.text(o);break}case"html":{n+=r.html(o);break}case"link":{n+=r.link(o);break}case"image":{n+=r.image(o);break}case"strong":{n+=r.strong(o);break}case"em":{n+=r.em(o);break}case"codespan":{n+=r.codespan(o);break}case"br":{n+=r.br(o);break}case"del":{n+=r.del(o);break}case"text":{n+=r.text(o);break}default:{let a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return n}},zt=class{options;block;constructor(s){this.options=s||st}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(s){return s}postprocess(s){return s}processAllTokens(s){return s}provideLexer(){return this.block?qe.lex:qe.lexInline}provideParser(){return this.block?$e.parse:$e.parseInline}},aa=class{defaults=$s();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=$e;Renderer=Jt;TextRenderer=Zs;Lexer=qe;Tokenizer=Vt;Hooks=zt;constructor(...s){this.use(...s)}walkTokens(s,t){let r=[];for(let n of s)switch(r=r.concat(t.call(this,n)),n.type){case"table":{let i=n;for(let l of i.header)r=r.concat(this.walkTokens(l.tokens,t));for(let l of i.rows)for(let o of l)r=r.concat(this.walkTokens(o.tokens,t));break}case"list":{let i=n;r=r.concat(this.walkTokens(i.items,t));break}default:{let i=n;this.defaults.extensions?.childTokens?.[i.type]?this.defaults.extensions.childTokens[i.type].forEach(l=>{let o=i[l].flat(1/0);r=r.concat(this.walkTokens(o,t))}):i.tokens&&(r=r.concat(this.walkTokens(i.tokens,t)))}}return r}use(...s){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return s.forEach(r=>{let n={...r};if(n.async=this.defaults.async||n.async||!1,r.extensions&&(r.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){let l=t.renderers[i.name];l?t.renderers[i.name]=function(...o){let a=i.renderer.apply(this,o);return a===!1&&(a=l.apply(this,o)),a}:t.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let l=t[i.level];l?l.unshift(i.tokenizer):t[i.level]=[i.tokenizer],i.start&&(i.level==="block"?t.startBlock?t.startBlock.push(i.start):t.startBlock=[i.start]:i.level==="inline"&&(t.startInline?t.startInline.push(i.start):t.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(t.childTokens[i.name]=i.childTokens)}),n.extensions=t),r.renderer){let i=this.defaults.renderer||new Jt(this.defaults);for(let l in r.renderer){if(!(l in i))throw new Error(`renderer '${l}' does not exist`);if(["options","parser"].includes(l))continue;let o=l,a=r.renderer[o],c=i[o];i[o]=(...d)=>{let p=a.apply(i,d);return p===!1&&(p=c.apply(i,d)),p||""}}n.renderer=i}if(r.tokenizer){let i=this.defaults.tokenizer||new Vt(this.defaults);for(let l in r.tokenizer){if(!(l in i))throw new Error(`tokenizer '${l}' does not exist`);if(["options","rules","lexer"].includes(l))continue;let o=l,a=r.tokenizer[o],c=i[o];i[o]=(...d)=>{let p=a.apply(i,d);return p===!1&&(p=c.apply(i,d)),p}}n.tokenizer=i}if(r.hooks){let i=this.defaults.hooks||new zt;for(let l in r.hooks){if(!(l in i))throw new Error(`hook '${l}' does not exist`);if(["options","block"].includes(l))continue;let o=l,a=r.hooks[o],c=i[o];zt.passThroughHooks.has(l)?i[o]=d=>{if(this.defaults.async)return Promise.resolve(a.call(i,d)).then(m=>c.call(i,m));let p=a.call(i,d);return c.call(i,p)}:i[o]=(...d)=>{let p=a.apply(i,d);return p===!1&&(p=c.apply(i,d)),p}}n.hooks=i}if(r.walkTokens){let i=this.defaults.walkTokens,l=r.walkTokens;n.walkTokens=function(o){let a=[];return a.push(l.call(this,o)),i&&(a=a.concat(i.call(this,o))),a}}this.defaults={...this.defaults,...n}}),this}setOptions(s){return this.defaults={...this.defaults,...s},this}lexer(s,t){return qe.lex(s,t??this.defaults)}parser(s,t){return $e.parse(s,t??this.defaults)}parseMarkdown(s){return(t,r)=>{let n={...r},i={...this.defaults,...n},l=this.onError(!!i.silent,!!i.async);if(this.defaults.async===!0&&n.async===!1)return l(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||t===null)return l(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return l(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));i.hooks&&(i.hooks.options=i,i.hooks.block=s);let o=i.hooks?i.hooks.provideLexer():s?qe.lex:qe.lexInline,a=i.hooks?i.hooks.provideParser():s?$e.parse:$e.parseInline;if(i.async)return Promise.resolve(i.hooks?i.hooks.preprocess(t):t).then(c=>o(c,i)).then(c=>i.hooks?i.hooks.processAllTokens(c):c).then(c=>i.walkTokens?Promise.all(this.walkTokens(c,i.walkTokens)).then(()=>c):c).then(c=>a(c,i)).then(c=>i.hooks?i.hooks.postprocess(c):c).catch(l);try{i.hooks&&(t=i.hooks.preprocess(t));let c=o(t,i);i.hooks&&(c=i.hooks.processAllTokens(c)),i.walkTokens&&this.walkTokens(c,i.walkTokens);let d=a(c,i);return i.hooks&&(d=i.hooks.postprocess(d)),d}catch(c){return l(c)}}}onError(s,t){return r=>{if(r.message+=`
Please report this to https://github.com/markedjs/marked.`,s){let n="<p>An error occurred:</p><pre>"+ze(r.message+"",!0)+"</pre>";return t?Promise.resolve(n):n}if(t)return Promise.reject(r);throw r}}},tt=new aa;function Q(s,t){return tt.parse(s,t)}Q.options=Q.setOptions=function(s){return tt.setOptions(s),Q.defaults=tt.defaults,jn(Q.defaults),Q};Q.getDefaults=$s;Q.defaults=st;Q.use=function(...s){return tt.use(...s),Q.defaults=tt.defaults,jn(Q.defaults),Q};Q.walkTokens=function(s,t){return tt.walkTokens(s,t)};Q.parseInline=tt.parseInline;Q.Parser=$e;Q.parser=$e.parse;Q.Renderer=Jt;Q.TextRenderer=Zs;Q.Lexer=qe;Q.lexer=qe.lex;Q.Tokenizer=Vt;Q.Hooks=zt;Q.parse=Q;Q.options;Q.setOptions;Q.use;Q.walkTokens;Q.parseInline;$e.parse;qe.lex;function Ar(){const[s,t]=G.useState(""),[r,n]=G.useState(!0),[i,l]=G.useState(!1);return G.useEffect(()=>{fetch("/RELEASE_LOG.md").then(o=>{if(!o.ok)throw new Error("Failed to fetch release log");return o.text()}).then(o=>{t(o),l(!1)}).catch(o=>{console.error("Error fetching release log:",o),l(!0)}).finally(()=>n(!1))},[]),e.jsx(ke,{sx:{height:"100%",minHeight:{xs:200,md:300}},children:e.jsxs(Lt,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(hi,{color:"primary"}),e.jsx(g,{level:"h4",children:"Release Log"})]}),e.jsxs(x,{sx:{flex:1,overflow:"auto",bgcolor:"background.level1",borderRadius:"var(--joy-radius-md)",border:"1px solid",borderColor:"divider",p:2},children:[r&&e.jsx(g,{level:"body-sm",color:"neutral",children:"Loading release log..."}),i&&e.jsx(g,{level:"body-sm",color:"danger",children:"Failed to load release log"}),!r&&!i&&e.jsx(x,{sx:{typography:"body-sm"},children:e.jsx("div",{dangerouslySetInnerHTML:{__html:Q(s)}})})]})]})})}function Or(){return Se(),e.jsx(ke,{sx:{height:"100%",minHeight:{xs:120,md:300}},children:e.jsxs(Lt,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(di,{color:"primary"}),e.jsx(g,{level:"h4",children:"Application Info"})]}),e.jsxs(ee,{spacing:1.5,sx:{flex:1},children:[e.jsx(g,{level:"title-md",sx:{fontWeight:"bold"},children:"Smartback Inventory System"}),e.jsxs(ee,{spacing:.5,children:[e.jsxs(g,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Environment:"})," ","production"]}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Version:"})," ","N/A"]}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Build:"})," ","N/A"]}),e.jsxs(g,{level:"body-sm",color:"neutral",children:[e.jsx("strong",{children:"Date:"})," ",new Date().toLocaleDateString()]})]})]}),e.jsx(q,{component:"a",href:"https://nicklasfangerfisk.github.io/Testflow/",target:"_blank",rel:"noopener noreferrer",startDecorator:e.jsx(ui,{}),variant:"outlined",color:"primary",sx:{mt:2,alignSelf:"flex-start"},children:"System Test"})]})})}const ca=()=>{const{isMobile:s}=Se(),t=()=>e.jsx(x,{sx:{width:"100%",minHeight:"100vh"},children:e.jsxs(je,{padding:"medium",children:[e.jsx(g,{level:"h2",sx:{mb:3,fontSize:K.sizes.xlarge},children:"Settings"}),e.jsxs(ee,{spacing:3,children:[e.jsx(Or,{}),e.jsx(Ar,{})]})]})}),r=()=>e.jsxs(je,{children:[e.jsx(g,{level:"h2",sx:{mb:3,fontSize:K.sizes.xlarge},children:"Settings"}),e.jsxs(x,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},alignItems:"start"},children:[e.jsx(Or,{}),e.jsx(Ar,{})]})]});return e.jsx(Le,{children:s?e.jsx(t,{}):e.jsx(r,{})})};function da(){const s=zs(),{isMobile:t}=Se(),r=Ts(),[n,i]=u.useState("dashboard"),l=[{label:"Dashboard",icon:e.jsx(Es,{}),value:"dashboard"},{label:"Orders",icon:e.jsx(As,{}),value:"orders"},{label:"Users",icon:e.jsx(Os,{}),value:"users"},{label:"Settings",icon:e.jsx(Mt,{}),value:"settings"}];return u.useEffect(()=>{i({"/":"dashboard","/dashboard":"dashboard","/orders":"orders","/products":"dashboard","/users":"users","/suppliers":"dashboard","/purchase-orders":"dashboard","/tickets":"dashboard","/sms-campaigns":"dashboard","/movements":"dashboard","/settings":"settings"}[s.pathname]||"dashboard")},[s.pathname]),console.log("isMobile:",t),e.jsxs(x,{sx:{display:"flex",height:"100vh",overflow:"hidden"},children:[s.pathname!=="/login"&&!t&&e.jsx(vi,{setView:o=>console.log(o),view:"home"}),e.jsxs(x,{component:"main",sx:{flexGrow:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0,overflowY:"auto",bgcolor:"background.default",p:s.pathname!=="/dashboard"&&s.pathname!=="/login"&&s.pathname!=="/tickets"&&s.pathname!=="/movements"?3:0,width:t?"100%":"calc(100% - var(--Sidebar-width, 240px))",marginBottom:t?"56px":0},children:[t&&s.pathname!=="/login"&&e.jsx(mo,{items:l,value:n,onChange:o=>{i(o),r(`/${o}`)},toggleSidebar:()=>console.log("Sidebar toggled")}),e.jsxs(Ls,{children:[e.jsx(ye,{path:"/",element:e.jsx($t,{to:"/dashboard",replace:!0})}),e.jsx(ye,{path:"/orders",element:e.jsx(Te,{children:e.jsx(Ri,{})})}),e.jsx(ye,{path:"/products",element:e.jsx(Te,{children:e.jsx(Pi,{})})}),e.jsx(ye,{path:"/users",element:e.jsx(Te,{children:e.jsx(Ai,{})})}),e.jsx(ye,{path:"/suppliers",element:e.jsx(Te,{children:e.jsx(Ii,{})})}),e.jsx(ye,{path:"/purchase-orders",element:e.jsx(Te,{children:e.jsx(fo,{})})}),e.jsx(ye,{path:"/tickets",element:e.jsx(Te,{children:e.jsx(bo,{})})}),e.jsx(ye,{path:"/sms-campaigns",element:e.jsx(Te,{children:e.jsx(wo,{})})}),e.jsx(ye,{path:"/dashboard",element:e.jsx(Te,{children:e.jsx(vo,{})})}),e.jsx(ye,{path:"/movements",element:e.jsx(Te,{children:e.jsx(Ro,{})})}),e.jsx(ye,{path:"/settings",element:e.jsx(Te,{children:e.jsx(ca,{})})}),e.jsx(ye,{path:"*",element:e.jsx($t,{to:"/",replace:!0})})]})]})]})}function ua(){return e.jsx(Bn,{children:e.jsx(pi,{children:e.jsxs(Ls,{children:[e.jsx(ye,{path:"/login/*",element:e.jsx(Co,{})}),e.jsx(ye,{path:"/*",element:e.jsx(da,{})})]})})})}console.log("Mounting React app...");const Ir=document.getElementById("root");Ir?(mi.createRoot(Ir).render(e.jsx(ua,{})),console.log("React app rendered!")):console.error("No #root element found in index.html!");
